<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Github User Fetcher: civetweb.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Github User Fetcher<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">C/C++ Application with Server and GUI</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('civetweb_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">civetweb.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="civetweb_8h_source.html">civetweb.h</a>&quot;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;inttypes.h&gt;</code><br />
<code>#include &lt;arpa/inet.h&gt;</code><br />
<code>#include &lt;ctype.h&gt;</code><br />
<code>#include &lt;dirent.h&gt;</code><br />
<code>#include &lt;grp.h&gt;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &lt;netdb.h&gt;</code><br />
<code>#include &lt;netinet/in.h&gt;</code><br />
<code>#include &lt;netinet/tcp.h&gt;</code><br />
<code>#include &lt;poll.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;pwd.h&gt;</code><br />
<code>#include &lt;stdarg.h&gt;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;sys/time.h&gt;</code><br />
<code>#include &lt;sys/utsname.h&gt;</code><br />
<code>#include &lt;sys/wait.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;dlfcn.h&gt;</code><br />
<code>#include &quot;md5.inl&quot;</code><br />
<code>#include &quot;openssl_dl.inl&quot;</code><br />
<code>#include &quot;sort.inl&quot;</code><br />
<code>#include &quot;match.inl&quot;</code><br />
<code>#include &quot;response.inl&quot;</code><br />
<code>#include &quot;handle_form.inl&quot;</code><br />
</div>
<p><a href="civetweb_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmg__workerTLS.html">mg_workerTLS</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">union &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="unionusa.html">usa</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvec.html">vec</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmg__file__stat.html">mg_file_stat</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmg__file__access.html">mg_file_access</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmg__file.html">mg_file</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsocket.html">socket</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmg__handler__info.html">mg_handler_info</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmg__domain__context.html">mg_domain_context</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtwebdav__lock.html">twebdav_lock</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmg__context.html">mg_context</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmg__connection.html">mg_connection</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structde.html">de</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structah.html">ah</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structread__auth__file__struct.html">read_auth_file_struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdir__scan__data.html">dir_scan_data</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmg__http__method__info.html">mg_http_method_info</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcgi__environment.html">cgi_environment</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structprocess__control__data.html">process_control_data</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwebsocket__client__thread__data.html">websocket_client_thread_data</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a369266c24eacffb87046522897a570d5" id="r_a369266c24eacffb87046522897a570d5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a369266c24eacffb87046522897a570d5">_GNU_SOURCE</a>&#160;&#160;&#160;/* for setgroups(), pthread_setname_np() */</td></tr>
<tr class="separator:a369266c24eacffb87046522897a570d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cdbd4d0545340d33dfe595811475ccd" id="r_a0cdbd4d0545340d33dfe595811475ccd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0cdbd4d0545340d33dfe595811475ccd">_LARGEFILE_SOURCE</a>&#160;&#160;&#160;/* For fseeko(), ftello() */</td></tr>
<tr class="separator:a0cdbd4d0545340d33dfe595811475ccd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44d01ba0a136b8e27ad362f5a823d14e" id="r_a44d01ba0a136b8e27ad362f5a823d14e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a44d01ba0a136b8e27ad362f5a823d14e">_FILE_OFFSET_BITS</a>&#160;&#160;&#160;64 /* Use 64-bit file offsets by default */</td></tr>
<tr class="separator:a44d01ba0a136b8e27ad362f5a823d14e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacbb9e1f38be71e22df1584a37c56693" id="r_aacbb9e1f38be71e22df1584a37c56693"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aacbb9e1f38be71e22df1584a37c56693">__STDC_FORMAT_MACROS</a>&#160;&#160;&#160;/* &lt;inttypes.h&gt; wants this for C++ */</td></tr>
<tr class="separator:aacbb9e1f38be71e22df1584a37c56693"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb7e7a856ab7a794b05b6b63ef36ea3e" id="r_aeb7e7a856ab7a794b05b6b63ef36ea3e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeb7e7a856ab7a794b05b6b63ef36ea3e">__STDC_LIMIT_MACROS</a>&#160;&#160;&#160;/* C++ wants that for <a class="el" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a> */</td></tr>
<tr class="separator:aeb7e7a856ab7a794b05b6b63ef36ea3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9957270f5cc62e546073406dd1ec640d" id="r_a9957270f5cc62e546073406dd1ec640d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9957270f5cc62e546073406dd1ec640d">_DARWIN_UNLIMITED_SELECT</a></td></tr>
<tr class="separator:a9957270f5cc62e546073406dd1ec640d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd1c48d7de09ccd680c843a8c34551a2" id="r_abd1c48d7de09ccd680c843a8c34551a2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abd1c48d7de09ccd680c843a8c34551a2">mg_static_assert</a>(<a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a24002c50a108445d916457eb3c21d5e1">cond</a>,  txt)&#160;&#160;&#160;	extern char <a class="el" href="#a0553b9f90d6c0d22c73cf05ffe81b708">static_assert_replacement</a>[(<a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a24002c50a108445d916457eb3c21d5e1">cond</a>) ? 1 : -1]</td></tr>
<tr class="separator:abd1c48d7de09ccd680c843a8c34551a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f690ac9e6a0d59b505f52edc10a6321" id="r_a8f690ac9e6a0d59b505f52edc10a6321"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8f690ac9e6a0d59b505f52edc10a6321">NO_ALTERNATIVE_QUEUE</a></td></tr>
<tr class="separator:a8f690ac9e6a0d59b505f52edc10a6321"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7bef5d85e3dcd73eef56ad39ffc84a9" id="r_ac7bef5d85e3dcd73eef56ad39ffc84a9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac7bef5d85e3dcd73eef56ad39ffc84a9">WIN32_LEAN_AND_MEAN</a></td></tr>
<tr class="separator:ac7bef5d85e3dcd73eef56ad39ffc84a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98f6ecefbf7613a2478356d30af16020" id="r_a98f6ecefbf7613a2478356d30af16020"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(fmt, ...)</td></tr>
<tr class="separator:a98f6ecefbf7613a2478356d30af16020"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5687826f07a383abedc6329b6a07f40b" id="r_a5687826f07a383abedc6329b6a07f40b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(<a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a24002c50a108445d916457eb3c21d5e1">cond</a>)</td></tr>
<tr class="separator:a5687826f07a383abedc6329b6a07f40b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad78a7b8419e5ec9f2cc7d310fcf142d7" id="r_ad78a7b8419e5ec9f2cc7d310fcf142d7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad78a7b8419e5ec9f2cc7d310fcf142d7">IGNORE_UNUSED_RESULT</a>(<a class="el" href="classa.html">a</a>)&#160;&#160;&#160;((void)((<a class="el" href="classa.html">a</a>) &amp;&amp; 1))</td></tr>
<tr class="separator:ad78a7b8419e5ec9f2cc7d310fcf142d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a93d2e02678a8ce969395e383cdd3e0" id="r_a4a93d2e02678a8ce969395e383cdd3e0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a></td></tr>
<tr class="separator:a4a93d2e02678a8ce969395e383cdd3e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accab0bdb9395175c8b0f2565d2f862b5" id="r_accab0bdb9395175c8b0f2565d2f862b5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#accab0bdb9395175c8b0f2565d2f862b5">ERROR_TRY_AGAIN</a>(err)&#160;&#160;&#160;	(((err) == EAGAIN) || ((err) == EWOULDBLOCK) || ((err) == EINTR))</td></tr>
<tr class="separator:accab0bdb9395175c8b0f2565d2f862b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1617828178ff1b5df926d7f469288d3e" id="r_a1617828178ff1b5df926d7f469288d3e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1617828178ff1b5df926d7f469288d3e">MAX_WORKER_THREADS</a>&#160;&#160;&#160;(1024 * 64) /* in threads (count) */</td></tr>
<tr class="separator:a1617828178ff1b5df926d7f469288d3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd345577a07dba9941d4cea32b4cf4fd" id="r_abd345577a07dba9941d4cea32b4cf4fd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abd345577a07dba9941d4cea32b4cf4fd">SOCKET_TIMEOUT_QUANTUM</a>&#160;&#160;&#160;(2000) /* in ms */</td></tr>
<tr class="separator:abd345577a07dba9941d4cea32b4cf4fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58e208228ea8cec229167dac0e1d1d84" id="r_a58e208228ea8cec229167dac0e1d1d84"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a58e208228ea8cec229167dac0e1d1d84">MG_FILE_COMPRESSION_SIZE_LIMIT</a>&#160;&#160;&#160;(1024) /* in bytes */</td></tr>
<tr class="separator:a58e208228ea8cec229167dac0e1d1d84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3e3c69dd6791a2c441b5352743750a6" id="r_af3e3c69dd6791a2c441b5352743750a6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af3e3c69dd6791a2c441b5352743750a6">PASSWORDS_FILE_NAME</a>&#160;&#160;&#160;&quot;.htpasswd&quot;</td></tr>
<tr class="separator:af3e3c69dd6791a2c441b5352743750a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53644ae929eff6501de3e13fb3bd2946" id="r_a53644ae929eff6501de3e13fb3bd2946"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a53644ae929eff6501de3e13fb3bd2946">CGI_ENVIRONMENT_SIZE</a>&#160;&#160;&#160;(4096) /* in bytes */</td></tr>
<tr class="separator:a53644ae929eff6501de3e13fb3bd2946"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa127b5e878621ba653b669c8be6318b1" id="r_aa127b5e878621ba653b669c8be6318b1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa127b5e878621ba653b669c8be6318b1">MAX_CGI_ENVIR_VARS</a>&#160;&#160;&#160;(256) /* in variables (count) */</td></tr>
<tr class="separator:aa127b5e878621ba653b669c8be6318b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac22a8a822b8728d8cd7e2718749f3ca4" id="r_ac22a8a822b8728d8cd7e2718749f3ca4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>&#160;&#160;&#160;(1024 * 8)</td></tr>
<tr class="separator:ac22a8a822b8728d8cd7e2718749f3ca4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70c57aae3eb654e205459b4362c8089a" id="r_a70c57aae3eb654e205459b4362c8089a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a70c57aae3eb654e205459b4362c8089a">ARRAY_SIZE</a>(array)&#160;&#160;&#160;(sizeof(array) / sizeof(array[0]))</td></tr>
<tr class="separator:a70c57aae3eb654e205459b4362c8089a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0d744f05898e32d01f73f8af3cd2071" id="r_ad0d744f05898e32d01f73f8af3cd2071"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a>&#160;&#160;&#160;(9223372036854775807)</td></tr>
<tr class="separator:ad0d744f05898e32d01f73f8af3cd2071"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60793c387a9db2a9d40125091a080801" id="r_a60793c387a9db2a9d40125091a080801"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a60793c387a9db2a9d40125091a080801">SHUTDOWN_RD</a>&#160;&#160;&#160;(0)</td></tr>
<tr class="separator:a60793c387a9db2a9d40125091a080801"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac937c233d930a34c3f5fc66e8a5843c2" id="r_ac937c233d930a34c3f5fc66e8a5843c2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac937c233d930a34c3f5fc66e8a5843c2">SHUTDOWN_WR</a>&#160;&#160;&#160;(1)</td></tr>
<tr class="separator:ac937c233d930a34c3f5fc66e8a5843c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfe712fddd648f222bf6986d90b9b996" id="r_abfe712fddd648f222bf6986d90b9b996"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abfe712fddd648f222bf6986d90b9b996">SHUTDOWN_BOTH</a>&#160;&#160;&#160;(2)</td></tr>
<tr class="separator:abfe712fddd648f222bf6986d90b9b996"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a78f968a579c967c2bb097b9e64749f" id="r_a7a78f968a579c967c2bb097b9e64749f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>&#160;&#160;&#160;(<a class="el" href="vendor_2civetweb_2main_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>)</td></tr>
<tr class="separator:a7a78f968a579c967c2bb097b9e64749f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a095b3b42df21f6e5d4377e299da56a79" id="r_a095b3b42df21f6e5d4377e299da56a79"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a095b3b42df21f6e5d4377e299da56a79">vsnprintf_impl</a>&#160;&#160;&#160;vsnprintf</td></tr>
<tr class="separator:a095b3b42df21f6e5d4377e299da56a79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9822f5260f90216b615dd7435274a83a" id="r_a9822f5260f90216b615dd7435274a83a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9822f5260f90216b615dd7435274a83a">SSL_LIB</a>&#160;&#160;&#160;&quot;libssl.so&quot;</td></tr>
<tr class="separator:a9822f5260f90216b615dd7435274a83a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52cf22e0f16c8a5c8c60788eec654e30" id="r_a52cf22e0f16c8a5c8c60788eec654e30"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a52cf22e0f16c8a5c8c60788eec654e30">CRYPTO_LIB</a>&#160;&#160;&#160;&quot;libcrypto.so&quot;</td></tr>
<tr class="separator:a52cf22e0f16c8a5c8c60788eec654e30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36fa9b2e726512bc17a7a6d3e39002be" id="r_a36fa9b2e726512bc17a7a6d3e39002be"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>&#160;&#160;&#160;(0)</td></tr>
<tr class="separator:a36fa9b2e726512bc17a7a6d3e39002be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d96b607aca31a2236372e56ffb72112" id="r_a3d96b607aca31a2236372e56ffb72112"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(<a class="el" href="classa.html">a</a>)&#160;&#160;&#160;(close(<a class="el" href="classa.html">a</a>))</td></tr>
<tr class="separator:a3d96b607aca31a2236372e56ffb72112"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a756d12537962d25f9c69aaa1a319b10a" id="r_a756d12537962d25f9c69aaa1a319b10a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a756d12537962d25f9c69aaa1a319b10a">mg_mkdir</a>(conn,  path,  mode)&#160;&#160;&#160;(mkdir(path, mode))</td></tr>
<tr class="separator:a756d12537962d25f9c69aaa1a319b10a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b7e572b06c0a0d1c920572523fbe01d" id="r_a3b7e572b06c0a0d1c920572523fbe01d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3b7e572b06c0a0d1c920572523fbe01d">mg_remove</a>(conn,  x)&#160;&#160;&#160;(remove(x))</td></tr>
<tr class="separator:a3b7e572b06c0a0d1c920572523fbe01d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1af7c8ef16047616b5bee88aeee10d6" id="r_af1af7c8ef16047616b5bee88aeee10d6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af1af7c8ef16047616b5bee88aeee10d6">mg_sleep</a>(x)&#160;&#160;&#160;(usleep((x)*1000))</td></tr>
<tr class="separator:af1af7c8ef16047616b5bee88aeee10d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ff1ea4e3e6c59f0e144bd91366fe2d9" id="r_a1ff1ea4e3e6c59f0e144bd91366fe2d9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1ff1ea4e3e6c59f0e144bd91366fe2d9">mg_opendir</a>(conn,  x)&#160;&#160;&#160;(opendir(x))</td></tr>
<tr class="separator:a1ff1ea4e3e6c59f0e144bd91366fe2d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b5e30d60439015dee1c473ebc4f4ce9" id="r_a2b5e30d60439015dee1c473ebc4f4ce9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2b5e30d60439015dee1c473ebc4f4ce9">mg_closedir</a>(x)&#160;&#160;&#160;(closedir(x))</td></tr>
<tr class="separator:a2b5e30d60439015dee1c473ebc4f4ce9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0387536c403dfeff474b0bb940156908" id="r_a0387536c403dfeff474b0bb940156908"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0387536c403dfeff474b0bb940156908">mg_readdir</a>(x)&#160;&#160;&#160;(readdir(x))</td></tr>
<tr class="separator:a0387536c403dfeff474b0bb940156908"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a830e27de72e8bab8bc80eafebd657e" id="r_a3a830e27de72e8bab8bc80eafebd657e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>&#160;&#160;&#160;(errno)</td></tr>
<tr class="separator:a3a830e27de72e8bab8bc80eafebd657e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26769957ec1a2beaf223f33b66ee64ab" id="r_a26769957ec1a2beaf223f33b66ee64ab"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>&#160;&#160;&#160;(-1)</td></tr>
<tr class="separator:a26769957ec1a2beaf223f33b66ee64ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57e353d6ce48ab7d414d094961d5e474" id="r_a57e353d6ce48ab7d414d094961d5e474"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a>&#160;&#160;&#160;PRId64</td></tr>
<tr class="separator:a57e353d6ce48ab7d414d094961d5e474"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21ef7c3a4e9f99f62cf64329f965d2ed" id="r_a21ef7c3a4e9f99f62cf64329f965d2ed"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a21ef7c3a4e9f99f62cf64329f965d2ed">UINT64_FMT</a>&#160;&#160;&#160;PRIu64</td></tr>
<tr class="separator:a21ef7c3a4e9f99f62cf64329f965d2ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4581abb02e8798a73171df79524b994" id="r_ad4581abb02e8798a73171df79524b994"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad4581abb02e8798a73171df79524b994">WINCDECL</a></td></tr>
<tr class="separator:ad4581abb02e8798a73171df79524b994"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac220e3a97f765b599bc532d6c3f4a755" id="r_ac220e3a97f765b599bc532d6c3f4a755"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a>&#160;&#160;&#160;pollfd</td></tr>
<tr class="separator:ac220e3a97f765b599bc532d6c3f4a755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5936237ef8db6bc39470efaef9d151d" id="r_ad5936237ef8db6bc39470efaef9d151d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad5936237ef8db6bc39470efaef9d151d">va_copy</a>(x,  y)&#160;&#160;&#160;((x) = (y))</td></tr>
<tr class="separator:ad5936237ef8db6bc39470efaef9d151d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09f3709fc72c7edf208c75ccbe3d997b" id="r_a09f3709fc72c7edf208c75ccbe3d997b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(<a class="el" href="classa.html">a</a>,  c)&#160;&#160;&#160;<a class="el" href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a>(<a class="el" href="classa.html">a</a>)</td></tr>
<tr class="separator:a09f3709fc72c7edf208c75ccbe3d997b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29f85c2d195a7eb5893fdd101383681b" id="r_a29f85c2d195a7eb5893fdd101383681b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a29f85c2d195a7eb5893fdd101383681b">mg_calloc_ctx</a>(<a class="el" href="classa.html">a</a>,  b,  c)&#160;&#160;&#160;<a class="el" href="#ad3552193bd019b58e092032223ac38f1">mg_calloc</a>(<a class="el" href="classa.html">a</a>, b)</td></tr>
<tr class="separator:a29f85c2d195a7eb5893fdd101383681b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab36230fc0a06484369ac2dc5331260f4" id="r_ab36230fc0a06484369ac2dc5331260f4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab36230fc0a06484369ac2dc5331260f4">mg_realloc_ctx</a>(<a class="el" href="classa.html">a</a>,  b,  c)&#160;&#160;&#160;<a class="el" href="#a5185c288b713841c3c37118b5028bb42">mg_realloc</a>(<a class="el" href="classa.html">a</a>, b)</td></tr>
<tr class="separator:ab36230fc0a06484369ac2dc5331260f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12b89ebf78a150d64629559c322ea661" id="r_a12b89ebf78a150d64629559c322ea661"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a12b89ebf78a150d64629559c322ea661">mg_free_ctx</a>(<a class="el" href="classa.html">a</a>,  c)&#160;&#160;&#160;<a class="el" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(<a class="el" href="classa.html">a</a>)</td></tr>
<tr class="separator:a12b89ebf78a150d64629559c322ea661"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf143577800376dd931c059ecc61ba06" id="r_acf143577800376dd931c059ecc61ba06"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acf143577800376dd931c059ecc61ba06">malloc</a>&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_malloc</td></tr>
<tr class="separator:acf143577800376dd931c059ecc61ba06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84beef8cc122add35118ec7cd35286c4" id="r_a84beef8cc122add35118ec7cd35286c4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a84beef8cc122add35118ec7cd35286c4">calloc</a>&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_calloc</td></tr>
<tr class="separator:a84beef8cc122add35118ec7cd35286c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b739878adcdb46fb5d209af7ce79628" id="r_a1b739878adcdb46fb5d209af7ce79628"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1b739878adcdb46fb5d209af7ce79628">realloc</a>&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_realloc</td></tr>
<tr class="separator:a1b739878adcdb46fb5d209af7ce79628"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c6efa7679f8cd9f61af96e105017560" id="r_a2c6efa7679f8cd9f61af96e105017560"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2c6efa7679f8cd9f61af96e105017560">free</a>&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_free</td></tr>
<tr class="separator:a2c6efa7679f8cd9f61af96e105017560"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa367b75c5aed883fef5befbdf04835a4" id="r_aa367b75c5aed883fef5befbdf04835a4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_snprintf</td></tr>
<tr class="separator:aa367b75c5aed883fef5befbdf04835a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae03595c4f38ae34148fb498a6e55418d" id="r_ae03595c4f38ae34148fb498a6e55418d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae03595c4f38ae34148fb498a6e55418d">MD5_STATIC</a>&#160;&#160;&#160;static</td></tr>
<tr class="separator:ae03595c4f38ae34148fb498a6e55418d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0563a85b179703339cbf223e7e1c0454" id="r_a0563a85b179703339cbf223e7e1c0454"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0563a85b179703339cbf223e7e1c0454">IP_ADDR_STR_LEN</a>&#160;&#160;&#160;(50) /* IPv6 hex string <a class="el" href="classis.html">is</a> 46 chars */</td></tr>
<tr class="separator:a0563a85b179703339cbf223e7e1c0454"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f55d0e90dc8cc6b2287312435cdde48" id="r_a9f55d0e90dc8cc6b2287312435cdde48"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9f55d0e90dc8cc6b2287312435cdde48">MSG_NOSIGNAL</a>&#160;&#160;&#160;(0)</td></tr>
<tr class="separator:a9f55d0e90dc8cc6b2287312435cdde48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58f28d0739c8e6a66ffce338daef408c" id="r_a58f28d0739c8e6a66ffce338daef408c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a58f28d0739c8e6a66ffce338daef408c">USA_IN_PORT_UNSAFE</a>(<a class="el" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>)&#160;&#160;&#160;((<a class="el" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>)-&gt;sin.sin_port)</td></tr>
<tr class="separator:a58f28d0739c8e6a66ffce338daef408c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7932a261d02cf4b8431793664a4585b" id="r_af7932a261d02cf4b8431793664a4585b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a></td></tr>
<tr class="separator:af7932a261d02cf4b8431793664a4585b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42c400d6feb7aa0de4280b0cf1c63fcc" id="r_a42c400d6feb7aa0de4280b0cf1c63fcc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(f)&#160;&#160;&#160;((*(f)) == 0)</td></tr>
<tr class="separator:a42c400d6feb7aa0de4280b0cf1c63fcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a888e9186b73dca8fe7e2fe2e4a37b392" id="r_a888e9186b73dca8fe7e2fe2e4a37b392"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a888e9186b73dca8fe7e2fe2e4a37b392">STOP_FLAG_IS_TWO</a>(f)&#160;&#160;&#160;((*(f)) == 2)</td></tr>
<tr class="separator:a888e9186b73dca8fe7e2fe2e4a37b392"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5cd88c4a6b9186f77507c50a6ae6625f" id="r_a5cd88c4a6b9186f77507c50a6ae6625f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5cd88c4a6b9186f77507c50a6ae6625f">STOP_FLAG_ASSIGN</a>(f,  v)&#160;&#160;&#160;((*(f)) = (v))</td></tr>
<tr class="separator:a5cd88c4a6b9186f77507c50a6ae6625f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec63256a14a3c1f92d2b8e01a466f718" id="r_aec63256a14a3c1f92d2b8e01a466f718"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aec63256a14a3c1f92d2b8e01a466f718">NUM_WEBDAV_LOCKS</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:aec63256a14a3c1f92d2b8e01a466f718"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1531c1b87bf00f94782d1d45f2942803" id="r_a1531c1b87bf00f94782d1d45f2942803"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1531c1b87bf00f94782d1d45f2942803">LOCK_DURATION_S</a>&#160;&#160;&#160;60</td></tr>
<tr class="separator:a1531c1b87bf00f94782d1d45f2942803"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c82560e32fee25bd5f05767a625fa77" id="r_a9c82560e32fee25bd5f05767a625fa77"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,  fmt, ...)&#160;&#160;&#160;	<a class="el" href="#a148db84e7bdb695f1a072e0b5997fac5">mg_cry_internal_wrap</a>(conn, <a class="el" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, __func__, __LINE__, fmt, __VA_ARGS__)</td></tr>
<tr class="separator:a9c82560e32fee25bd5f05767a625fa77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ddc04f3556f50ae9cf6ec670c441c4b" id="r_a1ddc04f3556f50ae9cf6ec670c441c4b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,  fmt, ...)&#160;&#160;&#160;	<a class="el" href="#a148db84e7bdb695f1a072e0b5997fac5">mg_cry_internal_wrap</a>(<a class="el" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ctx, __func__, __LINE__, fmt, __VA_ARGS__)</td></tr>
<tr class="separator:a1ddc04f3556f50ae9cf6ec670c441c4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6f5b37a1a1289e74e6563d530768d06" id="r_ad6f5b37a1a1289e74e6563d530768d06"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad6f5b37a1a1289e74e6563d530768d06">MG_FOPEN_MODE_NONE</a>&#160;&#160;&#160;(0)</td></tr>
<tr class="separator:ad6f5b37a1a1289e74e6563d530768d06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bd58793b81cca07589b297470992a9e" id="r_a5bd58793b81cca07589b297470992a9e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>&#160;&#160;&#160;(1)</td></tr>
<tr class="separator:a5bd58793b81cca07589b297470992a9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb547e0027f87aeb69575479967c1f5f" id="r_abb547e0027f87aeb69575479967c1f5f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abb547e0027f87aeb69575479967c1f5f">MG_FOPEN_MODE_WRITE</a>&#160;&#160;&#160;(2)</td></tr>
<tr class="separator:abb547e0027f87aeb69575479967c1f5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88232e9595ccceb9a04b106cc6d2739c" id="r_a88232e9595ccceb9a04b106cc6d2739c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a88232e9595ccceb9a04b106cc6d2739c">MG_FOPEN_MODE_APPEND</a>&#160;&#160;&#160;(4)</td></tr>
<tr class="separator:a88232e9595ccceb9a04b106cc6d2739c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a538a838c27a50aa0d4cb745ac68f7f5b" id="r_a538a838c27a50aa0d4cb745ac68f7f5b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a538a838c27a50aa0d4cb745ac68f7f5b">mg_get_option</a>&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION_INTERNALLY__access_directly</td></tr>
<tr class="separator:a538a838c27a50aa0d4cb745ac68f7f5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff51e0adb3dd4b1eca47676abb226c2c" id="r_aff51e0adb3dd4b1eca47676abb226c2c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aff51e0adb3dd4b1eca47676abb226c2c">mg_cry</a>&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_cry_internal</td></tr>
<tr class="separator:aff51e0adb3dd4b1eca47676abb226c2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acda7cfeae2b1fbd50730709088e7da95" id="r_acda7cfeae2b1fbd50730709088e7da95"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acda7cfeae2b1fbd50730709088e7da95">HTTP1_only</a></td></tr>
<tr class="separator:acda7cfeae2b1fbd50730709088e7da95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09ca1005ef34aa3b14445f325c532873" id="r_a09ca1005ef34aa3b14445f325c532873"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a09ca1005ef34aa3b14445f325c532873">HEXTOI</a>(x)&#160;&#160;&#160;(isdigit(x) ? (x - '0') : (x - 'W'))</td></tr>
<tr class="separator:a09ca1005ef34aa3b14445f325c532873"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae64a0edac6e82db7aa05b2d574e4a015" id="r_ae64a0edac6e82db7aa05b2d574e4a015"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae64a0edac6e82db7aa05b2d574e4a015">INITIAL_DEPTH</a>&#160;&#160;&#160;9</td></tr>
<tr class="separator:ae64a0edac6e82db7aa05b2d574e4a015"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a1bbb7024f8dda275a22cdc1df0527224" id="r_a1bbb7024f8dda275a22cdc1df0527224"><td class="memItemLeft" align="right" valign="top">typedef const void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1bbb7024f8dda275a22cdc1df0527224">SOCK_OPT_TYPE</a></td></tr>
<tr class="separator:a1bbb7024f8dda275a22cdc1df0527224"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8dc8083897335125630f1af5dafd5831" id="r_a8dc8083897335125630f1af5dafd5831"><td class="memItemLeft" align="right" valign="top">typedef int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a></td></tr>
<tr class="separator:a8dc8083897335125630f1af5dafd5831"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac751248c6cb5f0bce10051d41a22d964" id="r_ac751248c6cb5f0bce10051d41a22d964"><td class="memItemLeft" align="right" valign="top">typedef int volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac751248c6cb5f0bce10051d41a22d964">stop_flag_t</a></td></tr>
<tr class="separator:ac751248c6cb5f0bce10051d41a22d964"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a06fc87d81c62e9abb8790b6e5713c55b" id="r_a06fc87d81c62e9abb8790b6e5713c55b"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e">LISTENING_PORTS</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baa818676aedda10c1d780a84133662831">NUM_THREADS</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba2273c8f628cf101bc49496219571b0c4">RUN_AS_USER</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55bae7af9fa992c8547645bac2ca940153b0">CONFIG_TCP_NODELAY</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5">MAX_REQUEST_SIZE</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba6e6c7723fb9a76f3d7afde265e782141">LINGER_TIMEOUT</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3">CONNECTION_QUEUE_SIZE</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baf13327a7aed89d59cc7e4200d088f205">LISTEN_BACKLOG_SIZE</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba73fe0376eae56e950136313f635836e2">THROTTLE</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba39a8b8c4df6154e815a5a49da528ce5c">ENABLE_KEEP_ALIVE</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba79dc6ec73a693de1fbe2397ce42af360">KEEP_ALIVE_TIMEOUT</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baa7da030a4d709729f351258b77fad121">DECODE_URL</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baf20363ab43e572880dc69d8fe634c114">DECODE_QUERY_STRING</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55bac3c40480ddeeae7beeed79fc399329e3">ACCESS_LOG_FILE</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba66ac785400448f574aa25e2943f3a854">ERROR_LOG_FILE</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba850b5c3820657d2b3a4d5a07c7c02616">CGI_ENVIRONMENT</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baed83717b03766bd7c931b4e2fbae3384">CGI_INTERPRETER</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba3bdbf4db41e054e3f6c087b4299c66c0">CGI_INTERPRETER_ARGS</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55babb844e7f11a02780ac6a94b3b4dd754d">CGI_BUFFERING</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba5d225462bc3b0836805df00f580cb7ea">CGI2_EXTENSIONS</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55bab6b21529583f9a7dc58484925b8babe8">CGI2_ENVIRONMENT</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baf64cc929494eda240d914b67c0b1f9e9">CGI2_INTERPRETER</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba68a38509add8b770910afaf010696277">CGI2_INTERPRETER_ARGS</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba2e5da0c85d9043e7e4404fdc0e2787a6">CGI2_BUFFERING</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba9f0c9561bdb0b2b975178617c8d3c59a">PUT_DELETE_PASSWORDS_FILE</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55bac05d91b095136909d3bb88f857770b34">PROTECT_URI</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baa196eb33164714d8b04ace074a72c492">ENABLE_AUTH_DOMAIN_CHECK</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55bad759d92bd3b0e4870bb7d92ad10399b4">SSI_EXTENSIONS</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba00459f3ca65ce96fa33c3d5230624328">ENABLE_DIRECTORY_LISTING</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba5dc474ce23af919313afd42d5610bc05">ENABLE_WEBDAV</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba0d86924aee1330b50c85079ae6ff8032">GLOBAL_PASSWORDS_FILE</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55bafa9f4efa175d81e138ff3aa53aa00930">INDEX_FILES</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba3afb385e81857461e2860a6bc661020c">ACCESS_CONTROL_LIST</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55bafe5280fd7fcd9876652bc64790c74c23">EXTRA_MIME_TYPES</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba1bb8ebf1124ab1bb589866f06e54e71f">SSL_CERTIFICATE</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baacb7b39407a541fbda68aafd33193470">SSL_CERTIFICATE_CHAIN</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba73b1fb0778577d79d9a9906538f397b7">URL_REWRITE_PATTERN</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba661e684fd980c2be1848413e1ec8fe35">HIDE_FILES</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac">SSL_DO_VERIFY_PEER</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba359ab5a360678365c390cba52eef08ba">SSL_CACHE_TIMEOUT</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba3e3b29034498dd70486ada574bcd4d6d">SSL_CA_PATH</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baeae84e3e129de97ee8fdad5fd628683f">SSL_CA_FILE</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba1707f77739201a2e6bd9c894c473a244">SSL_VERIFY_DEPTH</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba5965f9b2d16d3989a9a8411486e8dd08">SSL_DEFAULT_VERIFY_PATHS</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba78ec09de569b58d0a71425ee91b02f44">SSL_CIPHER_LIST</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba1997d8cac42e06e1a65c2da6e80f9706">SSL_PROTOCOL_VERSION</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba03662ada095078ef2ebd1d7c624e0b5f">SSL_SHORT_TRUST</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba18505d55559e2f7fee94e1ec4f1361d0">ACCESS_CONTROL_ALLOW_ORIGIN</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba6369d07e303c71b53dbc62f42bf4ebe2">ACCESS_CONTROL_ALLOW_METHODS</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba43c2119bd7a41e72316c4fd26c3eaa70">ACCESS_CONTROL_ALLOW_HEADERS</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba80a0b839f2bfedfe7e973a0e1211a6d6">ERROR_PAGES</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba6b580243dfe971149cd10cfa449369ac">STATIC_FILE_MAX_AGE</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba806e32a13c862b980a792a2183c5cb2d">STATIC_FILE_CACHE_CONTROL</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba64a313cf2fe6e0540cf30467a3ab7789">STRICT_HTTPS_MAX_AGE</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba154fd2c7788b97dd4ea040e669a4cd1d">ADDITIONAL_HEADER</a>
, <a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55ba2b3396fe44b8e2601349457d7357f6cc">ALLOW_INDEX_SCRIPT_SUB_RES</a>
, <br />
&#160;&#160;<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baa287c83808b815cdf6a1c2756b6332f1">NUM_OPTIONS</a>
<br />
 }</td></tr>
<tr class="separator:a06fc87d81c62e9abb8790b6e5713c55b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf764cbdea00d65edcd07bb9953ad2b7" id="r_adf764cbdea00d65edcd07bb9953ad2b7"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a>
, <a class="el" href="#adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484">WEBSOCKET_HANDLER</a>
, <a class="el" href="#adf764cbdea00d65edcd07bb9953ad2b7a8617f4f76318f5c524016c5bc6fa864c">AUTH_HANDLER</a>
 }</td></tr>
<tr class="separator:adf764cbdea00d65edcd07bb9953ad2b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99fb83031ce9923c84392b4e92f956b5" id="r_a99fb83031ce9923c84392b4e92f956b5"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="#a99fb83031ce9923c84392b4e92f956b5a345625fe7dc0282d2fa4cc35cd820fb2">CONTEXT_INVALID</a>
, <a class="el" href="#a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099">CONTEXT_SERVER</a>
, <a class="el" href="#a99fb83031ce9923c84392b4e92f956b5ac5e9108e1a7588fe9429108516575440">CONTEXT_HTTP_CLIENT</a>
, <a class="el" href="#a99fb83031ce9923c84392b4e92f956b5a03e63e1c82cfb5e937a777e71c4a40f2">CONTEXT_WS_CLIENT</a>
 }</td></tr>
<tr class="separator:a99fb83031ce9923c84392b4e92f956b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc6126af1d45847bc59afa0aa3216b04" id="r_abc6126af1d45847bc59afa0aa3216b04"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04ad728da0f171f49e9778426365c03eef1">CONNECTION_TYPE_INVALID</a> = 0
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a> = 1
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411">CONNECTION_TYPE_RESPONSE</a> = 2
 }</td></tr>
<tr class="separator:abc6126af1d45847bc59afa0aa3216b04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc29c2ff13d900c2f185ee95427fb06c" id="r_adc29c2ff13d900c2f185ee95427fb06c"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a> = 0
, <a class="el" href="#adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436">PROTOCOL_TYPE_WEBSOCKET</a> = 1
, <a class="el" href="#adc29c2ff13d900c2f185ee95427fb06ca3c3663fdf461dc9873cadc4a36b3a139">PROTOCOL_TYPE_HTTP2</a> = 2
 }</td></tr>
<tr class="separator:adc29c2ff13d900c2f185ee95427fb06c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88a19edecab59a12f954e82f9405b080" id="r_a88a19edecab59a12f954e82f9405b080"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a88a19edecab59a12f954e82f9405b080">mg_static_assert</a> (sizeof(int)==4||sizeof(int)==8, &quot;int data type size check&quot;)</td></tr>
<tr class="separator:a88a19edecab59a12f954e82f9405b080"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe86da572c0da272c1707d5f19b45efe" id="r_afe86da572c0da272c1707d5f19b45efe"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe86da572c0da272c1707d5f19b45efe">mg_static_assert</a> (sizeof(void *)==4||sizeof(void *)==8, &quot;pointer data type size check&quot;)</td></tr>
<tr class="separator:afe86da572c0da272c1707d5f19b45efe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cfeaae2f6971bd83dd50106848e0b50" id="r_a7cfeaae2f6971bd83dd50106848e0b50"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7cfeaae2f6971bd83dd50106848e0b50">mg_static_assert</a> (sizeof(void *) &gt;=sizeof(int), &quot;data type size check&quot;)</td></tr>
<tr class="separator:a7cfeaae2f6971bd83dd50106848e0b50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab61f16184c342680b3b020076b50270a" id="r_ab61f16184c342680b3b020076b50270a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab61f16184c342680b3b020076b50270a">mg_static_assert</a> (<a class="el" href="#a1617828178ff1b5df926d7f469288d3e">MAX_WORKER_THREADS</a> &gt;=1, &quot;worker threads must be <a class="el" href="classa.html">a</a> positive number&quot;)</td></tr>
<tr class="separator:ab61f16184c342680b3b020076b50270a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a901c5ff0ac86e7662428a76c1623c030" id="r_a901c5ff0ac86e7662428a76c1623c030"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a901c5ff0ac86e7662428a76c1623c030">mg_static_assert</a> (sizeof(size_t)==4||sizeof(size_t)==8, &quot;size_t data type size check&quot;)</td></tr>
<tr class="separator:a901c5ff0ac86e7662428a76c1623c030"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9c2267422f7bd2de7c610a4e0eb8fb0" id="r_af9c2267422f7bd2de7c610a4e0eb8fb0"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af9c2267422f7bd2de7c610a4e0eb8fb0">mg_global_lock</a> (void)</td></tr>
<tr class="separator:af9c2267422f7bd2de7c610a4e0eb8fb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8b5fc3bd1b6de9fe6137e7daea140ac" id="r_af8b5fc3bd1b6de9fe6137e7daea140ac"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af8b5fc3bd1b6de9fe6137e7daea140ac">mg_global_unlock</a> (void)</td></tr>
<tr class="separator:af8b5fc3bd1b6de9fe6137e7daea140ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac84429c87794be46b88e30fbd3b0bcfa" id="r_ac84429c87794be46b88e30fbd3b0bcfa"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> ptrdiff_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac84429c87794be46b88e30fbd3b0bcfa">mg_atomic_inc</a> (volatile ptrdiff_t *addr)</td></tr>
<tr class="separator:ac84429c87794be46b88e30fbd3b0bcfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68810f97aa216df1fa96103dec93fca3" id="r_a68810f97aa216df1fa96103dec93fca3"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> ptrdiff_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a68810f97aa216df1fa96103dec93fca3">mg_atomic_dec</a> (volatile ptrdiff_t *addr)</td></tr>
<tr class="separator:a68810f97aa216df1fa96103dec93fca3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31c4ed6838b7bb49804a5ffa030762e5" id="r_a31c4ed6838b7bb49804a5ffa030762e5"><td class="memItemLeft" align="right" valign="top">static __inline void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a> (size_t <a class="el" href="classa.html">a</a>)</td></tr>
<tr class="separator:a31c4ed6838b7bb49804a5ffa030762e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3552193bd019b58e092032223ac38f1" id="r_ad3552193bd019b58e092032223ac38f1"><td class="memItemLeft" align="right" valign="top">static __inline void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad3552193bd019b58e092032223ac38f1">mg_calloc</a> (size_t <a class="el" href="classa.html">a</a>, size_t b)</td></tr>
<tr class="separator:ad3552193bd019b58e092032223ac38f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5185c288b713841c3c37118b5028bb42" id="r_a5185c288b713841c3c37118b5028bb42"><td class="memItemLeft" align="right" valign="top">static __inline void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5185c288b713841c3c37118b5028bb42">mg_realloc</a> (void *<a class="el" href="classa.html">a</a>, size_t b)</td></tr>
<tr class="separator:a5185c288b713841c3c37118b5028bb42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc85e6b6e1bec856e91dc0346f49d9da" id="r_adc85e6b6e1bec856e91dc0346f49d9da"><td class="memItemLeft" align="right" valign="top">static __inline void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a> (void *<a class="el" href="classa.html">a</a>)</td></tr>
<tr class="separator:adc85e6b6e1bec856e91dc0346f49d9da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca9e6d65ed7802c47e4e3ef6413d8c39" id="r_aca9e6d65ed7802c47e4e3ef6413d8c39"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aca9e6d65ed7802c47e4e3ef6413d8c39">mg_vsnprintf</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, int *truncated, char *buf, size_t buflen, const char *fmt, va_list ap)</td></tr>
<tr class="separator:aca9e6d65ed7802c47e4e3ef6413d8c39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a847434a4a5f5ea7a1a1bca87625ccb81" id="r_a847434a4a5f5ea7a1a1bca87625ccb81"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, int *truncated, char *buf, size_t buflen, <a class="el" href="civetweb_8h.html#a2bb9db6ffe087ec4f44662ed3dfa0abd">PRINTF_FORMAT_STRING</a>(const char *fmt),...) <a class="el" href="civetweb_8h.html#aabeba45019b494e33206b4a3a9a8ba17">PRINTF_ARGS</a>(5</td></tr>
<tr class="separator:a847434a4a5f5ea7a1a1bca87625ccb81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4212925fe8cca547d2be85b99d8f7c56" id="r_a4212925fe8cca547d2be85b99d8f7c56"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4212925fe8cca547d2be85b99d8f7c56">mg_current_thread_id</a> (void)</td></tr>
<tr class="separator:a4212925fe8cca547d2be85b99d8f7c56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2040e14dfbc73e3fad6b7971613243ea" id="r_a2040e14dfbc73e3fad6b7971613243ea"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a> (void)</td></tr>
<tr class="separator:a2040e14dfbc73e3fad6b7971613243ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e1dd67c325872836c12a8bdc4bbd103" id="r_a8e1dd67c325872836c12a8bdc4bbd103"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e1dd67c325872836c12a8bdc4bbd103">mg_static_assert</a> ((sizeof(<a class="el" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>)/sizeof(<a class="el" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[0]))==(<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baa287c83808b815cdf6a1c2756b6332f1">NUM_OPTIONS</a>+1), &quot;config_options and enum not sync&quot;)</td></tr>
<tr class="separator:a8e1dd67c325872836c12a8bdc4bbd103"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a148db84e7bdb695f1a072e0b5997fac5" id="r_a148db84e7bdb695f1a072e0b5997fac5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a148db84e7bdb695f1a072e0b5997fac5">mg_cry_internal_wrap</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, const char *func, unsigned line, const char *fmt,...) <a class="el" href="civetweb_8h.html#aabeba45019b494e33206b4a3a9a8ba17">PRINTF_ARGS</a>(5</td></tr>
<tr class="separator:a148db84e7bdb695f1a072e0b5997fac5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c02435b9feed10fb546e874e85ecf83" id="r_a4c02435b9feed10fb546e874e85ecf83"><td class="memItemLeft" align="right" valign="top">static void static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4c02435b9feed10fb546e874e85ecf83">mg_set_thread_name</a> (const char *<a class="el" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr class="separator:a4c02435b9feed10fb546e874e85ecf83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86730990d410cecb18a1dbeee4ccd657" id="r_a86730990d410cecb18a1dbeee4ccd657"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const struct <a class="el" href="structmg__option.html">mg_option</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a86730990d410cecb18a1dbeee4ccd657">mg_get_valid_options</a> (void)</td></tr>
<tr class="separator:a86730990d410cecb18a1dbeee4ccd657"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabc2fa59339cbedec7cf5855e5e8e89c" id="r_aabc2fa59339cbedec7cf5855e5e8e89c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aabc2fa59339cbedec7cf5855e5e8e89c">is_file_opened</a> (const struct <a class="el" href="structmg__file__access.html">mg_file_access</a> *fileacc)</td></tr>
<tr class="separator:aabc2fa59339cbedec7cf5855e5e8e89c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97625a7b1941b770798e090232bdfb6f" id="r_a97625a7b1941b770798e090232bdfb6f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *filep)</td></tr>
<tr class="separator:a97625a7b1941b770798e090232bdfb6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11ef653a52d878a00eb3d51b73c966f5" id="r_a11ef653a52d878a00eb3d51b73c966f5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a11ef653a52d878a00eb3d51b73c966f5">mg_path_suspicious</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a11ef653a52d878a00eb3d51b73c966f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3341033fb439f4b1566fa8bc71f28e2b" id="r_a3341033fb439f4b1566fa8bc71f28e2b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, int mode, struct <a class="el" href="structmg__file.html">mg_file</a> *filep)</td></tr>
<tr class="separator:a3341033fb439f4b1566fa8bc71f28e2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada8ae98eea53a76bee149585c48beca3" id="r_ada8ae98eea53a76bee149585c48beca3"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a> (struct <a class="el" href="structmg__file__access.html">mg_file_access</a> *fileacc)</td></tr>
<tr class="separator:ada8ae98eea53a76bee149585c48beca3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0f8debaa123ea7820fa8345125e4235" id="r_ad0f8debaa123ea7820fa8345125e4235"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a> (char *dst, const char *src, size_t n)</td></tr>
<tr class="separator:ad0f8debaa123ea7820fa8345125e4235"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9682bb02df6aff4820e030d3c730872e" id="r_a9682bb02df6aff4820e030d3c730872e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9682bb02df6aff4820e030d3c730872e">lowercase</a> (const char *<a class="el" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>)</td></tr>
<tr class="separator:a9682bb02df6aff4820e030d3c730872e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e22e846cc0308d6521ed516918f380f" id="r_a1e22e846cc0308d6521ed516918f380f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a> (const char *s1, const char *s2, size_t len)</td></tr>
<tr class="separator:a1e22e846cc0308d6521ed516918f380f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d0ea93d3ec8a90e631f7e7f53d28628" id="r_a5d0ea93d3ec8a90e631f7e7f53d28628"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a> (const char *s1, const char *s2)</td></tr>
<tr class="separator:a5d0ea93d3ec8a90e631f7e7f53d28628"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20965905c9372c3755d872d0c740361b" id="r_a20965905c9372c3755d872d0c740361b"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a20965905c9372c3755d872d0c740361b">mg_strndup_ctx</a> (const char *ptr, size_t len, struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:a20965905c9372c3755d872d0c740361b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa30b97fc6c76000802e15129b3a1f48a" id="r_aa30b97fc6c76000802e15129b3a1f48a"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a> (const char *str, struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:aa30b97fc6c76000802e15129b3a1f48a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e6a5dc184d97ba5278dfda5b838f1cc" id="r_a4e6a5dc184d97ba5278dfda5b838f1cc"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4e6a5dc184d97ba5278dfda5b838f1cc">mg_strdup</a> (const char *str)</td></tr>
<tr class="separator:a4e6a5dc184d97ba5278dfda5b838f1cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a804c91443edc3fa4d74cfe88b1dd3ac8" id="r_a804c91443edc3fa4d74cfe88b1dd3ac8"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a804c91443edc3fa4d74cfe88b1dd3ac8">mg_strcasestr</a> (const char *big_str, const char *small_str)</td></tr>
<tr class="separator:a804c91443edc3fa4d74cfe88b1dd3ac8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f766591e7306dab15d063b9bf7c0839" id="r_a1f766591e7306dab15d063b9bf7c0839"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1f766591e7306dab15d063b9bf7c0839">mg_snprintf</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, int *truncated, char *buf, size_t buflen, const char *fmt,...)</td></tr>
<tr class="separator:a1f766591e7306dab15d063b9bf7c0839"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d2d84ca4d747d172e74257a176d216d" id="r_a4d2d84ca4d747d172e74257a176d216d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4d2d84ca4d747d172e74257a176d216d">get_option_index</a> (const char *<a class="el" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr class="separator:a4d2d84ca4d747d172e74257a176d216d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e4552bbdf9a0c9a6a579ed38e813a4e" id="r_a9e4552bbdf9a0c9a6a579ed38e813a4e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9e4552bbdf9a0c9a6a579ed38e813a4e">mg_get_option</a> (const struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, const char *<a class="el" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr class="separator:a9e4552bbdf9a0c9a6a579ed38e813a4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7377f2af53b0a3e0a154a2c186f2f2d4" id="r_a7377f2af53b0a3e0a154a2c186f2f2d4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__context.html">mg_context</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7377f2af53b0a3e0a154a2c186f2f2d4">mg_get_context</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a7377f2af53b0a3e0a154a2c186f2f2d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17a41b88e5484900a2d01cad3c8fec20" id="r_a17a41b88e5484900a2d01cad3c8fec20"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a17a41b88e5484900a2d01cad3c8fec20">mg_get_user_data</a> (const struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:a17a41b88e5484900a2d01cad3c8fec20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae08477dcd7ad0ea27a6a35becf732e50" id="r_ae08477dcd7ad0ea27a6a35becf732e50"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae08477dcd7ad0ea27a6a35becf732e50">mg_get_user_context_data</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ae08477dcd7ad0ea27a6a35becf732e50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1563cc12250b9d00836709ac8bbe804b" id="r_a1563cc12250b9d00836709ac8bbe804b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1563cc12250b9d00836709ac8bbe804b">mg_get_thread_pointer</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a1563cc12250b9d00836709ac8bbe804b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83b9266322b1883981ec399cfce275a4" id="r_a83b9266322b1883981ec399cfce275a4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a83b9266322b1883981ec399cfce275a4">mg_set_user_connection_data</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *const_conn, void *data)</td></tr>
<tr class="separator:a83b9266322b1883981ec399cfce275a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97448fad91e328252f159bbbdeaed589" id="r_a97448fad91e328252f159bbbdeaed589"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a97448fad91e328252f159bbbdeaed589">mg_get_user_connection_data</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a97448fad91e328252f159bbbdeaed589"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dce566e09bfb338699720d1ce69c8d4" id="r_a4dce566e09bfb338699720d1ce69c8d4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4dce566e09bfb338699720d1ce69c8d4">mg_get_server_ports</a> (const struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, int size, struct <a class="el" href="structmg__server__port.html">mg_server_port</a> *ports)</td></tr>
<tr class="separator:a4dce566e09bfb338699720d1ce69c8d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a043f416da5d5ec0b9a0f39e7a34250c2" id="r_a043f416da5d5ec0b9a0f39e7a34250c2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a043f416da5d5ec0b9a0f39e7a34250c2">sockaddr_to_string</a> (char *buf, size_t len, const union <a class="el" href="unionusa.html">usa</a> *<a class="el" href="unionusa.html">usa</a>)</td></tr>
<tr class="separator:a043f416da5d5ec0b9a0f39e7a34250c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ef6ebce89c81f7218a0968e3aa9107f" id="r_a7ef6ebce89c81f7218a0968e3aa9107f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7ef6ebce89c81f7218a0968e3aa9107f">gmt_time_string</a> (char *buf, size_t buf_len, time_t *t)</td></tr>
<tr class="separator:a7ef6ebce89c81f7218a0968e3aa9107f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac54e1770467596ef9b50e658a2672a6c" id="r_ac54e1770467596ef9b50e658a2672a6c"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac54e1770467596ef9b50e658a2672a6c">mg_difftimespec</a> (const struct timespec *ts_now, const struct timespec *ts_before)</td></tr>
<tr class="separator:ac54e1770467596ef9b50e658a2672a6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15063d3ea09051aad3f87c5cafa22d3e" id="r_a15063d3ea09051aad3f87c5cafa22d3e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a15063d3ea09051aad3f87c5cafa22d3e">mg_cry_internal_impl</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *func, unsigned line, const char *fmt, va_list ap)</td></tr>
<tr class="separator:a15063d3ea09051aad3f87c5cafa22d3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46e65877beedb5fed507ad30dbf76d86" id="r_a46e65877beedb5fed507ad30dbf76d86"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structmg__connection.html">mg_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a46e65877beedb5fed507ad30dbf76d86">fake_connection</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *fc, struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:a46e65877beedb5fed507ad30dbf76d86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8b54e2069d196bd535dbcb3bc806e96" id="r_ad8b54e2069d196bd535dbcb3bc806e96"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad8b54e2069d196bd535dbcb3bc806e96">mg_cry</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *fmt,...)</td></tr>
<tr class="separator:ad8b54e2069d196bd535dbcb3bc806e96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a057ebd236dc84e6e8f6c9765da609329" id="r_a057ebd236dc84e6e8f6c9765da609329"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a057ebd236dc84e6e8f6c9765da609329">mg_version</a> (void)</td></tr>
<tr class="separator:a057ebd236dc84e6e8f6c9765da609329"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a882484e3a6894f40748e04fa78e52903" id="r_a882484e3a6894f40748e04fa78e52903"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const struct <a class="el" href="structmg__request__info.html">mg_request_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a882484e3a6894f40748e04fa78e52903">mg_get_request_info</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a882484e3a6894f40748e04fa78e52903"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6447b006fb71eb53c324291b17b9f41f" id="r_a6447b006fb71eb53c324291b17b9f41f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const struct <a class="el" href="structmg__response__info.html">mg_response_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6447b006fb71eb53c324291b17b9f41f">mg_get_response_info</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a6447b006fb71eb53c324291b17b9f41f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa28a4d9a3623da0fc3cbf1fd71acf8b" id="r_aaa28a4d9a3623da0fc3cbf1fd71acf8b"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaa28a4d9a3623da0fc3cbf1fd71acf8b">get_proto_name</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:aaa28a4d9a3623da0fc3cbf1fd71acf8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb99501ab73e2f08414accf1a7d108c1" id="r_acb99501ab73e2f08414accf1a7d108c1"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acb99501ab73e2f08414accf1a7d108c1">mg_construct_local_link</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *buf, size_t buflen, const char *define_proto, int define_port, const char *define_uri)</td></tr>
<tr class="separator:acb99501ab73e2f08414accf1a7d108c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81ef64a9ffadd917ddc7f4615cf5dc07" id="r_a81ef64a9ffadd917ddc7f4615cf5dc07"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a81ef64a9ffadd917ddc7f4615cf5dc07">mg_get_request_link</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *buf, size_t buflen)</td></tr>
<tr class="separator:a81ef64a9ffadd917ddc7f4615cf5dc07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63cf9c2202b6b0433d5e13800dff00f7" id="r_a63cf9c2202b6b0433d5e13800dff00f7"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a63cf9c2202b6b0433d5e13800dff00f7">skip_quoted</a> (char **buf, const char *delimiters, const char *whitespace, char quotechar)</td></tr>
<tr class="separator:a63cf9c2202b6b0433d5e13800dff00f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67c4b5d95b3233717b80963b979724da" id="r_a67c4b5d95b3233717b80963b979724da"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a67c4b5d95b3233717b80963b979724da">get_header</a> (const struct <a class="el" href="structmg__header.html">mg_header</a> *hdr, int num_hdr, const char *<a class="el" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr class="separator:a67c4b5d95b3233717b80963b979724da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40a6af4c96865e0df1aa11c588731a27" id="r_a40a6af4c96865e0df1aa11c588731a27"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a40a6af4c96865e0df1aa11c588731a27">get_req_headers</a> (const struct <a class="el" href="structmg__request__info.html">mg_request_info</a> *ri, const char *<a class="el" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char **<a class="el" href="lua-5_81_85_2src_2luac_8c.html#a5a832fe6e2412dfabb93a2adae30e745">output</a>, int output_max_size)</td></tr>
<tr class="separator:a40a6af4c96865e0df1aa11c588731a27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2565ee5d9358284c1312e957271fccfb" id="r_a2565ee5d9358284c1312e957271fccfb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *<a class="el" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr class="separator:a2565ee5d9358284c1312e957271fccfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad28d6d09815fda1ee2b5621d1a49c513" id="r_ad28d6d09815fda1ee2b5621d1a49c513"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad28d6d09815fda1ee2b5621d1a49c513">get_http_version</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ad28d6d09815fda1ee2b5621d1a49c513"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a9f9af183eb62789209809d41dabbf4" id="r_a8a9f9af183eb62789209809d41dabbf4"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a> (const char *list, struct <a class="el" href="structvec.html">vec</a> *val, struct <a class="el" href="structvec.html">vec</a> *eq_val)</td></tr>
<tr class="separator:a8a9f9af183eb62789209809d41dabbf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bc2585ae2ab78f91db4346a574d58ac" id="r_a1bc2585ae2ab78f91db4346a574d58ac"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1bc2585ae2ab78f91db4346a574d58ac">header_has_option</a> (const char *header, const char *option)</td></tr>
<tr class="separator:a1bc2585ae2ab78f91db4346a574d58ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f83db0ca198c57993fb3e3cd5e97500" id="r_a2f83db0ca198c57993fb3e3cd5e97500"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2f83db0ca198c57993fb3e3cd5e97500">should_keep_alive</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a2f83db0ca198c57993fb3e3cd5e97500"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb05505a49b6d5ba3733d63c7aabe8d4" id="r_acb05505a49b6d5ba3733d63c7aabe8d4"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acb05505a49b6d5ba3733d63c7aabe8d4">should_decode_url</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:acb05505a49b6d5ba3733d63c7aabe8d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5091c315948383d6f29f90450b9e706" id="r_ac5091c315948383d6f29f90450b9e706"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac5091c315948383d6f29f90450b9e706">should_decode_query_string</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ac5091c315948383d6f29f90450b9e706"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b35d4674db9acdc8b837dde56bcd94e" id="r_a8b35d4674db9acdc8b837dde56bcd94e"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8b35d4674db9acdc8b837dde56bcd94e">suggest_connection_header</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a8b35d4674db9acdc8b837dde56bcd94e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e9abca78e3f98b886081d15550f7fca" id="r_a4e9abca78e3f98b886081d15550f7fca"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a4e9abca78e3f98b886081d15550f7fca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a229f03c60c42b8f390449a8e1324f22f" id="r_a229f03c60c42b8f390449a8e1324f22f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a229f03c60c42b8f390449a8e1324f22f">send_static_cache_header</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a229f03c60c42b8f390449a8e1324f22f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab79547a6cf8bca74eba39a0ff85cd091" id="r_ab79547a6cf8bca74eba39a0ff85cd091"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ab79547a6cf8bca74eba39a0ff85cd091"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acce3a614f601b06f0120faad9421e25f" id="r_acce3a614f601b06f0120faad9421e25f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acce3a614f601b06f0120faad9421e25f">send_cors_header</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:acce3a614f601b06f0120faad9421e25f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4761bad9f703f9d51380597f4b1a694c" id="r_a4761bad9f703f9d51380597f4b1a694c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4761bad9f703f9d51380597f4b1a694c">handle_file_based_request</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, struct <a class="el" href="structmg__file.html">mg_file</a> *filep)</td></tr>
<tr class="separator:a4761bad9f703f9d51380597f4b1a694c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08ef1e77e39a65d2b0eb84328291cae1" id="r_a08ef1e77e39a65d2b0eb84328291cae1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a08ef1e77e39a65d2b0eb84328291cae1">mg_get_response_code_text</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, int response_code)</td></tr>
<tr class="separator:a08ef1e77e39a65d2b0eb84328291cae1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a4e417915ab57988e9b1379da483cc2" id="r_a5a4e417915ab57988e9b1379da483cc2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5a4e417915ab57988e9b1379da483cc2">mg_send_http_error_impl</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, int status, const char *fmt, va_list args)</td></tr>
<tr class="separator:a5a4e417915ab57988e9b1379da483cc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca46fdde7db996eb011a1ac6a28bea98" id="r_aca46fdde7db996eb011a1ac6a28bea98"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, int status, const char *fmt,...)</td></tr>
<tr class="separator:aca46fdde7db996eb011a1ac6a28bea98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0be5c92db7782f5be9d5d3effcd479e" id="r_ae0be5c92db7782f5be9d5d3effcd479e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae0be5c92db7782f5be9d5d3effcd479e">mg_send_http_ok</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *<a class="el" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a>, long long content_length)</td></tr>
<tr class="separator:ae0be5c92db7782f5be9d5d3effcd479e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbacd157c3e4a32ef99a0088a36e06af" id="r_acbacd157c3e4a32ef99a0088a36e06af"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acbacd157c3e4a32ef99a0088a36e06af">mg_send_http_redirect</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *target_url, int redirect_code)</td></tr>
<tr class="separator:acbacd157c3e4a32ef99a0088a36e06af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea8c64184a00214c2f457d5e30f89478" id="r_aea8c64184a00214c2f457d5e30f89478"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aea8c64184a00214c2f457d5e30f89478">set_close_on_exec</a> (int fd, const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:aea8c64184a00214c2f457d5e30f89478"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32a9cdd8992fc2aa797e67089352be23" id="r_a32a9cdd8992fc2aa797e67089352be23"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a32a9cdd8992fc2aa797e67089352be23">mg_start_thread</a> (<a class="el" href="civetweb_8h.html#a11f18a1c01860c3928019a829cae3ba6">mg_thread_func_t</a> func, void *param)</td></tr>
<tr class="separator:a32a9cdd8992fc2aa797e67089352be23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7da29c2b36cd27b1467771e8ac52404e" id="r_a7da29c2b36cd27b1467771e8ac52404e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7da29c2b36cd27b1467771e8ac52404e">mg_start_thread_with_id</a> (<a class="el" href="civetweb_8h.html#a11f18a1c01860c3928019a829cae3ba6">mg_thread_func_t</a> func, void *param, pthread_t *threadidptr)</td></tr>
<tr class="separator:a7da29c2b36cd27b1467771e8ac52404e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfdfa9abee970034383cfb3e832d2217" id="r_adfdfa9abee970034383cfb3e832d2217"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adfdfa9abee970034383cfb3e832d2217">mg_join_thread</a> (pthread_t <a class="el" href="sqlite3_8c.html#afa8ef032e5cdbbbc7df8cc41bdfc865f">threadid</a>)</td></tr>
<tr class="separator:adfdfa9abee970034383cfb3e832d2217"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10cbc96e5456363bea1672bfc3f526dd" id="r_a10cbc96e5456363bea1672bfc3f526dd"><td class="memItemLeft" align="right" valign="top">static pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a10cbc96e5456363bea1672bfc3f526dd">spawn_process</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *prog, char *envblk, char *envp[], int fdin[2], int fdout[2], int fderr[2], const char *dir, int cgi_config_idx)</td></tr>
<tr class="separator:a10cbc96e5456363bea1672bfc3f526dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a145cf727fe064c50f8101a6650495a61" id="r_a145cf727fe064c50f8101a6650495a61"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a145cf727fe064c50f8101a6650495a61">set_non_blocking_mode</a> (<a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a> sock)</td></tr>
<tr class="separator:a145cf727fe064c50f8101a6650495a61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9edc91d3d1362d1b5be5371d44ce3d03" id="r_a9edc91d3d1362d1b5be5371d44ce3d03"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9edc91d3d1362d1b5be5371d44ce3d03">set_blocking_mode</a> (<a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a> sock)</td></tr>
<tr class="separator:a9edc91d3d1362d1b5be5371d44ce3d03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcc8e6176b79900cc58605f1c884d0ab" id="r_afcc8e6176b79900cc58605f1c884d0ab"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afcc8e6176b79900cc58605f1c884d0ab">get_random</a> (void)</td></tr>
<tr class="separator:afcc8e6176b79900cc58605f1c884d0ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b9904a2b6ed6d472f5ee35c7c588863" id="r_a3b9904a2b6ed6d472f5ee35c7c588863"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3b9904a2b6ed6d472f5ee35c7c588863">mg_poll</a> (struct <a class="el" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> *pfd, unsigned int n, int milliseconds, const <a class="el" href="#ac751248c6cb5f0bce10051d41a22d964">stop_flag_t</a> *stop_flag)</td></tr>
<tr class="separator:a3b9904a2b6ed6d472f5ee35c7c588863"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afae99dbeb2f975b63527cbffbfe2e395" id="r_afae99dbeb2f975b63527cbffbfe2e395"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afae99dbeb2f975b63527cbffbfe2e395">push_inner</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, FILE *fp, <a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a> sock, SSL *ssl, const char *buf, int len, double timeout)</td></tr>
<tr class="separator:afae99dbeb2f975b63527cbffbfe2e395"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab855e2c5d4e7913fb2138a9909c8caca" id="r_ab855e2c5d4e7913fb2138a9909c8caca"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab855e2c5d4e7913fb2138a9909c8caca">push_all</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, FILE *fp, <a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a> sock, SSL *ssl, const char *buf, int len)</td></tr>
<tr class="separator:ab855e2c5d4e7913fb2138a9909c8caca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57991f1957263ffb56e7411155766204" id="r_a57991f1957263ffb56e7411155766204"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a57991f1957263ffb56e7411155766204">pull_inner</a> (FILE *fp, struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *buf, int len, double timeout)</td></tr>
<tr class="separator:a57991f1957263ffb56e7411155766204"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a807c2737d59afedd4cc79747f416ea42" id="r_a807c2737d59afedd4cc79747f416ea42"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a807c2737d59afedd4cc79747f416ea42">pull_all</a> (FILE *fp, struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *buf, int len)</td></tr>
<tr class="separator:a807c2737d59afedd4cc79747f416ea42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9f9ef727b8c8a8ecb4c06b47aeb7d11" id="r_ad9f9ef727b8c8a8ecb4c06b47aeb7d11"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad9f9ef727b8c8a8ecb4c06b47aeb7d11">discard_unread_request_data</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ad9f9ef727b8c8a8ecb4c06b47aeb7d11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59c90f7b25d805478984a16ba5ee5fc7" id="r_a59c90f7b25d805478984a16ba5ee5fc7"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a59c90f7b25d805478984a16ba5ee5fc7">mg_read_inner</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, void *buf, size_t len)</td></tr>
<tr class="separator:a59c90f7b25d805478984a16ba5ee5fc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad59c266c5a9c359d128e8151c602ef31" id="r_ad59c266c5a9c359d128e8151c602ef31"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad59c266c5a9c359d128e8151c602ef31">handle_request</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *)</td></tr>
<tr class="separator:ad59c266c5a9c359d128e8151c602ef31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a395e0410a86d3aa491b7efe4d081a60e" id="r_a395e0410a86d3aa491b7efe4d081a60e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a395e0410a86d3aa491b7efe4d081a60e">log_access</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *)</td></tr>
<tr class="separator:a395e0410a86d3aa491b7efe4d081a60e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade0a4f4deaa6ce8cf91dcf0921cfde1d" id="r_ade0a4f4deaa6ce8cf91dcf0921cfde1d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ade0a4f4deaa6ce8cf91dcf0921cfde1d">handle_request_stat_log</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ade0a4f4deaa6ce8cf91dcf0921cfde1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeb3b13a0524f5532d16953927743966" id="r_afeb3b13a0524f5532d16953927743966"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afeb3b13a0524f5532d16953927743966">mg_read</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, void *buf, size_t len)</td></tr>
<tr class="separator:afeb3b13a0524f5532d16953927743966"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e7dd65d54025f881bb4d95986fc2581" id="r_a6e7dd65d54025f881bb4d95986fc2581"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const void *buf, size_t len)</td></tr>
<tr class="separator:a6e7dd65d54025f881bb4d95986fc2581"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc4c4a1fa3a55e2b562da0ba4bf38e20" id="r_abc4c4a1fa3a55e2b562da0ba4bf38e20"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abc4c4a1fa3a55e2b562da0ba4bf38e20">mg_send_chunk</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *<a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a250d5faeaacc40c8a7e1822f5621c292">chunk</a>, unsigned int chunk_len)</td></tr>
<tr class="separator:abc4c4a1fa3a55e2b562da0ba4bf38e20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2c0385a062d1e72128df82d20cd26e3" id="r_ac2c0385a062d1e72128df82d20cd26e3"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac2c0385a062d1e72128df82d20cd26e3">alloc_vprintf2</a> (char **buf, const char *fmt, va_list ap)</td></tr>
<tr class="separator:ac2c0385a062d1e72128df82d20cd26e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cfa7a42c911923d382305f16bd57314" id="r_a8cfa7a42c911923d382305f16bd57314"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8cfa7a42c911923d382305f16bd57314">alloc_vprintf</a> (char **out_buf, char *prealloc_buf, size_t prealloc_size, const char *fmt, va_list ap)</td></tr>
<tr class="separator:a8cfa7a42c911923d382305f16bd57314"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3367d3437bb9177f66f9b491f1ea60e1" id="r_a3367d3437bb9177f66f9b491f1ea60e1"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3367d3437bb9177f66f9b491f1ea60e1">alloc_printf</a> (char **out_buf, const char *fmt,...)</td></tr>
<tr class="separator:a3367d3437bb9177f66f9b491f1ea60e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1c003c5b952dd24c95b887def277814" id="r_ab1c003c5b952dd24c95b887def277814"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab1c003c5b952dd24c95b887def277814">mg_vprintf</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *fmt, va_list ap)</td></tr>
<tr class="separator:ab1c003c5b952dd24c95b887def277814"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accee9ed1fe40036abe9b36eac86b4121" id="r_accee9ed1fe40036abe9b36eac86b4121"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *fmt,...)</td></tr>
<tr class="separator:accee9ed1fe40036abe9b36eac86b4121"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bdfbeb661f200bdbe2e19e6258bb937" id="r_a3bdfbeb661f200bdbe2e19e6258bb937"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3bdfbeb661f200bdbe2e19e6258bb937">mg_url_decode</a> (const char *src, int src_len, char *dst, int dst_len, int is_form_url_encoded)</td></tr>
<tr class="separator:a3bdfbeb661f200bdbe2e19e6258bb937"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affee01654ebda8d153ea3b7e7502f248" id="r_affee01654ebda8d153ea3b7e7502f248"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#affee01654ebda8d153ea3b7e7502f248">url_decode_in_place</a> (char *buf)</td></tr>
<tr class="separator:affee01654ebda8d153ea3b7e7502f248"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9af16bbe4c94107c76ee815af622e61f" id="r_a9af16bbe4c94107c76ee815af622e61f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9af16bbe4c94107c76ee815af622e61f">mg_get_var</a> (const char *data, size_t data_len, const char *<a class="el" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, char *dst, size_t dst_len)</td></tr>
<tr class="separator:a9af16bbe4c94107c76ee815af622e61f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d66a21c6795562fbd1412d9c9557306" id="r_a3d66a21c6795562fbd1412d9c9557306"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3d66a21c6795562fbd1412d9c9557306">mg_get_var2</a> (const char *data, size_t data_len, const char *<a class="el" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, char *dst, size_t dst_len, size_t occurrence)</td></tr>
<tr class="separator:a3d66a21c6795562fbd1412d9c9557306"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4568e555e11dae99b04de8c0a22e358" id="r_ae4568e555e11dae99b04de8c0a22e358"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae4568e555e11dae99b04de8c0a22e358">mg_split_form_urlencoded</a> (char *data, struct <a class="el" href="structmg__header.html">mg_header</a> *form_fields, unsigned num_form_fields)</td></tr>
<tr class="separator:ae4568e555e11dae99b04de8c0a22e358"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46916a747f8cbeca1ecd94007496f5c8" id="r_a46916a747f8cbeca1ecd94007496f5c8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a46916a747f8cbeca1ecd94007496f5c8">mg_get_cookie</a> (const char *cookie_header, const char *var_name, char *dst, size_t dst_size)</td></tr>
<tr class="separator:a46916a747f8cbeca1ecd94007496f5c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16f495b82ab6766de6c2d0e86ea4a82d" id="r_a16f495b82ab6766de6c2d0e86ea4a82d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a16f495b82ab6766de6c2d0e86ea4a82d">mg_base64_encode</a> (const unsigned char *src, size_t src_len, char *dst, size_t *dst_len)</td></tr>
<tr class="separator:a16f495b82ab6766de6c2d0e86ea4a82d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accf1ea390b445a26d81f9e25692fc267" id="r_accf1ea390b445a26d81f9e25692fc267"><td class="memItemLeft" align="right" valign="top">static unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#accf1ea390b445a26d81f9e25692fc267">b64reverse</a> (char letter)</td></tr>
<tr class="separator:accf1ea390b445a26d81f9e25692fc267"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40d10ad1edce124016cf9efee6cb79c7" id="r_a40d10ad1edce124016cf9efee6cb79c7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a40d10ad1edce124016cf9efee6cb79c7">mg_base64_decode</a> (const char *src, size_t src_len, unsigned char *dst, size_t *dst_len)</td></tr>
<tr class="separator:a40d10ad1edce124016cf9efee6cb79c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8aa528da861495a7c5655dd89eaecb1" id="r_ab8aa528da861495a7c5655dd89eaecb1"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab8aa528da861495a7c5655dd89eaecb1">is_put_or_delete_method</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ab8aa528da861495a7c5655dd89eaecb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b3a33060a5555c75a320a23898c056f" id="r_a1b3a33060a5555c75a320a23898c056f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1b3a33060a5555c75a320a23898c056f">is_civetweb_webdav_method</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a1b3a33060a5555c75a320a23898c056f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e07d608a1551b747130ac4f1e41f547" id="r_a5e07d608a1551b747130ac4f1e41f547"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5e07d608a1551b747130ac4f1e41f547">extention_matches_script</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *filename)</td></tr>
<tr class="separator:a5e07d608a1551b747130ac4f1e41f547"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac32269ba42b000939c92b695049fe0be" id="r_ac32269ba42b000939c92b695049fe0be"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac32269ba42b000939c92b695049fe0be">extention_matches_template_text</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *filename)</td></tr>
<tr class="separator:ac32269ba42b000939c92b695049fe0be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6b0cd03c015fee859606ab8b09db8e0" id="r_af6b0cd03c015fee859606ab8b09db8e0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af6b0cd03c015fee859606ab8b09db8e0">substitute_index_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *path, size_t path_len, struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *filestat)</td></tr>
<tr class="separator:af6b0cd03c015fee859606ab8b09db8e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1681f675e3235a77787a2a174e1f9a5" id="r_ab1681f675e3235a77787a2a174e1f9a5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab1681f675e3235a77787a2a174e1f9a5">interpret_uri</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *filename, size_t filename_buf_len, struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *filestat, int *is_found, int *is_script_resource, int *is_websocket_request, int *is_put_or_delete_request, int *is_webdav_request, int *is_template_text)</td></tr>
<tr class="separator:ab1681f675e3235a77787a2a174e1f9a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac32d22dcddea6592a3772d746edf5bb" id="r_aac32d22dcddea6592a3772d746edf5bb"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aac32d22dcddea6592a3772d746edf5bb">get_http_header_len</a> (const char *buf, int buflen)</td></tr>
<tr class="separator:aac32d22dcddea6592a3772d746edf5bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec4315e0c74af7127b8e43e7f3cc82cf" id="r_aec4315e0c74af7127b8e43e7f3cc82cf"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aec4315e0c74af7127b8e43e7f3cc82cf">get_month_index</a> (const char *<a class="el" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>)</td></tr>
<tr class="separator:aec4315e0c74af7127b8e43e7f3cc82cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d431c80187736408d57f4c83bcfa5a2" id="r_a8d431c80187736408d57f4c83bcfa5a2"><td class="memItemLeft" align="right" valign="top">static time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8d431c80187736408d57f4c83bcfa5a2">parse_date_string</a> (const char *datetime)</td></tr>
<tr class="separator:a8d431c80187736408d57f4c83bcfa5a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf6e864c64e3f7b5df96cf2c2598f776" id="r_abf6e864c64e3f7b5df96cf2c2598f776"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abf6e864c64e3f7b5df96cf2c2598f776">remove_dot_segments</a> (char *inout)</td></tr>
<tr class="separator:abf6e864c64e3f7b5df96cf2c2598f776"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cd400c299dd350acc398055918d75a9" id="r_a7cd400c299dd350acc398055918d75a9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7cd400c299dd350acc398055918d75a9">mg_get_builtin_mime_type</a> (const char *path)</td></tr>
<tr class="separator:a7cd400c299dd350acc398055918d75a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ed08e2cbee6ec8aa43739359b3a0937" id="r_a9ed08e2cbee6ec8aa43739359b3a0937"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9ed08e2cbee6ec8aa43739359b3a0937">get_mime_type</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, struct <a class="el" href="structvec.html">vec</a> *<a class="el" href="structvec.html">vec</a>)</td></tr>
<tr class="separator:a9ed08e2cbee6ec8aa43739359b3a0937"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8694301743d1c8f3bc37f058a1e0de2a" id="r_a8694301743d1c8f3bc37f058a1e0de2a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8694301743d1c8f3bc37f058a1e0de2a">bin2str</a> (char *to, const unsigned char *p, size_t len)</td></tr>
<tr class="separator:a8694301743d1c8f3bc37f058a1e0de2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a1f27cd059fa56ead5cecaf7885582f" id="r_a9a1f27cd059fa56ead5cecaf7885582f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9a1f27cd059fa56ead5cecaf7885582f">mg_md5</a> (char buf[33],...)</td></tr>
<tr class="separator:a9a1f27cd059fa56ead5cecaf7885582f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5152c8a0667f633bdb0d7b97bca75c3" id="r_ad5152c8a0667f633bdb0d7b97bca75c3"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad5152c8a0667f633bdb0d7b97bca75c3">check_password_digest</a> (const char *method, const char *ha1, const char *uri, const char *nonce, const char *nc, const char *cnonce, const char *qop, const char *response)</td></tr>
<tr class="separator:ad5152c8a0667f633bdb0d7b97bca75c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a054c8cdcbf4ebf1a0ef52792a1868351" id="r_a054c8cdcbf4ebf1a0ef52792a1868351"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a054c8cdcbf4ebf1a0ef52792a1868351">open_auth_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, struct <a class="el" href="structmg__file.html">mg_file</a> *filep)</td></tr>
<tr class="separator:a054c8cdcbf4ebf1a0ef52792a1868351"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5a596736f518b04c383c91e7c9cc747" id="r_aa5a596736f518b04c383c91e7c9cc747"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa5a596736f518b04c383c91e7c9cc747">parse_auth_header</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *buf, size_t buf_size, struct <a class="el" href="structah.html">ah</a> *<a class="el" href="structah.html">ah</a>)</td></tr>
<tr class="separator:aa5a596736f518b04c383c91e7c9cc747"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad749ad33438ec816162818fd6974a433" id="r_ad749ad33438ec816162818fd6974a433"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad749ad33438ec816162818fd6974a433">mg_fgets</a> (char *buf, size_t size, struct <a class="el" href="structmg__file.html">mg_file</a> *filep)</td></tr>
<tr class="separator:ad749ad33438ec816162818fd6974a433"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cd712ed2b8d7a2107836b8ed6ddc1a6" id="r_a7cd712ed2b8d7a2107836b8ed6ddc1a6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7cd712ed2b8d7a2107836b8ed6ddc1a6">read_auth_file</a> (struct <a class="el" href="structmg__file.html">mg_file</a> *filep, struct <a class="el" href="structread__auth__file__struct.html">read_auth_file_struct</a> *workdata, int <a class="el" href="deprecated_2gthread_8h.html#a2b31ea2bc2a86a6f81186b13309f0f45">depth</a>)</td></tr>
<tr class="separator:a7cd712ed2b8d7a2107836b8ed6ddc1a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbf5e7625b9c8d60ffc4d84b02923943" id="r_abbf5e7625b9c8d60ffc4d84b02923943"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abbf5e7625b9c8d60ffc4d84b02923943">authorize</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, struct <a class="el" href="structmg__file.html">mg_file</a> *filep, const char *realm)</td></tr>
<tr class="separator:abbf5e7625b9c8d60ffc4d84b02923943"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e38f4db9a8d42ff57623b15f11f93b1" id="r_a8e38f4db9a8d42ff57623b15f11f93b1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e38f4db9a8d42ff57623b15f11f93b1">mg_check_digest_access_authentication</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *realm, const char *filename)</td></tr>
<tr class="separator:a8e38f4db9a8d42ff57623b15f11f93b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09229a33ae0eac77138714207fc46c14" id="r_a09229a33ae0eac77138714207fc46c14"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a09229a33ae0eac77138714207fc46c14">check_authorization</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a09229a33ae0eac77138714207fc46c14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e30365a0294614e545550653e71c809" id="r_a3e30365a0294614e545550653e71c809"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3e30365a0294614e545550653e71c809">send_authorization_request</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *realm)</td></tr>
<tr class="separator:a3e30365a0294614e545550653e71c809"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62341459408ee3d4ae77df385a4d332f" id="r_a62341459408ee3d4ae77df385a4d332f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a62341459408ee3d4ae77df385a4d332f">mg_send_digest_access_authentication_request</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *realm)</td></tr>
<tr class="separator:a62341459408ee3d4ae77df385a4d332f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01cd34a432a273eba4e48fb327503bc8" id="r_a01cd34a432a273eba4e48fb327503bc8"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a01cd34a432a273eba4e48fb327503bc8">is_authorized_for_put</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a01cd34a432a273eba4e48fb327503bc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9da2dc01380431f8028fee47b939bcd" id="r_aa9da2dc01380431f8028fee47b939bcd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa9da2dc01380431f8028fee47b939bcd">mg_modify_passwords_file_ha1</a> (const char *fname, const char *domain, const char *user, const char *ha1)</td></tr>
<tr class="separator:aa9da2dc01380431f8028fee47b939bcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7953fa655c4cfce96b429267e2b4ba67" id="r_a7953fa655c4cfce96b429267e2b4ba67"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7953fa655c4cfce96b429267e2b4ba67">mg_modify_passwords_file</a> (const char *fname, const char *domain, const char *user, const char *pass)</td></tr>
<tr class="separator:a7953fa655c4cfce96b429267e2b4ba67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0cba7d970883b21a4db625c33cba9ac" id="r_ab0cba7d970883b21a4db625c33cba9ac"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab0cba7d970883b21a4db625c33cba9ac">is_valid_port</a> (unsigned long port)</td></tr>
<tr class="separator:ab0cba7d970883b21a4db625c33cba9ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68fa0720ca91d2de27f7770afa229002" id="r_a68fa0720ca91d2de27f7770afa229002"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a68fa0720ca91d2de27f7770afa229002">mg_inet_pton</a> (int af, const char *src, void *dst, size_t dstlen, int resolve_src)</td></tr>
<tr class="separator:a68fa0720ca91d2de27f7770afa229002"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34c01d95bd26a8b8be2db7cd87efe701" id="r_a34c01d95bd26a8b8be2db7cd87efe701"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a34c01d95bd26a8b8be2db7cd87efe701">connect_socket</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, const char *host, int port, int use_ssl, struct <a class="el" href="structmg__error__data.html">mg_error_data</a> *<a class="el" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>, <a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a> *sock, union <a class="el" href="unionusa.html">usa</a> *sa)</td></tr>
<tr class="separator:a34c01d95bd26a8b8be2db7cd87efe701"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afec55bb47160c2d4fe76c5df4ce54f56" id="r_afec55bb47160c2d4fe76c5df4ce54f56"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afec55bb47160c2d4fe76c5df4ce54f56">mg_url_encode</a> (const char *src, char *dst, size_t dst_len)</td></tr>
<tr class="separator:afec55bb47160c2d4fe76c5df4ce54f56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1178bc077d6f8483d04c6bc95c2a8324" id="r_a1178bc077d6f8483d04c6bc95c2a8324"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1178bc077d6f8483d04c6bc95c2a8324">print_dir_entry</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, struct <a class="el" href="structde.html">de</a> *<a class="el" href="structde.html">de</a>)</td></tr>
<tr class="separator:a1178bc077d6f8483d04c6bc95c2a8324"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a479f7681b73f6d36b90146e29ee63652" id="r_a479f7681b73f6d36b90146e29ee63652"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a479f7681b73f6d36b90146e29ee63652">compare_dir_entries</a> (const void *p1, const void *p2, void *<a class="el" href="curl_8h.html#a7d68018e95e3d4e6b703538ac1c8c411">arg</a>)</td></tr>
<tr class="separator:a479f7681b73f6d36b90146e29ee63652"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38c5f9290df5fe9727338a93493108f5" id="r_a38c5f9290df5fe9727338a93493108f5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a38c5f9290df5fe9727338a93493108f5">must_hide_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a38c5f9290df5fe9727338a93493108f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa346108a8a9cc93af26ca8beee784cd" id="r_afa346108a8a9cc93af26ca8beee784cd"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afa346108a8a9cc93af26ca8beee784cd">scan_directory</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *dir, void *data, int(*cb)(struct <a class="el" href="structde.html">de</a> *, void *))</td></tr>
<tr class="separator:afa346108a8a9cc93af26ca8beee784cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad26006f44f84ee1b4e9d5e039f779b51" id="r_ad26006f44f84ee1b4e9d5e039f779b51"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad26006f44f84ee1b4e9d5e039f779b51">remove_directory</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *dir)</td></tr>
<tr class="separator:ad26006f44f84ee1b4e9d5e039f779b51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7110e9ded01191e313122aafa2b1040" id="r_ae7110e9ded01191e313122aafa2b1040"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae7110e9ded01191e313122aafa2b1040">dir_scan_callback</a> (struct <a class="el" href="structde.html">de</a> *<a class="el" href="structde.html">de</a>, void *data)</td></tr>
<tr class="separator:ae7110e9ded01191e313122aafa2b1040"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b85ac81c14209bfd8102abe7af190f7" id="r_a7b85ac81c14209bfd8102abe7af190f7"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7b85ac81c14209bfd8102abe7af190f7">handle_directory_request</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *dir)</td></tr>
<tr class="separator:a7b85ac81c14209bfd8102abe7af190f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a528545b68103ca8848caaea2c5316ec2" id="r_a528545b68103ca8848caaea2c5316ec2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a528545b68103ca8848caaea2c5316ec2">send_file_data</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, struct <a class="el" href="structmg__file.html">mg_file</a> *filep, int64_t offset, int64_t len, int no_buffering)</td></tr>
<tr class="separator:a528545b68103ca8848caaea2c5316ec2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96d4fe5a4a9ff4b964325c9d31c4b6c9" id="r_a96d4fe5a4a9ff4b964325c9d31c4b6c9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a96d4fe5a4a9ff4b964325c9d31c4b6c9">parse_range_header</a> (const char *header, int64_t *<a class="el" href="classa.html">a</a>, int64_t *b)</td></tr>
<tr class="separator:a96d4fe5a4a9ff4b964325c9d31c4b6c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac715f770ccb10deba796a43cb10cfd46" id="r_ac715f770ccb10deba796a43cb10cfd46"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac715f770ccb10deba796a43cb10cfd46">construct_etag</a> (char *buf, size_t buf_len, const struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *filestat)</td></tr>
<tr class="separator:ac715f770ccb10deba796a43cb10cfd46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66af55875eb933f2969b8bed72ab9ef4" id="r_a66af55875eb933f2969b8bed72ab9ef4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a66af55875eb933f2969b8bed72ab9ef4">fclose_on_exec</a> (struct <a class="el" href="structmg__file__access.html">mg_file_access</a> *filep, struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a66af55875eb933f2969b8bed72ab9ef4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35e5540a0d567e223008b77b2bacb2d5" id="r_a35e5540a0d567e223008b77b2bacb2d5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a35e5540a0d567e223008b77b2bacb2d5">handle_static_file_request</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, struct <a class="el" href="structmg__file.html">mg_file</a> *filep, const char *<a class="el" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a>, const char *additional_headers)</td></tr>
<tr class="separator:a35e5540a0d567e223008b77b2bacb2d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c440a246bb1f1d223456de874c17f59" id="r_a4c440a246bb1f1d223456de874c17f59"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4c440a246bb1f1d223456de874c17f59">mg_send_file_body</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a4c440a246bb1f1d223456de874c17f59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa81530fc67a88c3191c00c52ec06065b" id="r_aa81530fc67a88c3191c00c52ec06065b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa81530fc67a88c3191c00c52ec06065b">is_not_modified</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *filestat)</td></tr>
<tr class="separator:aa81530fc67a88c3191c00c52ec06065b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae261fe366cffadac8da5a02c285b9653" id="r_ae261fe366cffadac8da5a02c285b9653"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae261fe366cffadac8da5a02c285b9653">handle_not_modified_static_file_request</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, struct <a class="el" href="structmg__file.html">mg_file</a> *filep)</td></tr>
<tr class="separator:ae261fe366cffadac8da5a02c285b9653"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af485479c8d173f829c88a4aed927d6fc" id="r_af485479c8d173f829c88a4aed927d6fc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af485479c8d173f829c88a4aed927d6fc">mg_send_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:af485479c8d173f829c88a4aed927d6fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1999d3a7cd176207cc30dcc3205a57c3" id="r_a1999d3a7cd176207cc30dcc3205a57c3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1999d3a7cd176207cc30dcc3205a57c3">mg_send_mime_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, const char *<a class="el" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a>)</td></tr>
<tr class="separator:a1999d3a7cd176207cc30dcc3205a57c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7547ded66b30ef8d6924f8b8734cfe3" id="r_ac7547ded66b30ef8d6924f8b8734cfe3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac7547ded66b30ef8d6924f8b8734cfe3">mg_send_mime_file2</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, const char *<a class="el" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a>, const char *additional_headers)</td></tr>
<tr class="separator:ac7547ded66b30ef8d6924f8b8734cfe3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21b71badd56313936783f198fdd20c9a" id="r_a21b71badd56313936783f198fdd20c9a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a21b71badd56313936783f198fdd20c9a">put_dir</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a21b71badd56313936783f198fdd20c9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e117d579dddd909e2370d437c566cf1" id="r_a0e117d579dddd909e2370d437c566cf1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0e117d579dddd909e2370d437c566cf1">remove_bad_file</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a0e117d579dddd909e2370d437c566cf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1973d17da3ae4db49964b93ab92c5b06" id="r_a1973d17da3ae4db49964b93ab92c5b06"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> long long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1973d17da3ae4db49964b93ab92c5b06">mg_store_body</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a1973d17da3ae4db49964b93ab92c5b06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6caa9c39e63744c4ee69d2dea110ea66" id="r_a6caa9c39e63744c4ee69d2dea110ea66"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6caa9c39e63744c4ee69d2dea110ea66">skip_to_end_of_word_and_terminate</a> (char **ppw, int eol)</td></tr>
<tr class="separator:a6caa9c39e63744c4ee69d2dea110ea66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a461ef0a8b46dd9223774d62a6f290186" id="r_a461ef0a8b46dd9223774d62a6f290186"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a461ef0a8b46dd9223774d62a6f290186">parse_http_headers</a> (char **buf, struct <a class="el" href="structmg__header.html">mg_header</a> hdr[<a class="el" href="civetweb_8h.html#a0a13e84141de39780fed2bba427631fd">MG_MAX_HEADERS</a>])</td></tr>
<tr class="separator:a461ef0a8b46dd9223774d62a6f290186"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4291431186c67ce74663a2f32ec7dce4" id="r_a4291431186c67ce74663a2f32ec7dce4"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="structmg__http__method__info.html">mg_http_method_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4291431186c67ce74663a2f32ec7dce4">get_http_method_info</a> (const char *method)</td></tr>
<tr class="separator:a4291431186c67ce74663a2f32ec7dce4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affc32c6a90f6b193dda6fbe4c600769c" id="r_affc32c6a90f6b193dda6fbe4c600769c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#affc32c6a90f6b193dda6fbe4c600769c">is_valid_http_method</a> (const char *method)</td></tr>
<tr class="separator:affc32c6a90f6b193dda6fbe4c600769c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02c595eceb37a14be0c7eb08ab464616" id="r_a02c595eceb37a14be0c7eb08ab464616"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a02c595eceb37a14be0c7eb08ab464616">parse_http_request</a> (char *buf, int len, struct <a class="el" href="structmg__request__info.html">mg_request_info</a> *ri)</td></tr>
<tr class="separator:a02c595eceb37a14be0c7eb08ab464616"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6bd0851fba7b27c7180498b80f535ca" id="r_ad6bd0851fba7b27c7180498b80f535ca"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad6bd0851fba7b27c7180498b80f535ca">parse_http_response</a> (char *buf, int len, struct <a class="el" href="structmg__response__info.html">mg_response_info</a> *ri)</td></tr>
<tr class="separator:ad6bd0851fba7b27c7180498b80f535ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8b35962b277d0cc31f7e16541b326ea" id="r_ab8b35962b277d0cc31f7e16541b326ea"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab8b35962b277d0cc31f7e16541b326ea">read_message</a> (FILE *fp, struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *buf, int bufsiz, int *nread)</td></tr>
<tr class="separator:ab8b35962b277d0cc31f7e16541b326ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b0ac164cc67271e3819e1d6c967ef95" id="r_a6b0ac164cc67271e3819e1d6c967ef95"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6b0ac164cc67271e3819e1d6c967ef95">forward_body_data</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, FILE *fp, <a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a> sock, SSL *ssl)</td></tr>
<tr class="separator:a6b0ac164cc67271e3819e1d6c967ef95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e93852e401067c198aca347441cb1a2" id="r_a4e93852e401067c198aca347441cb1a2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4e93852e401067c198aca347441cb1a2">addenv</a> (struct <a class="el" href="structcgi__environment.html">cgi_environment</a> *env, <a class="el" href="civetweb_8h.html#a2bb9db6ffe087ec4f44662ed3dfa0abd">PRINTF_FORMAT_STRING</a>(const char *fmt),...) <a class="el" href="civetweb_8h.html#aabeba45019b494e33206b4a3a9a8ba17">PRINTF_ARGS</a>(2</td></tr>
<tr class="separator:a4e93852e401067c198aca347441cb1a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92b6545dc8a1d416fc5dd4cb152785c6" id="r_a92b6545dc8a1d416fc5dd4cb152785c6"><td class="memItemLeft" align="right" valign="top">static void static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a92b6545dc8a1d416fc5dd4cb152785c6">addenv</a> (struct <a class="el" href="structcgi__environment.html">cgi_environment</a> *env, const char *fmt,...)</td></tr>
<tr class="separator:a92b6545dc8a1d416fc5dd4cb152785c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa983f82b2ad0172f78ed1e9f6ba572f7" id="r_aa983f82b2ad0172f78ed1e9f6ba572f7"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa983f82b2ad0172f78ed1e9f6ba572f7">prepare_cgi_environment</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *prog, struct <a class="el" href="structcgi__environment.html">cgi_environment</a> *env, int cgi_config_idx)</td></tr>
<tr class="separator:aa983f82b2ad0172f78ed1e9f6ba572f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dd9b83e27accc1b564a11b3ff531c9d" id="r_a2dd9b83e27accc1b564a11b3ff531c9d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2dd9b83e27accc1b564a11b3ff531c9d">abort_cgi_process</a> (void *data)</td></tr>
<tr class="separator:a2dd9b83e27accc1b564a11b3ff531c9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af04594d5550fa7ce1f249ff3eed4c7d9" id="r_af04594d5550fa7ce1f249ff3eed4c7d9"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af04594d5550fa7ce1f249ff3eed4c7d9">handle_cgi_request</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *prog, int cgi_config_idx)</td></tr>
<tr class="separator:af04594d5550fa7ce1f249ff3eed4c7d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf278680b80623f1e661ef055c695533" id="r_abf278680b80623f1e661ef055c695533"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abf278680b80623f1e661ef055c695533">dav_mkcol</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:abf278680b80623f1e661ef055c695533"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97c47a9a92a85f9cfbc1ae8a28738e2a" id="r_a97c47a9a92a85f9cfbc1ae8a28738e2a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a97c47a9a92a85f9cfbc1ae8a28738e2a">get_uri_type</a> (const char *uri)</td></tr>
<tr class="separator:a97c47a9a92a85f9cfbc1ae8a28738e2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1504707625c62644c0951b656110b102" id="r_a1504707625c62644c0951b656110b102"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1504707625c62644c0951b656110b102">get_rel_url_at_current_server</a> (const char *uri, const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a1504707625c62644c0951b656110b102"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a367094998bdec220ff7ab52f60283dc2" id="r_a367094998bdec220ff7ab52f60283dc2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a367094998bdec220ff7ab52f60283dc2">dav_move_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, int do_copy)</td></tr>
<tr class="separator:a367094998bdec220ff7ab52f60283dc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a188d397634e66f50df4a25eb2b46b6eb" id="r_a188d397634e66f50df4a25eb2b46b6eb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a188d397634e66f50df4a25eb2b46b6eb">put_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a188d397634e66f50df4a25eb2b46b6eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2912c3ad9f0ba624b545a6f920ab5ddc" id="r_a2912c3ad9f0ba624b545a6f920ab5ddc"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2912c3ad9f0ba624b545a6f920ab5ddc">delete_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a2912c3ad9f0ba624b545a6f920ab5ddc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbfd2afe32d71961fea011337ee6e2b1" id="r_abbfd2afe32d71961fea011337ee6e2b1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abbfd2afe32d71961fea011337ee6e2b1">send_ssi_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *, const char *, struct <a class="el" href="structmg__file.html">mg_file</a> *, int)</td></tr>
<tr class="separator:abbfd2afe32d71961fea011337ee6e2b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ddc04f7aafa49c779fde3d73c2532a2" id="r_a8ddc04f7aafa49c779fde3d73c2532a2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8ddc04f7aafa49c779fde3d73c2532a2">do_ssi_include</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *ssi, char *tag, int include_level)</td></tr>
<tr class="separator:a8ddc04f7aafa49c779fde3d73c2532a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b2849ed5bfad2fe98c98852e26b065a" id="r_a1b2849ed5bfad2fe98c98852e26b065a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1b2849ed5bfad2fe98c98852e26b065a">do_ssi_exec</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *tag)</td></tr>
<tr class="separator:a1b2849ed5bfad2fe98c98852e26b065a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed4461cf7bdfb82230d646e48611be11" id="r_aed4461cf7bdfb82230d646e48611be11"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aed4461cf7bdfb82230d646e48611be11">mg_fgetc</a> (struct <a class="el" href="structmg__file.html">mg_file</a> *filep)</td></tr>
<tr class="separator:aed4461cf7bdfb82230d646e48611be11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81cf575b8d68d30c6e590015d8fe99ea" id="r_a81cf575b8d68d30c6e590015d8fe99ea"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a81cf575b8d68d30c6e590015d8fe99ea">handle_ssi_file_request</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, struct <a class="el" href="structmg__file.html">mg_file</a> *filep)</td></tr>
<tr class="separator:a81cf575b8d68d30c6e590015d8fe99ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9646ac874ed82c23be670eba105c0d8f" id="r_a9646ac874ed82c23be670eba105c0d8f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9646ac874ed82c23be670eba105c0d8f">send_options</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a9646ac874ed82c23be670eba105c0d8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5738d5648ed8e16019ec1c4f9976cc3" id="r_ae5738d5648ed8e16019ec1c4f9976cc3"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae5738d5648ed8e16019ec1c4f9976cc3">print_props</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *uri, const char *<a class="el" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *filep)</td></tr>
<tr class="separator:ae5738d5648ed8e16019ec1c4f9976cc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28aaebcd6e88f488e282f4f594119f8e" id="r_a28aaebcd6e88f488e282f4f594119f8e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a28aaebcd6e88f488e282f4f594119f8e">print_dav_dir_entry</a> (struct <a class="el" href="structde.html">de</a> *<a class="el" href="structde.html">de</a>, void *data)</td></tr>
<tr class="separator:a28aaebcd6e88f488e282f4f594119f8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1110e733e9c841ff0a605fada90b638" id="r_ab1110e733e9c841ff0a605fada90b638"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab1110e733e9c841ff0a605fada90b638">handle_propfind</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path, struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *filep)</td></tr>
<tr class="separator:ab1110e733e9c841ff0a605fada90b638"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b18e8f2e8a8ae569d9582857bcc7c19" id="r_a6b18e8f2e8a8ae569d9582857bcc7c19"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6b18e8f2e8a8ae569d9582857bcc7c19">dav_lock_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a6b18e8f2e8a8ae569d9582857bcc7c19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72d17299496dec4724fe359b9cc5fc50" id="r_a72d17299496dec4724fe359b9cc5fc50"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a72d17299496dec4724fe359b9cc5fc50">dav_unlock_file</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a72d17299496dec4724fe359b9cc5fc50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a393a2d03d9209602b28629421b382841" id="r_a393a2d03d9209602b28629421b382841"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a393a2d03d9209602b28629421b382841">dav_proppatch</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:a393a2d03d9209602b28629421b382841"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a149a7777de4ad5702dfc3a50271e6fb9" id="r_a149a7777de4ad5702dfc3a50271e6fb9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a149a7777de4ad5702dfc3a50271e6fb9">mg_lock_connection</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a149a7777de4ad5702dfc3a50271e6fb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23acf2c99018649c40b525c8bde45960" id="r_a23acf2c99018649c40b525c8bde45960"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a23acf2c99018649c40b525c8bde45960">mg_unlock_connection</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a23acf2c99018649c40b525c8bde45960"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0110b7fe742fb4ee2ab467151e4df7c2" id="r_a0110b7fe742fb4ee2ab467151e4df7c2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:a0110b7fe742fb4ee2ab467151e4df7c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40bc6a84aa4f6dc3af32fcb62e74a848" id="r_a40bc6a84aa4f6dc3af32fcb62e74a848"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:a40bc6a84aa4f6dc3af32fcb62e74a848"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b698a923a0e6fd848e0585cf2983d12" id="r_a0b698a923a0e6fd848e0585cf2983d12"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0b698a923a0e6fd848e0585cf2983d12">should_switch_to_protocol</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a0b698a923a0e6fd848e0585cf2983d12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a917f041b64f1819b9bb4fd8a57e0d945" id="r_a917f041b64f1819b9bb4fd8a57e0d945"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a917f041b64f1819b9bb4fd8a57e0d945">parse_match_net</a> (const struct <a class="el" href="structvec.html">vec</a> *<a class="el" href="structvec.html">vec</a>, const union <a class="el" href="unionusa.html">usa</a> *sa, int no_strict)</td></tr>
<tr class="separator:a917f041b64f1819b9bb4fd8a57e0d945"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84156e09ed2338602b0bda2a3734e1a4" id="r_a84156e09ed2338602b0bda2a3734e1a4"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a84156e09ed2338602b0bda2a3734e1a4">set_throttle</a> (const char *spec, const union <a class="el" href="unionusa.html">usa</a> *rsa, const char *uri)</td></tr>
<tr class="separator:a84156e09ed2338602b0bda2a3734e1a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73891c07a6e6af73b5b247b460c62bb3" id="r_a73891c07a6e6af73b5b247b460c62bb3"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a73891c07a6e6af73b5b247b460c62bb3">get_first_ssl_listener_index</a> (const struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:a73891c07a6e6af73b5b247b460c62bb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e23406129bfd98c4cbc037682b22343" id="r_a5e23406129bfd98c4cbc037682b22343"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5e23406129bfd98c4cbc037682b22343">get_host_from_request_info</a> (struct <a class="el" href="structvec.html">vec</a> *host, const struct <a class="el" href="structmg__request__info.html">mg_request_info</a> *ri)</td></tr>
<tr class="separator:a5e23406129bfd98c4cbc037682b22343"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a462e0cd852acad3eadee2621f126a1a0" id="r_a462e0cd852acad3eadee2621f126a1a0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a462e0cd852acad3eadee2621f126a1a0">switch_domain_context</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a462e0cd852acad3eadee2621f126a1a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a99e300d992194966483f9d6e77f214" id="r_a0a99e300d992194966483f9d6e77f214"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0a99e300d992194966483f9d6e77f214">redirect_to_https_port</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, int port)</td></tr>
<tr class="separator:a0a99e300d992194966483f9d6e77f214"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab7fcd7152bcc85bd49b2422f520db2f" id="r_aab7fcd7152bcc85bd49b2422f520db2f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aab7fcd7152bcc85bd49b2422f520db2f">mg_set_handler_type</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *phys_ctx, struct <a class="el" href="structmg__domain__context.html">mg_domain_context</a> *dom_ctx, const char *uri, int handler_type, int is_delete_request, <a class="el" href="civetweb_8h.html#ac452a63f6ff0d7fd18a143de72a7fd08">mg_request_handler</a> handler, struct <a class="el" href="structmg__websocket__subprotocols.html">mg_websocket_subprotocols</a> *subprotocols, <a class="el" href="civetweb_8h.html#ae1e201a8ea4f6895a8cc4e2e2c58da03">mg_websocket_connect_handler</a> connect_handler, <a class="el" href="civetweb_8h.html#a5b940f052d5de72f651a9a1e810bed0f">mg_websocket_ready_handler</a> ready_handler, <a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> data_handler, <a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> close_handler, <a class="el" href="civetweb_8h.html#a3e8733a4d6d7ae85f0daec45df36f024">mg_authorization_handler</a> auth_handler, void *cbdata)</td></tr>
<tr class="separator:aab7fcd7152bcc85bd49b2422f520db2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef622eb42a2ac7fcc825620b952a36dc" id="r_aef622eb42a2ac7fcc825620b952a36dc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aef622eb42a2ac7fcc825620b952a36dc">mg_set_request_handler</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, const char *uri, <a class="el" href="civetweb_8h.html#ac452a63f6ff0d7fd18a143de72a7fd08">mg_request_handler</a> handler, void *cbdata)</td></tr>
<tr class="separator:aef622eb42a2ac7fcc825620b952a36dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37cd18006941f3abb1538db60cf4f805" id="r_a37cd18006941f3abb1538db60cf4f805"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a37cd18006941f3abb1538db60cf4f805">mg_set_websocket_handler</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, const char *uri, <a class="el" href="civetweb_8h.html#ae1e201a8ea4f6895a8cc4e2e2c58da03">mg_websocket_connect_handler</a> connect_handler, <a class="el" href="civetweb_8h.html#a5b940f052d5de72f651a9a1e810bed0f">mg_websocket_ready_handler</a> ready_handler, <a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> data_handler, <a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> close_handler, void *cbdata)</td></tr>
<tr class="separator:a37cd18006941f3abb1538db60cf4f805"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07eff82d8b7be88f16ba1a1653d09d3d" id="r_a07eff82d8b7be88f16ba1a1653d09d3d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a07eff82d8b7be88f16ba1a1653d09d3d">mg_set_websocket_handler_with_subprotocols</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, const char *uri, struct <a class="el" href="structmg__websocket__subprotocols.html">mg_websocket_subprotocols</a> *subprotocols, <a class="el" href="civetweb_8h.html#ae1e201a8ea4f6895a8cc4e2e2c58da03">mg_websocket_connect_handler</a> connect_handler, <a class="el" href="civetweb_8h.html#a5b940f052d5de72f651a9a1e810bed0f">mg_websocket_ready_handler</a> ready_handler, <a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> data_handler, <a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> close_handler, void *cbdata)</td></tr>
<tr class="separator:a07eff82d8b7be88f16ba1a1653d09d3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cacb89c8bc07d18aa4d895d154653a9" id="r_a8cacb89c8bc07d18aa4d895d154653a9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8cacb89c8bc07d18aa4d895d154653a9">mg_set_auth_handler</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, const char *uri, <a class="el" href="civetweb_8h.html#a3e8733a4d6d7ae85f0daec45df36f024">mg_authorization_handler</a> handler, void *cbdata)</td></tr>
<tr class="separator:a8cacb89c8bc07d18aa4d895d154653a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abff1b1a2d706ca9cd15c954196418119" id="r_abff1b1a2d706ca9cd15c954196418119"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abff1b1a2d706ca9cd15c954196418119">get_request_handler</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, int handler_type, <a class="el" href="civetweb_8h.html#ac452a63f6ff0d7fd18a143de72a7fd08">mg_request_handler</a> *handler, struct <a class="el" href="structmg__websocket__subprotocols.html">mg_websocket_subprotocols</a> **subprotocols, <a class="el" href="civetweb_8h.html#ae1e201a8ea4f6895a8cc4e2e2c58da03">mg_websocket_connect_handler</a> *connect_handler, <a class="el" href="civetweb_8h.html#a5b940f052d5de72f651a9a1e810bed0f">mg_websocket_ready_handler</a> *ready_handler, <a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> *data_handler, <a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> *close_handler, <a class="el" href="civetweb_8h.html#a3e8733a4d6d7ae85f0daec45df36f024">mg_authorization_handler</a> *auth_handler, void **cbdata, struct <a class="el" href="structmg__handler__info.html">mg_handler_info</a> **handler_info)</td></tr>
<tr class="separator:abff1b1a2d706ca9cd15c954196418119"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4e67843460a2634c2ccd7f1f0343877" id="r_ac4e67843460a2634c2ccd7f1f0343877"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac4e67843460a2634c2ccd7f1f0343877">is_in_script_path</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *path)</td></tr>
<tr class="separator:ac4e67843460a2634c2ccd7f1f0343877"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96d08ddca4fe56dbb1647c8e250db9b3" id="r_a96d08ddca4fe56dbb1647c8e250db9b3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a96d08ddca4fe56dbb1647c8e250db9b3">release_handler_ref</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, struct <a class="el" href="structmg__handler__info.html">mg_handler_info</a> *handler_info)</td></tr>
<tr class="separator:a96d08ddca4fe56dbb1647c8e250db9b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c23cebc85fcd88f7a1cf2227a7e1889" id="r_a3c23cebc85fcd88f7a1cf2227a7e1889"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3c23cebc85fcd88f7a1cf2227a7e1889">close_all_listening_sockets</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:a3c23cebc85fcd88f7a1cf2227a7e1889"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7326cd5fb1c2444cbce208b8c7005581" id="r_a7326cd5fb1c2444cbce208b8c7005581"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7326cd5fb1c2444cbce208b8c7005581">parse_port_string</a> (const struct <a class="el" href="structvec.html">vec</a> *<a class="el" href="structvec.html">vec</a>, struct <a class="el" href="structsocket.html">socket</a> *so, int *ip_version)</td></tr>
<tr class="separator:a7326cd5fb1c2444cbce208b8c7005581"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3eb055e17e5fa3eb02ce4873e76e884" id="r_ae3eb055e17e5fa3eb02ce4873e76e884"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae3eb055e17e5fa3eb02ce4873e76e884">is_ssl_port_used</a> (const char *ports)</td></tr>
<tr class="separator:ae3eb055e17e5fa3eb02ce4873e76e884"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c6eca1c5a3388266a2d289ce34fda58" id="r_a7c6eca1c5a3388266a2d289ce34fda58"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7c6eca1c5a3388266a2d289ce34fda58">set_ports_option</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *phys_ctx)</td></tr>
<tr class="separator:a7c6eca1c5a3388266a2d289ce34fda58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bd30673001e62b1d44baa0caeb0da97" id="r_a9bd30673001e62b1d44baa0caeb0da97"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9bd30673001e62b1d44baa0caeb0da97">header_val</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, const char *header)</td></tr>
<tr class="separator:a9bd30673001e62b1d44baa0caeb0da97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a413ce152f72e5e12647a950de90d589f" id="r_a413ce152f72e5e12647a950de90d589f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a413ce152f72e5e12647a950de90d589f">check_acl</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *phys_ctx, const union <a class="el" href="unionusa.html">usa</a> *sa)</td></tr>
<tr class="separator:a413ce152f72e5e12647a950de90d589f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a462b35ed3af5d8e9f56280956ee1839e" id="r_a462b35ed3af5d8e9f56280956ee1839e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a462b35ed3af5d8e9f56280956ee1839e">set_uid_option</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *phys_ctx)</td></tr>
<tr class="separator:a462b35ed3af5d8e9f56280956ee1839e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b3061c039f873bc927e2947b4e46bae" id="r_a1b3061c039f873bc927e2947b4e46bae"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1b3061c039f873bc927e2947b4e46bae">tls_dtor</a> (void *key)</td></tr>
<tr class="separator:a1b3061c039f873bc927e2947b4e46bae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36ba2de78f1cacfe1b95106a834b970d" id="r_a36ba2de78f1cacfe1b95106a834b970d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a36ba2de78f1cacfe1b95106a834b970d">ssl_use_pem_file</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *phys_ctx, struct <a class="el" href="structmg__domain__context.html">mg_domain_context</a> *dom_ctx, const char *pem, const char *chain)</td></tr>
<tr class="separator:a36ba2de78f1cacfe1b95106a834b970d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3754dec11e945be1db7482091a4cd5ae" id="r_a3754dec11e945be1db7482091a4cd5ae"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a> (void)</td></tr>
<tr class="separator:a3754dec11e945be1db7482091a4cd5ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8716e2019c3e5ecd4abc75a272d7aa7" id="r_ac8716e2019c3e5ecd4abc75a272d7aa7"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac8716e2019c3e5ecd4abc75a272d7aa7">refresh_trust</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ac8716e2019c3e5ecd4abc75a272d7aa7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5ddf37dfcbb5287702f50354be5ab54" id="r_ac5ddf37dfcbb5287702f50354be5ab54"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac5ddf37dfcbb5287702f50354be5ab54">sslize</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, int(*func)(SSL *), const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *client_options)</td></tr>
<tr class="separator:ac5ddf37dfcbb5287702f50354be5ab54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79a94c1836be39ee8d6bcbee626493c5" id="r_a79a94c1836be39ee8d6bcbee626493c5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a79a94c1836be39ee8d6bcbee626493c5">hexdump2string</a> (void *mem, int memlen, char *buf, int buflen)</td></tr>
<tr class="separator:a79a94c1836be39ee8d6bcbee626493c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cf68e4c3856f86612a53eac755c36fe" id="r_a1cf68e4c3856f86612a53eac755c36fe"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1cf68e4c3856f86612a53eac755c36fe">ssl_get_client_cert_info</a> (const struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, struct <a class="el" href="structmg__client__cert.html">mg_client_cert</a> *client_cert)</td></tr>
<tr class="separator:a1cf68e4c3856f86612a53eac755c36fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1483ed6424f4762bba17221c2be5e7b1" id="r_a1483ed6424f4762bba17221c2be5e7b1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1483ed6424f4762bba17221c2be5e7b1">ssl_locking_callback</a> (int mode, int mutex_num, const char *file, int line)</td></tr>
<tr class="separator:a1483ed6424f4762bba17221c2be5e7b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7dcb20f5797258e244f21fc4d62ce828" id="r_a7dcb20f5797258e244f21fc4d62ce828"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7dcb20f5797258e244f21fc4d62ce828">load_tls_dll</a> (char *ebuf, size_t ebuf_len, const char *dll_name, struct ssl_func *sw, int *feature_missing)</td></tr>
<tr class="separator:a7dcb20f5797258e244f21fc4d62ce828"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5e3c74304e46cc4c4774c35bf248d99" id="r_af5e3c74304e46cc4c4774c35bf248d99"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af5e3c74304e46cc4c4774c35bf248d99">initialize_openssl</a> (char *ebuf, size_t ebuf_len)</td></tr>
<tr class="separator:af5e3c74304e46cc4c4774c35bf248d99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a542ed428fa93885ec11ff0e8aabf1768" id="r_a542ed428fa93885ec11ff0e8aabf1768"><td class="memItemLeft" align="right" valign="top">static long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a542ed428fa93885ec11ff0e8aabf1768">ssl_get_protocol</a> (int version_id)</td></tr>
<tr class="separator:a542ed428fa93885ec11ff0e8aabf1768"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84798111da4d1707bb9ab1ba73b1e072" id="r_a84798111da4d1707bb9ab1ba73b1e072"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a84798111da4d1707bb9ab1ba73b1e072">ssl_info_callback</a> (const SSL *ssl, int what, int ret)</td></tr>
<tr class="separator:a84798111da4d1707bb9ab1ba73b1e072"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a634412d7196b236a4abb02caa0ea2d5a" id="r_a634412d7196b236a4abb02caa0ea2d5a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a634412d7196b236a4abb02caa0ea2d5a">ssl_servername_callback</a> (SSL *ssl, int *ad, void *<a class="el" href="curl_8h.html#a7d68018e95e3d4e6b703538ac1c8c411">arg</a>)</td></tr>
<tr class="separator:a634412d7196b236a4abb02caa0ea2d5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69044be28d28031d573838a7bbf2168d" id="r_a69044be28d28031d573838a7bbf2168d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a69044be28d28031d573838a7bbf2168d">init_ssl_ctx_impl</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *phys_ctx, struct <a class="el" href="structmg__domain__context.html">mg_domain_context</a> *dom_ctx, const char *pem, const char *chain)</td></tr>
<tr class="separator:a69044be28d28031d573838a7bbf2168d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2d6e50236af5e059e4c3e28cc232cff" id="r_ae2d6e50236af5e059e4c3e28cc232cff"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae2d6e50236af5e059e4c3e28cc232cff">init_ssl_ctx</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *phys_ctx, struct <a class="el" href="structmg__domain__context.html">mg_domain_context</a> *dom_ctx)</td></tr>
<tr class="separator:ae2d6e50236af5e059e4c3e28cc232cff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e8a676fa79a0e0095c1ebfeab44b224" id="r_a8e8a676fa79a0e0095c1ebfeab44b224"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e8a676fa79a0e0095c1ebfeab44b224">uninitialize_openssl</a> (void)</td></tr>
<tr class="separator:a8e8a676fa79a0e0095c1ebfeab44b224"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c0f85beb9e4157e5da9ad2550fc2258" id="r_a6c0f85beb9e4157e5da9ad2550fc2258"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6c0f85beb9e4157e5da9ad2550fc2258">set_gpass_option</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *phys_ctx, struct <a class="el" href="structmg__domain__context.html">mg_domain_context</a> *dom_ctx)</td></tr>
<tr class="separator:a6c0f85beb9e4157e5da9ad2550fc2258"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9dc4b721d5bb3b8e494257027050c47f" id="r_a9dc4b721d5bb3b8e494257027050c47f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9dc4b721d5bb3b8e494257027050c47f">set_acl_option</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *phys_ctx)</td></tr>
<tr class="separator:a9dc4b721d5bb3b8e494257027050c47f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4724fafa5fdbf347cf779ffe4bc28c23" id="r_a4724fafa5fdbf347cf779ffe4bc28c23"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4724fafa5fdbf347cf779ffe4bc28c23">reset_per_request_attributes</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a4724fafa5fdbf347cf779ffe4bc28c23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7003e9382b3b817de6ae349d754e2077" id="r_a7003e9382b3b817de6ae349d754e2077"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7003e9382b3b817de6ae349d754e2077">set_tcp_nodelay</a> (const struct <a class="el" href="structsocket.html">socket</a> *so, int nodelay_on)</td></tr>
<tr class="separator:a7003e9382b3b817de6ae349d754e2077"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2e9d446a299e9cedc4c267b7cae5419" id="r_ae2e9d446a299e9cedc4c267b7cae5419"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae2e9d446a299e9cedc4c267b7cae5419">close_socket_gracefully</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ae2e9d446a299e9cedc4c267b7cae5419"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4b9971ca12d36d97d92dd7980059fb0" id="r_af4b9971ca12d36d97d92dd7980059fb0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af4b9971ca12d36d97d92dd7980059fb0">close_connection</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:af4b9971ca12d36d97d92dd7980059fb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3c0b2bb9143f8eebd7c4c12fc4f0333" id="r_ae3c0b2bb9143f8eebd7c4c12fc4f0333"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae3c0b2bb9143f8eebd7c4c12fc4f0333">mg_close_connection</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ae3c0b2bb9143f8eebd7c4c12fc4f0333"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc29128579a051d08c3d735ea3e1de2f" id="r_adc29128579a051d08c3d735ea3e1de2f"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structmg__connection.html">mg_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adc29128579a051d08c3d735ea3e1de2f">mg_connect_client_impl</a> (const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *client_options, int use_ssl, struct <a class="el" href="structmg__init__data.html">mg_init_data</a> *init, struct <a class="el" href="structmg__error__data.html">mg_error_data</a> *<a class="el" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>)</td></tr>
<tr class="separator:adc29128579a051d08c3d735ea3e1de2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0900e7049ba69cd81fd36844820ae95" id="r_aa0900e7049ba69cd81fd36844820ae95"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa0900e7049ba69cd81fd36844820ae95">mg_connect_client_secure</a> (const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *client_options, char *error_buffer, size_t error_buffer_size)</td></tr>
<tr class="separator:aa0900e7049ba69cd81fd36844820ae95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace350941110e963aeb1ce985260c6a51" id="r_ace350941110e963aeb1ce985260c6a51"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ace350941110e963aeb1ce985260c6a51">mg_connect_client</a> (const char *host, int port, int use_ssl, char *error_buffer, size_t error_buffer_size)</td></tr>
<tr class="separator:ace350941110e963aeb1ce985260c6a51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52c707b5a0f04dc2908850d5a93068fc" id="r_a52c707b5a0f04dc2908850d5a93068fc"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a52c707b5a0f04dc2908850d5a93068fc">get_message</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *ebuf, size_t ebuf_len, int *err)</td></tr>
<tr class="separator:a52c707b5a0f04dc2908850d5a93068fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fa7879a104cf3bdc5ae2c901b354520" id="r_a6fa7879a104cf3bdc5ae2c901b354520"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6fa7879a104cf3bdc5ae2c901b354520">get_request</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *ebuf, size_t ebuf_len, int *err)</td></tr>
<tr class="separator:a6fa7879a104cf3bdc5ae2c901b354520"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a453db96888b9c0e4b7afd85f3778afb2" id="r_a453db96888b9c0e4b7afd85f3778afb2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a453db96888b9c0e4b7afd85f3778afb2">get_response</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *ebuf, size_t ebuf_len, int *err)</td></tr>
<tr class="separator:a453db96888b9c0e4b7afd85f3778afb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b725ab96450f33c87ab3ef5e7e8baab" id="r_a6b725ab96450f33c87ab3ef5e7e8baab"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6b725ab96450f33c87ab3ef5e7e8baab">mg_get_response</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn, char *ebuf, size_t ebuf_len, int timeout)</td></tr>
<tr class="separator:a6b725ab96450f33c87ab3ef5e7e8baab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a641f57d35a9decf941d198a92ba10b64" id="r_a641f57d35a9decf941d198a92ba10b64"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a641f57d35a9decf941d198a92ba10b64">mg_download</a> (const char *host, int port, int use_ssl, char *ebuf, size_t ebuf_len, const char *fmt,...)</td></tr>
<tr class="separator:a641f57d35a9decf941d198a92ba10b64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaf75d5a293cb52138c36e0b7a4fb0e4" id="r_adaf75d5a293cb52138c36e0b7a4fb0e4"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structmg__connection.html">mg_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adaf75d5a293cb52138c36e0b7a4fb0e4">mg_connect_websocket_client_impl</a> (const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *client_options, int use_ssl, char *error_buffer, size_t error_buffer_size, const char *path, const char *origin, const char *extensions, <a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> data_func, <a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> <a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>, void *user_data)</td></tr>
<tr class="separator:adaf75d5a293cb52138c36e0b7a4fb0e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5da8b47d8e2795d68cccc0f72b231835" id="r_a5da8b47d8e2795d68cccc0f72b231835"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5da8b47d8e2795d68cccc0f72b231835">mg_connect_websocket_client</a> (const char *host, int port, int use_ssl, char *error_buffer, size_t error_buffer_size, const char *path, const char *origin, <a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> data_func, <a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> <a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>, void *user_data)</td></tr>
<tr class="separator:a5da8b47d8e2795d68cccc0f72b231835"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82872c373eedb743614f2df8653a1fb9" id="r_a82872c373eedb743614f2df8653a1fb9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a82872c373eedb743614f2df8653a1fb9">mg_connect_websocket_client_secure</a> (const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *client_options, char *error_buffer, size_t error_buffer_size, const char *path, const char *origin, <a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> data_func, <a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> <a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>, void *user_data)</td></tr>
<tr class="separator:a82872c373eedb743614f2df8653a1fb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfcb6a406ff449ca3eb9b78ab37805d4" id="r_adfcb6a406ff449ca3eb9b78ab37805d4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adfcb6a406ff449ca3eb9b78ab37805d4">mg_connect_websocket_client_extensions</a> (const char *host, int port, int use_ssl, char *error_buffer, size_t error_buffer_size, const char *path, const char *origin, const char *extensions, <a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> data_func, <a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> <a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>, void *user_data)</td></tr>
<tr class="separator:adfcb6a406ff449ca3eb9b78ab37805d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c7dc2b030def4a350fecbb70652aaa0" id="r_a6c7dc2b030def4a350fecbb70652aaa0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6c7dc2b030def4a350fecbb70652aaa0">mg_connect_websocket_client_secure_extensions</a> (const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *client_options, char *error_buffer, size_t error_buffer_size, const char *path, const char *origin, const char *extensions, <a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> data_func, <a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> <a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>, void *user_data)</td></tr>
<tr class="separator:a6c7dc2b030def4a350fecbb70652aaa0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae40e268aca47c39d1f151a60655f3f70" id="r_ae40e268aca47c39d1f151a60655f3f70"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae40e268aca47c39d1f151a60655f3f70">init_connection</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:ae40e268aca47c39d1f151a60655f3f70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00335d9fbef2e339b4ede6983b97b906" id="r_a00335d9fbef2e339b4ede6983b97b906"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a00335d9fbef2e339b4ede6983b97b906">process_new_connection</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a00335d9fbef2e339b4ede6983b97b906"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02b40bbcf0b155e706e5e1eb6b53309e" id="r_a02b40bbcf0b155e706e5e1eb6b53309e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a02b40bbcf0b155e706e5e1eb6b53309e">consume_socket</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, struct <a class="el" href="structsocket.html">socket</a> *sp, int thread_index)</td></tr>
<tr class="separator:a02b40bbcf0b155e706e5e1eb6b53309e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe51474dc2a44ce44de63053a1581ae8" id="r_abe51474dc2a44ce44de63053a1581ae8"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abe51474dc2a44ce44de63053a1581ae8">produce_socket</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, const struct <a class="el" href="structsocket.html">socket</a> *sp)</td></tr>
<tr class="separator:abe51474dc2a44ce44de63053a1581ae8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9686d5ea75649460c042ed8f39a0be9" id="r_aa9686d5ea75649460c042ed8f39a0be9"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa9686d5ea75649460c042ed8f39a0be9">worker_thread_run</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:aa9686d5ea75649460c042ed8f39a0be9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbe073c81a7fabd2785914e1b4a8e3d0" id="r_adbe073c81a7fabd2785914e1b4a8e3d0"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adbe073c81a7fabd2785914e1b4a8e3d0">worker_thread</a> (void *thread_func_param)</td></tr>
<tr class="separator:adbe073c81a7fabd2785914e1b4a8e3d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5231c9ac67e436368ba0fd12a7406701" id="r_a5231c9ac67e436368ba0fd12a7406701"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5231c9ac67e436368ba0fd12a7406701">accept_new_connection</a> (const struct <a class="el" href="structsocket.html">socket</a> *listener, struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:a5231c9ac67e436368ba0fd12a7406701"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4eeba62c0424eafcf42845c3688e81b2" id="r_a4eeba62c0424eafcf42845c3688e81b2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4eeba62c0424eafcf42845c3688e81b2">master_thread_run</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:a4eeba62c0424eafcf42845c3688e81b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab5946d38d4ebb16c9dc8cd45a913e99" id="r_aab5946d38d4ebb16c9dc8cd45a913e99"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aab5946d38d4ebb16c9dc8cd45a913e99">master_thread</a> (void *thread_func_param)</td></tr>
<tr class="separator:aab5946d38d4ebb16c9dc8cd45a913e99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac591487b5ffc826f4824c8c1d9a4caaa" id="r_ac591487b5ffc826f4824c8c1d9a4caaa"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:ac591487b5ffc826f4824c8c1d9a4caaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a442a9f9023051aa5e12cc2bea06e55d1" id="r_a442a9f9023051aa5e12cc2bea06e55d1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a442a9f9023051aa5e12cc2bea06e55d1">mg_stop</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx)</td></tr>
<tr class="separator:a442a9f9023051aa5e12cc2bea06e55d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99d34b5bd845aa051904a159156abc26" id="r_a99d34b5bd845aa051904a159156abc26"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a99d34b5bd845aa051904a159156abc26">get_system_name</a> (char **sysName)</td></tr>
<tr class="separator:a99d34b5bd845aa051904a159156abc26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac610da3b9f5e065811120249a2f488ac" id="r_ac610da3b9f5e065811120249a2f488ac"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac610da3b9f5e065811120249a2f488ac">legacy_init</a> (const char **options)</td></tr>
<tr class="separator:ac610da3b9f5e065811120249a2f488ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a220e3ffb5ea3741a7c830a9668068617" id="r_a220e3ffb5ea3741a7c830a9668068617"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__context.html">mg_context</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a220e3ffb5ea3741a7c830a9668068617">mg_start2</a> (struct <a class="el" href="structmg__init__data.html">mg_init_data</a> *init, struct <a class="el" href="structmg__error__data.html">mg_error_data</a> *<a class="el" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>)</td></tr>
<tr class="separator:a220e3ffb5ea3741a7c830a9668068617"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe23ebea2d4b96873ad9b99d092af4a0" id="r_abe23ebea2d4b96873ad9b99d092af4a0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__context.html">mg_context</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abe23ebea2d4b96873ad9b99d092af4a0">mg_start</a> (const struct <a class="el" href="structmg__callbacks.html">mg_callbacks</a> *callbacks, void *user_data, const char **options)</td></tr>
<tr class="separator:abe23ebea2d4b96873ad9b99d092af4a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0483d8dd6ede11edee9fb9fa38e88cf6" id="r_a0483d8dd6ede11edee9fb9fa38e88cf6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0483d8dd6ede11edee9fb9fa38e88cf6">mg_start_domain2</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, const char **options, struct <a class="el" href="structmg__error__data.html">mg_error_data</a> *<a class="el" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>)</td></tr>
<tr class="separator:a0483d8dd6ede11edee9fb9fa38e88cf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a006e38be839d7fa4b17e199f108364c7" id="r_a006e38be839d7fa4b17e199f108364c7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a006e38be839d7fa4b17e199f108364c7">mg_start_domain</a> (struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, const char **options)</td></tr>
<tr class="separator:a006e38be839d7fa4b17e199f108364c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6e4a71c131991d1bf9dac0c74b7e8b2" id="r_ad6e4a71c131991d1bf9dac0c74b7e8b2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a> (unsigned feature)</td></tr>
<tr class="separator:ad6e4a71c131991d1bf9dac0c74b7e8b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56edd9d2b1961442b88fb2e0419cdac8" id="r_a56edd9d2b1961442b88fb2e0419cdac8"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a> (char **dst, char *end, const char *src)</td></tr>
<tr class="separator:a56edd9d2b1961442b88fb2e0419cdac8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7b80bf53a5b2c2453734e64203d3f7e" id="r_af7b80bf53a5b2c2453734e64203d3f7e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af7b80bf53a5b2c2453734e64203d3f7e">mg_get_system_info</a> (char *buffer, int buflen)</td></tr>
<tr class="separator:af7b80bf53a5b2c2453734e64203d3f7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73bb6d799210c1e057478648919f8fa8" id="r_a73bb6d799210c1e057478648919f8fa8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a73bb6d799210c1e057478648919f8fa8">mg_get_context_info</a> (const struct <a class="el" href="structmg__context.html">mg_context</a> *ctx, char *buffer, int buflen)</td></tr>
<tr class="separator:a73bb6d799210c1e057478648919f8fa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e467f9e2b0dcca696fbbd1da1a01f21" id="r_a9e467f9e2b0dcca696fbbd1da1a01f21"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9e467f9e2b0dcca696fbbd1da1a01f21">mg_disable_connection_keep_alive</a> (struct <a class="el" href="structmg__connection.html">mg_connection</a> *conn)</td></tr>
<tr class="separator:a9e467f9e2b0dcca696fbbd1da1a01f21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6e9ad2a3e4f0beb2a938f52c3df50a9" id="r_ac6e9ad2a3e4f0beb2a938f52c3df50a9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac6e9ad2a3e4f0beb2a938f52c3df50a9">mg_init_library</a> (unsigned features)</td></tr>
<tr class="separator:ac6e9ad2a3e4f0beb2a938f52c3df50a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f1f2195be687bba095938a263869d61" id="r_a6f1f2195be687bba095938a263869d61"><td class="memItemLeft" align="right" valign="top"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6f1f2195be687bba095938a263869d61">mg_exit_library</a> (void)</td></tr>
<tr class="separator:a6f1f2195be687bba095938a263869d61"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0553b9f90d6c0d22c73cf05ffe81b708" id="r_a0553b9f90d6c0d22c73cf05ffe81b708"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0553b9f90d6c0d22c73cf05ffe81b708">static_assert_replacement</a> [1]</td></tr>
<tr class="separator:a0553b9f90d6c0d22c73cf05ffe81b708"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fea1ce44dd3b119b5edd85d330d8143" id="r_a5fea1ce44dd3b119b5edd85d330d8143"><td class="memItemLeft" align="right" valign="top">static pthread_mutexattr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a></td></tr>
<tr class="separator:a5fea1ce44dd3b119b5edd85d330d8143"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52fa011c62bacc213572e7464ca702dd" id="r_a52fa011c62bacc213572e7464ca702dd"><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a52fa011c62bacc213572e7464ca702dd">global_lock_mutex</a></td></tr>
<tr class="separator:a52fa011c62bacc213572e7464ca702dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a553c3bf49335ca7c4ef0af9293ff30cb" id="r_a553c3bf49335ca7c4ef0af9293ff30cb"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a> = 0</td></tr>
<tr class="separator:a553c3bf49335ca7c4ef0af9293ff30cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03c9b752bc27bdf5941ddde6f615dd44" id="r_a03c9b752bc27bdf5941ddde6f615dd44"><td class="memItemLeft" align="right" valign="top">static pthread_key_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a></td></tr>
<tr class="separator:a03c9b752bc27bdf5941ddde6f615dd44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af79aed9cc77304a39b3e031b2730e38b" id="r_af79aed9cc77304a39b3e031b2730e38b"><td class="memItemLeft" align="right" valign="top">static volatile ptrdiff_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af79aed9cc77304a39b3e031b2730e38b">thread_idx_max</a> = 0</td></tr>
<tr class="separator:af79aed9cc77304a39b3e031b2730e38b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5012c7bf061f74574b046e588f9e6342" id="r_a5012c7bf061f74574b046e588f9e6342"><td class="memItemLeft" align="right" valign="top">static const char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5012c7bf061f74574b046e588f9e6342">month_names</a> [][4]</td></tr>
<tr class="separator:a5012c7bf061f74574b046e588f9e6342"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a414393f1a7ad731456acc279c62290d0" id="r_a414393f1a7ad731456acc279c62290d0"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="structmg__option.html">mg_option</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a414393f1a7ad731456acc279c62290d0">config_options</a> []</td></tr>
<tr class="separator:a414393f1a7ad731456acc279c62290d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76f932e4783a1729837a1ea72e730127" id="r_a76f932e4783a1729837a1ea72e730127"><td class="memItemLeft" >struct {&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dcff35abc81122d9eca38bbafef1432" id="r_a5dcff35abc81122d9eca38bbafef1432"><td class="memItemLeft" >&#160;&#160;&#160;const char *&#160;&#160;&#160;<a class="el" href="#a3a21b674a056eab8a11436300ae02d00">extension</a>&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a5dcff35abc81122d9eca38bbafef1432"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a564a5651dabca3b39aacf0495cab4bfa" id="r_a564a5651dabca3b39aacf0495cab4bfa"><td class="memItemLeft" >&#160;&#160;&#160;size_t&#160;&#160;&#160;<a class="el" href="#a267ce87a2a38d9f1e99d345dbde97c28">ext_len</a>&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a564a5651dabca3b39aacf0495cab4bfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abea9faaa8440f3a58c38c7596b7865f1" id="r_abea9faaa8440f3a58c38c7596b7865f1"><td class="memItemLeft" >&#160;&#160;&#160;const char *&#160;&#160;&#160;<a class="el" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a>&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:abea9faaa8440f3a58c38c7596b7865f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76f932e4783a1729837a1ea72e730127" id="r_a76f932e4783a1729837a1ea72e730127"><td class="memItemLeft" valign="top">}&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a76f932e4783a1729837a1ea72e730127">builtin_mime_types</a> []&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a76f932e4783a1729837a1ea72e730127"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b17944603d3fb09046b30ffef0cbfc6" id="r_a7b17944603d3fb09046b30ffef0cbfc6"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="structmg__http__method__info.html">mg_http_method_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7b17944603d3fb09046b30ffef0cbfc6">http_methods</a> []</td></tr>
<tr class="separator:a7b17944603d3fb09046b30ffef0cbfc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c57fa7eeaaed403927368aa20e4efd5" id="r_a8c57fa7eeaaed403927368aa20e4efd5"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a> = <a class="el" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></td></tr>
<tr class="separator:a8c57fa7eeaaed403927368aa20e4efd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bb32ca4bd6292bd0d47491d9b7b3996" id="r_a4bb32ca4bd6292bd0d47491d9b7b3996"><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a></td></tr>
<tr class="separator:a4bb32ca4bd6292bd0d47491d9b7b3996"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeca28977786ca2960224e23c8c19d8ca" id="r_aeca28977786ca2960224e23c8c19d8ca"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeca28977786ca2960224e23c8c19d8ca">ssllib_dll_handle</a></td></tr>
<tr class="separator:aeca28977786ca2960224e23c8c19d8ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6ec95caddfbfbbe177b2e95ec9d17b3" id="r_ad6ec95caddfbfbbe177b2e95ec9d17b3"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad6ec95caddfbfbbe177b2e95ec9d17b3">cryptolib_dll_handle</a></td></tr>
<tr class="separator:ad6ec95caddfbfbbe177b2e95ec9d17b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5254c431a0b51011fbb000d383bf56fd" id="r_a5254c431a0b51011fbb000d383bf56fd"><td class="memItemLeft" align="right" valign="top">static volatile ptrdiff_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5254c431a0b51011fbb000d383bf56fd">cryptolib_users</a></td></tr>
<tr class="separator:a5254c431a0b51011fbb000d383bf56fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75d2d9abb3e5abaaf44e99b9f805f07a" id="r_a75d2d9abb3e5abaaf44e99b9f805f07a"><td class="memItemLeft" >struct {&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a334ec5426a35ac75307a4d782dac2690" id="r_a334ec5426a35ac75307a4d782dac2690"><td class="memItemLeft" >&#160;&#160;&#160;const char *&#160;&#160;&#160;<a class="el" href="#a1491042fd5b61bf39023b8df4c736128">proto</a>&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a334ec5426a35ac75307a4d782dac2690"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5345a99714494c0127de3498c2417d7c" id="r_a5345a99714494c0127de3498c2417d7c"><td class="memItemLeft" >&#160;&#160;&#160;size_t&#160;&#160;&#160;<a class="el" href="#ae76eb848818055987d653483ac38ec19">proto_len</a>&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a5345a99714494c0127de3498c2417d7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed8f076c16cf91982780e568b369e569" id="r_aed8f076c16cf91982780e568b369e569"><td class="memItemLeft" >&#160;&#160;&#160;unsigned&#160;&#160;&#160;<a class="el" href="#a44d2ac6d2bf6a4654389c5e778e7414c">default_port</a>&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:aed8f076c16cf91982780e568b369e569"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75d2d9abb3e5abaaf44e99b9f805f07a" id="r_a75d2d9abb3e5abaaf44e99b9f805f07a"><td class="memItemLeft" valign="top">}&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a> []&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a75d2d9abb3e5abaaf44e99b9f805f07a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="aacbb9e1f38be71e22df1584a37c56693" name="aacbb9e1f38be71e22df1584a37c56693"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacbb9e1f38be71e22df1584a37c56693">&#9670;&#160;</a></span>__STDC_FORMAT_MACROS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __STDC_FORMAT_MACROS&#160;&#160;&#160;/* &lt;inttypes.h&gt; wants this for C++ */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00075">75</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="aeb7e7a856ab7a794b05b6b63ef36ea3e" name="aeb7e7a856ab7a794b05b6b63ef36ea3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb7e7a856ab7a794b05b6b63ef36ea3e">&#9670;&#160;</a></span>__STDC_LIMIT_MACROS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __STDC_LIMIT_MACROS&#160;&#160;&#160;/* C++ wants that for <a class="el" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a> */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00078">78</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a9957270f5cc62e546073406dd1ec640d" name="a9957270f5cc62e546073406dd1ec640d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9957270f5cc62e546073406dd1ec640d">&#9670;&#160;</a></span>_DARWIN_UNLIMITED_SELECT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _DARWIN_UNLIMITED_SELECT</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00081">81</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a44d01ba0a136b8e27ad362f5a823d14e" name="a44d01ba0a136b8e27ad362f5a823d14e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44d01ba0a136b8e27ad362f5a823d14e">&#9670;&#160;</a></span>_FILE_OFFSET_BITS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _FILE_OFFSET_BITS&#160;&#160;&#160;64 /* Use 64-bit file offsets by default */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00072">72</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a369266c24eacffb87046522897a570d5" name="a369266c24eacffb87046522897a570d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a369266c24eacffb87046522897a570d5">&#9670;&#160;</a></span>_GNU_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _GNU_SOURCE&#160;&#160;&#160;/* for setgroups(), pthread_setname_np() */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00059">59</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a0cdbd4d0545340d33dfe595811475ccd" name="a0cdbd4d0545340d33dfe595811475ccd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cdbd4d0545340d33dfe595811475ccd">&#9670;&#160;</a></span>_LARGEFILE_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _LARGEFILE_SOURCE&#160;&#160;&#160;/* For fseeko(), ftello() */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00069">69</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a70c57aae3eb654e205459b4362c8089a" name="a70c57aae3eb654e205459b4362c8089a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70c57aae3eb654e205459b4362c8089a">&#9670;&#160;</a></span>ARRAY_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ARRAY_SIZE</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">array</span></td><td>)</td>
          <td>&#160;&#160;&#160;(sizeof(array) / sizeof(array[0]))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00506">506</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l07989">get_month_index()</a>, and <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>.</p>

</div>
</div>
<a id="a84beef8cc122add35118ec7cd35286c4" name="a84beef8cc122add35118ec7cd35286c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84beef8cc122add35118ec7cd35286c4">&#9670;&#160;</a></span>calloc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define calloc&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_calloc</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01540">1540</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l01480">mg_calloc()</a>, and <a class="el" href="LuaXML__lib_8c_source.html#l00261">Tokenizer_new()</a>.</p>

</div>
</div>
<a id="a53644ae929eff6501de3e13fb3bd2946" name="a53644ae929eff6501de3e13fb3bd2946"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53644ae929eff6501de3e13fb3bd2946">&#9670;&#160;</a></span>CGI_ENVIRONMENT_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CGI_ENVIRONMENT_SIZE&#160;&#160;&#160;(4096) /* in bytes */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00488">488</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11284">addenv()</a>, and <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>.</p>

</div>
</div>
<a id="a3d96b607aca31a2236372e56ffb72112" name="a3d96b607aca31a2236372e56ffb72112"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d96b607aca31a2236372e56ffb72112">&#9670;&#160;</a></span>closesocket</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define closesocket</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><a class="el" href="classa.html">a</a></span></td><td>)</td>
          <td>&#160;&#160;&#160;(close(<a class="el" href="classa.html">a</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00917">917</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l15456">close_all_listening_sockets()</a>, <a class="el" href="civetweb_8c_source.html#l17864">close_connection()</a>, <a class="el" href="civetweb_8c_source.html#l17740">close_socket_gracefully()</a>, <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00150">duk_trans_socket_finish()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00076">duk_trans_socket_init()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00331">duk_trans_socket_peek_cb()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00214">duk_trans_socket_read_cb()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00165">duk_trans_socket_waitconn()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00278">duk_trans_socket_write_cb()</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, and <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>.</p>

</div>
</div>
<a id="a52cf22e0f16c8a5c8c60788eec654e30" name="a52cf22e0f16c8a5c8c60788eec654e30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52cf22e0f16c8a5c8c60788eec654e30">&#9670;&#160;</a></span>CRYPTO_LIB</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CRYPTO_LIB&#160;&#160;&#160;&quot;libcrypto.so&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00911">911</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>.</p>

</div>
</div>
<a id="a5687826f07a383abedc6329b6a07f40b" name="a5687826f07a383abedc6329b6a07f40b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5687826f07a383abedc6329b6a07f40b">&#9670;&#160;</a></span>DEBUG_ASSERT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_ASSERT</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a24002c50a108445d916457eb3c21d5e1">cond</a></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00260">260</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11184">forward_body_data()</a>, <a class="el" href="civetweb_8c_source.html#l18569">get_message()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l03956">header_has_option()</a>, <a class="el" href="civetweb_8c_source.html#l07099">mg_get_var2()</a>, <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l17066">ssl_servername_callback()</a>.</p>

</div>
</div>
<a id="a98f6ecefbf7613a2478356d30af16020" name="a98f6ecefbf7613a2478356d30af16020"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98f6ecefbf7613a2478356d30af16020">&#9670;&#160;</a></span>DEBUG_TRACE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_TRACE</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">fmt, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">do</span> {                                                                       \</div>
<div class="line">    } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00242">242</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  242</span><span class="preprocessor">#define DEBUG_TRACE(fmt, ...)                                                  \</span></div>
<div class="line"><span class="lineno">  243</span><span class="preprocessor">    do {                                                                       \</span></div>
<div class="line"><span class="lineno">  244</span><span class="preprocessor">    } while (0)</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11552">abort_cgi_process()</a>, <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l19624">consume_socket()</a>, <a class="el" href="civetweb_8c_source.html#l11915">dav_mkcol()</a>, <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l12293">delete_file()</a>, <a class="el" href="civetweb_8c_source.html#l14136">get_host_from_request_info()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l06562">handle_request_stat_log()</a>, <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>, <a class="el" href="civetweb_8c_source.html#l09035">is_authorized_for_put()</a>, <a class="el" href="civetweb_8c_source.html#l16715">load_tls_dll()</a>, <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>, <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, <a class="el" href="civetweb_8c_source.html#l08472">open_auth_file()</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l19661">produce_socket()</a>, <a class="el" href="civetweb_8c_source.html#l06210">pull_inner()</a>, <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>, <a class="el" href="civetweb_8c_source.html#l10572">put_dir()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, <a class="el" href="civetweb_8c_source.html#l17066">ssl_servername_callback()</a>, <a class="el" href="civetweb_8c_source.html#l14174">switch_domain_context()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a3a830e27de72e8bab8bc80eafebd657e" name="a3a830e27de72e8bab8bc80eafebd657e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a830e27de72e8bab8bc80eafebd657e">&#9670;&#160;</a></span>ERRNO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ERRNO&#160;&#160;&#160;(errno)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00924">924</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l17740">close_socket_gracefully()</a>, <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l11915">dav_mkcol()</a>, <a class="el" href="civetweb_8c_source.html#l12293">delete_file()</a>, <a class="el" href="civetweb_8c_source.html#l12443">do_ssi_exec()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l10196">fclose_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l05938">mg_poll()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l08472">open_auth_file()</a>, <a class="el" href="civetweb_8c_source.html#l06210">pull_inner()</a>, <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>, <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>, <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>, <a class="el" href="civetweb_8c_source.html#l05677">set_close_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l17636">set_gpass_option()</a>, <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>, <a class="el" href="civetweb_8c_source.html#l05768">spawn_process()</a>, and <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>.</p>

</div>
</div>
<a id="accab0bdb9395175c8b0f2565d2f862b5" name="accab0bdb9395175c8b0f2565d2f862b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accab0bdb9395175c8b0f2565d2f862b5">&#9670;&#160;</a></span>ERROR_TRY_AGAIN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ERROR_TRY_AGAIN</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">err</span></td><td>)</td>
          <td>&#160;&#160;&#160;	(((err) == EAGAIN) || ((err) == EWOULDBLOCK) || ((err) == EINTR))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00447">447</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  447</span><span class="preprocessor">#define ERROR_TRY_AGAIN(err)                                                   \</span></div>
<div class="line"><span class="lineno">  448</span><span class="preprocessor">    (((err) == EAGAIN) || ((err) == EWOULDBLOCK) || ((err) == EINTR))</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l05938">mg_poll()</a>, <a class="el" href="civetweb_8c_source.html#l06210">pull_inner()</a>, and <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>.</p>

</div>
</div>
<a id="a2c6efa7679f8cd9f61af96e105017560" name="a2c6efa7679f8cd9f61af96e105017560"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c6efa7679f8cd9f61af96e105017560">&#9670;&#160;</a></span>free</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define free&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_free</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01542">1542</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="user_8c_source.html#l00036">buffer_cleanup()</a>, <a class="el" href="lsqlite3_8c_source.html#l00654">cleanupdb()</a>, <a class="el" href="lsqlite3_8c_source.html#l01187">collfree()</a>, <a class="el" href="lsqlite3_8c_source.html#l01098">db_register_function()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-hybrid_2duk__alloc__hybrid_8c_source.html#l00089">duk_alloc_hybrid_init()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-dvalue_2duk__trans__dvalue_8c_source.html#l00060">duk_dvalue_free()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-dvalue_2duk__trans__dvalue_8c_source.html#l00200">duk_dvalue_make_tag_data()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-hybrid_2duk__alloc__hybrid_8c_source.html#l00259">duk_free_hybrid()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-logging_2duk__alloc__logging_8c_source.html#l00126">duk_free_logging()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-torture_2duk__alloc__torture_8c_source.html#l00166">duk_free_torture()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-hybrid_2duk__alloc__hybrid_8c_source.html#l00197">duk_realloc_hybrid()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-logging_2duk__alloc__logging_8c_source.html#l00075">duk_realloc_logging()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-torture_2duk__alloc__torture_8c_source.html#l00098">duk_realloc_torture()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-dvalue_2duk__trans__dvalue_8c_source.html#l00452">duk_trans_dvalue_free()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-dvalue_2duk__trans__dvalue_8c_source.html#l00391">duk_trans_dvalue_init()</a>, <a class="el" href="user_8c_source.html#l00130">fetch_github_user()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00856">free_system_info()</a>, <a class="el" href="lfs_8c_source.html#l00278">get_dir()</a>, <a class="el" href="vendor_2civetweb_2third__party_2duktape-1_85_82_2examples_2eventloop_2main_8c_source.html#l00101">handle_fh()</a>, <a class="el" href="duktape-1_85_82_2examples_2cmdline_2duk__cmdline_8c_source.html#l00493">handle_fh()</a>, <a class="el" href="duktape-1_88_80_2examples_2cmdline_2duk__cmdline_8c_source.html#l00493">handle_fh()</a>, <a class="el" href="duktape-1_85_82_2examples_2cmdline_2duk__cmdline_8c_source.html#l00755">handle_interactive()</a>, <a class="el" href="duktape-1_88_80_2examples_2cmdline_2duk__cmdline_8c_source.html#l00755">handle_interactive()</a>, <a class="el" href="lua-5_81_85_2src_2lauxlib_8c_source.html#l00627">l_alloc()</a>, <a class="el" href="lua-5_82_84_2src_2lauxlib_8c_source.html#l00919">l_alloc()</a>, <a class="el" href="lua-5_83_86_2src_2lauxlib_8c_source.html#l01008">l_alloc()</a>, <a class="el" href="lua-5_84_83_2src_2lauxlib_8c_source.html#l01010">l_alloc()</a>, <a class="el" href="lfs_8c_source.html#l00458">lfs_lock_dir()</a>, <a class="el" href="lfs_8c_source.html#l00486">lfs_unlock_dir()</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="lfs_8c_source.html#l01066">push_link_target()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00995">run_client()</a>, <a class="el" href="duktape-1_85_82_2examples_2sandbox_2sandbox_8c_source.html#l00129">sandbox_free()</a>, <a class="el" href="duktape-1_88_80_2examples_2sandbox_2sandbox_8c_source.html#l00129">sandbox_free()</a>, <a class="el" href="duktape-1_85_82_2examples_2sandbox_2sandbox_8c_source.html#l00066">sandbox_realloc()</a>, <a class="el" href="duktape-1_88_80_2examples_2sandbox_2sandbox_8c_source.html#l00066">sandbox_realloc()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00495">set_option()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l01181">start_civetweb()</a>, <a class="el" href="server_8c_source.html#l00059">start_http_server()</a>, <a class="el" href="LuaXML__lib_8c_source.html#l00271">Tokenizer_delete()</a>, <a class="el" href="LuaXML__lib_8c_source.html#l00323">Tokenizer_next()</a>, <a class="el" href="LuaXML__lib_8c_source.html#l00297">Tokenizer_set()</a>, <a class="el" href="user_8c_source.html#l00250">user_free()</a>, and <a class="el" href="LuaXML__lib_8c_source.html#l00791">Xml_load()</a>.</p>

</div>
</div>
<a id="a4a93d2e02678a8ce969395e383cdd3e0" name="a4a93d2e02678a8ce969395e383cdd3e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a93d2e02678a8ce969395e383cdd3e0">&#9670;&#160;</a></span>FUNCTION_MAY_BE_UNUSED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FUNCTION_MAY_BE_UNUSED</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00316">316</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a09ca1005ef34aa3b14445f325c532873" name="a09ca1005ef34aa3b14445f325c532873"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09ca1005ef34aa3b14445f325c532873">&#9670;&#160;</a></span>HEXTOI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HEXTOI</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">x</span></td><td>)</td>
          <td>&#160;&#160;&#160;(isdigit(x) ? (x - '0') : (x - 'W'))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="acda7cfeae2b1fbd50730709088e7da95" name="acda7cfeae2b1fbd50730709088e7da95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acda7cfeae2b1fbd50730709088e7da95">&#9670;&#160;</a></span>HTTP1_only</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HTTP1_only</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06609">6609</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="ad78a7b8419e5ec9f2cc7d310fcf142d7" name="ad78a7b8419e5ec9f2cc7d310fcf142d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad78a7b8419e5ec9f2cc7d310fcf142d7">&#9670;&#160;</a></span>IGNORE_UNUSED_RESULT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IGNORE_UNUSED_RESULT</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><a class="el" href="classa.html">a</a></span></td><td>)</td>
          <td>&#160;&#160;&#160;((void)((<a class="el" href="classa.html">a</a>) &amp;&amp; 1))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00291">291</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06939">alloc_vprintf()</a>, <a class="el" href="civetweb_8c_source.html#l15456">close_all_listening_sockets()</a>, <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>, and <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>.</p>

</div>
</div>
<a id="ae64a0edac6e82db7aa05b2d574e4a015" name="ae64a0edac6e82db7aa05b2d574e4a015"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae64a0edac6e82db7aa05b2d574e4a015">&#9670;&#160;</a></span>INITIAL_DEPTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INITIAL_DEPTH&#160;&#160;&#160;9</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08715">8715</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08861">authorize()</a>.</p>

</div>
</div>
<a id="a57e353d6ce48ab7d414d094961d5e474" name="a57e353d6ce48ab7d414d094961d5e474"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57e353d6ce48ab7d414d094961d5e474">&#9670;&#160;</a></span>INT64_FMT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INT64_FMT&#160;&#160;&#160;PRId64</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00926">926</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10181">construct_etag()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>, <a class="el" href="civetweb_8c_source.html#l21843">mg_get_context_info()</a>, <a class="el" href="civetweb_8c_source.html#l10169">parse_range_header()</a>, and <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>.</p>

</div>
</div>
<a id="ad0d744f05898e32d01f73f8af3cd2071" name="ad0d744f05898e32d01f73f8af3cd2071"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0d744f05898e32d01f73f8af3cd2071">&#9670;&#160;</a></span>INT64_MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INT64_MAX&#160;&#160;&#160;(9223372036854775807)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00513">513</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12443">do_ssi_exec()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l06494">mg_read_inner()</a>, <a class="el" href="civetweb_8c_source.html#l10451">mg_send_file_body()</a>, and <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>.</p>

</div>
</div>
<a id="a26769957ec1a2beaf223f33b66ee64ab" name="a26769957ec1a2beaf223f33b66ee64ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26769957ec1a2beaf223f33b66ee64ab">&#9670;&#160;</a></span>INVALID_SOCKET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INVALID_SOCKET&#160;&#160;&#160;(-1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00925">925</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l15456">close_all_listening_sockets()</a>, <a class="el" href="civetweb_8c_source.html#l17864">close_connection()</a>, <a class="el" href="civetweb_8c_source.html#l17740">close_socket_gracefully()</a>, <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00150">duk_trans_socket_finish()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00076">duk_trans_socket_init()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00331">duk_trans_socket_peek_cb()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00214">duk_trans_socket_read_cb()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00165">duk_trans_socket_waitconn()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-socket_2duk__trans__socket__windows_8c_source.html#l00278">duk_trans_socket_write_cb()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, and <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>.</p>

</div>
</div>
<a id="a0563a85b179703339cbf223e7e1c0454" name="a0563a85b179703339cbf223e7e1c0454"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0563a85b179703339cbf223e7e1c0454">&#9670;&#160;</a></span>IP_ADDR_STR_LEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IP_ADDR_STR_LEN&#160;&#160;&#160;(50) /* IPv6 hex string <a class="el" href="classis.html">is</a> 46 chars */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01732">1732</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>, <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>, and <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>.</p>

</div>
</div>
<a id="a1531c1b87bf00f94782d1d45f2942803" name="a1531c1b87bf00f94782d1d45f2942803"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1531c1b87bf00f94782d1d45f2942803">&#9670;&#160;</a></span>LOCK_DURATION_S</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCK_DURATION_S&#160;&#160;&#160;60</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02333">2333</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, and <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>.</p>

</div>
</div>
<a id="acf143577800376dd931c059ecc61ba06" name="acf143577800376dd931c059ecc61ba06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf143577800376dd931c059ecc61ba06">&#9670;&#160;</a></span>malloc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define malloc&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_malloc</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01539">1539</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="user_8c_source.html#l00022">buffer_init()</a>, <a class="el" href="lsqlite3_8c_source.html#l01194">db_create_collation()</a>, <a class="el" href="lsqlite3_8c_source.html#l01098">db_register_function()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-hybrid_2duk__alloc__hybrid_8c_source.html#l00151">duk_alloc_hybrid()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-hybrid_2duk__alloc__hybrid_8c_source.html#l00089">duk_alloc_hybrid_init()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-logging_2duk__alloc__logging_8c_source.html#l00053">duk_alloc_logging()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-torture_2duk__alloc__torture_8c_source.html#l00073">duk_alloc_torture()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-dvalue_2duk__trans__dvalue_8c_source.html#l00051">duk_dvalue_alloc()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-dvalue_2duk__trans__dvalue_8c_source.html#l00200">duk_dvalue_make_tag_data()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-logging_2duk__alloc__logging_8c_source.html#l00075">duk_realloc_logging()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-torture_2duk__alloc__torture_8c_source.html#l00098">duk_realloc_torture()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-dvalue_2duk__trans__dvalue_8c_source.html#l00391">duk_trans_dvalue_init()</a>, <a class="el" href="user_8c_source.html#l00130">fetch_github_user()</a>, <a class="el" href="vendor_2civetweb_2third__party_2duktape-1_85_82_2examples_2eventloop_2main_8c_source.html#l00101">handle_fh()</a>, <a class="el" href="duktape-1_85_82_2examples_2cmdline_2duk__cmdline_8c_source.html#l00493">handle_fh()</a>, <a class="el" href="duktape-1_88_80_2examples_2cmdline_2duk__cmdline_8c_source.html#l00493">handle_fh()</a>, <a class="el" href="duktape-1_85_82_2examples_2cmdline_2duk__cmdline_8c_source.html#l00755">handle_interactive()</a>, <a class="el" href="duktape-1_88_80_2examples_2cmdline_2duk__cmdline_8c_source.html#l00755">handle_interactive()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00825">init_system_info()</a>, <a class="el" href="lfs_8c_source.html#l00458">lfs_lock_dir()</a>, <a class="el" href="civetweb_8c_source.html#l01474">mg_malloc()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-dvalue_2test_8c_source.html#l00011">my_cooperate()</a>, <a class="el" href="duktape-1_85_82_2examples_2sandbox_2sandbox_8c_source.html#l00040">sandbox_alloc()</a>, <a class="el" href="duktape-1_88_80_2examples_2sandbox_2sandbox_8c_source.html#l00040">sandbox_alloc()</a>, <a class="el" href="duktape-1_85_82_2examples_2sandbox_2sandbox_8c_source.html#l00066">sandbox_realloc()</a>, <a class="el" href="duktape-1_88_80_2examples_2sandbox_2sandbox_8c_source.html#l00066">sandbox_realloc()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00453">sdup()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00495">set_option()</a>, <a class="el" href="LuaXML__lib_8c_source.html#l00297">Tokenizer_set()</a>, and <a class="el" href="LuaXML__lib_8c_source.html#l00791">Xml_load()</a>.</p>

</div>
</div>
<a id="aa127b5e878621ba653b669c8be6318b1" name="aa127b5e878621ba653b669c8be6318b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa127b5e878621ba653b669c8be6318b1">&#9670;&#160;</a></span>MAX_CGI_ENVIR_VARS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_CGI_ENVIR_VARS&#160;&#160;&#160;(256) /* in variables (count) */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00493">493</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>.</p>

</div>
</div>
<a id="a1617828178ff1b5df926d7f469288d3e" name="a1617828178ff1b5df926d7f469288d3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1617828178ff1b5df926d7f469288d3e">&#9670;&#160;</a></span>MAX_WORKER_THREADS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_WORKER_THREADS&#160;&#160;&#160;(1024 * 64) /* in threads (count) */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00465">465</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="ae03595c4f38ae34148fb498a6e55418d" name="ae03595c4f38ae34148fb498a6e55418d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae03595c4f38ae34148fb498a6e55418d">&#9670;&#160;</a></span>MD5_STATIC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MD5_STATIC&#160;&#160;&#160;static</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01724">1724</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="ac22a8a822b8728d8cd7e2718749f3ca4" name="ac22a8a822b8728d8cd7e2718749f3ca4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac22a8a822b8728d8cd7e2718749f3ca4">&#9670;&#160;</a></span>MG_BUF_LEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MG_BUF_LEN&#160;&#160;&#160;(1024 * 8)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00498">498</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06906">alloc_vprintf2()</a>, <a class="el" href="civetweb_8c_source.html#l08861">authorize()</a>, <a class="el" href="civetweb_8c_source.html#l17740">close_socket_gracefully()</a>, <a class="el" href="civetweb_8c_source.html#l06484">discard_unread_request_data()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l11184">forward_body_data()</a>, <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l04618">mg_send_http_redirect()</a>, <a class="el" href="civetweb_8c_source.html#l10622">mg_store_body()</a>, <a class="el" href="civetweb_8c_source.html#l07016">mg_vprintf()</a>, <a class="el" href="civetweb_8c_source.html#l14235">redirect_to_https_port()</a>, <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>, and <a class="el" href="civetweb_8c_source.html#l12482">send_ssi_file()</a>.</p>

</div>
</div>
<a id="a29f85c2d195a7eb5893fdd101383681b" name="a29f85c2d195a7eb5893fdd101383681b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29f85c2d195a7eb5893fdd101383681b">&#9670;&#160;</a></span>mg_calloc_ctx</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_calloc_ctx</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><a class="el" href="classa.html">a</a>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">b, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">c</span>&#160;)&#160;&#160;&#160;<a class="el" href="#ad3552193bd019b58e092032223ac38f1">mg_calloc</a>(<a class="el" href="classa.html">a</a>, b)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01498">1498</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, and <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>.</p>

</div>
</div>
<a id="a2b5e30d60439015dee1c473ebc4f4ce9" name="a2b5e30d60439015dee1c473ebc4f4ce9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b5e30d60439015dee1c473ebc4f4ce9">&#9670;&#160;</a></span>mg_closedir</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_closedir</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">x</span></td><td>)</td>
          <td>&#160;&#160;&#160;(closedir(x))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00922">922</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>, and <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>.</p>

</div>
</div>
<a id="aff51e0adb3dd4b1eca47676abb226c2c" name="aff51e0adb3dd4b1eca47676abb226c2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff51e0adb3dd4b1eca47676abb226c2c">&#9670;&#160;</a></span>mg_cry</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_cry&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_cry_internal</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03510">3510</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a1ddc04f3556f50ae9cf6ec670c441c4b" name="a1ddc04f3556f50ae9cf6ec670c441c4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ddc04f3556f50ae9cf6ec670c441c4b">&#9670;&#160;</a></span>mg_cry_ctx_internal</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_cry_ctx_internal</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">ctx, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">fmt, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)&#160;&#160;&#160;	<a class="el" href="#a148db84e7bdb695f1a072e0b5997fac5">mg_cry_internal_wrap</a>(<a class="el" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ctx, __func__, __LINE__, fmt, __VA_ARGS__)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02586">2586</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2586</span><span class="preprocessor">#define mg_cry_ctx_internal(ctx, fmt, ...)                                     \</span></div>
<div class="line"><span class="lineno"> 2587</span><span class="preprocessor">    mg_cry_internal_wrap(NULL, ctx, __func__, __LINE__, fmt, __VA_ARGS__)</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l16229">check_acl()</a>, <a class="el" href="civetweb_8c_source.html#l17485">init_ssl_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l17239">init_ssl_ctx_impl()</a>, <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, <a class="el" href="civetweb_8c_source.html#l16377">refresh_trust()</a>, <a class="el" href="civetweb_8c_source.html#l17636">set_gpass_option()</a>, <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>, <a class="el" href="civetweb_8c_source.html#l16267">set_uid_option()</a>, <a class="el" href="civetweb_8c_source.html#l16940">ssl_use_pem_file()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a9c82560e32fee25bd5f05767a625fa77" name="a9c82560e32fee25bd5f05767a625fa77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c82560e32fee25bd5f05767a625fa77">&#9670;&#160;</a></span>mg_cry_internal</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_cry_internal</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">conn, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">fmt, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)&#160;&#160;&#160;	<a class="el" href="#a148db84e7bdb695f1a072e0b5997fac5">mg_cry_internal_wrap</a>(conn, <a class="el" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, __func__, __LINE__, fmt, __VA_ARGS__)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02583">2583</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2583</span><span class="preprocessor">#define mg_cry_internal(conn, fmt, ...)                                        \</span></div>
<div class="line"><span class="lineno"> 2584</span><span class="preprocessor">    mg_cry_internal_wrap(conn, NULL, __func__, __LINE__, fmt, __VA_ARGS__)</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11284">addenv()</a>, <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>, <a class="el" href="civetweb_8c_source.html#l17740">close_socket_gracefully()</a>, <a class="el" href="civetweb_8c_source.html#l11915">dav_mkcol()</a>, <a class="el" href="civetweb_8c_source.html#l12443">do_ssi_exec()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l10196">fclose_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l04176">mg_get_response_code_text()</a>, <a class="el" href="civetweb_8c_source.html#l10622">mg_store_body()</a>, <a class="el" href="civetweb_8c_source.html#l03094">mg_vsnprintf()</a>, <a class="el" href="civetweb_8c_source.html#l08472">open_auth_file()</a>, <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>, <a class="el" href="civetweb_8c_source.html#l08733">read_auth_file()</a>, <a class="el" href="civetweb_8c_source.html#l10609">remove_bad_file()</a>, <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>, <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>, <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>, <a class="el" href="civetweb_8c_source.html#l12482">send_ssi_file()</a>, <a class="el" href="civetweb_8c_source.html#l05677">set_close_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l05768">spawn_process()</a>, and <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>.</p>

</div>
</div>
<a id="a58e208228ea8cec229167dac0e1d1d84" name="a58e208228ea8cec229167dac0e1d1d84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58e208228ea8cec229167dac0e1d1d84">&#9670;&#160;</a></span>MG_FILE_COMPRESSION_SIZE_LIMIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MG_FILE_COMPRESSION_SIZE_LIMIT&#160;&#160;&#160;(1024) /* in bytes */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00478">478</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>.</p>

</div>
</div>
<a id="a88232e9595ccceb9a04b106cc6d2739c" name="a88232e9595ccceb9a04b106cc6d2739c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88232e9595ccceb9a04b106cc6d2739c">&#9670;&#160;</a></span>MG_FOPEN_MODE_APPEND</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MG_FOPEN_MODE_APPEND&#160;&#160;&#160;(4)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02849">2849</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>, <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>, and <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>.</p>

</div>
</div>
<a id="ad6f5b37a1a1289e74e6563d530768d06" name="ad6f5b37a1a1289e74e6563d530768d06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6f5b37a1a1289e74e6563d530768d06">&#9670;&#160;</a></span>MG_FOPEN_MODE_NONE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MG_FOPEN_MODE_NONE&#160;&#160;&#160;(0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02840">2840</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a5bd58793b81cca07589b297470992a9e" name="a5bd58793b81cca07589b297470992a9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bd58793b81cca07589b297470992a9e">&#9670;&#160;</a></span>MG_FOPEN_MODE_READ</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MG_FOPEN_MODE_READ&#160;&#160;&#160;(1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02843">2843</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l09035">is_authorized_for_put()</a>, <a class="el" href="civetweb_8c_source.html#l08893">mg_check_digest_access_authentication()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l10451">mg_send_file_body()</a>, <a class="el" href="civetweb_8c_source.html#l08472">open_auth_file()</a>, and <a class="el" href="civetweb_8c_source.html#l08733">read_auth_file()</a>.</p>

</div>
</div>
<a id="abb547e0027f87aeb69575479967c1f5f" name="abb547e0027f87aeb69575479967c1f5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb547e0027f87aeb69575479967c1f5f">&#9670;&#160;</a></span>MG_FOPEN_MODE_WRITE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MG_FOPEN_MODE_WRITE&#160;&#160;&#160;(2)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02846">2846</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l10622">mg_store_body()</a>, and <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>.</p>

</div>
</div>
<a id="a12b89ebf78a150d64629559c322ea661" name="a12b89ebf78a150d64629559c322ea661"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12b89ebf78a150d64629559c322ea661">&#9670;&#160;</a></span>mg_free_ctx</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_free_ctx</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><a class="el" href="classa.html">a</a>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">c</span>&#160;)&#160;&#160;&#160;<a class="el" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(<a class="el" href="classa.html">a</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01500">1500</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a538a838c27a50aa0d4cb745ac68f7f5b" name="a538a838c27a50aa0d4cb745ac68f7f5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a538a838c27a50aa0d4cb745ac68f7f5b">&#9670;&#160;</a></span>mg_get_option</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_get_option&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION_INTERNALLY__access_directly</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03185">3185</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="vendor_2civetweb_2main_8c_source.html#l03235">main()</a>.</p>

</div>
</div>
<a id="a09f3709fc72c7edf208c75ccbe3d997b" name="a09f3709fc72c7edf208c75ccbe3d997b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09f3709fc72c7edf208c75ccbe3d997b">&#9670;&#160;</a></span>mg_malloc_ctx</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_malloc_ctx</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><a class="el" href="classa.html">a</a>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">c</span>&#160;)&#160;&#160;&#160;<a class="el" href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a>(<a class="el" href="classa.html">a</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01497">1497</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>, <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>, <a class="el" href="civetweb_8c_source.html#l03047">mg_strndup_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>, <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>, <a class="el" href="civetweb_8c_source.html#l16620">ssl_get_client_cert_info()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a756d12537962d25f9c69aaa1a319b10a" name="a756d12537962d25f9c69aaa1a319b10a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a756d12537962d25f9c69aaa1a319b10a">&#9670;&#160;</a></span>mg_mkdir</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_mkdir</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">conn, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">path, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">mode</span>&#160;)&#160;&#160;&#160;(mkdir(path, mode))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00918">918</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11915">dav_mkcol()</a>, and <a class="el" href="civetweb_8c_source.html#l10572">put_dir()</a>.</p>

</div>
</div>
<a id="a1ff1ea4e3e6c59f0e144bd91366fe2d9" name="a1ff1ea4e3e6c59f0e144bd91366fe2d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ff1ea4e3e6c59f0e144bd91366fe2d9">&#9670;&#160;</a></span>mg_opendir</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_opendir</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">conn, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">x</span>&#160;)&#160;&#160;&#160;(opendir(x))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00921">921</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>, and <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>.</p>

</div>
</div>
<a id="ac220e3a97f765b599bc532d6c3f4a755" name="ac220e3a97f765b599bc532d6c3f4a755"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac220e3a97f765b599bc532d6c3f4a755">&#9670;&#160;</a></span>mg_pollfd</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_pollfd&#160;&#160;&#160;pollfd</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00948">948</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, <a class="el" href="civetweb_8c_source.html#l06210">pull_inner()</a>, <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>, <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>, and <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>.</p>

</div>
</div>
<a id="a0387536c403dfeff474b0bb940156908" name="a0387536c403dfeff474b0bb940156908"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0387536c403dfeff474b0bb940156908">&#9670;&#160;</a></span>mg_readdir</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_readdir</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">x</span></td><td>)</td>
          <td>&#160;&#160;&#160;(readdir(x))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00923">923</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>, and <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>.</p>

</div>
</div>
<a id="ab36230fc0a06484369ac2dc5331260f4" name="ab36230fc0a06484369ac2dc5331260f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab36230fc0a06484369ac2dc5331260f4">&#9670;&#160;</a></span>mg_realloc_ctx</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_realloc_ctx</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><a class="el" href="classa.html">a</a>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">b, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">c</span>&#160;)&#160;&#160;&#160;<a class="el" href="#a5185c288b713841c3c37118b5028bb42">mg_realloc</a>(<a class="el" href="classa.html">a</a>, b)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01499">1499</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11284">addenv()</a>, and <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>.</p>

</div>
</div>
<a id="a3b7e572b06c0a0d1c920572523fbe01d" name="a3b7e572b06c0a0d1c920572523fbe01d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b7e572b06c0a0d1c920572523fbe01d">&#9670;&#160;</a></span>mg_remove</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_remove</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">conn, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">x</span>&#160;)&#160;&#160;&#160;(remove(x))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00919">919</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12293">delete_file()</a>, <a class="el" href="civetweb_8c_source.html#l10609">remove_bad_file()</a>, and <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>.</p>

</div>
</div>
<a id="af1af7c8ef16047616b5bee88aeee10d6" name="af1af7c8ef16047616b5bee88aeee10d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1af7c8ef16047616b5bee88aeee10d6">&#9670;&#160;</a></span>mg_sleep</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_sleep</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">x</span></td><td>)</td>
          <td>&#160;&#160;&#160;(usleep((x)*1000))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00920">920</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="civetweb_8c_source.html#l20346">mg_stop()</a>, <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>, and <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>.</p>

</div>
</div>
<a id="abd1c48d7de09ccd680c843a8c34551a2" name="abd1c48d7de09ccd680c843a8c34551a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd1c48d7de09ccd680c843a8c34551a2">&#9670;&#160;</a></span>mg_static_assert</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mg_static_assert</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a24002c50a108445d916457eb3c21d5e1">cond</a>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">txt</span>&#160;)&#160;&#160;&#160;	extern char <a class="el" href="#a0553b9f90d6c0d22c73cf05ffe81b708">static_assert_replacement</a>[(<a class="el" href="lua-5_81_85_2src_2lparser_8c.html#a24002c50a108445d916457eb3c21d5e1">cond</a>) ? 1 : -1]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00126">126</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  126</span><span class="preprocessor">#define mg_static_assert(cond, txt)                                            \</span></div>
<div class="line"><span class="lineno">  127</span><span class="preprocessor">    extern char static_assert_replacement[(cond) ? 1 : -1]</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9f55d0e90dc8cc6b2287312435cdde48" name="a9f55d0e90dc8cc6b2287312435cdde48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f55d0e90dc8cc6b2287312435cdde48">&#9670;&#160;</a></span>MSG_NOSIGNAL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSG_NOSIGNAL&#160;&#160;&#160;(0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01735">1735</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>, <a class="el" href="duktape-1_85_82_2examples_2eventloop_2socket_8c_source.html#l00247">socket_write()</a>, and <a class="el" href="duktape-1_88_80_2examples_2eventloop_2socket_8c_source.html#l00247">socket_write()</a>.</p>

</div>
</div>
<a id="a8f690ac9e6a0d59b505f52edc10a6321" name="a8f690ac9e6a0d59b505f52edc10a6321"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f690ac9e6a0d59b505f52edc10a6321">&#9670;&#160;</a></span>NO_ALTERNATIVE_QUEUE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NO_ALTERNATIVE_QUEUE</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00152">152</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="aec63256a14a3c1f92d2b8e01a466f718" name="aec63256a14a3c1f92d2b8e01a466f718"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec63256a14a3c1f92d2b8e01a466f718">&#9670;&#160;</a></span>NUM_WEBDAV_LOCKS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_WEBDAV_LOCKS&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02330">2330</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l12931">dav_unlock_file()</a>, and <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>.</p>

</div>
</div>
<a id="a36fa9b2e726512bc17a7a6d3e39002be" name="a36fa9b2e726512bc17a7a6d3e39002be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36fa9b2e726512bc17a7a6d3e39002be">&#9670;&#160;</a></span>O_BINARY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define O_BINARY&#160;&#160;&#160;(0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00915">915</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="af3e3c69dd6791a2c441b5352743750a6" name="af3e3c69dd6791a2c441b5352743750a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3e3c69dd6791a2c441b5352743750a6">&#9670;&#160;</a></span>PASSWORDS_FILE_NAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PASSWORDS_FILE_NAME&#160;&#160;&#160;&quot;.htpasswd&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00482">482</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09763">must_hide_file()</a>, and <a class="el" href="civetweb_8c_source.html#l08472">open_auth_file()</a>.</p>

</div>
</div>
<a id="a1b739878adcdb46fb5d209af7ce79628" name="a1b739878adcdb46fb5d209af7ce79628"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b739878adcdb46fb5d209af7ce79628">&#9670;&#160;</a></span>realloc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define realloc&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_realloc</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01541">1541</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="user_8c_source.html#l00052">buffer_ensure_capacity()</a>, <a class="el" href="duktape-1_85_82_2examples_2debug-trans-dvalue_2duk__trans__dvalue_8c_source.html#l00333">duk__trans_buffer_ensure()</a>, <a class="el" href="duktape-1_88_80_2examples_2debug-trans-dvalue_2duk__trans__dvalue_8c_source.html#l00333">duk__trans_buffer_ensure()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-hybrid_2duk__alloc__hybrid_8c_source.html#l00197">duk_realloc_hybrid()</a>, <a class="el" href="duktape-1_85_82_2examples_2alloc-logging_2duk__alloc__logging_8c_source.html#l00075">duk_realloc_logging()</a>, <a class="el" href="lfs_8c_source.html#l00278">get_dir()</a>, <a class="el" href="duktape-1_85_82_2examples_2cmdline_2duk__cmdline_8c_source.html#l00493">handle_fh()</a>, <a class="el" href="duktape-1_88_80_2examples_2cmdline_2duk__cmdline_8c_source.html#l00493">handle_fh()</a>, <a class="el" href="lua-5_81_85_2src_2lauxlib_8c_source.html#l00627">l_alloc()</a>, <a class="el" href="lua-5_82_84_2src_2lauxlib_8c_source.html#l00919">l_alloc()</a>, <a class="el" href="lua-5_83_86_2src_2lauxlib_8c_source.html#l01008">l_alloc()</a>, <a class="el" href="lua-5_84_83_2src_2lauxlib_8c_source.html#l01010">l_alloc()</a>, <a class="el" href="civetweb_8c_source.html#l01486">mg_realloc()</a>, <a class="el" href="lfs_8c_source.html#l01066">push_link_target()</a>, <a class="el" href="duktape-1_85_82_2examples_2sandbox_2sandbox_8c_source.html#l00066">sandbox_realloc()</a>, <a class="el" href="duktape-1_88_80_2examples_2sandbox_2sandbox_8c_source.html#l00066">sandbox_realloc()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00495">set_option()</a>, and <a class="el" href="LuaXML__lib_8c_source.html#l00311">Tokenizer_append()</a>.</p>

</div>
</div>
<a id="abfe712fddd648f222bf6986d90b9b996" name="abfe712fddd648f222bf6986d90b9b996"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfe712fddd648f222bf6986d90b9b996">&#9670;&#160;</a></span>SHUTDOWN_BOTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SHUTDOWN_BOTH&#160;&#160;&#160;(2)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00518">518</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a60793c387a9db2a9d40125091a080801" name="a60793c387a9db2a9d40125091a080801"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60793c387a9db2a9d40125091a080801">&#9670;&#160;</a></span>SHUTDOWN_RD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SHUTDOWN_RD&#160;&#160;&#160;(0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00516">516</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="ac937c233d930a34c3f5fc66e8a5843c2" name="ac937c233d930a34c3f5fc66e8a5843c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac937c233d930a34c3f5fc66e8a5843c2">&#9670;&#160;</a></span>SHUTDOWN_WR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SHUTDOWN_WR&#160;&#160;&#160;(1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00517">517</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17740">close_socket_gracefully()</a>.</p>

</div>
</div>
<a id="aa367b75c5aed883fef5befbdf04835a4" name="aa367b75c5aed883fef5befbdf04835a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa367b75c5aed883fef5befbdf04835a4">&#9670;&#160;</a></span>snprintf</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define snprintf&#160;&#160;&#160;DO_NOT_USE_THIS_FUNCTION__USE_mg_snprintf</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01543">1543</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="user_8c_source.html#l00130">fetch_github_user()</a>, <a class="el" href="duktape-1_85_82_2examples_2cmdline_2duk__cmdline_8c_source.html#l00620">handle_file()</a>, <a class="el" href="duktape-1_88_80_2examples_2cmdline_2duk__cmdline_8c_source.html#l00620">handle_file()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00838">init_server_name()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00738">process_command_line_arguments()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00914">set_absolute_path()</a>, <a class="el" href="duktape-1_85_82_2examples_2cmdline_2duk__cmdline_8c_source.html#l00173">wrapped_compile_execute()</a>, <a class="el" href="duktape-1_88_80_2examples_2cmdline_2duk__cmdline_8c_source.html#l00173">wrapped_compile_execute()</a>, and <a class="el" href="LuaXML__lib_8c_source.html#l00575">Xml_pushEncode()</a>.</p>

</div>
</div>
<a id="abd345577a07dba9941d4cea32b4cf4fd" name="abd345577a07dba9941d4cea32b4cf4fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd345577a07dba9941d4cea32b4cf4fd">&#9670;&#160;</a></span>SOCKET_TIMEOUT_QUANTUM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SOCKET_TIMEOUT_QUANTUM&#160;&#160;&#160;(2000) /* in ms */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00473">473</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, <a class="el" href="civetweb_8c_source.html#l05938">mg_poll()</a>, and <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>.</p>

</div>
</div>
<a id="a9822f5260f90216b615dd7435274a83a" name="a9822f5260f90216b615dd7435274a83a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9822f5260f90216b615dd7435274a83a">&#9670;&#160;</a></span>SSL_LIB</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SSL_LIB&#160;&#160;&#160;&quot;libssl.so&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00908">908</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>.</p>

</div>
</div>
<a id="a5cd88c4a6b9186f77507c50a6ae6625f" name="a5cd88c4a6b9186f77507c50a6ae6625f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5cd88c4a6b9186f77507c50a6ae6625f">&#9670;&#160;</a></span>STOP_FLAG_ASSIGN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STOP_FLAG_ASSIGN</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">f, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">v</span>&#160;)&#160;&#160;&#160;((*(f)) = (v))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02324">2324</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, <a class="el" href="civetweb_8c_source.html#l17938">mg_close_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l20346">mg_stop()</a>.</p>

</div>
</div>
<a id="a888e9186b73dca8fe7e2fe2e4a37b392" name="a888e9186b73dca8fe7e2fe2e4a37b392"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a888e9186b73dca8fe7e2fe2e4a37b392">&#9670;&#160;</a></span>STOP_FLAG_IS_TWO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STOP_FLAG_IS_TWO</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">f</span></td><td>)</td>
          <td>&#160;&#160;&#160;((*(f)) == 2)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02323">2323</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20346">mg_stop()</a>.</p>

</div>
</div>
<a id="a42c400d6feb7aa0de4280b0cf1c63fcc" name="a42c400d6feb7aa0de4280b0cf1c63fcc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42c400d6feb7aa0de4280b0cf1c63fcc">&#9670;&#160;</a></span>STOP_FLAG_IS_ZERO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STOP_FLAG_IS_ZERO</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">f</span></td><td>)</td>
          <td>&#160;&#160;&#160;((*(f)) == 0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02322">2322</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19624">consume_socket()</a>, <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, <a class="el" href="civetweb_8c_source.html#l05938">mg_poll()</a>, <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, <a class="el" href="civetweb_8c_source.html#l06779">mg_write()</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l19661">produce_socket()</a>, <a class="el" href="civetweb_8c_source.html#l06439">pull_all()</a>, <a class="el" href="civetweb_8c_source.html#l06210">pull_inner()</a>, <a class="el" href="civetweb_8c_source.html#l06162">push_all()</a>, <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>, <a class="el" href="civetweb_8c_source.html#l11107">read_message()</a>, and <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>.</p>

</div>
</div>
<a id="af7932a261d02cf4b8431793664a4585b" name="af7932a261d02cf4b8431793664a4585b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7932a261d02cf4b8431793664a4585b">&#9670;&#160;</a></span>STRUCT_FILE_INITIALIZER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STRUCT_FILE_INITIALIZER</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    {                                                                          \</div>
<div class="line">        {(uint64_t)0, (time_t)0, 0, 0, 0},                                     \</div>
<div class="line">        {                                                                      \</div>
<div class="line">            (FILE *)<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>                                                       \</div>
<div class="line">        }                                                                      \</div>
<div class="line">    }</div>
<div class="ttc" id="agmacros_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition</b> <a href="gmacros_8h_source.html#l00924">gmacros.h:924</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01891">1891</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1891</span><span class="preprocessor">#define STRUCT_FILE_INITIALIZER                                                \</span></div>
<div class="line"><span class="lineno"> 1892</span><span class="preprocessor">    {                                                                          \</span></div>
<div class="line"><span class="lineno"> 1893</span><span class="preprocessor">        {(uint64_t)0, (time_t)0, 0, 0, 0},                                     \</span></div>
<div class="line"><span class="lineno"> 1894</span><span class="preprocessor">        {                                                                      \</span></div>
<div class="line"><span class="lineno"> 1895</span><span class="preprocessor">            (FILE *)NULL                                                       \</span></div>
<div class="line"><span class="lineno"> 1896</span><span class="preprocessor">        }                                                                      \</span></div>
<div class="line"><span class="lineno"> 1897</span><span class="preprocessor">    }</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>, <a class="el" href="civetweb_8c_source.html#l12443">do_ssi_exec()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l09035">is_authorized_for_put()</a>, <a class="el" href="civetweb_8c_source.html#l08893">mg_check_digest_access_authentication()</a>, <a class="el" href="civetweb_8c_source.html#l10451">mg_send_file_body()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>, <a class="el" href="civetweb_8c_source.html#l10572">put_dir()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, and <a class="el" href="civetweb_8c_source.html#l17636">set_gpass_option()</a>.</p>

</div>
</div>
<a id="a21ef7c3a4e9f99f62cf64329f965d2ed" name="a21ef7c3a4e9f99f62cf64329f965d2ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21ef7c3a4e9f99f62cf64329f965d2ed">&#9670;&#160;</a></span>UINT64_FMT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UINT64_FMT&#160;&#160;&#160;PRIu64</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00927">927</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l04576">mg_send_http_ok()</a>, and <a class="el" href="civetweb_8c_source.html#l08974">send_authorization_request()</a>.</p>

</div>
</div>
<a id="a58f28d0739c8e6a66ffce338daef408c" name="a58f28d0739c8e6a66ffce338daef408c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58f28d0739c8e6a66ffce338daef408c">&#9670;&#160;</a></span>USA_IN_PORT_UNSAFE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USA_IN_PORT_UNSAFE</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><a class="el" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a></span></td><td>)</td>
          <td>&#160;&#160;&#160;((<a class="el" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>)-&gt;sin.sin_port)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01860">1860</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18465">get_rel_url_at_current_server()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l03248">mg_get_server_ports()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a7a78f968a579c967c2bb097b9e64749f" name="a7a78f968a579c967c2bb097b9e64749f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a78f968a579c967c2bb097b9e64749f">&#9670;&#160;</a></span>UTF8_PATH_MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UTF8_PATH_MAX&#160;&#160;&#160;(<a class="el" href="vendor_2civetweb_2main_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00861">861</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>, <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l12964">dav_proppatch()</a>, <a class="el" href="civetweb_8c_source.html#l12931">dav_unlock_file()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>, <a class="el" href="civetweb_8c_source.html#l09057">mg_modify_passwords_file_ha1()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l08472">open_auth_file()</a>, <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>, <a class="el" href="civetweb_8c_source.html#l10572">put_dir()</a>, <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>, and <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>.</p>

</div>
</div>
<a id="ad5936237ef8db6bc39470efaef9d151d" name="ad5936237ef8db6bc39470efaef9d151d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5936237ef8db6bc39470efaef9d151d">&#9670;&#160;</a></span>va_copy</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define va_copy</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">x, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">y</span>&#160;)&#160;&#160;&#160;((x) = (y))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01003">1003</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06939">alloc_vprintf()</a>, <a class="el" href="civetweb_8c_source.html#l06906">alloc_vprintf2()</a>, and <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>.</p>

</div>
</div>
<a id="a095b3b42df21f6e5d4377e299da56a79" name="a095b3b42df21f6e5d4377e299da56a79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a095b3b42df21f6e5d4377e299da56a79">&#9670;&#160;</a></span>vsnprintf_impl</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define vsnprintf_impl&#160;&#160;&#160;vsnprintf</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00897">897</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06939">alloc_vprintf()</a>, <a class="el" href="civetweb_8c_source.html#l06906">alloc_vprintf2()</a>, <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>, and <a class="el" href="civetweb_8c_source.html#l03094">mg_vsnprintf()</a>.</p>

</div>
</div>
<a id="ac7bef5d85e3dcd73eef56ad39ffc84a9" name="ac7bef5d85e3dcd73eef56ad39ffc84a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7bef5d85e3dcd73eef56ad39ffc84a9">&#9670;&#160;</a></span>WIN32_LEAN_AND_MEAN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WIN32_LEAN_AND_MEAN</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00175">175</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="ad4581abb02e8798a73171df79524b994" name="ad4581abb02e8798a73171df79524b994"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4581abb02e8798a73171df79524b994">&#9670;&#160;</a></span>WINCDECL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WINCDECL</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00929">929</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a1bbb7024f8dda275a22cdc1df0527224" name="a1bbb7024f8dda275a22cdc1df0527224"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bbb7024f8dda275a22cdc1df0527224">&#9670;&#160;</a></span>SOCK_OPT_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef const void* <a class="el" href="#a1bbb7024f8dda275a22cdc1df0527224">SOCK_OPT_TYPE</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00863">863</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a8dc8083897335125630f1af5dafd5831" name="a8dc8083897335125630f1af5dafd5831"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8dc8083897335125630f1af5dafd5831">&#9670;&#160;</a></span>SOCKET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int <a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00928">928</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="ac751248c6cb5f0bce10051d41a22d964" name="ac751248c6cb5f0bce10051d41a22d964"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac751248c6cb5f0bce10051d41a22d964">&#9670;&#160;</a></span>stop_flag_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int volatile <a class="el" href="#ac751248c6cb5f0bce10051d41a22d964">stop_flag_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02321">2321</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a06fc87d81c62e9abb8790b6e5713c55b" name="a06fc87d81c62e9abb8790b6e5713c55b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06fc87d81c62e9abb8790b6e5713c55b">&#9670;&#160;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e" name="a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e"></a>LISTENING_PORTS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baa818676aedda10c1d780a84133662831" name="a06fc87d81c62e9abb8790b6e5713c55baa818676aedda10c1d780a84133662831"></a>NUM_THREADS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba2273c8f628cf101bc49496219571b0c4" name="a06fc87d81c62e9abb8790b6e5713c55ba2273c8f628cf101bc49496219571b0c4"></a>RUN_AS_USER&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55bae7af9fa992c8547645bac2ca940153b0" name="a06fc87d81c62e9abb8790b6e5713c55bae7af9fa992c8547645bac2ca940153b0"></a>CONFIG_TCP_NODELAY&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5" name="a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5"></a>MAX_REQUEST_SIZE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba6e6c7723fb9a76f3d7afde265e782141" name="a06fc87d81c62e9abb8790b6e5713c55ba6e6c7723fb9a76f3d7afde265e782141"></a>LINGER_TIMEOUT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3" name="a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3"></a>CONNECTION_QUEUE_SIZE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baf13327a7aed89d59cc7e4200d088f205" name="a06fc87d81c62e9abb8790b6e5713c55baf13327a7aed89d59cc7e4200d088f205"></a>LISTEN_BACKLOG_SIZE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba73fe0376eae56e950136313f635836e2" name="a06fc87d81c62e9abb8790b6e5713c55ba73fe0376eae56e950136313f635836e2"></a>THROTTLE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba39a8b8c4df6154e815a5a49da528ce5c" name="a06fc87d81c62e9abb8790b6e5713c55ba39a8b8c4df6154e815a5a49da528ce5c"></a>ENABLE_KEEP_ALIVE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd" name="a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd"></a>REQUEST_TIMEOUT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba79dc6ec73a693de1fbe2397ce42af360" name="a06fc87d81c62e9abb8790b6e5713c55ba79dc6ec73a693de1fbe2397ce42af360"></a>KEEP_ALIVE_TIMEOUT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baa7da030a4d709729f351258b77fad121" name="a06fc87d81c62e9abb8790b6e5713c55baa7da030a4d709729f351258b77fad121"></a>DECODE_URL&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baf20363ab43e572880dc69d8fe634c114" name="a06fc87d81c62e9abb8790b6e5713c55baf20363ab43e572880dc69d8fe634c114"></a>DECODE_QUERY_STRING&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed" name="a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed"></a>DOCUMENT_ROOT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55bac3c40480ddeeae7beeed79fc399329e3" name="a06fc87d81c62e9abb8790b6e5713c55bac3c40480ddeeae7beeed79fc399329e3"></a>ACCESS_LOG_FILE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba66ac785400448f574aa25e2943f3a854" name="a06fc87d81c62e9abb8790b6e5713c55ba66ac785400448f574aa25e2943f3a854"></a>ERROR_LOG_FILE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa" name="a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa"></a>CGI_EXTENSIONS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba850b5c3820657d2b3a4d5a07c7c02616" name="a06fc87d81c62e9abb8790b6e5713c55ba850b5c3820657d2b3a4d5a07c7c02616"></a>CGI_ENVIRONMENT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baed83717b03766bd7c931b4e2fbae3384" name="a06fc87d81c62e9abb8790b6e5713c55baed83717b03766bd7c931b4e2fbae3384"></a>CGI_INTERPRETER&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba3bdbf4db41e054e3f6c087b4299c66c0" name="a06fc87d81c62e9abb8790b6e5713c55ba3bdbf4db41e054e3f6c087b4299c66c0"></a>CGI_INTERPRETER_ARGS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55babb844e7f11a02780ac6a94b3b4dd754d" name="a06fc87d81c62e9abb8790b6e5713c55babb844e7f11a02780ac6a94b3b4dd754d"></a>CGI_BUFFERING&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba5d225462bc3b0836805df00f580cb7ea" name="a06fc87d81c62e9abb8790b6e5713c55ba5d225462bc3b0836805df00f580cb7ea"></a>CGI2_EXTENSIONS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55bab6b21529583f9a7dc58484925b8babe8" name="a06fc87d81c62e9abb8790b6e5713c55bab6b21529583f9a7dc58484925b8babe8"></a>CGI2_ENVIRONMENT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baf64cc929494eda240d914b67c0b1f9e9" name="a06fc87d81c62e9abb8790b6e5713c55baf64cc929494eda240d914b67c0b1f9e9"></a>CGI2_INTERPRETER&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba68a38509add8b770910afaf010696277" name="a06fc87d81c62e9abb8790b6e5713c55ba68a38509add8b770910afaf010696277"></a>CGI2_INTERPRETER_ARGS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba2e5da0c85d9043e7e4404fdc0e2787a6" name="a06fc87d81c62e9abb8790b6e5713c55ba2e5da0c85d9043e7e4404fdc0e2787a6"></a>CGI2_BUFFERING&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba9f0c9561bdb0b2b975178617c8d3c59a" name="a06fc87d81c62e9abb8790b6e5713c55ba9f0c9561bdb0b2b975178617c8d3c59a"></a>PUT_DELETE_PASSWORDS_FILE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55bac05d91b095136909d3bb88f857770b34" name="a06fc87d81c62e9abb8790b6e5713c55bac05d91b095136909d3bb88f857770b34"></a>PROTECT_URI&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2" name="a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2"></a>AUTHENTICATION_DOMAIN&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baa196eb33164714d8b04ace074a72c492" name="a06fc87d81c62e9abb8790b6e5713c55baa196eb33164714d8b04ace074a72c492"></a>ENABLE_AUTH_DOMAIN_CHECK&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55bad759d92bd3b0e4870bb7d92ad10399b4" name="a06fc87d81c62e9abb8790b6e5713c55bad759d92bd3b0e4870bb7d92ad10399b4"></a>SSI_EXTENSIONS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba00459f3ca65ce96fa33c3d5230624328" name="a06fc87d81c62e9abb8790b6e5713c55ba00459f3ca65ce96fa33c3d5230624328"></a>ENABLE_DIRECTORY_LISTING&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba5dc474ce23af919313afd42d5610bc05" name="a06fc87d81c62e9abb8790b6e5713c55ba5dc474ce23af919313afd42d5610bc05"></a>ENABLE_WEBDAV&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba0d86924aee1330b50c85079ae6ff8032" name="a06fc87d81c62e9abb8790b6e5713c55ba0d86924aee1330b50c85079ae6ff8032"></a>GLOBAL_PASSWORDS_FILE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55bafa9f4efa175d81e138ff3aa53aa00930" name="a06fc87d81c62e9abb8790b6e5713c55bafa9f4efa175d81e138ff3aa53aa00930"></a>INDEX_FILES&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba3afb385e81857461e2860a6bc661020c" name="a06fc87d81c62e9abb8790b6e5713c55ba3afb385e81857461e2860a6bc661020c"></a>ACCESS_CONTROL_LIST&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55bafe5280fd7fcd9876652bc64790c74c23" name="a06fc87d81c62e9abb8790b6e5713c55bafe5280fd7fcd9876652bc64790c74c23"></a>EXTRA_MIME_TYPES&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba1bb8ebf1124ab1bb589866f06e54e71f" name="a06fc87d81c62e9abb8790b6e5713c55ba1bb8ebf1124ab1bb589866f06e54e71f"></a>SSL_CERTIFICATE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baacb7b39407a541fbda68aafd33193470" name="a06fc87d81c62e9abb8790b6e5713c55baacb7b39407a541fbda68aafd33193470"></a>SSL_CERTIFICATE_CHAIN&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba73b1fb0778577d79d9a9906538f397b7" name="a06fc87d81c62e9abb8790b6e5713c55ba73b1fb0778577d79d9a9906538f397b7"></a>URL_REWRITE_PATTERN&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba661e684fd980c2be1848413e1ec8fe35" name="a06fc87d81c62e9abb8790b6e5713c55ba661e684fd980c2be1848413e1ec8fe35"></a>HIDE_FILES&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac" name="a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac"></a>SSL_DO_VERIFY_PEER&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba359ab5a360678365c390cba52eef08ba" name="a06fc87d81c62e9abb8790b6e5713c55ba359ab5a360678365c390cba52eef08ba"></a>SSL_CACHE_TIMEOUT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba3e3b29034498dd70486ada574bcd4d6d" name="a06fc87d81c62e9abb8790b6e5713c55ba3e3b29034498dd70486ada574bcd4d6d"></a>SSL_CA_PATH&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baeae84e3e129de97ee8fdad5fd628683f" name="a06fc87d81c62e9abb8790b6e5713c55baeae84e3e129de97ee8fdad5fd628683f"></a>SSL_CA_FILE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba1707f77739201a2e6bd9c894c473a244" name="a06fc87d81c62e9abb8790b6e5713c55ba1707f77739201a2e6bd9c894c473a244"></a>SSL_VERIFY_DEPTH&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba5965f9b2d16d3989a9a8411486e8dd08" name="a06fc87d81c62e9abb8790b6e5713c55ba5965f9b2d16d3989a9a8411486e8dd08"></a>SSL_DEFAULT_VERIFY_PATHS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba78ec09de569b58d0a71425ee91b02f44" name="a06fc87d81c62e9abb8790b6e5713c55ba78ec09de569b58d0a71425ee91b02f44"></a>SSL_CIPHER_LIST&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba1997d8cac42e06e1a65c2da6e80f9706" name="a06fc87d81c62e9abb8790b6e5713c55ba1997d8cac42e06e1a65c2da6e80f9706"></a>SSL_PROTOCOL_VERSION&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba03662ada095078ef2ebd1d7c624e0b5f" name="a06fc87d81c62e9abb8790b6e5713c55ba03662ada095078ef2ebd1d7c624e0b5f"></a>SSL_SHORT_TRUST&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba18505d55559e2f7fee94e1ec4f1361d0" name="a06fc87d81c62e9abb8790b6e5713c55ba18505d55559e2f7fee94e1ec4f1361d0"></a>ACCESS_CONTROL_ALLOW_ORIGIN&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba6369d07e303c71b53dbc62f42bf4ebe2" name="a06fc87d81c62e9abb8790b6e5713c55ba6369d07e303c71b53dbc62f42bf4ebe2"></a>ACCESS_CONTROL_ALLOW_METHODS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba43c2119bd7a41e72316c4fd26c3eaa70" name="a06fc87d81c62e9abb8790b6e5713c55ba43c2119bd7a41e72316c4fd26c3eaa70"></a>ACCESS_CONTROL_ALLOW_HEADERS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba80a0b839f2bfedfe7e973a0e1211a6d6" name="a06fc87d81c62e9abb8790b6e5713c55ba80a0b839f2bfedfe7e973a0e1211a6d6"></a>ERROR_PAGES&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba6b580243dfe971149cd10cfa449369ac" name="a06fc87d81c62e9abb8790b6e5713c55ba6b580243dfe971149cd10cfa449369ac"></a>STATIC_FILE_MAX_AGE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba806e32a13c862b980a792a2183c5cb2d" name="a06fc87d81c62e9abb8790b6e5713c55ba806e32a13c862b980a792a2183c5cb2d"></a>STATIC_FILE_CACHE_CONTROL&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba64a313cf2fe6e0540cf30467a3ab7789" name="a06fc87d81c62e9abb8790b6e5713c55ba64a313cf2fe6e0540cf30467a3ab7789"></a>STRICT_HTTPS_MAX_AGE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba154fd2c7788b97dd4ea040e669a4cd1d" name="a06fc87d81c62e9abb8790b6e5713c55ba154fd2c7788b97dd4ea040e669a4cd1d"></a>ADDITIONAL_HEADER&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55ba2b3396fe44b8e2601349457d7357f6cc" name="a06fc87d81c62e9abb8790b6e5713c55ba2b3396fe44b8e2601349457d7357f6cc"></a>ALLOW_INDEX_SCRIPT_SUB_RES&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a06fc87d81c62e9abb8790b6e5713c55baa287c83808b815cdf6a1c2756b6332f1" name="a06fc87d81c62e9abb8790b6e5713c55baa287c83808b815cdf6a1c2756b6332f1"></a>NUM_OPTIONS&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01918">1918</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1918</span>     {</div>
<div class="line"><span class="lineno"> 1919</span>    <span class="comment">/* Once for each server */</span></div>
<div class="line"><span class="lineno"> 1920</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e">LISTENING_PORTS</a>,</div>
<div class="line"><span class="lineno"> 1921</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa818676aedda10c1d780a84133662831">NUM_THREADS</a>,</div>
<div class="line"><span class="lineno"> 1922</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba2273c8f628cf101bc49496219571b0c4">RUN_AS_USER</a>,</div>
<div class="line"><span class="lineno"> 1923</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bae7af9fa992c8547645bac2ca940153b0">CONFIG_TCP_NODELAY</a>, <span class="comment">/* Prepended CONFIG_ to avoid conflict with the</span></div>
<div class="line"><span class="lineno"> 1924</span><span class="comment">                         * socket option typedef TCP_NODELAY. */</span></div>
<div class="line"><span class="lineno"> 1925</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5">MAX_REQUEST_SIZE</a>,</div>
<div class="line"><span class="lineno"> 1926</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba6e6c7723fb9a76f3d7afde265e782141">LINGER_TIMEOUT</a>,</div>
<div class="line"><span class="lineno"> 1927</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3">CONNECTION_QUEUE_SIZE</a>,</div>
<div class="line"><span class="lineno"> 1928</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf13327a7aed89d59cc7e4200d088f205">LISTEN_BACKLOG_SIZE</a>,</div>
<div class="line"><span class="lineno"> 1929</span><span class="preprocessor">#if defined(__linux__)</span></div>
<div class="line"><span class="lineno"> 1930</span>    ALLOW_SENDFILE_CALL,</div>
<div class="line"><span class="lineno"> 1931</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1932</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 1933</span>    CASE_SENSITIVE_FILES,</div>
<div class="line"><span class="lineno"> 1934</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1935</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba73fe0376eae56e950136313f635836e2">THROTTLE</a>,</div>
<div class="line"><span class="lineno"> 1936</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba39a8b8c4df6154e815a5a49da528ce5c">ENABLE_KEEP_ALIVE</a>,</div>
<div class="line"><span class="lineno"> 1937</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>,</div>
<div class="line"><span class="lineno"> 1938</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba79dc6ec73a693de1fbe2397ce42af360">KEEP_ALIVE_TIMEOUT</a>,</div>
<div class="line"><span class="lineno"> 1939</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno"> 1940</span>    WEBSOCKET_TIMEOUT,</div>
<div class="line"><span class="lineno"> 1941</span>    ENABLE_WEBSOCKET_PING_PONG,</div>
<div class="line"><span class="lineno"> 1942</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1943</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa7da030a4d709729f351258b77fad121">DECODE_URL</a>,</div>
<div class="line"><span class="lineno"> 1944</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf20363ab43e572880dc69d8fe634c114">DECODE_QUERY_STRING</a>,</div>
<div class="line"><span class="lineno"> 1945</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno"> 1946</span>    LUA_BACKGROUND_SCRIPT,</div>
<div class="line"><span class="lineno"> 1947</span>    LUA_BACKGROUND_SCRIPT_PARAMS,</div>
<div class="line"><span class="lineno"> 1948</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1949</span><span class="preprocessor">#if defined(USE_HTTP2)</span></div>
<div class="line"><span class="lineno"> 1950</span>    ENABLE_HTTP2,</div>
<div class="line"><span class="lineno"> 1951</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1952</span> </div>
<div class="line"><span class="lineno"> 1953</span>    <span class="comment">/* Once for each domain */</span></div>
<div class="line"><span class="lineno"> 1954</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>,</div>
<div class="line"><span class="lineno"> 1955</span> </div>
<div class="line"><span class="lineno"> 1956</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bac3c40480ddeeae7beeed79fc399329e3">ACCESS_LOG_FILE</a>,</div>
<div class="line"><span class="lineno"> 1957</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba66ac785400448f574aa25e2943f3a854">ERROR_LOG_FILE</a>,</div>
<div class="line"><span class="lineno"> 1958</span> </div>
<div class="line"><span class="lineno"> 1959</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a>,</div>
<div class="line"><span class="lineno"> 1960</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba850b5c3820657d2b3a4d5a07c7c02616">CGI_ENVIRONMENT</a>,</div>
<div class="line"><span class="lineno"> 1961</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baed83717b03766bd7c931b4e2fbae3384">CGI_INTERPRETER</a>,</div>
<div class="line"><span class="lineno"> 1962</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba3bdbf4db41e054e3f6c087b4299c66c0">CGI_INTERPRETER_ARGS</a>,</div>
<div class="line"><span class="lineno"> 1963</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno"> 1964</span>    CGI_TIMEOUT,</div>
<div class="line"><span class="lineno"> 1965</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1966</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55babb844e7f11a02780ac6a94b3b4dd754d">CGI_BUFFERING</a>,</div>
<div class="line"><span class="lineno"> 1967</span> </div>
<div class="line"><span class="lineno"> 1968</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba5d225462bc3b0836805df00f580cb7ea">CGI2_EXTENSIONS</a>,</div>
<div class="line"><span class="lineno"> 1969</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bab6b21529583f9a7dc58484925b8babe8">CGI2_ENVIRONMENT</a>,</div>
<div class="line"><span class="lineno"> 1970</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf64cc929494eda240d914b67c0b1f9e9">CGI2_INTERPRETER</a>,</div>
<div class="line"><span class="lineno"> 1971</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba68a38509add8b770910afaf010696277">CGI2_INTERPRETER_ARGS</a>,</div>
<div class="line"><span class="lineno"> 1972</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno"> 1973</span>    CGI2_TIMEOUT,</div>
<div class="line"><span class="lineno"> 1974</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1975</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba2e5da0c85d9043e7e4404fdc0e2787a6">CGI2_BUFFERING</a>,</div>
<div class="line"><span class="lineno"> 1976</span> </div>
<div class="line"><span class="lineno"> 1977</span><span class="preprocessor">#if defined(USE_4_CGI)</span></div>
<div class="line"><span class="lineno"> 1978</span>    CGI3_EXTENSIONS,</div>
<div class="line"><span class="lineno"> 1979</span>    CGI3_ENVIRONMENT,</div>
<div class="line"><span class="lineno"> 1980</span>    CGI3_INTERPRETER,</div>
<div class="line"><span class="lineno"> 1981</span>    CGI3_INTERPRETER_ARGS,</div>
<div class="line"><span class="lineno"> 1982</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno"> 1983</span>    CGI3_TIMEOUT,</div>
<div class="line"><span class="lineno"> 1984</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1985</span>    CGI3_BUFFERING,</div>
<div class="line"><span class="lineno"> 1986</span> </div>
<div class="line"><span class="lineno"> 1987</span>    CGI4_EXTENSIONS,</div>
<div class="line"><span class="lineno"> 1988</span>    CGI4_ENVIRONMENT,</div>
<div class="line"><span class="lineno"> 1989</span>    CGI4_INTERPRETER,</div>
<div class="line"><span class="lineno"> 1990</span>    CGI4_INTERPRETER_ARGS,</div>
<div class="line"><span class="lineno"> 1991</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno"> 1992</span>    CGI4_TIMEOUT,</div>
<div class="line"><span class="lineno"> 1993</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1994</span>    CGI4_BUFFERING,</div>
<div class="line"><span class="lineno"> 1995</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1996</span> </div>
<div class="line"><span class="lineno"> 1997</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba9f0c9561bdb0b2b975178617c8d3c59a">PUT_DELETE_PASSWORDS_FILE</a>, <span class="comment">/* must follow CGI_* */</span></div>
<div class="line"><span class="lineno"> 1998</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bac05d91b095136909d3bb88f857770b34">PROTECT_URI</a>,</div>
<div class="line"><span class="lineno"> 1999</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>,</div>
<div class="line"><span class="lineno"> 2000</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa196eb33164714d8b04ace074a72c492">ENABLE_AUTH_DOMAIN_CHECK</a>,</div>
<div class="line"><span class="lineno"> 2001</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad759d92bd3b0e4870bb7d92ad10399b4">SSI_EXTENSIONS</a>,</div>
<div class="line"><span class="lineno"> 2002</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba00459f3ca65ce96fa33c3d5230624328">ENABLE_DIRECTORY_LISTING</a>,</div>
<div class="line"><span class="lineno"> 2003</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba5dc474ce23af919313afd42d5610bc05">ENABLE_WEBDAV</a>,</div>
<div class="line"><span class="lineno"> 2004</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba0d86924aee1330b50c85079ae6ff8032">GLOBAL_PASSWORDS_FILE</a>,</div>
<div class="line"><span class="lineno"> 2005</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bafa9f4efa175d81e138ff3aa53aa00930">INDEX_FILES</a>,</div>
<div class="line"><span class="lineno"> 2006</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba3afb385e81857461e2860a6bc661020c">ACCESS_CONTROL_LIST</a>,</div>
<div class="line"><span class="lineno"> 2007</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bafe5280fd7fcd9876652bc64790c74c23">EXTRA_MIME_TYPES</a>,</div>
<div class="line"><span class="lineno"> 2008</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1bb8ebf1124ab1bb589866f06e54e71f">SSL_CERTIFICATE</a>,</div>
<div class="line"><span class="lineno"> 2009</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baacb7b39407a541fbda68aafd33193470">SSL_CERTIFICATE_CHAIN</a>,</div>
<div class="line"><span class="lineno"> 2010</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba73b1fb0778577d79d9a9906538f397b7">URL_REWRITE_PATTERN</a>,</div>
<div class="line"><span class="lineno"> 2011</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba661e684fd980c2be1848413e1ec8fe35">HIDE_FILES</a>,</div>
<div class="line"><span class="lineno"> 2012</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac">SSL_DO_VERIFY_PEER</a>,</div>
<div class="line"><span class="lineno"> 2013</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba359ab5a360678365c390cba52eef08ba">SSL_CACHE_TIMEOUT</a>,</div>
<div class="line"><span class="lineno"> 2014</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba3e3b29034498dd70486ada574bcd4d6d">SSL_CA_PATH</a>,</div>
<div class="line"><span class="lineno"> 2015</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baeae84e3e129de97ee8fdad5fd628683f">SSL_CA_FILE</a>,</div>
<div class="line"><span class="lineno"> 2016</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1707f77739201a2e6bd9c894c473a244">SSL_VERIFY_DEPTH</a>,</div>
<div class="line"><span class="lineno"> 2017</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba5965f9b2d16d3989a9a8411486e8dd08">SSL_DEFAULT_VERIFY_PATHS</a>,</div>
<div class="line"><span class="lineno"> 2018</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba78ec09de569b58d0a71425ee91b02f44">SSL_CIPHER_LIST</a>,</div>
<div class="line"><span class="lineno"> 2019</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1997d8cac42e06e1a65c2da6e80f9706">SSL_PROTOCOL_VERSION</a>,</div>
<div class="line"><span class="lineno"> 2020</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba03662ada095078ef2ebd1d7c624e0b5f">SSL_SHORT_TRUST</a>,</div>
<div class="line"><span class="lineno"> 2021</span> </div>
<div class="line"><span class="lineno"> 2022</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno"> 2023</span>    LUA_PRELOAD_FILE,</div>
<div class="line"><span class="lineno"> 2024</span>    LUA_SCRIPT_EXTENSIONS,</div>
<div class="line"><span class="lineno"> 2025</span>    LUA_SERVER_PAGE_EXTENSIONS,</div>
<div class="line"><span class="lineno"> 2026</span><span class="preprocessor">#if defined(MG_EXPERIMENTAL_INTERFACES)</span></div>
<div class="line"><span class="lineno"> 2027</span>    LUA_DEBUG_PARAMS,</div>
<div class="line"><span class="lineno"> 2028</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2029</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2030</span><span class="preprocessor">#if defined(USE_DUKTAPE)</span></div>
<div class="line"><span class="lineno"> 2031</span>    DUKTAPE_SCRIPT_EXTENSIONS,</div>
<div class="line"><span class="lineno"> 2032</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2033</span> </div>
<div class="line"><span class="lineno"> 2034</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno"> 2035</span>    WEBSOCKET_ROOT,</div>
<div class="line"><span class="lineno"> 2036</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2037</span><span class="preprocessor">#if defined(USE_LUA) &amp;&amp; defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno"> 2038</span>    LUA_WEBSOCKET_EXTENSIONS,</div>
<div class="line"><span class="lineno"> 2039</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2040</span> </div>
<div class="line"><span class="lineno"> 2041</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba18505d55559e2f7fee94e1ec4f1361d0">ACCESS_CONTROL_ALLOW_ORIGIN</a>,</div>
<div class="line"><span class="lineno"> 2042</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba6369d07e303c71b53dbc62f42bf4ebe2">ACCESS_CONTROL_ALLOW_METHODS</a>,</div>
<div class="line"><span class="lineno"> 2043</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43c2119bd7a41e72316c4fd26c3eaa70">ACCESS_CONTROL_ALLOW_HEADERS</a>,</div>
<div class="line"><span class="lineno"> 2044</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba80a0b839f2bfedfe7e973a0e1211a6d6">ERROR_PAGES</a>,</div>
<div class="line"><span class="lineno"> 2045</span><span class="preprocessor">#if !defined(NO_CACHING)</span></div>
<div class="line"><span class="lineno"> 2046</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba6b580243dfe971149cd10cfa449369ac">STATIC_FILE_MAX_AGE</a>,</div>
<div class="line"><span class="lineno"> 2047</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba806e32a13c862b980a792a2183c5cb2d">STATIC_FILE_CACHE_CONTROL</a>,</div>
<div class="line"><span class="lineno"> 2048</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2049</span><span class="preprocessor">#if !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno"> 2050</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba64a313cf2fe6e0540cf30467a3ab7789">STRICT_HTTPS_MAX_AGE</a>,</div>
<div class="line"><span class="lineno"> 2051</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2052</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba154fd2c7788b97dd4ea040e669a4cd1d">ADDITIONAL_HEADER</a>,</div>
<div class="line"><span class="lineno"> 2053</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba2b3396fe44b8e2601349457d7357f6cc">ALLOW_INDEX_SCRIPT_SUB_RES</a>,</div>
<div class="line"><span class="lineno"> 2054</span> </div>
<div class="line"><span class="lineno"> 2055</span>    <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa287c83808b815cdf6a1c2756b6332f1">NUM_OPTIONS</a></div>
<div class="line"><span class="lineno"> 2056</span>};</div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba00459f3ca65ce96fa33c3d5230624328"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba00459f3ca65ce96fa33c3d5230624328">ENABLE_DIRECTORY_LISTING</a></div><div class="ttdeci">@ ENABLE_DIRECTORY_LISTING</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02002">civetweb.c:2002</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba03662ada095078ef2ebd1d7c624e0b5f"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba03662ada095078ef2ebd1d7c624e0b5f">SSL_SHORT_TRUST</a></div><div class="ttdeci">@ SSL_SHORT_TRUST</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02020">civetweb.c:2020</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba0d86924aee1330b50c85079ae6ff8032"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba0d86924aee1330b50c85079ae6ff8032">GLOBAL_PASSWORDS_FILE</a></div><div class="ttdeci">@ GLOBAL_PASSWORDS_FILE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02004">civetweb.c:2004</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba154fd2c7788b97dd4ea040e669a4cd1d"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba154fd2c7788b97dd4ea040e669a4cd1d">ADDITIONAL_HEADER</a></div><div class="ttdeci">@ ADDITIONAL_HEADER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02052">civetweb.c:2052</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba1707f77739201a2e6bd9c894c473a244"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba1707f77739201a2e6bd9c894c473a244">SSL_VERIFY_DEPTH</a></div><div class="ttdeci">@ SSL_VERIFY_DEPTH</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02016">civetweb.c:2016</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba18505d55559e2f7fee94e1ec4f1361d0"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba18505d55559e2f7fee94e1ec4f1361d0">ACCESS_CONTROL_ALLOW_ORIGIN</a></div><div class="ttdeci">@ ACCESS_CONTROL_ALLOW_ORIGIN</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02041">civetweb.c:2041</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba1997d8cac42e06e1a65c2da6e80f9706"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba1997d8cac42e06e1a65c2da6e80f9706">SSL_PROTOCOL_VERSION</a></div><div class="ttdeci">@ SSL_PROTOCOL_VERSION</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02019">civetweb.c:2019</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac">SSL_DO_VERIFY_PEER</a></div><div class="ttdeci">@ SSL_DO_VERIFY_PEER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02012">civetweb.c:2012</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba1bb8ebf1124ab1bb589866f06e54e71f"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba1bb8ebf1124ab1bb589866f06e54e71f">SSL_CERTIFICATE</a></div><div class="ttdeci">@ SSL_CERTIFICATE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02008">civetweb.c:2008</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba2273c8f628cf101bc49496219571b0c4"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba2273c8f628cf101bc49496219571b0c4">RUN_AS_USER</a></div><div class="ttdeci">@ RUN_AS_USER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01922">civetweb.c:1922</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba2b3396fe44b8e2601349457d7357f6cc"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba2b3396fe44b8e2601349457d7357f6cc">ALLOW_INDEX_SCRIPT_SUB_RES</a></div><div class="ttdeci">@ ALLOW_INDEX_SCRIPT_SUB_RES</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02053">civetweb.c:2053</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba2e5da0c85d9043e7e4404fdc0e2787a6"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba2e5da0c85d9043e7e4404fdc0e2787a6">CGI2_BUFFERING</a></div><div class="ttdeci">@ CGI2_BUFFERING</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01975">civetweb.c:1975</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba359ab5a360678365c390cba52eef08ba"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba359ab5a360678365c390cba52eef08ba">SSL_CACHE_TIMEOUT</a></div><div class="ttdeci">@ SSL_CACHE_TIMEOUT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02013">civetweb.c:2013</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3">CONNECTION_QUEUE_SIZE</a></div><div class="ttdeci">@ CONNECTION_QUEUE_SIZE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01927">civetweb.c:1927</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba39a8b8c4df6154e815a5a49da528ce5c"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba39a8b8c4df6154e815a5a49da528ce5c">ENABLE_KEEP_ALIVE</a></div><div class="ttdeci">@ ENABLE_KEEP_ALIVE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01936">civetweb.c:1936</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba3afb385e81857461e2860a6bc661020c"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba3afb385e81857461e2860a6bc661020c">ACCESS_CONTROL_LIST</a></div><div class="ttdeci">@ ACCESS_CONTROL_LIST</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02006">civetweb.c:2006</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba3bdbf4db41e054e3f6c087b4299c66c0"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba3bdbf4db41e054e3f6c087b4299c66c0">CGI_INTERPRETER_ARGS</a></div><div class="ttdeci">@ CGI_INTERPRETER_ARGS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01962">civetweb.c:1962</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba3e3b29034498dd70486ada574bcd4d6d"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba3e3b29034498dd70486ada574bcd4d6d">SSL_CA_PATH</a></div><div class="ttdeci">@ SSL_CA_PATH</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02014">civetweb.c:2014</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a></div><div class="ttdeci">@ AUTHENTICATION_DOMAIN</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01999">civetweb.c:1999</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba43c2119bd7a41e72316c4fd26c3eaa70"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba43c2119bd7a41e72316c4fd26c3eaa70">ACCESS_CONTROL_ALLOW_HEADERS</a></div><div class="ttdeci">@ ACCESS_CONTROL_ALLOW_HEADERS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02043">civetweb.c:2043</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba5965f9b2d16d3989a9a8411486e8dd08"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba5965f9b2d16d3989a9a8411486e8dd08">SSL_DEFAULT_VERIFY_PATHS</a></div><div class="ttdeci">@ SSL_DEFAULT_VERIFY_PATHS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02017">civetweb.c:2017</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba5d225462bc3b0836805df00f580cb7ea"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba5d225462bc3b0836805df00f580cb7ea">CGI2_EXTENSIONS</a></div><div class="ttdeci">@ CGI2_EXTENSIONS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01968">civetweb.c:1968</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba5dc474ce23af919313afd42d5610bc05"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba5dc474ce23af919313afd42d5610bc05">ENABLE_WEBDAV</a></div><div class="ttdeci">@ ENABLE_WEBDAV</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02003">civetweb.c:2003</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba6369d07e303c71b53dbc62f42bf4ebe2"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba6369d07e303c71b53dbc62f42bf4ebe2">ACCESS_CONTROL_ALLOW_METHODS</a></div><div class="ttdeci">@ ACCESS_CONTROL_ALLOW_METHODS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02042">civetweb.c:2042</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba64a313cf2fe6e0540cf30467a3ab7789"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba64a313cf2fe6e0540cf30467a3ab7789">STRICT_HTTPS_MAX_AGE</a></div><div class="ttdeci">@ STRICT_HTTPS_MAX_AGE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02050">civetweb.c:2050</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba661e684fd980c2be1848413e1ec8fe35"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba661e684fd980c2be1848413e1ec8fe35">HIDE_FILES</a></div><div class="ttdeci">@ HIDE_FILES</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02011">civetweb.c:2011</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba66ac785400448f574aa25e2943f3a854"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba66ac785400448f574aa25e2943f3a854">ERROR_LOG_FILE</a></div><div class="ttdeci">@ ERROR_LOG_FILE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01957">civetweb.c:1957</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba68a38509add8b770910afaf010696277"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba68a38509add8b770910afaf010696277">CGI2_INTERPRETER_ARGS</a></div><div class="ttdeci">@ CGI2_INTERPRETER_ARGS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01971">civetweb.c:1971</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba6b580243dfe971149cd10cfa449369ac"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba6b580243dfe971149cd10cfa449369ac">STATIC_FILE_MAX_AGE</a></div><div class="ttdeci">@ STATIC_FILE_MAX_AGE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02046">civetweb.c:2046</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba6e6c7723fb9a76f3d7afde265e782141"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba6e6c7723fb9a76f3d7afde265e782141">LINGER_TIMEOUT</a></div><div class="ttdeci">@ LINGER_TIMEOUT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01926">civetweb.c:1926</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba73b1fb0778577d79d9a9906538f397b7"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba73b1fb0778577d79d9a9906538f397b7">URL_REWRITE_PATTERN</a></div><div class="ttdeci">@ URL_REWRITE_PATTERN</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02010">civetweb.c:2010</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba73fe0376eae56e950136313f635836e2"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba73fe0376eae56e950136313f635836e2">THROTTLE</a></div><div class="ttdeci">@ THROTTLE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01935">civetweb.c:1935</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba78ec09de569b58d0a71425ee91b02f44"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba78ec09de569b58d0a71425ee91b02f44">SSL_CIPHER_LIST</a></div><div class="ttdeci">@ SSL_CIPHER_LIST</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02018">civetweb.c:2018</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba79dc6ec73a693de1fbe2397ce42af360"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba79dc6ec73a693de1fbe2397ce42af360">KEEP_ALIVE_TIMEOUT</a></div><div class="ttdeci">@ KEEP_ALIVE_TIMEOUT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01938">civetweb.c:1938</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a></div><div class="ttdeci">@ CGI_EXTENSIONS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01959">civetweb.c:1959</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba806e32a13c862b980a792a2183c5cb2d"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba806e32a13c862b980a792a2183c5cb2d">STATIC_FILE_CACHE_CONTROL</a></div><div class="ttdeci">@ STATIC_FILE_CACHE_CONTROL</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02047">civetweb.c:2047</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba80a0b839f2bfedfe7e973a0e1211a6d6"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba80a0b839f2bfedfe7e973a0e1211a6d6">ERROR_PAGES</a></div><div class="ttdeci">@ ERROR_PAGES</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02044">civetweb.c:2044</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba850b5c3820657d2b3a4d5a07c7c02616"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba850b5c3820657d2b3a4d5a07c7c02616">CGI_ENVIRONMENT</a></div><div class="ttdeci">@ CGI_ENVIRONMENT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01960">civetweb.c:1960</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55ba9f0c9561bdb0b2b975178617c8d3c59a"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55ba9f0c9561bdb0b2b975178617c8d3c59a">PUT_DELETE_PASSWORDS_FILE</a></div><div class="ttdeci">@ PUT_DELETE_PASSWORDS_FILE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01997">civetweb.c:1997</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baa196eb33164714d8b04ace074a72c492"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baa196eb33164714d8b04ace074a72c492">ENABLE_AUTH_DOMAIN_CHECK</a></div><div class="ttdeci">@ ENABLE_AUTH_DOMAIN_CHECK</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02000">civetweb.c:2000</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baa287c83808b815cdf6a1c2756b6332f1"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baa287c83808b815cdf6a1c2756b6332f1">NUM_OPTIONS</a></div><div class="ttdeci">@ NUM_OPTIONS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02056">civetweb.c:2055</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5">MAX_REQUEST_SIZE</a></div><div class="ttdeci">@ MAX_REQUEST_SIZE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01925">civetweb.c:1925</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baa7da030a4d709729f351258b77fad121"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baa7da030a4d709729f351258b77fad121">DECODE_URL</a></div><div class="ttdeci">@ DECODE_URL</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01943">civetweb.c:1943</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baa818676aedda10c1d780a84133662831"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baa818676aedda10c1d780a84133662831">NUM_THREADS</a></div><div class="ttdeci">@ NUM_THREADS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01921">civetweb.c:1921</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a></div><div class="ttdeci">@ DOCUMENT_ROOT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01954">civetweb.c:1954</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baacb7b39407a541fbda68aafd33193470"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baacb7b39407a541fbda68aafd33193470">SSL_CERTIFICATE_CHAIN</a></div><div class="ttdeci">@ SSL_CERTIFICATE_CHAIN</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02009">civetweb.c:2009</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55bab6b21529583f9a7dc58484925b8babe8"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55bab6b21529583f9a7dc58484925b8babe8">CGI2_ENVIRONMENT</a></div><div class="ttdeci">@ CGI2_ENVIRONMENT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01969">civetweb.c:1969</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55babb844e7f11a02780ac6a94b3b4dd754d"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55babb844e7f11a02780ac6a94b3b4dd754d">CGI_BUFFERING</a></div><div class="ttdeci">@ CGI_BUFFERING</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01966">civetweb.c:1966</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55bac05d91b095136909d3bb88f857770b34"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55bac05d91b095136909d3bb88f857770b34">PROTECT_URI</a></div><div class="ttdeci">@ PROTECT_URI</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01998">civetweb.c:1998</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55bac3c40480ddeeae7beeed79fc399329e3"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55bac3c40480ddeeae7beeed79fc399329e3">ACCESS_LOG_FILE</a></div><div class="ttdeci">@ ACCESS_LOG_FILE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01956">civetweb.c:1956</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a></div><div class="ttdeci">@ REQUEST_TIMEOUT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01937">civetweb.c:1937</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55bad759d92bd3b0e4870bb7d92ad10399b4"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55bad759d92bd3b0e4870bb7d92ad10399b4">SSI_EXTENSIONS</a></div><div class="ttdeci">@ SSI_EXTENSIONS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02001">civetweb.c:2001</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55bae7af9fa992c8547645bac2ca940153b0"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55bae7af9fa992c8547645bac2ca940153b0">CONFIG_TCP_NODELAY</a></div><div class="ttdeci">@ CONFIG_TCP_NODELAY</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01923">civetweb.c:1923</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baeae84e3e129de97ee8fdad5fd628683f"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baeae84e3e129de97ee8fdad5fd628683f">SSL_CA_FILE</a></div><div class="ttdeci">@ SSL_CA_FILE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02015">civetweb.c:2015</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baed83717b03766bd7c931b4e2fbae3384"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baed83717b03766bd7c931b4e2fbae3384">CGI_INTERPRETER</a></div><div class="ttdeci">@ CGI_INTERPRETER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01961">civetweb.c:1961</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baf13327a7aed89d59cc7e4200d088f205"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baf13327a7aed89d59cc7e4200d088f205">LISTEN_BACKLOG_SIZE</a></div><div class="ttdeci">@ LISTEN_BACKLOG_SIZE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01928">civetweb.c:1928</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baf20363ab43e572880dc69d8fe634c114"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baf20363ab43e572880dc69d8fe634c114">DECODE_QUERY_STRING</a></div><div class="ttdeci">@ DECODE_QUERY_STRING</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01944">civetweb.c:1944</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e">LISTENING_PORTS</a></div><div class="ttdeci">@ LISTENING_PORTS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01920">civetweb.c:1920</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55baf64cc929494eda240d914b67c0b1f9e9"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55baf64cc929494eda240d914b67c0b1f9e9">CGI2_INTERPRETER</a></div><div class="ttdeci">@ CGI2_INTERPRETER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01970">civetweb.c:1970</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55bafa9f4efa175d81e138ff3aa53aa00930"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55bafa9f4efa175d81e138ff3aa53aa00930">INDEX_FILES</a></div><div class="ttdeci">@ INDEX_FILES</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02005">civetweb.c:2005</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a06fc87d81c62e9abb8790b6e5713c55bafe5280fd7fcd9876652bc64790c74c23"><div class="ttname"><a href="#a06fc87d81c62e9abb8790b6e5713c55bafe5280fd7fcd9876652bc64790c74c23">EXTRA_MIME_TYPES</a></div><div class="ttdeci">@ EXTRA_MIME_TYPES</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02007">civetweb.c:2007</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adf764cbdea00d65edcd07bb9953ad2b7" name="adf764cbdea00d65edcd07bb9953ad2b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf764cbdea00d65edcd07bb9953ad2b7">&#9670;&#160;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e" name="adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e"></a>REQUEST_HANDLER&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484" name="adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484"></a>WEBSOCKET_HANDLER&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="adf764cbdea00d65edcd07bb9953ad2b7a8617f4f76318f5c524016c5bc6fa864c" name="adf764cbdea00d65edcd07bb9953ad2b7a8617f4f76318f5c524016c5bc6fa864c"></a>AUTH_HANDLER&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02225">2225</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2225</span>{ <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a>, <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484">WEBSOCKET_HANDLER</a>, <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7a8617f4f76318f5c524016c5bc6fa864c">AUTH_HANDLER</a> };</div>
<div class="ttc" id="acivetweb_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a8617f4f76318f5c524016c5bc6fa864c"><div class="ttname"><a href="#adf764cbdea00d65edcd07bb9953ad2b7a8617f4f76318f5c524016c5bc6fa864c">AUTH_HANDLER</a></div><div class="ttdeci">@ AUTH_HANDLER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02225">civetweb.c:2225</a></div></div>
<div class="ttc" id="acivetweb_8c_html_adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e"><div class="ttname"><a href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a></div><div class="ttdeci">@ REQUEST_HANDLER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02225">civetweb.c:2225</a></div></div>
<div class="ttc" id="acivetweb_8c_html_adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484"><div class="ttname"><a href="#adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484">WEBSOCKET_HANDLER</a></div><div class="ttdeci">@ WEBSOCKET_HANDLER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02225">civetweb.c:2225</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a99fb83031ce9923c84392b4e92f956b5" name="a99fb83031ce9923c84392b4e92f956b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99fb83031ce9923c84392b4e92f956b5">&#9670;&#160;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5a345625fe7dc0282d2fa4cc35cd820fb2" name="a99fb83031ce9923c84392b4e92f956b5a345625fe7dc0282d2fa4cc35cd820fb2"></a>CONTEXT_INVALID&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099" name="a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099"></a>CONTEXT_SERVER&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5ac5e9108e1a7588fe9429108516575440" name="a99fb83031ce9923c84392b4e92f956b5ac5e9108e1a7588fe9429108516575440"></a>CONTEXT_HTTP_CLIENT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5a03e63e1c82cfb5e937a777e71c4a40f2" name="a99fb83031ce9923c84392b4e92f956b5a03e63e1c82cfb5e937a777e71c4a40f2"></a>CONTEXT_WS_CLIENT&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02261">2261</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2261</span>     {</div>
<div class="line"><span class="lineno"> 2262</span>    <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a345625fe7dc0282d2fa4cc35cd820fb2">CONTEXT_INVALID</a>,</div>
<div class="line"><span class="lineno"> 2263</span>    <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099">CONTEXT_SERVER</a>,</div>
<div class="line"><span class="lineno"> 2264</span>    <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5ac5e9108e1a7588fe9429108516575440">CONTEXT_HTTP_CLIENT</a>,</div>
<div class="line"><span class="lineno"> 2265</span>    <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a03e63e1c82cfb5e937a777e71c4a40f2">CONTEXT_WS_CLIENT</a></div>
<div class="line"><span class="lineno"> 2266</span>};</div>
<div class="ttc" id="acivetweb_8c_html_a99fb83031ce9923c84392b4e92f956b5a03e63e1c82cfb5e937a777e71c4a40f2"><div class="ttname"><a href="#a99fb83031ce9923c84392b4e92f956b5a03e63e1c82cfb5e937a777e71c4a40f2">CONTEXT_WS_CLIENT</a></div><div class="ttdeci">@ CONTEXT_WS_CLIENT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02266">civetweb.c:2265</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a99fb83031ce9923c84392b4e92f956b5a345625fe7dc0282d2fa4cc35cd820fb2"><div class="ttname"><a href="#a99fb83031ce9923c84392b4e92f956b5a345625fe7dc0282d2fa4cc35cd820fb2">CONTEXT_INVALID</a></div><div class="ttdeci">@ CONTEXT_INVALID</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02262">civetweb.c:2262</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099"><div class="ttname"><a href="#a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099">CONTEXT_SERVER</a></div><div class="ttdeci">@ CONTEXT_SERVER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02263">civetweb.c:2263</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a99fb83031ce9923c84392b4e92f956b5ac5e9108e1a7588fe9429108516575440"><div class="ttname"><a href="#a99fb83031ce9923c84392b4e92f956b5ac5e9108e1a7588fe9429108516575440">CONTEXT_HTTP_CLIENT</a></div><div class="ttdeci">@ CONTEXT_HTTP_CLIENT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02264">civetweb.c:2264</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abc6126af1d45847bc59afa0aa3216b04" name="abc6126af1d45847bc59afa0aa3216b04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc6126af1d45847bc59afa0aa3216b04">&#9670;&#160;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04ad728da0f171f49e9778426365c03eef1" name="abc6126af1d45847bc59afa0aa3216b04ad728da0f171f49e9778426365c03eef1"></a>CONNECTION_TYPE_INVALID&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e" name="abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e"></a>CONNECTION_TYPE_REQUEST&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411" name="abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411"></a>CONNECTION_TYPE_RESPONSE&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02459">2459</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2459</span>     {</div>
<div class="line"><span class="lineno"> 2460</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04ad728da0f171f49e9778426365c03eef1">CONNECTION_TYPE_INVALID</a> = 0,</div>
<div class="line"><span class="lineno"> 2461</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a> = 1,</div>
<div class="line"><span class="lineno"> 2462</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411">CONNECTION_TYPE_RESPONSE</a> = 2</div>
<div class="line"><span class="lineno"> 2463</span>};</div>
<div class="ttc" id="acivetweb_8c_html_abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411">CONNECTION_TYPE_RESPONSE</a></div><div class="ttdeci">@ CONNECTION_TYPE_RESPONSE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02463">civetweb.c:2462</a></div></div>
<div class="ttc" id="acivetweb_8c_html_abc6126af1d45847bc59afa0aa3216b04ad728da0f171f49e9778426365c03eef1"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04ad728da0f171f49e9778426365c03eef1">CONNECTION_TYPE_INVALID</a></div><div class="ttdeci">@ CONNECTION_TYPE_INVALID</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02460">civetweb.c:2460</a></div></div>
<div class="ttc" id="acivetweb_8c_html_abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a></div><div class="ttdeci">@ CONNECTION_TYPE_REQUEST</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02461">civetweb.c:2461</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adc29c2ff13d900c2f185ee95427fb06c" name="adc29c2ff13d900c2f185ee95427fb06c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc29c2ff13d900c2f185ee95427fb06c">&#9670;&#160;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78" name="adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78"></a>PROTOCOL_TYPE_HTTP1&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436" name="adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436"></a>PROTOCOL_TYPE_WEBSOCKET&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="adc29c2ff13d900c2f185ee95427fb06ca3c3663fdf461dc9873cadc4a36b3a139" name="adc29c2ff13d900c2f185ee95427fb06ca3c3663fdf461dc9873cadc4a36b3a139"></a>PROTOCOL_TYPE_HTTP2&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02465">2465</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2465</span>     {</div>
<div class="line"><span class="lineno"> 2466</span>    <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a> = 0,</div>
<div class="line"><span class="lineno"> 2467</span>    <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436">PROTOCOL_TYPE_WEBSOCKET</a> = 1,</div>
<div class="line"><span class="lineno"> 2468</span>    <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca3c3663fdf461dc9873cadc4a36b3a139">PROTOCOL_TYPE_HTTP2</a> = 2</div>
<div class="line"><span class="lineno"> 2469</span>};</div>
<div class="ttc" id="acivetweb_8c_html_adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78"><div class="ttname"><a href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a></div><div class="ttdeci">@ PROTOCOL_TYPE_HTTP1</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02466">civetweb.c:2466</a></div></div>
<div class="ttc" id="acivetweb_8c_html_adc29c2ff13d900c2f185ee95427fb06ca3c3663fdf461dc9873cadc4a36b3a139"><div class="ttname"><a href="#adc29c2ff13d900c2f185ee95427fb06ca3c3663fdf461dc9873cadc4a36b3a139">PROTOCOL_TYPE_HTTP2</a></div><div class="ttdeci">@ PROTOCOL_TYPE_HTTP2</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02469">civetweb.c:2468</a></div></div>
<div class="ttc" id="acivetweb_8c_html_adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436"><div class="ttname"><a href="#adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436">PROTOCOL_TYPE_WEBSOCKET</a></div><div class="ttdeci">@ PROTOCOL_TYPE_WEBSOCKET</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02467">civetweb.c:2467</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a2dd9b83e27accc1b564a11b3ff531c9d" name="a2dd9b83e27accc1b564a11b3ff531c9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dd9b83e27accc1b564a11b3ff531c9d">&#9670;&#160;</a></span>abort_cgi_process()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int abort_cgi_process </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>data</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l11552">11552</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">11553</span>{</div>
<div class="line"><span class="lineno">11554</span>    <span class="comment">/* Waitpid checks for child status and won&#39;t work for a pid that does</span></div>
<div class="line"><span class="lineno">11555</span><span class="comment">     * not identify a child of the current process. Thus, if the pid is</span></div>
<div class="line"><span class="lineno">11556</span><span class="comment">     * reused, we will not affect a different process. */</span></div>
<div class="line"><span class="lineno">11557</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structprocess__control__data.html">process_control_data</a> *proc = (<span class="keyword">struct </span><a class="code hl_struct" href="structprocess__control__data.html">process_control_data</a> *)data;</div>
<div class="line"><span class="lineno">11558</span>    <span class="keywordtype">int</span> status = 0;</div>
<div class="line"><span class="lineno">11559</span>    ptrdiff_t refs;</div>
<div class="line"><span class="lineno">11560</span>    pid_t ret_pid;</div>
<div class="line"><span class="lineno">11561</span> </div>
<div class="line"><span class="lineno">11562</span>    ret_pid = waitpid(proc-&gt;<a class="code hl_variable" href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">pid</a>, &amp;status, WNOHANG);</div>
<div class="line"><span class="lineno">11563</span>    <span class="keywordflow">if</span> ((ret_pid != (pid_t)-1) &amp;&amp; (status == 0)) {</div>
<div class="line"><span class="lineno">11564</span>        <span class="comment">/* Stop child process */</span></div>
<div class="line"><span class="lineno">11565</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;CGI timer: Stop child process %d\n&quot;</span>, proc-&gt;<a class="code hl_variable" href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">pid</a>);</div>
<div class="line"><span class="lineno">11566</span>        kill(proc-&gt;<a class="code hl_variable" href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">pid</a>, SIGABRT);</div>
<div class="line"><span class="lineno">11567</span> </div>
<div class="line"><span class="lineno">11568</span>        <span class="comment">/* Wait until process is terminated (don&#39;t leave zombies) */</span></div>
<div class="line"><span class="lineno">11569</span>        <span class="keywordflow">while</span> (waitpid(proc-&gt;<a class="code hl_variable" href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">pid</a>, &amp;status, 0) != (pid_t)-1) <span class="comment">/* nop */</span></div>
<div class="line"><span class="lineno">11570</span>            ;</div>
<div class="line"><span class="lineno">11571</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11572</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;CGI timer: Child process %d already stopped\n&quot;</span>, proc-&gt;<a class="code hl_variable" href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">pid</a>);</div>
<div class="line"><span class="lineno">11573</span>    }</div>
<div class="line"><span class="lineno">11574</span>    <span class="comment">/* Dec reference counter */</span></div>
<div class="line"><span class="lineno">11575</span>    refs = <a class="code hl_function" href="#a68810f97aa216df1fa96103dec93fca3">mg_atomic_dec</a>(&amp;proc-&gt;<a class="code hl_variable" href="structprocess__control__data.html#ad70b3fc1e856b7a6f32f32a89a80afba">references</a>);</div>
<div class="line"><span class="lineno">11576</span>    <span class="keywordflow">if</span> (refs == 0) {</div>
<div class="line"><span class="lineno">11577</span>        <span class="comment">/* no more references - free data */</span></div>
<div class="line"><span class="lineno">11578</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(data);</div>
<div class="line"><span class="lineno">11579</span>    }</div>
<div class="line"><span class="lineno">11580</span> </div>
<div class="line"><span class="lineno">11581</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">11582</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a68810f97aa216df1fa96103dec93fca3"><div class="ttname"><a href="#a68810f97aa216df1fa96103dec93fca3">mg_atomic_dec</a></div><div class="ttdeci">static FUNCTION_MAY_BE_UNUSED ptrdiff_t mg_atomic_dec(volatile ptrdiff_t *addr)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01144">civetweb.c:1144</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a98f6ecefbf7613a2478356d30af16020"><div class="ttname"><a href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a></div><div class="ttdeci">#define DEBUG_TRACE(fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00242">civetweb.c:242</a></div></div>
<div class="ttc" id="acivetweb_8c_html_adc85e6b6e1bec856e91dc0346f49d9da"><div class="ttname"><a href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a></div><div class="ttdeci">static __inline void mg_free(void *a)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01492">civetweb.c:1492</a></div></div>
<div class="ttc" id="astructprocess__control__data_html"><div class="ttname"><a href="structprocess__control__data.html">process_control_data</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11546">civetweb.c:11546</a></div></div>
<div class="ttc" id="astructprocess__control__data_html_ad70b3fc1e856b7a6f32f32a89a80afba"><div class="ttname"><a href="structprocess__control__data.html#ad70b3fc1e856b7a6f32f32a89a80afba">process_control_data::references</a></div><div class="ttdeci">ptrdiff_t references</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11548">civetweb.c:11548</a></div></div>
<div class="ttc" id="astructprocess__control__data_html_ae0c6a0b659acce358e0c3bfb528c59c4"><div class="ttname"><a href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">process_control_data::pid</a></div><div class="ttdeci">pid_t pid</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11547">civetweb.c:11547</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l01144">mg_atomic_dec()</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l11547">process_control_data::pid</a>, and <a class="el" href="civetweb_8c_source.html#l11548">process_control_data::references</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>.</p>

</div>
</div>
<a id="a5231c9ac67e436368ba0fd12a7406701" name="a5231c9ac67e436368ba0fd12a7406701"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5231c9ac67e436368ba0fd12a7406701">&#9670;&#160;</a></span>accept_new_connection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void accept_new_connection </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structsocket.html">socket</a> *</td>          <td class="paramname"><span class="paramname"><em>listener</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19957">19957</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19958</span>{</div>
<div class="line"><span class="lineno">19959</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structsocket.html">socket</a> so;</div>
<div class="line"><span class="lineno">19960</span>    <span class="keywordtype">char</span> src_addr[<a class="code hl_define" href="#a0563a85b179703339cbf223e7e1c0454">IP_ADDR_STR_LEN</a>];</div>
<div class="line"><span class="lineno">19961</span>    socklen_t len = <span class="keyword">sizeof</span>(so.rsa);</div>
<div class="line"><span class="lineno">19962</span><span class="preprocessor">#if !defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno">19963</span>    <span class="keywordtype">int</span> on = 1;</div>
<div class="line"><span class="lineno">19964</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19965</span>    memset(&amp;so, 0, <span class="keyword">sizeof</span>(so));</div>
<div class="line"><span class="lineno">19966</span> </div>
<div class="line"><span class="lineno">19967</span>    <span class="keywordflow">if</span> ((so.sock = accept(listener-&gt;<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>, &amp;so.rsa.sa, &amp;len))</div>
<div class="line"><span class="lineno">19968</span>        == <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>) {</div>
<div class="line"><span class="lineno">19969</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="#a413ce152f72e5e12647a950de90d589f">check_acl</a>(ctx, &amp;so.rsa) != 1) {</div>
<div class="line"><span class="lineno">19970</span>        <a class="code hl_function" href="#a043f416da5d5ec0b9a0f39e7a34250c2">sockaddr_to_string</a>(src_addr, <span class="keyword">sizeof</span>(src_addr), &amp;so.rsa);</div>
<div class="line"><span class="lineno">19971</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">19972</span>                            <span class="stringliteral">&quot;%s: %s is not allowed to connect&quot;</span>,</div>
<div class="line"><span class="lineno">19973</span>                            __func__,</div>
<div class="line"><span class="lineno">19974</span>                            src_addr);</div>
<div class="line"><span class="lineno">19975</span>        <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">19976</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19977</span>        <span class="comment">/* Put so socket structure into the queue */</span></div>
<div class="line"><span class="lineno">19978</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Accepted socket %d&quot;</span>, (<span class="keywordtype">int</span>)so.sock);</div>
<div class="line"><span class="lineno">19979</span>        <a class="code hl_function" href="#aea8c64184a00214c2f457d5e30f89478">set_close_on_exec</a>(so.sock, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ctx);</div>
<div class="line"><span class="lineno">19980</span>        so.is_ssl = listener-&gt;<a class="code hl_variable" href="structsocket.html#a2d1d5b8ef7da25d5e7e666e023a9b733">is_ssl</a>;</div>
<div class="line"><span class="lineno">19981</span>        so.ssl_redir = listener-&gt;<a class="code hl_variable" href="structsocket.html#ab6adc40d94d436862c00b586f1455f5c">ssl_redir</a>;</div>
<div class="line"><span class="lineno">19982</span>        <span class="keywordflow">if</span> (getsockname(so.sock, &amp;so.lsa.sa, &amp;len) != 0) {</div>
<div class="line"><span class="lineno">19983</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">19984</span>                                <span class="stringliteral">&quot;%s: getsockname() failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno">19985</span>                                __func__,</div>
<div class="line"><span class="lineno">19986</span>                                strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">19987</span>        }</div>
<div class="line"><span class="lineno">19988</span> </div>
<div class="line"><span class="lineno">19989</span><span class="preprocessor">#if !defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno">19990</span>        <span class="keywordflow">if</span> ((so.lsa.sa.sa_family == AF_INET)</div>
<div class="line"><span class="lineno">19991</span>            || (so.lsa.sa.sa_family == AF_INET6)) {</div>
<div class="line"><span class="lineno">19992</span>            <span class="comment">/* Set TCP keep-alive for TCP sockets (IPv4 and IPv6).</span></div>
<div class="line"><span class="lineno">19993</span><span class="comment">             * This is needed because if HTTP-level keep-alive</span></div>
<div class="line"><span class="lineno">19994</span><span class="comment">             * is enabled, and client resets the connection, server won&#39;t get</span></div>
<div class="line"><span class="lineno">19995</span><span class="comment">             * TCP FIN or RST and will keep the connection open forever. With</span></div>
<div class="line"><span class="lineno">19996</span><span class="comment">             * TCP keep-alive, next keep-alive handshake will figure out that</span></div>
<div class="line"><span class="lineno">19997</span><span class="comment">             * the client is down and will close the server end.</span></div>
<div class="line"><span class="lineno">19998</span><span class="comment">             * Thanks to Igor Klopov who suggested the patch. */</span></div>
<div class="line"><span class="lineno">19999</span>            <span class="keywordflow">if</span> (setsockopt(so.sock,</div>
<div class="line"><span class="lineno">20000</span>                           SOL_SOCKET,</div>
<div class="line"><span class="lineno">20001</span>                           SO_KEEPALIVE,</div>
<div class="line"><span class="lineno">20002</span>                           (<a class="code hl_typedef" href="#a1bbb7024f8dda275a22cdc1df0527224">SOCK_OPT_TYPE</a>)&amp;on,</div>
<div class="line"><span class="lineno">20003</span>                           <span class="keyword">sizeof</span>(on))</div>
<div class="line"><span class="lineno">20004</span>                != 0) {</div>
<div class="line"><span class="lineno">20005</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(</div>
<div class="line"><span class="lineno">20006</span>                    ctx,</div>
<div class="line"><span class="lineno">20007</span>                    <span class="stringliteral">&quot;%s: setsockopt(SOL_SOCKET SO_KEEPALIVE) failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20008</span>                    __func__,</div>
<div class="line"><span class="lineno">20009</span>                    strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">20010</span>            }</div>
<div class="line"><span class="lineno">20011</span>        }</div>
<div class="line"><span class="lineno">20012</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20013</span> </div>
<div class="line"><span class="lineno">20014</span>        <span class="comment">/* Disable TCP Nagle&#39;s algorithm. Normally TCP packets are coalesced</span></div>
<div class="line"><span class="lineno">20015</span><span class="comment">         * to effectively fill up the underlying IP packet payload and</span></div>
<div class="line"><span class="lineno">20016</span><span class="comment">         * reduce the overhead of sending lots of small buffers. However</span></div>
<div class="line"><span class="lineno">20017</span><span class="comment">         * this hurts the server&#39;s throughput (ie. operations per second)</span></div>
<div class="line"><span class="lineno">20018</span><span class="comment">         * when HTTP 1.1 persistent connections are used and the responses</span></div>
<div class="line"><span class="lineno">20019</span><span class="comment">         * are relatively small (eg. less than 1400 bytes).</span></div>
<div class="line"><span class="lineno">20020</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">20021</span>        <span class="keywordflow">if</span> ((ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bae7af9fa992c8547645bac2ca940153b0">CONFIG_TCP_NODELAY</a>] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">20022</span>            &amp;&amp; (!strcmp(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bae7af9fa992c8547645bac2ca940153b0">CONFIG_TCP_NODELAY</a>], <span class="stringliteral">&quot;1&quot;</span>))) {</div>
<div class="line"><span class="lineno">20023</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#a7003e9382b3b817de6ae349d754e2077">set_tcp_nodelay</a>(&amp;so, 1) != 0) {</div>
<div class="line"><span class="lineno">20024</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(</div>
<div class="line"><span class="lineno">20025</span>                    ctx,</div>
<div class="line"><span class="lineno">20026</span>                    <span class="stringliteral">&quot;%s: setsockopt(IPPROTO_TCP TCP_NODELAY) failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20027</span>                    __func__,</div>
<div class="line"><span class="lineno">20028</span>                    strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">20029</span>            }</div>
<div class="line"><span class="lineno">20030</span>        }</div>
<div class="line"><span class="lineno">20031</span> </div>
<div class="line"><span class="lineno">20032</span>        <span class="comment">/* The &quot;non blocking&quot; property should already be</span></div>
<div class="line"><span class="lineno">20033</span><span class="comment">         * inherited from the parent socket. Set it for</span></div>
<div class="line"><span class="lineno">20034</span><span class="comment">         * non-compliant socket implementations. */</span></div>
<div class="line"><span class="lineno">20035</span>        <a class="code hl_function" href="#a145cf727fe064c50f8101a6650495a61">set_non_blocking_mode</a>(so.sock);</div>
<div class="line"><span class="lineno">20036</span> </div>
<div class="line"><span class="lineno">20037</span>        so.in_use = 0;</div>
<div class="line"><span class="lineno">20038</span>        <a class="code hl_function" href="#abe51474dc2a44ce44de63053a1581ae8">produce_socket</a>(ctx, &amp;so);</div>
<div class="line"><span class="lineno">20039</span>    }</div>
<div class="line"><span class="lineno">20040</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a043f416da5d5ec0b9a0f39e7a34250c2"><div class="ttname"><a href="#a043f416da5d5ec0b9a0f39e7a34250c2">sockaddr_to_string</a></div><div class="ttdeci">static void sockaddr_to_string(char *buf, size_t len, const union usa *usa)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03292">civetweb.c:3292</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a0563a85b179703339cbf223e7e1c0454"><div class="ttname"><a href="#a0563a85b179703339cbf223e7e1c0454">IP_ADDR_STR_LEN</a></div><div class="ttdeci">#define IP_ADDR_STR_LEN</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01732">civetweb.c:1732</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a145cf727fe064c50f8101a6650495a61"><div class="ttname"><a href="#a145cf727fe064c50f8101a6650495a61">set_non_blocking_mode</a></div><div class="ttdeci">static int set_non_blocking_mode(SOCKET sock)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l05876">civetweb.c:5876</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a1bbb7024f8dda275a22cdc1df0527224"><div class="ttname"><a href="#a1bbb7024f8dda275a22cdc1df0527224">SOCK_OPT_TYPE</a></div><div class="ttdeci">const void * SOCK_OPT_TYPE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00863">civetweb.c:863</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a1ddc04f3556f50ae9cf6ec670c441c4b"><div class="ttname"><a href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a></div><div class="ttdeci">#define mg_cry_ctx_internal(ctx, fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02586">civetweb.c:2586</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a26769957ec1a2beaf223f33b66ee64ab"><div class="ttname"><a href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="ttdeci">#define INVALID_SOCKET</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00925">civetweb.c:925</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a3a830e27de72e8bab8bc80eafebd657e"><div class="ttname"><a href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a></div><div class="ttdeci">#define ERRNO</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00924">civetweb.c:924</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a3d96b607aca31a2236372e56ffb72112"><div class="ttname"><a href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a></div><div class="ttdeci">#define closesocket(a)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00917">civetweb.c:917</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a413ce152f72e5e12647a950de90d589f"><div class="ttname"><a href="#a413ce152f72e5e12647a950de90d589f">check_acl</a></div><div class="ttdeci">static int check_acl(struct mg_context *phys_ctx, const union usa *sa)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16229">civetweb.c:16229</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a7003e9382b3b817de6ae349d754e2077"><div class="ttname"><a href="#a7003e9382b3b817de6ae349d754e2077">set_tcp_nodelay</a></div><div class="ttdeci">static int set_tcp_nodelay(const struct socket *so, int nodelay_on)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17718">civetweb.c:17718</a></div></div>
<div class="ttc" id="acivetweb_8c_html_abe51474dc2a44ce44de63053a1581ae8"><div class="ttname"><a href="#abe51474dc2a44ce44de63053a1581ae8">produce_socket</a></div><div class="ttdeci">static void produce_socket(struct mg_context *ctx, const struct socket *sp)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l19661">civetweb.c:19661</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aea8c64184a00214c2f457d5e30f89478"><div class="ttname"><a href="#aea8c64184a00214c2f457d5e30f89478">set_close_on_exec</a></div><div class="ttdeci">static void set_close_on_exec(int fd, const struct mg_connection *conn, struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l05677">civetweb.c:5677</a></div></div>
<div class="ttc" id="astructmg__context_html_aa9f0218a15ae4f5f01985f2531660e4c"><div class="ttname"><a href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">mg_context::dd</a></div><div class="ttdeci">struct mg_domain_context dd</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02442">civetweb.c:2442</a></div></div>
<div class="ttc" id="astructmg__domain__context_html_a194a908b0cdd99ddce54c993363c85e5"><div class="ttname"><a href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">mg_domain_context::config</a></div><div class="ttdeci">char * config[NUM_OPTIONS]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02271">civetweb.c:2271</a></div></div>
<div class="ttc" id="astructsocket_html"><div class="ttname"><a href="structsocket.html">socket</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01902">civetweb.c:1902</a></div></div>
<div class="ttc" id="astructsocket_html_a2d1d5b8ef7da25d5e7e666e023a9b733"><div class="ttname"><a href="structsocket.html#a2d1d5b8ef7da25d5e7e666e023a9b733">socket::is_ssl</a></div><div class="ttdeci">unsigned char is_ssl</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01906">civetweb.c:1906</a></div></div>
<div class="ttc" id="astructsocket_html_ab6adc40d94d436862c00b586f1455f5c"><div class="ttname"><a href="structsocket.html#ab6adc40d94d436862c00b586f1455f5c">socket::ssl_redir</a></div><div class="ttdeci">unsigned char ssl_redir</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01907">civetweb.c:1907</a></div></div>
<div class="ttc" id="astructsocket_html_ace41176c1363c25e08837812c18d22dd"><div class="ttname"><a href="structsocket.html#ace41176c1363c25e08837812c18d22dd">socket::sock</a></div><div class="ttdeci">SOCKET sock</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01903">civetweb.c:1903</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l16229">check_acl()</a>, <a class="el" href="civetweb_8c_source.html#l00917">closesocket</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l01923">CONFIG_TCP_NODELAY</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l01909">socket::in_use</a>, <a class="el" href="civetweb_8c_source.html#l00925">INVALID_SOCKET</a>, <a class="el" href="civetweb_8c_source.html#l01732">IP_ADDR_STR_LEN</a>, <a class="el" href="civetweb_8c_source.html#l01906">socket::is_ssl</a>, <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l19661">produce_socket()</a>, <a class="el" href="civetweb_8c_source.html#l01905">socket::rsa</a>, <a class="el" href="civetweb_8c_source.html#l01833">usa::sa</a>, <a class="el" href="civetweb_8c_source.html#l05677">set_close_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l05876">set_non_blocking_mode()</a>, <a class="el" href="civetweb_8c_source.html#l17718">set_tcp_nodelay()</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, <a class="el" href="civetweb_8c_source.html#l03292">sockaddr_to_string()</a>, and <a class="el" href="civetweb_8c_source.html#l01907">socket::ssl_redir</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>.</p>

</div>
</div>
<a id="a92b6545dc8a1d416fc5dd4cb152785c6" name="a92b6545dc8a1d416fc5dd4cb152785c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92b6545dc8a1d416fc5dd4cb152785c6">&#9670;&#160;</a></span>addenv() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void static void addenv </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcgi__environment.html">cgi_environment</a> *</td>          <td class="paramname"><span class="paramname"><em>env</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l11284">11284</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">11285</span>{</div>
<div class="line"><span class="lineno">11286</span>    <span class="keywordtype">size_t</span> i, n, space;</div>
<div class="line"><span class="lineno">11287</span>    <span class="keywordtype">int</span> truncated = 0;</div>
<div class="line"><span class="lineno">11288</span>    <span class="keywordtype">char</span> *added;</div>
<div class="line"><span class="lineno">11289</span>    va_list ap;</div>
<div class="line"><span class="lineno">11290</span> </div>
<div class="line"><span class="lineno">11291</span>    <span class="keywordflow">if</span> ((env-&gt;<a class="code hl_variable" href="structcgi__environment.html#ad3724e579f49ba25d08ee2fdfba31053">varlen</a> - env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a968130be6483eed2654a5d8822d0c898">varused</a>) &lt; 2) {</div>
<div class="line"><span class="lineno">11292</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(env-&gt;<a class="code hl_variable" href="structcgi__environment.html#ab989e492646d577c5a56590a6e3c9649">conn</a>,</div>
<div class="line"><span class="lineno">11293</span>                        <span class="stringliteral">&quot;%s: Cannot register CGI variable [%s]&quot;</span>,</div>
<div class="line"><span class="lineno">11294</span>                        __func__,</div>
<div class="line"><span class="lineno">11295</span>                        fmt);</div>
<div class="line"><span class="lineno">11296</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">11297</span>    }</div>
<div class="line"><span class="lineno">11298</span> </div>
<div class="line"><span class="lineno">11299</span>    <span class="comment">/* Calculate how much space is left in the buffer */</span></div>
<div class="line"><span class="lineno">11300</span>    space = (env-&gt;<a class="code hl_variable" href="structcgi__environment.html#abf1a007fd15b6e6d7092202839292f9d">buflen</a> - env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a54049366dbc26ddd8db927f66b0d9118">bufused</a>);</div>
<div class="line"><span class="lineno">11301</span> </div>
<div class="line"><span class="lineno">11302</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">11303</span>        <span class="comment">/* Space for &quot;\0\0&quot; is always needed. */</span></div>
<div class="line"><span class="lineno">11304</span>        <span class="keywordflow">if</span> (space &lt;= 2) {</div>
<div class="line"><span class="lineno">11305</span>            <span class="comment">/* Allocate new buffer */</span></div>
<div class="line"><span class="lineno">11306</span>            n = env-&gt;<a class="code hl_variable" href="structcgi__environment.html#abf1a007fd15b6e6d7092202839292f9d">buflen</a> + <a class="code hl_define" href="#a53644ae929eff6501de3e13fb3bd2946">CGI_ENVIRONMENT_SIZE</a>;</div>
<div class="line"><span class="lineno">11307</span>            added = (<span class="keywordtype">char</span> *)<a class="code hl_define" href="#ab36230fc0a06484369ac2dc5331260f4">mg_realloc_ctx</a>(env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a19c455bdfd00e18939fa3ce987a54eb8">buf</a>, n, env-&gt;<a class="code hl_variable" href="structcgi__environment.html#ab989e492646d577c5a56590a6e3c9649">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">11308</span>            <span class="keywordflow">if</span> (!added) {</div>
<div class="line"><span class="lineno">11309</span>                <span class="comment">/* Out of memory */</span></div>
<div class="line"><span class="lineno">11310</span>                <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(</div>
<div class="line"><span class="lineno">11311</span>                    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#ab989e492646d577c5a56590a6e3c9649">conn</a>,</div>
<div class="line"><span class="lineno">11312</span>                    <span class="stringliteral">&quot;%s: Cannot allocate memory for CGI variable [%s]&quot;</span>,</div>
<div class="line"><span class="lineno">11313</span>                    __func__,</div>
<div class="line"><span class="lineno">11314</span>                    fmt);</div>
<div class="line"><span class="lineno">11315</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">11316</span>            }</div>
<div class="line"><span class="lineno">11317</span>            <span class="comment">/* Retarget pointers */</span></div>
<div class="line"><span class="lineno">11318</span>            env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a19c455bdfd00e18939fa3ce987a54eb8">buf</a> = added;</div>
<div class="line"><span class="lineno">11319</span>            env-&gt;<a class="code hl_variable" href="structcgi__environment.html#abf1a007fd15b6e6d7092202839292f9d">buflen</a> = n;</div>
<div class="line"><span class="lineno">11320</span>            <span class="keywordflow">for</span> (i = 0, n = 0; i &lt; env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a968130be6483eed2654a5d8822d0c898">varused</a>; i++) {</div>
<div class="line"><span class="lineno">11321</span>                env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a4db192a38f1b3687d0e891005c01f41d">var</a>[i] = added + n;</div>
<div class="line"><span class="lineno">11322</span>                n += strlen(added + n) + 1;</div>
<div class="line"><span class="lineno">11323</span>            }</div>
<div class="line"><span class="lineno">11324</span>            space = (env-&gt;<a class="code hl_variable" href="structcgi__environment.html#abf1a007fd15b6e6d7092202839292f9d">buflen</a> - env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a54049366dbc26ddd8db927f66b0d9118">bufused</a>);</div>
<div class="line"><span class="lineno">11325</span>        }</div>
<div class="line"><span class="lineno">11326</span> </div>
<div class="line"><span class="lineno">11327</span>        <span class="comment">/* Make a pointer to the free space int the buffer */</span></div>
<div class="line"><span class="lineno">11328</span>        added = env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a19c455bdfd00e18939fa3ce987a54eb8">buf</a> + env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a54049366dbc26ddd8db927f66b0d9118">bufused</a>;</div>
<div class="line"><span class="lineno">11329</span> </div>
<div class="line"><span class="lineno">11330</span>        <span class="comment">/* Copy VARIABLE=VALUE\0 string into the free space */</span></div>
<div class="line"><span class="lineno">11331</span>        va_start(ap, fmt);</div>
<div class="line"><span class="lineno">11332</span>        <a class="code hl_function" href="#aca9e6d65ed7802c47e4e3ef6413d8c39">mg_vsnprintf</a>(env-&gt;<a class="code hl_variable" href="structcgi__environment.html#ab989e492646d577c5a56590a6e3c9649">conn</a>, &amp;truncated, added, space - 1, fmt, ap);</div>
<div class="line"><span class="lineno">11333</span>        va_end(ap);</div>
<div class="line"><span class="lineno">11334</span> </div>
<div class="line"><span class="lineno">11335</span>        <span class="comment">/* Do not add truncated strings to the environment */</span></div>
<div class="line"><span class="lineno">11336</span>        <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno">11337</span>            <span class="comment">/* Reallocate the buffer */</span></div>
<div class="line"><span class="lineno">11338</span>            space = 0;</div>
<div class="line"><span class="lineno">11339</span>        }</div>
<div class="line"><span class="lineno">11340</span>    } <span class="keywordflow">while</span> (truncated);</div>
<div class="line"><span class="lineno">11341</span> </div>
<div class="line"><span class="lineno">11342</span>    <span class="comment">/* Calculate number of bytes added to the environment */</span></div>
<div class="line"><span class="lineno">11343</span>    n = strlen(added) + 1;</div>
<div class="line"><span class="lineno">11344</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a54049366dbc26ddd8db927f66b0d9118">bufused</a> += n;</div>
<div class="line"><span class="lineno">11345</span> </div>
<div class="line"><span class="lineno">11346</span>    <span class="comment">/* Append a pointer to the added string into the envp array */</span></div>
<div class="line"><span class="lineno">11347</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a4db192a38f1b3687d0e891005c01f41d">var</a>[env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a968130be6483eed2654a5d8822d0c898">varused</a>] = added;</div>
<div class="line"><span class="lineno">11348</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a968130be6483eed2654a5d8822d0c898">varused</a>++;</div>
<div class="line"><span class="lineno">11349</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a53644ae929eff6501de3e13fb3bd2946"><div class="ttname"><a href="#a53644ae929eff6501de3e13fb3bd2946">CGI_ENVIRONMENT_SIZE</a></div><div class="ttdeci">#define CGI_ENVIRONMENT_SIZE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00488">civetweb.c:488</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a9c82560e32fee25bd5f05767a625fa77"><div class="ttname"><a href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a></div><div class="ttdeci">#define mg_cry_internal(conn, fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02583">civetweb.c:2583</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ab36230fc0a06484369ac2dc5331260f4"><div class="ttname"><a href="#ab36230fc0a06484369ac2dc5331260f4">mg_realloc_ctx</a></div><div class="ttdeci">#define mg_realloc_ctx(a, b, c)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01499">civetweb.c:1499</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aca9e6d65ed7802c47e4e3ef6413d8c39"><div class="ttname"><a href="#aca9e6d65ed7802c47e4e3ef6413d8c39">mg_vsnprintf</a></div><div class="ttdeci">static void mg_vsnprintf(const struct mg_connection *conn, int *truncated, char *buf, size_t buflen, const char *fmt, va_list ap)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03094">civetweb.c:3094</a></div></div>
<div class="ttc" id="astructcgi__environment_html_a19c455bdfd00e18939fa3ce987a54eb8"><div class="ttname"><a href="structcgi__environment.html#a19c455bdfd00e18939fa3ce987a54eb8">cgi_environment::buf</a></div><div class="ttdeci">char * buf</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11267">civetweb.c:11267</a></div></div>
<div class="ttc" id="astructcgi__environment_html_a4db192a38f1b3687d0e891005c01f41d"><div class="ttname"><a href="structcgi__environment.html#a4db192a38f1b3687d0e891005c01f41d">cgi_environment::var</a></div><div class="ttdeci">char ** var</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11271">civetweb.c:11271</a></div></div>
<div class="ttc" id="astructcgi__environment_html_a54049366dbc26ddd8db927f66b0d9118"><div class="ttname"><a href="structcgi__environment.html#a54049366dbc26ddd8db927f66b0d9118">cgi_environment::bufused</a></div><div class="ttdeci">size_t bufused</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11269">civetweb.c:11269</a></div></div>
<div class="ttc" id="astructcgi__environment_html_a968130be6483eed2654a5d8822d0c898"><div class="ttname"><a href="structcgi__environment.html#a968130be6483eed2654a5d8822d0c898">cgi_environment::varused</a></div><div class="ttdeci">size_t varused</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11273">civetweb.c:11273</a></div></div>
<div class="ttc" id="astructcgi__environment_html_ab989e492646d577c5a56590a6e3c9649"><div class="ttname"><a href="structcgi__environment.html#ab989e492646d577c5a56590a6e3c9649">cgi_environment::conn</a></div><div class="ttdeci">struct mg_connection * conn</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11265">civetweb.c:11265</a></div></div>
<div class="ttc" id="astructcgi__environment_html_abf1a007fd15b6e6d7092202839292f9d"><div class="ttname"><a href="structcgi__environment.html#abf1a007fd15b6e6d7092202839292f9d">cgi_environment::buflen</a></div><div class="ttdeci">size_t buflen</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11268">civetweb.c:11268</a></div></div>
<div class="ttc" id="astructcgi__environment_html_ad3724e579f49ba25d08ee2fdfba31053"><div class="ttname"><a href="structcgi__environment.html#ad3724e579f49ba25d08ee2fdfba31053">cgi_environment::varlen</a></div><div class="ttdeci">size_t varlen</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11272">civetweb.c:11272</a></div></div>
<div class="ttc" id="astructmg__connection_html_aba76ab7aef56551015fe468e8fc306c1"><div class="ttname"><a href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">mg_connection::phys_ctx</a></div><div class="ttdeci">struct mg_context * phys_ctx</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02497">civetweb.c:2497</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00488">CGI_ENVIRONMENT_SIZE</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l01499">mg_realloc_ctx</a>, and <a class="el" href="civetweb_8c_source.html#l03094">mg_vsnprintf()</a>.</p>

</div>
</div>
<a id="a4e93852e401067c198aca347441cb1a2" name="a4e93852e401067c198aca347441cb1a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e93852e401067c198aca347441cb1a2">&#9670;&#160;</a></span>addenv() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void addenv </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcgi__environment.html">cgi_environment</a> *</td>          <td class="paramname"><span class="paramname"><em>env</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a2bb9db6ffe087ec4f44662ed3dfa0abd">PRINTF_FORMAT_STRING</a>(const char *fmt)</td>          <td class="paramname"><span class="paramname">, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>.</p>

</div>
</div>
<a id="a3367d3437bb9177f66f9b491f1ea60e1" name="a3367d3437bb9177f66f9b491f1ea60e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3367d3437bb9177f66f9b491f1ea60e1">&#9670;&#160;</a></span>alloc_printf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int alloc_printf </td>
          <td>(</td>
          <td class="paramtype">char **</td>          <td class="paramname"><span class="paramname"><em>out_buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06996">6996</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6997</span>{</div>
<div class="line"><span class="lineno"> 6998</span>    va_list ap;</div>
<div class="line"><span class="lineno"> 6999</span>    <span class="keywordtype">int</span> result;</div>
<div class="line"><span class="lineno"> 7000</span> </div>
<div class="line"><span class="lineno"> 7001</span>    va_start(ap, fmt);</div>
<div class="line"><span class="lineno"> 7002</span>    result = <a class="code hl_function" href="#a8cfa7a42c911923d382305f16bd57314">alloc_vprintf</a>(out_buf, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, fmt, ap);</div>
<div class="line"><span class="lineno"> 7003</span>    va_end(ap);</div>
<div class="line"><span class="lineno"> 7004</span> </div>
<div class="line"><span class="lineno"> 7005</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno"> 7006</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a8cfa7a42c911923d382305f16bd57314"><div class="ttname"><a href="#a8cfa7a42c911923d382305f16bd57314">alloc_vprintf</a></div><div class="ttdeci">static int alloc_vprintf(char **out_buf, char *prealloc_buf, size_t prealloc_size, const char *fmt, va_list ap)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06939">civetweb.c:6939</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l06939">alloc_vprintf()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

</div>
</div>
<a id="a8cfa7a42c911923d382305f16bd57314" name="a8cfa7a42c911923d382305f16bd57314"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cfa7a42c911923d382305f16bd57314">&#9670;&#160;</a></span>alloc_vprintf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int alloc_vprintf </td>
          <td>(</td>
          <td class="paramtype">char **</td>          <td class="paramname"><span class="paramname"><em>out_buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>prealloc_buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>prealloc_size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list</td>          <td class="paramname"><span class="paramname"><em>ap</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06939">6939</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6944</span>{</div>
<div class="line"><span class="lineno"> 6945</span>    va_list ap_copy;</div>
<div class="line"><span class="lineno"> 6946</span>    <span class="keywordtype">int</span> len;</div>
<div class="line"><span class="lineno"> 6947</span> </div>
<div class="line"><span class="lineno"> 6948</span>    <span class="comment">/* Windows is not standard-compliant, and vsnprintf() returns -1 if</span></div>
<div class="line"><span class="lineno"> 6949</span><span class="comment">     * buffer is too small. Also, older versions of msvcrt.dll do not have</span></div>
<div class="line"><span class="lineno"> 6950</span><span class="comment">     * _vscprintf().  However, if size is 0, vsnprintf() behaves correctly.</span></div>
<div class="line"><span class="lineno"> 6951</span><span class="comment">     * Therefore, we make two passes: on first pass, get required message</span></div>
<div class="line"><span class="lineno"> 6952</span><span class="comment">     * length.</span></div>
<div class="line"><span class="lineno"> 6953</span><span class="comment">     * On second pass, actually print the message. */</span></div>
<div class="line"><span class="lineno"> 6954</span>    <a class="code hl_define" href="#ad5936237ef8db6bc39470efaef9d151d">va_copy</a>(ap_copy, ap);</div>
<div class="line"><span class="lineno"> 6955</span>    len = <a class="code hl_define" href="#a095b3b42df21f6e5d4377e299da56a79">vsnprintf_impl</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, fmt, ap_copy);</div>
<div class="line"><span class="lineno"> 6956</span>    va_end(ap_copy);</div>
<div class="line"><span class="lineno"> 6957</span> </div>
<div class="line"><span class="lineno"> 6958</span>    <span class="keywordflow">if</span> (len &lt; 0) {</div>
<div class="line"><span class="lineno"> 6959</span>        <span class="comment">/* C runtime is not standard compliant, vsnprintf() returned -1.</span></div>
<div class="line"><span class="lineno"> 6960</span><span class="comment">         * Switch to alternative code path that uses incremental</span></div>
<div class="line"><span class="lineno"> 6961</span><span class="comment">         * allocations.</span></div>
<div class="line"><span class="lineno"> 6962</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 6963</span>        <a class="code hl_define" href="#ad5936237ef8db6bc39470efaef9d151d">va_copy</a>(ap_copy, ap);</div>
<div class="line"><span class="lineno"> 6964</span>        len = <a class="code hl_function" href="#ac2c0385a062d1e72128df82d20cd26e3">alloc_vprintf2</a>(out_buf, fmt, ap_copy);</div>
<div class="line"><span class="lineno"> 6965</span>        va_end(ap_copy);</div>
<div class="line"><span class="lineno"> 6966</span> </div>
<div class="line"><span class="lineno"> 6967</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)(len) &gt;= prealloc_size) {</div>
<div class="line"><span class="lineno"> 6968</span>        <span class="comment">/* The pre-allocated buffer not large enough. */</span></div>
<div class="line"><span class="lineno"> 6969</span>        <span class="comment">/* Allocate a new buffer. */</span></div>
<div class="line"><span class="lineno"> 6970</span>        *out_buf = (<span class="keywordtype">char</span> *)<a class="code hl_function" href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a>((<span class="keywordtype">size_t</span>)(len) + 1);</div>
<div class="line"><span class="lineno"> 6971</span>        <span class="keywordflow">if</span> (!*out_buf) {</div>
<div class="line"><span class="lineno"> 6972</span>            <span class="comment">/* Allocation failed. Return -1 as &quot;out of memory&quot; error. */</span></div>
<div class="line"><span class="lineno"> 6973</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6974</span>        }</div>
<div class="line"><span class="lineno"> 6975</span>        <span class="comment">/* Buffer allocation successful. Store the string there. */</span></div>
<div class="line"><span class="lineno"> 6976</span>        <a class="code hl_define" href="#ad5936237ef8db6bc39470efaef9d151d">va_copy</a>(ap_copy, ap);</div>
<div class="line"><span class="lineno"> 6977</span>        <a class="code hl_define" href="#ad78a7b8419e5ec9f2cc7d310fcf142d7">IGNORE_UNUSED_RESULT</a>(</div>
<div class="line"><span class="lineno"> 6978</span>            <a class="code hl_define" href="#a095b3b42df21f6e5d4377e299da56a79">vsnprintf_impl</a>(*out_buf, (<span class="keywordtype">size_t</span>)(len) + 1, fmt, ap_copy));</div>
<div class="line"><span class="lineno"> 6979</span>        va_end(ap_copy);</div>
<div class="line"><span class="lineno"> 6980</span> </div>
<div class="line"><span class="lineno"> 6981</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6982</span>        <span class="comment">/* The pre-allocated buffer is large enough.</span></div>
<div class="line"><span class="lineno"> 6983</span><span class="comment">         * Use it to store the string and return the address. */</span></div>
<div class="line"><span class="lineno"> 6984</span>        <a class="code hl_define" href="#ad5936237ef8db6bc39470efaef9d151d">va_copy</a>(ap_copy, ap);</div>
<div class="line"><span class="lineno"> 6985</span>        <a class="code hl_define" href="#ad78a7b8419e5ec9f2cc7d310fcf142d7">IGNORE_UNUSED_RESULT</a>(</div>
<div class="line"><span class="lineno"> 6986</span>            <a class="code hl_define" href="#a095b3b42df21f6e5d4377e299da56a79">vsnprintf_impl</a>(prealloc_buf, prealloc_size, fmt, ap_copy));</div>
<div class="line"><span class="lineno"> 6987</span>        va_end(ap_copy);</div>
<div class="line"><span class="lineno"> 6988</span>        *out_buf = prealloc_buf;</div>
<div class="line"><span class="lineno"> 6989</span>    }</div>
<div class="line"><span class="lineno"> 6990</span> </div>
<div class="line"><span class="lineno"> 6991</span>    <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno"> 6992</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a095b3b42df21f6e5d4377e299da56a79"><div class="ttname"><a href="#a095b3b42df21f6e5d4377e299da56a79">vsnprintf_impl</a></div><div class="ttdeci">#define vsnprintf_impl</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00897">civetweb.c:897</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a31c4ed6838b7bb49804a5ffa030762e5"><div class="ttname"><a href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a></div><div class="ttdeci">static __inline void * mg_malloc(size_t a)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01474">civetweb.c:1474</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac2c0385a062d1e72128df82d20cd26e3"><div class="ttname"><a href="#ac2c0385a062d1e72128df82d20cd26e3">alloc_vprintf2</a></div><div class="ttdeci">static int alloc_vprintf2(char **buf, const char *fmt, va_list ap)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06906">civetweb.c:6906</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad5936237ef8db6bc39470efaef9d151d"><div class="ttname"><a href="#ad5936237ef8db6bc39470efaef9d151d">va_copy</a></div><div class="ttdeci">#define va_copy(x, y)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01003">civetweb.c:1003</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad78a7b8419e5ec9f2cc7d310fcf142d7"><div class="ttname"><a href="#ad78a7b8419e5ec9f2cc7d310fcf142d7">IGNORE_UNUSED_RESULT</a></div><div class="ttdeci">#define IGNORE_UNUSED_RESULT(a)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00291">civetweb.c:291</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l06906">alloc_vprintf2()</a>, <a class="el" href="civetweb_8c_source.html#l00291">IGNORE_UNUSED_RESULT</a>, <a class="el" href="civetweb_8c_source.html#l01474">mg_malloc()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01003">va_copy</a>, and <a class="el" href="civetweb_8c_source.html#l00897">vsnprintf_impl</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06996">alloc_printf()</a>, and <a class="el" href="civetweb_8c_source.html#l07016">mg_vprintf()</a>.</p>

</div>
</div>
<a id="ac2c0385a062d1e72128df82d20cd26e3" name="ac2c0385a062d1e72128df82d20cd26e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2c0385a062d1e72128df82d20cd26e3">&#9670;&#160;</a></span>alloc_vprintf2()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int alloc_vprintf2 </td>
          <td>(</td>
          <td class="paramtype">char **</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list</td>          <td class="paramname"><span class="paramname"><em>ap</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06906">6906</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6907</span>{</div>
<div class="line"><span class="lineno"> 6908</span>    va_list ap_copy;</div>
<div class="line"><span class="lineno"> 6909</span>    <span class="keywordtype">size_t</span> size = <a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a> / 4;</div>
<div class="line"><span class="lineno"> 6910</span>    <span class="keywordtype">int</span> len = -1;</div>
<div class="line"><span class="lineno"> 6911</span> </div>
<div class="line"><span class="lineno"> 6912</span>    *buf = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 6913</span>    <span class="keywordflow">while</span> (len &lt; 0) {</div>
<div class="line"><span class="lineno"> 6914</span>        <span class="keywordflow">if</span> (*buf) {</div>
<div class="line"><span class="lineno"> 6915</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(*buf);</div>
<div class="line"><span class="lineno"> 6916</span>        }</div>
<div class="line"><span class="lineno"> 6917</span> </div>
<div class="line"><span class="lineno"> 6918</span>        size *= 4;</div>
<div class="line"><span class="lineno"> 6919</span>        *buf = (<span class="keywordtype">char</span> *)<a class="code hl_function" href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a>(size);</div>
<div class="line"><span class="lineno"> 6920</span>        <span class="keywordflow">if</span> (!*buf) {</div>
<div class="line"><span class="lineno"> 6921</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 6922</span>        }</div>
<div class="line"><span class="lineno"> 6923</span> </div>
<div class="line"><span class="lineno"> 6924</span>        <a class="code hl_define" href="#ad5936237ef8db6bc39470efaef9d151d">va_copy</a>(ap_copy, ap);</div>
<div class="line"><span class="lineno"> 6925</span>        len = <a class="code hl_define" href="#a095b3b42df21f6e5d4377e299da56a79">vsnprintf_impl</a>(*buf, size - 1, fmt, ap_copy);</div>
<div class="line"><span class="lineno"> 6926</span>        va_end(ap_copy);</div>
<div class="line"><span class="lineno"> 6927</span>        (*buf)[size - 1] = 0;</div>
<div class="line"><span class="lineno"> 6928</span>    }</div>
<div class="line"><span class="lineno"> 6929</span> </div>
<div class="line"><span class="lineno"> 6930</span>    <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno"> 6931</span>}</div>
<div class="ttc" id="acivetweb_8c_html_ac22a8a822b8728d8cd7e2718749f3ca4"><div class="ttname"><a href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a></div><div class="ttdeci">#define MG_BUF_LEN</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00498">civetweb.c:498</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01474">mg_malloc()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01003">va_copy</a>, and <a class="el" href="civetweb_8c_source.html#l00897">vsnprintf_impl</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06939">alloc_vprintf()</a>.</p>

</div>
</div>
<a id="abbf5e7625b9c8d60ffc4d84b02923943" name="abbf5e7625b9c8d60ffc4d84b02923943"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abbf5e7625b9c8d60ffc4d84b02923943">&#9670;&#160;</a></span>authorize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int authorize </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>realm</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08861">8861</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8862</span>{</div>
<div class="line"><span class="lineno"> 8863</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structread__auth__file__struct.html">read_auth_file_struct</a> workdata;</div>
<div class="line"><span class="lineno"> 8864</span>    <span class="keywordtype">char</span> <a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno"> 8865</span> </div>
<div class="line"><span class="lineno"> 8866</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a> || !<a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno"> 8867</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8868</span>    }</div>
<div class="line"><span class="lineno"> 8869</span> </div>
<div class="line"><span class="lineno"> 8870</span>    memset(&amp;workdata, 0, <span class="keyword">sizeof</span>(workdata));</div>
<div class="line"><span class="lineno"> 8871</span>    workdata.conn = <a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>;</div>
<div class="line"><span class="lineno"> 8872</span> </div>
<div class="line"><span class="lineno"> 8873</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#aa5a596736f518b04c383c91e7c9cc747">parse_auth_header</a>(<a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>, <a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>), &amp;workdata.ah)) {</div>
<div class="line"><span class="lineno"> 8874</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8875</span>    }</div>
<div class="line"><span class="lineno"> 8876</span> </div>
<div class="line"><span class="lineno"> 8877</span>    <span class="comment">/* CGI needs it as REMOTE_USER */</span></div>
<div class="line"><span class="lineno"> 8878</span>    <a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a> =</div>
<div class="line"><span class="lineno"> 8879</span>        <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(workdata.ah.user, <a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno"> 8880</span> </div>
<div class="line"><span class="lineno"> 8881</span>    <span class="keywordflow">if</span> (realm) {</div>
<div class="line"><span class="lineno"> 8882</span>        workdata.domain = realm;</div>
<div class="line"><span class="lineno"> 8883</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 8884</span>        workdata.domain = <a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>];</div>
<div class="line"><span class="lineno"> 8885</span>    }</div>
<div class="line"><span class="lineno"> 8886</span> </div>
<div class="line"><span class="lineno"> 8887</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a7cd712ed2b8d7a2107836b8ed6ddc1a6">read_auth_file</a>(filep, &amp;workdata, <a class="code hl_define" href="#ae64a0edac6e82db7aa05b2d574e4a015">INITIAL_DEPTH</a>);</div>
<div class="line"><span class="lineno"> 8888</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a7cd712ed2b8d7a2107836b8ed6ddc1a6"><div class="ttname"><a href="#a7cd712ed2b8d7a2107836b8ed6ddc1a6">read_auth_file</a></div><div class="ttdeci">static int read_auth_file(struct mg_file *filep, struct read_auth_file_struct *workdata, int depth)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08733">civetweb.c:8733</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aa30b97fc6c76000802e15129b3a1f48a"><div class="ttname"><a href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a></div><div class="ttdeci">static char * mg_strdup_ctx(const char *str, struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03062">civetweb.c:3062</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aa5a596736f518b04c383c91e7c9cc747"><div class="ttname"><a href="#aa5a596736f518b04c383c91e7c9cc747">parse_auth_header</a></div><div class="ttdeci">static int parse_auth_header(struct mg_connection *conn, char *buf, size_t buf_size, struct ah *ah)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08555">civetweb.c:8555</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ae64a0edac6e82db7aa05b2d574e4a015"><div class="ttname"><a href="#ae64a0edac6e82db7aa05b2d574e4a015">INITIAL_DEPTH</a></div><div class="ttdeci">#define INITIAL_DEPTH</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08715">civetweb.c:8715</a></div></div>
<div class="ttc" id="astructmg__connection_html_ab2c448b0d885bca25578872ca4362c89"><div class="ttname"><a href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">mg_connection::request_info</a></div><div class="ttdeci">struct mg_request_info request_info</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02494">civetweb.c:2494</a></div></div>
<div class="ttc" id="astructmg__connection_html_abb30f6262885e94b0242e7e85960caaf"><div class="ttname"><a href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">mg_connection::dom_ctx</a></div><div class="ttdeci">struct mg_domain_context * dom_ctx</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02498">civetweb.c:2498</a></div></div>
<div class="ttc" id="astructmg__request__info_html_aea0e44be08a00a1ce0f2a08d034d9c8a"><div class="ttname"><a href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">mg_request_info::remote_user</a></div><div class="ttdeci">const char * remote_user</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00164">civetweb.h:164</a></div></div>
<div class="ttc" id="astructread__auth__file__struct_html"><div class="ttname"><a href="structread__auth__file__struct.html">read_auth_file_struct</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08721">civetweb.c:8721</a></div></div>
<div class="ttc" id="astructread__auth__file__struct_html_a98f65df7a72e6845bb9aed2bf77db775"><div class="ttname"><a href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">read_auth_file_struct::buf</a></div><div class="ttdeci">char buf[256+256+40]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08725">civetweb.c:8725</a></div></div>
<div class="ttc" id="astructread__auth__file__struct_html_af7a708a9761e6d8a53980eaaf9fed88a"><div class="ttname"><a href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">read_auth_file_struct::conn</a></div><div class="ttdeci">struct mg_connection * conn</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08722">civetweb.c:8722</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l08723">read_auth_file_struct::ah</a>, <a class="el" href="civetweb_8c_source.html#l01999">AUTHENTICATION_DOMAIN</a>, <a class="el" href="civetweb_8c_source.html#l08725">read_auth_file_struct::buf</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l08722">read_auth_file_struct::conn</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l08724">read_auth_file_struct::domain</a>, <a class="el" href="civetweb_8c_source.html#l08715">INITIAL_DEPTH</a>, <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l03062">mg_strdup_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l08555">parse_auth_header()</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l08733">read_auth_file()</a>, <a class="el" href="civetweb_8h_source.html#l00164">mg_request_info::remote_user</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, and <a class="el" href="civetweb_8c_source.html#l08546">ah::user</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>, <a class="el" href="civetweb_8c_source.html#l09035">is_authorized_for_put()</a>, and <a class="el" href="civetweb_8c_source.html#l08893">mg_check_digest_access_authentication()</a>.</p>

</div>
</div>
<a id="accf1ea390b445a26d81f9e25692fc267" name="accf1ea390b445a26d81f9e25692fc267"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accf1ea390b445a26d81f9e25692fc267">&#9670;&#160;</a></span>b64reverse()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned char b64reverse </td>
          <td>(</td>
          <td class="paramtype">char</td>          <td class="paramname"><span class="paramname"><em>letter</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07358">7358</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7359</span>{</div>
<div class="line"><span class="lineno"> 7360</span>    <span class="keywordflow">if</span> ((letter &gt;= <span class="charliteral">&#39;A&#39;</span>) &amp;&amp; (letter &lt;= <span class="charliteral">&#39;Z&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 7361</span>        <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(letter - <span class="charliteral">&#39;A&#39;</span>);</div>
<div class="line"><span class="lineno"> 7362</span>    }</div>
<div class="line"><span class="lineno"> 7363</span>    <span class="keywordflow">if</span> ((letter &gt;= <span class="charliteral">&#39;a&#39;</span>) &amp;&amp; (letter &lt;= <span class="charliteral">&#39;z&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 7364</span>        <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(letter - <span class="charliteral">&#39;a&#39;</span> + 26);</div>
<div class="line"><span class="lineno"> 7365</span>    }</div>
<div class="line"><span class="lineno"> 7366</span>    <span class="keywordflow">if</span> ((letter &gt;= <span class="charliteral">&#39;0&#39;</span>) &amp;&amp; (letter &lt;= <span class="charliteral">&#39;9&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 7367</span>        <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(letter - <span class="charliteral">&#39;0&#39;</span> + 52);</div>
<div class="line"><span class="lineno"> 7368</span>    }</div>
<div class="line"><span class="lineno"> 7369</span>    <span class="keywordflow">if</span> (letter == <span class="charliteral">&#39;+&#39;</span>) {</div>
<div class="line"><span class="lineno"> 7370</span>        <span class="keywordflow">return</span> 62;</div>
<div class="line"><span class="lineno"> 7371</span>    }</div>
<div class="line"><span class="lineno"> 7372</span>    <span class="keywordflow">if</span> (letter == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno"> 7373</span>        <span class="keywordflow">return</span> 63;</div>
<div class="line"><span class="lineno"> 7374</span>    }</div>
<div class="line"><span class="lineno"> 7375</span>    <span class="keywordflow">if</span> (letter == <span class="charliteral">&#39;=&#39;</span>) {</div>
<div class="line"><span class="lineno"> 7376</span>        <span class="keywordflow">return</span> 255; <span class="comment">/* normal end */</span></div>
<div class="line"><span class="lineno"> 7377</span>    }</div>
<div class="line"><span class="lineno"> 7378</span>    <span class="keywordflow">return</span> 254; <span class="comment">/* error */</span></div>
<div class="line"><span class="lineno"> 7379</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l07383">mg_base64_decode()</a>.</p>

</div>
</div>
<a id="a8694301743d1c8f3bc37f058a1e0de2a" name="a8694301743d1c8f3bc37f058a1e0de2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8694301743d1c8f3bc37f058a1e0de2a">&#9670;&#160;</a></span>bin2str()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void bin2str </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>to</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *</td>          <td class="paramname"><span class="paramname"><em>p</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08389">8389</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8390</span>{</div>
<div class="line"><span class="lineno"> 8391</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *hex = <span class="stringliteral">&quot;0123456789abcdef&quot;</span>;</div>
<div class="line"><span class="lineno"> 8392</span> </div>
<div class="line"><span class="lineno"> 8393</span>    <span class="keywordflow">for</span> (; len--; p++) {</div>
<div class="line"><span class="lineno"> 8394</span>        *to++ = hex[p[0] &gt;&gt; 4];</div>
<div class="line"><span class="lineno"> 8395</span>        *to++ = hex[p[0] &amp; 0x0f];</div>
<div class="line"><span class="lineno"> 8396</span>    }</div>
<div class="line"><span class="lineno"> 8397</span>    *to = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 8398</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08404">mg_md5()</a>.</p>

</div>
</div>
<a id="a413ce152f72e5e12647a950de90d589f" name="a413ce152f72e5e12647a950de90d589f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a413ce152f72e5e12647a950de90d589f">&#9670;&#160;</a></span>check_acl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int check_acl </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>phys_ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const union <a class="el" href="unionusa.html">usa</a> *</td>          <td class="paramname"><span class="paramname"><em>sa</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16229">16229</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16230</span>{</div>
<div class="line"><span class="lineno">16231</span>    <span class="keywordtype">int</span> allowed, flag, matched;</div>
<div class="line"><span class="lineno">16232</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> <a class="code hl_struct" href="structvec.html">vec</a>;</div>
<div class="line"><span class="lineno">16233</span> </div>
<div class="line"><span class="lineno">16234</span>    <span class="keywordflow">if</span> (phys_ctx) {</div>
<div class="line"><span class="lineno">16235</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *list = phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba3afb385e81857461e2860a6bc661020c">ACCESS_CONTROL_LIST</a>];</div>
<div class="line"><span class="lineno">16236</span> </div>
<div class="line"><span class="lineno">16237</span>        <span class="comment">/* If any ACL is set, deny by default */</span></div>
<div class="line"><span class="lineno">16238</span>        allowed = (list == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? <span class="charliteral">&#39;+&#39;</span> : <span class="stringliteral">&#39;-&#39;</span>;</div>
<div class="line"><span class="lineno">16239</span> </div>
<div class="line"><span class="lineno">16240</span>        <span class="keywordflow">while</span> ((list = <a class="code hl_function" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a>(list, &amp;<a class="code hl_struct" href="structvec.html">vec</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16241</span>            flag = <a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>[0];</div>
<div class="line"><span class="lineno">16242</span>            matched = -1;</div>
<div class="line"><span class="lineno">16243</span>            <span class="keywordflow">if</span> ((<a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> &gt; 0) &amp;&amp; ((flag == <span class="charliteral">&#39;+&#39;</span>) || (flag == <span class="charliteral">&#39;-&#39;</span>))) {</div>
<div class="line"><span class="lineno">16244</span>                <a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>++;</div>
<div class="line"><span class="lineno">16245</span>                <a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>--;</div>
<div class="line"><span class="lineno">16246</span>                matched = <a class="code hl_function" href="#a917f041b64f1819b9bb4fd8a57e0d945">parse_match_net</a>(&amp;<a class="code hl_struct" href="structvec.html">vec</a>, sa, 1);</div>
<div class="line"><span class="lineno">16247</span>            }</div>
<div class="line"><span class="lineno">16248</span>            <span class="keywordflow">if</span> (matched &lt; 0) {</div>
<div class="line"><span class="lineno">16249</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">16250</span>                                    <span class="stringliteral">&quot;%s: subnet must be [+|-]IP-addr[/x]&quot;</span>,</div>
<div class="line"><span class="lineno">16251</span>                                    __func__);</div>
<div class="line"><span class="lineno">16252</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">16253</span>            }</div>
<div class="line"><span class="lineno">16254</span>            <span class="keywordflow">if</span> (matched) {</div>
<div class="line"><span class="lineno">16255</span>                allowed = flag;</div>
<div class="line"><span class="lineno">16256</span>            }</div>
<div class="line"><span class="lineno">16257</span>        }</div>
<div class="line"><span class="lineno">16258</span> </div>
<div class="line"><span class="lineno">16259</span>        <span class="keywordflow">return</span> allowed == <span class="charliteral">&#39;+&#39;</span>;</div>
<div class="line"><span class="lineno">16260</span>    }</div>
<div class="line"><span class="lineno">16261</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">16262</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a8a9f9af183eb62789209809d41dabbf4"><div class="ttname"><a href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a></div><div class="ttdeci">static const char * next_option(const char *list, struct vec *val, struct vec *eq_val)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03899">civetweb.c:3899</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a917f041b64f1819b9bb4fd8a57e0d945"><div class="ttname"><a href="#a917f041b64f1819b9bb4fd8a57e0d945">parse_match_net</a></div><div class="ttdeci">static int parse_match_net(const struct vec *vec, const union usa *sa, int no_strict)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l13966">civetweb.c:13966</a></div></div>
<div class="ttc" id="astructvec_html"><div class="ttname"><a href="structvec.html">vec</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01864">civetweb.c:1864</a></div></div>
<div class="ttc" id="astructvec_html_a171ca107ac87f39c832a05621c99a17b"><div class="ttname"><a href="structvec.html#a171ca107ac87f39c832a05621c99a17b">vec::len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01866">civetweb.c:1866</a></div></div>
<div class="ttc" id="astructvec_html_ae8b8fdc00d1598d046d14d0ae73a441a"><div class="ttname"><a href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">vec::ptr</a></div><div class="ttdeci">const char * ptr</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01865">civetweb.c:1865</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02006">ACCESS_CONTROL_LIST</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="civetweb_8c_source.html#l03899">next_option()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l13966">parse_match_net()</a>, and <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l17662">set_acl_option()</a>.</p>

</div>
</div>
<a id="a09229a33ae0eac77138714207fc46c14" name="a09229a33ae0eac77138714207fc46c14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09229a33ae0eac77138714207fc46c14">&#9670;&#160;</a></span>check_authorization()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int check_authorization </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08918">8918</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8919</span>{</div>
<div class="line"><span class="lineno"> 8920</span><span class="preprocessor">#if !defined(NO_FILESYSTEMS)</span></div>
<div class="line"><span class="lineno"> 8921</span>    <span class="keywordtype">char</span> fname[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>];</div>
<div class="line"><span class="lineno"> 8922</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> uri_vec, filename_vec;</div>
<div class="line"><span class="lineno"> 8923</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *list;</div>
<div class="line"><span class="lineno"> 8924</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno"> 8925</span>    <span class="keywordtype">int</span> authorized = 1, truncated;</div>
<div class="line"><span class="lineno"> 8926</span> </div>
<div class="line"><span class="lineno"> 8927</span>    <span class="keywordflow">if</span> (!conn || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno"> 8928</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8929</span>    }</div>
<div class="line"><span class="lineno"> 8930</span> </div>
<div class="line"><span class="lineno"> 8931</span>    list = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bac05d91b095136909d3bb88f857770b34">PROTECT_URI</a>];</div>
<div class="line"><span class="lineno"> 8932</span>    <span class="keywordflow">while</span> ((list = <a class="code hl_function" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a>(list, &amp;uri_vec, &amp;filename_vec)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8933</span>        <span class="keywordflow">if</span> (!memcmp(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>, uri_vec.ptr, uri_vec.len)) {</div>
<div class="line"><span class="lineno"> 8934</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 8935</span>                        &amp;truncated,</div>
<div class="line"><span class="lineno"> 8936</span>                        fname,</div>
<div class="line"><span class="lineno"> 8937</span>                        <span class="keyword">sizeof</span>(fname),</div>
<div class="line"><span class="lineno"> 8938</span>                        <span class="stringliteral">&quot;%.*s&quot;</span>,</div>
<div class="line"><span class="lineno"> 8939</span>                        (<span class="keywordtype">int</span>)filename_vec.len,</div>
<div class="line"><span class="lineno"> 8940</span>                        filename_vec.ptr);</div>
<div class="line"><span class="lineno"> 8941</span> </div>
<div class="line"><span class="lineno"> 8942</span>            <span class="keywordflow">if</span> (truncated</div>
<div class="line"><span class="lineno"> 8943</span>                || !<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, fname, <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>, &amp;file)) {</div>
<div class="line"><span class="lineno"> 8944</span>                <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno"> 8945</span>                                <span class="stringliteral">&quot;%s: cannot open %s: %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 8946</span>                                __func__,</div>
<div class="line"><span class="lineno"> 8947</span>                                fname,</div>
<div class="line"><span class="lineno"> 8948</span>                                strerror(errno));</div>
<div class="line"><span class="lineno"> 8949</span>            }</div>
<div class="line"><span class="lineno"> 8950</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 8951</span>        }</div>
<div class="line"><span class="lineno"> 8952</span>    }</div>
<div class="line"><span class="lineno"> 8953</span> </div>
<div class="line"><span class="lineno"> 8954</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#aabc2fa59339cbedec7cf5855e5e8e89c">is_file_opened</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>)) {</div>
<div class="line"><span class="lineno"> 8955</span>        <a class="code hl_function" href="#a054c8cdcbf4ebf1a0ef52792a1868351">open_auth_file</a>(conn, path, &amp;file);</div>
<div class="line"><span class="lineno"> 8956</span>    }</div>
<div class="line"><span class="lineno"> 8957</span> </div>
<div class="line"><span class="lineno"> 8958</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#aabc2fa59339cbedec7cf5855e5e8e89c">is_file_opened</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>)) {</div>
<div class="line"><span class="lineno"> 8959</span>        authorized = <a class="code hl_function" href="#abbf5e7625b9c8d60ffc4d84b02923943">authorize</a>(conn, &amp;file, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 8960</span>        (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>); <span class="comment">/* ignore error on read only file */</span></div>
<div class="line"><span class="lineno"> 8961</span>    }</div>
<div class="line"><span class="lineno"> 8962</span> </div>
<div class="line"><span class="lineno"> 8963</span>    <span class="keywordflow">return</span> authorized;</div>
<div class="line"><span class="lineno"> 8964</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 8965</span>    (void)conn;</div>
<div class="line"><span class="lineno"> 8966</span>    (void)path;</div>
<div class="line"><span class="lineno"> 8967</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 8968</span><span class="preprocessor">#endif </span><span class="comment">/* NO_FILESYSTEMS */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 8969</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a054c8cdcbf4ebf1a0ef52792a1868351"><div class="ttname"><a href="#a054c8cdcbf4ebf1a0ef52792a1868351">open_auth_file</a></div><div class="ttdeci">static void open_auth_file(struct mg_connection *conn, const char *path, struct mg_file *filep)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08472">civetweb.c:8472</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a3341033fb439f4b1566fa8bc71f28e2b"><div class="ttname"><a href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a></div><div class="ttdeci">static int mg_fopen(const struct mg_connection *conn, const char *path, int mode, struct mg_file *filep)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02915">civetweb.c:2915</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a5bd58793b81cca07589b297470992a9e"><div class="ttname"><a href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a></div><div class="ttdeci">#define MG_FOPEN_MODE_READ</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02843">civetweb.c:2843</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a7a78f968a579c967c2bb097b9e64749f"><div class="ttname"><a href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a></div><div class="ttdeci">#define UTF8_PATH_MAX</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00861">civetweb.c:861</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a847434a4a5f5ea7a1a1bca87625ccb81"><div class="ttname"><a href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a></div><div class="ttdeci">static void mg_snprintf(const struct mg_connection *conn, int *truncated, char *buf, size_t buflen, PRINTF_FORMAT_STRING(const char *fmt),...) PRINTF_ARGS(5</div></div>
<div class="ttc" id="acivetweb_8c_html_aabc2fa59339cbedec7cf5855e5e8e89c"><div class="ttname"><a href="#aabc2fa59339cbedec7cf5855e5e8e89c">is_file_opened</a></div><div class="ttdeci">static int is_file_opened(const struct mg_file_access *fileacc)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02853">civetweb.c:2853</a></div></div>
<div class="ttc" id="acivetweb_8c_html_abbf5e7625b9c8d60ffc4d84b02923943"><div class="ttname"><a href="#abbf5e7625b9c8d60ffc4d84b02923943">authorize</a></div><div class="ttdeci">static int authorize(struct mg_connection *conn, struct mg_file *filep, const char *realm)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08861">civetweb.c:8861</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ada8ae98eea53a76bee149585c48beca3"><div class="ttname"><a href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a></div><div class="ttdeci">static int mg_fclose(struct mg_file_access *fileacc)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02986">civetweb.c:2986</a></div></div>
<div class="ttc" id="acivetweb_8c_html_af7932a261d02cf4b8431793664a4585b"><div class="ttname"><a href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a></div><div class="ttdeci">#define STRUCT_FILE_INITIALIZER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01891">civetweb.c:1891</a></div></div>
<div class="ttc" id="astructmg__file_html"><div class="ttname"><a href="structmg__file.html">mg_file</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01885">civetweb.c:1885</a></div></div>
<div class="ttc" id="astructmg__file_html_a90b5d07df0a357ba1f1311b92fdd3dc2"><div class="ttname"><a href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">mg_file::access</a></div><div class="ttdeci">struct mg_file_access access</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01887">civetweb.c:1887</a></div></div>
<div class="ttc" id="astructmg__request__info_html_a369e379c8cb6f102ef44499989055279"><div class="ttname"><a href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">mg_request_info::local_uri</a></div><div class="ttdeci">const char * local_uri</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00157">civetweb.h:157</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l08861">authorize()</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02853">is_file_opened()</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02843">MG_FOPEN_MODE_READ</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l03899">next_option()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l08472">open_auth_file()</a>, <a class="el" href="civetweb_8c_source.html#l01998">PROTECT_URI</a>, <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>, and <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="ad5152c8a0667f633bdb0d7b97bca75c3" name="ad5152c8a0667f633bdb0d7b97bca75c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5152c8a0667f633bdb0d7b97bca75c3">&#9670;&#160;</a></span>check_password_digest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int check_password_digest </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>method</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>ha1</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uri</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>nonce</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>nc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>cnonce</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>qop</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>response</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08427">8427</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8435</span>{</div>
<div class="line"><span class="lineno"> 8436</span>    <span class="keywordtype">char</span> ha2[32 + 1], expected_response[32 + 1];</div>
<div class="line"><span class="lineno"> 8437</span> </div>
<div class="line"><span class="lineno"> 8438</span>    <span class="comment">/* Some of the parameters may be NULL */</span></div>
<div class="line"><span class="lineno"> 8439</span>    <span class="keywordflow">if</span> ((method == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (nonce == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (nc == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (cnonce == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno"> 8440</span>        || (qop == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (response == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 8441</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8442</span>    }</div>
<div class="line"><span class="lineno"> 8443</span> </div>
<div class="line"><span class="lineno"> 8444</span>    <span class="comment">/* NOTE(lsm): due to a bug in MSIE, we do not compare the URI */</span></div>
<div class="line"><span class="lineno"> 8445</span>    <span class="keywordflow">if</span> (strlen(response) != 32) {</div>
<div class="line"><span class="lineno"> 8446</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8447</span>    }</div>
<div class="line"><span class="lineno"> 8448</span> </div>
<div class="line"><span class="lineno"> 8449</span>    <a class="code hl_function" href="#a9a1f27cd059fa56ead5cecaf7885582f">mg_md5</a>(ha2, method, <span class="stringliteral">&quot;:&quot;</span>, uri, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 8450</span>    <a class="code hl_function" href="#a9a1f27cd059fa56ead5cecaf7885582f">mg_md5</a>(expected_response,</div>
<div class="line"><span class="lineno"> 8451</span>           ha1,</div>
<div class="line"><span class="lineno"> 8452</span>           <span class="stringliteral">&quot;:&quot;</span>,</div>
<div class="line"><span class="lineno"> 8453</span>           nonce,</div>
<div class="line"><span class="lineno"> 8454</span>           <span class="stringliteral">&quot;:&quot;</span>,</div>
<div class="line"><span class="lineno"> 8455</span>           nc,</div>
<div class="line"><span class="lineno"> 8456</span>           <span class="stringliteral">&quot;:&quot;</span>,</div>
<div class="line"><span class="lineno"> 8457</span>           cnonce,</div>
<div class="line"><span class="lineno"> 8458</span>           <span class="stringliteral">&quot;:&quot;</span>,</div>
<div class="line"><span class="lineno"> 8459</span>           qop,</div>
<div class="line"><span class="lineno"> 8460</span>           <span class="stringliteral">&quot;:&quot;</span>,</div>
<div class="line"><span class="lineno"> 8461</span>           ha2,</div>
<div class="line"><span class="lineno"> 8462</span>           <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 8463</span> </div>
<div class="line"><span class="lineno"> 8464</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(response, expected_response) == 0;</div>
<div class="line"><span class="lineno"> 8465</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a5d0ea93d3ec8a90e631f7e7f53d28628"><div class="ttname"><a href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a></div><div class="ttdeci">CIVETWEB_API int mg_strcasecmp(const char *s1, const char *s2)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03034">civetweb.c:3034</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a9a1f27cd059fa56ead5cecaf7885582f"><div class="ttname"><a href="#a9a1f27cd059fa56ead5cecaf7885582f">mg_md5</a></div><div class="ttdeci">CIVETWEB_API char * mg_md5(char buf[33],...)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08404">civetweb.c:8404</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l08404">mg_md5()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08733">read_auth_file()</a>.</p>

</div>
</div>
<a id="a3c23cebc85fcd88f7a1cf2227a7e1889" name="a3c23cebc85fcd88f7a1cf2227a7e1889"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c23cebc85fcd88f7a1cf2227a7e1889">&#9670;&#160;</a></span>close_all_listening_sockets()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void close_all_listening_sockets </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l15456">15456</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">15457</span>{</div>
<div class="line"><span class="lineno">15458</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">15459</span>    <span class="keywordflow">if</span> (!ctx) {</div>
<div class="line"><span class="lineno">15460</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15461</span>    }</div>
<div class="line"><span class="lineno">15462</span> </div>
<div class="line"><span class="lineno">15463</span>    <span class="keywordflow">for</span> (i = 0; i &lt; ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ade1ccb738022fd01597c1816cb88d1e4">num_listening_sockets</a>; i++) {</div>
<div class="line"><span class="lineno">15464</span>        <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>);</div>
<div class="line"><span class="lineno">15465</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno">15466</span>        <span class="comment">/* For unix domain sockets, the socket name represents a file that has</span></div>
<div class="line"><span class="lineno">15467</span><span class="comment">         * to be deleted. */</span></div>
<div class="line"><span class="lineno">15468</span>        <span class="comment">/* See</span></div>
<div class="line"><span class="lineno">15469</span><span class="comment">         * https://stackoverflow.com/questions/15716302/so-reuseaddr-and-af-unix</span></div>
<div class="line"><span class="lineno">15470</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">15471</span>        <span class="keywordflow">if</span> ((ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_family == AF_UNIX)</div>
<div class="line"><span class="lineno">15472</span>            &amp;&amp; (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a> != <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>)) {</div>
<div class="line"><span class="lineno">15473</span>            <a class="code hl_define" href="#ad78a7b8419e5ec9f2cc7d310fcf142d7">IGNORE_UNUSED_RESULT</a>(</div>
<div class="line"><span class="lineno">15474</span>                remove(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sun.sun_path));</div>
<div class="line"><span class="lineno">15475</span>        }</div>
<div class="line"><span class="lineno">15476</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15477</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a> = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">15478</span>    }</div>
<div class="line"><span class="lineno">15479</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>);</div>
<div class="line"><span class="lineno">15480</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">15481</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a9ed2145955cdb391d6ffba32a1df8d16">listening_socket_fds</a>);</div>
<div class="line"><span class="lineno">15482</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a9ed2145955cdb391d6ffba32a1df8d16">listening_socket_fds</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">15483</span>}</div>
<div class="ttc" id="astructmg__context_html_a8639456185dda0c46dc6131f814a9d3f"><div class="ttname"><a href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">mg_context::listening_sockets</a></div><div class="ttdeci">struct socket * listening_sockets</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02356">civetweb.c:2356</a></div></div>
<div class="ttc" id="astructmg__context_html_a9ed2145955cdb391d6ffba32a1df8d16"><div class="ttname"><a href="structmg__context.html#a9ed2145955cdb391d6ffba32a1df8d16">mg_context::listening_socket_fds</a></div><div class="ttdeci">struct mg_pollfd * listening_socket_fds</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02357">civetweb.c:2357</a></div></div>
<div class="ttc" id="astructmg__context_html_ade1ccb738022fd01597c1816cb88d1e4"><div class="ttname"><a href="structmg__context.html#ade1ccb738022fd01597c1816cb88d1e4">mg_context::num_listening_sockets</a></div><div class="ttdeci">unsigned int num_listening_sockets</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02358">civetweb.c:2358</a></div></div>
<div class="ttc" id="astructsocket_html_a455153d6b0bf7dd4af9ce0183ab35a00"><div class="ttname"><a href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">socket::lsa</a></div><div class="ttdeci">union usa lsa</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01904">civetweb.c:1904</a></div></div>
<div class="ttc" id="aunionusa_html_a680bc429e90923ecbbf9c7d38ba4bf26"><div class="ttname"><a href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">usa::sin</a></div><div class="ttdeci">struct sockaddr_in sin</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01834">civetweb.c:1834</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00917">closesocket</a>, <a class="el" href="civetweb_8c_source.html#l00291">IGNORE_UNUSED_RESULT</a>, <a class="el" href="civetweb_8c_source.html#l00925">INVALID_SOCKET</a>, <a class="el" href="civetweb_8c_source.html#l02357">mg_context::listening_socket_fds</a>, <a class="el" href="civetweb_8c_source.html#l02356">mg_context::listening_sockets</a>, <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02358">mg_context::num_listening_sockets</a>, <a class="el" href="civetweb_8c_source.html#l01834">usa::sin</a>, and <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, and <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>.</p>

</div>
</div>
<a id="af4b9971ca12d36d97d92dd7980059fb0" name="af4b9971ca12d36d97d92dd7980059fb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4b9971ca12d36d97d92dd7980059fb0">&#9670;&#160;</a></span>close_connection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void close_connection </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17864">17864</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17865</span>{</div>
<div class="line"><span class="lineno">17866</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">17867</span>    conn-&gt;conn_state = 6; <span class="comment">/* to close */</span></div>
<div class="line"><span class="lineno">17868</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17869</span> </div>
<div class="line"><span class="lineno">17870</span><span class="preprocessor">#if defined(USE_LUA) &amp;&amp; defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno">17871</span>    <span class="keywordflow">if</span> (conn-&gt;lua_websocket_state) {</div>
<div class="line"><span class="lineno">17872</span>        lua_websocket_close(conn, conn-&gt;lua_websocket_state);</div>
<div class="line"><span class="lineno">17873</span>        conn-&gt;lua_websocket_state = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17874</span>    }</div>
<div class="line"><span class="lineno">17875</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17876</span> </div>
<div class="line"><span class="lineno">17877</span>    <a class="code hl_function" href="#a149a7777de4ad5702dfc3a50271e6fb9">mg_lock_connection</a>(conn);</div>
<div class="line"><span class="lineno">17878</span> </div>
<div class="line"><span class="lineno">17879</span>    <span class="comment">/* Set close flag, so keep-alive loops will stop */</span></div>
<div class="line"><span class="lineno">17880</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">17881</span> </div>
<div class="line"><span class="lineno">17882</span>    <span class="comment">/* call the connection_close callback if assigned */</span></div>
<div class="line"><span class="lineno">17883</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a74c9d71a6ff9c78bbef39d785e5f4a3d">connection_close</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17884</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099">CONTEXT_SERVER</a>) {</div>
<div class="line"><span class="lineno">17885</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a74c9d71a6ff9c78bbef39d785e5f4a3d">connection_close</a>(conn);</div>
<div class="line"><span class="lineno">17886</span>        }</div>
<div class="line"><span class="lineno">17887</span>    }</div>
<div class="line"><span class="lineno">17888</span> </div>
<div class="line"><span class="lineno">17889</span>    <span class="comment">/* Reset user data, after close callback is called.</span></div>
<div class="line"><span class="lineno">17890</span><span class="comment">     * Do not reuse it. If the user needs a destructor,</span></div>
<div class="line"><span class="lineno">17891</span><span class="comment">     * it must be done in the connection_close callback. */</span></div>
<div class="line"><span class="lineno">17892</span>    <a class="code hl_function" href="#a83b9266322b1883981ec399cfce275a4">mg_set_user_connection_data</a>(conn, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">17893</span> </div>
<div class="line"><span class="lineno">17894</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">17895</span>    conn-&gt;conn_state = 7; <span class="comment">/* closing */</span></div>
<div class="line"><span class="lineno">17896</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17897</span> </div>
<div class="line"><span class="lineno">17898</span><span class="preprocessor">#if defined(USE_MBEDTLS)</span></div>
<div class="line"><span class="lineno">17899</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17900</span>        mbed_ssl_close(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>);</div>
<div class="line"><span class="lineno">17901</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17902</span>    }</div>
<div class="line"><span class="lineno">17903</span><span class="preprocessor">#elif !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno">17904</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17905</span>        <span class="comment">/* Run SSL_shutdown twice to ensure completely close SSL connection</span></div>
<div class="line"><span class="lineno">17906</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">17907</span>        SSL_shutdown(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>);</div>
<div class="line"><span class="lineno">17908</span>        SSL_free(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>);</div>
<div class="line"><span class="lineno">17909</span>        OPENSSL_REMOVE_THREAD_STATE();</div>
<div class="line"><span class="lineno">17910</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17911</span>    }</div>
<div class="line"><span class="lineno">17912</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17913</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a> != <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>) {</div>
<div class="line"><span class="lineno">17914</span><span class="preprocessor">#if defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno">17915</span>        <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>);</div>
<div class="line"><span class="lineno">17916</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">17917</span>        <a class="code hl_function" href="#ae2e9d446a299e9cedc4c267b7cae5419">close_socket_gracefully</a>(conn);</div>
<div class="line"><span class="lineno">17918</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17919</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a> = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">17920</span>    }</div>
<div class="line"><span class="lineno">17921</span> </div>
<div class="line"><span class="lineno">17922</span>    <span class="comment">/* call the connection_closed callback if assigned */</span></div>
<div class="line"><span class="lineno">17923</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#ab958b05616d32fdbc1e88da2784192a4">connection_closed</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17924</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099">CONTEXT_SERVER</a>) {</div>
<div class="line"><span class="lineno">17925</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#ab958b05616d32fdbc1e88da2784192a4">connection_closed</a>(conn);</div>
<div class="line"><span class="lineno">17926</span>        }</div>
<div class="line"><span class="lineno">17927</span>    }</div>
<div class="line"><span class="lineno">17928</span> </div>
<div class="line"><span class="lineno">17929</span>    <a class="code hl_function" href="#a23acf2c99018649c40b525c8bde45960">mg_unlock_connection</a>(conn);</div>
<div class="line"><span class="lineno">17930</span> </div>
<div class="line"><span class="lineno">17931</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">17932</span>    conn-&gt;conn_state = 8; <span class="comment">/* closed */</span></div>
<div class="line"><span class="lineno">17933</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17934</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a149a7777de4ad5702dfc3a50271e6fb9"><div class="ttname"><a href="#a149a7777de4ad5702dfc3a50271e6fb9">mg_lock_connection</a></div><div class="ttdeci">CIVETWEB_API void mg_lock_connection(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l13000">civetweb.c:13000</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a23acf2c99018649c40b525c8bde45960"><div class="ttname"><a href="#a23acf2c99018649c40b525c8bde45960">mg_unlock_connection</a></div><div class="ttdeci">CIVETWEB_API void mg_unlock_connection(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l13009">civetweb.c:13009</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a83b9266322b1883981ec399cfce275a4"><div class="ttname"><a href="#a83b9266322b1883981ec399cfce275a4">mg_set_user_connection_data</a></div><div class="ttdeci">CIVETWEB_API void mg_set_user_connection_data(const struct mg_connection *const_conn, void *data)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03225">civetweb.c:3225</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ae2e9d446a299e9cedc4c267b7cae5419"><div class="ttname"><a href="#ae2e9d446a299e9cedc4c267b7cae5419">close_socket_gracefully</a></div><div class="ttdeci">static void close_socket_gracefully(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17740">civetweb.c:17740</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_a74c9d71a6ff9c78bbef39d785e5f4a3d"><div class="ttname"><a href="structmg__callbacks.html#a74c9d71a6ff9c78bbef39d785e5f4a3d">mg_callbacks::connection_close</a></div><div class="ttdeci">void(* connection_close)(const struct mg_connection *)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00320">civetweb.h:320</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_ab958b05616d32fdbc1e88da2784192a4"><div class="ttname"><a href="structmg__callbacks.html#ab958b05616d32fdbc1e88da2784192a4">mg_callbacks::connection_closed</a></div><div class="ttdeci">void(* connection_closed)(const struct mg_connection *)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00330">civetweb.h:330</a></div></div>
<div class="ttc" id="astructmg__connection_html_a6a9f2b9d1087412cac4187ce5a44d274"><div class="ttname"><a href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">mg_connection::client</a></div><div class="ttdeci">struct socket client</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02507">civetweb.c:2507</a></div></div>
<div class="ttc" id="astructmg__connection_html_a7e246b550026933deb3bbcda123df48f"><div class="ttname"><a href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">mg_connection::must_close</a></div><div class="ttdeci">int must_close</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02535">civetweb.c:2535</a></div></div>
<div class="ttc" id="astructmg__connection_html_ac376c70a4f827896a0152d704233424b"><div class="ttname"><a href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">mg_connection::ssl</a></div><div class="ttdeci">SSL * ssl</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02506">civetweb.c:2506</a></div></div>
<div class="ttc" id="astructmg__context_html_a90a2997b56e1c373156481a79c4e5d52"><div class="ttname"><a href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">mg_context::context_type</a></div><div class="ttdeci">int context_type</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02354">civetweb.c:2354</a></div></div>
<div class="ttc" id="astructmg__context_html_a96ed28bfd364cf0b9b556e365a3b780d"><div class="ttname"><a href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">mg_context::callbacks</a></div><div class="ttdeci">struct mg_callbacks callbacks</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02432">civetweb.c:2432</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l17740">close_socket_gracefully()</a>, <a class="el" href="civetweb_8c_source.html#l00917">closesocket</a>, <a class="el" href="civetweb_8h_source.html#l00320">mg_callbacks::connection_close</a>, <a class="el" href="civetweb_8h_source.html#l00330">mg_callbacks::connection_closed</a>, <a class="el" href="civetweb_8c_source.html#l02263">CONTEXT_SERVER</a>, <a class="el" href="civetweb_8c_source.html#l02354">mg_context::context_type</a>, <a class="el" href="civetweb_8c_source.html#l00925">INVALID_SOCKET</a>, <a class="el" href="civetweb_8c_source.html#l13000">mg_lock_connection()</a>, <a class="el" href="civetweb_8c_source.html#l03225">mg_set_user_connection_data()</a>, <a class="el" href="civetweb_8c_source.html#l13009">mg_unlock_connection()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, and <a class="el" href="civetweb_8c_source.html#l02506">mg_connection::ssl</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17938">mg_close_connection()</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="ae2e9d446a299e9cedc4c267b7cae5419" name="ae2e9d446a299e9cedc4c267b7cae5419"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2e9d446a299e9cedc4c267b7cae5419">&#9670;&#160;</a></span>close_socket_gracefully()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void close_socket_gracefully </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17740">17740</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17741</span>{</div>
<div class="line"><span class="lineno">17742</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">17743</span>    <span class="keywordtype">char</span> buf[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno">17744</span>    <span class="keywordtype">int</span> n;</div>
<div class="line"><span class="lineno">17745</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17746</span>    <span class="keyword">struct </span>linger linger;</div>
<div class="line"><span class="lineno">17747</span>    <span class="keywordtype">int</span> error_code = 0;</div>
<div class="line"><span class="lineno">17748</span>    <span class="keywordtype">int</span> linger_timeout = -2;</div>
<div class="line"><span class="lineno">17749</span>    socklen_t opt_len = <span class="keyword">sizeof</span>(error_code);</div>
<div class="line"><span class="lineno">17750</span> </div>
<div class="line"><span class="lineno">17751</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno">17752</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">17753</span>    }</div>
<div class="line"><span class="lineno">17754</span> </div>
<div class="line"><span class="lineno">17755</span>    <span class="comment">/* http://msdn.microsoft.com/en-us/library/ms739165(v=vs.85).aspx:</span></div>
<div class="line"><span class="lineno">17756</span><span class="comment">     * &quot;Note that enabling a nonzero timeout on a nonblocking socket</span></div>
<div class="line"><span class="lineno">17757</span><span class="comment">     * is not recommended.&quot;, so set it to blocking now */</span></div>
<div class="line"><span class="lineno">17758</span>    <a class="code hl_function" href="#a9edc91d3d1362d1b5be5371d44ce3d03">set_blocking_mode</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>);</div>
<div class="line"><span class="lineno">17759</span> </div>
<div class="line"><span class="lineno">17760</span>    <span class="comment">/* Send FIN to the client */</span></div>
<div class="line"><span class="lineno">17761</span>    shutdown(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>, <a class="code hl_define" href="#ac937c233d930a34c3f5fc66e8a5843c2">SHUTDOWN_WR</a>);</div>
<div class="line"><span class="lineno">17762</span> </div>
<div class="line"><span class="lineno">17763</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">17764</span>    <span class="comment">/* Read and discard pending incoming data. If we do not do that and</span></div>
<div class="line"><span class="lineno">17765</span><span class="comment">     * close</span></div>
<div class="line"><span class="lineno">17766</span><span class="comment">     * the socket, the data in the send buffer may be discarded. This</span></div>
<div class="line"><span class="lineno">17767</span><span class="comment">     * behaviour is seen on Windows, when client keeps sending data</span></div>
<div class="line"><span class="lineno">17768</span><span class="comment">     * when server decides to close the connection; then when client</span></div>
<div class="line"><span class="lineno">17769</span><span class="comment">     * does recv() it gets no data back. */</span></div>
<div class="line"><span class="lineno">17770</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">17771</span>        n = <a class="code hl_function" href="#a57991f1957263ffb56e7411155766204">pull_inner</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, conn, buf, <span class="keyword">sizeof</span>(buf), <span class="comment">/* Timeout in s: */</span> 1.0);</div>
<div class="line"><span class="lineno">17772</span>    } <span class="keywordflow">while</span> (n &gt; 0);</div>
<div class="line"><span class="lineno">17773</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17774</span> </div>
<div class="line"><span class="lineno">17775</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba6e6c7723fb9a76f3d7afde265e782141">LINGER_TIMEOUT</a>]) {</div>
<div class="line"><span class="lineno">17776</span>        linger_timeout = atoi(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba6e6c7723fb9a76f3d7afde265e782141">LINGER_TIMEOUT</a>]);</div>
<div class="line"><span class="lineno">17777</span>    }</div>
<div class="line"><span class="lineno">17778</span> </div>
<div class="line"><span class="lineno">17779</span>    <span class="comment">/* Set linger option according to configuration */</span></div>
<div class="line"><span class="lineno">17780</span>    <span class="keywordflow">if</span> (linger_timeout &gt;= 0) {</div>
<div class="line"><span class="lineno">17781</span>        <span class="comment">/* Set linger option to avoid socket hanging out after close. This</span></div>
<div class="line"><span class="lineno">17782</span><span class="comment">         * prevent ephemeral port exhaust problem under high QPS. */</span></div>
<div class="line"><span class="lineno">17783</span>        linger.l_onoff = 1;</div>
<div class="line"><span class="lineno">17784</span> </div>
<div class="line"><span class="lineno">17785</span><span class="preprocessor">#if defined(_MSC_VER)</span></div>
<div class="line"><span class="lineno">17786</span><span class="preprocessor">#pragma warning(push)</span></div>
<div class="line"><span class="lineno">17787</span><span class="preprocessor">#pragma warning(disable : 4244)</span></div>
<div class="line"><span class="lineno">17788</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17789</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno">17790</span><span class="preprocessor">#pragma GCC diagnostic push</span></div>
<div class="line"><span class="lineno">17791</span><span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wconversion&quot;</span></div>
<div class="line"><span class="lineno">17792</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17793</span>        <span class="comment">/* Data type of linger structure elements may differ,</span></div>
<div class="line"><span class="lineno">17794</span><span class="comment">         * so we don&#39;t know what cast we need here.</span></div>
<div class="line"><span class="lineno">17795</span><span class="comment">         * Disable type conversion warnings. */</span></div>
<div class="line"><span class="lineno">17796</span> </div>
<div class="line"><span class="lineno">17797</span>        linger.l_linger = (linger_timeout + 999) / 1000;</div>
<div class="line"><span class="lineno">17798</span> </div>
<div class="line"><span class="lineno">17799</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno">17800</span><span class="preprocessor">#pragma GCC diagnostic pop</span></div>
<div class="line"><span class="lineno">17801</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17802</span><span class="preprocessor">#if defined(_MSC_VER)</span></div>
<div class="line"><span class="lineno">17803</span><span class="preprocessor">#pragma warning(pop)</span></div>
<div class="line"><span class="lineno">17804</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17805</span> </div>
<div class="line"><span class="lineno">17806</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">17807</span>        linger.l_onoff = 0;</div>
<div class="line"><span class="lineno">17808</span>        linger.l_linger = 0;</div>
<div class="line"><span class="lineno">17809</span>    }</div>
<div class="line"><span class="lineno">17810</span> </div>
<div class="line"><span class="lineno">17811</span>    <span class="keywordflow">if</span> (linger_timeout &lt; -1) {</div>
<div class="line"><span class="lineno">17812</span>        <span class="comment">/* Default: don&#39;t configure any linger */</span></div>
<div class="line"><span class="lineno">17813</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (getsockopt(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>,</div>
<div class="line"><span class="lineno">17814</span>                          SOL_SOCKET,</div>
<div class="line"><span class="lineno">17815</span>                          SO_ERROR,</div>
<div class="line"><span class="lineno">17816</span>#<span class="keywordflow">if</span> defined(_WIN32) <span class="comment">/* WinSock uses different data type here */</span></div>
<div class="line"><span class="lineno">17817</span>                          (<span class="keywordtype">char</span> *)&amp;error_code,</div>
<div class="line"><span class="lineno">17818</span>#<span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">17819</span>                          &amp;error_code,</div>
<div class="line"><span class="lineno">17820</span>#endif</div>
<div class="line"><span class="lineno">17821</span>                          &amp;opt_len)</div>
<div class="line"><span class="lineno">17822</span>               != 0) {</div>
<div class="line"><span class="lineno">17823</span>        <span class="comment">/* Cannot determine if socket is already closed. This should</span></div>
<div class="line"><span class="lineno">17824</span><span class="comment">         * not occur and never did in a test. Log an error message</span></div>
<div class="line"><span class="lineno">17825</span><span class="comment">         * and continue. */</span></div>
<div class="line"><span class="lineno">17826</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">17827</span>                        <span class="stringliteral">&quot;%s: getsockopt(SOL_SOCKET SO_ERROR) failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno">17828</span>                        __func__,</div>
<div class="line"><span class="lineno">17829</span>                        strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">17830</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">17831</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (error_code == WSAECONNRESET) {</div>
<div class="line"><span class="lineno">17832</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">17833</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (error_code == ECONNRESET) {</div>
<div class="line"><span class="lineno">17834</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17835</span>        <span class="comment">/* Socket already closed by client/peer, close socket without linger</span></div>
<div class="line"><span class="lineno">17836</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">17837</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">17838</span> </div>
<div class="line"><span class="lineno">17839</span>        <span class="comment">/* Set linger timeout */</span></div>
<div class="line"><span class="lineno">17840</span>        <span class="keywordflow">if</span> (setsockopt(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>,</div>
<div class="line"><span class="lineno">17841</span>                       SOL_SOCKET,</div>
<div class="line"><span class="lineno">17842</span>                       SO_LINGER,</div>
<div class="line"><span class="lineno">17843</span>                       (<span class="keywordtype">char</span> *)&amp;linger,</div>
<div class="line"><span class="lineno">17844</span>                       <span class="keyword">sizeof</span>(linger))</div>
<div class="line"><span class="lineno">17845</span>            != 0) {</div>
<div class="line"><span class="lineno">17846</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(</div>
<div class="line"><span class="lineno">17847</span>                conn,</div>
<div class="line"><span class="lineno">17848</span>                <span class="stringliteral">&quot;%s: setsockopt(SOL_SOCKET SO_LINGER(%i,%i)) failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno">17849</span>                __func__,</div>
<div class="line"><span class="lineno">17850</span>                linger.l_onoff,</div>
<div class="line"><span class="lineno">17851</span>                linger.l_linger,</div>
<div class="line"><span class="lineno">17852</span>                strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">17853</span>        }</div>
<div class="line"><span class="lineno">17854</span>    }</div>
<div class="line"><span class="lineno">17855</span> </div>
<div class="line"><span class="lineno">17856</span>    <span class="comment">/* Now we know that our FIN is ACK-ed, safe to close */</span></div>
<div class="line"><span class="lineno">17857</span>    <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>);</div>
<div class="line"><span class="lineno">17858</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a> = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">17859</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a57991f1957263ffb56e7411155766204"><div class="ttname"><a href="#a57991f1957263ffb56e7411155766204">pull_inner</a></div><div class="ttdeci">static int pull_inner(FILE *fp, struct mg_connection *conn, char *buf, int len, double timeout)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06210">civetweb.c:6210</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a9edc91d3d1362d1b5be5371d44ce3d03"><div class="ttname"><a href="#a9edc91d3d1362d1b5be5371d44ce3d03">set_blocking_mode</a></div><div class="ttdeci">static int set_blocking_mode(SOCKET sock)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l05890">civetweb.c:5890</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac937c233d930a34c3f5fc66e8a5843c2"><div class="ttname"><a href="#ac937c233d930a34c3f5fc66e8a5843c2">SHUTDOWN_WR</a></div><div class="ttdeci">#define SHUTDOWN_WR</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00517">civetweb.c:517</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l00917">closesocket</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l00925">INVALID_SOCKET</a>, <a class="el" href="civetweb_8c_source.html#l01926">LINGER_TIMEOUT</a>, <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l06210">pull_inner()</a>, <a class="el" href="civetweb_8c_source.html#l05890">set_blocking_mode()</a>, <a class="el" href="civetweb_8c_source.html#l00517">SHUTDOWN_WR</a>, and <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17864">close_connection()</a>.</p>

</div>
</div>
<a id="a479f7681b73f6d36b90146e29ee63652" name="a479f7681b73f6d36b90146e29ee63652"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a479f7681b73f6d36b90146e29ee63652">&#9670;&#160;</a></span>compare_dir_entries()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int compare_dir_entries </td>
          <td>(</td>
          <td class="paramtype">const void *</td>          <td class="paramname"><span class="paramname"><em>p1</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *</td>          <td class="paramname"><span class="paramname"><em>p2</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>arg</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09716">9716</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9717</span>{</div>
<div class="line"><span class="lineno"> 9718</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *query_string = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)(<a class="code hl_variable" href="curl_8h.html#a7d68018e95e3d4e6b703538ac1c8c411">arg</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ? <a class="code hl_variable" href="curl_8h.html#a7d68018e95e3d4e6b703538ac1c8c411">arg</a> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno"> 9719</span>    <span class="keywordflow">if</span> (p1 &amp;&amp; p2) {</div>
<div class="line"><span class="lineno"> 9720</span>        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structde.html">de</a> *<a class="code hl_class" href="classa.html">a</a> = (<span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structde.html">de</a> *)p1, *b = (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code hl_struct" href="structde.html">de</a> *)p2;</div>
<div class="line"><span class="lineno"> 9721</span>        <span class="keywordtype">int</span> cmp_result = 0;</div>
<div class="line"><span class="lineno"> 9722</span> </div>
<div class="line"><span class="lineno"> 9723</span>        <span class="keywordflow">if</span> ((query_string == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (query_string[0] == <span class="charliteral">&#39;\0&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 9724</span>            query_string = <span class="stringliteral">&quot;n&quot;</span>;</div>
<div class="line"><span class="lineno"> 9725</span>        }</div>
<div class="line"><span class="lineno"> 9726</span> </div>
<div class="line"><span class="lineno"> 9727</span>        <span class="comment">/* Sort Directories vs Files */</span></div>
<div class="line"><span class="lineno"> 9728</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classa.html">a</a>-&gt;file.is_directory &amp;&amp; !b-&gt;file.is_directory) {</div>
<div class="line"><span class="lineno"> 9729</span>            <span class="keywordflow">return</span> -1; <span class="comment">/* Always put directories on top */</span></div>
<div class="line"><span class="lineno"> 9730</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code hl_class" href="classa.html">a</a>-&gt;file.is_directory &amp;&amp; b-&gt;file.is_directory) {</div>
<div class="line"><span class="lineno"> 9731</span>            <span class="keywordflow">return</span> 1; <span class="comment">/* Always put directories on top */</span></div>
<div class="line"><span class="lineno"> 9732</span>        }</div>
<div class="line"><span class="lineno"> 9733</span> </div>
<div class="line"><span class="lineno"> 9734</span>        <span class="comment">/* Sort by size or date */</span></div>
<div class="line"><span class="lineno"> 9735</span>        <span class="keywordflow">if</span> (*query_string == <span class="charliteral">&#39;s&#39;</span>) {</div>
<div class="line"><span class="lineno"> 9736</span>            cmp_result = (<a class="code hl_class" href="classa.html">a</a>-&gt;file.size == b-&gt;file.size)</div>
<div class="line"><span class="lineno"> 9737</span>                             ? 0</div>
<div class="line"><span class="lineno"> 9738</span>                             : ((<a class="code hl_class" href="classa.html">a</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.size &gt; b-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.size) ? 1 : -1);</div>
<div class="line"><span class="lineno"> 9739</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*query_string == <span class="charliteral">&#39;d&#39;</span>) {</div>
<div class="line"><span class="lineno"> 9740</span>            cmp_result =</div>
<div class="line"><span class="lineno"> 9741</span>                (<a class="code hl_class" href="classa.html">a</a>-&gt;file.last_modified == b-&gt;file.last_modified)</div>
<div class="line"><span class="lineno"> 9742</span>                    ? 0</div>
<div class="line"><span class="lineno"> 9743</span>                    : ((<a class="code hl_class" href="classa.html">a</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.last_modified &gt; b-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.last_modified) ? 1</div>
<div class="line"><span class="lineno"> 9744</span>                                                                       : -1);</div>
<div class="line"><span class="lineno"> 9745</span>        }</div>
<div class="line"><span class="lineno"> 9746</span> </div>
<div class="line"><span class="lineno"> 9747</span>        <span class="comment">/* Sort by name:</span></div>
<div class="line"><span class="lineno"> 9748</span><span class="comment">         * if (*query_string == &#39;n&#39;)  ...</span></div>
<div class="line"><span class="lineno"> 9749</span><span class="comment">         * but also sort files of same size/date by name as secondary criterion.</span></div>
<div class="line"><span class="lineno"> 9750</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 9751</span>        <span class="keywordflow">if</span> (cmp_result == 0) {</div>
<div class="line"><span class="lineno"> 9752</span>            cmp_result = strcmp(<a class="code hl_class" href="classa.html">a</a>-&gt;file_name, b-&gt;file_name);</div>
<div class="line"><span class="lineno"> 9753</span>        }</div>
<div class="line"><span class="lineno"> 9754</span> </div>
<div class="line"><span class="lineno"> 9755</span>        <span class="comment">/* For descending order, invert result */</span></div>
<div class="line"><span class="lineno"> 9756</span>        <span class="keywordflow">return</span> (query_string[1] == <span class="charliteral">&#39;d&#39;</span>) ? -cmp_result : cmp_result;</div>
<div class="line"><span class="lineno"> 9757</span>    }</div>
<div class="line"><span class="lineno"> 9758</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9759</span>}</div>
<div class="ttc" id="aclassa_html"><div class="ttname"><a href="classa.html">a</a></div></div>
<div class="ttc" id="acurl_8h_html_a7d68018e95e3d4e6b703538ac1c8c411"><div class="ttname"><a href="curl_8h.html#a7d68018e95e3d4e6b703538ac1c8c411">arg</a></div><div class="ttdeci">CURL_EXTERN int void * arg</div><div class="ttdef"><b>Definition</b> <a href="curl_8h_source.html#l02622">curl.h:2622</a></div></div>
<div class="ttc" id="astructde_html"><div class="ttname"><a href="structde.html">de</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02577">civetweb.c:2577</a></div></div>
<div class="ttc" id="astructde_html_ac819ba780b7179da19a396bd296bd258"><div class="ttname"><a href="structde.html#ac819ba780b7179da19a396bd296bd258">de::file</a></div><div class="ttdeci">struct mg_file_stat file</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02579">civetweb.c:2579</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="curl_8h_source.html#l02622">arg</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>.</p>

</div>
</div>
<a id="a34c01d95bd26a8b8be2db7cd87efe701" name="a34c01d95bd26a8b8be2db7cd87efe701"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34c01d95bd26a8b8be2db7cd87efe701">&#9670;&#160;</a></span>connect_socket()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int connect_socket </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>host</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>port</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>use_ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__error__data.html">mg_error_data</a> *</td>          <td class="paramname"><span class="paramname"><em>error</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a> *</td>          <td class="paramname"><span class="paramname"><em>sock</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionusa.html">usa</a> *</td>          <td class="paramname"><span class="paramname"><em>sa</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09287">9287</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9296</span>{</div>
<div class="line"><span class="lineno"> 9297</span>    <span class="keywordtype">int</span> ip_ver = 0;</div>
<div class="line"><span class="lineno"> 9298</span>    <span class="keywordtype">int</span> conn_ret = -1;</div>
<div class="line"><span class="lineno"> 9299</span>    <span class="keywordtype">int</span> sockerr = 0;</div>
<div class="line"><span class="lineno"> 9300</span>    *sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno"> 9301</span>    memset(sa, 0, <span class="keyword">sizeof</span>(*sa));</div>
<div class="line"><span class="lineno"> 9302</span> </div>
<div class="line"><span class="lineno"> 9303</span>    <span class="keywordflow">if</span> (host == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9304</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9305</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eac88d510f7057b262ab4931fa17bd12d8">MG_ERROR_DATA_CODE_INVALID_PARAM</a>;</div>
<div class="line"><span class="lineno"> 9306</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 9307</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno"> 9308</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno"> 9309</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno"> 9310</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9311</span>                        <span class="stringliteral">&quot;NULL host&quot;</span>);</div>
<div class="line"><span class="lineno"> 9312</span>        }</div>
<div class="line"><span class="lineno"> 9313</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9314</span>    }</div>
<div class="line"><span class="lineno"> 9315</span> </div>
<div class="line"><span class="lineno"> 9316</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno"> 9317</span>    <span class="keywordflow">if</span> (port == -99) {</div>
<div class="line"><span class="lineno"> 9318</span>        <span class="comment">/* Unix domain socket */</span></div>
<div class="line"><span class="lineno"> 9319</span>        <span class="keywordtype">size_t</span> hostlen = strlen(host);</div>
<div class="line"><span class="lineno"> 9320</span>        <span class="keywordflow">if</span> (hostlen &gt;= <span class="keyword">sizeof</span>(sa-&gt;sun.sun_path)) {</div>
<div class="line"><span class="lineno"> 9321</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9322</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eac88d510f7057b262ab4931fa17bd12d8">MG_ERROR_DATA_CODE_INVALID_PARAM</a>;</div>
<div class="line"><span class="lineno"> 9323</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 9324</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno"> 9325</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno"> 9326</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno"> 9327</span>                            <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9328</span>                            <span class="stringliteral">&quot;host length exceeds limit&quot;</span>);</div>
<div class="line"><span class="lineno"> 9329</span>            }</div>
<div class="line"><span class="lineno"> 9330</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9331</span>        }</div>
<div class="line"><span class="lineno"> 9332</span>    } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 9333</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9334</span>        <span class="keywordflow">if</span> ((port &lt;= 0) || !<a class="code hl_function" href="#ab0cba7d970883b21a4db625c33cba9ac">is_valid_port</a>((<span class="keywordtype">unsigned</span>)port)) {</div>
<div class="line"><span class="lineno"> 9335</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9336</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eac88d510f7057b262ab4931fa17bd12d8">MG_ERROR_DATA_CODE_INVALID_PARAM</a>;</div>
<div class="line"><span class="lineno"> 9337</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 9338</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno"> 9339</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno"> 9340</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno"> 9341</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9342</span>                        <span class="stringliteral">&quot;invalid port&quot;</span>);</div>
<div class="line"><span class="lineno"> 9343</span>        }</div>
<div class="line"><span class="lineno"> 9344</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9345</span>    }</div>
<div class="line"><span class="lineno"> 9346</span> </div>
<div class="line"><span class="lineno"> 9347</span><span class="preprocessor">#if !defined(NO_SSL) &amp;&amp; !defined(USE_MBEDTLS) &amp;&amp; !defined(NO_SSL_DL)</span></div>
<div class="line"><span class="lineno"> 9348</span><span class="preprocessor">#if defined(OPENSSL_API_1_1) || defined(OPENSSL_API_3_0)</span></div>
<div class="line"><span class="lineno"> 9349</span>    <span class="keywordflow">if</span> (use_ssl &amp;&amp; (TLS_client_method == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 9350</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9351</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea352663dbd53fd8f4dfcf80887961c7e4">MG_ERROR_DATA_CODE_INIT_LIBRARY_FAILED</a>;</div>
<div class="line"><span class="lineno"> 9352</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 9353</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno"> 9354</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno"> 9355</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno"> 9356</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9357</span>                        <span class="stringliteral">&quot;SSL is not initialized&quot;</span>);</div>
<div class="line"><span class="lineno"> 9358</span>        }</div>
<div class="line"><span class="lineno"> 9359</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9360</span>    }</div>
<div class="line"><span class="lineno"> 9361</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 9362</span>    <span class="keywordflow">if</span> (use_ssl &amp;&amp; (SSLv23_client_method == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 9363</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != 0) {</div>
<div class="line"><span class="lineno"> 9364</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea352663dbd53fd8f4dfcf80887961c7e4">MG_ERROR_DATA_CODE_INIT_LIBRARY_FAILED</a>;</div>
<div class="line"><span class="lineno"> 9365</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 9366</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno"> 9367</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno"> 9368</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno"> 9369</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9370</span>                        <span class="stringliteral">&quot;SSL is not initialized&quot;</span>);</div>
<div class="line"><span class="lineno"> 9371</span>        }</div>
<div class="line"><span class="lineno"> 9372</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9373</span>    }</div>
<div class="line"><span class="lineno"> 9374</span><span class="preprocessor">#endif </span><span class="comment">/* OPENSSL_API_1_1 || OPENSSL_API_3_0*/</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 9375</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 9376</span>    (void)use_ssl;</div>
<div class="line"><span class="lineno"> 9377</span><span class="preprocessor">#endif </span><span class="comment">/* NO SSL */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 9378</span> </div>
<div class="line"><span class="lineno"> 9379</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno"> 9380</span>    <span class="keywordflow">if</span> (port == -99) {</div>
<div class="line"><span class="lineno"> 9381</span>        <span class="keywordtype">size_t</span> hostlen = strlen(host);</div>
<div class="line"><span class="lineno"> 9382</span>        <span class="comment">/* check (hostlen &lt; sizeof(sun.sun_path)) already passed above */</span></div>
<div class="line"><span class="lineno"> 9383</span>        ip_ver = -99;</div>
<div class="line"><span class="lineno"> 9384</span>        sa-&gt;sun.sun_family = AF_UNIX;</div>
<div class="line"><span class="lineno"> 9385</span>        memset(sa-&gt;sun.sun_path, 0, <span class="keyword">sizeof</span>(sa-&gt;sun.sun_path));</div>
<div class="line"><span class="lineno"> 9386</span>        memcpy(sa-&gt;sun.sun_path, host, hostlen);</div>
<div class="line"><span class="lineno"> 9387</span>    } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 9388</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9389</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a68fa0720ca91d2de27f7770afa229002">mg_inet_pton</a>(AF_INET, host, &amp;sa-&gt;<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>, <span class="keyword">sizeof</span>(sa-&gt;<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>), 1)) {</div>
<div class="line"><span class="lineno"> 9390</span>        sa-&gt;<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_port = htons((uint16_t)port);</div>
<div class="line"><span class="lineno"> 9391</span>        ip_ver = 4;</div>
<div class="line"><span class="lineno"> 9392</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno"> 9393</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="#a68fa0720ca91d2de27f7770afa229002">mg_inet_pton</a>(AF_INET6, host, &amp;sa-&gt;sin6, <span class="keyword">sizeof</span>(sa-&gt;sin6), 1)) {</div>
<div class="line"><span class="lineno"> 9394</span>        sa-&gt;sin6.sin6_port = htons((uint16_t)port);</div>
<div class="line"><span class="lineno"> 9395</span>        ip_ver = 6;</div>
<div class="line"><span class="lineno"> 9396</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (host[0] == <span class="charliteral">&#39;[&#39;</span>) {</div>
<div class="line"><span class="lineno"> 9397</span>        <span class="comment">/* While getaddrinfo on Windows will work with [::1],</span></div>
<div class="line"><span class="lineno"> 9398</span><span class="comment">         * getaddrinfo on Linux only works with ::1 (without []). */</span></div>
<div class="line"><span class="lineno"> 9399</span>        <span class="keywordtype">size_t</span> l = strlen(host + 1);</div>
<div class="line"><span class="lineno"> 9400</span>        <span class="keywordtype">char</span> *h = (l &gt; 1) ? <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(host + 1, ctx) : <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 9401</span>        <span class="keywordflow">if</span> (h) {</div>
<div class="line"><span class="lineno"> 9402</span>            h[l - 1] = 0;</div>
<div class="line"><span class="lineno"> 9403</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#a68fa0720ca91d2de27f7770afa229002">mg_inet_pton</a>(AF_INET6, h, &amp;sa-&gt;sin6, <span class="keyword">sizeof</span>(sa-&gt;sin6), 0)) {</div>
<div class="line"><span class="lineno"> 9404</span>                sa-&gt;sin6.sin6_port = htons((uint16_t)port);</div>
<div class="line"><span class="lineno"> 9405</span>                ip_ver = 6;</div>
<div class="line"><span class="lineno"> 9406</span>            }</div>
<div class="line"><span class="lineno"> 9407</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(h);</div>
<div class="line"><span class="lineno"> 9408</span>        }</div>
<div class="line"><span class="lineno"> 9409</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9410</span>    }</div>
<div class="line"><span class="lineno"> 9411</span> </div>
<div class="line"><span class="lineno"> 9412</span>    <span class="keywordflow">if</span> (ip_ver == 0) {</div>
<div class="line"><span class="lineno"> 9413</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9414</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead55df55a4cb29a0171081362e2ba6e2e">MG_ERROR_DATA_CODE_HOST_NOT_FOUND</a>;</div>
<div class="line"><span class="lineno"> 9415</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 9416</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno"> 9417</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno"> 9418</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno"> 9419</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9420</span>                        <span class="stringliteral">&quot;host not found&quot;</span>);</div>
<div class="line"><span class="lineno"> 9421</span>        }</div>
<div class="line"><span class="lineno"> 9422</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9423</span>    }</div>
<div class="line"><span class="lineno"> 9424</span> </div>
<div class="line"><span class="lineno"> 9425</span>    <span class="keywordflow">if</span> (ip_ver == 4) {</div>
<div class="line"><span class="lineno"> 9426</span>        *sock = <a class="code hl_struct" href="structsocket.html">socket</a>(PF_INET, SOCK_STREAM, 0);</div>
<div class="line"><span class="lineno"> 9427</span>    }</div>
<div class="line"><span class="lineno"> 9428</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno"> 9429</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip_ver == 6) {</div>
<div class="line"><span class="lineno"> 9430</span>        *sock = <a class="code hl_struct" href="structsocket.html">socket</a>(PF_INET6, SOCK_STREAM, 0);</div>
<div class="line"><span class="lineno"> 9431</span>    }</div>
<div class="line"><span class="lineno"> 9432</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9433</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno"> 9434</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip_ver == -99) {</div>
<div class="line"><span class="lineno"> 9435</span>        *sock = <a class="code hl_struct" href="structsocket.html">socket</a>(AF_UNIX, SOCK_STREAM, 0);</div>
<div class="line"><span class="lineno"> 9436</span>    }</div>
<div class="line"><span class="lineno"> 9437</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9438</span> </div>
<div class="line"><span class="lineno"> 9439</span>    <span class="keywordflow">if</span> (*sock == <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>) {</div>
<div class="line"><span class="lineno"> 9440</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9441</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea4ec7bbc93f6f6d5d1f91b2bda132b7f6">MG_ERROR_DATA_CODE_OS_ERROR</a>;</div>
<div class="line"><span class="lineno"> 9442</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno"> 9443</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 9444</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno"> 9445</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno"> 9446</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno"> 9447</span>                        <span class="stringliteral">&quot;socket(): %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9448</span>                        strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 9449</span>        }</div>
<div class="line"><span class="lineno"> 9450</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9451</span>    }</div>
<div class="line"><span class="lineno"> 9452</span> </div>
<div class="line"><span class="lineno"> 9453</span>    <span class="keywordflow">if</span> (0 != <a class="code hl_function" href="#a145cf727fe064c50f8101a6650495a61">set_non_blocking_mode</a>(*sock)) {</div>
<div class="line"><span class="lineno"> 9454</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9455</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea4ec7bbc93f6f6d5d1f91b2bda132b7f6">MG_ERROR_DATA_CODE_OS_ERROR</a>;</div>
<div class="line"><span class="lineno"> 9456</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno"> 9457</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 9458</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno"> 9459</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno"> 9460</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno"> 9461</span>                        <span class="stringliteral">&quot;Cannot set socket to non-blocking: %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9462</span>                        strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 9463</span>        }</div>
<div class="line"><span class="lineno"> 9464</span>        <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(*sock);</div>
<div class="line"><span class="lineno"> 9465</span>        *sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno"> 9466</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9467</span>    }</div>
<div class="line"><span class="lineno"> 9468</span> </div>
<div class="line"><span class="lineno"> 9469</span>    <a class="code hl_function" href="#aea8c64184a00214c2f457d5e30f89478">set_close_on_exec</a>(*sock, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ctx);</div>
<div class="line"><span class="lineno"> 9470</span> </div>
<div class="line"><span class="lineno"> 9471</span>    <span class="keywordflow">if</span> (ip_ver == 4) {</div>
<div class="line"><span class="lineno"> 9472</span>        <span class="comment">/* connected with IPv4 */</span></div>
<div class="line"><span class="lineno"> 9473</span>        conn_ret = connect(*sock,</div>
<div class="line"><span class="lineno"> 9474</span>                           (<span class="keyword">struct</span> sockaddr *)((<span class="keywordtype">void</span> *)&amp;sa-&gt;<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>),</div>
<div class="line"><span class="lineno"> 9475</span>                           <span class="keyword">sizeof</span>(sa-&gt;<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>));</div>
<div class="line"><span class="lineno"> 9476</span>    }</div>
<div class="line"><span class="lineno"> 9477</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno"> 9478</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip_ver == 6) {</div>
<div class="line"><span class="lineno"> 9479</span>        <span class="comment">/* connected with IPv6 */</span></div>
<div class="line"><span class="lineno"> 9480</span>        conn_ret = connect(*sock,</div>
<div class="line"><span class="lineno"> 9481</span>                           (<span class="keyword">struct</span> sockaddr *)((<span class="keywordtype">void</span> *)&amp;sa-&gt;sin6),</div>
<div class="line"><span class="lineno"> 9482</span>                           <span class="keyword">sizeof</span>(sa-&gt;sin6));</div>
<div class="line"><span class="lineno"> 9483</span>    }</div>
<div class="line"><span class="lineno"> 9484</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9485</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno"> 9486</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip_ver == -99) {</div>
<div class="line"><span class="lineno"> 9487</span>        <span class="comment">/* connected to domain socket */</span></div>
<div class="line"><span class="lineno"> 9488</span>        conn_ret = connect(*sock,</div>
<div class="line"><span class="lineno"> 9489</span>                           (<span class="keyword">struct</span> sockaddr *)((<span class="keywordtype">void</span> *)&amp;sa-&gt;sun),</div>
<div class="line"><span class="lineno"> 9490</span>                           <span class="keyword">sizeof</span>(sa-&gt;sun));</div>
<div class="line"><span class="lineno"> 9491</span>    }</div>
<div class="line"><span class="lineno"> 9492</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9493</span> </div>
<div class="line"><span class="lineno"> 9494</span>    <span class="keywordflow">if</span> (conn_ret != 0) {</div>
<div class="line"><span class="lineno"> 9495</span>        sockerr = <a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno"> 9496</span>    }</div>
<div class="line"><span class="lineno"> 9497</span> </div>
<div class="line"><span class="lineno"> 9498</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 9499</span>    <span class="keywordflow">if</span> ((conn_ret != 0) &amp;&amp; (sockerr == WSAEWOULDBLOCK)) {</div>
<div class="line"><span class="lineno"> 9500</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 9501</span>    <span class="keywordflow">if</span> ((conn_ret != 0) &amp;&amp; (sockerr == EINPROGRESS)) {</div>
<div class="line"><span class="lineno"> 9502</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9503</span>        <span class="comment">/* Data for getsockopt */</span></div>
<div class="line"><span class="lineno"> 9504</span>        <span class="keywordtype">void</span> *psockerr = &amp;sockerr;</div>
<div class="line"><span class="lineno"> 9505</span>        <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno"> 9506</span> </div>
<div class="line"><span class="lineno"> 9507</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 9508</span>        <span class="keywordtype">int</span> len = (int)<span class="keyword">sizeof</span>(sockerr);</div>
<div class="line"><span class="lineno"> 9509</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 9510</span>        socklen_t len = (socklen_t)<span class="keyword">sizeof</span>(sockerr);</div>
<div class="line"><span class="lineno"> 9511</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9512</span> </div>
<div class="line"><span class="lineno"> 9513</span>        <span class="comment">/* Data for poll */</span></div>
<div class="line"><span class="lineno"> 9514</span>        <span class="keyword">struct </span><a class="code hl_define" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> pfd[1];</div>
<div class="line"><span class="lineno"> 9515</span>        <span class="keywordtype">int</span> pollres;</div>
<div class="line"><span class="lineno"> 9516</span>        <span class="keywordtype">int</span> ms_wait = 10000; <span class="comment">/* 10 second timeout */</span></div>
<div class="line"><span class="lineno"> 9517</span>        <a class="code hl_typedef" href="#ac751248c6cb5f0bce10051d41a22d964">stop_flag_t</a> nonstop;</div>
<div class="line"><span class="lineno"> 9518</span>        <a class="code hl_define" href="#a5cd88c4a6b9186f77507c50a6ae6625f">STOP_FLAG_ASSIGN</a>(&amp;nonstop, 0);</div>
<div class="line"><span class="lineno"> 9519</span> </div>
<div class="line"><span class="lineno"> 9520</span>        <span class="comment">/* For a non-blocking socket, the connect sequence is:</span></div>
<div class="line"><span class="lineno"> 9521</span><span class="comment">         * 1) call connect (will not block)</span></div>
<div class="line"><span class="lineno"> 9522</span><span class="comment">         * 2) wait until the socket is ready for writing (select or poll)</span></div>
<div class="line"><span class="lineno"> 9523</span><span class="comment">         * 3) check connection state with getsockopt</span></div>
<div class="line"><span class="lineno"> 9524</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 9525</span>        pfd[0].fd = *sock;</div>
<div class="line"><span class="lineno"> 9526</span>        pfd[0].events = POLLOUT;</div>
<div class="line"><span class="lineno"> 9527</span>        pollres = <a class="code hl_function" href="#a3b9904a2b6ed6d472f5ee35c7c588863">mg_poll</a>(pfd, 1, ms_wait, ctx ? &amp;(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>) : &amp;nonstop);</div>
<div class="line"><span class="lineno"> 9528</span> </div>
<div class="line"><span class="lineno"> 9529</span>        <span class="keywordflow">if</span> (pollres != 1) {</div>
<div class="line"><span class="lineno"> 9530</span>            <span class="comment">/* Not connected */</span></div>
<div class="line"><span class="lineno"> 9531</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9532</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eab3dad203f6b87c5def4c7bc16085d8b1">MG_ERROR_DATA_CODE_CONNECT_TIMEOUT</a>;</div>
<div class="line"><span class="lineno"> 9533</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 9534</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno"> 9535</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno"> 9536</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno"> 9537</span>                            <span class="stringliteral">&quot;connect(%s:%d): timeout&quot;</span>,</div>
<div class="line"><span class="lineno"> 9538</span>                            host,</div>
<div class="line"><span class="lineno"> 9539</span>                            port);</div>
<div class="line"><span class="lineno"> 9540</span>            }</div>
<div class="line"><span class="lineno"> 9541</span>            <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(*sock);</div>
<div class="line"><span class="lineno"> 9542</span>            *sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno"> 9543</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9544</span>        }</div>
<div class="line"><span class="lineno"> 9545</span> </div>
<div class="line"><span class="lineno"> 9546</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 9547</span>        ret = getsockopt(*sock, SOL_SOCKET, SO_ERROR, (<span class="keywordtype">char</span> *)psockerr, &amp;len);</div>
<div class="line"><span class="lineno"> 9548</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 9549</span>        ret = getsockopt(*sock, SOL_SOCKET, SO_ERROR, psockerr, &amp;len);</div>
<div class="line"><span class="lineno"> 9550</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9551</span> </div>
<div class="line"><span class="lineno"> 9552</span>        <span class="keywordflow">if</span> ((ret == 0) &amp;&amp; (sockerr == 0)) {</div>
<div class="line"><span class="lineno"> 9553</span>            conn_ret = 0;</div>
<div class="line"><span class="lineno"> 9554</span>        }</div>
<div class="line"><span class="lineno"> 9555</span>    }</div>
<div class="line"><span class="lineno"> 9556</span> </div>
<div class="line"><span class="lineno"> 9557</span>    <span class="keywordflow">if</span> (conn_ret != 0) {</div>
<div class="line"><span class="lineno"> 9558</span>        <span class="comment">/* Not connected */</span></div>
<div class="line"><span class="lineno"> 9559</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9560</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea5b03c913ece04130cb582c88ae994f69">MG_ERROR_DATA_CODE_CONNECT_FAILED</a>;</div>
<div class="line"><span class="lineno"> 9561</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno"> 9562</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 9563</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno"> 9564</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno"> 9565</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno"> 9566</span>                        <span class="stringliteral">&quot;connect(%s:%d): error %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9567</span>                        host,</div>
<div class="line"><span class="lineno"> 9568</span>                        port,</div>
<div class="line"><span class="lineno"> 9569</span>                        strerror(sockerr));</div>
<div class="line"><span class="lineno"> 9570</span>        }</div>
<div class="line"><span class="lineno"> 9571</span>        <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(*sock);</div>
<div class="line"><span class="lineno"> 9572</span>        *sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno"> 9573</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9574</span>    }</div>
<div class="line"><span class="lineno"> 9575</span> </div>
<div class="line"><span class="lineno"> 9576</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 9577</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a3b9904a2b6ed6d472f5ee35c7c588863"><div class="ttname"><a href="#a3b9904a2b6ed6d472f5ee35c7c588863">mg_poll</a></div><div class="ttdeci">static int mg_poll(struct mg_pollfd *pfd, unsigned int n, int milliseconds, const stop_flag_t *stop_flag)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l05938">civetweb.c:5938</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a5cd88c4a6b9186f77507c50a6ae6625f"><div class="ttname"><a href="#a5cd88c4a6b9186f77507c50a6ae6625f">STOP_FLAG_ASSIGN</a></div><div class="ttdeci">#define STOP_FLAG_ASSIGN(f, v)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02324">civetweb.c:2324</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a68fa0720ca91d2de27f7770afa229002"><div class="ttname"><a href="#a68fa0720ca91d2de27f7770afa229002">mg_inet_pton</a></div><div class="ttdeci">static int mg_inet_pton(int af, const char *src, void *dst, size_t dstlen, int resolve_src)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09246">civetweb.c:9246</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ab0cba7d970883b21a4db625c33cba9ac"><div class="ttname"><a href="#ab0cba7d970883b21a4db625c33cba9ac">is_valid_port</a></div><div class="ttdeci">static int is_valid_port(unsigned long port)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09239">civetweb.c:9239</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac220e3a97f765b599bc532d6c3f4a755"><div class="ttname"><a href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a></div><div class="ttdeci">#define mg_pollfd</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00948">civetweb.c:948</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac751248c6cb5f0bce10051d41a22d964"><div class="ttname"><a href="#ac751248c6cb5f0bce10051d41a22d964">stop_flag_t</a></div><div class="ttdeci">int volatile stop_flag_t</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02321">civetweb.c:2321</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea352663dbd53fd8f4dfcf80887961c7e4"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea352663dbd53fd8f4dfcf80887961c7e4">MG_ERROR_DATA_CODE_INIT_LIBRARY_FAILED</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_INIT_LIBRARY_FAILED</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01758">civetweb.h:1758</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea4ec7bbc93f6f6d5d1f91b2bda132b7f6"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea4ec7bbc93f6f6d5d1f91b2bda132b7f6">MG_ERROR_DATA_CODE_OS_ERROR</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_OS_ERROR</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01761">civetweb.h:1761</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea5b03c913ece04130cb582c88ae994f69"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea5b03c913ece04130cb582c88ae994f69">MG_ERROR_DATA_CODE_CONNECT_FAILED</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_CONNECT_FAILED</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01785">civetweb.h:1785</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9eab3dad203f6b87c5def4c7bc16085d8b1"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eab3dad203f6b87c5def4c7bc16085d8b1">MG_ERROR_DATA_CODE_CONNECT_TIMEOUT</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_CONNECT_TIMEOUT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01782">civetweb.h:1782</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9eac88d510f7057b262ab4931fa17bd12d8"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eac88d510f7057b262ab4931fa17bd12d8">MG_ERROR_DATA_CODE_INVALID_PARAM</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_INVALID_PARAM</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01737">civetweb.h:1737</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ead55df55a4cb29a0171081362e2ba6e2e"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead55df55a4cb29a0171081362e2ba6e2e">MG_ERROR_DATA_CODE_HOST_NOT_FOUND</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_HOST_NOT_FOUND</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01779">civetweb.h:1779</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lundump_8c_html_a6776ffdd5e2abf4119b1d45731e9e668"><div class="ttname"><a href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a></div><div class="ttdeci">static void error(LoadState *S, const char *why)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lundump_8c_source.html#l00036">lua-5.1.5/src/lundump.c:36</a></div></div>
<div class="ttc" id="astructmg__context_html_a733a0204e86fcf92d016bd08c9db2691"><div class="ttname"><a href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">mg_context::stop_flag</a></div><div class="ttdeci">stop_flag_t stop_flag</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02373">civetweb.c:2373</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00043">CIVETWEB_API</a>, <a class="el" href="civetweb_8c_source.html#l00917">closesocket</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="lua-5_81_85_2src_2lundump_8c_source.html#l00036">error()</a>, <a class="el" href="civetweb_8c_source.html#l00925">INVALID_SOCKET</a>, <a class="el" href="civetweb_8c_source.html#l09239">is_valid_port()</a>, <a class="el" href="civetweb_8h_source.html#l01785">MG_ERROR_DATA_CODE_CONNECT_FAILED</a>, <a class="el" href="civetweb_8h_source.html#l01782">MG_ERROR_DATA_CODE_CONNECT_TIMEOUT</a>, <a class="el" href="civetweb_8h_source.html#l01779">MG_ERROR_DATA_CODE_HOST_NOT_FOUND</a>, <a class="el" href="civetweb_8h_source.html#l01758">MG_ERROR_DATA_CODE_INIT_LIBRARY_FAILED</a>, <a class="el" href="civetweb_8h_source.html#l01737">MG_ERROR_DATA_CODE_INVALID_PARAM</a>, <a class="el" href="civetweb_8h_source.html#l01761">MG_ERROR_DATA_CODE_OS_ERROR</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l09246">mg_inet_pton()</a>, <a class="el" href="civetweb_8c_source.html#l05938">mg_poll()</a>, <a class="el" href="civetweb_8c_source.html#l00948">mg_pollfd</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l03062">mg_strdup_ctx()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l05677">set_close_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l05876">set_non_blocking_mode()</a>, <a class="el" href="civetweb_8c_source.html#l01834">usa::sin</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, and <a class="el" href="civetweb_8c_source.html#l02324">STOP_FLAG_ASSIGN</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>.</p>

</div>
</div>
<a id="ac715f770ccb10deba796a43cb10cfd46" name="ac715f770ccb10deba796a43cb10cfd46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac715f770ccb10deba796a43cb10cfd46">&#9670;&#160;</a></span>construct_etag()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void construct_etag </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>buf_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *</td>          <td class="paramname"><span class="paramname"><em>filestat</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10181">10181</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10182</span>{</div>
<div class="line"><span class="lineno">10183</span>    <span class="keywordflow">if</span> ((filestat != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (buf != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">10184</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">10185</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* All calls to construct_etag use 64 byte buffer */</span></div>
<div class="line"><span class="lineno">10186</span>                    buf,</div>
<div class="line"><span class="lineno">10187</span>                    buf_len,</div>
<div class="line"><span class="lineno">10188</span>                    <span class="stringliteral">&quot;\&quot;%lx.%&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a> <span class="stringliteral">&quot;\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">10189</span>                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)filestat-&gt;<a class="code hl_variable" href="structmg__file__stat.html#aa767e15073ca34ce0bd9fdcfe05e6ddc">last_modified</a>,</div>
<div class="line"><span class="lineno">10190</span>                    filestat-&gt;<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a>);</div>
<div class="line"><span class="lineno">10191</span>    }</div>
<div class="line"><span class="lineno">10192</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a57e353d6ce48ab7d414d094961d5e474"><div class="ttname"><a href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a></div><div class="ttdeci">#define INT64_FMT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00926">civetweb.c:926</a></div></div>
<div class="ttc" id="astructmg__file__stat_html_a2a9092bc55b16d45e33fb42f6f924e16"><div class="ttname"><a href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">mg_file_stat::size</a></div><div class="ttdeci">uint64_t size</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01871">civetweb.c:1871</a></div></div>
<div class="ttc" id="astructmg__file__stat_html_aa767e15073ca34ce0bd9fdcfe05e6ddc"><div class="ttname"><a href="structmg__file__stat.html#aa767e15073ca34ce0bd9fdcfe05e6ddc">mg_file_stat::last_modified</a></div><div class="ttdeci">time_t last_modified</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01872">civetweb.c:1872</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00926">INT64_FMT</a>, <a class="el" href="civetweb_8c_source.html#l01872">mg_file_stat::last_modified</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l01871">mg_file_stat::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10483">handle_not_modified_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, and <a class="el" href="civetweb_8c_source.html#l10468">is_not_modified()</a>.</p>

</div>
</div>
<a id="a02b40bbcf0b155e706e5e1eb6b53309e" name="a02b40bbcf0b155e706e5e1eb6b53309e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02b40bbcf0b155e706e5e1eb6b53309e">&#9670;&#160;</a></span>consume_socket()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int consume_socket </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsocket.html">socket</a> *</td>          <td class="paramname"><span class="paramname"><em>sp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>thread_index</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19624">19624</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19625</span>{</div>
<div class="line"><span class="lineno">19626</span>    (void)thread_index;</div>
<div class="line"><span class="lineno">19627</span> </div>
<div class="line"><span class="lineno">19628</span>    (void)pthread_mutex_lock(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">thread_mutex</a>);</div>
<div class="line"><span class="lineno">19629</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;going idle&quot;</span>);</div>
<div class="line"><span class="lineno">19630</span> </div>
<div class="line"><span class="lineno">19631</span>    <span class="comment">/* If the queue is empty, wait. We&#39;re idle at this point. */</span></div>
<div class="line"><span class="lineno">19632</span>    <span class="keywordflow">while</span> ((ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a6df1d217787a1f213ddb9873f545d23f">sq_head</a> == ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">sq_tail</a>)</div>
<div class="line"><span class="lineno">19633</span>           &amp;&amp; (<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>))) {</div>
<div class="line"><span class="lineno">19634</span>        pthread_cond_wait(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aad49398eacc039c312d58c55530c65fa">sq_full</a>, &amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">thread_mutex</a>);</div>
<div class="line"><span class="lineno">19635</span>    }</div>
<div class="line"><span class="lineno">19636</span> </div>
<div class="line"><span class="lineno">19637</span>    <span class="comment">/* If we&#39;re stopping, sq_head may be equal to sq_tail. */</span></div>
<div class="line"><span class="lineno">19638</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a6df1d217787a1f213ddb9873f545d23f">sq_head</a> &gt; ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">sq_tail</a>) {</div>
<div class="line"><span class="lineno">19639</span>        <span class="comment">/* Copy socket from the queue and increment tail */</span></div>
<div class="line"><span class="lineno">19640</span>        *sp = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a49b598c1205bc368042ca530011e3316">squeue</a>[ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">sq_tail</a> % ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ae906ea24151aba96333859c9b759ccc1">sq_size</a>];</div>
<div class="line"><span class="lineno">19641</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">sq_tail</a>++;</div>
<div class="line"><span class="lineno">19642</span> </div>
<div class="line"><span class="lineno">19643</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;grabbed socket %d, going busy&quot;</span>, sp ? sp-&gt;<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a> : -1);</div>
<div class="line"><span class="lineno">19644</span> </div>
<div class="line"><span class="lineno">19645</span>        <span class="comment">/* Wrap pointers if needed */</span></div>
<div class="line"><span class="lineno">19646</span>        <span class="keywordflow">while</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">sq_tail</a> &gt; ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ae906ea24151aba96333859c9b759ccc1">sq_size</a>) {</div>
<div class="line"><span class="lineno">19647</span>            ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">sq_tail</a> -= ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ae906ea24151aba96333859c9b759ccc1">sq_size</a>;</div>
<div class="line"><span class="lineno">19648</span>            ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a6df1d217787a1f213ddb9873f545d23f">sq_head</a> -= ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ae906ea24151aba96333859c9b759ccc1">sq_size</a>;</div>
<div class="line"><span class="lineno">19649</span>        }</div>
<div class="line"><span class="lineno">19650</span>    }</div>
<div class="line"><span class="lineno">19651</span> </div>
<div class="line"><span class="lineno">19652</span>    (void)pthread_cond_signal(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a3260d5fc8e16e35026d7d2bbcb10abf5">sq_empty</a>);</div>
<div class="line"><span class="lineno">19653</span>    (void)pthread_mutex_unlock(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">thread_mutex</a>);</div>
<div class="line"><span class="lineno">19654</span> </div>
<div class="line"><span class="lineno">19655</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>);</div>
<div class="line"><span class="lineno">19656</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a42c400d6feb7aa0de4280b0cf1c63fcc"><div class="ttname"><a href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a></div><div class="ttdeci">#define STOP_FLAG_IS_ZERO(f)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02322">civetweb.c:2322</a></div></div>
<div class="ttc" id="astructmg__context_html_a3260d5fc8e16e35026d7d2bbcb10abf5"><div class="ttname"><a href="structmg__context.html#a3260d5fc8e16e35026d7d2bbcb10abf5">mg_context::sq_empty</a></div><div class="ttdeci">pthread_cond_t sq_empty</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02392">civetweb.c:2392</a></div></div>
<div class="ttc" id="astructmg__context_html_a49b598c1205bc368042ca530011e3316"><div class="ttname"><a href="structmg__context.html#a49b598c1205bc368042ca530011e3316">mg_context::squeue</a></div><div class="ttdeci">struct socket * squeue</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02387">civetweb.c:2387</a></div></div>
<div class="ttc" id="astructmg__context_html_a6df1d217787a1f213ddb9873f545d23f"><div class="ttname"><a href="structmg__context.html#a6df1d217787a1f213ddb9873f545d23f">mg_context::sq_head</a></div><div class="ttdeci">volatile int sq_head</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02389">civetweb.c:2389</a></div></div>
<div class="ttc" id="astructmg__context_html_a95d32beab46e554567d9ebaab7a6b2f2"><div class="ttname"><a href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">mg_context::thread_mutex</a></div><div class="ttdeci">pthread_mutex_t thread_mutex</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02374">civetweb.c:2374</a></div></div>
<div class="ttc" id="astructmg__context_html_aad49398eacc039c312d58c55530c65fa"><div class="ttname"><a href="structmg__context.html#aad49398eacc039c312d58c55530c65fa">mg_context::sq_full</a></div><div class="ttdeci">pthread_cond_t sq_full</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02391">civetweb.c:2391</a></div></div>
<div class="ttc" id="astructmg__context_html_ad0b2da59bdd93d8eb819ef552025b654"><div class="ttname"><a href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">mg_context::sq_tail</a></div><div class="ttdeci">volatile int sq_tail</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02390">civetweb.c:2390</a></div></div>
<div class="ttc" id="astructmg__context_html_ae906ea24151aba96333859c9b759ccc1"><div class="ttname"><a href="structmg__context.html#ae906ea24151aba96333859c9b759ccc1">mg_context::sq_size</a></div><div class="ttdeci">int sq_size</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02394">civetweb.c:2394</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, <a class="el" href="civetweb_8c_source.html#l02392">mg_context::sq_empty</a>, <a class="el" href="civetweb_8c_source.html#l02391">mg_context::sq_full</a>, <a class="el" href="civetweb_8c_source.html#l02389">mg_context::sq_head</a>, <a class="el" href="civetweb_8c_source.html#l02394">mg_context::sq_size</a>, <a class="el" href="civetweb_8c_source.html#l02390">mg_context::sq_tail</a>, <a class="el" href="civetweb_8c_source.html#l02387">mg_context::squeue</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>, and <a class="el" href="civetweb_8c_source.html#l02374">mg_context::thread_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a6b18e8f2e8a8ae569d9582857bcc7c19" name="a6b18e8f2e8a8ae569d9582857bcc7c19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b18e8f2e8a8ae569d9582857bcc7c19">&#9670;&#160;</a></span>dav_lock_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dav_lock_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12802">12802</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12803</span>{</div>
<div class="line"><span class="lineno">12804</span>    <span class="comment">/* internal function - therefore conn is assumed to be valid */</span></div>
<div class="line"><span class="lineno">12805</span>    <span class="keywordtype">char</span> link_buf[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a> * 2]; <span class="comment">/* Path + server root */</span></div>
<div class="line"><span class="lineno">12806</span>    uint64_t new_locktime;</div>
<div class="line"><span class="lineno">12807</span>    <span class="keywordtype">int</span> lock_index = -1;</div>
<div class="line"><span class="lineno">12808</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">12809</span>    uint64_t LOCK_DURATION_NS =</div>
<div class="line"><span class="lineno">12810</span>        (uint64_t)(<a class="code hl_define" href="#a1531c1b87bf00f94782d1d45f2942803">LOCK_DURATION_S</a>) * (uint64_t)1000000000;</div>
<div class="line"><span class="lineno">12811</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structtwebdav__lock.html">twebdav_lock</a> *dav_lock = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#ad9abab27bb8fc8156d160de93bb08c30">webdav_lock</a>;</div>
<div class="line"><span class="lineno">12812</span> </div>
<div class="line"><span class="lineno">12813</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a> || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a>) {</div>
<div class="line"><span class="lineno">12814</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12815</span>    }</div>
<div class="line"><span class="lineno">12816</span>    <a class="code hl_function" href="#a81ef64a9ffadd917ddc7f4615cf5dc07">mg_get_request_link</a>(conn, link_buf, <span class="keyword">sizeof</span>(link_buf));</div>
<div class="line"><span class="lineno">12817</span> </div>
<div class="line"><span class="lineno">12818</span>    <span class="comment">/* const char *refresh = mg_get_header(conn, &quot;If&quot;); */</span></div>
<div class="line"><span class="lineno">12819</span>    <span class="comment">/* Link refresh should have an &quot;If&quot; header:</span></div>
<div class="line"><span class="lineno">12820</span><span class="comment">     * http://www.webdav.org/specs/rfc2518.html#n-example---refreshing-a-write-lock</span></div>
<div class="line"><span class="lineno">12821</span><span class="comment">     * But it seems Windows Explorer does not send them.</span></div>
<div class="line"><span class="lineno">12822</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">12823</span> </div>
<div class="line"><span class="lineno">12824</span>    <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">12825</span>    new_locktime = <a class="code hl_function" href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a>();</div>
<div class="line"><span class="lineno">12826</span> </div>
<div class="line"><span class="lineno">12827</span>    <span class="comment">/* Find a slot for a lock */</span></div>
<div class="line"><span class="lineno">12828</span>    <span class="keywordflow">while</span> (lock_index &lt; 0) {</div>
<div class="line"><span class="lineno">12829</span>        <span class="comment">/* find existing lock */</span></div>
<div class="line"><span class="lineno">12830</span>        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_define" href="#aec63256a14a3c1f92d2b8e01a466f718">NUM_WEBDAV_LOCKS</a>; i++) {</div>
<div class="line"><span class="lineno">12831</span>            <span class="keywordflow">if</span> (!strcmp(dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a>, link_buf)) {</div>
<div class="line"><span class="lineno">12832</span>                <span class="keywordflow">if</span> (!strcmp(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a>, dav_lock[i].user)) {</div>
<div class="line"><span class="lineno">12833</span>                    <span class="comment">/* locked by the same user */</span></div>
<div class="line"><span class="lineno">12834</span>                    dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#af3941c51ff4e7bfe1151f6404ae7e1c4">locktime</a> = new_locktime;</div>
<div class="line"><span class="lineno">12835</span>                    lock_index = i;</div>
<div class="line"><span class="lineno">12836</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">12837</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12838</span>                    <span class="comment">/* already locked by someone else */</span></div>
<div class="line"><span class="lineno">12839</span>                    <span class="keywordflow">if</span> (new_locktime</div>
<div class="line"><span class="lineno">12840</span>                        &gt; (dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#af3941c51ff4e7bfe1151f6404ae7e1c4">locktime</a> + LOCK_DURATION_NS)) {</div>
<div class="line"><span class="lineno">12841</span>                        <span class="comment">/* Lock expired */</span></div>
<div class="line"><span class="lineno">12842</span>                        dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a>[0] = 0;</div>
<div class="line"><span class="lineno">12843</span>                    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12844</span>                        <span class="comment">/* Lock still valid */</span></div>
<div class="line"><span class="lineno">12845</span>                        <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">12846</span>                        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 423, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Already locked&quot;</span>);</div>
<div class="line"><span class="lineno">12847</span>                        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12848</span>                    }</div>
<div class="line"><span class="lineno">12849</span>                }</div>
<div class="line"><span class="lineno">12850</span>            }</div>
<div class="line"><span class="lineno">12851</span>        }</div>
<div class="line"><span class="lineno">12852</span> </div>
<div class="line"><span class="lineno">12853</span>        <span class="comment">/* create new lock token */</span></div>
<div class="line"><span class="lineno">12854</span>        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_define" href="#aec63256a14a3c1f92d2b8e01a466f718">NUM_WEBDAV_LOCKS</a>; i++) {</div>
<div class="line"><span class="lineno">12855</span>            <span class="keywordflow">if</span> (dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a>[0] == 0) {</div>
<div class="line"><span class="lineno">12856</span>                <span class="keywordtype">char</span> <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>[32];</div>
<div class="line"><span class="lineno">12857</span>                dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#af3941c51ff4e7bfe1151f6404ae7e1c4">locktime</a> = <a class="code hl_function" href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a>();</div>
<div class="line"><span class="lineno">12858</span>                sprintf(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;%&quot;</span> <a class="code hl_define" href="#a21ef7c3a4e9f99f62cf64329f965d2ed">UINT64_FMT</a>, (uint64_t)dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#af3941c51ff4e7bfe1151f6404ae7e1c4">locktime</a>);</div>
<div class="line"><span class="lineno">12859</span>                <a class="code hl_function" href="#a9a1f27cd059fa56ead5cecaf7885582f">mg_md5</a>(dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#a40f964c56a8ec4f2397ab7f76f20850a">token</a>,</div>
<div class="line"><span class="lineno">12860</span>                       link_buf,</div>
<div class="line"><span class="lineno">12861</span>                       <span class="stringliteral">&quot;\x01&quot;</span>,</div>
<div class="line"><span class="lineno">12862</span>                       <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>,</div>
<div class="line"><span class="lineno">12863</span>                       <span class="stringliteral">&quot;\x01&quot;</span>,</div>
<div class="line"><span class="lineno">12864</span>                       conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a>,</div>
<div class="line"><span class="lineno">12865</span>                       <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">12866</span>                <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a>,</div>
<div class="line"><span class="lineno">12867</span>                           link_buf,</div>
<div class="line"><span class="lineno">12868</span>                           <span class="keyword">sizeof</span>(dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a>));</div>
<div class="line"><span class="lineno">12869</span>                <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#a10c1b2873c201b3f14167a5c367d3366">user</a>,</div>
<div class="line"><span class="lineno">12870</span>                           conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a>,</div>
<div class="line"><span class="lineno">12871</span>                           <span class="keyword">sizeof</span>(dav_lock[i].user));</div>
<div class="line"><span class="lineno">12872</span>                lock_index = i;</div>
<div class="line"><span class="lineno">12873</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">12874</span>            }</div>
<div class="line"><span class="lineno">12875</span>        }</div>
<div class="line"><span class="lineno">12876</span>        <span class="keywordflow">if</span> (lock_index &lt; 0) {</div>
<div class="line"><span class="lineno">12877</span>            <span class="comment">/* too many locks. Find oldest lock */</span></div>
<div class="line"><span class="lineno">12878</span>            uint64_t oldest_locktime = dav_lock[0].<a class="code hl_variable" href="structtwebdav__lock.html#af3941c51ff4e7bfe1151f6404ae7e1c4">locktime</a>;</div>
<div class="line"><span class="lineno">12879</span>            lock_index = 0;</div>
<div class="line"><span class="lineno">12880</span>            <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code hl_define" href="#aec63256a14a3c1f92d2b8e01a466f718">NUM_WEBDAV_LOCKS</a>; i++) {</div>
<div class="line"><span class="lineno">12881</span>                <span class="keywordflow">if</span> (dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#af3941c51ff4e7bfe1151f6404ae7e1c4">locktime</a> &lt; oldest_locktime) {</div>
<div class="line"><span class="lineno">12882</span>                    oldest_locktime = dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#af3941c51ff4e7bfe1151f6404ae7e1c4">locktime</a>;</div>
<div class="line"><span class="lineno">12883</span>                    lock_index = i;</div>
<div class="line"><span class="lineno">12884</span>                }</div>
<div class="line"><span class="lineno">12885</span>            }</div>
<div class="line"><span class="lineno">12886</span>            <span class="comment">/* invalidate oldest lock */</span></div>
<div class="line"><span class="lineno">12887</span>            dav_lock[lock_index].<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a>[0] = 0;</div>
<div class="line"><span class="lineno">12888</span>        }</div>
<div class="line"><span class="lineno">12889</span>    }</div>
<div class="line"><span class="lineno">12890</span>    <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">12891</span> </div>
<div class="line"><span class="lineno">12892</span>    <span class="comment">/* return 200 &quot;OK&quot; */</span></div>
<div class="line"><span class="lineno">12893</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">12894</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 200);</div>
<div class="line"><span class="lineno">12895</span>    <a class="code hl_function" href="#a229f03c60c42b8f390449a8e1324f22f">send_static_cache_header</a>(conn);</div>
<div class="line"><span class="lineno">12896</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">12897</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn,</div>
<div class="line"><span class="lineno">12898</span>                           <span class="stringliteral">&quot;Content-Type&quot;</span>,</div>
<div class="line"><span class="lineno">12899</span>                           <span class="stringliteral">&quot;application/xml; charset=utf-8&quot;</span>,</div>
<div class="line"><span class="lineno">12900</span>                           -1);</div>
<div class="line"><span class="lineno">12901</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Lock-Token&quot;</span>, dav_lock[lock_index].<a class="code hl_variable" href="structtwebdav__lock.html#a40f964c56a8ec4f2397ab7f76f20850a">token</a>, -1);</div>
<div class="line"><span class="lineno">12902</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">12903</span> </div>
<div class="line"><span class="lineno">12904</span>    <span class="comment">/* Content */</span></div>
<div class="line"><span class="lineno">12905</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">12906</span>              <span class="stringliteral">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;&quot;</span></div>
<div class="line"><span class="lineno">12907</span>              <span class="stringliteral">&quot;&lt;d:prop xmlns:d=\&quot;DAV:\&quot;&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12908</span>              <span class="stringliteral">&quot;     &lt;d:lockdiscovery&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12909</span>              <span class="stringliteral">&quot;       &lt;d:activelock&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12910</span>              <span class="stringliteral">&quot;         &lt;d:lockscope&gt;&lt;d:exclusive/&gt;&lt;/d:lockscope&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12911</span>              <span class="stringliteral">&quot;         &lt;d:locktype&gt;&lt;d:write/&gt;&lt;/d:locktype&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12912</span>              <span class="stringliteral">&quot;         &lt;d:owner&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12913</span>              <span class="stringliteral">&quot;           &lt;d:href&gt;%s&lt;/d:href&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12914</span>              <span class="stringliteral">&quot;         &lt;/d:owner&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12915</span>              <span class="stringliteral">&quot;         &lt;d:timeout&gt;Second-%u&lt;/d:timeout&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12916</span>              <span class="stringliteral">&quot;         &lt;d:locktoken&gt;&lt;d:href&gt;%s&lt;/d:href&gt;&lt;/d:locktoken&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12917</span>              <span class="stringliteral">&quot;         &lt;d:lockroot&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12918</span>              <span class="stringliteral">&quot;           &lt;d:href&gt;%s&lt;/d:href&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12919</span>              <span class="stringliteral">&quot;         &lt;/d:lockroot&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12920</span>              <span class="stringliteral">&quot;       &lt;/d:activelock&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12921</span>              <span class="stringliteral">&quot;     &lt;/d:lockdiscovery&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12922</span>              <span class="stringliteral">&quot;   &lt;/d:prop&gt;\n&quot;</span>,</div>
<div class="line"><span class="lineno">12923</span>              dav_lock[lock_index].<a class="code hl_variable" href="structtwebdav__lock.html#a10c1b2873c201b3f14167a5c367d3366">user</a>,</div>
<div class="line"><span class="lineno">12924</span>              (<a class="code hl_define" href="#a1531c1b87bf00f94782d1d45f2942803">LOCK_DURATION_S</a>),</div>
<div class="line"><span class="lineno">12925</span>              dav_lock[lock_index].<a class="code hl_variable" href="structtwebdav__lock.html#a40f964c56a8ec4f2397ab7f76f20850a">token</a>,</div>
<div class="line"><span class="lineno">12926</span>              dav_lock[lock_index].<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a>);</div>
<div class="line"><span class="lineno">12927</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a0110b7fe742fb4ee2ab467151e4df7c2"><div class="ttname"><a href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a></div><div class="ttdeci">CIVETWEB_API void mg_lock_context(struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l13018">civetweb.c:13018</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a1531c1b87bf00f94782d1d45f2942803"><div class="ttname"><a href="#a1531c1b87bf00f94782d1d45f2942803">LOCK_DURATION_S</a></div><div class="ttdeci">#define LOCK_DURATION_S</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02333">civetweb.c:2333</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a2040e14dfbc73e3fad6b7971613243ea"><div class="ttname"><a href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a></div><div class="ttdeci">static FUNCTION_MAY_BE_UNUSED uint64_t mg_get_current_time_ns(void)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01676">civetweb.c:1676</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a21ef7c3a4e9f99f62cf64329f965d2ed"><div class="ttname"><a href="#a21ef7c3a4e9f99f62cf64329f965d2ed">UINT64_FMT</a></div><div class="ttdeci">#define UINT64_FMT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00927">civetweb.c:927</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a229f03c60c42b8f390449a8e1324f22f"><div class="ttname"><a href="#a229f03c60c42b8f390449a8e1324f22f">send_static_cache_header</a></div><div class="ttdeci">static void send_static_cache_header(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04074">civetweb.c:4074</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a40bc6a84aa4f6dc3af32fcb62e74a848"><div class="ttname"><a href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a></div><div class="ttdeci">CIVETWEB_API void mg_unlock_context(struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l13027">civetweb.c:13027</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a81ef64a9ffadd917ddc7f4615cf5dc07"><div class="ttname"><a href="#a81ef64a9ffadd917ddc7f4615cf5dc07">mg_get_request_link</a></div><div class="ttdeci">CIVETWEB_API int mg_get_request_link(const struct mg_connection *conn, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03745">civetweb.c:3745</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ab79547a6cf8bca74eba39a0ff85cd091"><div class="ttname"><a href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a></div><div class="ttdeci">static void send_additional_header(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04122">civetweb.c:4122</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aca46fdde7db996eb011a1ac6a28bea98"><div class="ttname"><a href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a></div><div class="ttdeci">CIVETWEB_API int mg_send_http_error(struct mg_connection *conn, int status, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04562">civetweb.c:4562</a></div></div>
<div class="ttc" id="acivetweb_8c_html_accee9ed1fe40036abe9b36eac86b4121"><div class="ttname"><a href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a></div><div class="ttdeci">CIVETWEB_API int mg_printf(struct mg_connection *conn, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07034">civetweb.c:7034</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad0f8debaa123ea7820fa8345125e4235"><div class="ttname"><a href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a></div><div class="ttdeci">static void mg_strlcpy(char *dst, const char *src, size_t n)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03002">civetweb.c:3002</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aec63256a14a3c1f92d2b8e01a466f718"><div class="ttname"><a href="#aec63256a14a3c1f92d2b8e01a466f718">NUM_WEBDAV_LOCKS</a></div><div class="ttdeci">#define NUM_WEBDAV_LOCKS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02330">civetweb.c:2330</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a2ca8aca1da1713557d4eee7526887e12"><div class="ttname"><a href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a></div><div class="ttdeci">CIVETWEB_API int mg_response_header_send(struct mg_connection *conn)</div></div>
<div class="ttc" id="acivetweb_8h_html_a487cdeb41049480452d49e52a9f24465"><div class="ttname"><a href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a></div><div class="ttdeci">CIVETWEB_API int mg_response_header_add(struct mg_connection *conn, const char *header, const char *value, int value_len)</div></div>
<div class="ttc" id="acivetweb_8h_html_acf61373a94705446c56f0331639dd619"><div class="ttname"><a href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a></div><div class="ttdeci">CIVETWEB_API int mg_response_header_start(struct mg_connection *conn, int status)</div></div>
<div class="ttc" id="amulti_8h_html_a3c9cc97360bd1a6ca03b4b31f16d1342"><div class="ttname"><a href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a></div><div class="ttdeci">CURL_EXTERN CURLMcode curl_socket_t s</div><div class="ttdef"><b>Definition</b> <a href="multi_8h_source.html#l00318">multi.h:318</a></div></div>
<div class="ttc" id="astructmg__context_html_ad9abab27bb8fc8156d160de93bb08c30"><div class="ttname"><a href="structmg__context.html#ad9abab27bb8fc8156d160de93bb08c30">mg_context::webdav_lock</a></div><div class="ttdeci">struct twebdav_lock webdav_lock[NUM_WEBDAV_LOCKS]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02408">civetweb.c:2408</a></div></div>
<div class="ttc" id="astructtwebdav__lock_html"><div class="ttname"><a href="structtwebdav__lock.html">twebdav_lock</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02337">civetweb.c:2337</a></div></div>
<div class="ttc" id="astructtwebdav__lock_html_a10c1b2873c201b3f14167a5c367d3366"><div class="ttname"><a href="structtwebdav__lock.html#a10c1b2873c201b3f14167a5c367d3366">twebdav_lock::user</a></div><div class="ttdeci">char user[UTF8_PATH_MAX *2]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02341">civetweb.c:2341</a></div></div>
<div class="ttc" id="astructtwebdav__lock_html_a40f964c56a8ec4f2397ab7f76f20850a"><div class="ttname"><a href="structtwebdav__lock.html#a40f964c56a8ec4f2397ab7f76f20850a">twebdav_lock::token</a></div><div class="ttdeci">char token[33]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02339">civetweb.c:2339</a></div></div>
<div class="ttc" id="astructtwebdav__lock_html_a57e8e6294f2bf3d13b1497b474f7c5f8"><div class="ttname"><a href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">twebdav_lock::path</a></div><div class="ttdeci">char path[UTF8_PATH_MAX *2]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02340">civetweb.c:2340</a></div></div>
<div class="ttc" id="astructtwebdav__lock_html_af3941c51ff4e7bfe1151f6404ae7e1c4"><div class="ttname"><a href="structtwebdav__lock.html#af3941c51ff4e7bfe1151f6404ae7e1c4">twebdav_lock::locktime</a></div><div class="ttdeci">uint64_t locktime</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02338">civetweb.c:2338</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02333">LOCK_DURATION_S</a>, <a class="el" href="civetweb_8c_source.html#l02338">twebdav_lock::locktime</a>, <a class="el" href="civetweb_8c_source.html#l01676">mg_get_current_time_ns()</a>, <a class="el" href="civetweb_8c_source.html#l03745">mg_get_request_link()</a>, <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="civetweb_8c_source.html#l08404">mg_md5()</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02330">NUM_WEBDAV_LOCKS</a>, <a class="el" href="civetweb_8c_source.html#l02340">twebdav_lock::path</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8h_source.html#l00164">mg_request_info::remote_user</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="multi_8h_source.html#l00318">s</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04074">send_static_cache_header()</a>, <a class="el" href="civetweb_8c_source.html#l02339">twebdav_lock::token</a>, <a class="el" href="civetweb_8c_source.html#l00927">UINT64_FMT</a>, <a class="el" href="civetweb_8c_source.html#l02341">twebdav_lock::user</a>, <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>, and <a class="el" href="civetweb_8c_source.html#l02408">mg_context::webdav_lock</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="abf278680b80623f1e661ef055c695533" name="abf278680b80623f1e661ef055c695533"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf278680b80623f1e661ef055c695533">&#9670;&#160;</a></span>dav_mkcol()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dav_mkcol </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l11915">11915</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">11916</span>{</div>
<div class="line"><span class="lineno">11917</span>    <span class="keywordtype">int</span> rc, body_len;</div>
<div class="line"><span class="lineno">11918</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structde.html">de</a> <a class="code hl_struct" href="structde.html">de</a>;</div>
<div class="line"><span class="lineno">11919</span> </div>
<div class="line"><span class="lineno">11920</span>    <span class="keywordflow">if</span> (conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11921</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">11922</span>    }</div>
<div class="line"><span class="lineno">11923</span> </div>
<div class="line"><span class="lineno">11924</span>    <span class="comment">/* TODO (mid): Check the mg_send_http_error situations in this function</span></div>
<div class="line"><span class="lineno">11925</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">11926</span> </div>
<div class="line"><span class="lineno">11927</span>    memset(&amp;<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>));</div>
<div class="line"><span class="lineno">11928</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path, &amp;<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>)) {</div>
<div class="line"><span class="lineno">11929</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">11930</span>                        <span class="stringliteral">&quot;%s: mg_stat(%s) failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno">11931</span>                        __func__,</div>
<div class="line"><span class="lineno">11932</span>                        path,</div>
<div class="line"><span class="lineno">11933</span>                        strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">11934</span>    }</div>
<div class="line"><span class="lineno">11935</span> </div>
<div class="line"><span class="lineno">11936</span>    <span class="keywordflow">if</span> (<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#aa767e15073ca34ce0bd9fdcfe05e6ddc">last_modified</a>) {</div>
<div class="line"><span class="lineno">11937</span>        <span class="comment">/* TODO (mid): This check does not seem to make any sense ! */</span></div>
<div class="line"><span class="lineno">11938</span>        <span class="comment">/* TODO (mid): Add a webdav unit test first, before changing</span></div>
<div class="line"><span class="lineno">11939</span><span class="comment">         * anything here. */</span></div>
<div class="line"><span class="lineno">11940</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(</div>
<div class="line"><span class="lineno">11941</span>            conn, 405, <span class="stringliteral">&quot;Error: mkcol(%s): %s&quot;</span>, path, strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">11942</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">11943</span>    }</div>
<div class="line"><span class="lineno">11944</span> </div>
<div class="line"><span class="lineno">11945</span>    body_len = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> - conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a>;</div>
<div class="line"><span class="lineno">11946</span>    <span class="keywordflow">if</span> (body_len &gt; 0) {</div>
<div class="line"><span class="lineno">11947</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(</div>
<div class="line"><span class="lineno">11948</span>            conn, 415, <span class="stringliteral">&quot;Error: mkcol(%s): %s&quot;</span>, path, strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">11949</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">11950</span>    }</div>
<div class="line"><span class="lineno">11951</span> </div>
<div class="line"><span class="lineno">11952</span>    rc = <a class="code hl_define" href="#a756d12537962d25f9c69aaa1a319b10a">mg_mkdir</a>(conn, path, 0755);</div>
<div class="line"><span class="lineno">11953</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;mkdir %s: %i&quot;</span>, path, rc);</div>
<div class="line"><span class="lineno">11954</span>    <span class="keywordflow">if</span> (rc == 0) {</div>
<div class="line"><span class="lineno">11955</span>        <span class="comment">/* Create 201 &quot;Created&quot; response */</span></div>
<div class="line"><span class="lineno">11956</span>        <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 201);</div>
<div class="line"><span class="lineno">11957</span>        <a class="code hl_function" href="#a229f03c60c42b8f390449a8e1324f22f">send_static_cache_header</a>(conn);</div>
<div class="line"><span class="lineno">11958</span>        <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">11959</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, -1);</div>
<div class="line"><span class="lineno">11960</span> </div>
<div class="line"><span class="lineno">11961</span>        <span class="comment">/* Send all headers - there is no body */</span></div>
<div class="line"><span class="lineno">11962</span>        <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">11963</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11964</span>        <span class="keywordtype">int</span> http_status = 500;</div>
<div class="line"><span class="lineno">11965</span>        <span class="keywordflow">switch</span> (errno) {</div>
<div class="line"><span class="lineno">11966</span>        <span class="keywordflow">case</span> EEXIST:</div>
<div class="line"><span class="lineno">11967</span>            http_status = 405;</div>
<div class="line"><span class="lineno">11968</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">11969</span>        <span class="keywordflow">case</span> EACCES:</div>
<div class="line"><span class="lineno">11970</span>            http_status = 403;</div>
<div class="line"><span class="lineno">11971</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">11972</span>        <span class="keywordflow">case</span> ENOENT:</div>
<div class="line"><span class="lineno">11973</span>            http_status = 409;</div>
<div class="line"><span class="lineno">11974</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">11975</span>        }</div>
<div class="line"><span class="lineno">11976</span> </div>
<div class="line"><span class="lineno">11977</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">11978</span>                           http_status,</div>
<div class="line"><span class="lineno">11979</span>                           <span class="stringliteral">&quot;Error processing %s: %s&quot;</span>,</div>
<div class="line"><span class="lineno">11980</span>                           path,</div>
<div class="line"><span class="lineno">11981</span>                           strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">11982</span>    }</div>
<div class="line"><span class="lineno">11983</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a756d12537962d25f9c69aaa1a319b10a"><div class="ttname"><a href="#a756d12537962d25f9c69aaa1a319b10a">mg_mkdir</a></div><div class="ttdeci">#define mg_mkdir(conn, path, mode)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00918">civetweb.c:918</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a97625a7b1941b770798e090232bdfb6f"><div class="ttname"><a href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a></div><div class="ttdeci">static int mg_stat(const struct mg_connection *conn, const char *path, struct mg_file_stat *filep)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l05650">civetweb.c:5650</a></div></div>
<div class="ttc" id="astructmg__connection_html_a31dff43ab95d3d5e6dde9eb95460fd97"><div class="ttname"><a href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">mg_connection::request_len</a></div><div class="ttdeci">int request_len</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02557">civetweb.c:2557</a></div></div>
<div class="ttc" id="astructmg__connection_html_aa88754208d93c23d110469696d935bdc"><div class="ttname"><a href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">mg_connection::data_len</a></div><div class="ttdeci">int data_len</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02558">civetweb.c:2558</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02558">mg_connection::data_len</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l02579">de::file</a>, <a class="el" href="civetweb_8c_source.html#l01872">mg_file_stat::last_modified</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l00918">mg_mkdir</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02557">mg_connection::request_len</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, and <a class="el" href="civetweb_8c_source.html#l04074">send_static_cache_header()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a367094998bdec220ff7ab52f60283dc2" name="a367094998bdec220ff7ab52f60283dc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a367094998bdec220ff7ab52f60283dc2">&#9670;&#160;</a></span>dav_move_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dav_move_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>do_copy</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l11994">11994</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">11995</span>{</div>
<div class="line"><span class="lineno">11996</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *overwrite_hdr;</div>
<div class="line"><span class="lineno">11997</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *destination_hdr;</div>
<div class="line"><span class="lineno">11998</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *root;</div>
<div class="line"><span class="lineno">11999</span>    <span class="keywordtype">int</span> rc, dest_uri_type;</div>
<div class="line"><span class="lineno">12000</span>    <span class="keywordtype">int</span> http_status = 400;</div>
<div class="line"><span class="lineno">12001</span>    <span class="keywordtype">int</span> do_overwrite = 0;</div>
<div class="line"><span class="lineno">12002</span>    <span class="keywordtype">int</span> destination_ok = 0;</div>
<div class="line"><span class="lineno">12003</span>    <span class="keywordtype">char</span> dest_path[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>];</div>
<div class="line"><span class="lineno">12004</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file__stat.html">mg_file_stat</a> ignored;</div>
<div class="line"><span class="lineno">12005</span> </div>
<div class="line"><span class="lineno">12006</span>    <span class="keywordflow">if</span> (conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">12007</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12008</span>    }</div>
<div class="line"><span class="lineno">12009</span> </div>
<div class="line"><span class="lineno">12010</span>    root = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>];</div>
<div class="line"><span class="lineno">12011</span>    overwrite_hdr = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Overwrite&quot;</span>);</div>
<div class="line"><span class="lineno">12012</span>    destination_hdr = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Destination&quot;</span>);</div>
<div class="line"><span class="lineno">12013</span>    <span class="keywordflow">if</span> ((overwrite_hdr != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (toupper(overwrite_hdr[0]) == <span class="charliteral">&#39;T&#39;</span>)) {</div>
<div class="line"><span class="lineno">12014</span>        do_overwrite = 1;</div>
<div class="line"><span class="lineno">12015</span>    }</div>
<div class="line"><span class="lineno">12016</span> </div>
<div class="line"><span class="lineno">12017</span>    <span class="keywordflow">if</span> ((destination_hdr == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (destination_hdr[0] == 0)) {</div>
<div class="line"><span class="lineno">12018</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 400, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Missing destination&quot;</span>);</div>
<div class="line"><span class="lineno">12019</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12020</span>    }</div>
<div class="line"><span class="lineno">12021</span> </div>
<div class="line"><span class="lineno">12022</span>    <span class="keywordflow">if</span> (root != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">12023</span>        <span class="keywordtype">char</span> *local_dest = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">12024</span>        dest_uri_type = <a class="code hl_function" href="#a97c47a9a92a85f9cfbc1ae8a28738e2a">get_uri_type</a>(destination_hdr);</div>
<div class="line"><span class="lineno">12025</span>        <span class="keywordflow">if</span> (dest_uri_type == 2) {</div>
<div class="line"><span class="lineno">12026</span>            local_dest = <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(destination_hdr, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">12027</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dest_uri_type == 3) || (dest_uri_type == 4)) {</div>
<div class="line"><span class="lineno">12028</span>            <span class="keyword">const</span> <span class="keywordtype">char</span> *h =</div>
<div class="line"><span class="lineno">12029</span>                <a class="code hl_function" href="#a1504707625c62644c0951b656110b102">get_rel_url_at_current_server</a>(destination_hdr, conn);</div>
<div class="line"><span class="lineno">12030</span>            <span class="keywordflow">if</span> (h) {</div>
<div class="line"><span class="lineno">12031</span>                <span class="keywordtype">size_t</span> len = strlen(h);</div>
<div class="line"><span class="lineno">12032</span>                local_dest = <a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(len + 1, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">12033</span>                <a class="code hl_function" href="#a3bdfbeb661f200bdbe2e19e6258bb937">mg_url_decode</a>(h, (<span class="keywordtype">int</span>)len, local_dest, (<span class="keywordtype">int</span>)len + 1, 0);</div>
<div class="line"><span class="lineno">12034</span>            }</div>
<div class="line"><span class="lineno">12035</span>        }</div>
<div class="line"><span class="lineno">12036</span>        <span class="keywordflow">if</span> (local_dest != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">12037</span>            <a class="code hl_function" href="#abf6e864c64e3f7b5df96cf2c2598f776">remove_dot_segments</a>(local_dest);</div>
<div class="line"><span class="lineno">12038</span>            <span class="keywordflow">if</span> (local_dest[0] == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno">12039</span>                <span class="keywordtype">int</span> trunc_check = 0;</div>
<div class="line"><span class="lineno">12040</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">12041</span>                            &amp;trunc_check,</div>
<div class="line"><span class="lineno">12042</span>                            dest_path,</div>
<div class="line"><span class="lineno">12043</span>                            <span class="keyword">sizeof</span>(dest_path),</div>
<div class="line"><span class="lineno">12044</span>                            <span class="stringliteral">&quot;%s/%s&quot;</span>,</div>
<div class="line"><span class="lineno">12045</span>                            root,</div>
<div class="line"><span class="lineno">12046</span>                            local_dest);</div>
<div class="line"><span class="lineno">12047</span>                <span class="keywordflow">if</span> (trunc_check == 0) {</div>
<div class="line"><span class="lineno">12048</span>                    destination_ok = 1;</div>
<div class="line"><span class="lineno">12049</span>                }</div>
<div class="line"><span class="lineno">12050</span>            }</div>
<div class="line"><span class="lineno">12051</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(local_dest);</div>
<div class="line"><span class="lineno">12052</span>        }</div>
<div class="line"><span class="lineno">12053</span>    }</div>
<div class="line"><span class="lineno">12054</span> </div>
<div class="line"><span class="lineno">12055</span>    <span class="keywordflow">if</span> (!destination_ok) {</div>
<div class="line"><span class="lineno">12056</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 502, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Illegal destination&quot;</span>);</div>
<div class="line"><span class="lineno">12057</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12058</span>    }</div>
<div class="line"><span class="lineno">12059</span> </div>
<div class="line"><span class="lineno">12060</span>    <span class="comment">/* Check now if this file exists */</span></div>
<div class="line"><span class="lineno">12061</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, dest_path, &amp;ignored)) {</div>
<div class="line"><span class="lineno">12062</span>        <span class="comment">/* File exists */</span></div>
<div class="line"><span class="lineno">12063</span>        <span class="keywordflow">if</span> (do_overwrite) {</div>
<div class="line"><span class="lineno">12064</span>            <span class="comment">/* Overwrite allowed: delete the file first */</span></div>
<div class="line"><span class="lineno">12065</span>            <span class="keywordflow">if</span> (0 != remove(dest_path)) {</div>
<div class="line"><span class="lineno">12066</span>                <span class="comment">/* No overwrite: return error */</span></div>
<div class="line"><span class="lineno">12067</span>                <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">12068</span>                                   403,</div>
<div class="line"><span class="lineno">12069</span>                                   <span class="stringliteral">&quot;Cannot overwrite file: %s&quot;</span>,</div>
<div class="line"><span class="lineno">12070</span>                                   dest_path);</div>
<div class="line"><span class="lineno">12071</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12072</span>            }</div>
<div class="line"><span class="lineno">12073</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12074</span>            <span class="comment">/* No overwrite: return error */</span></div>
<div class="line"><span class="lineno">12075</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">12076</span>                               412,</div>
<div class="line"><span class="lineno">12077</span>                               <span class="stringliteral">&quot;Destination already exists: %s&quot;</span>,</div>
<div class="line"><span class="lineno">12078</span>                               dest_path);</div>
<div class="line"><span class="lineno">12079</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12080</span>        }</div>
<div class="line"><span class="lineno">12081</span>    }</div>
<div class="line"><span class="lineno">12082</span> </div>
<div class="line"><span class="lineno">12083</span>    <span class="comment">/* Copy / Move / Rename operation. */</span></div>
<div class="line"><span class="lineno">12084</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s %s to %s&quot;</span>, (do_copy ? <span class="stringliteral">&quot;copy&quot;</span> : <span class="stringliteral">&quot;move&quot;</span>), path, dest_path);</div>
<div class="line"><span class="lineno">12085</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">12086</span>    {</div>
<div class="line"><span class="lineno">12087</span>        <span class="comment">/* For Windows, we need to convert from UTF-8 to UTF-16 first. */</span></div>
<div class="line"><span class="lineno">12088</span>        <span class="keywordtype">wchar_t</span> wSource[UTF16_PATH_MAX];</div>
<div class="line"><span class="lineno">12089</span>        <span class="keywordtype">wchar_t</span> wDest[UTF16_PATH_MAX];</div>
<div class="line"><span class="lineno">12090</span>        BOOL ok;</div>
<div class="line"><span class="lineno">12091</span> </div>
<div class="line"><span class="lineno">12092</span>        path_to_unicode(conn, path, wSource, <a class="code hl_define" href="#a70c57aae3eb654e205459b4362c8089a">ARRAY_SIZE</a>(wSource));</div>
<div class="line"><span class="lineno">12093</span>        path_to_unicode(conn, dest_path, wDest, <a class="code hl_define" href="#a70c57aae3eb654e205459b4362c8089a">ARRAY_SIZE</a>(wDest));</div>
<div class="line"><span class="lineno">12094</span>        <span class="keywordflow">if</span> (do_copy) {</div>
<div class="line"><span class="lineno">12095</span>            ok = CopyFileW(wSource, wDest, do_overwrite ? <a class="code hl_define" href="gmacros_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a> : <a class="code hl_define" href="gmacros_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno">12096</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12097</span>            ok = MoveFileExW(wSource,</div>
<div class="line"><span class="lineno">12098</span>                             wDest,</div>
<div class="line"><span class="lineno">12099</span>                             do_overwrite ? MOVEFILE_REPLACE_EXISTING : 0);</div>
<div class="line"><span class="lineno">12100</span>        }</div>
<div class="line"><span class="lineno">12101</span>        <span class="keywordflow">if</span> (ok) {</div>
<div class="line"><span class="lineno">12102</span>            rc = 0;</div>
<div class="line"><span class="lineno">12103</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12104</span>            DWORD lastErr = GetLastError();</div>
<div class="line"><span class="lineno">12105</span>            <span class="keywordflow">if</span> (lastErr == ERROR_ALREADY_EXISTS) {</div>
<div class="line"><span class="lineno">12106</span>                <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">12107</span>                                   412,</div>
<div class="line"><span class="lineno">12108</span>                                   <span class="stringliteral">&quot;Destination already exists: %s&quot;</span>,</div>
<div class="line"><span class="lineno">12109</span>                                   dest_path);</div>
<div class="line"><span class="lineno">12110</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12111</span>            }</div>
<div class="line"><span class="lineno">12112</span>            rc = -1;</div>
<div class="line"><span class="lineno">12113</span>            http_status = 400;</div>
<div class="line"><span class="lineno">12114</span>        }</div>
<div class="line"><span class="lineno">12115</span>    }</div>
<div class="line"><span class="lineno">12116</span> </div>
<div class="line"><span class="lineno">12117</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">12118</span>    {</div>
<div class="line"><span class="lineno">12119</span>        <span class="comment">/* Linux uses already UTF-8, we don&#39;t need to convert file names. */</span></div>
<div class="line"><span class="lineno">12120</span> </div>
<div class="line"><span class="lineno">12121</span>        <span class="keywordflow">if</span> (do_copy) {</div>
<div class="line"><span class="lineno">12122</span>            <span class="comment">/* TODO: COPY for Linux. */</span></div>
<div class="line"><span class="lineno">12123</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 403, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;COPY forbidden&quot;</span>);</div>
<div class="line"><span class="lineno">12124</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12125</span>        }</div>
<div class="line"><span class="lineno">12126</span> </div>
<div class="line"><span class="lineno">12127</span>        rc = rename(path, dest_path);</div>
<div class="line"><span class="lineno">12128</span>        <span class="keywordflow">if</span> (rc) {</div>
<div class="line"><span class="lineno">12129</span>            <span class="keywordflow">switch</span> (errno) {</div>
<div class="line"><span class="lineno">12130</span>            <span class="keywordflow">case</span> EEXIST:</div>
<div class="line"><span class="lineno">12131</span>                http_status = 412;</div>
<div class="line"><span class="lineno">12132</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">12133</span>            <span class="keywordflow">case</span> EACCES:</div>
<div class="line"><span class="lineno">12134</span>                http_status = 403;</div>
<div class="line"><span class="lineno">12135</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">12136</span>            <span class="keywordflow">case</span> ENOENT:</div>
<div class="line"><span class="lineno">12137</span>                http_status = 409;</div>
<div class="line"><span class="lineno">12138</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">12139</span>            }</div>
<div class="line"><span class="lineno">12140</span>        }</div>
<div class="line"><span class="lineno">12141</span>    }</div>
<div class="line"><span class="lineno">12142</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">12143</span> </div>
<div class="line"><span class="lineno">12144</span>    <span class="keywordflow">if</span> (rc == 0) {</div>
<div class="line"><span class="lineno">12145</span>        <span class="comment">/* Create 204 &quot;No Content&quot; response */</span></div>
<div class="line"><span class="lineno">12146</span>        <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 204);</div>
<div class="line"><span class="lineno">12147</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, -1);</div>
<div class="line"><span class="lineno">12148</span> </div>
<div class="line"><span class="lineno">12149</span>        <span class="comment">/* Send all headers - there is no body */</span></div>
<div class="line"><span class="lineno">12150</span>        <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">12151</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12152</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, http_status, <span class="stringliteral">&quot;Operation failed&quot;</span>);</div>
<div class="line"><span class="lineno">12153</span>    }</div>
<div class="line"><span class="lineno">12154</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a09f3709fc72c7edf208c75ccbe3d997b"><div class="ttname"><a href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a></div><div class="ttdeci">#define mg_malloc_ctx(a, c)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01497">civetweb.c:1497</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a1504707625c62644c0951b656110b102"><div class="ttname"><a href="#a1504707625c62644c0951b656110b102">get_rel_url_at_current_server</a></div><div class="ttdeci">static const char * get_rel_url_at_current_server(const char *uri, const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18465">civetweb.c:18465</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a2565ee5d9358284c1312e957271fccfb"><div class="ttname"><a href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a></div><div class="ttdeci">CIVETWEB_API const char * mg_get_header(const struct mg_connection *conn, const char *name)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03855">civetweb.c:3855</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a3bdfbeb661f200bdbe2e19e6258bb937"><div class="ttname"><a href="#a3bdfbeb661f200bdbe2e19e6258bb937">mg_url_decode</a></div><div class="ttdeci">CIVETWEB_API int mg_url_decode(const char *src, int src_len, char *dst, int dst_len, int is_form_url_encoded)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07048">civetweb.c:7048</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a70c57aae3eb654e205459b4362c8089a"><div class="ttname"><a href="#a70c57aae3eb654e205459b4362c8089a">ARRAY_SIZE</a></div><div class="ttdeci">#define ARRAY_SIZE(array)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00506">civetweb.c:506</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a97c47a9a92a85f9cfbc1ae8a28738e2a"><div class="ttname"><a href="#a97c47a9a92a85f9cfbc1ae8a28738e2a">get_uri_type</a></div><div class="ttdeci">static int get_uri_type(const char *uri)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18395">civetweb.c:18395</a></div></div>
<div class="ttc" id="acivetweb_8c_html_abf6e864c64e3f7b5df96cf2c2598f776"><div class="ttname"><a href="#abf6e864c64e3f7b5df96cf2c2598f776">remove_dot_segments</a></div><div class="ttdeci">static void remove_dot_segments(char *inout)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08069">civetweb.c:8069</a></div></div>
<div class="ttc" id="agmacros_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="gmacros_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition</b> <a href="gmacros_8h_source.html#l00933">gmacros.h:933</a></div></div>
<div class="ttc" id="agmacros_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="gmacros_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition</b> <a href="gmacros_8h_source.html#l00929">gmacros.h:929</a></div></div>
<div class="ttc" id="astructmg__file__stat_html"><div class="ttname"><a href="structmg__file__stat.html">mg_file_stat</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01869">civetweb.c:1869</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00506">ARRAY_SIZE</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l01954">DOCUMENT_ROOT</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="gmacros_8h_source.html#l00929">FALSE</a>, <a class="el" href="civetweb_8c_source.html#l18465">get_rel_url_at_current_server()</a>, <a class="el" href="civetweb_8c_source.html#l18395">get_uri_type()</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8c_source.html#l01497">mg_malloc_ctx</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="civetweb_8c_source.html#l03062">mg_strdup_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l07048">mg_url_decode()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l08069">remove_dot_segments()</a>, <a class="el" href="gmacros_8h_source.html#l00933">TRUE</a>, and <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a393a2d03d9209602b28629421b382841" name="a393a2d03d9209602b28629421b382841"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a393a2d03d9209602b28629421b382841">&#9670;&#160;</a></span>dav_proppatch()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dav_proppatch </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12964">12964</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12965</span>{</div>
<div class="line"><span class="lineno">12966</span>    <span class="keywordtype">char</span> link_buf[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a> * 2]; <span class="comment">/* Path + server root */</span></div>
<div class="line"><span class="lineno">12967</span> </div>
<div class="line"><span class="lineno">12968</span>    <span class="keywordflow">if</span> (!conn || !path || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno">12969</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12970</span>    }</div>
<div class="line"><span class="lineno">12971</span> </div>
<div class="line"><span class="lineno">12972</span>    <span class="comment">/* return 207 &quot;Multi-Status&quot; */</span></div>
<div class="line"><span class="lineno">12973</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">12974</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 207);</div>
<div class="line"><span class="lineno">12975</span>    <a class="code hl_function" href="#a229f03c60c42b8f390449a8e1324f22f">send_static_cache_header</a>(conn);</div>
<div class="line"><span class="lineno">12976</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">12977</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn,</div>
<div class="line"><span class="lineno">12978</span>                           <span class="stringliteral">&quot;Content-Type&quot;</span>,</div>
<div class="line"><span class="lineno">12979</span>                           <span class="stringliteral">&quot;application/xml; charset=utf-8&quot;</span>,</div>
<div class="line"><span class="lineno">12980</span>                           -1);</div>
<div class="line"><span class="lineno">12981</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">12982</span> </div>
<div class="line"><span class="lineno">12983</span>    <a class="code hl_function" href="#a81ef64a9ffadd917ddc7f4615cf5dc07">mg_get_request_link</a>(conn, link_buf, <span class="keyword">sizeof</span>(link_buf));</div>
<div class="line"><span class="lineno">12984</span> </div>
<div class="line"><span class="lineno">12985</span>    <span class="comment">/* Content */</span></div>
<div class="line"><span class="lineno">12986</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">12987</span>              <span class="stringliteral">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;&quot;</span></div>
<div class="line"><span class="lineno">12988</span>              <span class="stringliteral">&quot;&lt;d:multistatus xmlns:d=&#39;DAV:&#39;&gt;\n&quot;</span></div>
<div class="line"><span class="lineno">12989</span>              <span class="stringliteral">&quot;&lt;d:response&gt;\n&lt;d:href&gt;%s&lt;/d:href&gt;\n&quot;</span>,</div>
<div class="line"><span class="lineno">12990</span>              link_buf);</div>
<div class="line"><span class="lineno">12991</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">12992</span>              <span class="stringliteral">&quot;&lt;d:propstat&gt;&lt;d:status&gt;HTTP/1.1 403 &quot;</span></div>
<div class="line"><span class="lineno">12993</span>              <span class="stringliteral">&quot;Forbidden&lt;/d:status&gt;&lt;/d:propstat&gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">12994</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn, <span class="stringliteral">&quot;%s\n&quot;</span>, <span class="stringliteral">&quot;&lt;/d:response&gt;&lt;/d:multistatus&gt;&quot;</span>);</div>
<div class="line"><span class="lineno">12995</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l03745">mg_get_request_link()</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="civetweb_8c_source.html#l02340">twebdav_lock::path</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04074">send_static_cache_header()</a>, and <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a72d17299496dec4724fe359b9cc5fc50" name="a72d17299496dec4724fe359b9cc5fc50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72d17299496dec4724fe359b9cc5fc50">&#9670;&#160;</a></span>dav_unlock_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dav_unlock_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12931">12931</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12932</span>{</div>
<div class="line"><span class="lineno">12933</span>    <span class="comment">/* internal function - therefore conn is assumed to be valid */</span></div>
<div class="line"><span class="lineno">12934</span>    <span class="keywordtype">char</span> link_buf[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a> * 2]; <span class="comment">/* Path + server root */</span></div>
<div class="line"><span class="lineno">12935</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structtwebdav__lock.html">twebdav_lock</a> *dav_lock = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#ad9abab27bb8fc8156d160de93bb08c30">webdav_lock</a>;</div>
<div class="line"><span class="lineno">12936</span>    <span class="keywordtype">int</span> lock_index;</div>
<div class="line"><span class="lineno">12937</span> </div>
<div class="line"><span class="lineno">12938</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a> || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a>) {</div>
<div class="line"><span class="lineno">12939</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12940</span>    }</div>
<div class="line"><span class="lineno">12941</span> </div>
<div class="line"><span class="lineno">12942</span>    <a class="code hl_function" href="#a81ef64a9ffadd917ddc7f4615cf5dc07">mg_get_request_link</a>(conn, link_buf, <span class="keyword">sizeof</span>(link_buf));</div>
<div class="line"><span class="lineno">12943</span> </div>
<div class="line"><span class="lineno">12944</span>    <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">12945</span>    <span class="comment">/* find existing lock */</span></div>
<div class="line"><span class="lineno">12946</span>    <span class="keywordflow">for</span> (lock_index = 0; lock_index &lt; <a class="code hl_define" href="#aec63256a14a3c1f92d2b8e01a466f718">NUM_WEBDAV_LOCKS</a>; lock_index++) {</div>
<div class="line"><span class="lineno">12947</span>        <span class="keywordflow">if</span> (!strcmp(dav_lock[lock_index].<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a>, link_buf)) {</div>
<div class="line"><span class="lineno">12948</span>            <span class="comment">/* Success: return 204 &quot;No Content&quot; */</span></div>
<div class="line"><span class="lineno">12949</span>            <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">12950</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">12951</span>            <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 204);</div>
<div class="line"><span class="lineno">12952</span>            <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">12953</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12954</span>        }</div>
<div class="line"><span class="lineno">12955</span>    }</div>
<div class="line"><span class="lineno">12956</span>    <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">12957</span> </div>
<div class="line"><span class="lineno">12958</span>    <span class="comment">/* Error: Cannot unlock a resource that is not locked */</span></div>
<div class="line"><span class="lineno">12959</span>    <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 423, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Lock not found&quot;</span>);</div>
<div class="line"><span class="lineno">12960</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l03745">mg_get_request_link()</a>, <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="civetweb_8c_source.html#l02330">NUM_WEBDAV_LOCKS</a>, <a class="el" href="civetweb_8c_source.html#l02340">twebdav_lock::path</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8h_source.html#l00164">mg_request_info::remote_user</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>, and <a class="el" href="civetweb_8c_source.html#l02408">mg_context::webdav_lock</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a2912c3ad9f0ba624b545a6f920ab5ddc" name="a2912c3ad9f0ba624b545a6f920ab5ddc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2912c3ad9f0ba624b545a6f920ab5ddc">&#9670;&#160;</a></span>delete_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void delete_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12293">12293</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12294</span>{</div>
<div class="line"><span class="lineno">12295</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structde.html">de</a> <a class="code hl_struct" href="structde.html">de</a>;</div>
<div class="line"><span class="lineno">12296</span>    memset(&amp;<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>));</div>
<div class="line"><span class="lineno">12297</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path, &amp;<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>)) {</div>
<div class="line"><span class="lineno">12298</span>        <span class="comment">/* mg_stat returns 0 if the file does not exist */</span></div>
<div class="line"><span class="lineno">12299</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">12300</span>                           404,</div>
<div class="line"><span class="lineno">12301</span>                           <span class="stringliteral">&quot;Error: Cannot delete file\nFile %s not found&quot;</span>,</div>
<div class="line"><span class="lineno">12302</span>                           path);</div>
<div class="line"><span class="lineno">12303</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12304</span>    }</div>
<div class="line"><span class="lineno">12305</span> </div>
<div class="line"><span class="lineno">12306</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;delete %s&quot;</span>, path);</div>
<div class="line"><span class="lineno">12307</span> </div>
<div class="line"><span class="lineno">12308</span>    <span class="keywordflow">if</span> (<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a>) {</div>
<div class="line"><span class="lineno">12309</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#ad26006f44f84ee1b4e9d5e039f779b51">remove_directory</a>(conn, path)) {</div>
<div class="line"><span class="lineno">12310</span>            <span class="comment">/* Delete is successful: Return 204 without content. */</span></div>
<div class="line"><span class="lineno">12311</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 204, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">12312</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12313</span>            <span class="comment">/* Delete is not successful: Return 500 (Server error). */</span></div>
<div class="line"><span class="lineno">12314</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 500, <span class="stringliteral">&quot;Error: Could not delete %s&quot;</span>, path);</div>
<div class="line"><span class="lineno">12315</span>        }</div>
<div class="line"><span class="lineno">12316</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12317</span>    }</div>
<div class="line"><span class="lineno">12318</span> </div>
<div class="line"><span class="lineno">12319</span>    <span class="comment">/* This is an existing file (not a directory).</span></div>
<div class="line"><span class="lineno">12320</span><span class="comment">     * Check if write permission is granted. */</span></div>
<div class="line"><span class="lineno">12321</span>    <span class="keywordflow">if</span> (access(path, W_OK) != 0) {</div>
<div class="line"><span class="lineno">12322</span>        <span class="comment">/* File is read only */</span></div>
<div class="line"><span class="lineno">12323</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(</div>
<div class="line"><span class="lineno">12324</span>            conn,</div>
<div class="line"><span class="lineno">12325</span>            403,</div>
<div class="line"><span class="lineno">12326</span>            <span class="stringliteral">&quot;Error: Delete not possible\nDeleting %s is not allowed&quot;</span>,</div>
<div class="line"><span class="lineno">12327</span>            path);</div>
<div class="line"><span class="lineno">12328</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12329</span>    }</div>
<div class="line"><span class="lineno">12330</span> </div>
<div class="line"><span class="lineno">12331</span>    <span class="comment">/* Try to delete it. */</span></div>
<div class="line"><span class="lineno">12332</span>    <span class="keywordflow">if</span> (<a class="code hl_define" href="#a3b7e572b06c0a0d1c920572523fbe01d">mg_remove</a>(conn, path) == 0) {</div>
<div class="line"><span class="lineno">12333</span>        <span class="comment">/* Delete was successful: Return 204 without content. */</span></div>
<div class="line"><span class="lineno">12334</span>        <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 204);</div>
<div class="line"><span class="lineno">12335</span>        <a class="code hl_function" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a>(conn);</div>
<div class="line"><span class="lineno">12336</span>        <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">12337</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, -1);</div>
<div class="line"><span class="lineno">12338</span>        <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">12339</span> </div>
<div class="line"><span class="lineno">12340</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12341</span>        <span class="comment">/* Delete not successful (file locked). */</span></div>
<div class="line"><span class="lineno">12342</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">12343</span>                           423,</div>
<div class="line"><span class="lineno">12344</span>                           <span class="stringliteral">&quot;Error: Cannot delete file\nremove(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno">12345</span>                           path,</div>
<div class="line"><span class="lineno">12346</span>                           strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">12347</span>    }</div>
<div class="line"><span class="lineno">12348</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a3b7e572b06c0a0d1c920572523fbe01d"><div class="ttname"><a href="#a3b7e572b06c0a0d1c920572523fbe01d">mg_remove</a></div><div class="ttdeci">#define mg_remove(conn, x)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00919">civetweb.c:919</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a4e9abca78e3f98b886081d15550f7fca"><div class="ttname"><a href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a></div><div class="ttdeci">static void send_no_cache_header(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04056">civetweb.c:4056</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad26006f44f84ee1b4e9d5e039f779b51"><div class="ttname"><a href="#ad26006f44f84ee1b4e9d5e039f779b51">remove_directory</a></div><div class="ttdeci">static int remove_directory(struct mg_connection *conn, const char *dir)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09836">civetweb.c:9836</a></div></div>
<div class="ttc" id="astructmg__file__stat_html_a87c1476af755c86fc992b2fff8b210f6"><div class="ttname"><a href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">mg_file_stat::is_directory</a></div><div class="ttdeci">int is_directory</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01873">civetweb.c:1873</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l02579">de::file</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l00919">mg_remove</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, and <a class="el" href="civetweb_8c_source.html#l04056">send_no_cache_header()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="ae7110e9ded01191e313122aafa2b1040" name="ae7110e9ded01191e313122aafa2b1040"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7110e9ded01191e313122aafa2b1040">&#9670;&#160;</a></span>dir_scan_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int dir_scan_callback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structde.html">de</a> *</td>          <td class="paramname"><span class="paramname"><em>de</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>data</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09911">9911</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9912</span>{</div>
<div class="line"><span class="lineno"> 9913</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structdir__scan__data.html">dir_scan_data</a> *dsd = (<span class="keyword">struct </span><a class="code hl_struct" href="structdir__scan__data.html">dir_scan_data</a> *)data;</div>
<div class="line"><span class="lineno"> 9914</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structde.html">de</a> *entries = dsd-&gt;<a class="code hl_variable" href="structdir__scan__data.html#a73f628586095aed39889c1af9d717622">entries</a>;</div>
<div class="line"><span class="lineno"> 9915</span> </div>
<div class="line"><span class="lineno"> 9916</span>    <span class="keywordflow">if</span> ((entries == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (dsd-&gt;<a class="code hl_variable" href="structdir__scan__data.html#a46f144aee1c95408b664e24a7ca29684">num_entries</a> &gt;= dsd-&gt;<a class="code hl_variable" href="structdir__scan__data.html#a919679616876ddeeabffda09ce6465ca">arr_size</a>)) {</div>
<div class="line"><span class="lineno"> 9917</span>        <span class="comment">/* Here &quot;entries&quot; is a temporary pointer and can be replaced,</span></div>
<div class="line"><span class="lineno"> 9918</span><span class="comment">         * &quot;dsd-&gt;entries&quot; is the original pointer */</span></div>
<div class="line"><span class="lineno"> 9919</span>        entries =</div>
<div class="line"><span class="lineno"> 9920</span>            (<span class="keyword">struct </span><a class="code hl_struct" href="structde.html">de</a> *)<a class="code hl_function" href="#a5185c288b713841c3c37118b5028bb42">mg_realloc</a>(entries,</div>
<div class="line"><span class="lineno"> 9921</span>                                    dsd-&gt;<a class="code hl_variable" href="structdir__scan__data.html#a919679616876ddeeabffda09ce6465ca">arr_size</a> * 2 * <span class="keyword">sizeof</span>(entries[0]));</div>
<div class="line"><span class="lineno"> 9922</span>        <span class="keywordflow">if</span> (entries == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9923</span>            <span class="comment">/* stop scan */</span></div>
<div class="line"><span class="lineno"> 9924</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 9925</span>        }</div>
<div class="line"><span class="lineno"> 9926</span>        dsd-&gt;<a class="code hl_variable" href="structdir__scan__data.html#a73f628586095aed39889c1af9d717622">entries</a> = entries;</div>
<div class="line"><span class="lineno"> 9927</span>        dsd-&gt;<a class="code hl_variable" href="structdir__scan__data.html#a919679616876ddeeabffda09ce6465ca">arr_size</a> *= 2;</div>
<div class="line"><span class="lineno"> 9928</span>    }</div>
<div class="line"><span class="lineno"> 9929</span>    entries[dsd-&gt;<a class="code hl_variable" href="structdir__scan__data.html#a46f144aee1c95408b664e24a7ca29684">num_entries</a>].<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a> = <a class="code hl_function" href="#a4e6a5dc184d97ba5278dfda5b838f1cc">mg_strdup</a>(<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a>);</div>
<div class="line"><span class="lineno"> 9930</span>    <span class="keywordflow">if</span> (entries[dsd-&gt;<a class="code hl_variable" href="structdir__scan__data.html#a46f144aee1c95408b664e24a7ca29684">num_entries</a>].file_name == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9931</span>        <span class="comment">/* stop scan */</span></div>
<div class="line"><span class="lineno"> 9932</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 9933</span>    }</div>
<div class="line"><span class="lineno"> 9934</span>    entries[dsd-&gt;<a class="code hl_variable" href="structdir__scan__data.html#a46f144aee1c95408b664e24a7ca29684">num_entries</a>].<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a> = <a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>;</div>
<div class="line"><span class="lineno"> 9935</span>    dsd-&gt;<a class="code hl_variable" href="structdir__scan__data.html#a46f144aee1c95408b664e24a7ca29684">num_entries</a>++;</div>
<div class="line"><span class="lineno"> 9936</span> </div>
<div class="line"><span class="lineno"> 9937</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9938</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a4e6a5dc184d97ba5278dfda5b838f1cc"><div class="ttname"><a href="#a4e6a5dc184d97ba5278dfda5b838f1cc">mg_strdup</a></div><div class="ttdeci">static char * mg_strdup(const char *str)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03068">civetweb.c:3068</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a5185c288b713841c3c37118b5028bb42"><div class="ttname"><a href="#a5185c288b713841c3c37118b5028bb42">mg_realloc</a></div><div class="ttdeci">static __inline void * mg_realloc(void *a, size_t b)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01486">civetweb.c:1486</a></div></div>
<div class="ttc" id="astructde_html_a08f58ddfc5471054734d921fc199b7ed"><div class="ttname"><a href="structde.html#a08f58ddfc5471054734d921fc199b7ed">de::file_name</a></div><div class="ttdeci">char * file_name</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02578">civetweb.c:2578</a></div></div>
<div class="ttc" id="astructdir__scan__data_html"><div class="ttname"><a href="structdir__scan__data.html">dir_scan_data</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09902">civetweb.c:9902</a></div></div>
<div class="ttc" id="astructdir__scan__data_html_a46f144aee1c95408b664e24a7ca29684"><div class="ttname"><a href="structdir__scan__data.html#a46f144aee1c95408b664e24a7ca29684">dir_scan_data::num_entries</a></div><div class="ttdeci">size_t num_entries</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09904">civetweb.c:9904</a></div></div>
<div class="ttc" id="astructdir__scan__data_html_a73f628586095aed39889c1af9d717622"><div class="ttname"><a href="structdir__scan__data.html#a73f628586095aed39889c1af9d717622">dir_scan_data::entries</a></div><div class="ttdeci">struct de * entries</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09903">civetweb.c:9903</a></div></div>
<div class="ttc" id="astructdir__scan__data_html_a919679616876ddeeabffda09ce6465ca"><div class="ttname"><a href="structdir__scan__data.html#a919679616876ddeeabffda09ce6465ca">dir_scan_data::arr_size</a></div><div class="ttdeci">size_t arr_size</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09905">civetweb.c:9905</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l09905">dir_scan_data::arr_size</a>, <a class="el" href="civetweb_8c_source.html#l09903">dir_scan_data::entries</a>, <a class="el" href="civetweb_8c_source.html#l02579">de::file</a>, <a class="el" href="civetweb_8c_source.html#l02578">de::file_name</a>, <a class="el" href="civetweb_8c_source.html#l01486">mg_realloc()</a>, <a class="el" href="civetweb_8c_source.html#l03068">mg_strdup()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l09904">dir_scan_data::num_entries</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>.</p>

</div>
</div>
<a id="ad9f9ef727b8c8a8ecb4c06b47aeb7d11" name="ad9f9ef727b8c8a8ecb4c06b47aeb7d11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9f9ef727b8c8a8ecb4c06b47aeb7d11">&#9670;&#160;</a></span>discard_unread_request_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void discard_unread_request_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06484">6484</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6485</span>{</div>
<div class="line"><span class="lineno"> 6486</span>    <span class="keywordtype">char</span> buf[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno"> 6487</span> </div>
<div class="line"><span class="lineno"> 6488</span>    <span class="keywordflow">while</span> (<a class="code hl_function" href="#afeb3b13a0524f5532d16953927743966">mg_read</a>(conn, buf, <span class="keyword">sizeof</span>(buf)) &gt; 0)</div>
<div class="line"><span class="lineno"> 6489</span>        ;</div>
<div class="line"><span class="lineno"> 6490</span>}</div>
<div class="ttc" id="acivetweb_8c_html_afeb3b13a0524f5532d16953927743966"><div class="ttname"><a href="#afeb3b13a0524f5532d16953927743966">mg_read</a></div><div class="ttdeci">CIVETWEB_API int mg_read(struct mg_connection *conn, void *buf, size_t len)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06614">civetweb.c:6614</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, and <a class="el" href="civetweb_8c_source.html#l06614">mg_read()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a1b2849ed5bfad2fe98c98852e26b065a" name="a1b2849ed5bfad2fe98c98852e26b065a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b2849ed5bfad2fe98c98852e26b065a">&#9670;&#160;</a></span>do_ssi_exec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_ssi_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>tag</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12443">12443</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12444</span>{</div>
<div class="line"><span class="lineno">12445</span>    <span class="keywordtype">char</span> cmd[1024] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">12446</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">12447</span> </div>
<div class="line"><span class="lineno">12448</span>    <span class="keywordflow">if</span> (sscanf(tag, <span class="stringliteral">&quot; \&quot;%1023[^\&quot;]\&quot;&quot;</span>, cmd) != 1) {</div>
<div class="line"><span class="lineno">12449</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;Bad SSI #exec: [%s]&quot;</span>, tag);</div>
<div class="line"><span class="lineno">12450</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12451</span>        cmd[1023] = 0;</div>
<div class="line"><span class="lineno">12452</span>        <span class="keywordflow">if</span> ((file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> = popen(cmd, <span class="stringliteral">&quot;r&quot;</span>)) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">12453</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">12454</span>                            <span class="stringliteral">&quot;Cannot SSI #exec: [%s]: %s&quot;</span>,</div>
<div class="line"><span class="lineno">12455</span>                            cmd,</div>
<div class="line"><span class="lineno">12456</span>                            strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">12457</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12458</span>            <a class="code hl_function" href="#a528545b68103ca8848caaea2c5316ec2">send_file_data</a>(conn, &amp;file, 0, <a class="code hl_define" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a>, 0); <span class="comment">/* send static file */</span></div>
<div class="line"><span class="lineno">12459</span>            pclose(file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a>);</div>
<div class="line"><span class="lineno">12460</span>        }</div>
<div class="line"><span class="lineno">12461</span>    }</div>
<div class="line"><span class="lineno">12462</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a528545b68103ca8848caaea2c5316ec2"><div class="ttname"><a href="#a528545b68103ca8848caaea2c5316ec2">send_file_data</a></div><div class="ttdeci">static void send_file_data(struct mg_connection *conn, struct mg_file *filep, int64_t offset, int64_t len, int no_buffering)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10055">civetweb.c:10055</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad0d744f05898e32d01f73f8af3cd2071"><div class="ttname"><a href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a></div><div class="ttdeci">#define INT64_MAX</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00513">civetweb.c:513</a></div></div>
<div class="ttc" id="astructmg__file__access_html_a63d40853ff1053f8e2ba34f19319bb3c"><div class="ttname"><a href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">mg_file_access::fp</a></div><div class="ttdeci">FILE * fp</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01882">civetweb.c:1882</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, <a class="el" href="civetweb_8c_source.html#l00513">INT64_MAX</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>, and <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12482">send_ssi_file()</a>.</p>

</div>
</div>
<a id="a8ddc04f7aafa49c779fde3d73c2532a2" name="a8ddc04f7aafa49c779fde3d73c2532a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ddc04f7aafa49c779fde3d73c2532a2">&#9670;&#160;</a></span>do_ssi_include()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_ssi_include </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>ssi</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>tag</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>include_level</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12358">12358</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12362</span>{</div>
<div class="line"><span class="lineno">12363</span>    <span class="keywordtype">char</span> file_name[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>], path[512], *p;</div>
<div class="line"><span class="lineno">12364</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">12365</span>    <span class="keywordtype">size_t</span> len;</div>
<div class="line"><span class="lineno">12366</span>    <span class="keywordtype">int</span> truncated = 0;</div>
<div class="line"><span class="lineno">12367</span> </div>
<div class="line"><span class="lineno">12368</span>    <span class="keywordflow">if</span> (conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">12369</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12370</span>    }</div>
<div class="line"><span class="lineno">12371</span> </div>
<div class="line"><span class="lineno">12372</span>    <span class="comment">/* sscanf() is safe here, since send_ssi_file() also uses buffer</span></div>
<div class="line"><span class="lineno">12373</span><span class="comment">     * of size MG_BUF_LEN to get the tag. So strlen(tag) is</span></div>
<div class="line"><span class="lineno">12374</span><span class="comment">     * always &lt; MG_BUF_LEN. */</span></div>
<div class="line"><span class="lineno">12375</span>    <span class="keywordflow">if</span> (sscanf(tag, <span class="stringliteral">&quot; virtual=\&quot;%511[^\&quot;]\&quot;&quot;</span>, file_name) == 1) {</div>
<div class="line"><span class="lineno">12376</span>        <span class="comment">/* File name is relative to the webserver root */</span></div>
<div class="line"><span class="lineno">12377</span>        file_name[511] = 0;</div>
<div class="line"><span class="lineno">12378</span>        (void)<a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">12379</span>                          &amp;truncated,</div>
<div class="line"><span class="lineno">12380</span>                          path,</div>
<div class="line"><span class="lineno">12381</span>                          <span class="keyword">sizeof</span>(path),</div>
<div class="line"><span class="lineno">12382</span>                          <span class="stringliteral">&quot;%s/%s&quot;</span>,</div>
<div class="line"><span class="lineno">12383</span>                          conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>],</div>
<div class="line"><span class="lineno">12384</span>                          file_name);</div>
<div class="line"><span class="lineno">12385</span> </div>
<div class="line"><span class="lineno">12386</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sscanf(tag, <span class="stringliteral">&quot; abspath=\&quot;%511[^\&quot;]\&quot;&quot;</span>, file_name) == 1) {</div>
<div class="line"><span class="lineno">12387</span>        <span class="comment">/* File name is relative to the webserver working directory</span></div>
<div class="line"><span class="lineno">12388</span><span class="comment">         * or it is absolute system path */</span></div>
<div class="line"><span class="lineno">12389</span>        file_name[511] = 0;</div>
<div class="line"><span class="lineno">12390</span>        (void)</div>
<div class="line"><span class="lineno">12391</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn, &amp;truncated, path, <span class="keyword">sizeof</span>(path), <span class="stringliteral">&quot;%s&quot;</span>, file_name);</div>
<div class="line"><span class="lineno">12392</span> </div>
<div class="line"><span class="lineno">12393</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((sscanf(tag, <span class="stringliteral">&quot; file=\&quot;%511[^\&quot;]\&quot;&quot;</span>, file_name) == 1)</div>
<div class="line"><span class="lineno">12394</span>               || (sscanf(tag, <span class="stringliteral">&quot; \&quot;%511[^\&quot;]\&quot;&quot;</span>, file_name) == 1)) {</div>
<div class="line"><span class="lineno">12395</span>        <span class="comment">/* File name is relative to the current document */</span></div>
<div class="line"><span class="lineno">12396</span>        file_name[511] = 0;</div>
<div class="line"><span class="lineno">12397</span>        (void)<a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn, &amp;truncated, path, <span class="keyword">sizeof</span>(path), <span class="stringliteral">&quot;%s&quot;</span>, ssi);</div>
<div class="line"><span class="lineno">12398</span> </div>
<div class="line"><span class="lineno">12399</span>        <span class="keywordflow">if</span> (!truncated) {</div>
<div class="line"><span class="lineno">12400</span>            <span class="keywordflow">if</span> ((p = strrchr(path, <span class="charliteral">&#39;/&#39;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">12401</span>                p[1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">12402</span>            }</div>
<div class="line"><span class="lineno">12403</span>            len = strlen(path);</div>
<div class="line"><span class="lineno">12404</span>            (void)<a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">12405</span>                              &amp;truncated,</div>
<div class="line"><span class="lineno">12406</span>                              path + len,</div>
<div class="line"><span class="lineno">12407</span>                              <span class="keyword">sizeof</span>(path) - len,</div>
<div class="line"><span class="lineno">12408</span>                              <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">12409</span>                              file_name);</div>
<div class="line"><span class="lineno">12410</span>        }</div>
<div class="line"><span class="lineno">12411</span> </div>
<div class="line"><span class="lineno">12412</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12413</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;Bad SSI #include: [%s]&quot;</span>, tag);</div>
<div class="line"><span class="lineno">12414</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12415</span>    }</div>
<div class="line"><span class="lineno">12416</span> </div>
<div class="line"><span class="lineno">12417</span>    <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno">12418</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;SSI #include path length overflow: [%s]&quot;</span>, tag);</div>
<div class="line"><span class="lineno">12419</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12420</span>    }</div>
<div class="line"><span class="lineno">12421</span> </div>
<div class="line"><span class="lineno">12422</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, path, <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>, &amp;file)) {</div>
<div class="line"><span class="lineno">12423</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">12424</span>                        <span class="stringliteral">&quot;Cannot open SSI #include: [%s]: fopen(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno">12425</span>                        tag,</div>
<div class="line"><span class="lineno">12426</span>                        path,</div>
<div class="line"><span class="lineno">12427</span>                        strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">12428</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12429</span>        <a class="code hl_function" href="#a66af55875eb933f2969b8bed72ab9ef4">fclose_on_exec</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>, conn);</div>
<div class="line"><span class="lineno">12430</span>        <span class="keywordflow">if</span> (match_prefix_strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad759d92bd3b0e4870bb7d92ad10399b4">SSI_EXTENSIONS</a>], path)</div>
<div class="line"><span class="lineno">12431</span>            &gt; 0) {</div>
<div class="line"><span class="lineno">12432</span>            <a class="code hl_function" href="#abbfd2afe32d71961fea011337ee6e2b1">send_ssi_file</a>(conn, path, &amp;file, include_level + 1);</div>
<div class="line"><span class="lineno">12433</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12434</span>            <a class="code hl_function" href="#a528545b68103ca8848caaea2c5316ec2">send_file_data</a>(conn, &amp;file, 0, <a class="code hl_define" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a>, 0); <span class="comment">/* send static file */</span></div>
<div class="line"><span class="lineno">12435</span>        }</div>
<div class="line"><span class="lineno">12436</span>        (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>); <span class="comment">/* Ignore errors for readonly files */</span></div>
<div class="line"><span class="lineno">12437</span>    }</div>
<div class="line"><span class="lineno">12438</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a66af55875eb933f2969b8bed72ab9ef4"><div class="ttname"><a href="#a66af55875eb933f2969b8bed72ab9ef4">fclose_on_exec</a></div><div class="ttdeci">static void fclose_on_exec(struct mg_file_access *filep, struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10196">civetweb.c:10196</a></div></div>
<div class="ttc" id="acivetweb_8c_html_abbfd2afe32d71961fea011337ee6e2b1"><div class="ttname"><a href="#abbfd2afe32d71961fea011337ee6e2b1">send_ssi_file</a></div><div class="ttdeci">static void send_ssi_file(struct mg_connection *, const char *, struct mg_file *, int)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12482">civetweb.c:12482</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l01954">DOCUMENT_ROOT</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l10196">fclose_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l02578">de::file_name</a>, <a class="el" href="civetweb_8c_source.html#l00513">INT64_MAX</a>, <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02843">MG_FOPEN_MODE_READ</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>, <a class="el" href="civetweb_8c_source.html#l12482">send_ssi_file()</a>, <a class="el" href="civetweb_8c_source.html#l02001">SSI_EXTENSIONS</a>, and <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12482">send_ssi_file()</a>.</p>

</div>
</div>
<a id="a5e07d608a1551b747130ac4f1e41f547" name="a5e07d608a1551b747130ac4f1e41f547"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e07d608a1551b747130ac4f1e41f547">&#9670;&#160;</a></span>extention_matches_script()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int extention_matches_script </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>filename</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07504">7504</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7508</span>{</div>
<div class="line"><span class="lineno"> 7509</span><span class="preprocessor">#if !defined(NO_CGI)</span></div>
<div class="line"><span class="lineno"> 7510</span>    <span class="keywordtype">int</span> cgi_config_idx, inc, max;</div>
<div class="line"><span class="lineno"> 7511</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 7512</span> </div>
<div class="line"><span class="lineno"> 7513</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno"> 7514</span>    <span class="keywordflow">if</span> (match_prefix_strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[LUA_SCRIPT_EXTENSIONS],</div>
<div class="line"><span class="lineno"> 7515</span>                            filename)</div>
<div class="line"><span class="lineno"> 7516</span>        &gt; 0) {</div>
<div class="line"><span class="lineno"> 7517</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 7518</span>    }</div>
<div class="line"><span class="lineno"> 7519</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 7520</span><span class="preprocessor">#if defined(USE_DUKTAPE)</span></div>
<div class="line"><span class="lineno"> 7521</span>    <span class="keywordflow">if</span> (match_prefix_strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[DUKTAPE_SCRIPT_EXTENSIONS],</div>
<div class="line"><span class="lineno"> 7522</span>                            filename)</div>
<div class="line"><span class="lineno"> 7523</span>        &gt; 0) {</div>
<div class="line"><span class="lineno"> 7524</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 7525</span>    }</div>
<div class="line"><span class="lineno"> 7526</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 7527</span><span class="preprocessor">#if !defined(NO_CGI)</span></div>
<div class="line"><span class="lineno"> 7528</span>    inc = <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba5d225462bc3b0836805df00f580cb7ea">CGI2_EXTENSIONS</a> - <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a>;</div>
<div class="line"><span class="lineno"> 7529</span>    max = <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba9f0c9561bdb0b2b975178617c8d3c59a">PUT_DELETE_PASSWORDS_FILE</a> - <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a>;</div>
<div class="line"><span class="lineno"> 7530</span>    <span class="keywordflow">for</span> (cgi_config_idx = 0; cgi_config_idx &lt; max; cgi_config_idx += inc) {</div>
<div class="line"><span class="lineno"> 7531</span>        <span class="keywordflow">if</span> ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a> + cgi_config_idx] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno"> 7532</span>            &amp;&amp; (match_prefix_strlen(</div>
<div class="line"><span class="lineno"> 7533</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a> + cgi_config_idx],</div>
<div class="line"><span class="lineno"> 7534</span>                    filename)</div>
<div class="line"><span class="lineno"> 7535</span>                &gt; 0)) {</div>
<div class="line"><span class="lineno"> 7536</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 7537</span>        }</div>
<div class="line"><span class="lineno"> 7538</span>    }</div>
<div class="line"><span class="lineno"> 7539</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 7540</span>    <span class="comment">/* filename and conn could be unused, if all preocessor conditions</span></div>
<div class="line"><span class="lineno"> 7541</span><span class="comment">     * are false (no script language supported). */</span></div>
<div class="line"><span class="lineno"> 7542</span>    (void)filename;</div>
<div class="line"><span class="lineno"> 7543</span>    (void)conn;</div>
<div class="line"><span class="lineno"> 7544</span> </div>
<div class="line"><span class="lineno"> 7545</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 7546</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01968">CGI2_EXTENSIONS</a>, <a class="el" href="civetweb_8c_source.html#l01959">CGI_EXTENSIONS</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l01997">PUT_DELETE_PASSWORDS_FILE</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>.</p>

</div>
</div>
<a id="ac32269ba42b000939c92b695049fe0be" name="ac32269ba42b000939c92b695049fe0be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac32269ba42b000939c92b695049fe0be">&#9670;&#160;</a></span>extention_matches_template_text()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int extention_matches_template_text </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>filename</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07550">7550</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7554</span>{</div>
<div class="line"><span class="lineno"> 7555</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno"> 7556</span>    <span class="keywordflow">if</span> (match_prefix_strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[LUA_SERVER_PAGE_EXTENSIONS],</div>
<div class="line"><span class="lineno"> 7557</span>                            filename)</div>
<div class="line"><span class="lineno"> 7558</span>        &gt; 0) {</div>
<div class="line"><span class="lineno"> 7559</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 7560</span>    }</div>
<div class="line"><span class="lineno"> 7561</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 7562</span>    <span class="keywordflow">if</span> (match_prefix_strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad759d92bd3b0e4870bb7d92ad10399b4">SSI_EXTENSIONS</a>], filename)</div>
<div class="line"><span class="lineno"> 7563</span>        &gt; 0) {</div>
<div class="line"><span class="lineno"> 7564</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 7565</span>    }</div>
<div class="line"><span class="lineno"> 7566</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 7567</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, and <a class="el" href="civetweb_8c_source.html#l02001">SSI_EXTENSIONS</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>.</p>

</div>
</div>
<a id="a46e65877beedb5fed507ad30dbf76d86" name="a46e65877beedb5fed507ad30dbf76d86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46e65877beedb5fed507ad30dbf76d86">&#9670;&#160;</a></span>fake_connection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structmg__connection.html">mg_connection</a> * fake_connection </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>fc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03470">3470</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3471</span>{</div>
<div class="line"><span class="lineno"> 3472</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> conn_zero = {0};</div>
<div class="line"><span class="lineno"> 3473</span>    *fc = conn_zero;</div>
<div class="line"><span class="lineno"> 3474</span>    fc-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a> = ctx;</div>
<div class="line"><span class="lineno"> 3475</span>    fc-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> = &amp;(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>);</div>
<div class="line"><span class="lineno"> 3476</span>    <span class="keywordflow">return</span> fc;</div>
<div class="line"><span class="lineno"> 3477</span>}</div>
<div class="ttc" id="astructmg__connection_html"><div class="ttname"><a href="structmg__connection.html">mg_connection</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02485">civetweb.c:2485</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, and <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, <a class="el" href="civetweb_8c_source.html#l03481">mg_cry_internal_wrap()</a>, <a class="el" href="civetweb_8c_source.html#l05677">set_close_on_exec()</a>, and <a class="el" href="civetweb_8c_source.html#l17636">set_gpass_option()</a>.</p>

</div>
</div>
<a id="a66af55875eb933f2969b8bed72ab9ef4" name="a66af55875eb933f2969b8bed72ab9ef4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66af55875eb933f2969b8bed72ab9ef4">&#9670;&#160;</a></span>fclose_on_exec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void fclose_on_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__file__access.html">mg_file_access</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10196">10196</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10197</span>{</div>
<div class="line"><span class="lineno">10198</span>    <span class="keywordflow">if</span> (filep != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; filep-&gt;<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">10199</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">10200</span>        (void)conn; <span class="comment">/* Unused. */</span></div>
<div class="line"><span class="lineno">10201</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">10202</span>        <span class="keywordflow">if</span> (fcntl(fileno(filep-&gt;<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a>), F_SETFD, FD_CLOEXEC) != 0) {</div>
<div class="line"><span class="lineno">10203</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">10204</span>                            <span class="stringliteral">&quot;%s: fcntl(F_SETFD FD_CLOEXEC) failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno">10205</span>                            __func__,</div>
<div class="line"><span class="lineno">10206</span>                            strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">10207</span>        }</div>
<div class="line"><span class="lineno">10208</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">10209</span>    }</div>
<div class="line"><span class="lineno">10210</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10451">mg_send_file_body()</a>, and <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>.</p>

</div>
</div>
<a id="a6b0ac164cc67271e3819e1d6c967ef95" name="a6b0ac164cc67271e3819e1d6c967ef95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b0ac164cc67271e3819e1d6c967ef95">&#9670;&#160;</a></span>forward_body_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int forward_body_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *</td>          <td class="paramname"><span class="paramname"><em>fp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a></td>          <td class="paramname"><span class="paramname"><em>sock</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL *</td>          <td class="paramname"><span class="paramname"><em>ssl</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l11184">11184</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">11185</span>{</div>
<div class="line"><span class="lineno">11186</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *expect;</div>
<div class="line"><span class="lineno">11187</span>    <span class="keywordtype">char</span> buf[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno">11188</span>    <span class="keywordtype">int</span> success = 0;</div>
<div class="line"><span class="lineno">11189</span> </div>
<div class="line"><span class="lineno">11190</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno">11191</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">11192</span>    }</div>
<div class="line"><span class="lineno">11193</span> </div>
<div class="line"><span class="lineno">11194</span>    expect = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Expect&quot;</span>);</div>
<div class="line"><span class="lineno">11195</span>    <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(fp != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">11196</span>    <span class="keywordflow">if</span> (!fp) {</div>
<div class="line"><span class="lineno">11197</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 500, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Error: NULL File&quot;</span>);</div>
<div class="line"><span class="lineno">11198</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">11199</span>    }</div>
<div class="line"><span class="lineno">11200</span> </div>
<div class="line"><span class="lineno">11201</span>    <span class="keywordflow">if</span> ((expect != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(expect, <span class="stringliteral">&quot;100-continue&quot;</span>) != 0)) {</div>
<div class="line"><span class="lineno">11202</span>        <span class="comment">/* Client sent an &quot;Expect: xyz&quot; header and xyz is not 100-continue.</span></div>
<div class="line"><span class="lineno">11203</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">11204</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 417, <span class="stringliteral">&quot;Error: Can not fulfill expectation&quot;</span>);</div>
<div class="line"><span class="lineno">11205</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11206</span>        <span class="keywordflow">if</span> (expect != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11207</span>            (void)<a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;HTTP/1.1 100 Continue\r\n\r\n&quot;</span>);</div>
<div class="line"><span class="lineno">11208</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 100;</div>
<div class="line"><span class="lineno">11209</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11210</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 200;</div>
<div class="line"><span class="lineno">11211</span>        }</div>
<div class="line"><span class="lineno">11212</span> </div>
<div class="line"><span class="lineno">11213</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a> == 0);</div>
<div class="line"><span class="lineno">11214</span> </div>
<div class="line"><span class="lineno">11215</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a> != 0) {</div>
<div class="line"><span class="lineno">11216</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 500, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Error: Size mismatch&quot;</span>);</div>
<div class="line"><span class="lineno">11217</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">11218</span>        }</div>
<div class="line"><span class="lineno">11219</span> </div>
<div class="line"><span class="lineno">11220</span>        <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno">11221</span>            <span class="keywordtype">int</span> nread = <a class="code hl_function" href="#afeb3b13a0524f5532d16953927743966">mg_read</a>(conn, buf, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">11222</span>            <span class="keywordflow">if</span> (nread &lt;= 0) {</div>
<div class="line"><span class="lineno">11223</span>                success = (nread == 0);</div>
<div class="line"><span class="lineno">11224</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">11225</span>            }</div>
<div class="line"><span class="lineno">11226</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#ab855e2c5d4e7913fb2138a9909c8caca">push_all</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>, fp, sock, ssl, buf, nread) != nread) {</div>
<div class="line"><span class="lineno">11227</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">11228</span>            }</div>
<div class="line"><span class="lineno">11229</span>        }</div>
<div class="line"><span class="lineno">11230</span> </div>
<div class="line"><span class="lineno">11231</span>        <span class="comment">/* Each error code path in this function must send an error */</span></div>
<div class="line"><span class="lineno">11232</span>        <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno">11233</span>            <span class="comment">/* NOTE: Maybe some data has already been sent. */</span></div>
<div class="line"><span class="lineno">11234</span>            <span class="comment">/* TODO (low): If some data has been sent, a correct error</span></div>
<div class="line"><span class="lineno">11235</span><span class="comment">             * reply can no longer be sent, so just close the connection */</span></div>
<div class="line"><span class="lineno">11236</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 500, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">11237</span>        }</div>
<div class="line"><span class="lineno">11238</span>    }</div>
<div class="line"><span class="lineno">11239</span> </div>
<div class="line"><span class="lineno">11240</span>    <span class="keywordflow">return</span> success;</div>
<div class="line"><span class="lineno">11241</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a5687826f07a383abedc6329b6a07f40b"><div class="ttname"><a href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a></div><div class="ttdeci">#define DEBUG_ASSERT(cond)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00260">civetweb.c:260</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ab855e2c5d4e7913fb2138a9909c8caca"><div class="ttname"><a href="#ab855e2c5d4e7913fb2138a9909c8caca">push_all</a></div><div class="ttdeci">static int push_all(struct mg_context *ctx, FILE *fp, SOCKET sock, SSL *ssl, const char *buf, int len)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06162">civetweb.c:6162</a></div></div>
<div class="ttc" id="astructmg__connection_html_a271e16e618bd9265577aef7ef5ed637d"><div class="ttname"><a href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">mg_connection::consumed_content</a></div><div class="ttdeci">int64_t consumed_content</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02524">civetweb.c:2524</a></div></div>
<div class="ttc" id="astructmg__connection_html_ae0163f2496aed16dc972e2139b66bb93"><div class="ttname"><a href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">mg_connection::status_code</a></div><div class="ttdeci">int status_code</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02559">civetweb.c:2559</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02524">mg_connection::consumed_content</a>, <a class="el" href="civetweb_8c_source.html#l00260">DEBUG_ASSERT</a>, <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="civetweb_8c_source.html#l06614">mg_read()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l06162">push_all()</a>, and <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, and <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>.</p>

</div>
</div>
<a id="ac591487b5ffc826f4824c8c1d9a4caaa" name="ac591487b5ffc826f4824c8c1d9a4caaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac591487b5ffc826f4824c8c1d9a4caaa">&#9670;&#160;</a></span>free_context()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void free_context </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l20249">20249</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">20250</span>{</div>
<div class="line"><span class="lineno">20251</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">20252</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__handler__info.html">mg_handler_info</a> *tmp_rh;</div>
<div class="line"><span class="lineno">20253</span> </div>
<div class="line"><span class="lineno">20254</span>    <span class="keywordflow">if</span> (ctx == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20255</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">20256</span>    }</div>
<div class="line"><span class="lineno">20257</span> </div>
<div class="line"><span class="lineno">20258</span>    <span class="comment">/* Call user callback */</span></div>
<div class="line"><span class="lineno">20259</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a83dd2d98afc49aeef8f1083034da3659">exit_context</a>) {</div>
<div class="line"><span class="lineno">20260</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a83dd2d98afc49aeef8f1083034da3659">exit_context</a>(ctx);</div>
<div class="line"><span class="lineno">20261</span>    }</div>
<div class="line"><span class="lineno">20262</span> </div>
<div class="line"><span class="lineno">20263</span>    <span class="comment">/* All threads exited, no sync is needed. Destroy thread mutex and</span></div>
<div class="line"><span class="lineno">20264</span><span class="comment">     * condvars</span></div>
<div class="line"><span class="lineno">20265</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">20266</span>    (void)pthread_mutex_destroy(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">thread_mutex</a>);</div>
<div class="line"><span class="lineno">20267</span> </div>
<div class="line"><span class="lineno">20268</span><span class="preprocessor">#if defined(ALTERNATIVE_QUEUE)</span></div>
<div class="line"><span class="lineno">20269</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;client_socks);</div>
<div class="line"><span class="lineno">20270</span>    <span class="keywordflow">if</span> (ctx-&gt;client_wait_events != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20271</span>        <span class="keywordflow">for</span> (i = 0; (unsigned)i &lt; ctx-&gt;cfg_worker_threads; i++) {</div>
<div class="line"><span class="lineno">20272</span>            event_destroy(ctx-&gt;client_wait_events[i]);</div>
<div class="line"><span class="lineno">20273</span>        }</div>
<div class="line"><span class="lineno">20274</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;client_wait_events);</div>
<div class="line"><span class="lineno">20275</span>    }</div>
<div class="line"><span class="lineno">20276</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">20277</span>    (void)pthread_cond_destroy(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a3260d5fc8e16e35026d7d2bbcb10abf5">sq_empty</a>);</div>
<div class="line"><span class="lineno">20278</span>    (void)pthread_cond_destroy(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aad49398eacc039c312d58c55530c65fa">sq_full</a>);</div>
<div class="line"><span class="lineno">20279</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a49b598c1205bc368042ca530011e3316">squeue</a>);</div>
<div class="line"><span class="lineno">20280</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20281</span> </div>
<div class="line"><span class="lineno">20282</span>    <span class="comment">/* Destroy other context global data structures mutex */</span></div>
<div class="line"><span class="lineno">20283</span>    (void)pthread_mutex_destroy(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afc4b8c1d52b30239820683d842e975fe">nonce_mutex</a>);</div>
<div class="line"><span class="lineno">20284</span> </div>
<div class="line"><span class="lineno">20285</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">20286</span>    (void)pthread_mutex_destroy(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">20287</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20288</span> </div>
<div class="line"><span class="lineno">20289</span>    <span class="comment">/* Deallocate config parameters */</span></div>
<div class="line"><span class="lineno">20290</span>    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa287c83808b815cdf6a1c2756b6332f1">NUM_OPTIONS</a>; i++) {</div>
<div class="line"><span class="lineno">20291</span>        <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[i] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20292</span><span class="preprocessor">#if defined(_MSC_VER)</span></div>
<div class="line"><span class="lineno">20293</span><span class="preprocessor">#pragma warning(suppress : 6001)</span></div>
<div class="line"><span class="lineno">20294</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20295</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[i]);</div>
<div class="line"><span class="lineno">20296</span>        }</div>
<div class="line"><span class="lineno">20297</span>    }</div>
<div class="line"><span class="lineno">20298</span> </div>
<div class="line"><span class="lineno">20299</span>    <span class="comment">/* Deallocate request handlers */</span></div>
<div class="line"><span class="lineno">20300</span>    <span class="keywordflow">while</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#af15ef8d6a276c40c4caeeba414e20aff">handlers</a>) {</div>
<div class="line"><span class="lineno">20301</span>        tmp_rh = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#af15ef8d6a276c40c4caeeba414e20aff">handlers</a>;</div>
<div class="line"><span class="lineno">20302</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#af15ef8d6a276c40c4caeeba414e20aff">handlers</a> = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a4bfd90da42444fa125cbf0c8ca5d0f8d">next</a>;</div>
<div class="line"><span class="lineno">20303</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>);</div>
<div class="line"><span class="lineno">20304</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(tmp_rh);</div>
<div class="line"><span class="lineno">20305</span>    }</div>
<div class="line"><span class="lineno">20306</span> </div>
<div class="line"><span class="lineno">20307</span><span class="preprocessor">#if defined(USE_MBEDTLS)</span></div>
<div class="line"><span class="lineno">20308</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20309</span>        mbed_sslctx_uninit(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>);</div>
<div class="line"><span class="lineno">20310</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>);</div>
<div class="line"><span class="lineno">20311</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20312</span>    }</div>
<div class="line"><span class="lineno">20313</span> </div>
<div class="line"><span class="lineno">20314</span><span class="preprocessor">#elif !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno">20315</span>    <span class="comment">/* Deallocate SSL context */</span></div>
<div class="line"><span class="lineno">20316</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20317</span>        <span class="keywordtype">void</span> *ssl_ctx = (<span class="keywordtype">void</span> *)ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>;</div>
<div class="line"><span class="lineno">20318</span>        <span class="keywordtype">int</span> callback_ret =</div>
<div class="line"><span class="lineno">20319</span>            (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aa2b516914e543464e16033e16481f6fe">external_ssl_ctx</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">20320</span>                ? 0</div>
<div class="line"><span class="lineno">20321</span>                : (ctx-&gt;callbacks.external_ssl_ctx(&amp;ssl_ctx, ctx-&gt;user_data));</div>
<div class="line"><span class="lineno">20322</span> </div>
<div class="line"><span class="lineno">20323</span>        <span class="keywordflow">if</span> (callback_ret == 0) {</div>
<div class="line"><span class="lineno">20324</span>            SSL_CTX_free(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>);</div>
<div class="line"><span class="lineno">20325</span>        }</div>
<div class="line"><span class="lineno">20326</span>        <span class="comment">/* else: ignore error and omit SSL_CTX_free in case</span></div>
<div class="line"><span class="lineno">20327</span><span class="comment">         * callback_ret is 1 */</span></div>
<div class="line"><span class="lineno">20328</span>    }</div>
<div class="line"><span class="lineno">20329</span><span class="preprocessor">#endif </span><span class="comment">/* !NO_SSL */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">20330</span> </div>
<div class="line"><span class="lineno">20331</span>    <span class="comment">/* Deallocate worker thread ID array */</span></div>
<div class="line"><span class="lineno">20332</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>);</div>
<div class="line"><span class="lineno">20333</span> </div>
<div class="line"><span class="lineno">20334</span>    <span class="comment">/* Deallocate worker thread ID array */</span></div>
<div class="line"><span class="lineno">20335</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a854d7b5d783f951cb08e2aeed380c481">worker_connections</a>);</div>
<div class="line"><span class="lineno">20336</span> </div>
<div class="line"><span class="lineno">20337</span>    <span class="comment">/* deallocate system name string */</span></div>
<div class="line"><span class="lineno">20338</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8b39174e87cb0b5df1b093066256b2f1">systemName</a>);</div>
<div class="line"><span class="lineno">20339</span> </div>
<div class="line"><span class="lineno">20340</span>    <span class="comment">/* Deallocate context itself */</span></div>
<div class="line"><span class="lineno">20341</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx);</div>
<div class="line"><span class="lineno">20342</span>}</div>
<div class="ttc" id="astructmg__callbacks_html_a83dd2d98afc49aeef8f1083034da3659"><div class="ttname"><a href="structmg__callbacks.html#a83dd2d98afc49aeef8f1083034da3659">mg_callbacks::exit_context</a></div><div class="ttdeci">void(* exit_context)(const struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00372">civetweb.h:372</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_aa2b516914e543464e16033e16481f6fe"><div class="ttname"><a href="structmg__callbacks.html#aa2b516914e543464e16033e16481f6fe">mg_callbacks::external_ssl_ctx</a></div><div class="ttdeci">int(* external_ssl_ctx)(void **ssl_ctx, void *user_data)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00278">civetweb.h:278</a></div></div>
<div class="ttc" id="astructmg__context_html_a50c65eb1270eecad5834817246d86f2b"><div class="ttname"><a href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">mg_context::worker_threadids</a></div><div class="ttdeci">pthread_t * worker_threadids</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02379">civetweb.c:2379</a></div></div>
<div class="ttc" id="astructmg__context_html_a854d7b5d783f951cb08e2aeed380c481"><div class="ttname"><a href="structmg__context.html#a854d7b5d783f951cb08e2aeed380c481">mg_context::worker_connections</a></div><div class="ttdeci">struct mg_connection * worker_connections</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02360">civetweb.c:2360</a></div></div>
<div class="ttc" id="astructmg__context_html_a8b39174e87cb0b5df1b093066256b2f1"><div class="ttname"><a href="structmg__context.html#a8b39174e87cb0b5df1b093066256b2f1">mg_context::systemName</a></div><div class="ttdeci">char * systemName</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02411">civetweb.c:2411</a></div></div>
<div class="ttc" id="astructmg__context_html_afc4b8c1d52b30239820683d842e975fe"><div class="ttname"><a href="structmg__context.html#afc4b8c1d52b30239820683d842e975fe">mg_context::nonce_mutex</a></div><div class="ttdeci">pthread_mutex_t nonce_mutex</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02427">civetweb.c:2427</a></div></div>
<div class="ttc" id="astructmg__domain__context_html_ad3a7a314204d9bb7fc0af8bccf826e58"><div class="ttname"><a href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">mg_domain_context::ssl_ctx</a></div><div class="ttdeci">SSL_CTX * ssl_ctx</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02270">civetweb.c:2270</a></div></div>
<div class="ttc" id="astructmg__domain__context_html_af15ef8d6a276c40c4caeeba414e20aff"><div class="ttname"><a href="structmg__domain__context.html#af15ef8d6a276c40c4caeeba414e20aff">mg_domain_context::handlers</a></div><div class="ttdeci">struct mg_handler_info * handlers</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02272">civetweb.c:2272</a></div></div>
<div class="ttc" id="astructmg__handler__info_html"><div class="ttname"><a href="structmg__handler__info.html">mg_handler_info</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02228">civetweb.c:2228</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_a4bfd90da42444fa125cbf0c8ca5d0f8d"><div class="ttname"><a href="structmg__handler__info.html#a4bfd90da42444fa125cbf0c8ca5d0f8d">mg_handler_info::next</a></div><div class="ttdeci">struct mg_handler_info * next</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02257">civetweb.c:2257</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_a6df1d0bf772ff0cc74e912b0ffb7264f"><div class="ttname"><a href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">mg_handler_info::uri</a></div><div class="ttdeci">char * uri</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02230">civetweb.c:2230</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8h_source.html#l00372">mg_callbacks::exit_context</a>, <a class="el" href="civetweb_8h_source.html#l00278">mg_callbacks::external_ssl_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02272">mg_domain_context::handlers</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l02257">mg_handler_info::next</a>, <a class="el" href="civetweb_8c_source.html#l02427">mg_context::nonce_mutex</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02055">NUM_OPTIONS</a>, <a class="el" href="civetweb_8c_source.html#l02392">mg_context::sq_empty</a>, <a class="el" href="civetweb_8c_source.html#l02391">mg_context::sq_full</a>, <a class="el" href="civetweb_8c_source.html#l02387">mg_context::squeue</a>, <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02411">mg_context::systemName</a>, <a class="el" href="civetweb_8c_source.html#l02374">mg_context::thread_mutex</a>, <a class="el" href="civetweb_8c_source.html#l02230">mg_handler_info::uri</a>, <a class="el" href="civetweb_8c_source.html#l02433">mg_context::user_data</a>, <a class="el" href="civetweb_8c_source.html#l02360">mg_context::worker_connections</a>, and <a class="el" href="civetweb_8c_source.html#l02379">mg_context::worker_threadids</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, and <a class="el" href="civetweb_8c_source.html#l20346">mg_stop()</a>.</p>

</div>
</div>
<a id="a73891c07a6e6af73b5b247b460c62bb3" name="a73891c07a6e6af73b5b247b460c62bb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73891c07a6e6af73b5b247b460c62bb3">&#9670;&#160;</a></span>get_first_ssl_listener_index()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_first_ssl_listener_index </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14121">14121</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14122</span>{</div>
<div class="line"><span class="lineno">14123</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">14124</span>    <span class="keywordtype">int</span> idx = -1;</div>
<div class="line"><span class="lineno">14125</span>    <span class="keywordflow">if</span> (ctx) {</div>
<div class="line"><span class="lineno">14126</span>        <span class="keywordflow">for</span> (i = 0; ((idx == -1) &amp;&amp; (i &lt; ctx-&gt;num_listening_sockets)); i++) {</div>
<div class="line"><span class="lineno">14127</span>            idx = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#a2d1d5b8ef7da25d5e7e666e023a9b733">is_ssl</a> ? ((int)(i)) : -1;</div>
<div class="line"><span class="lineno">14128</span>        }</div>
<div class="line"><span class="lineno">14129</span>    }</div>
<div class="line"><span class="lineno">14130</span>    <span class="keywordflow">return</span> idx;</div>
<div class="line"><span class="lineno">14131</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01906">socket::is_ssl</a>, and <a class="el" href="civetweb_8c_source.html#l02356">mg_context::listening_sockets</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a67c4b5d95b3233717b80963b979724da" name="a67c4b5d95b3233717b80963b979724da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67c4b5d95b3233717b80963b979724da">&#9670;&#160;</a></span>get_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * get_header </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__header.html">mg_header</a> *</td>          <td class="paramname"><span class="paramname"><em>hdr</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>num_hdr</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03820">3820</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3821</span>{</div>
<div class="line"><span class="lineno"> 3822</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno"> 3823</span>    <span class="keywordflow">for</span> (i = 0; i &lt; num_hdr; i++) {</div>
<div class="line"><span class="lineno"> 3824</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, hdr[i].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)) {</div>
<div class="line"><span class="lineno"> 3825</span>            <span class="keywordflow">return</span> hdr[i].<a class="code hl_variable" href="structmg__header.html#a9cdd7ef80ee309a6de14684059081d0d">value</a>;</div>
<div class="line"><span class="lineno"> 3826</span>        }</div>
<div class="line"><span class="lineno"> 3827</span>    }</div>
<div class="line"><span class="lineno"> 3828</span> </div>
<div class="line"><span class="lineno"> 3829</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3830</span>}</div>
<div class="ttc" id="alsqlite3_8c_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition</b> <a href="lsqlite3_8c_source.html#l02154">lsqlite3.c:2154</a></div></div>
<div class="ttc" id="astructmg__header_html_a9cdd7ef80ee309a6de14684059081d0d"><div class="ttname"><a href="structmg__header.html#a9cdd7ef80ee309a6de14684059081d0d">mg_header::value</a></div><div class="ttdeci">const char * value</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00145">civetweb.h:145</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8h_source.html#l00145">mg_header::value</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14136">get_host_from_request_info()</a>, <a class="el" href="civetweb_8c_source.html#l18645">get_request()</a>, <a class="el" href="civetweb_8c_source.html#l18737">get_response()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>.</p>

</div>
</div>
<a id="a5e23406129bfd98c4cbc037682b22343" name="a5e23406129bfd98c4cbc037682b22343"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e23406129bfd98c4cbc037682b22343">&#9670;&#160;</a></span>get_host_from_request_info()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void get_host_from_request_info </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvec.html">vec</a> *</td>          <td class="paramname"><span class="paramname"><em>host</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmg__request__info.html">mg_request_info</a> *</td>          <td class="paramname"><span class="paramname"><em>ri</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14136">14136</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14137</span>{</div>
<div class="line"><span class="lineno">14138</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *host_header =</div>
<div class="line"><span class="lineno">14139</span>        <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a>, <span class="stringliteral">&quot;Host&quot;</span>);</div>
<div class="line"><span class="lineno">14140</span> </div>
<div class="line"><span class="lineno">14141</span>    host-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14142</span>    host-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = 0;</div>
<div class="line"><span class="lineno">14143</span> </div>
<div class="line"><span class="lineno">14144</span>    <span class="keywordflow">if</span> (host_header != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14145</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *pos;</div>
<div class="line"><span class="lineno">14146</span> </div>
<div class="line"><span class="lineno">14147</span>        <span class="comment">/* If the &quot;Host&quot; is an IPv6 address, like [::1], parse until ]</span></div>
<div class="line"><span class="lineno">14148</span><span class="comment">         * is found. */</span></div>
<div class="line"><span class="lineno">14149</span>        <span class="keywordflow">if</span> (*host_header == <span class="charliteral">&#39;[&#39;</span>) {</div>
<div class="line"><span class="lineno">14150</span>            pos = strchr(host_header, <span class="charliteral">&#39;]&#39;</span>);</div>
<div class="line"><span class="lineno">14151</span>            <span class="keywordflow">if</span> (!pos) {</div>
<div class="line"><span class="lineno">14152</span>                <span class="comment">/* Malformed hostname starts with &#39;[&#39;, but no &#39;]&#39; found */</span></div>
<div class="line"><span class="lineno">14153</span>                <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Host name format error &#39;[&#39; without &#39;]&#39;&quot;</span>);</div>
<div class="line"><span class="lineno">14154</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14155</span>            }</div>
<div class="line"><span class="lineno">14156</span>            <span class="comment">/* terminate after &#39;]&#39; */</span></div>
<div class="line"><span class="lineno">14157</span>            host-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> = host_header;</div>
<div class="line"><span class="lineno">14158</span>            host-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = (size_t)(pos + 1 - host_header);</div>
<div class="line"><span class="lineno">14159</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14160</span>            <span class="comment">/* Otherwise, a &#39;:&#39; separates hostname and port number */</span></div>
<div class="line"><span class="lineno">14161</span>            pos = strchr(host_header, <span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line"><span class="lineno">14162</span>            <span class="keywordflow">if</span> (pos != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14163</span>                host-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = (size_t)(pos - host_header);</div>
<div class="line"><span class="lineno">14164</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14165</span>                host-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = strlen(host_header);</div>
<div class="line"><span class="lineno">14166</span>            }</div>
<div class="line"><span class="lineno">14167</span>            host-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> = host_header;</div>
<div class="line"><span class="lineno">14168</span>        }</div>
<div class="line"><span class="lineno">14169</span>    }</div>
<div class="line"><span class="lineno">14170</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a67c4b5d95b3233717b80963b979724da"><div class="ttname"><a href="#a67c4b5d95b3233717b80963b979724da">get_header</a></div><div class="ttdeci">static const char * get_header(const struct mg_header *hdr, int num_hdr, const char *name)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03820">civetweb.c:3820</a></div></div>
<div class="ttc" id="astructmg__request__info_html_a2337d14061022518280f4e647c72a20b"><div class="ttname"><a href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">mg_request_info::http_headers</a></div><div class="ttdeci">struct mg_header http_headers[MG_MAX_HEADERS]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00180">civetweb.h:179</a></div></div>
<div class="ttc" id="astructmg__request__info_html_afcdf69ee822fd9786f3e30c6d10b192a"><div class="ttname"><a href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">mg_request_info::num_headers</a></div><div class="ttdeci">int num_headers</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00178">civetweb.h:178</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l03820">get_header()</a>, <a class="el" href="civetweb_8h_source.html#l00179">mg_request_info::http_headers</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00178">mg_request_info::num_headers</a>, and <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14174">switch_domain_context()</a>.</p>

</div>
</div>
<a id="aac32d22dcddea6592a3772d746edf5bb" name="aac32d22dcddea6592a3772d746edf5bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac32d22dcddea6592a3772d746edf5bb">&#9670;&#160;</a></span>get_http_header_len()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_http_header_len </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>buflen</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07952">7952</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7953</span>{</div>
<div class="line"><span class="lineno"> 7954</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno"> 7955</span>    <span class="keywordflow">for</span> (i = 0; i &lt; buflen; i++) {</div>
<div class="line"><span class="lineno"> 7956</span>        <span class="comment">/* Do an unsigned comparison in some conditions below */</span></div>
<div class="line"><span class="lineno"> 7957</span>        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = (<span class="keywordtype">unsigned</span> char)buf[i];</div>
<div class="line"><span class="lineno"> 7958</span> </div>
<div class="line"><span class="lineno"> 7959</span>        <span class="keywordflow">if</span> ((c &lt; 128) &amp;&amp; ((char)c != <span class="charliteral">&#39;\r&#39;</span>) &amp;&amp; ((char)c != <span class="charliteral">&#39;\n&#39;</span>)</div>
<div class="line"><span class="lineno"> 7960</span>            &amp;&amp; !isprint(c)) {</div>
<div class="line"><span class="lineno"> 7961</span>            <span class="comment">/* abort scan as soon as one malformed character is found */</span></div>
<div class="line"><span class="lineno"> 7962</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 7963</span>        }</div>
<div class="line"><span class="lineno"> 7964</span> </div>
<div class="line"><span class="lineno"> 7965</span>        <span class="keywordflow">if</span> (i &lt; buflen - 1) {</div>
<div class="line"><span class="lineno"> 7966</span>            <span class="keywordflow">if</span> ((buf[i] == <span class="charliteral">&#39;\n&#39;</span>) &amp;&amp; (buf[i + 1] == <span class="charliteral">&#39;\n&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 7967</span>                <span class="comment">/* Two newline, no carriage return - not standard compliant,</span></div>
<div class="line"><span class="lineno"> 7968</span><span class="comment">                 * but it should be accepted */</span></div>
<div class="line"><span class="lineno"> 7969</span>                <span class="keywordflow">return</span> i + 2;</div>
<div class="line"><span class="lineno"> 7970</span>            }</div>
<div class="line"><span class="lineno"> 7971</span>        }</div>
<div class="line"><span class="lineno"> 7972</span> </div>
<div class="line"><span class="lineno"> 7973</span>        <span class="keywordflow">if</span> (i &lt; buflen - 3) {</div>
<div class="line"><span class="lineno"> 7974</span>            <span class="keywordflow">if</span> ((buf[i] == <span class="charliteral">&#39;\r&#39;</span>) &amp;&amp; (buf[i + 1] == <span class="charliteral">&#39;\n&#39;</span>) &amp;&amp; (buf[i + 2] == <span class="charliteral">&#39;\r&#39;</span>)</div>
<div class="line"><span class="lineno"> 7975</span>                &amp;&amp; (buf[i + 3] == <span class="charliteral">&#39;\n&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 7976</span>                <span class="comment">/* Two \r\n - standard compliant */</span></div>
<div class="line"><span class="lineno"> 7977</span>                <span class="keywordflow">return</span> i + 4;</div>
<div class="line"><span class="lineno"> 7978</span>            }</div>
<div class="line"><span class="lineno"> 7979</span>        }</div>
<div class="line"><span class="lineno"> 7980</span>    }</div>
<div class="line"><span class="lineno"> 7981</span> </div>
<div class="line"><span class="lineno"> 7982</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 7983</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10915">parse_http_request()</a>, <a class="el" href="civetweb_8c_source.html#l11001">parse_http_response()</a>, and <a class="el" href="civetweb_8c_source.html#l11107">read_message()</a>.</p>

</div>
</div>
<a id="a4291431186c67ce74663a2f32ec7dce4" name="a4291431186c67ce74663a2f32ec7dce4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4291431186c67ce74663a2f32ec7dce4">&#9670;&#160;</a></span>get_http_method_info()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const struct <a class="el" href="structmg__http__method__info.html">mg_http_method_info</a> * get_http_method_info </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>method</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10880">10880</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10881</span>{</div>
<div class="line"><span class="lineno">10882</span>    <span class="comment">/* Check if the method is known to the server. The list of all known</span></div>
<div class="line"><span class="lineno">10883</span><span class="comment">     * HTTP methods can be found here at</span></div>
<div class="line"><span class="lineno">10884</span><span class="comment">     * http://www.iana.org/assignments/http-methods/http-methods.xhtml</span></div>
<div class="line"><span class="lineno">10885</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">10886</span>    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structmg__http__method__info.html">mg_http_method_info</a> *m = <a class="code hl_variable" href="#a7b17944603d3fb09046b30ffef0cbfc6">http_methods</a>;</div>
<div class="line"><span class="lineno">10887</span> </div>
<div class="line"><span class="lineno">10888</span>    <span class="keywordflow">while</span> (m-&gt;<a class="code hl_variable" href="structmg__http__method__info.html#afb93afda546e6a8fc26e135c7b1a15f6">name</a>) {</div>
<div class="line"><span class="lineno">10889</span>        <span class="keywordflow">if</span> (!strcmp(m-&gt;<a class="code hl_variable" href="structmg__http__method__info.html#afb93afda546e6a8fc26e135c7b1a15f6">name</a>, method)) {</div>
<div class="line"><span class="lineno">10890</span>            <span class="keywordflow">return</span> m;</div>
<div class="line"><span class="lineno">10891</span>        }</div>
<div class="line"><span class="lineno">10892</span>        m++;</div>
<div class="line"><span class="lineno">10893</span>    }</div>
<div class="line"><span class="lineno">10894</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">10895</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a7b17944603d3fb09046b30ffef0cbfc6"><div class="ttname"><a href="#a7b17944603d3fb09046b30ffef0cbfc6">http_methods</a></div><div class="ttdeci">static const struct mg_http_method_info http_methods[]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10813">civetweb.c:10813</a></div></div>
<div class="ttc" id="astructmg__http__method__info_html"><div class="ttname"><a href="structmg__http__method__info.html">mg_http_method_info</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10802">civetweb.c:10802</a></div></div>
<div class="ttc" id="astructmg__http__method__info_html_afb93afda546e6a8fc26e135c7b1a15f6"><div class="ttname"><a href="structmg__http__method__info.html#afb93afda546e6a8fc26e135c7b1a15f6">mg_http_method_info::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10803">civetweb.c:10803</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l10813">http_methods</a>, <a class="el" href="civetweb_8c_source.html#l10803">mg_http_method_info::name</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10899">is_valid_http_method()</a>.</p>

</div>
</div>
<a id="ad28d6d09815fda1ee2b5621d1a49c513" name="ad28d6d09815fda1ee2b5621d1a49c513"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad28d6d09815fda1ee2b5621d1a49c513">&#9670;&#160;</a></span>get_http_version()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * get_http_version </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03876">3876</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3877</span>{</div>
<div class="line"><span class="lineno"> 3878</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno"> 3879</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3880</span>    }</div>
<div class="line"><span class="lineno"> 3881</span> </div>
<div class="line"><span class="lineno"> 3882</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> == <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a>) {</div>
<div class="line"><span class="lineno"> 3883</span>        <span class="keywordflow">return</span> conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a>;</div>
<div class="line"><span class="lineno"> 3884</span>    }</div>
<div class="line"><span class="lineno"> 3885</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> == <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411">CONNECTION_TYPE_RESPONSE</a>) {</div>
<div class="line"><span class="lineno"> 3886</span>        <span class="keywordflow">return</span> conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a28b0b6daf9b7245b7cefc22b65f377d4">http_version</a>;</div>
<div class="line"><span class="lineno"> 3887</span>    }</div>
<div class="line"><span class="lineno"> 3888</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3889</span>}</div>
<div class="ttc" id="astructmg__connection_html_a5b8a4d583861cfb8a28ff105f5ba84bb"><div class="ttname"><a href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">mg_connection::connection_type</a></div><div class="ttdeci">int connection_type</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02486">civetweb.c:2486</a></div></div>
<div class="ttc" id="astructmg__connection_html_a913c7880b2d750f0c98ab2ace5e59627"><div class="ttname"><a href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">mg_connection::response_info</a></div><div class="ttdeci">struct mg_response_info response_info</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02495">civetweb.c:2495</a></div></div>
<div class="ttc" id="astructmg__request__info_html_ac9743ffd7a96d700813777ff3d3bc25d"><div class="ttname"><a href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">mg_request_info::http_version</a></div><div class="ttdeci">const char * http_version</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00161">civetweb.h:161</a></div></div>
<div class="ttc" id="astructmg__response__info_html_a28b0b6daf9b7245b7cefc22b65f377d4"><div class="ttname"><a href="structmg__response__info.html#a28b0b6daf9b7245b7cefc22b65f377d4">mg_response_info::http_version</a></div><div class="ttdeci">const char * http_version</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00194">civetweb.h:194</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02486">mg_connection::connection_type</a>, <a class="el" href="civetweb_8c_source.html#l02461">CONNECTION_TYPE_REQUEST</a>, <a class="el" href="civetweb_8c_source.html#l02462">CONNECTION_TYPE_RESPONSE</a>, <a class="el" href="civetweb_8h_source.html#l00161">mg_request_info::http_version</a>, <a class="el" href="civetweb_8h_source.html#l00194">mg_response_info::http_version</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, and <a class="el" href="civetweb_8c_source.html#l02495">mg_connection::response_info</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03984">should_keep_alive()</a>.</p>

</div>
</div>
<a id="a52c707b5a0f04dc2908850d5a93068fc" name="a52c707b5a0f04dc2908850d5a93068fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52c707b5a0f04dc2908850d5a93068fc">&#9670;&#160;</a></span>get_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_message </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>ebuf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>ebuf_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>err</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18569">18569</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">18570</span>{</div>
<div class="line"><span class="lineno">18571</span>    <span class="keywordflow">if</span> (ebuf_len &gt; 0) {</div>
<div class="line"><span class="lineno">18572</span>        ebuf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">18573</span>    }</div>
<div class="line"><span class="lineno">18574</span>    *err = 0;</div>
<div class="line"><span class="lineno">18575</span> </div>
<div class="line"><span class="lineno">18576</span>    <a class="code hl_function" href="#a4724fafa5fdbf347cf779ffe4bc28c23">reset_per_request_attributes</a>(conn);</div>
<div class="line"><span class="lineno">18577</span> </div>
<div class="line"><span class="lineno">18578</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno">18579</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18580</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18581</span>                    ebuf,</div>
<div class="line"><span class="lineno">18582</span>                    ebuf_len,</div>
<div class="line"><span class="lineno">18583</span>                    <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18584</span>                    <span class="stringliteral">&quot;Internal error&quot;</span>);</div>
<div class="line"><span class="lineno">18585</span>        *err = 500;</div>
<div class="line"><span class="lineno">18586</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18587</span>    }</div>
<div class="line"><span class="lineno">18588</span> </div>
<div class="line"><span class="lineno">18589</span>    <span class="comment">/* Set the time the request was received. This value should be used for</span></div>
<div class="line"><span class="lineno">18590</span><span class="comment">     * timeouts. */</span></div>
<div class="line"><span class="lineno">18591</span>    clock_gettime(CLOCK_MONOTONIC, &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a1b122ac1a6e7d536f2b0c8e8b94cdf26">req_time</a>));</div>
<div class="line"><span class="lineno">18592</span> </div>
<div class="line"><span class="lineno">18593</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> =</div>
<div class="line"><span class="lineno">18594</span>        <a class="code hl_function" href="#ab8b35962b277d0cc31f7e16541b326ea">read_message</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, conn, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6033a47c6e89ad571ca65000ab53f07e">buf_size</a>, &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a>);</div>
<div class="line"><span class="lineno">18595</span>    <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> &lt; 0 || conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> &gt;= conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a>);</div>
<div class="line"><span class="lineno">18596</span>    <span class="keywordflow">if</span> ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> &gt;= 0) &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> &lt; conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a>)) {</div>
<div class="line"><span class="lineno">18597</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18598</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18599</span>                    ebuf,</div>
<div class="line"><span class="lineno">18600</span>                    ebuf_len,</div>
<div class="line"><span class="lineno">18601</span>                    <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18602</span>                    <span class="stringliteral">&quot;Invalid message size&quot;</span>);</div>
<div class="line"><span class="lineno">18603</span>        *err = 500;</div>
<div class="line"><span class="lineno">18604</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18605</span>    }</div>
<div class="line"><span class="lineno">18606</span> </div>
<div class="line"><span class="lineno">18607</span>    <span class="keywordflow">if</span> ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> == 0) &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> == conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6033a47c6e89ad571ca65000ab53f07e">buf_size</a>)) {</div>
<div class="line"><span class="lineno">18608</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18609</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18610</span>                    ebuf,</div>
<div class="line"><span class="lineno">18611</span>                    ebuf_len,</div>
<div class="line"><span class="lineno">18612</span>                    <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18613</span>                    <span class="stringliteral">&quot;Message too large&quot;</span>);</div>
<div class="line"><span class="lineno">18614</span>        *err = 413;</div>
<div class="line"><span class="lineno">18615</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18616</span>    }</div>
<div class="line"><span class="lineno">18617</span> </div>
<div class="line"><span class="lineno">18618</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> &lt;= 0) {</div>
<div class="line"><span class="lineno">18619</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> &gt; 0) {</div>
<div class="line"><span class="lineno">18620</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18621</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18622</span>                        ebuf,</div>
<div class="line"><span class="lineno">18623</span>                        ebuf_len,</div>
<div class="line"><span class="lineno">18624</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18625</span>                        <span class="stringliteral">&quot;Malformed message&quot;</span>);</div>
<div class="line"><span class="lineno">18626</span>            *err = 400;</div>
<div class="line"><span class="lineno">18627</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">18628</span>            <span class="comment">/* Server did not recv anything -&gt; just close the connection */</span></div>
<div class="line"><span class="lineno">18629</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">18630</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18631</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18632</span>                        ebuf,</div>
<div class="line"><span class="lineno">18633</span>                        ebuf_len,</div>
<div class="line"><span class="lineno">18634</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18635</span>                        <span class="stringliteral">&quot;No data received&quot;</span>);</div>
<div class="line"><span class="lineno">18636</span>            *err = 0;</div>
<div class="line"><span class="lineno">18637</span>        }</div>
<div class="line"><span class="lineno">18638</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18639</span>    }</div>
<div class="line"><span class="lineno">18640</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">18641</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a4724fafa5fdbf347cf779ffe4bc28c23"><div class="ttname"><a href="#a4724fafa5fdbf347cf779ffe4bc28c23">reset_per_request_attributes</a></div><div class="ttdeci">static void reset_per_request_attributes(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17676">civetweb.c:17676</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ab8b35962b277d0cc31f7e16541b326ea"><div class="ttname"><a href="#ab8b35962b277d0cc31f7e16541b326ea">read_message</a></div><div class="ttdeci">static int read_message(FILE *fp, struct mg_connection *conn, char *buf, int bufsiz, int *nread)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11107">civetweb.c:11107</a></div></div>
<div class="ttc" id="astructmg__connection_html_a1b122ac1a6e7d536f2b0c8e8b94cdf26"><div class="ttname"><a href="structmg__connection.html#a1b122ac1a6e7d536f2b0c8e8b94cdf26">mg_connection::req_time</a></div><div class="ttdeci">struct timespec req_time</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02515">civetweb.c:2515</a></div></div>
<div class="ttc" id="astructmg__connection_html_a6033a47c6e89ad571ca65000ab53f07e"><div class="ttname"><a href="structmg__connection.html#a6033a47c6e89ad571ca65000ab53f07e">mg_connection::buf_size</a></div><div class="ttdeci">int buf_size</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02556">civetweb.c:2556</a></div></div>
<div class="ttc" id="astructmg__connection_html_a897c2cf854e4ad76856bad74fb8e7f0a"><div class="ttname"><a href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">mg_connection::buf</a></div><div class="ttdeci">char * buf</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02532">civetweb.c:2532</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02532">mg_connection::buf</a>, <a class="el" href="civetweb_8c_source.html#l02556">mg_connection::buf_size</a>, <a class="el" href="civetweb_8c_source.html#l02558">mg_connection::data_len</a>, <a class="el" href="civetweb_8c_source.html#l00260">DEBUG_ASSERT</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l11107">read_message()</a>, <a class="el" href="civetweb_8c_source.html#l02515">mg_connection::req_time</a>, <a class="el" href="civetweb_8c_source.html#l02557">mg_connection::request_len</a>, and <a class="el" href="civetweb_8c_source.html#l17676">reset_per_request_attributes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18645">get_request()</a>, and <a class="el" href="civetweb_8c_source.html#l18737">get_response()</a>.</p>

</div>
</div>
<a id="a9ed08e2cbee6ec8aa43739359b3a0937" name="a9ed08e2cbee6ec8aa43739359b3a0937"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ed08e2cbee6ec8aa43739359b3a0937">&#9670;&#160;</a></span>get_mime_type()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void get_mime_type </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structvec.html">vec</a> *</td>          <td class="paramname"><span class="paramname"><em>vec</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08354">8354</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8355</span>{</div>
<div class="line"><span class="lineno"> 8356</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> ext_vec, mime_vec;</div>
<div class="line"><span class="lineno"> 8357</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *list, *ext;</div>
<div class="line"><span class="lineno"> 8358</span>    <span class="keywordtype">size_t</span> path_len;</div>
<div class="line"><span class="lineno"> 8359</span> </div>
<div class="line"><span class="lineno"> 8360</span>    path_len = strlen(path);</div>
<div class="line"><span class="lineno"> 8361</span> </div>
<div class="line"><span class="lineno"> 8362</span>    <span class="keywordflow">if</span> ((conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (<a class="code hl_struct" href="structvec.html">vec</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 8363</span>        <span class="keywordflow">if</span> (<a class="code hl_struct" href="structvec.html">vec</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8364</span>            memset(<a class="code hl_struct" href="structvec.html">vec</a>, <span class="charliteral">&#39;\0&#39;</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="structvec.html">vec</a>));</div>
<div class="line"><span class="lineno"> 8365</span>        }</div>
<div class="line"><span class="lineno"> 8366</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 8367</span>    }</div>
<div class="line"><span class="lineno"> 8368</span> </div>
<div class="line"><span class="lineno"> 8369</span>    <span class="comment">/* Scan user-defined mime types first, in case user wants to</span></div>
<div class="line"><span class="lineno"> 8370</span><span class="comment">     * override default mime types. */</span></div>
<div class="line"><span class="lineno"> 8371</span>    list = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bafe5280fd7fcd9876652bc64790c74c23">EXTRA_MIME_TYPES</a>];</div>
<div class="line"><span class="lineno"> 8372</span>    <span class="keywordflow">while</span> ((list = <a class="code hl_function" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a>(list, &amp;ext_vec, &amp;mime_vec)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8373</span>        <span class="comment">/* ext now points to the path suffix */</span></div>
<div class="line"><span class="lineno"> 8374</span>        ext = path + path_len - ext_vec.len;</div>
<div class="line"><span class="lineno"> 8375</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(ext, ext_vec.ptr, ext_vec.len) == 0) {</div>
<div class="line"><span class="lineno"> 8376</span>            *<a class="code hl_struct" href="structvec.html">vec</a> = mime_vec;</div>
<div class="line"><span class="lineno"> 8377</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 8378</span>        }</div>
<div class="line"><span class="lineno"> 8379</span>    }</div>
<div class="line"><span class="lineno"> 8380</span> </div>
<div class="line"><span class="lineno"> 8381</span>    <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> = <a class="code hl_function" href="#a7cd400c299dd350acc398055918d75a9">mg_get_builtin_mime_type</a>(path);</div>
<div class="line"><span class="lineno"> 8382</span>    <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = strlen(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>);</div>
<div class="line"><span class="lineno"> 8383</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a1e22e846cc0308d6521ed516918f380f"><div class="ttname"><a href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a></div><div class="ttdeci">CIVETWEB_API int mg_strncasecmp(const char *s1, const char *s2, size_t len)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03019">civetweb.c:3019</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a7cd400c299dd350acc398055918d75a9"><div class="ttname"><a href="#a7cd400c299dd350acc398055918d75a9">mg_get_builtin_mime_type</a></div><div class="ttdeci">CIVETWEB_API const char * mg_get_builtin_mime_type(const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08332">civetweb.c:8332</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02007">EXTRA_MIME_TYPES</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8c_source.html#l08332">mg_get_builtin_mime_type()</a>, <a class="el" href="civetweb_8c_source.html#l03019">mg_strncasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l03899">next_option()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>.</p>

</div>
</div>
<a id="aec4315e0c74af7127b8e43e7f3cc82cf" name="aec4315e0c74af7127b8e43e7f3cc82cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec4315e0c74af7127b8e43e7f3cc82cf">&#9670;&#160;</a></span>get_month_index()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_month_index </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>s</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07989">7989</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7990</span>{</div>
<div class="line"><span class="lineno"> 7991</span>    <span class="keywordtype">size_t</span> i;</div>
<div class="line"><span class="lineno"> 7992</span> </div>
<div class="line"><span class="lineno"> 7993</span>    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_define" href="#a70c57aae3eb654e205459b4362c8089a">ARRAY_SIZE</a>(<a class="code hl_variable" href="#a5012c7bf061f74574b046e588f9e6342">month_names</a>); i++) {</div>
<div class="line"><span class="lineno"> 7994</span>        <span class="keywordflow">if</span> (!strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <a class="code hl_variable" href="#a5012c7bf061f74574b046e588f9e6342">month_names</a>[i])) {</div>
<div class="line"><span class="lineno"> 7995</span>            <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)i;</div>
<div class="line"><span class="lineno"> 7996</span>        }</div>
<div class="line"><span class="lineno"> 7997</span>    }</div>
<div class="line"><span class="lineno"> 7998</span> </div>
<div class="line"><span class="lineno"> 7999</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 8000</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a5012c7bf061f74574b046e588f9e6342"><div class="ttname"><a href="#a5012c7bf061f74574b046e588f9e6342">month_names</a></div><div class="ttdeci">static const char month_names[][4]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01815">civetweb.c:1815</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00506">ARRAY_SIZE</a>, <a class="el" href="civetweb_8c_source.html#l01815">month_names</a>, and <a class="el" href="multi_8h_source.html#l00318">s</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08005">parse_date_string()</a>.</p>

</div>
</div>
<a id="a4d2d84ca4d747d172e74257a176d216d" name="a4d2d84ca4d747d172e74257a176d216d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d2d84ca4d747d172e74257a176d216d">&#9670;&#160;</a></span>get_option_index()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_option_index </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03159">3159</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3160</span>{</div>
<div class="line"><span class="lineno"> 3161</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno"> 3162</span> </div>
<div class="line"><span class="lineno"> 3163</span>    <span class="keywordflow">for</span> (i = 0; <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[i].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; i++) {</div>
<div class="line"><span class="lineno"> 3164</span>        <span class="keywordflow">if</span> (strcmp(<a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[i].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) == 0) {</div>
<div class="line"><span class="lineno"> 3165</span>            <span class="keywordflow">return</span> i;</div>
<div class="line"><span class="lineno"> 3166</span>        }</div>
<div class="line"><span class="lineno"> 3167</span>    }</div>
<div class="line"><span class="lineno"> 3168</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 3169</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a414393f1a7ad731456acc279c62290d0"><div class="ttname"><a href="#a414393f1a7ad731456acc279c62290d0">config_options</a></div><div class="ttdeci">static const struct mg_option config_options[]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02062">civetweb.c:2062</a></div></div>
<div class="ttc" id="astructmg__option_html_a86aed4136166ee660ad8bc71bb54e2bf"><div class="ttname"><a href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">mg_option::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00686">civetweb.h:686</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8h_source.html#l00686">mg_option::name</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03173">mg_get_option()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, and <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>.</p>

</div>
</div>
<a id="aaa28a4d9a3623da0fc3cbf1fd71acf8b" name="aaa28a4d9a3623da0fc3cbf1fd71acf8b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa28a4d9a3623da0fc3cbf1fd71acf8b">&#9670;&#160;</a></span>get_proto_name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * get_proto_name </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03574">3574</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3575</span>{</div>
<div class="line"><span class="lineno"> 3576</span><span class="preprocessor">#if defined(__clang__)</span></div>
<div class="line"><span class="lineno"> 3577</span><span class="preprocessor">#pragma clang diagnostic push</span></div>
<div class="line"><span class="lineno"> 3578</span><span class="preprocessor">#pragma clang diagnostic ignored &quot;-Wunreachable-code&quot;</span></div>
<div class="line"><span class="lineno"> 3579</span>    <span class="comment">/* Depending on USE_WEBSOCKET and NO_SSL, some oft the protocols might be</span></div>
<div class="line"><span class="lineno"> 3580</span><span class="comment">     * not supported. Clang raises an &quot;unreachable code&quot; warning for parts of ?:</span></div>
<div class="line"><span class="lineno"> 3581</span><span class="comment">     * unreachable, but splitting into four different #ifdef clauses here is</span></div>
<div class="line"><span class="lineno"> 3582</span><span class="comment">     * more complicated.</span></div>
<div class="line"><span class="lineno"> 3583</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 3584</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3585</span> </div>
<div class="line"><span class="lineno"> 3586</span>    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structmg__request__info.html">mg_request_info</a> *ri = &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>;</div>
<div class="line"><span class="lineno"> 3587</span> </div>
<div class="line"><span class="lineno"> 3588</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="#a1491042fd5b61bf39023b8df4c736128">proto</a> = ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436">PROTOCOL_TYPE_WEBSOCKET</a>)</div>
<div class="line"><span class="lineno"> 3589</span>                             ? (ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#af66a6c4c2364a37b87f646f76b9e7d3d">is_ssl</a> ? <span class="stringliteral">&quot;wss&quot;</span> : <span class="stringliteral">&quot;ws&quot;</span>)</div>
<div class="line"><span class="lineno"> 3590</span>                             : (ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#af66a6c4c2364a37b87f646f76b9e7d3d">is_ssl</a> ? <span class="stringliteral">&quot;https&quot;</span> : <span class="stringliteral">&quot;http&quot;</span>));</div>
<div class="line"><span class="lineno"> 3591</span> </div>
<div class="line"><span class="lineno"> 3592</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="#a1491042fd5b61bf39023b8df4c736128">proto</a>;</div>
<div class="line"><span class="lineno"> 3593</span> </div>
<div class="line"><span class="lineno"> 3594</span><span class="preprocessor">#if defined(__clang__)</span></div>
<div class="line"><span class="lineno"> 3595</span><span class="preprocessor">#pragma clang diagnostic pop</span></div>
<div class="line"><span class="lineno"> 3596</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3597</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a1491042fd5b61bf39023b8df4c736128"><div class="ttname"><a href="#a1491042fd5b61bf39023b8df4c736128">proto</a></div><div class="ttdeci">const char * proto</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18378">civetweb.c:18378</a></div></div>
<div class="ttc" id="astructmg__connection_html_a7afb014954a870291a215479a81fc242"><div class="ttname"><a href="structmg__connection.html#a7afb014954a870291a215479a81fc242">mg_connection::protocol_type</a></div><div class="ttdeci">int protocol_type</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02487">civetweb.c:2487</a></div></div>
<div class="ttc" id="astructmg__request__info_html"><div class="ttname"><a href="structmg__request__info.html">mg_request_info</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00150">civetweb.h:150</a></div></div>
<div class="ttc" id="astructmg__request__info_html_af66a6c4c2364a37b87f646f76b9e7d3d"><div class="ttname"><a href="structmg__request__info.html#af66a6c4c2364a37b87f646f76b9e7d3d">mg_request_info::is_ssl</a></div><div class="ttdeci">int is_ssl</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00173">civetweb.h:173</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00173">mg_request_info::is_ssl</a>, <a class="el" href="civetweb_8c_source.html#l18378">proto</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, <a class="el" href="civetweb_8c_source.html#l02467">PROTOCOL_TYPE_WEBSOCKET</a>, and <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>.</p>

</div>
</div>
<a id="afcc8e6176b79900cc58605f1c884d0ab" name="afcc8e6176b79900cc58605f1c884d0ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcc8e6176b79900cc58605f1c884d0ab">&#9670;&#160;</a></span>get_random()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint64_t get_random </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l05909">5909</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 5910</span>{</div>
<div class="line"><span class="lineno"> 5911</span>    <span class="keyword">static</span> uint64_t lfsr = 0; <span class="comment">/* Linear feedback shift register */</span></div>
<div class="line"><span class="lineno"> 5912</span>    <span class="keyword">static</span> uint64_t lcg = 0;  <span class="comment">/* Linear congruential generator */</span></div>
<div class="line"><span class="lineno"> 5913</span>    uint64_t now = <a class="code hl_function" href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a>();</div>
<div class="line"><span class="lineno"> 5914</span> </div>
<div class="line"><span class="lineno"> 5915</span>    <span class="keywordflow">if</span> (lfsr == 0) {</div>
<div class="line"><span class="lineno"> 5916</span>        <span class="comment">/* lfsr will be only 0 if has not been initialized,</span></div>
<div class="line"><span class="lineno"> 5917</span><span class="comment">         * so this code is called only once. */</span></div>
<div class="line"><span class="lineno"> 5918</span>        lfsr = <a class="code hl_function" href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a>();</div>
<div class="line"><span class="lineno"> 5919</span>        lcg = <a class="code hl_function" href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a>();</div>
<div class="line"><span class="lineno"> 5920</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 5921</span>        <span class="comment">/* Get the next step of both random number generators. */</span></div>
<div class="line"><span class="lineno"> 5922</span>        lfsr = (lfsr &gt;&gt; 1)</div>
<div class="line"><span class="lineno"> 5923</span>               | ((((lfsr &gt;&gt; 0) ^ (lfsr &gt;&gt; 1) ^ (lfsr &gt;&gt; 3) ^ (lfsr &gt;&gt; 4)) &amp; 1)</div>
<div class="line"><span class="lineno"> 5924</span>                  &lt;&lt; 63);</div>
<div class="line"><span class="lineno"> 5925</span>        lcg = lcg * 6364136223846793005LL + 1442695040888963407LL;</div>
<div class="line"><span class="lineno"> 5926</span>    }</div>
<div class="line"><span class="lineno"> 5927</span> </div>
<div class="line"><span class="lineno"> 5928</span>    <span class="comment">/* Combining two pseudo-random number generators and a high resolution</span></div>
<div class="line"><span class="lineno"> 5929</span><span class="comment">     * part</span></div>
<div class="line"><span class="lineno"> 5930</span><span class="comment">     * of the current server time will make it hard (impossible?) to guess</span></div>
<div class="line"><span class="lineno"> 5931</span><span class="comment">     * the</span></div>
<div class="line"><span class="lineno"> 5932</span><span class="comment">     * next number. */</span></div>
<div class="line"><span class="lineno"> 5933</span>    <span class="keywordflow">return</span> (lfsr ^ lcg ^ now);</div>
<div class="line"><span class="lineno"> 5934</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01676">mg_get_current_time_ns()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, and <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>.</p>

</div>
</div>
<a id="a1504707625c62644c0951b656110b102" name="a1504707625c62644c0951b656110b102"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1504707625c62644c0951b656110b102">&#9670;&#160;</a></span>get_rel_url_at_current_server()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * get_rel_url_at_current_server </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uri</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18465">18465</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">18466</span>{</div>
<div class="line"><span class="lineno">18467</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *server_domain;</div>
<div class="line"><span class="lineno">18468</span>    <span class="keywordtype">size_t</span> server_domain_len;</div>
<div class="line"><span class="lineno">18469</span>    <span class="keywordtype">size_t</span> request_domain_len = 0;</div>
<div class="line"><span class="lineno">18470</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> port = 0;</div>
<div class="line"><span class="lineno">18471</span>    <span class="keywordtype">int</span> i, auth_domain_check_enabled;</div>
<div class="line"><span class="lineno">18472</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *hostbegin = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18473</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *hostend = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18474</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *portbegin;</div>
<div class="line"><span class="lineno">18475</span>    <span class="keywordtype">char</span> *portend;</div>
<div class="line"><span class="lineno">18476</span> </div>
<div class="line"><span class="lineno">18477</span>    auth_domain_check_enabled =</div>
<div class="line"><span class="lineno">18478</span>        !<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa196eb33164714d8b04ace074a72c492">ENABLE_AUTH_DOMAIN_CHECK</a>], <span class="stringliteral">&quot;yes&quot;</span>);</div>
<div class="line"><span class="lineno">18479</span> </div>
<div class="line"><span class="lineno">18480</span>    <span class="comment">/* DNS is case insensitive, so use case insensitive string compare here</span></div>
<div class="line"><span class="lineno">18481</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">18482</span>    <span class="keywordflow">for</span> (i = 0; <a class="code hl_variable" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>[i].proto != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; i++) {</div>
<div class="line"><span class="lineno">18483</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(uri,</div>
<div class="line"><span class="lineno">18484</span>                           <a class="code hl_variable" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>[i].<a class="code hl_variable" href="#a1491042fd5b61bf39023b8df4c736128">proto</a>,</div>
<div class="line"><span class="lineno">18485</span>                           <a class="code hl_variable" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>[i].<a class="code hl_variable" href="#ae76eb848818055987d653483ac38ec19">proto_len</a>)</div>
<div class="line"><span class="lineno">18486</span>            == 0) {</div>
<div class="line"><span class="lineno">18487</span> </div>
<div class="line"><span class="lineno">18488</span>            hostbegin = uri + <a class="code hl_variable" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>[i].proto_len;</div>
<div class="line"><span class="lineno">18489</span>            hostend = strchr(hostbegin, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">18490</span>            <span class="keywordflow">if</span> (!hostend) {</div>
<div class="line"><span class="lineno">18491</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18492</span>            }</div>
<div class="line"><span class="lineno">18493</span>            portbegin = strchr(hostbegin, <span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line"><span class="lineno">18494</span>            <span class="keywordflow">if</span> ((!portbegin) || (portbegin &gt; hostend)) {</div>
<div class="line"><span class="lineno">18495</span>                port = <a class="code hl_variable" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>[i].default_port;</div>
<div class="line"><span class="lineno">18496</span>                request_domain_len = (size_t)(hostend - hostbegin);</div>
<div class="line"><span class="lineno">18497</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">18498</span>                port = strtoul(portbegin + 1, &amp;portend, 10);</div>
<div class="line"><span class="lineno">18499</span>                <span class="keywordflow">if</span> ((portend != hostend) || (port &lt;= 0)</div>
<div class="line"><span class="lineno">18500</span>                    || !<a class="code hl_function" href="#ab0cba7d970883b21a4db625c33cba9ac">is_valid_port</a>(port)) {</div>
<div class="line"><span class="lineno">18501</span>                    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18502</span>                }</div>
<div class="line"><span class="lineno">18503</span>                request_domain_len = (size_t)(portbegin - hostbegin);</div>
<div class="line"><span class="lineno">18504</span>            }</div>
<div class="line"><span class="lineno">18505</span>            <span class="comment">/* protocol found, port set */</span></div>
<div class="line"><span class="lineno">18506</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">18507</span>        }</div>
<div class="line"><span class="lineno">18508</span>    }</div>
<div class="line"><span class="lineno">18509</span> </div>
<div class="line"><span class="lineno">18510</span>    <span class="keywordflow">if</span> (!port) {</div>
<div class="line"><span class="lineno">18511</span>        <span class="comment">/* port remains 0 if the protocol is not found */</span></div>
<div class="line"><span class="lineno">18512</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18513</span>    }</div>
<div class="line"><span class="lineno">18514</span> </div>
<div class="line"><span class="lineno">18515</span>    <span class="comment">/* Check if the request is directed to a different server. */</span></div>
<div class="line"><span class="lineno">18516</span>    <span class="comment">/* First check if the port is the same. */</span></div>
<div class="line"><span class="lineno">18517</span>    <span class="keywordflow">if</span> (ntohs(<a class="code hl_define" href="#a58f28d0739c8e6a66ffce338daef408c">USA_IN_PORT_UNSAFE</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>)) != port) {</div>
<div class="line"><span class="lineno">18518</span>        <span class="comment">/* Request is directed to a different port */</span></div>
<div class="line"><span class="lineno">18519</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18520</span>    }</div>
<div class="line"><span class="lineno">18521</span> </div>
<div class="line"><span class="lineno">18522</span>    <span class="comment">/* Finally check if the server corresponds to the authentication</span></div>
<div class="line"><span class="lineno">18523</span><span class="comment">     * domain of the server (the server domain).</span></div>
<div class="line"><span class="lineno">18524</span><span class="comment">     * Allow full matches (like http://mydomain.com/path/file.ext), and</span></div>
<div class="line"><span class="lineno">18525</span><span class="comment">     * allow subdomain matches (like http://www.mydomain.com/path/file.ext),</span></div>
<div class="line"><span class="lineno">18526</span><span class="comment">     * but do not allow substrings (like</span></div>
<div class="line"><span class="lineno">18527</span><span class="comment">     * http://notmydomain.com/path/file.ext</span></div>
<div class="line"><span class="lineno">18528</span><span class="comment">     * or http://mydomain.com.fake/path/file.ext).</span></div>
<div class="line"><span class="lineno">18529</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">18530</span>    <span class="keywordflow">if</span> (auth_domain_check_enabled) {</div>
<div class="line"><span class="lineno">18531</span>        server_domain = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>];</div>
<div class="line"><span class="lineno">18532</span>        server_domain_len = strlen(server_domain);</div>
<div class="line"><span class="lineno">18533</span>        <span class="keywordflow">if</span> ((server_domain_len == 0) || (hostbegin == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">18534</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18535</span>        }</div>
<div class="line"><span class="lineno">18536</span>        <span class="keywordflow">if</span> ((request_domain_len == server_domain_len)</div>
<div class="line"><span class="lineno">18537</span>            &amp;&amp; (!memcmp(server_domain, hostbegin, server_domain_len))) {</div>
<div class="line"><span class="lineno">18538</span>            <span class="comment">/* Request is directed to this server - full name match. */</span></div>
<div class="line"><span class="lineno">18539</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">18540</span>            <span class="keywordflow">if</span> (request_domain_len &lt; (server_domain_len + 2)) {</div>
<div class="line"><span class="lineno">18541</span>                <span class="comment">/* Request is directed to another server: The server name</span></div>
<div class="line"><span class="lineno">18542</span><span class="comment">                 * is longer than the request name.</span></div>
<div class="line"><span class="lineno">18543</span><span class="comment">                 * Drop this case here to avoid overflows in the</span></div>
<div class="line"><span class="lineno">18544</span><span class="comment">                 * following checks. */</span></div>
<div class="line"><span class="lineno">18545</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18546</span>            }</div>
<div class="line"><span class="lineno">18547</span>            <span class="keywordflow">if</span> (hostbegin[request_domain_len - server_domain_len - 1] != <span class="charliteral">&#39;.&#39;</span>) {</div>
<div class="line"><span class="lineno">18548</span>                <span class="comment">/* Request is directed to another server: It could be a</span></div>
<div class="line"><span class="lineno">18549</span><span class="comment">                 * substring</span></div>
<div class="line"><span class="lineno">18550</span><span class="comment">                 * like notmyserver.com */</span></div>
<div class="line"><span class="lineno">18551</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18552</span>            }</div>
<div class="line"><span class="lineno">18553</span>            <span class="keywordflow">if</span> (0</div>
<div class="line"><span class="lineno">18554</span>                != memcmp(server_domain,</div>
<div class="line"><span class="lineno">18555</span>                          hostbegin + request_domain_len - server_domain_len,</div>
<div class="line"><span class="lineno">18556</span>                          server_domain_len)) {</div>
<div class="line"><span class="lineno">18557</span>                <span class="comment">/* Request is directed to another server:</span></div>
<div class="line"><span class="lineno">18558</span><span class="comment">                 * The server name is different. */</span></div>
<div class="line"><span class="lineno">18559</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18560</span>            }</div>
<div class="line"><span class="lineno">18561</span>        }</div>
<div class="line"><span class="lineno">18562</span>    }</div>
<div class="line"><span class="lineno">18563</span> </div>
<div class="line"><span class="lineno">18564</span>    <span class="keywordflow">return</span> hostend;</div>
<div class="line"><span class="lineno">18565</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a58f28d0739c8e6a66ffce338daef408c"><div class="ttname"><a href="#a58f28d0739c8e6a66ffce338daef408c">USA_IN_PORT_UNSAFE</a></div><div class="ttdeci">#define USA_IN_PORT_UNSAFE(s)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01860">civetweb.c:1860</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a75d2d9abb3e5abaaf44e99b9f805f07a"><div class="ttname"><a href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a></div><div class="ttdeci">static const struct @6 abs_uri_protocols[]</div></div>
<div class="ttc" id="acivetweb_8c_html_ae76eb848818055987d653483ac38ec19"><div class="ttname"><a href="#ae76eb848818055987d653483ac38ec19">proto_len</a></div><div class="ttdeci">size_t proto_len</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18379">civetweb.c:18379</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>, <a class="el" href="civetweb_8c_source.html#l01999">AUTHENTICATION_DOMAIN</a>, <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02000">ENABLE_AUTH_DOMAIN_CHECK</a>, <a class="el" href="civetweb_8c_source.html#l09239">is_valid_port()</a>, <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l03019">mg_strncasecmp()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l18378">proto</a>, <a class="el" href="civetweb_8c_source.html#l18379">proto_len</a>, and <a class="el" href="civetweb_8c_source.html#l01860">USA_IN_PORT_UNSAFE</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, and <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>.</p>

</div>
</div>
<a id="a40a6af4c96865e0df1aa11c588731a27" name="a40a6af4c96865e0df1aa11c588731a27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40a6af4c96865e0df1aa11c588731a27">&#9670;&#160;</a></span>get_req_headers()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_req_headers </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__request__info.html">mg_request_info</a> *</td>          <td class="paramname"><span class="paramname"><em>ri</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **</td>          <td class="paramname"><span class="paramname"><em>output</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>output_max_size</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03836">3836</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3840</span>{</div>
<div class="line"><span class="lineno"> 3841</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno"> 3842</span>    <span class="keywordtype">int</span> cnt = 0;</div>
<div class="line"><span class="lineno"> 3843</span>    <span class="keywordflow">if</span> (ri) {</div>
<div class="line"><span class="lineno"> 3844</span>        <span class="keywordflow">for</span> (i = 0; i &lt; ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a> &amp;&amp; cnt &lt; output_max_size; i++) {</div>
<div class="line"><span class="lineno"> 3845</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>[i].<a class="code hl_variable" href="structmg__header.html#ab91ffbf88fe154a963031e915adf8397">name</a>)) {</div>
<div class="line"><span class="lineno"> 3846</span>                <a class="code hl_variable" href="lua-5_81_85_2src_2luac_8c.html#a5a832fe6e2412dfabb93a2adae30e745">output</a>[cnt++] = ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>[i].<a class="code hl_variable" href="structmg__header.html#a9cdd7ef80ee309a6de14684059081d0d">value</a>;</div>
<div class="line"><span class="lineno"> 3847</span>            }</div>
<div class="line"><span class="lineno"> 3848</span>        }</div>
<div class="line"><span class="lineno"> 3849</span>    }</div>
<div class="line"><span class="lineno"> 3850</span>    <span class="keywordflow">return</span> cnt;</div>
<div class="line"><span class="lineno"> 3851</span>}</div>
<div class="ttc" id="alua-5_81_85_2src_2luac_8c_html_a5a832fe6e2412dfabb93a2adae30e745"><div class="ttname"><a href="lua-5_81_85_2src_2luac_8c.html#a5a832fe6e2412dfabb93a2adae30e745">output</a></div><div class="ttdeci">static const char * output</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2luac_8c_source.html#l00033">lua-5.1.5/src/luac.c:33</a></div></div>
<div class="ttc" id="astructmg__header_html_ab91ffbf88fe154a963031e915adf8397"><div class="ttname"><a href="structmg__header.html#ab91ffbf88fe154a963031e915adf8397">mg_header::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00144">civetweb.h:144</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00179">mg_request_info::http_headers</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8h_source.html#l00144">mg_header::name</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="civetweb_8h_source.html#l00178">mg_request_info::num_headers</a>, <a class="el" href="lua-5_81_85_2src_2luac_8c_source.html#l00033">output</a>, and <a class="el" href="civetweb_8h_source.html#l00145">mg_header::value</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l13912">should_switch_to_protocol()</a>.</p>

</div>
</div>
<a id="a6fa7879a104cf3bdc5ae2c901b354520" name="a6fa7879a104cf3bdc5ae2c901b354520"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fa7879a104cf3bdc5ae2c901b354520">&#9670;&#160;</a></span>get_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>ebuf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>ebuf_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>err</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18645">18645</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">18646</span>{</div>
<div class="line"><span class="lineno">18647</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *cl;</div>
<div class="line"><span class="lineno">18648</span> </div>
<div class="line"><span class="lineno">18649</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> =</div>
<div class="line"><span class="lineno">18650</span>        <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a>; <span class="comment">/* request (valid of not) */</span></div>
<div class="line"><span class="lineno">18651</span> </div>
<div class="line"><span class="lineno">18652</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a52c707b5a0f04dc2908850d5a93068fc">get_message</a>(conn, ebuf, ebuf_len, err)) {</div>
<div class="line"><span class="lineno">18653</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18654</span>    }</div>
<div class="line"><span class="lineno">18655</span> </div>
<div class="line"><span class="lineno">18656</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a02c595eceb37a14be0c7eb08ab464616">parse_http_request</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6033a47c6e89ad571ca65000ab53f07e">buf_size</a>, &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>)</div>
<div class="line"><span class="lineno">18657</span>        &lt;= 0) {</div>
<div class="line"><span class="lineno">18658</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18659</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18660</span>                    ebuf,</div>
<div class="line"><span class="lineno">18661</span>                    ebuf_len,</div>
<div class="line"><span class="lineno">18662</span>                    <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18663</span>                    <span class="stringliteral">&quot;Bad request&quot;</span>);</div>
<div class="line"><span class="lineno">18664</span>        *err = 400;</div>
<div class="line"><span class="lineno">18665</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18666</span>    }</div>
<div class="line"><span class="lineno">18667</span> </div>
<div class="line"><span class="lineno">18668</span>    <span class="comment">/* Message is a valid request */</span></div>
<div class="line"><span class="lineno">18669</span> </div>
<div class="line"><span class="lineno">18670</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a462e0cd852acad3eadee2621f126a1a0">switch_domain_context</a>(conn)) {</div>
<div class="line"><span class="lineno">18671</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18672</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18673</span>                    ebuf,</div>
<div class="line"><span class="lineno">18674</span>                    ebuf_len,</div>
<div class="line"><span class="lineno">18675</span>                    <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18676</span>                    <span class="stringliteral">&quot;Bad request: Host mismatch&quot;</span>);</div>
<div class="line"><span class="lineno">18677</span>        *err = 400;</div>
<div class="line"><span class="lineno">18678</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18679</span>    }</div>
<div class="line"><span class="lineno">18680</span> </div>
<div class="line"><span class="lineno">18681</span><span class="preprocessor">#if USE_ZLIB</span></div>
<div class="line"><span class="lineno">18682</span>    <span class="keywordflow">if</span> (((cl = <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>,</div>
<div class="line"><span class="lineno">18683</span>                          conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a>,</div>
<div class="line"><span class="lineno">18684</span>                          <span class="stringliteral">&quot;Accept-Encoding&quot;</span>))</div>
<div class="line"><span class="lineno">18685</span>         != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">18686</span>        &amp;&amp; strstr(cl, <span class="stringliteral">&quot;gzip&quot;</span>)) {</div>
<div class="line"><span class="lineno">18687</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa0fc1462c76f9504a16825147b8db3d1">accept_gzip</a> = 1;</div>
<div class="line"><span class="lineno">18688</span>    }</div>
<div class="line"><span class="lineno">18689</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">18690</span>    <span class="keywordflow">if</span> (((cl = <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>,</div>
<div class="line"><span class="lineno">18691</span>                          conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a>,</div>
<div class="line"><span class="lineno">18692</span>                          <span class="stringliteral">&quot;Transfer-Encoding&quot;</span>))</div>
<div class="line"><span class="lineno">18693</span>         != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">18694</span>        &amp;&amp; <a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(cl, <span class="stringliteral">&quot;identity&quot;</span>)) {</div>
<div class="line"><span class="lineno">18695</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(cl, <span class="stringliteral">&quot;chunked&quot;</span>)) {</div>
<div class="line"><span class="lineno">18696</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18697</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18698</span>                        ebuf,</div>
<div class="line"><span class="lineno">18699</span>                        ebuf_len,</div>
<div class="line"><span class="lineno">18700</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18701</span>                        <span class="stringliteral">&quot;Bad request&quot;</span>);</div>
<div class="line"><span class="lineno">18702</span>            *err = 400;</div>
<div class="line"><span class="lineno">18703</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18704</span>        }</div>
<div class="line"><span class="lineno">18705</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 1;</div>
<div class="line"><span class="lineno">18706</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> = 0; <span class="comment">/* not yet read */</span></div>
<div class="line"><span class="lineno">18707</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((cl = <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>,</div>
<div class="line"><span class="lineno">18708</span>                                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a>,</div>
<div class="line"><span class="lineno">18709</span>                                <span class="stringliteral">&quot;Content-Length&quot;</span>))</div>
<div class="line"><span class="lineno">18710</span>               != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18711</span>        <span class="comment">/* Request has content length set */</span></div>
<div class="line"><span class="lineno">18712</span>        <span class="keywordtype">char</span> *endptr = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18713</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> = strtoll(cl, &amp;endptr, 10);</div>
<div class="line"><span class="lineno">18714</span>        <span class="keywordflow">if</span> ((endptr == cl) || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> &lt; 0)) {</div>
<div class="line"><span class="lineno">18715</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18716</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18717</span>                        ebuf,</div>
<div class="line"><span class="lineno">18718</span>                        ebuf_len,</div>
<div class="line"><span class="lineno">18719</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18720</span>                        <span class="stringliteral">&quot;Bad request&quot;</span>);</div>
<div class="line"><span class="lineno">18721</span>            *err = 411;</div>
<div class="line"><span class="lineno">18722</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18723</span>        }</div>
<div class="line"><span class="lineno">18724</span>        <span class="comment">/* Publish the content length back to the request info. */</span></div>
<div class="line"><span class="lineno">18725</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aa1603acb1f2be0de643ebb1e352fdc01">content_length</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>;</div>
<div class="line"><span class="lineno">18726</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">18727</span>        <span class="comment">/* There is no exception, see RFC7230. */</span></div>
<div class="line"><span class="lineno">18728</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> = 0;</div>
<div class="line"><span class="lineno">18729</span>    }</div>
<div class="line"><span class="lineno">18730</span> </div>
<div class="line"><span class="lineno">18731</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">18732</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a02c595eceb37a14be0c7eb08ab464616"><div class="ttname"><a href="#a02c595eceb37a14be0c7eb08ab464616">parse_http_request</a></div><div class="ttdeci">static int parse_http_request(char *buf, int len, struct mg_request_info *ri)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10915">civetweb.c:10915</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a462e0cd852acad3eadee2621f126a1a0"><div class="ttname"><a href="#a462e0cd852acad3eadee2621f126a1a0">switch_domain_context</a></div><div class="ttdeci">static int switch_domain_context(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14174">civetweb.c:14174</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a52c707b5a0f04dc2908850d5a93068fc"><div class="ttname"><a href="#a52c707b5a0f04dc2908850d5a93068fc">get_message</a></div><div class="ttdeci">static int get_message(struct mg_connection *conn, char *ebuf, size_t ebuf_len, int *err)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18569">civetweb.c:18569</a></div></div>
<div class="ttc" id="astructmg__connection_html_a168cfc671a07bf2360ae806193c015bc"><div class="ttname"><a href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">mg_connection::content_len</a></div><div class="ttdeci">int64_t content_len</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02518">civetweb.c:2518</a></div></div>
<div class="ttc" id="astructmg__connection_html_a45f6e2c7e07289686090f84c97e71ec5"><div class="ttname"><a href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">mg_connection::is_chunked</a></div><div class="ttdeci">int is_chunked</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02525">civetweb.c:2525</a></div></div>
<div class="ttc" id="astructmg__connection_html_aa0fc1462c76f9504a16825147b8db3d1"><div class="ttname"><a href="structmg__connection.html#aa0fc1462c76f9504a16825147b8db3d1">mg_connection::accept_gzip</a></div><div class="ttdeci">int accept_gzip</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02536">civetweb.c:2536</a></div></div>
<div class="ttc" id="astructmg__request__info_html_aa1603acb1f2be0de643ebb1e352fdc01"><div class="ttname"><a href="structmg__request__info.html#aa1603acb1f2be0de643ebb1e352fdc01">mg_request_info::content_length</a></div><div class="ttdeci">long long content_length</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00168">civetweb.h:168</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02536">mg_connection::accept_gzip</a>, <a class="el" href="civetweb_8c_source.html#l02532">mg_connection::buf</a>, <a class="el" href="civetweb_8c_source.html#l02556">mg_connection::buf_size</a>, <a class="el" href="civetweb_8c_source.html#l02486">mg_connection::connection_type</a>, <a class="el" href="civetweb_8c_source.html#l02461">CONNECTION_TYPE_REQUEST</a>, <a class="el" href="civetweb_8c_source.html#l02518">mg_connection::content_len</a>, <a class="el" href="civetweb_8h_source.html#l00168">mg_request_info::content_length</a>, <a class="el" href="civetweb_8c_source.html#l03820">get_header()</a>, <a class="el" href="civetweb_8c_source.html#l18569">get_message()</a>, <a class="el" href="civetweb_8h_source.html#l00179">mg_request_info::http_headers</a>, <a class="el" href="civetweb_8c_source.html#l02525">mg_connection::is_chunked</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00178">mg_request_info::num_headers</a>, <a class="el" href="civetweb_8c_source.html#l10915">parse_http_request()</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, and <a class="el" href="civetweb_8c_source.html#l14174">switch_domain_context()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>.</p>

</div>
</div>
<a id="abff1b1a2d706ca9cd15c954196418119" name="abff1b1a2d706ca9cd15c954196418119"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abff1b1a2d706ca9cd15c954196418119">&#9670;&#160;</a></span>get_request_handler()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_request_handler </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>handler_type</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac452a63f6ff0d7fd18a143de72a7fd08">mg_request_handler</a> *</td>          <td class="paramname"><span class="paramname"><em>handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__websocket__subprotocols.html">mg_websocket_subprotocols</a> **</td>          <td class="paramname"><span class="paramname"><em>subprotocols</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ae1e201a8ea4f6895a8cc4e2e2c58da03">mg_websocket_connect_handler</a> *</td>          <td class="paramname"><span class="paramname"><em>connect_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a5b940f052d5de72f651a9a1e810bed0f">mg_websocket_ready_handler</a> *</td>          <td class="paramname"><span class="paramname"><em>ready_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> *</td>          <td class="paramname"><span class="paramname"><em>data_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> *</td>          <td class="paramname"><span class="paramname"><em>close_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a3e8733a4d6d7ae85f0daec45df36f024">mg_authorization_handler</a> *</td>          <td class="paramname"><span class="paramname"><em>auth_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **</td>          <td class="paramname"><span class="paramname"><em>cbdata</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__handler__info.html">mg_handler_info</a> **</td>          <td class="paramname"><span class="paramname"><em>handler_info</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14560">14560</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14571</span>{</div>
<div class="line"><span class="lineno">14572</span>    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structmg__request__info.html">mg_request_info</a> *request_info = <a class="code hl_function" href="#a882484e3a6894f40748e04fa78e52903">mg_get_request_info</a>(conn);</div>
<div class="line"><span class="lineno">14573</span>    <span class="keywordflow">if</span> (request_info) {</div>
<div class="line"><span class="lineno">14574</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *uri = request_info-&gt;<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>;</div>
<div class="line"><span class="lineno">14575</span>        <span class="keywordtype">size_t</span> urilen = strlen(uri);</div>
<div class="line"><span class="lineno">14576</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__handler__info.html">mg_handler_info</a> *tmp_rh;</div>
<div class="line"><span class="lineno">14577</span>        <span class="keywordtype">int</span> step, matched;</div>
<div class="line"><span class="lineno">14578</span> </div>
<div class="line"><span class="lineno">14579</span>        <span class="keywordflow">if</span> (!conn || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a> || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno">14580</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">14581</span>        }</div>
<div class="line"><span class="lineno">14582</span> </div>
<div class="line"><span class="lineno">14583</span>        <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">14584</span> </div>
<div class="line"><span class="lineno">14585</span>        <span class="keywordflow">for</span> (step = 0; step &lt; 3; step++) {</div>
<div class="line"><span class="lineno">14586</span>            <span class="keywordflow">for</span> (tmp_rh = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#af15ef8d6a276c40c4caeeba414e20aff">handlers</a>; tmp_rh != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14587</span>                 tmp_rh = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a4bfd90da42444fa125cbf0c8ca5d0f8d">next</a>) {</div>
<div class="line"><span class="lineno">14588</span>                <span class="keywordflow">if</span> (tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> != <a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a>) {</div>
<div class="line"><span class="lineno">14589</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">14590</span>                }</div>
<div class="line"><span class="lineno">14591</span>                <span class="keywordflow">if</span> (step == 0) {</div>
<div class="line"><span class="lineno">14592</span>                    <span class="comment">/* first try for an exact match */</span></div>
<div class="line"><span class="lineno">14593</span>                    matched = (tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a1c9d5733a3887f335361eb5fe5c64941">uri_len</a> == urilen)</div>
<div class="line"><span class="lineno">14594</span>                              &amp;&amp; (strcmp(tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>, <a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>) == 0);</div>
<div class="line"><span class="lineno">14595</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (step == 1) {</div>
<div class="line"><span class="lineno">14596</span>                    <span class="comment">/* next try for a partial match, we will accept</span></div>
<div class="line"><span class="lineno">14597</span><span class="comment">                    uri/something */</span></div>
<div class="line"><span class="lineno">14598</span>                    matched =</div>
<div class="line"><span class="lineno">14599</span>                        (tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a1c9d5733a3887f335361eb5fe5c64941">uri_len</a> &lt; urilen)</div>
<div class="line"><span class="lineno">14600</span>                        &amp;&amp; (<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>[tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a1c9d5733a3887f335361eb5fe5c64941">uri_len</a>] == <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line"><span class="lineno">14601</span>                        &amp;&amp; (memcmp(tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>, <a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>, tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a1c9d5733a3887f335361eb5fe5c64941">uri_len</a>) == 0);</div>
<div class="line"><span class="lineno">14602</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14603</span>                    <span class="comment">/* finally try for pattern match */</span></div>
<div class="line"><span class="lineno">14604</span>                    matched =</div>
<div class="line"><span class="lineno">14605</span>                        match_prefix(tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>, tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a1c9d5733a3887f335361eb5fe5c64941">uri_len</a>, <a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>) &gt; 0;</div>
<div class="line"><span class="lineno">14606</span>                }</div>
<div class="line"><span class="lineno">14607</span>                <span class="keywordflow">if</span> (matched) {</div>
<div class="line"><span class="lineno">14608</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484">WEBSOCKET_HANDLER</a>) {</div>
<div class="line"><span class="lineno">14609</span>                        *<a class="code hl_variable" href="structmg__handler__info.html#ac72d0a5b9cafe4be0b3dafa8d568517f">subprotocols</a> = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#ac72d0a5b9cafe4be0b3dafa8d568517f">subprotocols</a>;</div>
<div class="line"><span class="lineno">14610</span>                        *<a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a> = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a>;</div>
<div class="line"><span class="lineno">14611</span>                        *<a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a> = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a>;</div>
<div class="line"><span class="lineno">14612</span>                        *<a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a> = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a>;</div>
<div class="line"><span class="lineno">14613</span>                        *<a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a> = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a>;</div>
<div class="line"><span class="lineno">14614</span>                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a>) {</div>
<div class="line"><span class="lineno">14615</span>                        <span class="keywordflow">if</span> (tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#ada360840d8b7aa626ee0a6342df03c72">removing</a>) {</div>
<div class="line"><span class="lineno">14616</span>                            <span class="comment">/* Treat as none found */</span></div>
<div class="line"><span class="lineno">14617</span>                            step = 2;</div>
<div class="line"><span class="lineno">14618</span>                            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">14619</span>                        }</div>
<div class="line"><span class="lineno">14620</span>                        *<a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a> = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a>;</div>
<div class="line"><span class="lineno">14621</span>                        <span class="comment">/* Acquire handler and give it back */</span></div>
<div class="line"><span class="lineno">14622</span>                        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a79608a153a2518c199d63e4129b2ec11">refcount</a>++;</div>
<div class="line"><span class="lineno">14623</span>                        *handler_info = tmp_rh;</div>
<div class="line"><span class="lineno">14624</span>                    } <span class="keywordflow">else</span> { <span class="comment">/* AUTH_HANDLER */</span></div>
<div class="line"><span class="lineno">14625</span>                        *<a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a> = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a>;</div>
<div class="line"><span class="lineno">14626</span>                    }</div>
<div class="line"><span class="lineno">14627</span>                    *<a class="code hl_variable" href="structmg__handler__info.html#aaabae3fb2c47d2894fa11beedcca33aa">cbdata</a> = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#aaabae3fb2c47d2894fa11beedcca33aa">cbdata</a>;</div>
<div class="line"><span class="lineno">14628</span>                    <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">14629</span>                    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">14630</span>                }</div>
<div class="line"><span class="lineno">14631</span>            }</div>
<div class="line"><span class="lineno">14632</span>        }</div>
<div class="line"><span class="lineno">14633</span> </div>
<div class="line"><span class="lineno">14634</span>        <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">14635</span>    }</div>
<div class="line"><span class="lineno">14636</span>    <span class="keywordflow">return</span> 0; <span class="comment">/* none found */</span></div>
<div class="line"><span class="lineno">14637</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a882484e3a6894f40748e04fa78e52903"><div class="ttname"><a href="#a882484e3a6894f40748e04fa78e52903">mg_get_request_info</a></div><div class="ttdeci">CIVETWEB_API const struct mg_request_info * mg_get_request_info(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03521">civetweb.c:3521</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_a096c87d46d44f772efb8a53cae02f5a6"><div class="ttname"><a href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">mg_handler_info::handler</a></div><div class="ttdeci">mg_request_handler handler</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02237">civetweb.c:2237</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_a1c9d5733a3887f335361eb5fe5c64941"><div class="ttname"><a href="structmg__handler__info.html#a1c9d5733a3887f335361eb5fe5c64941">mg_handler_info::uri_len</a></div><div class="ttdeci">size_t uri_len</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02231">civetweb.c:2231</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_a24edb38fe79621c4b10e01c29bb67a5e"><div class="ttname"><a href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">mg_handler_info::auth_handler</a></div><div class="ttdeci">mg_authorization_handler auth_handler</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02251">civetweb.c:2251</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_a2c6c179c31ba34d5b628b1a61f5b5f3b"><div class="ttname"><a href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">mg_handler_info::close_handler</a></div><div class="ttdeci">mg_websocket_close_handler close_handler</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02245">civetweb.c:2245</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_a79608a153a2518c199d63e4129b2ec11"><div class="ttname"><a href="structmg__handler__info.html#a79608a153a2518c199d63e4129b2ec11">mg_handler_info::refcount</a></div><div class="ttdeci">unsigned int refcount</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02238">civetweb.c:2238</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_a8ae6876cf6b88993ce82a15560222b66"><div class="ttname"><a href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">mg_handler_info::connect_handler</a></div><div class="ttdeci">mg_websocket_connect_handler connect_handler</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02242">civetweb.c:2242</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_aaabae3fb2c47d2894fa11beedcca33aa"><div class="ttname"><a href="structmg__handler__info.html#aaabae3fb2c47d2894fa11beedcca33aa">mg_handler_info::cbdata</a></div><div class="ttdeci">void * cbdata</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02254">civetweb.c:2254</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_ac72d0a5b9cafe4be0b3dafa8d568517f"><div class="ttname"><a href="structmg__handler__info.html#ac72d0a5b9cafe4be0b3dafa8d568517f">mg_handler_info::subprotocols</a></div><div class="ttdeci">struct mg_websocket_subprotocols * subprotocols</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02248">civetweb.c:2248</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_ad914eff891a0a9d15c6622b77a78dfa3"><div class="ttname"><a href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">mg_handler_info::handler_type</a></div><div class="ttdeci">int handler_type</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02234">civetweb.c:2234</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_ada360840d8b7aa626ee0a6342df03c72"><div class="ttname"><a href="structmg__handler__info.html#ada360840d8b7aa626ee0a6342df03c72">mg_handler_info::removing</a></div><div class="ttdeci">int removing</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02239">civetweb.c:2239</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_adbd9ef4cefda366e3ec0fc51f0c0668e"><div class="ttname"><a href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">mg_handler_info::data_handler</a></div><div class="ttdeci">mg_websocket_data_handler data_handler</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02244">civetweb.c:2244</a></div></div>
<div class="ttc" id="astructmg__handler__info_html_af585e57a9161da42bfe794d7a9468a89"><div class="ttname"><a href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">mg_handler_info::ready_handler</a></div><div class="ttdeci">mg_websocket_ready_handler ready_handler</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02243">civetweb.c:2243</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02251">mg_handler_info::auth_handler</a>, <a class="el" href="civetweb_8c_source.html#l02254">mg_handler_info::cbdata</a>, <a class="el" href="civetweb_8c_source.html#l02245">mg_handler_info::close_handler</a>, <a class="el" href="civetweb_8c_source.html#l02242">mg_handler_info::connect_handler</a>, <a class="el" href="civetweb_8c_source.html#l02244">mg_handler_info::data_handler</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02237">mg_handler_info::handler</a>, <a class="el" href="civetweb_8c_source.html#l02234">mg_handler_info::handler_type</a>, <a class="el" href="civetweb_8c_source.html#l02272">mg_domain_context::handlers</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8c_source.html#l03521">mg_get_request_info()</a>, <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="civetweb_8c_source.html#l02257">mg_handler_info::next</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02243">mg_handler_info::ready_handler</a>, <a class="el" href="civetweb_8c_source.html#l02238">mg_handler_info::refcount</a>, <a class="el" href="civetweb_8c_source.html#l02239">mg_handler_info::removing</a>, <a class="el" href="civetweb_8c_source.html#l02225">REQUEST_HANDLER</a>, <a class="el" href="civetweb_8c_source.html#l02248">mg_handler_info::subprotocols</a>, <a class="el" href="civetweb_8c_source.html#l02230">mg_handler_info::uri</a>, <a class="el" href="civetweb_8c_source.html#l02231">mg_handler_info::uri_len</a>, and <a class="el" href="civetweb_8c_source.html#l02225">WEBSOCKET_HANDLER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a453db96888b9c0e4b7afd85f3778afb2" name="a453db96888b9c0e4b7afd85f3778afb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a453db96888b9c0e4b7afd85f3778afb2">&#9670;&#160;</a></span>get_response()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_response </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>ebuf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>ebuf_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>err</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18737">18737</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">18738</span>{</div>
<div class="line"><span class="lineno">18739</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *cl;</div>
<div class="line"><span class="lineno">18740</span> </div>
<div class="line"><span class="lineno">18741</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> =</div>
<div class="line"><span class="lineno">18742</span>        <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411">CONNECTION_TYPE_RESPONSE</a>; <span class="comment">/* response (valid or not) */</span></div>
<div class="line"><span class="lineno">18743</span> </div>
<div class="line"><span class="lineno">18744</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a52c707b5a0f04dc2908850d5a93068fc">get_message</a>(conn, ebuf, ebuf_len, err)) {</div>
<div class="line"><span class="lineno">18745</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18746</span>    }</div>
<div class="line"><span class="lineno">18747</span> </div>
<div class="line"><span class="lineno">18748</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#ad6bd0851fba7b27c7180498b80f535ca">parse_http_response</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6033a47c6e89ad571ca65000ab53f07e">buf_size</a>, &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>)</div>
<div class="line"><span class="lineno">18749</span>        &lt;= 0) {</div>
<div class="line"><span class="lineno">18750</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18751</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18752</span>                    ebuf,</div>
<div class="line"><span class="lineno">18753</span>                    ebuf_len,</div>
<div class="line"><span class="lineno">18754</span>                    <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18755</span>                    <span class="stringliteral">&quot;Bad response&quot;</span>);</div>
<div class="line"><span class="lineno">18756</span>        *err = 400;</div>
<div class="line"><span class="lineno">18757</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18758</span>    }</div>
<div class="line"><span class="lineno">18759</span> </div>
<div class="line"><span class="lineno">18760</span>    <span class="comment">/* Message is a valid response */</span></div>
<div class="line"><span class="lineno">18761</span> </div>
<div class="line"><span class="lineno">18762</span>    <span class="keywordflow">if</span> (((cl = <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#af6cc6e0a5264c89cfd54e84461a462c8">http_headers</a>,</div>
<div class="line"><span class="lineno">18763</span>                          conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a3becae78e0589983f147dbfd19ae33dc">num_headers</a>,</div>
<div class="line"><span class="lineno">18764</span>                          <span class="stringliteral">&quot;Transfer-Encoding&quot;</span>))</div>
<div class="line"><span class="lineno">18765</span>         != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">18766</span>        &amp;&amp; <a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(cl, <span class="stringliteral">&quot;identity&quot;</span>)) {</div>
<div class="line"><span class="lineno">18767</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(cl, <span class="stringliteral">&quot;chunked&quot;</span>)) {</div>
<div class="line"><span class="lineno">18768</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18769</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18770</span>                        ebuf,</div>
<div class="line"><span class="lineno">18771</span>                        ebuf_len,</div>
<div class="line"><span class="lineno">18772</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18773</span>                        <span class="stringliteral">&quot;Bad request&quot;</span>);</div>
<div class="line"><span class="lineno">18774</span>            *err = 400;</div>
<div class="line"><span class="lineno">18775</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18776</span>        }</div>
<div class="line"><span class="lineno">18777</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 1;</div>
<div class="line"><span class="lineno">18778</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> = 0; <span class="comment">/* not yet read */</span></div>
<div class="line"><span class="lineno">18779</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((cl = <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#af6cc6e0a5264c89cfd54e84461a462c8">http_headers</a>,</div>
<div class="line"><span class="lineno">18780</span>                                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a3becae78e0589983f147dbfd19ae33dc">num_headers</a>,</div>
<div class="line"><span class="lineno">18781</span>                                <span class="stringliteral">&quot;Content-Length&quot;</span>))</div>
<div class="line"><span class="lineno">18782</span>               != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18783</span>        <span class="keywordtype">char</span> *endptr = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18784</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> = strtoll(cl, &amp;endptr, 10);</div>
<div class="line"><span class="lineno">18785</span>        <span class="keywordflow">if</span> ((endptr == cl) || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> &lt; 0)) {</div>
<div class="line"><span class="lineno">18786</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18787</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18788</span>                        ebuf,</div>
<div class="line"><span class="lineno">18789</span>                        ebuf_len,</div>
<div class="line"><span class="lineno">18790</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18791</span>                        <span class="stringliteral">&quot;Bad request&quot;</span>);</div>
<div class="line"><span class="lineno">18792</span>            *err = 411;</div>
<div class="line"><span class="lineno">18793</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18794</span>        }</div>
<div class="line"><span class="lineno">18795</span>        <span class="comment">/* Publish the content length back to the response info. */</span></div>
<div class="line"><span class="lineno">18796</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a26f05559505cae87828be45aec41a1ed">content_length</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>;</div>
<div class="line"><span class="lineno">18797</span> </div>
<div class="line"><span class="lineno">18798</span>        <span class="comment">/* TODO: check if it is still used in response_info */</span></div>
<div class="line"><span class="lineno">18799</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aa1603acb1f2be0de643ebb1e352fdc01">content_length</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>;</div>
<div class="line"><span class="lineno">18800</span> </div>
<div class="line"><span class="lineno">18801</span>        <span class="comment">/* TODO: we should also consider HEAD method */</span></div>
<div class="line"><span class="lineno">18802</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">status_code</a> == 304) {</div>
<div class="line"><span class="lineno">18803</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> = 0;</div>
<div class="line"><span class="lineno">18804</span>        }</div>
<div class="line"><span class="lineno">18805</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">18806</span>        <span class="comment">/* TODO: we should also consider HEAD method */</span></div>
<div class="line"><span class="lineno">18807</span>        <span class="keywordflow">if</span> (((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">status_code</a> &gt;= 100)</div>
<div class="line"><span class="lineno">18808</span>             &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">status_code</a> &lt;= 199))</div>
<div class="line"><span class="lineno">18809</span>            || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">status_code</a> == 204)</div>
<div class="line"><span class="lineno">18810</span>            || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">status_code</a> == 304)) {</div>
<div class="line"><span class="lineno">18811</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> = 0;</div>
<div class="line"><span class="lineno">18812</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">18813</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> = -1; <span class="comment">/* unknown content length */</span></div>
<div class="line"><span class="lineno">18814</span>        }</div>
<div class="line"><span class="lineno">18815</span>    }</div>
<div class="line"><span class="lineno">18816</span> </div>
<div class="line"><span class="lineno">18817</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">18818</span>}</div>
<div class="ttc" id="acivetweb_8c_html_ad6bd0851fba7b27c7180498b80f535ca"><div class="ttname"><a href="#ad6bd0851fba7b27c7180498b80f535ca">parse_http_response</a></div><div class="ttdeci">static int parse_http_response(char *buf, int len, struct mg_response_info *ri)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11001">civetweb.c:11001</a></div></div>
<div class="ttc" id="astructmg__response__info_html_a26f05559505cae87828be45aec41a1ed"><div class="ttname"><a href="structmg__response__info.html#a26f05559505cae87828be45aec41a1ed">mg_response_info::content_length</a></div><div class="ttdeci">long long content_length</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00196">civetweb.h:196</a></div></div>
<div class="ttc" id="astructmg__response__info_html_a3becae78e0589983f147dbfd19ae33dc"><div class="ttname"><a href="structmg__response__info.html#a3becae78e0589983f147dbfd19ae33dc">mg_response_info::num_headers</a></div><div class="ttdeci">int num_headers</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00199">civetweb.h:199</a></div></div>
<div class="ttc" id="astructmg__response__info_html_a542acffb7657ef2be3ad6f6ef0e3d712"><div class="ttname"><a href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">mg_response_info::status_code</a></div><div class="ttdeci">int status_code</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00192">civetweb.h:192</a></div></div>
<div class="ttc" id="astructmg__response__info_html_af6cc6e0a5264c89cfd54e84461a462c8"><div class="ttname"><a href="structmg__response__info.html#af6cc6e0a5264c89cfd54e84461a462c8">mg_response_info::http_headers</a></div><div class="ttdeci">struct mg_header http_headers[MG_MAX_HEADERS]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00201">civetweb.h:200</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02532">mg_connection::buf</a>, <a class="el" href="civetweb_8c_source.html#l02556">mg_connection::buf_size</a>, <a class="el" href="civetweb_8c_source.html#l02486">mg_connection::connection_type</a>, <a class="el" href="civetweb_8c_source.html#l02462">CONNECTION_TYPE_RESPONSE</a>, <a class="el" href="civetweb_8c_source.html#l02518">mg_connection::content_len</a>, <a class="el" href="civetweb_8h_source.html#l00168">mg_request_info::content_length</a>, <a class="el" href="civetweb_8h_source.html#l00196">mg_response_info::content_length</a>, <a class="el" href="civetweb_8c_source.html#l03820">get_header()</a>, <a class="el" href="civetweb_8c_source.html#l18569">get_message()</a>, <a class="el" href="civetweb_8h_source.html#l00200">mg_response_info::http_headers</a>, <a class="el" href="civetweb_8c_source.html#l02525">mg_connection::is_chunked</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00199">mg_response_info::num_headers</a>, <a class="el" href="civetweb_8c_source.html#l11001">parse_http_response()</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l02495">mg_connection::response_info</a>, and <a class="el" href="civetweb_8h_source.html#l00192">mg_response_info::status_code</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l18874">mg_download()</a>, and <a class="el" href="civetweb_8c_source.html#l18822">mg_get_response()</a>.</p>

</div>
</div>
<a id="a99d34b5bd845aa051904a159156abc26" name="a99d34b5bd845aa051904a159156abc26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99d34b5bd845aa051904a159156abc26">&#9670;&#160;</a></span>get_system_name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void get_system_name </td>
          <td>(</td>
          <td class="paramtype">char **</td>          <td class="paramname"><span class="paramname"><em>sysName</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l20389">20389</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">20390</span>{</div>
<div class="line"><span class="lineno">20391</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">20392</span>    <span class="keywordtype">char</span> <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>[128];</div>
<div class="line"><span class="lineno">20393</span>    DWORD dwVersion = 0;</div>
<div class="line"><span class="lineno">20394</span>    DWORD dwMajorVersion = 0;</div>
<div class="line"><span class="lineno">20395</span>    DWORD dwMinorVersion = 0;</div>
<div class="line"><span class="lineno">20396</span>    DWORD dwBuild = 0;</div>
<div class="line"><span class="lineno">20397</span>    BOOL wowRet, isWoW = <a class="code hl_define" href="gmacros_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">20398</span> </div>
<div class="line"><span class="lineno">20399</span><span class="preprocessor">#if defined(_MSC_VER)</span></div>
<div class="line"><span class="lineno">20400</span><span class="preprocessor">#pragma warning(push)</span></div>
<div class="line"><span class="lineno">20401</span>    <span class="comment">/* GetVersion was declared deprecated */</span></div>
<div class="line"><span class="lineno">20402</span><span class="preprocessor">#pragma warning(disable : 4996)</span></div>
<div class="line"><span class="lineno">20403</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20404</span>    dwVersion = GetVersion();</div>
<div class="line"><span class="lineno">20405</span><span class="preprocessor">#if defined(_MSC_VER)</span></div>
<div class="line"><span class="lineno">20406</span><span class="preprocessor">#pragma warning(pop)</span></div>
<div class="line"><span class="lineno">20407</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20408</span> </div>
<div class="line"><span class="lineno">20409</span>    dwMajorVersion = (DWORD)(LOBYTE(LOWORD(dwVersion)));</div>
<div class="line"><span class="lineno">20410</span>    dwMinorVersion = (DWORD)(HIBYTE(LOWORD(dwVersion)));</div>
<div class="line"><span class="lineno">20411</span>    dwBuild = ((dwVersion &lt; 0x80000000) ? (DWORD)(HIWORD(dwVersion)) : 0);</div>
<div class="line"><span class="lineno">20412</span>    (void)dwBuild;</div>
<div class="line"><span class="lineno">20413</span> </div>
<div class="line"><span class="lineno">20414</span>    wowRet = IsWow64Process(GetCurrentProcess(), &amp;isWoW);</div>
<div class="line"><span class="lineno">20415</span> </div>
<div class="line"><span class="lineno">20416</span>    sprintf(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,</div>
<div class="line"><span class="lineno">20417</span>            <span class="stringliteral">&quot;Windows %u.%u%s&quot;</span>,</div>
<div class="line"><span class="lineno">20418</span>            (<span class="keywordtype">unsigned</span>)dwMajorVersion,</div>
<div class="line"><span class="lineno">20419</span>            (<span class="keywordtype">unsigned</span>)dwMinorVersion,</div>
<div class="line"><span class="lineno">20420</span>            (wowRet ? (isWoW ? <span class="stringliteral">&quot; (WoW64)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>) : <span class="stringliteral">&quot; (?)&quot;</span>));</div>
<div class="line"><span class="lineno">20421</span> </div>
<div class="line"><span class="lineno">20422</span>    *sysName = <a class="code hl_function" href="#a4e6a5dc184d97ba5278dfda5b838f1cc">mg_strdup</a>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20423</span> </div>
<div class="line"><span class="lineno">20424</span><span class="preprocessor">#elif defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno">20425</span>    *sysName = <a class="code hl_function" href="#a4e6a5dc184d97ba5278dfda5b838f1cc">mg_strdup</a>(<span class="stringliteral">&quot;Zephyr OS&quot;</span>);</div>
<div class="line"><span class="lineno">20426</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">20427</span>    <span class="keyword">struct </span>utsname <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>;</div>
<div class="line"><span class="lineno">20428</span>    memset(&amp;<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>));</div>
<div class="line"><span class="lineno">20429</span>    uname(&amp;<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20430</span>    *sysName = <a class="code hl_function" href="#a4e6a5dc184d97ba5278dfda5b838f1cc">mg_strdup</a>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.sysname);</div>
<div class="line"><span class="lineno">20431</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20432</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00929">FALSE</a>, <a class="el" href="civetweb_8c_source.html#l03068">mg_strdup()</a>, and <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="a97c47a9a92a85f9cfbc1ae8a28738e2a" name="a97c47a9a92a85f9cfbc1ae8a28738e2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97c47a9a92a85f9cfbc1ae8a28738e2a">&#9670;&#160;</a></span>get_uri_type()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_uri_type </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uri</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18395">18395</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">18396</span>{</div>
<div class="line"><span class="lineno">18397</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">18398</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *hostend, *portbegin;</div>
<div class="line"><span class="lineno">18399</span>    <span class="keywordtype">char</span> *portend;</div>
<div class="line"><span class="lineno">18400</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> port;</div>
<div class="line"><span class="lineno">18401</span> </div>
<div class="line"><span class="lineno">18402</span>    <span class="comment">/* According to the HTTP standard</span></div>
<div class="line"><span class="lineno">18403</span><span class="comment">     * http://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html#sec5.1.2</span></div>
<div class="line"><span class="lineno">18404</span><span class="comment">     * URI can be an asterisk (*) or should start with slash (relative uri),</span></div>
<div class="line"><span class="lineno">18405</span><span class="comment">     * or it should start with the protocol (absolute uri). */</span></div>
<div class="line"><span class="lineno">18406</span>    <span class="keywordflow">if</span> ((uri[0] == <span class="charliteral">&#39;*&#39;</span>) &amp;&amp; (uri[1] == <span class="charliteral">&#39;\0&#39;</span>)) {</div>
<div class="line"><span class="lineno">18407</span>        <span class="comment">/* asterisk */</span></div>
<div class="line"><span class="lineno">18408</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">18409</span>    }</div>
<div class="line"><span class="lineno">18410</span> </div>
<div class="line"><span class="lineno">18411</span>    <span class="comment">/* Valid URIs according to RFC 3986</span></div>
<div class="line"><span class="lineno">18412</span><span class="comment">     * (https://www.ietf.org/rfc/rfc3986.txt)</span></div>
<div class="line"><span class="lineno">18413</span><span class="comment">     * must only contain reserved characters :/?#[]@!$&amp;&#39;()*+,;=</span></div>
<div class="line"><span class="lineno">18414</span><span class="comment">     * and unreserved characters A-Z a-z 0-9 and -._~</span></div>
<div class="line"><span class="lineno">18415</span><span class="comment">     * and % encoded symbols.</span></div>
<div class="line"><span class="lineno">18416</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">18417</span>    <span class="keywordflow">for</span> (i = 0; uri[i] != 0; i++) {</div>
<div class="line"><span class="lineno">18418</span>        <span class="keywordflow">if</span> (uri[i] &lt; 33) {</div>
<div class="line"><span class="lineno">18419</span>            <span class="comment">/* control characters and spaces are invalid */</span></div>
<div class="line"><span class="lineno">18420</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18421</span>        }</div>
<div class="line"><span class="lineno">18422</span>        <span class="comment">/* Allow everything else here (See #894) */</span></div>
<div class="line"><span class="lineno">18423</span>    }</div>
<div class="line"><span class="lineno">18424</span> </div>
<div class="line"><span class="lineno">18425</span>    <span class="comment">/* A relative uri starts with a / character */</span></div>
<div class="line"><span class="lineno">18426</span>    <span class="keywordflow">if</span> (uri[0] == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno">18427</span>        <span class="comment">/* relative uri */</span></div>
<div class="line"><span class="lineno">18428</span>        <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno">18429</span>    }</div>
<div class="line"><span class="lineno">18430</span> </div>
<div class="line"><span class="lineno">18431</span>    <span class="comment">/* It could be an absolute uri: */</span></div>
<div class="line"><span class="lineno">18432</span>    <span class="comment">/* This function only checks if the uri is valid, not if it is</span></div>
<div class="line"><span class="lineno">18433</span><span class="comment">     * addressing the current server. So civetweb can also be used</span></div>
<div class="line"><span class="lineno">18434</span><span class="comment">     * as a proxy server. */</span></div>
<div class="line"><span class="lineno">18435</span>    <span class="keywordflow">for</span> (i = 0; <a class="code hl_variable" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>[i].proto != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; i++) {</div>
<div class="line"><span class="lineno">18436</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(uri,</div>
<div class="line"><span class="lineno">18437</span>                           <a class="code hl_variable" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>[i].<a class="code hl_variable" href="#a1491042fd5b61bf39023b8df4c736128">proto</a>,</div>
<div class="line"><span class="lineno">18438</span>                           <a class="code hl_variable" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>[i].<a class="code hl_variable" href="#ae76eb848818055987d653483ac38ec19">proto_len</a>)</div>
<div class="line"><span class="lineno">18439</span>            == 0) {</div>
<div class="line"><span class="lineno">18440</span> </div>
<div class="line"><span class="lineno">18441</span>            hostend = strchr(uri + <a class="code hl_variable" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>[i].<a class="code hl_variable" href="#ae76eb848818055987d653483ac38ec19">proto_len</a>, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">18442</span>            <span class="keywordflow">if</span> (!hostend) {</div>
<div class="line"><span class="lineno">18443</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18444</span>            }</div>
<div class="line"><span class="lineno">18445</span>            portbegin = strchr(uri + <a class="code hl_variable" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>[i].<a class="code hl_variable" href="#ae76eb848818055987d653483ac38ec19">proto_len</a>, <span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line"><span class="lineno">18446</span>            <span class="keywordflow">if</span> (!portbegin) {</div>
<div class="line"><span class="lineno">18447</span>                <span class="keywordflow">return</span> 3;</div>
<div class="line"><span class="lineno">18448</span>            }</div>
<div class="line"><span class="lineno">18449</span> </div>
<div class="line"><span class="lineno">18450</span>            port = strtoul(portbegin + 1, &amp;portend, 10);</div>
<div class="line"><span class="lineno">18451</span>            <span class="keywordflow">if</span> ((portend != hostend) || (port &lt;= 0) || !<a class="code hl_function" href="#ab0cba7d970883b21a4db625c33cba9ac">is_valid_port</a>(port)) {</div>
<div class="line"><span class="lineno">18452</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18453</span>            }</div>
<div class="line"><span class="lineno">18454</span> </div>
<div class="line"><span class="lineno">18455</span>            <span class="keywordflow">return</span> 4;</div>
<div class="line"><span class="lineno">18456</span>        }</div>
<div class="line"><span class="lineno">18457</span>    }</div>
<div class="line"><span class="lineno">18458</span> </div>
<div class="line"><span class="lineno">18459</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">18460</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#a75d2d9abb3e5abaaf44e99b9f805f07a">abs_uri_protocols</a>, <a class="el" href="civetweb_8c_source.html#l09239">is_valid_port()</a>, <a class="el" href="civetweb_8c_source.html#l03019">mg_strncasecmp()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l18378">proto</a>, and <a class="el" href="civetweb_8c_source.html#l18379">proto_len</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, and <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>.</p>

</div>
</div>
<a id="a7ef6ebce89c81f7218a0968e3aa9107f" name="a7ef6ebce89c81f7218a0968e3aa9107f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ef6ebce89c81f7218a0968e3aa9107f">&#9670;&#160;</a></span>gmt_time_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void gmt_time_string </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>buf_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *</td>          <td class="paramname"><span class="paramname"><em>t</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03341">3341</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3342</span>{</div>
<div class="line"><span class="lineno"> 3343</span><span class="preprocessor">#if !defined(REENTRANT_TIME)</span></div>
<div class="line"><span class="lineno"> 3344</span>    <span class="keyword">struct </span>tm *tm;</div>
<div class="line"><span class="lineno"> 3345</span> </div>
<div class="line"><span class="lineno"> 3346</span>    tm = ((t != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? gmtime(t) : <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 3347</span>    <span class="keywordflow">if</span> (tm != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3348</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 3349</span>    <span class="keyword">struct </span>tm _tm;</div>
<div class="line"><span class="lineno"> 3350</span>    <span class="keyword">struct </span>tm *tm = &amp;_tm;</div>
<div class="line"><span class="lineno"> 3351</span> </div>
<div class="line"><span class="lineno"> 3352</span>    <span class="keywordflow">if</span> (t != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3353</span>        gmtime_r(t, tm);</div>
<div class="line"><span class="lineno"> 3354</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3355</span>        strftime(buf, buf_len, <span class="stringliteral">&quot;%a, %d %b %Y %H:%M:%S GMT&quot;</span>, tm);</div>
<div class="line"><span class="lineno"> 3356</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3357</span>        <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(buf, <span class="stringliteral">&quot;Thu, 01 Jan 1970 00:00:00 GMT&quot;</span>, buf_len);</div>
<div class="line"><span class="lineno"> 3358</span>    }</div>
<div class="line"><span class="lineno"> 3359</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l10483">handle_not_modified_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l21843">mg_get_context_info()</a>, and <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>.</p>

</div>
</div>
<a id="af04594d5550fa7ce1f249ff3eed4c7d9" name="af04594d5550fa7ce1f249ff3eed4c7d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af04594d5550fa7ce1f249ff3eed4c7d9">&#9670;&#160;</a></span>handle_cgi_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_cgi_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>prog</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>cgi_config_idx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l11587">11587</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">11590</span>{</div>
<div class="line"><span class="lineno">11591</span>    <span class="keywordtype">char</span> *buf;</div>
<div class="line"><span class="lineno">11592</span>    <span class="keywordtype">size_t</span> buflen;</div>
<div class="line"><span class="lineno">11593</span>    <span class="keywordtype">int</span> headers_len, data_len, i, truncated;</div>
<div class="line"><span class="lineno">11594</span>    <span class="keywordtype">int</span> fdin[2] = {-1, -1}, fdout[2] = {-1, -1}, fderr[2] = {-1, -1};</div>
<div class="line"><span class="lineno">11595</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *status, *status_text;</div>
<div class="line"><span class="lineno">11596</span>    <span class="keywordtype">char</span> *pbuf, dir[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>], *p;</div>
<div class="line"><span class="lineno">11597</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__request__info.html">mg_request_info</a> ri;</div>
<div class="line"><span class="lineno">11598</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structcgi__environment.html">cgi_environment</a> blk;</div>
<div class="line"><span class="lineno">11599</span>    FILE *in = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *out = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *err = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">11600</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> fout = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">11601</span>    pid_t pid = (pid_t)-1;</div>
<div class="line"><span class="lineno">11602</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structprocess__control__data.html">process_control_data</a> *proc = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">11603</span>    <span class="keywordtype">char</span> *cfg_buffering = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55babb844e7f11a02780ac6a94b3b4dd754d">CGI_BUFFERING</a> + cgi_config_idx];</div>
<div class="line"><span class="lineno">11604</span>    <span class="keywordtype">int</span> no_buffering = 0;</div>
<div class="line"><span class="lineno">11605</span> </div>
<div class="line"><span class="lineno">11606</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno">11607</span>    <span class="keywordtype">double</span> cgi_timeout;</div>
<div class="line"><span class="lineno">11608</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[CGI_TIMEOUT + cgi_config_idx]) {</div>
<div class="line"><span class="lineno">11609</span>        <span class="comment">/* Get timeout in seconds */</span></div>
<div class="line"><span class="lineno">11610</span>        cgi_timeout =</div>
<div class="line"><span class="lineno">11611</span>            atof(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[CGI_TIMEOUT + cgi_config_idx]) * 0.001;</div>
<div class="line"><span class="lineno">11612</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11613</span>        cgi_timeout =</div>
<div class="line"><span class="lineno">11614</span>            atof(<a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>].default_value) * 0.001;</div>
<div class="line"><span class="lineno">11615</span>    }</div>
<div class="line"><span class="lineno">11616</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">11617</span>    <span class="keywordflow">if</span> (cfg_buffering != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11618</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(cfg_buffering, <span class="stringliteral">&quot;no&quot;</span>)) {</div>
<div class="line"><span class="lineno">11619</span>            no_buffering = 1;</div>
<div class="line"><span class="lineno">11620</span>        }</div>
<div class="line"><span class="lineno">11621</span>    }</div>
<div class="line"><span class="lineno">11622</span> </div>
<div class="line"><span class="lineno">11623</span>    buf = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">11624</span>    buflen = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#af17486f182c09fa18f04d21212d6d381">max_request_size</a>;</div>
<div class="line"><span class="lineno">11625</span>    i = <a class="code hl_function" href="#aa983f82b2ad0172f78ed1e9f6ba572f7">prepare_cgi_environment</a>(conn, prog, &amp;blk, cgi_config_idx);</div>
<div class="line"><span class="lineno">11626</span>    <span class="keywordflow">if</span> (i != 0) {</div>
<div class="line"><span class="lineno">11627</span>        blk.buf = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">11628</span>        blk.var = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">11629</span>        <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">11630</span>    }</div>
<div class="line"><span class="lineno">11631</span> </div>
<div class="line"><span class="lineno">11632</span>    <span class="comment">/* CGI must be executed in its own directory. &#39;dir&#39; must point to the</span></div>
<div class="line"><span class="lineno">11633</span><span class="comment">     * directory containing executable program, &#39;p&#39; must point to the</span></div>
<div class="line"><span class="lineno">11634</span><span class="comment">     * executable program name relative to &#39;dir&#39;. */</span></div>
<div class="line"><span class="lineno">11635</span>    (void)<a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn, &amp;truncated, dir, <span class="keyword">sizeof</span>(dir), <span class="stringliteral">&quot;%s&quot;</span>, prog);</div>
<div class="line"><span class="lineno">11636</span> </div>
<div class="line"><span class="lineno">11637</span>    <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno">11638</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;Error: CGI program \&quot;%s\&quot;: Path too long&quot;</span>, prog);</div>
<div class="line"><span class="lineno">11639</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 500, <span class="stringliteral">&quot;Error: %s&quot;</span>, <span class="stringliteral">&quot;CGI path too long&quot;</span>);</div>
<div class="line"><span class="lineno">11640</span>        <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">11641</span>    }</div>
<div class="line"><span class="lineno">11642</span> </div>
<div class="line"><span class="lineno">11643</span>    <span class="keywordflow">if</span> ((p = strrchr(dir, <span class="charliteral">&#39;/&#39;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11644</span>        *p++ = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">11645</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11646</span>        dir[0] = <span class="charliteral">&#39;.&#39;</span>;</div>
<div class="line"><span class="lineno">11647</span>        dir[1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">11648</span>        p = (<span class="keywordtype">char</span> *)prog;</div>
<div class="line"><span class="lineno">11649</span>    }</div>
<div class="line"><span class="lineno">11650</span> </div>
<div class="line"><span class="lineno">11651</span>    <span class="keywordflow">if</span> ((pipe(fdin) != 0) || (pipe(fdout) != 0) || (pipe(fderr) != 0)) {</div>
<div class="line"><span class="lineno">11652</span>        status = strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>);</div>
<div class="line"><span class="lineno">11653</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(</div>
<div class="line"><span class="lineno">11654</span>            conn,</div>
<div class="line"><span class="lineno">11655</span>            <span class="stringliteral">&quot;Error: CGI program \&quot;%s\&quot;: Can not create CGI pipes: %s&quot;</span>,</div>
<div class="line"><span class="lineno">11656</span>            prog,</div>
<div class="line"><span class="lineno">11657</span>            status);</div>
<div class="line"><span class="lineno">11658</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">11659</span>                           500,</div>
<div class="line"><span class="lineno">11660</span>                           <span class="stringliteral">&quot;Error: Cannot create CGI pipe: %s&quot;</span>,</div>
<div class="line"><span class="lineno">11661</span>                           status);</div>
<div class="line"><span class="lineno">11662</span>        <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">11663</span>    }</div>
<div class="line"><span class="lineno">11664</span> </div>
<div class="line"><span class="lineno">11665</span>    proc = (<span class="keyword">struct </span><a class="code hl_struct" href="structprocess__control__data.html">process_control_data</a> *)</div>
<div class="line"><span class="lineno">11666</span>        <a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="structprocess__control__data.html">process_control_data</a>), conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">11667</span>    <span class="keywordflow">if</span> (proc == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11668</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;Error: CGI program \&quot;%s\&quot;: Out or memory&quot;</span>, prog);</div>
<div class="line"><span class="lineno">11669</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 500, <span class="stringliteral">&quot;Error: Out of memory [%s]&quot;</span>, prog);</div>
<div class="line"><span class="lineno">11670</span>        <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">11671</span>    }</div>
<div class="line"><span class="lineno">11672</span> </div>
<div class="line"><span class="lineno">11673</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;CGI: spawn %s %s\n&quot;</span>, dir, p);</div>
<div class="line"><span class="lineno">11674</span>    <a class="code hl_variable" href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">pid</a> = <a class="code hl_function" href="#a10cbc96e5456363bea1672bfc3f526dd">spawn_process</a>(</div>
<div class="line"><span class="lineno">11675</span>        conn, p, blk.buf, blk.var, fdin, fdout, fderr, dir, cgi_config_idx);</div>
<div class="line"><span class="lineno">11676</span> </div>
<div class="line"><span class="lineno">11677</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">pid</a> == (pid_t)-1) {</div>
<div class="line"><span class="lineno">11678</span>        status = strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>);</div>
<div class="line"><span class="lineno">11679</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(</div>
<div class="line"><span class="lineno">11680</span>            conn,</div>
<div class="line"><span class="lineno">11681</span>            <span class="stringliteral">&quot;Error: CGI program \&quot;%s\&quot;: Can not spawn CGI process: %s&quot;</span>,</div>
<div class="line"><span class="lineno">11682</span>            prog,</div>
<div class="line"><span class="lineno">11683</span>            status);</div>
<div class="line"><span class="lineno">11684</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 500, <span class="stringliteral">&quot;Error: Cannot spawn CGI process&quot;</span>);</div>
<div class="line"><span class="lineno">11685</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(proc);</div>
<div class="line"><span class="lineno">11686</span>        proc = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">11687</span>        <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">11688</span>    }</div>
<div class="line"><span class="lineno">11689</span> </div>
<div class="line"><span class="lineno">11690</span>    <span class="comment">/* Store data in shared process_control_data */</span></div>
<div class="line"><span class="lineno">11691</span>    proc-&gt;<a class="code hl_variable" href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">pid</a> = <a class="code hl_variable" href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">pid</a>;</div>
<div class="line"><span class="lineno">11692</span>    proc-&gt;<a class="code hl_variable" href="structprocess__control__data.html#ad70b3fc1e856b7a6f32f32a89a80afba">references</a> = 1;</div>
<div class="line"><span class="lineno">11693</span> </div>
<div class="line"><span class="lineno">11694</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno">11695</span>    <span class="keywordflow">if</span> (cgi_timeout &gt; 0.0) {</div>
<div class="line"><span class="lineno">11696</span>        proc-&gt;<a class="code hl_variable" href="structprocess__control__data.html#ad70b3fc1e856b7a6f32f32a89a80afba">references</a> = 2;</div>
<div class="line"><span class="lineno">11697</span> </div>
<div class="line"><span class="lineno">11698</span>        <span class="comment">// Start a timer for CGI</span></div>
<div class="line"><span class="lineno">11699</span>        timer_add(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>,</div>
<div class="line"><span class="lineno">11700</span>                  cgi_timeout <span class="comment">/* in seconds */</span>,</div>
<div class="line"><span class="lineno">11701</span>                  0.0,</div>
<div class="line"><span class="lineno">11702</span>                  1,</div>
<div class="line"><span class="lineno">11703</span>                  <a class="code hl_function" href="#a2dd9b83e27accc1b564a11b3ff531c9d">abort_cgi_process</a>,</div>
<div class="line"><span class="lineno">11704</span>                  (<span class="keywordtype">void</span> *)proc,</div>
<div class="line"><span class="lineno">11705</span>                  <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">11706</span>    }</div>
<div class="line"><span class="lineno">11707</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">11708</span> </div>
<div class="line"><span class="lineno">11709</span>    <span class="comment">/* Parent closes only one side of the pipes.</span></div>
<div class="line"><span class="lineno">11710</span><span class="comment">     * If we don&#39;t mark them as closed, close() attempt before</span></div>
<div class="line"><span class="lineno">11711</span><span class="comment">     * return from this function throws an exception on Windows.</span></div>
<div class="line"><span class="lineno">11712</span><span class="comment">     * Windows does not like when closed descriptor is closed again. */</span></div>
<div class="line"><span class="lineno">11713</span>    (void)close(fdin[0]);</div>
<div class="line"><span class="lineno">11714</span>    (void)close(fdout[1]);</div>
<div class="line"><span class="lineno">11715</span>    (void)close(fderr[1]);</div>
<div class="line"><span class="lineno">11716</span>    fdin[0] = fdout[1] = fderr[1] = -1;</div>
<div class="line"><span class="lineno">11717</span> </div>
<div class="line"><span class="lineno">11718</span>    <span class="keywordflow">if</span> (((in = fdopen(fdin[1], <span class="stringliteral">&quot;wb&quot;</span>)) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">11719</span>        || ((out = fdopen(fdout[0], <span class="stringliteral">&quot;rb&quot;</span>)) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">11720</span>        || ((err = fdopen(fderr[0], <span class="stringliteral">&quot;rb&quot;</span>)) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">11721</span>        status = strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>);</div>
<div class="line"><span class="lineno">11722</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">11723</span>                        <span class="stringliteral">&quot;Error: CGI program \&quot;%s\&quot;: Can not open fd: %s&quot;</span>,</div>
<div class="line"><span class="lineno">11724</span>                        prog,</div>
<div class="line"><span class="lineno">11725</span>                        status);</div>
<div class="line"><span class="lineno">11726</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">11727</span>                           500,</div>
<div class="line"><span class="lineno">11728</span>                           <span class="stringliteral">&quot;Error: CGI can not open fd\nfdopen: %s&quot;</span>,</div>
<div class="line"><span class="lineno">11729</span>                           status);</div>
<div class="line"><span class="lineno">11730</span>        <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">11731</span>    }</div>
<div class="line"><span class="lineno">11732</span> </div>
<div class="line"><span class="lineno">11733</span>    setbuf(in, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">11734</span>    setbuf(out, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">11735</span>    setbuf(err, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">11736</span>    fout.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> = out;</div>
<div class="line"><span class="lineno">11737</span> </div>
<div class="line"><span class="lineno">11738</span>    <span class="keywordflow">if</span> ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> != 0) || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a>)) {</div>
<div class="line"><span class="lineno">11739</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;CGI: send body data (%&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a> <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line"><span class="lineno">11740</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>);</div>
<div class="line"><span class="lineno">11741</span> </div>
<div class="line"><span class="lineno">11742</span>        <span class="comment">/* This is a POST/PUT request, or another request with body data. */</span></div>
<div class="line"><span class="lineno">11743</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a6b0ac164cc67271e3819e1d6c967ef95">forward_body_data</a>(conn, in, <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">11744</span>            <span class="comment">/* Error sending the body data */</span></div>
<div class="line"><span class="lineno">11745</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(</div>
<div class="line"><span class="lineno">11746</span>                conn,</div>
<div class="line"><span class="lineno">11747</span>                <span class="stringliteral">&quot;Error: CGI program \&quot;%s\&quot;: Forward body data failed&quot;</span>,</div>
<div class="line"><span class="lineno">11748</span>                prog);</div>
<div class="line"><span class="lineno">11749</span>            <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">11750</span>        }</div>
<div class="line"><span class="lineno">11751</span>    }</div>
<div class="line"><span class="lineno">11752</span> </div>
<div class="line"><span class="lineno">11753</span>    <span class="comment">/* Close so child gets an EOF. */</span></div>
<div class="line"><span class="lineno">11754</span>    fclose(in);</div>
<div class="line"><span class="lineno">11755</span>    in = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">11756</span>    fdin[1] = -1;</div>
<div class="line"><span class="lineno">11757</span> </div>
<div class="line"><span class="lineno">11758</span>    <span class="comment">/* Now read CGI reply into a buffer. We need to set correct</span></div>
<div class="line"><span class="lineno">11759</span><span class="comment">     * status code, thus we need to see all HTTP headers first.</span></div>
<div class="line"><span class="lineno">11760</span><span class="comment">     * Do not send anything back to client, until we buffer in all</span></div>
<div class="line"><span class="lineno">11761</span><span class="comment">     * HTTP headers. */</span></div>
<div class="line"><span class="lineno">11762</span>    data_len = 0;</div>
<div class="line"><span class="lineno">11763</span>    buf = (<span class="keywordtype">char</span> *)<a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(buflen, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">11764</span>    <span class="keywordflow">if</span> (buf == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11765</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">11766</span>                           500,</div>
<div class="line"><span class="lineno">11767</span>                           <span class="stringliteral">&quot;Error: Not enough memory for CGI buffer (%u bytes)&quot;</span>,</div>
<div class="line"><span class="lineno">11768</span>                           (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)buflen);</div>
<div class="line"><span class="lineno">11769</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(</div>
<div class="line"><span class="lineno">11770</span>            conn,</div>
<div class="line"><span class="lineno">11771</span>            <span class="stringliteral">&quot;Error: CGI program \&quot;%s\&quot;: Not enough memory for buffer (%u &quot;</span></div>
<div class="line"><span class="lineno">11772</span>            <span class="stringliteral">&quot;bytes)&quot;</span>,</div>
<div class="line"><span class="lineno">11773</span>            prog,</div>
<div class="line"><span class="lineno">11774</span>            (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)buflen);</div>
<div class="line"><span class="lineno">11775</span>        <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">11776</span>    }</div>
<div class="line"><span class="lineno">11777</span> </div>
<div class="line"><span class="lineno">11778</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;CGI: %s&quot;</span>, <span class="stringliteral">&quot;wait for response&quot;</span>);</div>
<div class="line"><span class="lineno">11779</span>    headers_len = <a class="code hl_function" href="#ab8b35962b277d0cc31f7e16541b326ea">read_message</a>(out, conn, buf, (<span class="keywordtype">int</span>)buflen, &amp;data_len);</div>
<div class="line"><span class="lineno">11780</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;CGI: response: %li&quot;</span>, (<span class="keywordtype">signed</span> <span class="keywordtype">long</span>)headers_len);</div>
<div class="line"><span class="lineno">11781</span> </div>
<div class="line"><span class="lineno">11782</span>    <span class="keywordflow">if</span> (headers_len &lt;= 0) {</div>
<div class="line"><span class="lineno">11783</span> </div>
<div class="line"><span class="lineno">11784</span>        <span class="comment">/* Could not parse the CGI response. Check if some error message on</span></div>
<div class="line"><span class="lineno">11785</span><span class="comment">         * stderr. */</span></div>
<div class="line"><span class="lineno">11786</span>        i = <a class="code hl_function" href="#a807c2737d59afedd4cc79747f416ea42">pull_all</a>(err, conn, buf, (<span class="keywordtype">int</span>)buflen);</div>
<div class="line"><span class="lineno">11787</span>        <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><span class="lineno">11788</span>            <span class="comment">/* CGI program explicitly sent an error */</span></div>
<div class="line"><span class="lineno">11789</span>            <span class="comment">/* Write the error message to the internal log */</span></div>
<div class="line"><span class="lineno">11790</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">11791</span>                            <span class="stringliteral">&quot;Error: CGI program \&quot;%s\&quot; sent error &quot;</span></div>
<div class="line"><span class="lineno">11792</span>                            <span class="stringliteral">&quot;message: [%.*s]&quot;</span>,</div>
<div class="line"><span class="lineno">11793</span>                            prog,</div>
<div class="line"><span class="lineno">11794</span>                            i,</div>
<div class="line"><span class="lineno">11795</span>                            buf);</div>
<div class="line"><span class="lineno">11796</span>            <span class="comment">/* Don&#39;t send the error message back to the client */</span></div>
<div class="line"><span class="lineno">11797</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">11798</span>                               500,</div>
<div class="line"><span class="lineno">11799</span>                               <span class="stringliteral">&quot;Error: CGI program \&quot;%s\&quot; failed.&quot;</span>,</div>
<div class="line"><span class="lineno">11800</span>                               prog);</div>
<div class="line"><span class="lineno">11801</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11802</span>            <span class="comment">/* CGI program did not explicitly send an error, but a broken</span></div>
<div class="line"><span class="lineno">11803</span><span class="comment">             * respon header */</span></div>
<div class="line"><span class="lineno">11804</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">11805</span>                            <span class="stringliteral">&quot;Error: CGI program sent malformed or too big &quot;</span></div>
<div class="line"><span class="lineno">11806</span>                            <span class="stringliteral">&quot;(&gt;%u bytes) HTTP headers: [%.*s]&quot;</span>,</div>
<div class="line"><span class="lineno">11807</span>                            (<span class="keywordtype">unsigned</span>)buflen,</div>
<div class="line"><span class="lineno">11808</span>                            data_len,</div>
<div class="line"><span class="lineno">11809</span>                            buf);</div>
<div class="line"><span class="lineno">11810</span> </div>
<div class="line"><span class="lineno">11811</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">11812</span>                               500,</div>
<div class="line"><span class="lineno">11813</span>                               <span class="stringliteral">&quot;Error: CGI program sent malformed or too big &quot;</span></div>
<div class="line"><span class="lineno">11814</span>                               <span class="stringliteral">&quot;(&gt;%u bytes) HTTP headers: [%.*s]&quot;</span>,</div>
<div class="line"><span class="lineno">11815</span>                               (<span class="keywordtype">unsigned</span>)buflen,</div>
<div class="line"><span class="lineno">11816</span>                               data_len,</div>
<div class="line"><span class="lineno">11817</span>                               buf);</div>
<div class="line"><span class="lineno">11818</span>        }</div>
<div class="line"><span class="lineno">11819</span> </div>
<div class="line"><span class="lineno">11820</span>        <span class="comment">/* in both cases, abort processing CGI */</span></div>
<div class="line"><span class="lineno">11821</span>        <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">11822</span>    }</div>
<div class="line"><span class="lineno">11823</span> </div>
<div class="line"><span class="lineno">11824</span>    pbuf = buf;</div>
<div class="line"><span class="lineno">11825</span>    buf[headers_len - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">11826</span>    ri.num_headers = <a class="code hl_function" href="#a461ef0a8b46dd9223774d62a6f290186">parse_http_headers</a>(&amp;pbuf, ri.http_headers);</div>
<div class="line"><span class="lineno">11827</span> </div>
<div class="line"><span class="lineno">11828</span>    <span class="comment">/* Make up and send the status line */</span></div>
<div class="line"><span class="lineno">11829</span>    status_text = <span class="stringliteral">&quot;OK&quot;</span>;</div>
<div class="line"><span class="lineno">11830</span>    <span class="keywordflow">if</span> ((status = <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(ri.http_headers, ri.num_headers, <span class="stringliteral">&quot;Status&quot;</span>))</div>
<div class="line"><span class="lineno">11831</span>        != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11832</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = atoi(status);</div>
<div class="line"><span class="lineno">11833</span>        status_text = status;</div>
<div class="line"><span class="lineno">11834</span>        <span class="keywordflow">while</span> (isdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*status_text) || *status_text == <span class="charliteral">&#39; &#39;</span>) {</div>
<div class="line"><span class="lineno">11835</span>            status_text++;</div>
<div class="line"><span class="lineno">11836</span>        }</div>
<div class="line"><span class="lineno">11837</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(ri.http_headers, ri.num_headers, <span class="stringliteral">&quot;Location&quot;</span>)</div>
<div class="line"><span class="lineno">11838</span>               != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11839</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 307;</div>
<div class="line"><span class="lineno">11840</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11841</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 200;</div>
<div class="line"><span class="lineno">11842</span>    }</div>
<div class="line"><span class="lineno">11843</span> </div>
<div class="line"><span class="lineno">11844</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a2f83db0ca198c57993fb3e3cd5e97500">should_keep_alive</a>(conn)) {</div>
<div class="line"><span class="lineno">11845</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">11846</span>    }</div>
<div class="line"><span class="lineno">11847</span> </div>
<div class="line"><span class="lineno">11848</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;CGI: response %u %s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a>, status_text);</div>
<div class="line"><span class="lineno">11849</span> </div>
<div class="line"><span class="lineno">11850</span>    (void)<a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn, <span class="stringliteral">&quot;HTTP/1.1 %d %s\r\n&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a>, status_text);</div>
<div class="line"><span class="lineno">11851</span> </div>
<div class="line"><span class="lineno">11852</span>    <span class="comment">/* Send headers */</span></div>
<div class="line"><span class="lineno">11853</span>    <span class="keywordflow">for</span> (i = 0; i &lt; ri.num_headers; i++) {</div>
<div class="line"><span class="lineno">11854</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;CGI header: %s: %s&quot;</span>,</div>
<div class="line"><span class="lineno">11855</span>                    ri.http_headers[i].name,</div>
<div class="line"><span class="lineno">11856</span>                    ri.http_headers[i].value);</div>
<div class="line"><span class="lineno">11857</span>        <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">11858</span>                  <span class="stringliteral">&quot;%s: %s\r\n&quot;</span>,</div>
<div class="line"><span class="lineno">11859</span>                  ri.http_headers[i].name,</div>
<div class="line"><span class="lineno">11860</span>                  ri.http_headers[i].value);</div>
<div class="line"><span class="lineno">11861</span>    }</div>
<div class="line"><span class="lineno">11862</span>    <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, <span class="stringliteral">&quot;\r\n&quot;</span>, 2);</div>
<div class="line"><span class="lineno">11863</span> </div>
<div class="line"><span class="lineno">11864</span>    <span class="comment">/* Send chunk of data that may have been read after the headers */</span></div>
<div class="line"><span class="lineno">11865</span>    <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, buf + headers_len, (<span class="keywordtype">size_t</span>)(data_len - headers_len));</div>
<div class="line"><span class="lineno">11866</span> </div>
<div class="line"><span class="lineno">11867</span>    <span class="comment">/* Read the rest of CGI output and send to the client */</span></div>
<div class="line"><span class="lineno">11868</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;CGI: %s&quot;</span>, <span class="stringliteral">&quot;forward all data&quot;</span>);</div>
<div class="line"><span class="lineno">11869</span>    <a class="code hl_function" href="#a528545b68103ca8848caaea2c5316ec2">send_file_data</a>(conn, &amp;fout, 0, <a class="code hl_define" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a>, no_buffering); <span class="comment">/* send CGI data */</span></div>
<div class="line"><span class="lineno">11870</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;CGI: %s&quot;</span>, <span class="stringliteral">&quot;all data sent&quot;</span>);</div>
<div class="line"><span class="lineno">11871</span> </div>
<div class="line"><span class="lineno">11872</span>done:</div>
<div class="line"><span class="lineno">11873</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(blk.var);</div>
<div class="line"><span class="lineno">11874</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(blk.buf);</div>
<div class="line"><span class="lineno">11875</span> </div>
<div class="line"><span class="lineno">11876</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structprocess__control__data.html#ae0c6a0b659acce358e0c3bfb528c59c4">pid</a> != (pid_t)-1) {</div>
<div class="line"><span class="lineno">11877</span>        <a class="code hl_function" href="#a2dd9b83e27accc1b564a11b3ff531c9d">abort_cgi_process</a>((<span class="keywordtype">void</span> *)proc);</div>
<div class="line"><span class="lineno">11878</span>    }</div>
<div class="line"><span class="lineno">11879</span> </div>
<div class="line"><span class="lineno">11880</span>    <span class="keywordflow">if</span> (fdin[0] != -1) {</div>
<div class="line"><span class="lineno">11881</span>        close(fdin[0]);</div>
<div class="line"><span class="lineno">11882</span>    }</div>
<div class="line"><span class="lineno">11883</span>    <span class="keywordflow">if</span> (fdout[1] != -1) {</div>
<div class="line"><span class="lineno">11884</span>        close(fdout[1]);</div>
<div class="line"><span class="lineno">11885</span>    }</div>
<div class="line"><span class="lineno">11886</span>    <span class="keywordflow">if</span> (fderr[1] != -1) {</div>
<div class="line"><span class="lineno">11887</span>        close(fderr[1]);</div>
<div class="line"><span class="lineno">11888</span>    }</div>
<div class="line"><span class="lineno">11889</span> </div>
<div class="line"><span class="lineno">11890</span>    <span class="keywordflow">if</span> (in != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11891</span>        fclose(in);</div>
<div class="line"><span class="lineno">11892</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fdin[1] != -1) {</div>
<div class="line"><span class="lineno">11893</span>        close(fdin[1]);</div>
<div class="line"><span class="lineno">11894</span>    }</div>
<div class="line"><span class="lineno">11895</span> </div>
<div class="line"><span class="lineno">11896</span>    <span class="keywordflow">if</span> (out != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11897</span>        fclose(out);</div>
<div class="line"><span class="lineno">11898</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fdout[0] != -1) {</div>
<div class="line"><span class="lineno">11899</span>        close(fdout[0]);</div>
<div class="line"><span class="lineno">11900</span>    }</div>
<div class="line"><span class="lineno">11901</span> </div>
<div class="line"><span class="lineno">11902</span>    <span class="keywordflow">if</span> (err != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11903</span>        fclose(err);</div>
<div class="line"><span class="lineno">11904</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fderr[0] != -1) {</div>
<div class="line"><span class="lineno">11905</span>        close(fderr[0]);</div>
<div class="line"><span class="lineno">11906</span>    }</div>
<div class="line"><span class="lineno">11907</span> </div>
<div class="line"><span class="lineno">11908</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(buf);</div>
<div class="line"><span class="lineno">11909</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a10cbc96e5456363bea1672bfc3f526dd"><div class="ttname"><a href="#a10cbc96e5456363bea1672bfc3f526dd">spawn_process</a></div><div class="ttdeci">static pid_t spawn_process(struct mg_connection *conn, const char *prog, char *envblk, char *envp[], int fdin[2], int fdout[2], int fderr[2], const char *dir, int cgi_config_idx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l05768">civetweb.c:5768</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a2dd9b83e27accc1b564a11b3ff531c9d"><div class="ttname"><a href="#a2dd9b83e27accc1b564a11b3ff531c9d">abort_cgi_process</a></div><div class="ttdeci">static int abort_cgi_process(void *data)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11552">civetweb.c:11552</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a2f83db0ca198c57993fb3e3cd5e97500"><div class="ttname"><a href="#a2f83db0ca198c57993fb3e3cd5e97500">should_keep_alive</a></div><div class="ttdeci">static int should_keep_alive(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03984">civetweb.c:3984</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a461ef0a8b46dd9223774d62a6f290186"><div class="ttname"><a href="#a461ef0a8b46dd9223774d62a6f290186">parse_http_headers</a></div><div class="ttdeci">static int parse_http_headers(char **buf, struct mg_header hdr[MG_MAX_HEADERS])</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10725">civetweb.c:10725</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a6b0ac164cc67271e3819e1d6c967ef95"><div class="ttname"><a href="#a6b0ac164cc67271e3819e1d6c967ef95">forward_body_data</a></div><div class="ttdeci">static int forward_body_data(struct mg_connection *conn, FILE *fp, SOCKET sock, SSL *ssl)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11184">civetweb.c:11184</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a6e7dd65d54025f881bb4d95986fc2581"><div class="ttname"><a href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a></div><div class="ttdeci">CIVETWEB_API int mg_write(struct mg_connection *conn, const void *buf, size_t len)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06779">civetweb.c:6779</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a807c2737d59afedd4cc79747f416ea42"><div class="ttname"><a href="#a807c2737d59afedd4cc79747f416ea42">pull_all</a></div><div class="ttdeci">static int pull_all(FILE *fp, struct mg_connection *conn, char *buf, int len)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06439">civetweb.c:6439</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aa983f82b2ad0172f78ed1e9f6ba572f7"><div class="ttname"><a href="#aa983f82b2ad0172f78ed1e9f6ba572f7">prepare_cgi_environment</a></div><div class="ttdeci">static int prepare_cgi_environment(struct mg_connection *conn, const char *prog, struct cgi_environment *env, int cgi_config_idx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11354">civetweb.c:11354</a></div></div>
<div class="ttc" id="astructcgi__environment_html"><div class="ttname"><a href="structcgi__environment.html">cgi_environment</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11264">civetweb.c:11264</a></div></div>
<div class="ttc" id="astructmg__context_html_af17486f182c09fa18f04d21212d6d381"><div class="ttname"><a href="structmg__context.html#af17486f182c09fa18f04d21212d6d381">mg_context::max_request_size</a></div><div class="ttdeci">unsigned int max_request_size</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02401">civetweb.c:2401</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l11552">abort_cgi_process()</a>, <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l11267">cgi_environment::buf</a>, <a class="el" href="civetweb_8c_source.html#l01966">CGI_BUFFERING</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8c_source.html#l02518">mg_connection::content_len</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l11184">forward_body_data()</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, <a class="el" href="civetweb_8c_source.html#l03820">get_header()</a>, <a class="el" href="civetweb_8h_source.html#l00179">mg_request_info::http_headers</a>, <a class="el" href="civetweb_8c_source.html#l00926">INT64_FMT</a>, <a class="el" href="civetweb_8c_source.html#l00513">INT64_MAX</a>, <a class="el" href="civetweb_8c_source.html#l00925">INVALID_SOCKET</a>, <a class="el" href="civetweb_8c_source.html#l02525">mg_connection::is_chunked</a>, <a class="el" href="civetweb_8c_source.html#l02401">mg_context::max_request_size</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01497">mg_malloc_ctx</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l06779">mg_write()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="civetweb_8h_source.html#l00144">mg_header::name</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00178">mg_request_info::num_headers</a>, <a class="el" href="civetweb_8c_source.html#l10725">parse_http_headers()</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l11547">process_control_data::pid</a>, <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>, <a class="el" href="civetweb_8c_source.html#l06439">pull_all()</a>, <a class="el" href="civetweb_8c_source.html#l11107">read_message()</a>, <a class="el" href="civetweb_8c_source.html#l11548">process_control_data::references</a>, <a class="el" href="civetweb_8c_source.html#l01937">REQUEST_TIMEOUT</a>, <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>, <a class="el" href="civetweb_8c_source.html#l03984">should_keep_alive()</a>, <a class="el" href="civetweb_8c_source.html#l05768">spawn_process()</a>, <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>, <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>, <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>, <a class="el" href="civetweb_8h_source.html#l00145">mg_header::value</a>, and <a class="el" href="civetweb_8c_source.html#l11271">cgi_environment::var</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l15354">handle_file_based_request()</a>.</p>

</div>
</div>
<a id="a7b85ac81c14209bfd8102abe7af190f7" name="a7b85ac81c14209bfd8102abe7af190f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b85ac81c14209bfd8102abe7af190f7">&#9670;&#160;</a></span>handle_directory_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_directory_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>dir</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09942">9942</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9943</span>{</div>
<div class="line"><span class="lineno"> 9944</span>    <span class="keywordtype">size_t</span> i;</div>
<div class="line"><span class="lineno"> 9945</span>    <span class="keywordtype">int</span> sort_direction;</div>
<div class="line"><span class="lineno"> 9946</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structdir__scan__data.html">dir_scan_data</a> data = {<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 128};</div>
<div class="line"><span class="lineno"> 9947</span>    <span class="keywordtype">char</span> date[64], *esc, *p;</div>
<div class="line"><span class="lineno"> 9948</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *title;</div>
<div class="line"><span class="lineno"> 9949</span>    time_t curtime = time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 9950</span> </div>
<div class="line"><span class="lineno"> 9951</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno"> 9952</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 9953</span>    }</div>
<div class="line"><span class="lineno"> 9954</span> </div>
<div class="line"><span class="lineno"> 9955</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#afa346108a8a9cc93af26ca8beee784cd">scan_directory</a>(conn, dir, &amp;data, <a class="code hl_function" href="#ae7110e9ded01191e313122aafa2b1040">dir_scan_callback</a>)) {</div>
<div class="line"><span class="lineno"> 9956</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno"> 9957</span>                           500,</div>
<div class="line"><span class="lineno"> 9958</span>                           <span class="stringliteral">&quot;Error: Cannot open directory\nopendir(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9959</span>                           dir,</div>
<div class="line"><span class="lineno"> 9960</span>                           strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 9961</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 9962</span>    }</div>
<div class="line"><span class="lineno"> 9963</span> </div>
<div class="line"><span class="lineno"> 9964</span>    <a class="code hl_function" href="#a7ef6ebce89c81f7218a0968e3aa9107f">gmt_time_string</a>(date, <span class="keyword">sizeof</span>(date), &amp;curtime);</div>
<div class="line"><span class="lineno"> 9965</span> </div>
<div class="line"><span class="lineno"> 9966</span>    esc = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 9967</span>    title = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>;</div>
<div class="line"><span class="lineno"> 9968</span>    <span class="keywordflow">if</span> (title[strcspn(title, <span class="stringliteral">&quot;&amp;&lt;&gt;&quot;</span>)]) {</div>
<div class="line"><span class="lineno"> 9969</span>        <span class="comment">/* HTML escaping needed */</span></div>
<div class="line"><span class="lineno"> 9970</span>        esc = (<span class="keywordtype">char</span> *)<a class="code hl_function" href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a>(strlen(title) * 5 + 1);</div>
<div class="line"><span class="lineno"> 9971</span>        <span class="keywordflow">if</span> (esc) {</div>
<div class="line"><span class="lineno"> 9972</span>            <span class="keywordflow">for</span> (i = 0, p = esc; title[i]; i++, p += strlen(p)) {</div>
<div class="line"><span class="lineno"> 9973</span>                <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(p, title + i, 2);</div>
<div class="line"><span class="lineno"> 9974</span>                <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;&amp;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 9975</span>                    strcpy(p, <span class="stringliteral">&quot;&amp;amp;&quot;</span>);</div>
<div class="line"><span class="lineno"> 9976</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;&lt;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 9977</span>                    strcpy(p, <span class="stringliteral">&quot;&amp;lt;&quot;</span>);</div>
<div class="line"><span class="lineno"> 9978</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;&gt;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 9979</span>                    strcpy(p, <span class="stringliteral">&quot;&amp;gt;&quot;</span>);</div>
<div class="line"><span class="lineno"> 9980</span>                }</div>
<div class="line"><span class="lineno"> 9981</span>            }</div>
<div class="line"><span class="lineno"> 9982</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 9983</span>            title = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno"> 9984</span>        }</div>
<div class="line"><span class="lineno"> 9985</span>    }</div>
<div class="line"><span class="lineno"> 9986</span> </div>
<div class="line"><span class="lineno"> 9987</span>    sort_direction = ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno"> 9988</span>                      &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>[0] != <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><span class="lineno"> 9989</span>                      &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>[1] == <span class="charliteral">&#39;d&#39;</span>))</div>
<div class="line"><span class="lineno"> 9990</span>                         ? <span class="charliteral">&#39;a&#39;</span></div>
<div class="line"><span class="lineno"> 9991</span>                         : <span class="charliteral">&#39;d&#39;</span>;</div>
<div class="line"><span class="lineno"> 9992</span> </div>
<div class="line"><span class="lineno"> 9993</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno"> 9994</span> </div>
<div class="line"><span class="lineno"> 9995</span>    <span class="comment">/* Create 200 OK response */</span></div>
<div class="line"><span class="lineno"> 9996</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 200);</div>
<div class="line"><span class="lineno"> 9997</span>    <a class="code hl_function" href="#a229f03c60c42b8f390449a8e1324f22f">send_static_cache_header</a>(conn);</div>
<div class="line"><span class="lineno"> 9998</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno"> 9999</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn,</div>
<div class="line"><span class="lineno">10000</span>                           <span class="stringliteral">&quot;Content-Type&quot;</span>,</div>
<div class="line"><span class="lineno">10001</span>                           <span class="stringliteral">&quot;text/html; charset=utf-8&quot;</span>,</div>
<div class="line"><span class="lineno">10002</span>                           -1);</div>
<div class="line"><span class="lineno">10003</span> </div>
<div class="line"><span class="lineno">10004</span>    <span class="comment">/* Send all headers */</span></div>
<div class="line"><span class="lineno">10005</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">10006</span> </div>
<div class="line"><span class="lineno">10007</span>    <span class="comment">/* Body */</span></div>
<div class="line"><span class="lineno">10008</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">10009</span>              <span class="stringliteral">&quot;&lt;!DOCTYPE html&gt;&quot;</span></div>
<div class="line"><span class="lineno">10010</span>              <span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Index of %s&lt;/title&gt;&quot;</span></div>
<div class="line"><span class="lineno">10011</span>              <span class="stringliteral">&quot;&lt;style&gt;th {text-align: left;}&lt;/style&gt;&lt;/head&gt;&quot;</span></div>
<div class="line"><span class="lineno">10012</span>              <span class="stringliteral">&quot;&lt;body&gt;&lt;h1&gt;Index of %s&lt;/h1&gt;&lt;pre&gt;&lt;table cellpadding=\&quot;0\&quot;&gt;&quot;</span></div>
<div class="line"><span class="lineno">10013</span>              <span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;&lt;a href=\&quot;?n%c\&quot;&gt;Name&lt;/a&gt;&lt;/th&gt;&quot;</span></div>
<div class="line"><span class="lineno">10014</span>              <span class="stringliteral">&quot;&lt;th&gt;&lt;a href=\&quot;?d%c\&quot;&gt;Modified&lt;/a&gt;&lt;/th&gt;&quot;</span></div>
<div class="line"><span class="lineno">10015</span>              <span class="stringliteral">&quot;&lt;th&gt;&lt;a href=\&quot;?s%c\&quot;&gt;Size&lt;/a&gt;&lt;/th&gt;&lt;/tr&gt;&quot;</span></div>
<div class="line"><span class="lineno">10016</span>              <span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=\&quot;3\&quot;&gt;&lt;hr&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>,</div>
<div class="line"><span class="lineno">10017</span>              esc ? esc : title,</div>
<div class="line"><span class="lineno">10018</span>              esc ? esc : title,</div>
<div class="line"><span class="lineno">10019</span>              sort_direction,</div>
<div class="line"><span class="lineno">10020</span>              sort_direction,</div>
<div class="line"><span class="lineno">10021</span>              sort_direction);</div>
<div class="line"><span class="lineno">10022</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(esc);</div>
<div class="line"><span class="lineno">10023</span> </div>
<div class="line"><span class="lineno">10024</span>    <span class="comment">/* Print first entry - link to a parent directory */</span></div>
<div class="line"><span class="lineno">10025</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">10026</span>              <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&lt;/td&gt;&quot;</span></div>
<div class="line"><span class="lineno">10027</span>              <span class="stringliteral">&quot;&lt;td&gt;&amp;nbsp;%s&lt;/td&gt;&lt;td&gt;&amp;nbsp;&amp;nbsp;%s&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>,</div>
<div class="line"><span class="lineno">10028</span>              <span class="stringliteral">&quot;..&quot;</span>,</div>
<div class="line"><span class="lineno">10029</span>              <span class="stringliteral">&quot;Parent directory&quot;</span>,</div>
<div class="line"><span class="lineno">10030</span>              <span class="stringliteral">&quot;-&quot;</span>,</div>
<div class="line"><span class="lineno">10031</span>              <span class="stringliteral">&quot;-&quot;</span>);</div>
<div class="line"><span class="lineno">10032</span> </div>
<div class="line"><span class="lineno">10033</span>    <span class="comment">/* Sort and print directory entries */</span></div>
<div class="line"><span class="lineno">10034</span>    <span class="keywordflow">if</span> (data.<a class="code hl_variable" href="structdir__scan__data.html#a73f628586095aed39889c1af9d717622">entries</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">10035</span>        mg_sort(data.<a class="code hl_variable" href="structdir__scan__data.html#a73f628586095aed39889c1af9d717622">entries</a>,</div>
<div class="line"><span class="lineno">10036</span>                data.<a class="code hl_variable" href="structdir__scan__data.html#a46f144aee1c95408b664e24a7ca29684">num_entries</a>,</div>
<div class="line"><span class="lineno">10037</span>                <span class="keyword">sizeof</span>(data.<a class="code hl_variable" href="structdir__scan__data.html#a73f628586095aed39889c1af9d717622">entries</a>[0]),</div>
<div class="line"><span class="lineno">10038</span>                <a class="code hl_function" href="#a479f7681b73f6d36b90146e29ee63652">compare_dir_entries</a>,</div>
<div class="line"><span class="lineno">10039</span>                (<span class="keywordtype">void</span> *)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>);</div>
<div class="line"><span class="lineno">10040</span>        <span class="keywordflow">for</span> (i = 0; i &lt; data.<a class="code hl_variable" href="structdir__scan__data.html#a46f144aee1c95408b664e24a7ca29684">num_entries</a>; i++) {</div>
<div class="line"><span class="lineno">10041</span>            <a class="code hl_function" href="#a1178bc077d6f8483d04c6bc95c2a8324">print_dir_entry</a>(conn, &amp;data.<a class="code hl_variable" href="structdir__scan__data.html#a73f628586095aed39889c1af9d717622">entries</a>[i]);</div>
<div class="line"><span class="lineno">10042</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(data.<a class="code hl_variable" href="structdir__scan__data.html#a73f628586095aed39889c1af9d717622">entries</a>[i].<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a>);</div>
<div class="line"><span class="lineno">10043</span>        }</div>
<div class="line"><span class="lineno">10044</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(data.<a class="code hl_variable" href="structdir__scan__data.html#a73f628586095aed39889c1af9d717622">entries</a>);</div>
<div class="line"><span class="lineno">10045</span>    }</div>
<div class="line"><span class="lineno">10046</span> </div>
<div class="line"><span class="lineno">10047</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;&lt;/table&gt;&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>);</div>
<div class="line"><span class="lineno">10048</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 200;</div>
<div class="line"><span class="lineno">10049</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a1178bc077d6f8483d04c6bc95c2a8324"><div class="ttname"><a href="#a1178bc077d6f8483d04c6bc95c2a8324">print_dir_entry</a></div><div class="ttdeci">static int print_dir_entry(struct mg_connection *conn, struct de *de)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09609">civetweb.c:9609</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a479f7681b73f6d36b90146e29ee63652"><div class="ttname"><a href="#a479f7681b73f6d36b90146e29ee63652">compare_dir_entries</a></div><div class="ttdeci">static int compare_dir_entries(const void *p1, const void *p2, void *arg)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09716">civetweb.c:9716</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a7ef6ebce89c81f7218a0968e3aa9107f"><div class="ttname"><a href="#a7ef6ebce89c81f7218a0968e3aa9107f">gmt_time_string</a></div><div class="ttdeci">static void gmt_time_string(char *buf, size_t buf_len, time_t *t)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03341">civetweb.c:3341</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ae7110e9ded01191e313122aafa2b1040"><div class="ttname"><a href="#ae7110e9ded01191e313122aafa2b1040">dir_scan_callback</a></div><div class="ttdeci">static int dir_scan_callback(struct de *de, void *data)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09911">civetweb.c:9911</a></div></div>
<div class="ttc" id="acivetweb_8c_html_afa346108a8a9cc93af26ca8beee784cd"><div class="ttname"><a href="#afa346108a8a9cc93af26ca8beee784cd">scan_directory</a></div><div class="ttdeci">static int scan_directory(struct mg_connection *conn, const char *dir, void *data, int(*cb)(struct de *, void *))</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09777">civetweb.c:9777</a></div></div>
<div class="ttc" id="astructmg__request__info_html_a918f473c007e03c3f4ac3a35af8c22f5"><div class="ttname"><a href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">mg_request_info::query_string</a></div><div class="ttdeci">const char * query_string</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00162">civetweb.h:162</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l09716">compare_dir_entries()</a>, <a class="el" href="civetweb_8c_source.html#l09911">dir_scan_callback()</a>, <a class="el" href="civetweb_8c_source.html#l09903">dir_scan_data::entries</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l02578">de::file_name</a>, <a class="el" href="civetweb_8c_source.html#l03341">gmt_time_string()</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01474">mg_malloc()</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l09904">dir_scan_data::num_entries</a>, <a class="el" href="civetweb_8c_source.html#l09609">print_dir_entry()</a>, <a class="el" href="civetweb_8h_source.html#l00162">mg_request_info::query_string</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04074">send_static_cache_header()</a>, and <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>.</p>

</div>
</div>
<a id="a4761bad9f703f9d51380597f4b1a694c" name="a4761bad9f703f9d51380597f4b1a694c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4761bad9f703f9d51380597f4b1a694c">&#9670;&#160;</a></span>handle_file_based_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_file_based_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l15354">15354</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">15357</span>{</div>
<div class="line"><span class="lineno">15358</span><span class="preprocessor">#if !defined(NO_CGI)</span></div>
<div class="line"><span class="lineno">15359</span>    <span class="keywordtype">int</span> cgi_config_idx, inc, max;</div>
<div class="line"><span class="lineno">15360</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15361</span> </div>
<div class="line"><span class="lineno">15362</span>    <span class="keywordflow">if</span> (!conn || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno">15363</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15364</span>    }</div>
<div class="line"><span class="lineno">15365</span> </div>
<div class="line"><span class="lineno">15366</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">15367</span>    <span class="keywordflow">if</span> (match_prefix_strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[LUA_SERVER_PAGE_EXTENSIONS],</div>
<div class="line"><span class="lineno">15368</span>                            path)</div>
<div class="line"><span class="lineno">15369</span>        &gt; 0) {</div>
<div class="line"><span class="lineno">15370</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac4e67843460a2634c2ccd7f1f0343877">is_in_script_path</a>(conn, path)) {</div>
<div class="line"><span class="lineno">15371</span>            <span class="comment">/* Lua server page: an SSI like page containing mostly plain</span></div>
<div class="line"><span class="lineno">15372</span><span class="comment">             * html code plus some tags with server generated contents. */</span></div>
<div class="line"><span class="lineno">15373</span>            handle_lsp_request(conn, path, file, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">15374</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15375</span>            <span class="comment">/* Script was in an illegal path */</span></div>
<div class="line"><span class="lineno">15376</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 403, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Forbidden&quot;</span>);</div>
<div class="line"><span class="lineno">15377</span>        }</div>
<div class="line"><span class="lineno">15378</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15379</span>    }</div>
<div class="line"><span class="lineno">15380</span> </div>
<div class="line"><span class="lineno">15381</span>    <span class="keywordflow">if</span> (match_prefix_strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[LUA_SCRIPT_EXTENSIONS], path)</div>
<div class="line"><span class="lineno">15382</span>        &gt; 0) {</div>
<div class="line"><span class="lineno">15383</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac4e67843460a2634c2ccd7f1f0343877">is_in_script_path</a>(conn, path)) {</div>
<div class="line"><span class="lineno">15384</span>            <span class="comment">/* Lua in-server module script: a CGI like script used to</span></div>
<div class="line"><span class="lineno">15385</span><span class="comment">             * generate the entire reply. */</span></div>
<div class="line"><span class="lineno">15386</span>            mg_exec_lua_script(conn, path, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">15387</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15388</span>            <span class="comment">/* Script was in an illegal path */</span></div>
<div class="line"><span class="lineno">15389</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 403, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Forbidden&quot;</span>);</div>
<div class="line"><span class="lineno">15390</span>        }</div>
<div class="line"><span class="lineno">15391</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15392</span>    }</div>
<div class="line"><span class="lineno">15393</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15394</span> </div>
<div class="line"><span class="lineno">15395</span><span class="preprocessor">#if defined(USE_DUKTAPE)</span></div>
<div class="line"><span class="lineno">15396</span>    <span class="keywordflow">if</span> (match_prefix_strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[DUKTAPE_SCRIPT_EXTENSIONS],</div>
<div class="line"><span class="lineno">15397</span>                            path)</div>
<div class="line"><span class="lineno">15398</span>        &gt; 0) {</div>
<div class="line"><span class="lineno">15399</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac4e67843460a2634c2ccd7f1f0343877">is_in_script_path</a>(conn, path)) {</div>
<div class="line"><span class="lineno">15400</span>            <span class="comment">/* Call duktape to generate the page */</span></div>
<div class="line"><span class="lineno">15401</span>            mg_exec_duktape_script(conn, path);</div>
<div class="line"><span class="lineno">15402</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15403</span>            <span class="comment">/* Script was in an illegal path */</span></div>
<div class="line"><span class="lineno">15404</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 403, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Forbidden&quot;</span>);</div>
<div class="line"><span class="lineno">15405</span>        }</div>
<div class="line"><span class="lineno">15406</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15407</span>    }</div>
<div class="line"><span class="lineno">15408</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15409</span> </div>
<div class="line"><span class="lineno">15410</span><span class="preprocessor">#if !defined(NO_CGI)</span></div>
<div class="line"><span class="lineno">15411</span>    inc = <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba5d225462bc3b0836805df00f580cb7ea">CGI2_EXTENSIONS</a> - <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a>;</div>
<div class="line"><span class="lineno">15412</span>    max = <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba9f0c9561bdb0b2b975178617c8d3c59a">PUT_DELETE_PASSWORDS_FILE</a> - <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a>;</div>
<div class="line"><span class="lineno">15413</span>    <span class="keywordflow">for</span> (cgi_config_idx = 0; cgi_config_idx &lt; max; cgi_config_idx += inc) {</div>
<div class="line"><span class="lineno">15414</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a> + cgi_config_idx] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">15415</span>            <span class="keywordflow">if</span> (match_prefix_strlen(</div>
<div class="line"><span class="lineno">15416</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba7b453985c10cb65bf6e019820c06a6fa">CGI_EXTENSIONS</a> + cgi_config_idx],</div>
<div class="line"><span class="lineno">15417</span>                    path)</div>
<div class="line"><span class="lineno">15418</span>                &gt; 0) {</div>
<div class="line"><span class="lineno">15419</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac4e67843460a2634c2ccd7f1f0343877">is_in_script_path</a>(conn, path)) {</div>
<div class="line"><span class="lineno">15420</span>                    <span class="comment">/* CGI scripts may support all HTTP methods */</span></div>
<div class="line"><span class="lineno">15421</span>                    <a class="code hl_function" href="#af04594d5550fa7ce1f249ff3eed4c7d9">handle_cgi_request</a>(conn, path, cgi_config_idx);</div>
<div class="line"><span class="lineno">15422</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15423</span>                    <span class="comment">/* Script was in an illegal path */</span></div>
<div class="line"><span class="lineno">15424</span>                    <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 403, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Forbidden&quot;</span>);</div>
<div class="line"><span class="lineno">15425</span>                }</div>
<div class="line"><span class="lineno">15426</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15427</span>            }</div>
<div class="line"><span class="lineno">15428</span>        }</div>
<div class="line"><span class="lineno">15429</span>    }</div>
<div class="line"><span class="lineno">15430</span><span class="preprocessor">#endif </span><span class="comment">/* !NO_CGI */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">15431</span> </div>
<div class="line"><span class="lineno">15432</span>    <span class="keywordflow">if</span> (match_prefix_strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad759d92bd3b0e4870bb7d92ad10399b4">SSI_EXTENSIONS</a>], path) &gt; 0) {</div>
<div class="line"><span class="lineno">15433</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac4e67843460a2634c2ccd7f1f0343877">is_in_script_path</a>(conn, path)) {</div>
<div class="line"><span class="lineno">15434</span>            <a class="code hl_function" href="#a81cf575b8d68d30c6e590015d8fe99ea">handle_ssi_file_request</a>(conn, path, file);</div>
<div class="line"><span class="lineno">15435</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15436</span>            <span class="comment">/* Script was in an illegal path */</span></div>
<div class="line"><span class="lineno">15437</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 403, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Forbidden&quot;</span>);</div>
<div class="line"><span class="lineno">15438</span>        }</div>
<div class="line"><span class="lineno">15439</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15440</span>    }</div>
<div class="line"><span class="lineno">15441</span> </div>
<div class="line"><span class="lineno">15442</span><span class="preprocessor">#if !defined(NO_CACHING)</span></div>
<div class="line"><span class="lineno">15443</span>    <span class="keywordflow">if</span> ((!conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac5ff30ba1c73afd0f9932c4dac17ea5a">in_error_handler</a>) &amp;&amp; <a class="code hl_function" href="#aa81530fc67a88c3191c00c52ec06065b">is_not_modified</a>(conn, &amp;file-&gt;stat)) {</div>
<div class="line"><span class="lineno">15444</span>        <span class="comment">/* Send 304 &quot;Not Modified&quot; - this must not send any body data */</span></div>
<div class="line"><span class="lineno">15445</span>        <a class="code hl_function" href="#ae261fe366cffadac8da5a02c285b9653">handle_not_modified_static_file_request</a>(conn, file);</div>
<div class="line"><span class="lineno">15446</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15447</span>    }</div>
<div class="line"><span class="lineno">15448</span><span class="preprocessor">#endif </span><span class="comment">/* !NO_CACHING */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">15449</span> </div>
<div class="line"><span class="lineno">15450</span>    <a class="code hl_function" href="#a35e5540a0d567e223008b77b2bacb2d5">handle_static_file_request</a>(conn, path, file, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">15451</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a35e5540a0d567e223008b77b2bacb2d5"><div class="ttname"><a href="#a35e5540a0d567e223008b77b2bacb2d5">handle_static_file_request</a></div><div class="ttdeci">static void handle_static_file_request(struct mg_connection *conn, const char *path, struct mg_file *filep, const char *mime_type, const char *additional_headers)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10220">civetweb.c:10220</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a81cf575b8d68d30c6e590015d8fe99ea"><div class="ttname"><a href="#a81cf575b8d68d30c6e590015d8fe99ea">handle_ssi_file_request</a></div><div class="ttdeci">static void handle_ssi_file_request(struct mg_connection *conn, const char *path, struct mg_file *filep)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12588">civetweb.c:12588</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aa81530fc67a88c3191c00c52ec06065b"><div class="ttname"><a href="#aa81530fc67a88c3191c00c52ec06065b">is_not_modified</a></div><div class="ttdeci">static int is_not_modified(const struct mg_connection *conn, const struct mg_file_stat *filestat)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10468">civetweb.c:10468</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac4e67843460a2634c2ccd7f1f0343877"><div class="ttname"><a href="#ac4e67843460a2634c2ccd7f1f0343877">is_in_script_path</a></div><div class="ttdeci">static int is_in_script_path(const struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14645">civetweb.c:14645</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ae261fe366cffadac8da5a02c285b9653"><div class="ttname"><a href="#ae261fe366cffadac8da5a02c285b9653">handle_not_modified_static_file_request</a></div><div class="ttdeci">static void handle_not_modified_static_file_request(struct mg_connection *conn, struct mg_file *filep)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10483">civetweb.c:10483</a></div></div>
<div class="ttc" id="acivetweb_8c_html_af04594d5550fa7ce1f249ff3eed4c7d9"><div class="ttname"><a href="#af04594d5550fa7ce1f249ff3eed4c7d9">handle_cgi_request</a></div><div class="ttdeci">static void handle_cgi_request(struct mg_connection *conn, const char *prog, int cgi_config_idx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11587">civetweb.c:11587</a></div></div>
<div class="ttc" id="astructmg__connection_html_ac5ff30ba1c73afd0f9932c4dac17ea5a"><div class="ttname"><a href="structmg__connection.html#ac5ff30ba1c73afd0f9932c4dac17ea5a">mg_connection::in_error_handler</a></div><div class="ttdeci">int in_error_handler</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02537">civetweb.c:2537</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01968">CGI2_EXTENSIONS</a>, <a class="el" href="civetweb_8c_source.html#l01959">CGI_EXTENSIONS</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l10483">handle_not_modified_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l02537">mg_connection::in_error_handler</a>, <a class="el" href="civetweb_8c_source.html#l14645">is_in_script_path()</a>, <a class="el" href="civetweb_8c_source.html#l10468">is_not_modified()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01997">PUT_DELETE_PASSWORDS_FILE</a>, <a class="el" href="civetweb_8c_source.html#l02001">SSI_EXTENSIONS</a>, and <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>.</p>

</div>
</div>
<a id="ae261fe366cffadac8da5a02c285b9653" name="ae261fe366cffadac8da5a02c285b9653"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae261fe366cffadac8da5a02c285b9653">&#9670;&#160;</a></span>handle_not_modified_static_file_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_not_modified_static_file_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10483">10483</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10485</span>{</div>
<div class="line"><span class="lineno">10486</span>    <span class="keywordtype">char</span> lm[64], etag[64];</div>
<div class="line"><span class="lineno">10487</span> </div>
<div class="line"><span class="lineno">10488</span>    <span class="keywordflow">if</span> ((conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (filep == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">10489</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">10490</span>    }</div>
<div class="line"><span class="lineno">10491</span> </div>
<div class="line"><span class="lineno">10492</span>    <a class="code hl_function" href="#a7ef6ebce89c81f7218a0968e3aa9107f">gmt_time_string</a>(lm, <span class="keyword">sizeof</span>(lm), &amp;filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#aa767e15073ca34ce0bd9fdcfe05e6ddc">last_modified</a>);</div>
<div class="line"><span class="lineno">10493</span>    <a class="code hl_function" href="#ac715f770ccb10deba796a43cb10cfd46">construct_etag</a>(etag, <span class="keyword">sizeof</span>(etag), &amp;filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>);</div>
<div class="line"><span class="lineno">10494</span> </div>
<div class="line"><span class="lineno">10495</span>    <span class="comment">/* Create 304 &quot;not modified&quot; response */</span></div>
<div class="line"><span class="lineno">10496</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 304);</div>
<div class="line"><span class="lineno">10497</span>    <a class="code hl_function" href="#a229f03c60c42b8f390449a8e1324f22f">send_static_cache_header</a>(conn);</div>
<div class="line"><span class="lineno">10498</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">10499</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Last-Modified&quot;</span>, lm, -1);</div>
<div class="line"><span class="lineno">10500</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Etag&quot;</span>, etag, -1);</div>
<div class="line"><span class="lineno">10501</span> </div>
<div class="line"><span class="lineno">10502</span>    <span class="comment">/* Send all headers */</span></div>
<div class="line"><span class="lineno">10503</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">10504</span>}</div>
<div class="ttc" id="acivetweb_8c_html_ac715f770ccb10deba796a43cb10cfd46"><div class="ttname"><a href="#ac715f770ccb10deba796a43cb10cfd46">construct_etag</a></div><div class="ttdeci">static void construct_etag(char *buf, size_t buf_len, const struct mg_file_stat *filestat)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10181">civetweb.c:10181</a></div></div>
<div class="ttc" id="astructmg__file_html_a3879afe201c7dfb12c2d3fe73c7c66c7"><div class="ttname"><a href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">mg_file::stat</a></div><div class="ttdeci">struct mg_file_stat stat</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01886">civetweb.c:1886</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l10181">construct_etag()</a>, <a class="el" href="civetweb_8c_source.html#l03341">gmt_time_string()</a>, <a class="el" href="civetweb_8c_source.html#l01872">mg_file_stat::last_modified</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04074">send_static_cache_header()</a>, and <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l15354">handle_file_based_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>.</p>

</div>
</div>
<a id="ab1110e733e9c841ff0a605fada90b638" name="ab1110e733e9c841ff0a605fada90b638"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1110e733e9c841ff0a605fada90b638">&#9670;&#160;</a></span>handle_propfind()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_propfind </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12759">12759</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12762</span>{</div>
<div class="line"><span class="lineno">12763</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="deprecated_2gthread_8h.html#a2b31ea2bc2a86a6f81186b13309f0f45">depth</a> = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Depth&quot;</span>);</div>
<div class="line"><span class="lineno">12764</span> </div>
<div class="line"><span class="lineno">12765</span>    <span class="keywordflow">if</span> (!conn || !path || !filep || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno">12766</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12767</span>    }</div>
<div class="line"><span class="lineno">12768</span> </div>
<div class="line"><span class="lineno">12769</span>    <span class="comment">/* return 207 &quot;Multi-Status&quot; */</span></div>
<div class="line"><span class="lineno">12770</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">12771</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 207);</div>
<div class="line"><span class="lineno">12772</span>    <a class="code hl_function" href="#a229f03c60c42b8f390449a8e1324f22f">send_static_cache_header</a>(conn);</div>
<div class="line"><span class="lineno">12773</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">12774</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn,</div>
<div class="line"><span class="lineno">12775</span>                           <span class="stringliteral">&quot;Content-Type&quot;</span>,</div>
<div class="line"><span class="lineno">12776</span>                           <span class="stringliteral">&quot;application/xml; charset=utf-8&quot;</span>,</div>
<div class="line"><span class="lineno">12777</span>                           -1);</div>
<div class="line"><span class="lineno">12778</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">12779</span> </div>
<div class="line"><span class="lineno">12780</span>    <span class="comment">/* Content */</span></div>
<div class="line"><span class="lineno">12781</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">12782</span>              <span class="stringliteral">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;&quot;</span></div>
<div class="line"><span class="lineno">12783</span>              <span class="stringliteral">&quot;&lt;d:multistatus xmlns:d=&#39;DAV:&#39;&gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">12784</span> </div>
<div class="line"><span class="lineno">12785</span>    <span class="comment">/* Print properties for the requested resource itself */</span></div>
<div class="line"><span class="lineno">12786</span>    <a class="code hl_function" href="#ae5738d5648ed8e16019ec1c4f9976cc3">print_props</a>(conn, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>, <span class="stringliteral">&quot;&quot;</span>, filep);</div>
<div class="line"><span class="lineno">12787</span> </div>
<div class="line"><span class="lineno">12788</span>    <span class="comment">/* If it is a directory, print directory entries too if Depth is not 0</span></div>
<div class="line"><span class="lineno">12789</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">12790</span>    <span class="keywordflow">if</span> (filep-&gt;<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a></div>
<div class="line"><span class="lineno">12791</span>        &amp;&amp; !<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba00459f3ca65ce96fa33c3d5230624328">ENABLE_DIRECTORY_LISTING</a>],</div>
<div class="line"><span class="lineno">12792</span>                          <span class="stringliteral">&quot;yes&quot;</span>)</div>
<div class="line"><span class="lineno">12793</span>        &amp;&amp; ((<a class="code hl_variable" href="deprecated_2gthread_8h.html#a2b31ea2bc2a86a6f81186b13309f0f45">depth</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (strcmp(<a class="code hl_variable" href="deprecated_2gthread_8h.html#a2b31ea2bc2a86a6f81186b13309f0f45">depth</a>, <span class="stringliteral">&quot;0&quot;</span>) != 0))) {</div>
<div class="line"><span class="lineno">12794</span>        <a class="code hl_function" href="#afa346108a8a9cc93af26ca8beee784cd">scan_directory</a>(conn, path, conn, &amp;<a class="code hl_function" href="#a28aaebcd6e88f488e282f4f594119f8e">print_dav_dir_entry</a>);</div>
<div class="line"><span class="lineno">12795</span>    }</div>
<div class="line"><span class="lineno">12796</span> </div>
<div class="line"><span class="lineno">12797</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn, <span class="stringliteral">&quot;%s\n&quot;</span>, <span class="stringliteral">&quot;&lt;/d:multistatus&gt;&quot;</span>);</div>
<div class="line"><span class="lineno">12798</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a28aaebcd6e88f488e282f4f594119f8e"><div class="ttname"><a href="#a28aaebcd6e88f488e282f4f594119f8e">print_dav_dir_entry</a></div><div class="ttdeci">static int print_dav_dir_entry(struct de *de, void *data)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12745">civetweb.c:12745</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ae5738d5648ed8e16019ec1c4f9976cc3"><div class="ttname"><a href="#ae5738d5648ed8e16019ec1c4f9976cc3">print_props</a></div><div class="ttdeci">static int print_props(struct mg_connection *conn, const char *uri, const char *name, struct mg_file_stat *filep)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12660">civetweb.c:12660</a></div></div>
<div class="ttc" id="adeprecated_2gthread_8h_html_a2b31ea2bc2a86a6f81186b13309f0f45"><div class="ttname"><a href="deprecated_2gthread_8h.html#a2b31ea2bc2a86a6f81186b13309f0f45">depth</a></div><div class="ttdeci">guint depth</div><div class="ttdef"><b>Definition</b> <a href="deprecated_2gthread_8h_source.html#l00002">deprecated/gthread.h:2</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="deprecated_2gthread_8h_source.html#l00002">depth</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02002">ENABLE_DIRECTORY_LISTING</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l12745">print_dav_dir_entry()</a>, <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, and <a class="el" href="civetweb_8c_source.html#l04074">send_static_cache_header()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="ad59c266c5a9c359d128e8151c602ef31" name="ad59c266c5a9c359d128e8151c602ef31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad59c266c5a9c359d128e8151c602ef31">&#9670;&#160;</a></span>handle_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14704">14704</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14705</span>{</div>
<div class="line"><span class="lineno">14706</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__request__info.html">mg_request_info</a> *ri = &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>;</div>
<div class="line"><span class="lineno">14707</span>    <span class="keywordtype">char</span> path[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>];</div>
<div class="line"><span class="lineno">14708</span>    <span class="keywordtype">int</span> uri_len, ssl_index;</div>
<div class="line"><span class="lineno">14709</span>    <span class="keywordtype">int</span> is_found = 0, is_script_resource = 0, is_websocket_request = 0,</div>
<div class="line"><span class="lineno">14710</span>        is_put_or_delete_request = 0, is_callback_resource = 0,</div>
<div class="line"><span class="lineno">14711</span>        is_template_text_file = 0, is_webdav_request = 0;</div>
<div class="line"><span class="lineno">14712</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">14713</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">14714</span>    <a class="code hl_typedef" href="civetweb_8h.html#ac452a63f6ff0d7fd18a143de72a7fd08">mg_request_handler</a> callback_handler = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14715</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__handler__info.html">mg_handler_info</a> *handler_info = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14716</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__websocket__subprotocols.html">mg_websocket_subprotocols</a> *<a class="code hl_variable" href="structmg__websocket__subprotocols.html#a0eacbb0bf0e500dd7a16845e2c35701f">subprotocols</a>;</div>
<div class="line"><span class="lineno">14717</span>    <a class="code hl_typedef" href="civetweb_8h.html#ae1e201a8ea4f6895a8cc4e2e2c58da03">mg_websocket_connect_handler</a> ws_connect_handler = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14718</span>    <a class="code hl_typedef" href="civetweb_8h.html#a5b940f052d5de72f651a9a1e810bed0f">mg_websocket_ready_handler</a> ws_ready_handler = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14719</span>    <a class="code hl_typedef" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a> ws_data_handler = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14720</span>    <a class="code hl_typedef" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a> ws_close_handler = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14721</span>    <span class="keywordtype">void</span> *callback_data = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14722</span>    <a class="code hl_typedef" href="civetweb_8h.html#a3e8733a4d6d7ae85f0daec45df36f024">mg_authorization_handler</a> auth_handler = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14723</span>    <span class="keywordtype">void</span> *auth_callback_data = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14724</span>    <span class="keywordtype">int</span> handler_type;</div>
<div class="line"><span class="lineno">14725</span>    time_t curtime = time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14726</span>    <span class="keywordtype">char</span> date[64];</div>
<div class="line"><span class="lineno">14727</span>    <span class="keywordtype">char</span> *tmp;</div>
<div class="line"><span class="lineno">14728</span> </div>
<div class="line"><span class="lineno">14729</span>    path[0] = 0;</div>
<div class="line"><span class="lineno">14730</span> </div>
<div class="line"><span class="lineno">14731</span>    <span class="comment">/* 0. Reset internal state (required for HTTP/2 proxy) */</span></div>
<div class="line"><span class="lineno">14732</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a161c1c775b5f3933f8428d4eb1381f52">request_state</a> = 0;</div>
<div class="line"><span class="lineno">14733</span> </div>
<div class="line"><span class="lineno">14734</span>    <span class="comment">/* 1. get the request url */</span></div>
<div class="line"><span class="lineno">14735</span>    <span class="comment">/* 1.1. split into url and query string */</span></div>
<div class="line"><span class="lineno">14736</span>    <span class="keywordflow">if</span> ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a> = strchr(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a>, <span class="charliteral">&#39;?&#39;</span>))</div>
<div class="line"><span class="lineno">14737</span>        != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14738</span>        *((<span class="keywordtype">char</span> *)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>++) = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">14739</span>    }</div>
<div class="line"><span class="lineno">14740</span> </div>
<div class="line"><span class="lineno">14741</span>    <span class="comment">/* 1.2. do a https redirect, if required. Do not decode URIs yet. */</span></div>
<div class="line"><span class="lineno">14742</span>    <span class="keywordflow">if</span> (!conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#a2d1d5b8ef7da25d5e7e666e023a9b733">is_ssl</a> &amp;&amp; conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ab6adc40d94d436862c00b586f1455f5c">ssl_redir</a>) {</div>
<div class="line"><span class="lineno">14743</span>        ssl_index = <a class="code hl_function" href="#a73891c07a6e6af73b5b247b460c62bb3">get_first_ssl_listener_index</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">14744</span>        <span class="keywordflow">if</span> (ssl_index &gt;= 0) {</div>
<div class="line"><span class="lineno">14745</span>            <span class="keywordtype">int</span> port = (int)ntohs(<a class="code hl_define" href="#a58f28d0739c8e6a66ffce338daef408c">USA_IN_PORT_UNSAFE</a>(</div>
<div class="line"><span class="lineno">14746</span>                &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[ssl_index].<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>)));</div>
<div class="line"><span class="lineno">14747</span>            <a class="code hl_function" href="#a0a99e300d992194966483f9d6e77f214">redirect_to_https_port</a>(conn, port);</div>
<div class="line"><span class="lineno">14748</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14749</span>            <span class="comment">/* A http to https forward port has been specified,</span></div>
<div class="line"><span class="lineno">14750</span><span class="comment">             * but no https port to forward to. */</span></div>
<div class="line"><span class="lineno">14751</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">14752</span>                               503,</div>
<div class="line"><span class="lineno">14753</span>                               <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">14754</span>                               <span class="stringliteral">&quot;Error: SSL forward not configured properly&quot;</span>);</div>
<div class="line"><span class="lineno">14755</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">14756</span>                            <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">14757</span>                            <span class="stringliteral">&quot;Can not redirect to SSL, no SSL port available&quot;</span>);</div>
<div class="line"><span class="lineno">14758</span>        }</div>
<div class="line"><span class="lineno">14759</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14760</span>    }</div>
<div class="line"><span class="lineno">14761</span>    uri_len = (int)strlen(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno">14762</span> </div>
<div class="line"><span class="lineno">14763</span>    <span class="comment">/* 1.3. decode url (if config says so) */</span></div>
<div class="line"><span class="lineno">14764</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#acb05505a49b6d5ba3733d63c7aabe8d4">should_decode_url</a>(conn)) {</div>
<div class="line"><span class="lineno">14765</span>        <a class="code hl_function" href="#affee01654ebda8d153ea3b7e7502f248">url_decode_in_place</a>((<span class="keywordtype">char</span> *)ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno">14766</span>    }</div>
<div class="line"><span class="lineno">14767</span> </div>
<div class="line"><span class="lineno">14768</span>    <span class="comment">/* URL decode the query-string only if explicitly set in the configuration</span></div>
<div class="line"><span class="lineno">14769</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">14770</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>) {</div>
<div class="line"><span class="lineno">14771</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac5091c315948383d6f29f90450b9e706">should_decode_query_string</a>(conn)) {</div>
<div class="line"><span class="lineno">14772</span>            <a class="code hl_function" href="#affee01654ebda8d153ea3b7e7502f248">url_decode_in_place</a>((<span class="keywordtype">char</span> *)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>);</div>
<div class="line"><span class="lineno">14773</span>        }</div>
<div class="line"><span class="lineno">14774</span>    }</div>
<div class="line"><span class="lineno">14775</span> </div>
<div class="line"><span class="lineno">14776</span>    <span class="comment">/* 1.4. clean URIs, so a path like allowed_dir/../forbidden_file is not</span></div>
<div class="line"><span class="lineno">14777</span><span class="comment">     * possible. The fact that we cleaned the URI is stored in that the</span></div>
<div class="line"><span class="lineno">14778</span><span class="comment">     * pointer to ri-&gt;local_ur and ri-&gt;local_uri_raw are now different.</span></div>
<div class="line"><span class="lineno">14779</span><span class="comment">     * ri-&gt;local_uri_raw still points to memory allocated in</span></div>
<div class="line"><span class="lineno">14780</span><span class="comment">     * worker_thread_run(). ri-&gt;local_uri is private to the request so we</span></div>
<div class="line"><span class="lineno">14781</span><span class="comment">     * don&#39;t have to use preallocated memory here. */</span></div>
<div class="line"><span class="lineno">14782</span>    tmp = <a class="code hl_function" href="#a4e6a5dc184d97ba5278dfda5b838f1cc">mg_strdup</a>(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a>);</div>
<div class="line"><span class="lineno">14783</span>    <span class="keywordflow">if</span> (!tmp) {</div>
<div class="line"><span class="lineno">14784</span>        <span class="comment">/* Out of memory. We cannot do anything reasonable here. */</span></div>
<div class="line"><span class="lineno">14785</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14786</span>    }</div>
<div class="line"><span class="lineno">14787</span>    <a class="code hl_function" href="#abf6e864c64e3f7b5df96cf2c2598f776">remove_dot_segments</a>(tmp);</div>
<div class="line"><span class="lineno">14788</span>    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a> = tmp;</div>
<div class="line"><span class="lineno">14789</span> </div>
<div class="line"><span class="lineno">14790</span>    <span class="comment">/* step 1. completed, the url is known now */</span></div>
<div class="line"><span class="lineno">14791</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;REQUEST: %s %s&quot;</span>, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno">14792</span> </div>
<div class="line"><span class="lineno">14793</span>    <span class="comment">/* 2. if this ip has limited speed, set it for this connection */</span></div>
<div class="line"><span class="lineno">14794</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a1253d8e7156cefe37debd0c1aa2b3769">throttle</a> = <a class="code hl_function" href="#a84156e09ed2338602b0bda2a3734e1a4">set_throttle</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba73fe0376eae56e950136313f635836e2">THROTTLE</a>],</div>
<div class="line"><span class="lineno">14795</span>                                  &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#afe3a45fe832ca19cc85299b9a96d8feb">rsa</a>,</div>
<div class="line"><span class="lineno">14796</span>                                  ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno">14797</span> </div>
<div class="line"><span class="lineno">14798</span>    <span class="comment">/* 3. call a &quot;handle everything&quot; callback, if registered */</span></div>
<div class="line"><span class="lineno">14799</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aa9a778dfb6c14fdb615d9ef01cf5f6f2">begin_request</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14800</span>        <span class="comment">/* Note that since V1.7 the &quot;begin_request&quot; function is called</span></div>
<div class="line"><span class="lineno">14801</span><span class="comment">         * before an authorization check. If an authorization check is</span></div>
<div class="line"><span class="lineno">14802</span><span class="comment">         * required, use a request_handler instead. */</span></div>
<div class="line"><span class="lineno">14803</span>        i = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aa9a778dfb6c14fdb615d9ef01cf5f6f2">begin_request</a>(conn);</div>
<div class="line"><span class="lineno">14804</span>        <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><span class="lineno">14805</span>            <span class="comment">/* callback already processed the request. Store the</span></div>
<div class="line"><span class="lineno">14806</span><span class="comment">            return value as a status code for the access log. */</span></div>
<div class="line"><span class="lineno">14807</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = i;</div>
<div class="line"><span class="lineno">14808</span>            <span class="keywordflow">if</span> (!conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a>) {</div>
<div class="line"><span class="lineno">14809</span>                <a class="code hl_function" href="#ad9f9ef727b8c8a8ecb4c06b47aeb7d11">discard_unread_request_data</a>(conn);</div>
<div class="line"><span class="lineno">14810</span>            }</div>
<div class="line"><span class="lineno">14811</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;begin_request handled request&quot;</span>);</div>
<div class="line"><span class="lineno">14812</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14813</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><span class="lineno">14814</span>            <span class="comment">/* civetweb should process the request */</span></div>
<div class="line"><span class="lineno">14815</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14816</span>            <span class="comment">/* unspecified - may change with the next version */</span></div>
<div class="line"><span class="lineno">14817</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;done (undocumented behavior)&quot;</span>);</div>
<div class="line"><span class="lineno">14818</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14819</span>        }</div>
<div class="line"><span class="lineno">14820</span>    }</div>
<div class="line"><span class="lineno">14821</span> </div>
<div class="line"><span class="lineno">14822</span>    <span class="comment">/* request not yet handled by a handler or redirect, so the request</span></div>
<div class="line"><span class="lineno">14823</span><span class="comment">     * is processed here */</span></div>
<div class="line"><span class="lineno">14824</span> </div>
<div class="line"><span class="lineno">14825</span>    <span class="comment">/* 4. Check for CORS preflight requests and handle them (if configured).</span></div>
<div class="line"><span class="lineno">14826</span><span class="comment">     * https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS</span></div>
<div class="line"><span class="lineno">14827</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">14828</span>    <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;OPTIONS&quot;</span>)) {</div>
<div class="line"><span class="lineno">14829</span>        <span class="comment">/* Send a response to CORS preflights only if</span></div>
<div class="line"><span class="lineno">14830</span><span class="comment">         * access_control_allow_methods is not NULL and not an empty string.</span></div>
<div class="line"><span class="lineno">14831</span><span class="comment">         * In this case, scripts can still handle CORS. */</span></div>
<div class="line"><span class="lineno">14832</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *cors_meth_cfg =</div>
<div class="line"><span class="lineno">14833</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba6369d07e303c71b53dbc62f42bf4ebe2">ACCESS_CONTROL_ALLOW_METHODS</a>];</div>
<div class="line"><span class="lineno">14834</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *cors_orig_cfg =</div>
<div class="line"><span class="lineno">14835</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba18505d55559e2f7fee94e1ec4f1361d0">ACCESS_CONTROL_ALLOW_ORIGIN</a>];</div>
<div class="line"><span class="lineno">14836</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *cors_origin =</div>
<div class="line"><span class="lineno">14837</span>            <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a>, <span class="stringliteral">&quot;Origin&quot;</span>);</div>
<div class="line"><span class="lineno">14838</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *cors_acrm = <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>,</div>
<div class="line"><span class="lineno">14839</span>                                           ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a>,</div>
<div class="line"><span class="lineno">14840</span>                                           <span class="stringliteral">&quot;Access-Control-Request-Method&quot;</span>);</div>
<div class="line"><span class="lineno">14841</span> </div>
<div class="line"><span class="lineno">14842</span>        <span class="comment">/* Todo: check if cors_origin is in cors_orig_cfg.</span></div>
<div class="line"><span class="lineno">14843</span><span class="comment">         * Or, let the client check this. */</span></div>
<div class="line"><span class="lineno">14844</span> </div>
<div class="line"><span class="lineno">14845</span>        <span class="keywordflow">if</span> ((cors_meth_cfg != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (*cors_meth_cfg != 0)</div>
<div class="line"><span class="lineno">14846</span>            &amp;&amp; (cors_orig_cfg != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (*cors_orig_cfg != 0)</div>
<div class="line"><span class="lineno">14847</span>            &amp;&amp; (cors_origin != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (cors_acrm != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">14848</span>            <span class="comment">/* This is a valid CORS preflight, and the server is configured</span></div>
<div class="line"><span class="lineno">14849</span><span class="comment">             * to handle it automatically. */</span></div>
<div class="line"><span class="lineno">14850</span>            <span class="keyword">const</span> <span class="keywordtype">char</span> *cors_acrh =</div>
<div class="line"><span class="lineno">14851</span>                <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>,</div>
<div class="line"><span class="lineno">14852</span>                           ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a>,</div>
<div class="line"><span class="lineno">14853</span>                           <span class="stringliteral">&quot;Access-Control-Request-Headers&quot;</span>);</div>
<div class="line"><span class="lineno">14854</span> </div>
<div class="line"><span class="lineno">14855</span>            <a class="code hl_function" href="#a7ef6ebce89c81f7218a0968e3aa9107f">gmt_time_string</a>(date, <span class="keyword">sizeof</span>(date), &amp;curtime);</div>
<div class="line"><span class="lineno">14856</span>            <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">14857</span>                      <span class="stringliteral">&quot;HTTP/1.1 200 OK\r\n&quot;</span></div>
<div class="line"><span class="lineno">14858</span>                      <span class="stringliteral">&quot;Date: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">14859</span>                      <span class="stringliteral">&quot;Access-Control-Allow-Origin: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">14860</span>                      <span class="stringliteral">&quot;Access-Control-Allow-Methods: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">14861</span>                      <span class="stringliteral">&quot;Content-Length: 0\r\n&quot;</span></div>
<div class="line"><span class="lineno">14862</span>                      <span class="stringliteral">&quot;Connection: %s\r\n&quot;</span>,</div>
<div class="line"><span class="lineno">14863</span>                      date,</div>
<div class="line"><span class="lineno">14864</span>                      cors_orig_cfg,</div>
<div class="line"><span class="lineno">14865</span>                      ((cors_meth_cfg[0] == <span class="charliteral">&#39;*&#39;</span>) ? cors_acrm : cors_meth_cfg),</div>
<div class="line"><span class="lineno">14866</span>                      <a class="code hl_function" href="#a8b35d4674db9acdc8b837dde56bcd94e">suggest_connection_header</a>(conn));</div>
<div class="line"><span class="lineno">14867</span> </div>
<div class="line"><span class="lineno">14868</span>            <span class="keywordflow">if</span> (cors_acrh != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14869</span>                <span class="comment">/* CORS request is asking for additional headers */</span></div>
<div class="line"><span class="lineno">14870</span>                <span class="keyword">const</span> <span class="keywordtype">char</span> *cors_hdr_cfg =</div>
<div class="line"><span class="lineno">14871</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43c2119bd7a41e72316c4fd26c3eaa70">ACCESS_CONTROL_ALLOW_HEADERS</a>];</div>
<div class="line"><span class="lineno">14872</span> </div>
<div class="line"><span class="lineno">14873</span>                <span class="keywordflow">if</span> ((cors_hdr_cfg != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (*cors_hdr_cfg != 0)) {</div>
<div class="line"><span class="lineno">14874</span>                    <span class="comment">/* Allow only if access_control_allow_headers is</span></div>
<div class="line"><span class="lineno">14875</span><span class="comment">                     * not NULL and not an empty string. If this</span></div>
<div class="line"><span class="lineno">14876</span><span class="comment">                     * configuration is set to *, allow everything.</span></div>
<div class="line"><span class="lineno">14877</span><span class="comment">                     * Otherwise this configuration must be a list</span></div>
<div class="line"><span class="lineno">14878</span><span class="comment">                     * of allowed HTTP header names. */</span></div>
<div class="line"><span class="lineno">14879</span>                    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">14880</span>                              <span class="stringliteral">&quot;Access-Control-Allow-Headers: %s\r\n&quot;</span>,</div>
<div class="line"><span class="lineno">14881</span>                              ((cors_hdr_cfg[0] == <span class="charliteral">&#39;*&#39;</span>) ? cors_acrh</div>
<div class="line"><span class="lineno">14882</span>                                                        : cors_hdr_cfg));</div>
<div class="line"><span class="lineno">14883</span>                }</div>
<div class="line"><span class="lineno">14884</span>            }</div>
<div class="line"><span class="lineno">14885</span>            <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn, <span class="stringliteral">&quot;Access-Control-Max-Age: 60\r\n&quot;</span>);</div>
<div class="line"><span class="lineno">14886</span>            <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn, <span class="stringliteral">&quot;\r\n&quot;</span>);</div>
<div class="line"><span class="lineno">14887</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;OPTIONS done&quot;</span>);</div>
<div class="line"><span class="lineno">14888</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14889</span>        }</div>
<div class="line"><span class="lineno">14890</span>    }</div>
<div class="line"><span class="lineno">14891</span> </div>
<div class="line"><span class="lineno">14892</span>    <span class="comment">/* 5. interpret the url to find out how the request must be handled</span></div>
<div class="line"><span class="lineno">14893</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">14894</span>    <span class="comment">/* 5.1. first test, if the request targets the regular http(s)://</span></div>
<div class="line"><span class="lineno">14895</span><span class="comment">     * protocol namespace or the websocket ws(s):// protocol namespace.</span></div>
<div class="line"><span class="lineno">14896</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">14897</span>    is_websocket_request = (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436">PROTOCOL_TYPE_WEBSOCKET</a>);</div>
<div class="line"><span class="lineno">14898</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno">14899</span>    handler_type = is_websocket_request ? <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484">WEBSOCKET_HANDLER</a> : <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a>;</div>
<div class="line"><span class="lineno">14900</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">14901</span>    handler_type = <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a>;</div>
<div class="line"><span class="lineno">14902</span><span class="preprocessor">#endif </span><span class="comment">/* defined(USE_WEBSOCKET) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">14903</span> </div>
<div class="line"><span class="lineno">14904</span>    <span class="keywordflow">if</span> (is_websocket_request) {</div>
<div class="line"><span class="lineno">14905</span>        <a class="code hl_define" href="#acda7cfeae2b1fbd50730709088e7da95">HTTP1_only</a>;</div>
<div class="line"><span class="lineno">14906</span>    }</div>
<div class="line"><span class="lineno">14907</span> </div>
<div class="line"><span class="lineno">14908</span>    <span class="comment">/* 5.2. check if the request will be handled by a callback */</span></div>
<div class="line"><span class="lineno">14909</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#abff1b1a2d706ca9cd15c954196418119">get_request_handler</a>(conn,</div>
<div class="line"><span class="lineno">14910</span>                            handler_type,</div>
<div class="line"><span class="lineno">14911</span>                            &amp;callback_handler,</div>
<div class="line"><span class="lineno">14912</span>                            &amp;<a class="code hl_variable" href="structmg__websocket__subprotocols.html#a0eacbb0bf0e500dd7a16845e2c35701f">subprotocols</a>,</div>
<div class="line"><span class="lineno">14913</span>                            &amp;ws_connect_handler,</div>
<div class="line"><span class="lineno">14914</span>                            &amp;ws_ready_handler,</div>
<div class="line"><span class="lineno">14915</span>                            &amp;ws_data_handler,</div>
<div class="line"><span class="lineno">14916</span>                            &amp;ws_close_handler,</div>
<div class="line"><span class="lineno">14917</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14918</span>                            &amp;callback_data,</div>
<div class="line"><span class="lineno">14919</span>                            &amp;handler_info)) {</div>
<div class="line"><span class="lineno">14920</span>        <span class="comment">/* 5.2.1. A callback will handle this request. All requests</span></div>
<div class="line"><span class="lineno">14921</span><span class="comment">         * handled by a callback have to be considered as requests</span></div>
<div class="line"><span class="lineno">14922</span><span class="comment">         * to a script resource. */</span></div>
<div class="line"><span class="lineno">14923</span>        is_callback_resource = 1;</div>
<div class="line"><span class="lineno">14924</span>        is_script_resource = 1;</div>
<div class="line"><span class="lineno">14925</span>        is_put_or_delete_request = <a class="code hl_function" href="#ab8aa528da861495a7c5655dd89eaecb1">is_put_or_delete_method</a>(conn);</div>
<div class="line"><span class="lineno">14926</span>        <span class="comment">/* Never handle a C callback according to File WebDav rules,</span></div>
<div class="line"><span class="lineno">14927</span><span class="comment">         * even if it is a webdav method */</span></div>
<div class="line"><span class="lineno">14928</span>        is_webdav_request = 0; <span class="comment">/* is_civetweb_webdav_method(conn); */</span></div>
<div class="line"><span class="lineno">14929</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14930</span>    no_callback_resource:</div>
<div class="line"><span class="lineno">14931</span> </div>
<div class="line"><span class="lineno">14932</span>        <span class="comment">/* 5.2.2. No callback is responsible for this request. The URI</span></div>
<div class="line"><span class="lineno">14933</span><span class="comment">         * addresses a file based resource (static content or Lua/cgi</span></div>
<div class="line"><span class="lineno">14934</span><span class="comment">         * scripts in the file system). */</span></div>
<div class="line"><span class="lineno">14935</span>        is_callback_resource = 0;</div>
<div class="line"><span class="lineno">14936</span>        <a class="code hl_function" href="#ab1681f675e3235a77787a2a174e1f9a5">interpret_uri</a>(conn,</div>
<div class="line"><span class="lineno">14937</span>                      path,</div>
<div class="line"><span class="lineno">14938</span>                      <span class="keyword">sizeof</span>(path),</div>
<div class="line"><span class="lineno">14939</span>                      &amp;file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>,</div>
<div class="line"><span class="lineno">14940</span>                      &amp;is_found,</div>
<div class="line"><span class="lineno">14941</span>                      &amp;is_script_resource,</div>
<div class="line"><span class="lineno">14942</span>                      &amp;is_websocket_request,</div>
<div class="line"><span class="lineno">14943</span>                      &amp;is_put_or_delete_request,</div>
<div class="line"><span class="lineno">14944</span>                      &amp;is_webdav_request,</div>
<div class="line"><span class="lineno">14945</span>                      &amp;is_template_text_file);</div>
<div class="line"><span class="lineno">14946</span>    }</div>
<div class="line"><span class="lineno">14947</span> </div>
<div class="line"><span class="lineno">14948</span>    <span class="comment">/* 5.3. A webdav request (PROPFIND/PROPPATCH/LOCK/UNLOCK) */</span></div>
<div class="line"><span class="lineno">14949</span>    <span class="keywordflow">if</span> (is_webdav_request) {</div>
<div class="line"><span class="lineno">14950</span>        <span class="comment">/* TODO: Do we need a config option? */</span></div>
<div class="line"><span class="lineno">14951</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *webdav_enable = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba5dc474ce23af919313afd42d5610bc05">ENABLE_WEBDAV</a>];</div>
<div class="line"><span class="lineno">14952</span>        <span class="keywordflow">if</span> (webdav_enable[0] != <span class="charliteral">&#39;y&#39;</span>) {</div>
<div class="line"><span class="lineno">14953</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">14954</span>                               405,</div>
<div class="line"><span class="lineno">14955</span>                               <span class="stringliteral">&quot;%s method not allowed&quot;</span>,</div>
<div class="line"><span class="lineno">14956</span>                               conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>);</div>
<div class="line"><span class="lineno">14957</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;webdav rejected&quot;</span>);</div>
<div class="line"><span class="lineno">14958</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14959</span>        }</div>
<div class="line"><span class="lineno">14960</span>    }</div>
<div class="line"><span class="lineno">14961</span> </div>
<div class="line"><span class="lineno">14962</span>    <span class="comment">/* 6. authorization check */</span></div>
<div class="line"><span class="lineno">14963</span>    <span class="comment">/* 6.1. a custom authorization handler is installed */</span></div>
<div class="line"><span class="lineno">14964</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#abff1b1a2d706ca9cd15c954196418119">get_request_handler</a>(conn,</div>
<div class="line"><span class="lineno">14965</span>                            <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7a8617f4f76318f5c524016c5bc6fa864c">AUTH_HANDLER</a>,</div>
<div class="line"><span class="lineno">14966</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14967</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14968</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14969</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14970</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14971</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14972</span>                            &amp;auth_handler,</div>
<div class="line"><span class="lineno">14973</span>                            &amp;auth_callback_data,</div>
<div class="line"><span class="lineno">14974</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">14975</span>        <span class="keywordflow">if</span> (!auth_handler(conn, auth_callback_data)) {</div>
<div class="line"><span class="lineno">14976</span> </div>
<div class="line"><span class="lineno">14977</span>            <span class="comment">/* Callback handler will not be used anymore. Release it */</span></div>
<div class="line"><span class="lineno">14978</span>            <a class="code hl_function" href="#a96d08ddca4fe56dbb1647c8e250db9b3">release_handler_ref</a>(conn, handler_info);</div>
<div class="line"><span class="lineno">14979</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;auth handler rejected request&quot;</span>);</div>
<div class="line"><span class="lineno">14980</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14981</span>        }</div>
<div class="line"><span class="lineno">14982</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_put_or_delete_request &amp;&amp; !is_script_resource</div>
<div class="line"><span class="lineno">14983</span>               &amp;&amp; !is_callback_resource) {</div>
<div class="line"><span class="lineno">14984</span>        <a class="code hl_define" href="#acda7cfeae2b1fbd50730709088e7da95">HTTP1_only</a>;</div>
<div class="line"><span class="lineno">14985</span>        <span class="comment">/* 6.2. this request is a PUT/DELETE to a real file */</span></div>
<div class="line"><span class="lineno">14986</span>        <span class="comment">/* 6.2.1. thus, the server must have real files */</span></div>
<div class="line"><span class="lineno">14987</span><span class="preprocessor">#if defined(NO_FILES)</span></div>
<div class="line"><span class="lineno">14988</span>        <span class="keywordflow">if</span> (1) {</div>
<div class="line"><span class="lineno">14989</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">14990</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>] == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><span class="lineno">14991</span>            || conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba9f0c9561bdb0b2b975178617c8d3c59a">PUT_DELETE_PASSWORDS_FILE</a>] == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14992</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">14993</span>            <span class="comment">/* This code path will not be called for request handlers */</span></div>
<div class="line"><span class="lineno">14994</span>            <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(handler_info == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14995</span> </div>
<div class="line"><span class="lineno">14996</span>            <span class="comment">/* This server does not have any real files, thus the</span></div>
<div class="line"><span class="lineno">14997</span><span class="comment">             * PUT/DELETE methods are not valid. */</span></div>
<div class="line"><span class="lineno">14998</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">14999</span>                               405,</div>
<div class="line"><span class="lineno">15000</span>                               <span class="stringliteral">&quot;%s method not allowed&quot;</span>,</div>
<div class="line"><span class="lineno">15001</span>                               conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>);</div>
<div class="line"><span class="lineno">15002</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;all file based put/delete requests rejected&quot;</span>);</div>
<div class="line"><span class="lineno">15003</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15004</span>        }</div>
<div class="line"><span class="lineno">15005</span> </div>
<div class="line"><span class="lineno">15006</span><span class="preprocessor">#if !defined(NO_FILES)</span></div>
<div class="line"><span class="lineno">15007</span>        <span class="comment">/* 6.2.2. Check if put authorization for static files is</span></div>
<div class="line"><span class="lineno">15008</span><span class="comment">         * available.</span></div>
<div class="line"><span class="lineno">15009</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">15010</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a01cd34a432a273eba4e48fb327503bc8">is_authorized_for_put</a>(conn)) {</div>
<div class="line"><span class="lineno">15011</span>            <a class="code hl_function" href="#a3e30365a0294614e545550653e71c809">send_authorization_request</a>(conn, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">15012</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;file write needs authorization&quot;</span>);</div>
<div class="line"><span class="lineno">15013</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15014</span>        }</div>
<div class="line"><span class="lineno">15015</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15016</span> </div>
<div class="line"><span class="lineno">15017</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15018</span>        <span class="comment">/* 6.3. This is either a OPTIONS, GET, HEAD or POST request,</span></div>
<div class="line"><span class="lineno">15019</span><span class="comment">         * or it is a PUT or DELETE request to a resource that does not</span></div>
<div class="line"><span class="lineno">15020</span><span class="comment">         * correspond to a file. Check authorization. */</span></div>
<div class="line"><span class="lineno">15021</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a09229a33ae0eac77138714207fc46c14">check_authorization</a>(conn, path)) {</div>
<div class="line"><span class="lineno">15022</span>            <a class="code hl_function" href="#a3e30365a0294614e545550653e71c809">send_authorization_request</a>(conn, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">15023</span> </div>
<div class="line"><span class="lineno">15024</span>            <span class="comment">/* Callback handler will not be used anymore. Release it */</span></div>
<div class="line"><span class="lineno">15025</span>            <a class="code hl_function" href="#a96d08ddca4fe56dbb1647c8e250db9b3">release_handler_ref</a>(conn, handler_info);</div>
<div class="line"><span class="lineno">15026</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;access authorization required&quot;</span>);</div>
<div class="line"><span class="lineno">15027</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15028</span>        }</div>
<div class="line"><span class="lineno">15029</span>    }</div>
<div class="line"><span class="lineno">15030</span> </div>
<div class="line"><span class="lineno">15031</span>    <span class="comment">/* request is authorized or does not need authorization */</span></div>
<div class="line"><span class="lineno">15032</span> </div>
<div class="line"><span class="lineno">15033</span>    <span class="comment">/* 7. check if there are request handlers for this uri */</span></div>
<div class="line"><span class="lineno">15034</span>    <span class="keywordflow">if</span> (is_callback_resource) {</div>
<div class="line"><span class="lineno">15035</span>        <a class="code hl_define" href="#acda7cfeae2b1fbd50730709088e7da95">HTTP1_only</a>;</div>
<div class="line"><span class="lineno">15036</span>        <span class="keywordflow">if</span> (!is_websocket_request) {</div>
<div class="line"><span class="lineno">15037</span>            i = callback_handler(conn, callback_data);</div>
<div class="line"><span class="lineno">15038</span> </div>
<div class="line"><span class="lineno">15039</span>            <span class="comment">/* Callback handler will not be used anymore. Release it */</span></div>
<div class="line"><span class="lineno">15040</span>            <a class="code hl_function" href="#a96d08ddca4fe56dbb1647c8e250db9b3">release_handler_ref</a>(conn, handler_info);</div>
<div class="line"><span class="lineno">15041</span> </div>
<div class="line"><span class="lineno">15042</span>            <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><span class="lineno">15043</span>                <span class="comment">/* Do nothing, callback has served the request. Store</span></div>
<div class="line"><span class="lineno">15044</span><span class="comment">                 * then return value as status code for the log and discard</span></div>
<div class="line"><span class="lineno">15045</span><span class="comment">                 * all data from the client not used by the callback. */</span></div>
<div class="line"><span class="lineno">15046</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = i;</div>
<div class="line"><span class="lineno">15047</span>                <span class="keywordflow">if</span> (!conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a>) {</div>
<div class="line"><span class="lineno">15048</span>                    <a class="code hl_function" href="#ad9f9ef727b8c8a8ecb4c06b47aeb7d11">discard_unread_request_data</a>(conn);</div>
<div class="line"><span class="lineno">15049</span>                }</div>
<div class="line"><span class="lineno">15050</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15051</span>                <span class="comment">/* The handler did NOT handle the request. */</span></div>
<div class="line"><span class="lineno">15052</span>                <span class="comment">/* Some proper reactions would be:</span></div>
<div class="line"><span class="lineno">15053</span><span class="comment">                 * a) close the connections without sending anything</span></div>
<div class="line"><span class="lineno">15054</span><span class="comment">                 * b) send a 404 not found</span></div>
<div class="line"><span class="lineno">15055</span><span class="comment">                 * c) try if there is a file matching the URI</span></div>
<div class="line"><span class="lineno">15056</span><span class="comment">                 * It would be possible to do a, b or c in the callback</span></div>
<div class="line"><span class="lineno">15057</span><span class="comment">                 * implementation, and return 1 - we cannot do anything</span></div>
<div class="line"><span class="lineno">15058</span><span class="comment">                 * here, that is not possible in the callback.</span></div>
<div class="line"><span class="lineno">15059</span><span class="comment">                 *</span></div>
<div class="line"><span class="lineno">15060</span><span class="comment">                 * TODO: What would be the best reaction here?</span></div>
<div class="line"><span class="lineno">15061</span><span class="comment">                 * (Note: The reaction may change, if there is a better</span></div>
<div class="line"><span class="lineno">15062</span><span class="comment">                 * idea.)</span></div>
<div class="line"><span class="lineno">15063</span><span class="comment">                 */</span></div>
<div class="line"><span class="lineno">15064</span> </div>
<div class="line"><span class="lineno">15065</span>                <span class="comment">/* For the moment, use option c: We look for a proper file,</span></div>
<div class="line"><span class="lineno">15066</span><span class="comment">                 * but since a file request is not always a script resource,</span></div>
<div class="line"><span class="lineno">15067</span><span class="comment">                 * the authorization check might be different. */</span></div>
<div class="line"><span class="lineno">15068</span>                callback_handler = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">15069</span> </div>
<div class="line"><span class="lineno">15070</span>                <span class="comment">/* Here we are at a dead end:</span></div>
<div class="line"><span class="lineno">15071</span><span class="comment">                 * According to URI matching, a callback should be</span></div>
<div class="line"><span class="lineno">15072</span><span class="comment">                 * responsible for handling the request,</span></div>
<div class="line"><span class="lineno">15073</span><span class="comment">                 * we called it, but the callback declared itself</span></div>
<div class="line"><span class="lineno">15074</span><span class="comment">                 * not responsible.</span></div>
<div class="line"><span class="lineno">15075</span><span class="comment">                 * We use a goto here, to get out of this dead end,</span></div>
<div class="line"><span class="lineno">15076</span><span class="comment">                 * and continue with the default handling.</span></div>
<div class="line"><span class="lineno">15077</span><span class="comment">                 * A goto here is simpler and better to understand</span></div>
<div class="line"><span class="lineno">15078</span><span class="comment">                 * than some curious loop. */</span></div>
<div class="line"><span class="lineno">15079</span>                <span class="keywordflow">goto</span> no_callback_resource;</div>
<div class="line"><span class="lineno">15080</span>            }</div>
<div class="line"><span class="lineno">15081</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15082</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno">15083</span>            handle_websocket_request(conn,</div>
<div class="line"><span class="lineno">15084</span>                                     path,</div>
<div class="line"><span class="lineno">15085</span>                                     is_callback_resource,</div>
<div class="line"><span class="lineno">15086</span>                                     <a class="code hl_variable" href="structmg__websocket__subprotocols.html#a0eacbb0bf0e500dd7a16845e2c35701f">subprotocols</a>,</div>
<div class="line"><span class="lineno">15087</span>                                     ws_connect_handler,</div>
<div class="line"><span class="lineno">15088</span>                                     ws_ready_handler,</div>
<div class="line"><span class="lineno">15089</span>                                     ws_data_handler,</div>
<div class="line"><span class="lineno">15090</span>                                     ws_close_handler,</div>
<div class="line"><span class="lineno">15091</span>                                     callback_data);</div>
<div class="line"><span class="lineno">15092</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15093</span>        }</div>
<div class="line"><span class="lineno">15094</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;websocket handling done&quot;</span>);</div>
<div class="line"><span class="lineno">15095</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15096</span>    }</div>
<div class="line"><span class="lineno">15097</span> </div>
<div class="line"><span class="lineno">15098</span>    <span class="comment">/* 8. handle websocket requests */</span></div>
<div class="line"><span class="lineno">15099</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno">15100</span>    <span class="keywordflow">if</span> (is_websocket_request) {</div>
<div class="line"><span class="lineno">15101</span>        <a class="code hl_define" href="#acda7cfeae2b1fbd50730709088e7da95">HTTP1_only</a>;</div>
<div class="line"><span class="lineno">15102</span>        <span class="keywordflow">if</span> (is_script_resource) {</div>
<div class="line"><span class="lineno">15103</span> </div>
<div class="line"><span class="lineno">15104</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac4e67843460a2634c2ccd7f1f0343877">is_in_script_path</a>(conn, path)) {</div>
<div class="line"><span class="lineno">15105</span>                <span class="comment">/* Websocket Lua script */</span></div>
<div class="line"><span class="lineno">15106</span>                handle_websocket_request(conn,</div>
<div class="line"><span class="lineno">15107</span>                                         path,</div>
<div class="line"><span class="lineno">15108</span>                                         0 <span class="comment">/* Lua Script */</span>,</div>
<div class="line"><span class="lineno">15109</span>                                         <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">15110</span>                                         <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">15111</span>                                         <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">15112</span>                                         <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">15113</span>                                         <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">15114</span>                                         conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a73a26dd1c9abead88b40b2d226ad9f28">user_data</a>);</div>
<div class="line"><span class="lineno">15115</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15116</span>                <span class="comment">/* Script was in an illegal path */</span></div>
<div class="line"><span class="lineno">15117</span>                <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 403, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Forbidden&quot;</span>);</div>
<div class="line"><span class="lineno">15118</span>            }</div>
<div class="line"><span class="lineno">15119</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15120</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 404, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Not found&quot;</span>);</div>
<div class="line"><span class="lineno">15121</span>        }</div>
<div class="line"><span class="lineno">15122</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;websocket script done&quot;</span>);</div>
<div class="line"><span class="lineno">15123</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15124</span>    } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">15125</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15126</span> </div>
<div class="line"><span class="lineno">15127</span><span class="preprocessor">#if defined(NO_FILES)</span></div>
<div class="line"><span class="lineno">15128</span>        <span class="comment">/* 9a. In case the server uses only callbacks, this uri is</span></div>
<div class="line"><span class="lineno">15129</span><span class="comment">         * unknown.</span></div>
<div class="line"><span class="lineno">15130</span><span class="comment">         * Then, all request handling ends here. */</span></div>
<div class="line"><span class="lineno">15131</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 404, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Not Found&quot;</span>);</div>
<div class="line"><span class="lineno">15132</span> </div>
<div class="line"><span class="lineno">15133</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">15134</span>    <span class="comment">/* 9b. This request is either for a static file or resource handled</span></div>
<div class="line"><span class="lineno">15135</span><span class="comment">     * by a script file. Thus, a DOCUMENT_ROOT must exist. */</span></div>
<div class="line"><span class="lineno">15136</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>] == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">15137</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 404, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Not Found&quot;</span>);</div>
<div class="line"><span class="lineno">15138</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;no document root available&quot;</span>);</div>
<div class="line"><span class="lineno">15139</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15140</span>    }</div>
<div class="line"><span class="lineno">15141</span> </div>
<div class="line"><span class="lineno">15142</span>    <span class="comment">/* 10. Request is handled by a script */</span></div>
<div class="line"><span class="lineno">15143</span>    <span class="keywordflow">if</span> (is_script_resource) {</div>
<div class="line"><span class="lineno">15144</span>        <a class="code hl_define" href="#acda7cfeae2b1fbd50730709088e7da95">HTTP1_only</a>;</div>
<div class="line"><span class="lineno">15145</span>        <a class="code hl_function" href="#a4761bad9f703f9d51380597f4b1a694c">handle_file_based_request</a>(conn, path, &amp;file);</div>
<div class="line"><span class="lineno">15146</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;script handling done&quot;</span>);</div>
<div class="line"><span class="lineno">15147</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15148</span>    }</div>
<div class="line"><span class="lineno">15149</span> </div>
<div class="line"><span class="lineno">15150</span>    <span class="comment">/* Request was not handled by a callback or script. It will be</span></div>
<div class="line"><span class="lineno">15151</span><span class="comment">     * handled by a server internal method. */</span></div>
<div class="line"><span class="lineno">15152</span> </div>
<div class="line"><span class="lineno">15153</span>    <span class="comment">/* 11. Handle put/delete/mkcol requests */</span></div>
<div class="line"><span class="lineno">15154</span>    <span class="keywordflow">if</span> (is_put_or_delete_request) {</div>
<div class="line"><span class="lineno">15155</span>        <a class="code hl_define" href="#acda7cfeae2b1fbd50730709088e7da95">HTTP1_only</a>;</div>
<div class="line"><span class="lineno">15156</span>        <span class="comment">/* 11.1. PUT method */</span></div>
<div class="line"><span class="lineno">15157</span>        <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;PUT&quot;</span>)) {</div>
<div class="line"><span class="lineno">15158</span>            <a class="code hl_function" href="#a188d397634e66f50df4a25eb2b46b6eb">put_file</a>(conn, path);</div>
<div class="line"><span class="lineno">15159</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>,</div>
<div class="line"><span class="lineno">15160</span>                        ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15161</span>                        path);</div>
<div class="line"><span class="lineno">15162</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15163</span>        }</div>
<div class="line"><span class="lineno">15164</span>        <span class="comment">/* 11.2. DELETE method */</span></div>
<div class="line"><span class="lineno">15165</span>        <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;DELETE&quot;</span>)) {</div>
<div class="line"><span class="lineno">15166</span>            <a class="code hl_function" href="#a2912c3ad9f0ba624b545a6f920ab5ddc">delete_file</a>(conn, path);</div>
<div class="line"><span class="lineno">15167</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>,</div>
<div class="line"><span class="lineno">15168</span>                        ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15169</span>                        path);</div>
<div class="line"><span class="lineno">15170</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15171</span>        }</div>
<div class="line"><span class="lineno">15172</span>        <span class="comment">/* 11.3. MKCOL method */</span></div>
<div class="line"><span class="lineno">15173</span>        <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;MKCOL&quot;</span>)) {</div>
<div class="line"><span class="lineno">15174</span>            <a class="code hl_function" href="#abf278680b80623f1e661ef055c695533">dav_mkcol</a>(conn, path);</div>
<div class="line"><span class="lineno">15175</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>,</div>
<div class="line"><span class="lineno">15176</span>                        ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15177</span>                        path);</div>
<div class="line"><span class="lineno">15178</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15179</span>        }</div>
<div class="line"><span class="lineno">15180</span>        <span class="comment">/* 11.4. MOVE method */</span></div>
<div class="line"><span class="lineno">15181</span>        <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;MOVE&quot;</span>)) {</div>
<div class="line"><span class="lineno">15182</span>            <a class="code hl_function" href="#a367094998bdec220ff7ab52f60283dc2">dav_move_file</a>(conn, path, 0);</div>
<div class="line"><span class="lineno">15183</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>,</div>
<div class="line"><span class="lineno">15184</span>                        ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15185</span>                        path);</div>
<div class="line"><span class="lineno">15186</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15187</span>        }</div>
<div class="line"><span class="lineno">15188</span>        <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;COPY&quot;</span>)) {</div>
<div class="line"><span class="lineno">15189</span>            <a class="code hl_function" href="#a367094998bdec220ff7ab52f60283dc2">dav_move_file</a>(conn, path, 1);</div>
<div class="line"><span class="lineno">15190</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>,</div>
<div class="line"><span class="lineno">15191</span>                        ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15192</span>                        path);</div>
<div class="line"><span class="lineno">15193</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15194</span>        }</div>
<div class="line"><span class="lineno">15195</span>        <span class="comment">/* 11.5. LOCK method */</span></div>
<div class="line"><span class="lineno">15196</span>        <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;LOCK&quot;</span>)) {</div>
<div class="line"><span class="lineno">15197</span>            <a class="code hl_function" href="#a6b18e8f2e8a8ae569d9582857bcc7c19">dav_lock_file</a>(conn, path);</div>
<div class="line"><span class="lineno">15198</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>,</div>
<div class="line"><span class="lineno">15199</span>                        ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15200</span>                        path);</div>
<div class="line"><span class="lineno">15201</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15202</span>        }</div>
<div class="line"><span class="lineno">15203</span>        <span class="comment">/* 11.6. UNLOCK method */</span></div>
<div class="line"><span class="lineno">15204</span>        <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;UNLOCK&quot;</span>)) {</div>
<div class="line"><span class="lineno">15205</span>            <a class="code hl_function" href="#a72d17299496dec4724fe359b9cc5fc50">dav_unlock_file</a>(conn, path);</div>
<div class="line"><span class="lineno">15206</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>,</div>
<div class="line"><span class="lineno">15207</span>                        ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15208</span>                        path);</div>
<div class="line"><span class="lineno">15209</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15210</span>        }</div>
<div class="line"><span class="lineno">15211</span>        <span class="comment">/* 11.7. PROPPATCH method */</span></div>
<div class="line"><span class="lineno">15212</span>        <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;PROPPATCH&quot;</span>)) {</div>
<div class="line"><span class="lineno">15213</span>            <a class="code hl_function" href="#a393a2d03d9209602b28629421b382841">dav_proppatch</a>(conn, path);</div>
<div class="line"><span class="lineno">15214</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>,</div>
<div class="line"><span class="lineno">15215</span>                        ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15216</span>                        path);</div>
<div class="line"><span class="lineno">15217</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15218</span>        }</div>
<div class="line"><span class="lineno">15219</span>        <span class="comment">/* 11.8. Other methods, e.g.: PATCH</span></div>
<div class="line"><span class="lineno">15220</span><span class="comment">         * This method is not supported for static resources,</span></div>
<div class="line"><span class="lineno">15221</span><span class="comment">         * only for scripts (Lua, CGI) and callbacks. */</span></div>
<div class="line"><span class="lineno">15222</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">15223</span>                           405,</div>
<div class="line"><span class="lineno">15224</span>                           <span class="stringliteral">&quot;%s method not allowed&quot;</span>,</div>
<div class="line"><span class="lineno">15225</span>                           conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>);</div>
<div class="line"><span class="lineno">15226</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;method %s on %s is not supported&quot;</span>,</div>
<div class="line"><span class="lineno">15227</span>                    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15228</span>                    path);</div>
<div class="line"><span class="lineno">15229</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15230</span>    }</div>
<div class="line"><span class="lineno">15231</span> </div>
<div class="line"><span class="lineno">15232</span>    <span class="comment">/* 11. File does not exist, or it was configured that it should be</span></div>
<div class="line"><span class="lineno">15233</span><span class="comment">     * hidden */</span></div>
<div class="line"><span class="lineno">15234</span>    <span class="keywordflow">if</span> (!is_found || (<a class="code hl_function" href="#a38c5f9290df5fe9727338a93493108f5">must_hide_file</a>(conn, path))) {</div>
<div class="line"><span class="lineno">15235</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 404, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Not found&quot;</span>);</div>
<div class="line"><span class="lineno">15236</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s: file not found&quot;</span>,</div>
<div class="line"><span class="lineno">15237</span>                    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15238</span>                    path);</div>
<div class="line"><span class="lineno">15239</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15240</span>    }</div>
<div class="line"><span class="lineno">15241</span> </div>
<div class="line"><span class="lineno">15242</span>    <span class="comment">/* 12. Directory uris should end with a slash */</span></div>
<div class="line"><span class="lineno">15243</span>    <span class="keywordflow">if</span> (file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a> &amp;&amp; ((uri_len = (<span class="keywordtype">int</span>)strlen(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>)) &gt; 0)</div>
<div class="line"><span class="lineno">15244</span>        &amp;&amp; (ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>[uri_len - 1] != <span class="charliteral">&#39;/&#39;</span>)) {</div>
<div class="line"><span class="lineno">15245</span> </div>
<div class="line"><span class="lineno">15246</span>        <span class="comment">/* Path + server root */</span></div>
<div class="line"><span class="lineno">15247</span>        <span class="keywordtype">size_t</span> buflen = <a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a> * 2 + 2;</div>
<div class="line"><span class="lineno">15248</span>        <span class="keywordtype">char</span> *new_path;</div>
<div class="line"><span class="lineno">15249</span> </div>
<div class="line"><span class="lineno">15250</span>        <span class="keywordflow">if</span> (ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>) {</div>
<div class="line"><span class="lineno">15251</span>            buflen += strlen(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>);</div>
<div class="line"><span class="lineno">15252</span>        }</div>
<div class="line"><span class="lineno">15253</span>        new_path = (<span class="keywordtype">char</span> *)<a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(buflen, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">15254</span>        <span class="keywordflow">if</span> (!new_path) {</div>
<div class="line"><span class="lineno">15255</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 500, <span class="stringliteral">&quot;out or memory&quot;</span>);</div>
<div class="line"><span class="lineno">15256</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15257</span>            <a class="code hl_function" href="#a81ef64a9ffadd917ddc7f4615cf5dc07">mg_get_request_link</a>(conn, new_path, buflen - 1);</div>
<div class="line"><span class="lineno">15258</span>            strcat(new_path, <span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><span class="lineno">15259</span>            <span class="keywordflow">if</span> (ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>) {</div>
<div class="line"><span class="lineno">15260</span>                <span class="comment">/* Append ? and query string */</span></div>
<div class="line"><span class="lineno">15261</span>                strcat(new_path, <span class="stringliteral">&quot;?&quot;</span>);</div>
<div class="line"><span class="lineno">15262</span>                strcat(new_path, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>);</div>
<div class="line"><span class="lineno">15263</span>            }</div>
<div class="line"><span class="lineno">15264</span>            <a class="code hl_function" href="#acbacd157c3e4a32ef99a0088a36e06af">mg_send_http_redirect</a>(conn, new_path, 301);</div>
<div class="line"><span class="lineno">15265</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(new_path);</div>
<div class="line"><span class="lineno">15266</span>        }</div>
<div class="line"><span class="lineno">15267</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s request to %s: directory redirection sent&quot;</span>,</div>
<div class="line"><span class="lineno">15268</span>                    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15269</span>                    path);</div>
<div class="line"><span class="lineno">15270</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15271</span>    }</div>
<div class="line"><span class="lineno">15272</span> </div>
<div class="line"><span class="lineno">15273</span>    <span class="comment">/* 13. Handle other methods than GET/HEAD */</span></div>
<div class="line"><span class="lineno">15274</span>    <span class="comment">/* 13.1. Handle PROPFIND */</span></div>
<div class="line"><span class="lineno">15275</span>    <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;PROPFIND&quot;</span>)) {</div>
<div class="line"><span class="lineno">15276</span>        <a class="code hl_function" href="#ab1110e733e9c841ff0a605fada90b638">handle_propfind</a>(conn, path, &amp;file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>);</div>
<div class="line"><span class="lineno">15277</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, path);</div>
<div class="line"><span class="lineno">15278</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15279</span>    }</div>
<div class="line"><span class="lineno">15280</span>    <span class="comment">/* 13.2. Handle OPTIONS for files */</span></div>
<div class="line"><span class="lineno">15281</span>    <span class="keywordflow">if</span> (!strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;OPTIONS&quot;</span>)) {</div>
<div class="line"><span class="lineno">15282</span>        <span class="comment">/* This standard handler is only used for real files.</span></div>
<div class="line"><span class="lineno">15283</span><span class="comment">         * Scripts should support the OPTIONS method themselves, to allow a</span></div>
<div class="line"><span class="lineno">15284</span><span class="comment">         * maximum flexibility.</span></div>
<div class="line"><span class="lineno">15285</span><span class="comment">         * Lua and CGI scripts may fully support CORS this way (including</span></div>
<div class="line"><span class="lineno">15286</span><span class="comment">         * preflights). */</span></div>
<div class="line"><span class="lineno">15287</span>        <a class="code hl_function" href="#a9646ac874ed82c23be670eba105c0d8f">send_options</a>(conn);</div>
<div class="line"><span class="lineno">15288</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, path);</div>
<div class="line"><span class="lineno">15289</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15290</span>    }</div>
<div class="line"><span class="lineno">15291</span>    <span class="comment">/* 13.3. everything but GET and HEAD (e.g. POST) */</span></div>
<div class="line"><span class="lineno">15292</span>    <span class="keywordflow">if</span> ((0 != strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;GET&quot;</span>))</div>
<div class="line"><span class="lineno">15293</span>        &amp;&amp; (0 != strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;HEAD&quot;</span>))) {</div>
<div class="line"><span class="lineno">15294</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">15295</span>                           405,</div>
<div class="line"><span class="lineno">15296</span>                           <span class="stringliteral">&quot;%s method not allowed&quot;</span>,</div>
<div class="line"><span class="lineno">15297</span>                           conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>);</div>
<div class="line"><span class="lineno">15298</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, path);</div>
<div class="line"><span class="lineno">15299</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15300</span>    }</div>
<div class="line"><span class="lineno">15301</span> </div>
<div class="line"><span class="lineno">15302</span>    <span class="comment">/* 14. directories */</span></div>
<div class="line"><span class="lineno">15303</span>    <span class="keywordflow">if</span> (file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a>) {</div>
<div class="line"><span class="lineno">15304</span>        <span class="comment">/* Substitute files have already been handled above. */</span></div>
<div class="line"><span class="lineno">15305</span>        <span class="comment">/* Here we can either generate and send a directory listing,</span></div>
<div class="line"><span class="lineno">15306</span><span class="comment">         * or send an &quot;access denied&quot; error. */</span></div>
<div class="line"><span class="lineno">15307</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba00459f3ca65ce96fa33c3d5230624328">ENABLE_DIRECTORY_LISTING</a>],</div>
<div class="line"><span class="lineno">15308</span>                           <span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><span class="lineno">15309</span>            <a class="code hl_function" href="#a7b85ac81c14209bfd8102abe7af190f7">handle_directory_request</a>(conn, path);</div>
<div class="line"><span class="lineno">15310</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15311</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">15312</span>                               403,</div>
<div class="line"><span class="lineno">15313</span>                               <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">15314</span>                               <span class="stringliteral">&quot;Error: Directory listing denied&quot;</span>);</div>
<div class="line"><span class="lineno">15315</span>        }</div>
<div class="line"><span class="lineno">15316</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done&quot;</span>, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, path);</div>
<div class="line"><span class="lineno">15317</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15318</span>    }</div>
<div class="line"><span class="lineno">15319</span> </div>
<div class="line"><span class="lineno">15320</span>    <span class="comment">/* 15. Files with search/replace patterns: LSP and SSI */</span></div>
<div class="line"><span class="lineno">15321</span>    <span class="keywordflow">if</span> (is_template_text_file) {</div>
<div class="line"><span class="lineno">15322</span>        <a class="code hl_define" href="#acda7cfeae2b1fbd50730709088e7da95">HTTP1_only</a>;</div>
<div class="line"><span class="lineno">15323</span>        <a class="code hl_function" href="#a4761bad9f703f9d51380597f4b1a694c">handle_file_based_request</a>(conn, path, &amp;file);</div>
<div class="line"><span class="lineno">15324</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done (template)&quot;</span>,</div>
<div class="line"><span class="lineno">15325</span>                    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15326</span>                    path);</div>
<div class="line"><span class="lineno">15327</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15328</span>    }</div>
<div class="line"><span class="lineno">15329</span> </div>
<div class="line"><span class="lineno">15330</span>    <span class="comment">/* 16. Static file - maybe cached */</span></div>
<div class="line"><span class="lineno">15331</span><span class="preprocessor">#if !defined(NO_CACHING)</span></div>
<div class="line"><span class="lineno">15332</span>    <span class="keywordflow">if</span> ((!conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac5ff30ba1c73afd0f9932c4dac17ea5a">in_error_handler</a>) &amp;&amp; <a class="code hl_function" href="#aa81530fc67a88c3191c00c52ec06065b">is_not_modified</a>(conn, &amp;file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>)) {</div>
<div class="line"><span class="lineno">15333</span>        <span class="comment">/* Send 304 &quot;Not Modified&quot; - this must not send any body data */</span></div>
<div class="line"><span class="lineno">15334</span>        <a class="code hl_function" href="#ae261fe366cffadac8da5a02c285b9653">handle_not_modified_static_file_request</a>(conn, &amp;file);</div>
<div class="line"><span class="lineno">15335</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done (not modified)&quot;</span>,</div>
<div class="line"><span class="lineno">15336</span>                    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15337</span>                    path);</div>
<div class="line"><span class="lineno">15338</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">15339</span>    }</div>
<div class="line"><span class="lineno">15340</span><span class="preprocessor">#endif </span><span class="comment">/* !NO_CACHING */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">15341</span> </div>
<div class="line"><span class="lineno">15342</span>    <span class="comment">/* 17. Static file - not cached */</span></div>
<div class="line"><span class="lineno">15343</span>    <a class="code hl_function" href="#a35e5540a0d567e223008b77b2bacb2d5">handle_static_file_request</a>(conn, path, &amp;file, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">15344</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;handling %s request to %s done (static)&quot;</span>,</div>
<div class="line"><span class="lineno">15345</span>                ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno">15346</span>                path);</div>
<div class="line"><span class="lineno">15347</span> </div>
<div class="line"><span class="lineno">15348</span><span class="preprocessor">#endif </span><span class="comment">/* !defined(NO_FILES) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">15349</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a01cd34a432a273eba4e48fb327503bc8"><div class="ttname"><a href="#a01cd34a432a273eba4e48fb327503bc8">is_authorized_for_put</a></div><div class="ttdeci">static int is_authorized_for_put(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09035">civetweb.c:9035</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a09229a33ae0eac77138714207fc46c14"><div class="ttname"><a href="#a09229a33ae0eac77138714207fc46c14">check_authorization</a></div><div class="ttdeci">static int check_authorization(struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08918">civetweb.c:8918</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a0a99e300d992194966483f9d6e77f214"><div class="ttname"><a href="#a0a99e300d992194966483f9d6e77f214">redirect_to_https_port</a></div><div class="ttdeci">static void redirect_to_https_port(struct mg_connection *conn, int port)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14235">civetweb.c:14235</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a188d397634e66f50df4a25eb2b46b6eb"><div class="ttname"><a href="#a188d397634e66f50df4a25eb2b46b6eb">put_file</a></div><div class="ttdeci">static void put_file(struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12158">civetweb.c:12158</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a2912c3ad9f0ba624b545a6f920ab5ddc"><div class="ttname"><a href="#a2912c3ad9f0ba624b545a6f920ab5ddc">delete_file</a></div><div class="ttdeci">static void delete_file(struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12293">civetweb.c:12293</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a367094998bdec220ff7ab52f60283dc2"><div class="ttname"><a href="#a367094998bdec220ff7ab52f60283dc2">dav_move_file</a></div><div class="ttdeci">static void dav_move_file(struct mg_connection *conn, const char *path, int do_copy)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11994">civetweb.c:11994</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a38c5f9290df5fe9727338a93493108f5"><div class="ttname"><a href="#a38c5f9290df5fe9727338a93493108f5">must_hide_file</a></div><div class="ttdeci">static int must_hide_file(struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09763">civetweb.c:9763</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a393a2d03d9209602b28629421b382841"><div class="ttname"><a href="#a393a2d03d9209602b28629421b382841">dav_proppatch</a></div><div class="ttdeci">static void dav_proppatch(struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12964">civetweb.c:12964</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a3e30365a0294614e545550653e71c809"><div class="ttname"><a href="#a3e30365a0294614e545550653e71c809">send_authorization_request</a></div><div class="ttdeci">static void send_authorization_request(struct mg_connection *conn, const char *realm)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08974">civetweb.c:8974</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a4761bad9f703f9d51380597f4b1a694c"><div class="ttname"><a href="#a4761bad9f703f9d51380597f4b1a694c">handle_file_based_request</a></div><div class="ttdeci">static void handle_file_based_request(struct mg_connection *conn, const char *path, struct mg_file *filep)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l15354">civetweb.c:15354</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a6b18e8f2e8a8ae569d9582857bcc7c19"><div class="ttname"><a href="#a6b18e8f2e8a8ae569d9582857bcc7c19">dav_lock_file</a></div><div class="ttdeci">static void dav_lock_file(struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12802">civetweb.c:12802</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a72d17299496dec4724fe359b9cc5fc50"><div class="ttname"><a href="#a72d17299496dec4724fe359b9cc5fc50">dav_unlock_file</a></div><div class="ttdeci">static void dav_unlock_file(struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12931">civetweb.c:12931</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a73891c07a6e6af73b5b247b460c62bb3"><div class="ttname"><a href="#a73891c07a6e6af73b5b247b460c62bb3">get_first_ssl_listener_index</a></div><div class="ttdeci">static int get_first_ssl_listener_index(const struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14121">civetweb.c:14121</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a7b85ac81c14209bfd8102abe7af190f7"><div class="ttname"><a href="#a7b85ac81c14209bfd8102abe7af190f7">handle_directory_request</a></div><div class="ttdeci">static void handle_directory_request(struct mg_connection *conn, const char *dir)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09942">civetweb.c:9942</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a84156e09ed2338602b0bda2a3734e1a4"><div class="ttname"><a href="#a84156e09ed2338602b0bda2a3734e1a4">set_throttle</a></div><div class="ttdeci">static int set_throttle(const char *spec, const union usa *rsa, const char *uri)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14075">civetweb.c:14075</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a8b35d4674db9acdc8b837dde56bcd94e"><div class="ttname"><a href="#a8b35d4674db9acdc8b837dde56bcd94e">suggest_connection_header</a></div><div class="ttdeci">static const char * suggest_connection_header(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04046">civetweb.c:4046</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a9646ac874ed82c23be670eba105c0d8f"><div class="ttname"><a href="#a9646ac874ed82c23be670eba105c0d8f">send_options</a></div><div class="ttdeci">static void send_options(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12632">civetweb.c:12632</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a96d08ddca4fe56dbb1647c8e250db9b3"><div class="ttname"><a href="#a96d08ddca4fe56dbb1647c8e250db9b3">release_handler_ref</a></div><div class="ttdeci">static void release_handler_ref(struct mg_connection *conn, struct mg_handler_info *handler_info)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14687">civetweb.c:14687</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ab1110e733e9c841ff0a605fada90b638"><div class="ttname"><a href="#ab1110e733e9c841ff0a605fada90b638">handle_propfind</a></div><div class="ttdeci">static void handle_propfind(struct mg_connection *conn, const char *path, struct mg_file_stat *filep)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12759">civetweb.c:12759</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ab1681f675e3235a77787a2a174e1f9a5"><div class="ttname"><a href="#ab1681f675e3235a77787a2a174e1f9a5">interpret_uri</a></div><div class="ttdeci">static void interpret_uri(struct mg_connection *conn, char *filename, size_t filename_buf_len, struct mg_file_stat *filestat, int *is_found, int *is_script_resource, int *is_websocket_request, int *is_put_or_delete_request, int *is_webdav_request, int *is_template_text)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07622">civetweb.c:7622</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ab8aa528da861495a7c5655dd89eaecb1"><div class="ttname"><a href="#ab8aa528da861495a7c5655dd89eaecb1">is_put_or_delete_method</a></div><div class="ttdeci">static int is_put_or_delete_method(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07464">civetweb.c:7464</a></div></div>
<div class="ttc" id="acivetweb_8c_html_abf278680b80623f1e661ef055c695533"><div class="ttname"><a href="#abf278680b80623f1e661ef055c695533">dav_mkcol</a></div><div class="ttdeci">static void dav_mkcol(struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l11915">civetweb.c:11915</a></div></div>
<div class="ttc" id="acivetweb_8c_html_abff1b1a2d706ca9cd15c954196418119"><div class="ttname"><a href="#abff1b1a2d706ca9cd15c954196418119">get_request_handler</a></div><div class="ttdeci">static int get_request_handler(struct mg_connection *conn, int handler_type, mg_request_handler *handler, struct mg_websocket_subprotocols **subprotocols, mg_websocket_connect_handler *connect_handler, mg_websocket_ready_handler *ready_handler, mg_websocket_data_handler *data_handler, mg_websocket_close_handler *close_handler, mg_authorization_handler *auth_handler, void **cbdata, struct mg_handler_info **handler_info)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14560">civetweb.c:14560</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac5091c315948383d6f29f90450b9e706"><div class="ttname"><a href="#ac5091c315948383d6f29f90450b9e706">should_decode_query_string</a></div><div class="ttdeci">static int should_decode_query_string(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04034">civetweb.c:4034</a></div></div>
<div class="ttc" id="acivetweb_8c_html_acb05505a49b6d5ba3733d63c7aabe8d4"><div class="ttname"><a href="#acb05505a49b6d5ba3733d63c7aabe8d4">should_decode_url</a></div><div class="ttdeci">static int should_decode_url(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04023">civetweb.c:4023</a></div></div>
<div class="ttc" id="acivetweb_8c_html_acbacd157c3e4a32ef99a0088a36e06af"><div class="ttname"><a href="#acbacd157c3e4a32ef99a0088a36e06af">mg_send_http_redirect</a></div><div class="ttdeci">CIVETWEB_API int mg_send_http_redirect(struct mg_connection *conn, const char *target_url, int redirect_code)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04618">civetweb.c:4618</a></div></div>
<div class="ttc" id="acivetweb_8c_html_acda7cfeae2b1fbd50730709088e7da95"><div class="ttname"><a href="#acda7cfeae2b1fbd50730709088e7da95">HTTP1_only</a></div><div class="ttdeci">#define HTTP1_only</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06609">civetweb.c:6609</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad9f9ef727b8c8a8ecb4c06b47aeb7d11"><div class="ttname"><a href="#ad9f9ef727b8c8a8ecb4c06b47aeb7d11">discard_unread_request_data</a></div><div class="ttdeci">static void discard_unread_request_data(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06484">civetweb.c:6484</a></div></div>
<div class="ttc" id="acivetweb_8c_html_affee01654ebda8d153ea3b7e7502f248"><div class="ttname"><a href="#affee01654ebda8d153ea3b7e7502f248">url_decode_in_place</a></div><div class="ttdeci">static void url_decode_in_place(char *buf)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07080">civetweb.c:7080</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a3e8733a4d6d7ae85f0daec45df36f024"><div class="ttname"><a href="civetweb_8h.html#a3e8733a4d6d7ae85f0daec45df36f024">mg_authorization_handler</a></div><div class="ttdeci">int(* mg_authorization_handler)(struct mg_connection *conn, void *cbdata)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00606">civetweb.h:606</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a5b940f052d5de72f651a9a1e810bed0f"><div class="ttname"><a href="civetweb_8h.html#a5b940f052d5de72f651a9a1e810bed0f">mg_websocket_ready_handler</a></div><div class="ttdeci">void(* mg_websocket_ready_handler)(struct mg_connection *, void *)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00549">civetweb.h:549</a></div></div>
<div class="ttc" id="acivetweb_8h_html_ac0e8e90ed1e8b0af95b9a940f6fee3a9"><div class="ttname"><a href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a></div><div class="ttdeci">int(* mg_websocket_data_handler)(struct mg_connection *, int, char *, size_t, void *)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00550">civetweb.h:550</a></div></div>
<div class="ttc" id="acivetweb_8h_html_ac452a63f6ff0d7fd18a143de72a7fd08"><div class="ttname"><a href="civetweb_8h.html#ac452a63f6ff0d7fd18a143de72a7fd08">mg_request_handler</a></div><div class="ttdeci">int(* mg_request_handler)(struct mg_connection *conn, void *cbdata)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00492">civetweb.h:492</a></div></div>
<div class="ttc" id="acivetweb_8h_html_ad7e7633a49e5a5e748b0c8bdb22c336d"><div class="ttname"><a href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a></div><div class="ttdeci">void(* mg_websocket_close_handler)(const struct mg_connection *, void *)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00555">civetweb.h:555</a></div></div>
<div class="ttc" id="acivetweb_8h_html_ae1e201a8ea4f6895a8cc4e2e2c58da03"><div class="ttname"><a href="civetweb_8h.html#ae1e201a8ea4f6895a8cc4e2e2c58da03">mg_websocket_connect_handler</a></div><div class="ttdeci">int(* mg_websocket_connect_handler)(const struct mg_connection *, void *)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00547">civetweb.h:547</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_aa9a778dfb6c14fdb615d9ef01cf5f6f2"><div class="ttname"><a href="structmg__callbacks.html#aa9a778dfb6c14fdb615d9ef01cf5f6f2">mg_callbacks::begin_request</a></div><div class="ttdeci">int(* begin_request)(struct mg_connection *)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00233">civetweb.h:233</a></div></div>
<div class="ttc" id="astructmg__connection_html_a1253d8e7156cefe37debd0c1aa2b3769"><div class="ttname"><a href="structmg__connection.html#a1253d8e7156cefe37debd0c1aa2b3769">mg_connection::throttle</a></div><div class="ttdeci">int throttle</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02560">civetweb.c:2560</a></div></div>
<div class="ttc" id="astructmg__connection_html_a161c1c775b5f3933f8428d4eb1381f52"><div class="ttname"><a href="structmg__connection.html#a161c1c775b5f3933f8428d4eb1381f52">mg_connection::request_state</a></div><div class="ttdeci">int request_state</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02488">civetweb.c:2488</a></div></div>
<div class="ttc" id="astructmg__context_html_a73a26dd1c9abead88b40b2d226ad9f28"><div class="ttname"><a href="structmg__context.html#a73a26dd1c9abead88b40b2d226ad9f28">mg_context::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02433">civetweb.c:2433</a></div></div>
<div class="ttc" id="astructmg__request__info_html_a5ae29523876fdcbb546165024dabc8c0"><div class="ttname"><a href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">mg_request_info::local_uri_raw</a></div><div class="ttdeci">const char * local_uri_raw</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00154">civetweb.h:154</a></div></div>
<div class="ttc" id="astructmg__request__info_html_a70b531b329bd93e4850c2544893fa9a8"><div class="ttname"><a href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">mg_request_info::request_method</a></div><div class="ttdeci">const char * request_method</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00151">civetweb.h:151</a></div></div>
<div class="ttc" id="astructmg__request__info_html_aca4128780e19e761cbcfe286021eefc9"><div class="ttname"><a href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">mg_request_info::request_uri</a></div><div class="ttdeci">const char * request_uri</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00152">civetweb.h:152</a></div></div>
<div class="ttc" id="astructmg__websocket__subprotocols_html"><div class="ttname"><a href="structmg__websocket__subprotocols.html">mg_websocket_subprotocols</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00562">civetweb.h:562</a></div></div>
<div class="ttc" id="astructmg__websocket__subprotocols_html_a0eacbb0bf0e500dd7a16845e2c35701f"><div class="ttname"><a href="structmg__websocket__subprotocols.html#a0eacbb0bf0e500dd7a16845e2c35701f">mg_websocket_subprotocols::subprotocols</a></div><div class="ttdeci">const char ** subprotocols</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00564">civetweb.h:564</a></div></div>
<div class="ttc" id="astructsocket_html_afe3a45fe832ca19cc85299b9a96d8feb"><div class="ttname"><a href="structsocket.html#afe3a45fe832ca19cc85299b9a96d8feb">socket::rsa</a></div><div class="ttdeci">union usa rsa</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01905">civetweb.c:1905</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02043">ACCESS_CONTROL_ALLOW_HEADERS</a>, <a class="el" href="civetweb_8c_source.html#l02042">ACCESS_CONTROL_ALLOW_METHODS</a>, <a class="el" href="civetweb_8c_source.html#l02041">ACCESS_CONTROL_ALLOW_ORIGIN</a>, <a class="el" href="civetweb_8c_source.html#l02225">AUTH_HANDLER</a>, <a class="el" href="civetweb_8h_source.html#l00233">mg_callbacks::begin_request</a>, <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>, <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l11915">dav_mkcol()</a>, <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l12964">dav_proppatch()</a>, <a class="el" href="civetweb_8c_source.html#l12931">dav_unlock_file()</a>, <a class="el" href="civetweb_8c_source.html#l00260">DEBUG_ASSERT</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l12293">delete_file()</a>, <a class="el" href="civetweb_8c_source.html#l06484">discard_unread_request_data()</a>, <a class="el" href="civetweb_8c_source.html#l01954">DOCUMENT_ROOT</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02002">ENABLE_DIRECTORY_LISTING</a>, <a class="el" href="civetweb_8c_source.html#l02003">ENABLE_WEBDAV</a>, <a class="el" href="civetweb_8c_source.html#l14121">get_first_ssl_listener_index()</a>, <a class="el" href="civetweb_8c_source.html#l03820">get_header()</a>, <a class="el" href="civetweb_8c_source.html#l14560">get_request_handler()</a>, <a class="el" href="civetweb_8c_source.html#l03341">gmt_time_string()</a>, <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l15354">handle_file_based_request()</a>, <a class="el" href="civetweb_8c_source.html#l10483">handle_not_modified_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l12759">handle_propfind()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l06609">HTTP1_only</a>, <a class="el" href="civetweb_8h_source.html#l00179">mg_request_info::http_headers</a>, <a class="el" href="civetweb_8c_source.html#l02537">mg_connection::in_error_handler</a>, <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>, <a class="el" href="civetweb_8c_source.html#l09035">is_authorized_for_put()</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l14645">is_in_script_path()</a>, <a class="el" href="civetweb_8c_source.html#l10468">is_not_modified()</a>, <a class="el" href="civetweb_8c_source.html#l07464">is_put_or_delete_method()</a>, <a class="el" href="civetweb_8c_source.html#l01906">socket::is_ssl</a>, <a class="el" href="civetweb_8c_source.html#l02356">mg_context::listening_sockets</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8h_source.html#l00154">mg_request_info::local_uri_raw</a>, <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l03745">mg_get_request_link()</a>, <a class="el" href="civetweb_8c_source.html#l01497">mg_malloc_ctx</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l04618">mg_send_http_redirect()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l03068">mg_strdup()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="civetweb_8c_source.html#l09763">must_hide_file()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00178">mg_request_info::num_headers</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, <a class="el" href="civetweb_8c_source.html#l02467">PROTOCOL_TYPE_WEBSOCKET</a>, <a class="el" href="civetweb_8c_source.html#l01997">PUT_DELETE_PASSWORDS_FILE</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, <a class="el" href="civetweb_8h_source.html#l00162">mg_request_info::query_string</a>, <a class="el" href="civetweb_8c_source.html#l14235">redirect_to_https_port()</a>, <a class="el" href="civetweb_8c_source.html#l14687">release_handler_ref()</a>, <a class="el" href="civetweb_8c_source.html#l08069">remove_dot_segments()</a>, <a class="el" href="civetweb_8c_source.html#l02225">REQUEST_HANDLER</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, <a class="el" href="civetweb_8c_source.html#l02488">mg_connection::request_state</a>, <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>, <a class="el" href="civetweb_8c_source.html#l01905">socket::rsa</a>, <a class="el" href="civetweb_8c_source.html#l08974">send_authorization_request()</a>, <a class="el" href="civetweb_8c_source.html#l12632">send_options()</a>, <a class="el" href="civetweb_8c_source.html#l14075">set_throttle()</a>, <a class="el" href="civetweb_8c_source.html#l04034">should_decode_query_string()</a>, <a class="el" href="civetweb_8c_source.html#l04023">should_decode_url()</a>, <a class="el" href="civetweb_8c_source.html#l01907">socket::ssl_redir</a>, <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>, <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>, <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>, <a class="el" href="civetweb_8h_source.html#l00564">mg_websocket_subprotocols::subprotocols</a>, <a class="el" href="civetweb_8c_source.html#l04046">suggest_connection_header()</a>, <a class="el" href="civetweb_8c_source.html#l01935">THROTTLE</a>, <a class="el" href="civetweb_8c_source.html#l02560">mg_connection::throttle</a>, <a class="el" href="civetweb_8c_source.html#l07080">url_decode_in_place()</a>, <a class="el" href="civetweb_8c_source.html#l01860">USA_IN_PORT_UNSAFE</a>, <a class="el" href="civetweb_8c_source.html#l02433">mg_context::user_data</a>, <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>, and <a class="el" href="civetweb_8c_source.html#l02225">WEBSOCKET_HANDLER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06562">handle_request_stat_log()</a>.</p>

</div>
</div>
<a id="ade0a4f4deaa6ce8cf91dcf0921cfde1d" name="ade0a4f4deaa6ce8cf91dcf0921cfde1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade0a4f4deaa6ce8cf91dcf0921cfde1d">&#9670;&#160;</a></span>handle_request_stat_log()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_request_stat_log </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06562">6562</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6563</span>{</div>
<div class="line"><span class="lineno"> 6564</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno"> 6565</span>    <span class="keyword">struct </span>timespec tnow;</div>
<div class="line"><span class="lineno"> 6566</span>    conn-&gt;conn_state = 4; <span class="comment">/* processing */</span></div>
<div class="line"><span class="lineno"> 6567</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 6568</span> </div>
<div class="line"><span class="lineno"> 6569</span>    <a class="code hl_function" href="#ad59c266c5a9c359d128e8151c602ef31">handle_request</a>(conn);</div>
<div class="line"><span class="lineno"> 6570</span> </div>
<div class="line"><span class="lineno"> 6571</span> </div>
<div class="line"><span class="lineno"> 6572</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno"> 6573</span>    conn-&gt;conn_state = 5; <span class="comment">/* processed */</span></div>
<div class="line"><span class="lineno"> 6574</span> </div>
<div class="line"><span class="lineno"> 6575</span>    clock_gettime(CLOCK_MONOTONIC, &amp;tnow);</div>
<div class="line"><span class="lineno"> 6576</span>    conn-&gt;processing_time = <a class="code hl_function" href="#ac54e1770467596ef9b50e658a2672a6c">mg_difftimespec</a>(&amp;tnow, &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a1b122ac1a6e7d536f2b0c8e8b94cdf26">req_time</a>));</div>
<div class="line"><span class="lineno"> 6577</span> </div>
<div class="line"><span class="lineno"> 6578</span>    mg_atomic_add64(&amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;total_data_read), conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a>);</div>
<div class="line"><span class="lineno"> 6579</span>    mg_atomic_add64(&amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;total_data_written),</div>
<div class="line"><span class="lineno"> 6580</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a482f3e0e76b5e4b885c971ab232f7653">num_bytes_sent</a>);</div>
<div class="line"><span class="lineno"> 6581</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 6582</span> </div>
<div class="line"><span class="lineno"> 6583</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;handle_request done&quot;</span>);</div>
<div class="line"><span class="lineno"> 6584</span> </div>
<div class="line"><span class="lineno"> 6585</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a6c181367bf4fda47db688433d036654a">end_request</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6586</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a6c181367bf4fda47db688433d036654a">end_request</a>(conn, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a>);</div>
<div class="line"><span class="lineno"> 6587</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;end_request callback done&quot;</span>);</div>
<div class="line"><span class="lineno"> 6588</span>    }</div>
<div class="line"><span class="lineno"> 6589</span>    <a class="code hl_function" href="#a395e0410a86d3aa491b7efe4d081a60e">log_access</a>(conn);</div>
<div class="line"><span class="lineno"> 6590</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a395e0410a86d3aa491b7efe4d081a60e"><div class="ttname"><a href="#a395e0410a86d3aa491b7efe4d081a60e">log_access</a></div><div class="ttdeci">static void log_access(const struct mg_connection *)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16063">civetweb.c:16063</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac54e1770467596ef9b50e658a2672a6c"><div class="ttname"><a href="#ac54e1770467596ef9b50e658a2672a6c">mg_difftimespec</a></div><div class="ttdeci">static double mg_difftimespec(const struct timespec *ts_now, const struct timespec *ts_before)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03364">civetweb.c:3364</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad59c266c5a9c359d128e8151c602ef31"><div class="ttname"><a href="#ad59c266c5a9c359d128e8151c602ef31">handle_request</a></div><div class="ttdeci">static void handle_request(struct mg_connection *)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14704">civetweb.c:14704</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_a6c181367bf4fda47db688433d036654a"><div class="ttname"><a href="structmg__callbacks.html#a6c181367bf4fda47db688433d036654a">mg_callbacks::end_request</a></div><div class="ttdeci">void(* end_request)(const struct mg_connection *, int reply_status_code)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00236">civetweb.h:236</a></div></div>
<div class="ttc" id="astructmg__connection_html_a482f3e0e76b5e4b885c971ab232f7653"><div class="ttname"><a href="structmg__connection.html#a482f3e0e76b5e4b885c971ab232f7653">mg_connection::num_bytes_sent</a></div><div class="ttdeci">int64_t num_bytes_sent</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02517">civetweb.c:2517</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02524">mg_connection::consumed_content</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8h_source.html#l00236">mg_callbacks::end_request</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>, <a class="el" href="civetweb_8c_source.html#l03364">mg_difftimespec()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02517">mg_connection::num_bytes_sent</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02515">mg_connection::req_time</a>, and <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>.</p>

</div>
</div>
<a id="a81cf575b8d68d30c6e590015d8fe99ea" name="a81cf575b8d68d30c6e590015d8fe99ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81cf575b8d68d30c6e590015d8fe99ea">&#9670;&#160;</a></span>handle_ssi_file_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_ssi_file_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12588">12588</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12591</span>{</div>
<div class="line"><span class="lineno">12592</span>    <span class="keywordtype">char</span> date[64];</div>
<div class="line"><span class="lineno">12593</span>    time_t curtime = time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">12594</span> </div>
<div class="line"><span class="lineno">12595</span>    <span class="keywordflow">if</span> ((conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (path == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (filep == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">12596</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12597</span>    }</div>
<div class="line"><span class="lineno">12598</span> </div>
<div class="line"><span class="lineno">12599</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, path, <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>, filep)) {</div>
<div class="line"><span class="lineno">12600</span>        <span class="comment">/* File exists (precondition for calling this function),</span></div>
<div class="line"><span class="lineno">12601</span><span class="comment">         * but can not be opened by the server. */</span></div>
<div class="line"><span class="lineno">12602</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">12603</span>                           500,</div>
<div class="line"><span class="lineno">12604</span>                           <span class="stringliteral">&quot;Error: Cannot read file\nfopen(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno">12605</span>                           path,</div>
<div class="line"><span class="lineno">12606</span>                           strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">12607</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12608</span>        <span class="comment">/* Set &quot;must_close&quot; for HTTP/1.x, since we do not know the</span></div>
<div class="line"><span class="lineno">12609</span><span class="comment">         * content length */</span></div>
<div class="line"><span class="lineno">12610</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">12611</span>        <a class="code hl_function" href="#a7ef6ebce89c81f7218a0968e3aa9107f">gmt_time_string</a>(date, <span class="keyword">sizeof</span>(date), &amp;curtime);</div>
<div class="line"><span class="lineno">12612</span>        <a class="code hl_function" href="#a66af55875eb933f2969b8bed72ab9ef4">fclose_on_exec</a>(&amp;filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>, conn);</div>
<div class="line"><span class="lineno">12613</span> </div>
<div class="line"><span class="lineno">12614</span>        <span class="comment">/* 200 OK response */</span></div>
<div class="line"><span class="lineno">12615</span>        <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 200);</div>
<div class="line"><span class="lineno">12616</span>        <a class="code hl_function" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a>(conn);</div>
<div class="line"><span class="lineno">12617</span>        <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">12618</span>        <a class="code hl_function" href="#acce3a614f601b06f0120faad9421e25f">send_cors_header</a>(conn);</div>
<div class="line"><span class="lineno">12619</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Type&quot;</span>, <span class="stringliteral">&quot;text/html&quot;</span>, -1);</div>
<div class="line"><span class="lineno">12620</span>        <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">12621</span> </div>
<div class="line"><span class="lineno">12622</span>        <span class="comment">/* Header sent, now send body */</span></div>
<div class="line"><span class="lineno">12623</span>        <a class="code hl_function" href="#abbfd2afe32d71961fea011337ee6e2b1">send_ssi_file</a>(conn, path, filep, 0);</div>
<div class="line"><span class="lineno">12624</span>        (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>); <span class="comment">/* Ignore errors for readonly files */</span></div>
<div class="line"><span class="lineno">12625</span>    }</div>
<div class="line"><span class="lineno">12626</span>}</div>
<div class="ttc" id="acivetweb_8c_html_acce3a614f601b06f0120faad9421e25f"><div class="ttname"><a href="#acce3a614f601b06f0120faad9421e25f">send_cors_header</a></div><div class="ttdeci">static void send_cors_header(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04149">civetweb.c:4149</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l10196">fclose_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l03341">gmt_time_string()</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02843">MG_FOPEN_MODE_READ</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04149">send_cors_header()</a>, <a class="el" href="civetweb_8c_source.html#l04056">send_no_cache_header()</a>, and <a class="el" href="civetweb_8c_source.html#l12482">send_ssi_file()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l15354">handle_file_based_request()</a>.</p>

</div>
</div>
<a id="a35e5540a0d567e223008b77b2bacb2d5" name="a35e5540a0d567e223008b77b2bacb2d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35e5540a0d567e223008b77b2bacb2d5">&#9670;&#160;</a></span>handle_static_file_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_static_file_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>mime_type</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>additional_headers</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10220">10220</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10225</span>{</div>
<div class="line"><span class="lineno">10226</span>    <span class="keywordtype">char</span> lm[64], etag[64];</div>
<div class="line"><span class="lineno">10227</span>    <span class="keywordtype">char</span> range[128]; <span class="comment">/* large enough, so there will be no overflow */</span></div>
<div class="line"><span class="lineno">10228</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *range_hdr;</div>
<div class="line"><span class="lineno">10229</span>    int64_t cl, r1, r2;</div>
<div class="line"><span class="lineno">10230</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> mime_vec;</div>
<div class="line"><span class="lineno">10231</span>    <span class="keywordtype">int</span> n, truncated;</div>
<div class="line"><span class="lineno">10232</span>    <span class="keywordtype">char</span> gz_path[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>];</div>
<div class="line"><span class="lineno">10233</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *encoding = 0;</div>
<div class="line"><span class="lineno">10234</span>    <span class="keywordtype">int</span> is_head_request;</div>
<div class="line"><span class="lineno">10235</span> </div>
<div class="line"><span class="lineno">10236</span><span class="preprocessor">#if defined(USE_ZLIB)</span></div>
<div class="line"><span class="lineno">10237</span>    <span class="comment">/* Compression is allowed, unless there is a reason not to use</span></div>
<div class="line"><span class="lineno">10238</span><span class="comment">     * compression. If the file is already compressed, too small or a</span></div>
<div class="line"><span class="lineno">10239</span><span class="comment">     * &quot;range&quot; request was made, on the fly compression is not possible. */</span></div>
<div class="line"><span class="lineno">10240</span>    <span class="keywordtype">int</span> allow_on_the_fly_compression = 1;</div>
<div class="line"><span class="lineno">10241</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">10242</span> </div>
<div class="line"><span class="lineno">10243</span>    <span class="keywordflow">if</span> ((conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (filep == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">10244</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">10245</span>    }</div>
<div class="line"><span class="lineno">10246</span> </div>
<div class="line"><span class="lineno">10247</span>    is_head_request = !strcmp(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;HEAD&quot;</span>);</div>
<div class="line"><span class="lineno">10248</span> </div>
<div class="line"><span class="lineno">10249</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">10250</span>        <a class="code hl_function" href="#a9ed08e2cbee6ec8aa43739359b3a0937">get_mime_type</a>(conn, path, &amp;mime_vec);</div>
<div class="line"><span class="lineno">10251</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">10252</span>        mime_vec.ptr = <a class="code hl_variable" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a>;</div>
<div class="line"><span class="lineno">10253</span>        mime_vec.len = strlen(<a class="code hl_variable" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a>);</div>
<div class="line"><span class="lineno">10254</span>    }</div>
<div class="line"><span class="lineno">10255</span>    <span class="keywordflow">if</span> (filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> &gt; <a class="code hl_define" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a>) {</div>
<div class="line"><span class="lineno">10256</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">10257</span>                           500,</div>
<div class="line"><span class="lineno">10258</span>                           <span class="stringliteral">&quot;Error: File size is too large to send\n%&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a>,</div>
<div class="line"><span class="lineno">10259</span>                           filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a>);</div>
<div class="line"><span class="lineno">10260</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">10261</span>    }</div>
<div class="line"><span class="lineno">10262</span>    cl = (int64_t)filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a>;</div>
<div class="line"><span class="lineno">10263</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 200;</div>
<div class="line"><span class="lineno">10264</span>    range[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">10265</span> </div>
<div class="line"><span class="lineno">10266</span><span class="preprocessor">#if defined(USE_ZLIB)</span></div>
<div class="line"><span class="lineno">10267</span>    <span class="comment">/* if this file is in fact a pre-gzipped file, rewrite its filename</span></div>
<div class="line"><span class="lineno">10268</span><span class="comment">     * it&#39;s important to rewrite the filename after resolving</span></div>
<div class="line"><span class="lineno">10269</span><span class="comment">     * the mime type from it, to preserve the actual file&#39;s type */</span></div>
<div class="line"><span class="lineno">10270</span>    <span class="keywordflow">if</span> (!conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa0fc1462c76f9504a16825147b8db3d1">accept_gzip</a>) {</div>
<div class="line"><span class="lineno">10271</span>        allow_on_the_fly_compression = 0;</div>
<div class="line"><span class="lineno">10272</span>    }</div>
<div class="line"><span class="lineno">10273</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">10274</span> </div>
<div class="line"><span class="lineno">10275</span>    <span class="comment">/* Check if there is a range header */</span></div>
<div class="line"><span class="lineno">10276</span>    range_hdr = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Range&quot;</span>);</div>
<div class="line"><span class="lineno">10277</span> </div>
<div class="line"><span class="lineno">10278</span>    <span class="comment">/* For gzipped files, add *.gz */</span></div>
<div class="line"><span class="lineno">10279</span>    <span class="keywordflow">if</span> (filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#ad44111c877cb3ec536731c125b4589ef">is_gzipped</a>) {</div>
<div class="line"><span class="lineno">10280</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn, &amp;truncated, gz_path, <span class="keyword">sizeof</span>(gz_path), <span class="stringliteral">&quot;%s.gz&quot;</span>, path);</div>
<div class="line"><span class="lineno">10281</span> </div>
<div class="line"><span class="lineno">10282</span>        <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno">10283</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">10284</span>                               500,</div>
<div class="line"><span class="lineno">10285</span>                               <span class="stringliteral">&quot;Error: Path of zipped file too long (%s)&quot;</span>,</div>
<div class="line"><span class="lineno">10286</span>                               path);</div>
<div class="line"><span class="lineno">10287</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">10288</span>        }</div>
<div class="line"><span class="lineno">10289</span> </div>
<div class="line"><span class="lineno">10290</span>        path = gz_path;</div>
<div class="line"><span class="lineno">10291</span>        encoding = <span class="stringliteral">&quot;gzip&quot;</span>;</div>
<div class="line"><span class="lineno">10292</span> </div>
<div class="line"><span class="lineno">10293</span><span class="preprocessor">#if defined(USE_ZLIB)</span></div>
<div class="line"><span class="lineno">10294</span>        <span class="comment">/* File is already compressed. No &quot;on the fly&quot; compression. */</span></div>
<div class="line"><span class="lineno">10295</span>        allow_on_the_fly_compression = 0;</div>
<div class="line"><span class="lineno">10296</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">10297</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa0fc1462c76f9504a16825147b8db3d1">accept_gzip</a>) &amp;&amp; (range_hdr == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">10298</span>               &amp;&amp; (filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> &gt;= <a class="code hl_define" href="#a58e208228ea8cec229167dac0e1d1d84">MG_FILE_COMPRESSION_SIZE_LIMIT</a>)) {</div>
<div class="line"><span class="lineno">10299</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file__stat.html">mg_file_stat</a> file_stat;</div>
<div class="line"><span class="lineno">10300</span> </div>
<div class="line"><span class="lineno">10301</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn, &amp;truncated, gz_path, <span class="keyword">sizeof</span>(gz_path), <span class="stringliteral">&quot;%s.gz&quot;</span>, path);</div>
<div class="line"><span class="lineno">10302</span> </div>
<div class="line"><span class="lineno">10303</span>        <span class="keywordflow">if</span> (!truncated &amp;&amp; <a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, gz_path, &amp;file_stat)</div>
<div class="line"><span class="lineno">10304</span>            &amp;&amp; !file_stat.is_directory) {</div>
<div class="line"><span class="lineno">10305</span>            file_stat.is_gzipped = 1;</div>
<div class="line"><span class="lineno">10306</span>            filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a> = file_stat;</div>
<div class="line"><span class="lineno">10307</span>            cl = (int64_t)filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a>;</div>
<div class="line"><span class="lineno">10308</span>            path = gz_path;</div>
<div class="line"><span class="lineno">10309</span>            encoding = <span class="stringliteral">&quot;gzip&quot;</span>;</div>
<div class="line"><span class="lineno">10310</span> </div>
<div class="line"><span class="lineno">10311</span><span class="preprocessor">#if defined(USE_ZLIB)</span></div>
<div class="line"><span class="lineno">10312</span>            <span class="comment">/* File is already compressed. No &quot;on the fly&quot; compression. */</span></div>
<div class="line"><span class="lineno">10313</span>            allow_on_the_fly_compression = 0;</div>
<div class="line"><span class="lineno">10314</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">10315</span>        }</div>
<div class="line"><span class="lineno">10316</span>    }</div>
<div class="line"><span class="lineno">10317</span> </div>
<div class="line"><span class="lineno">10318</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, path, <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>, filep)) {</div>
<div class="line"><span class="lineno">10319</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">10320</span>                           500,</div>
<div class="line"><span class="lineno">10321</span>                           <span class="stringliteral">&quot;Error: Cannot open file\nfopen(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno">10322</span>                           path,</div>
<div class="line"><span class="lineno">10323</span>                           strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">10324</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">10325</span>    }</div>
<div class="line"><span class="lineno">10326</span> </div>
<div class="line"><span class="lineno">10327</span>    <a class="code hl_function" href="#a66af55875eb933f2969b8bed72ab9ef4">fclose_on_exec</a>(&amp;filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>, conn);</div>
<div class="line"><span class="lineno">10328</span> </div>
<div class="line"><span class="lineno">10329</span>    <span class="comment">/* If &quot;Range&quot; request was made: parse header, send only selected part</span></div>
<div class="line"><span class="lineno">10330</span><span class="comment">     * of the file. */</span></div>
<div class="line"><span class="lineno">10331</span>    r1 = r2 = 0;</div>
<div class="line"><span class="lineno">10332</span>    <span class="keywordflow">if</span> ((range_hdr != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">10333</span>        &amp;&amp; ((n = <a class="code hl_function" href="#a96d4fe5a4a9ff4b964325c9d31c4b6c9">parse_range_header</a>(range_hdr, &amp;r1, &amp;r2)) &gt; 0) &amp;&amp; (r1 &gt;= 0)</div>
<div class="line"><span class="lineno">10334</span>        &amp;&amp; (r2 &gt;= 0)) {</div>
<div class="line"><span class="lineno">10335</span>        <span class="comment">/* actually, range requests don&#39;t play well with a pre-gzipped</span></div>
<div class="line"><span class="lineno">10336</span><span class="comment">         * file (since the range is specified in the uncompressed space) */</span></div>
<div class="line"><span class="lineno">10337</span>        <span class="keywordflow">if</span> (filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#ad44111c877cb3ec536731c125b4589ef">is_gzipped</a>) {</div>
<div class="line"><span class="lineno">10338</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(</div>
<div class="line"><span class="lineno">10339</span>                conn,</div>
<div class="line"><span class="lineno">10340</span>                416, <span class="comment">/* 416 = Range Not Satisfiable */</span></div>
<div class="line"><span class="lineno">10341</span>                <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">10342</span>                <span class="stringliteral">&quot;Error: Range requests in gzipped files are not supported&quot;</span>);</div>
<div class="line"><span class="lineno">10343</span>            (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(</div>
<div class="line"><span class="lineno">10344</span>                &amp;filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>); <span class="comment">/* ignore error on read only file */</span></div>
<div class="line"><span class="lineno">10345</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">10346</span>        }</div>
<div class="line"><span class="lineno">10347</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 206;</div>
<div class="line"><span class="lineno">10348</span>        cl = (n == 2) ? (((r2 &gt; cl) ? cl : r2) - r1 + 1) : (cl - r1);</div>
<div class="line"><span class="lineno">10349</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">10350</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* range buffer is big enough */</span></div>
<div class="line"><span class="lineno">10351</span>                    range,</div>
<div class="line"><span class="lineno">10352</span>                    <span class="keyword">sizeof</span>(range),</div>
<div class="line"><span class="lineno">10353</span>                    <span class="stringliteral">&quot;bytes &quot;</span></div>
<div class="line"><span class="lineno">10354</span>                    <span class="stringliteral">&quot;%&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a> <span class="stringliteral">&quot;-%&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a> <span class="stringliteral">&quot;/%&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a>,</div>
<div class="line"><span class="lineno">10355</span>                    r1,</div>
<div class="line"><span class="lineno">10356</span>                    r1 + cl - 1,</div>
<div class="line"><span class="lineno">10357</span>                    filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a>);</div>
<div class="line"><span class="lineno">10358</span> </div>
<div class="line"><span class="lineno">10359</span><span class="preprocessor">#if defined(USE_ZLIB)</span></div>
<div class="line"><span class="lineno">10360</span>        <span class="comment">/* Do not compress ranges. */</span></div>
<div class="line"><span class="lineno">10361</span>        allow_on_the_fly_compression = 0;</div>
<div class="line"><span class="lineno">10362</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">10363</span>    }</div>
<div class="line"><span class="lineno">10364</span> </div>
<div class="line"><span class="lineno">10365</span>    <span class="comment">/* Do not compress small files. Small files do not benefit from file</span></div>
<div class="line"><span class="lineno">10366</span><span class="comment">     * compression, but there is still some overhead. */</span></div>
<div class="line"><span class="lineno">10367</span><span class="preprocessor">#if defined(USE_ZLIB)</span></div>
<div class="line"><span class="lineno">10368</span>    <span class="keywordflow">if</span> (filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> &lt; <a class="code hl_define" href="#a58e208228ea8cec229167dac0e1d1d84">MG_FILE_COMPRESSION_SIZE_LIMIT</a>) {</div>
<div class="line"><span class="lineno">10369</span>        <span class="comment">/* File is below the size limit. */</span></div>
<div class="line"><span class="lineno">10370</span>        allow_on_the_fly_compression = 0;</div>
<div class="line"><span class="lineno">10371</span>    }</div>
<div class="line"><span class="lineno">10372</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">10373</span> </div>
<div class="line"><span class="lineno">10374</span>    <span class="comment">/* Prepare Etag, and Last-Modified headers. */</span></div>
<div class="line"><span class="lineno">10375</span>    <a class="code hl_function" href="#a7ef6ebce89c81f7218a0968e3aa9107f">gmt_time_string</a>(lm, <span class="keyword">sizeof</span>(lm), &amp;filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#aa767e15073ca34ce0bd9fdcfe05e6ddc">last_modified</a>);</div>
<div class="line"><span class="lineno">10376</span>    <a class="code hl_function" href="#ac715f770ccb10deba796a43cb10cfd46">construct_etag</a>(etag, <span class="keyword">sizeof</span>(etag), &amp;filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>);</div>
<div class="line"><span class="lineno">10377</span> </div>
<div class="line"><span class="lineno">10378</span>    <span class="comment">/* Create 2xx (200, 206) response */</span></div>
<div class="line"><span class="lineno">10379</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a>);</div>
<div class="line"><span class="lineno">10380</span>    <a class="code hl_function" href="#a229f03c60c42b8f390449a8e1324f22f">send_static_cache_header</a>(conn);</div>
<div class="line"><span class="lineno">10381</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">10382</span>    <a class="code hl_function" href="#acce3a614f601b06f0120faad9421e25f">send_cors_header</a>(conn);</div>
<div class="line"><span class="lineno">10383</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn,</div>
<div class="line"><span class="lineno">10384</span>                           <span class="stringliteral">&quot;Content-Type&quot;</span>,</div>
<div class="line"><span class="lineno">10385</span>                           mime_vec.ptr,</div>
<div class="line"><span class="lineno">10386</span>                           (<span class="keywordtype">int</span>)mime_vec.len);</div>
<div class="line"><span class="lineno">10387</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Last-Modified&quot;</span>, lm, -1);</div>
<div class="line"><span class="lineno">10388</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Etag&quot;</span>, etag, -1);</div>
<div class="line"><span class="lineno">10389</span> </div>
<div class="line"><span class="lineno">10390</span><span class="preprocessor">#if defined(USE_ZLIB)</span></div>
<div class="line"><span class="lineno">10391</span>    <span class="comment">/* On the fly compression allowed */</span></div>
<div class="line"><span class="lineno">10392</span>    <span class="keywordflow">if</span> (allow_on_the_fly_compression) {</div>
<div class="line"><span class="lineno">10393</span>        <span class="comment">/* For on the fly compression, we don&#39;t know the content size in</span></div>
<div class="line"><span class="lineno">10394</span><span class="comment">         * advance, so we have to use chunked encoding */</span></div>
<div class="line"><span class="lineno">10395</span>        encoding = <span class="stringliteral">&quot;gzip&quot;</span>;</div>
<div class="line"><span class="lineno">10396</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a>) {</div>
<div class="line"><span class="lineno">10397</span>            <span class="comment">/* HTTP/2 is always using &quot;chunks&quot; (frames) */</span></div>
<div class="line"><span class="lineno">10398</span>            <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Transfer-Encoding&quot;</span>, <span class="stringliteral">&quot;chunked&quot;</span>, -1);</div>
<div class="line"><span class="lineno">10399</span>        }</div>
<div class="line"><span class="lineno">10400</span> </div>
<div class="line"><span class="lineno">10401</span>    } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">10402</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">10403</span>    {</div>
<div class="line"><span class="lineno">10404</span>        <span class="comment">/* Without on-the-fly compression, we know the content-length</span></div>
<div class="line"><span class="lineno">10405</span><span class="comment">         * and we can use ranges (with on-the-fly compression we cannot).</span></div>
<div class="line"><span class="lineno">10406</span><span class="comment">         * So we send these response headers only in this case. */</span></div>
<div class="line"><span class="lineno">10407</span>        <span class="keywordtype">char</span> len[32];</div>
<div class="line"><span class="lineno">10408</span>        <span class="keywordtype">int</span> trunc = 0;</div>
<div class="line"><span class="lineno">10409</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn, &amp;trunc, len, <span class="keyword">sizeof</span>(len), <span class="stringliteral">&quot;%&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a>, cl);</div>
<div class="line"><span class="lineno">10410</span> </div>
<div class="line"><span class="lineno">10411</span>        <span class="keywordflow">if</span> (!trunc) {</div>
<div class="line"><span class="lineno">10412</span>            <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>, len, -1);</div>
<div class="line"><span class="lineno">10413</span>        }</div>
<div class="line"><span class="lineno">10414</span> </div>
<div class="line"><span class="lineno">10415</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Accept-Ranges&quot;</span>, <span class="stringliteral">&quot;bytes&quot;</span>, -1);</div>
<div class="line"><span class="lineno">10416</span>    }</div>
<div class="line"><span class="lineno">10417</span> </div>
<div class="line"><span class="lineno">10418</span>    <span class="keywordflow">if</span> (encoding) {</div>
<div class="line"><span class="lineno">10419</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Encoding&quot;</span>, encoding, -1);</div>
<div class="line"><span class="lineno">10420</span>    }</div>
<div class="line"><span class="lineno">10421</span>    <span class="keywordflow">if</span> (range[0] != 0) {</div>
<div class="line"><span class="lineno">10422</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Range&quot;</span>, range, -1);</div>
<div class="line"><span class="lineno">10423</span>    }</div>
<div class="line"><span class="lineno">10424</span> </div>
<div class="line"><span class="lineno">10425</span>    <span class="comment">/* The code above does not add any header starting with X- to make</span></div>
<div class="line"><span class="lineno">10426</span><span class="comment">     * sure no one of the additional_headers is included twice */</span></div>
<div class="line"><span class="lineno">10427</span>    <span class="keywordflow">if</span> ((additional_headers != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (*additional_headers != 0)) {</div>
<div class="line"><span class="lineno">10428</span>        <a class="code hl_function" href="civetweb_8h.html#af2fea4b4a82311588a9914b6d8491661">mg_response_header_add_lines</a>(conn, additional_headers);</div>
<div class="line"><span class="lineno">10429</span>    }</div>
<div class="line"><span class="lineno">10430</span> </div>
<div class="line"><span class="lineno">10431</span>    <span class="comment">/* Send all headers */</span></div>
<div class="line"><span class="lineno">10432</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">10433</span> </div>
<div class="line"><span class="lineno">10434</span>    <span class="keywordflow">if</span> (!is_head_request) {</div>
<div class="line"><span class="lineno">10435</span><span class="preprocessor">#if defined(USE_ZLIB)</span></div>
<div class="line"><span class="lineno">10436</span>        <span class="keywordflow">if</span> (allow_on_the_fly_compression) {</div>
<div class="line"><span class="lineno">10437</span>            <span class="comment">/* Compress and send */</span></div>
<div class="line"><span class="lineno">10438</span>            send_compressed_data(conn, filep);</div>
<div class="line"><span class="lineno">10439</span>        } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">10440</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">10441</span>        {</div>
<div class="line"><span class="lineno">10442</span>            <span class="comment">/* Send file directly */</span></div>
<div class="line"><span class="lineno">10443</span>            <a class="code hl_function" href="#a528545b68103ca8848caaea2c5316ec2">send_file_data</a>(conn, filep, r1, cl, 0); <span class="comment">/* send static file */</span></div>
<div class="line"><span class="lineno">10444</span>        }</div>
<div class="line"><span class="lineno">10445</span>    }</div>
<div class="line"><span class="lineno">10446</span>    (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>); <span class="comment">/* ignore error on read only file */</span></div>
<div class="line"><span class="lineno">10447</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a12139285594e136f3f40ec07d2fdc5c5"><div class="ttname"><a href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a></div><div class="ttdeci">const char * mime_type</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08224">civetweb.c:8224</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a58e208228ea8cec229167dac0e1d1d84"><div class="ttname"><a href="#a58e208228ea8cec229167dac0e1d1d84">MG_FILE_COMPRESSION_SIZE_LIMIT</a></div><div class="ttdeci">#define MG_FILE_COMPRESSION_SIZE_LIMIT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00478">civetweb.c:478</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a96d4fe5a4a9ff4b964325c9d31c4b6c9"><div class="ttname"><a href="#a96d4fe5a4a9ff4b964325c9d31c4b6c9">parse_range_header</a></div><div class="ttdeci">static int parse_range_header(const char *header, int64_t *a, int64_t *b)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10169">civetweb.c:10169</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a9ed08e2cbee6ec8aa43739359b3a0937"><div class="ttname"><a href="#a9ed08e2cbee6ec8aa43739359b3a0937">get_mime_type</a></div><div class="ttdeci">static void get_mime_type(struct mg_connection *conn, const char *path, struct vec *vec)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08354">civetweb.c:8354</a></div></div>
<div class="ttc" id="acivetweb_8h_html_af2fea4b4a82311588a9914b6d8491661"><div class="ttname"><a href="civetweb_8h.html#af2fea4b4a82311588a9914b6d8491661">mg_response_header_add_lines</a></div><div class="ttdeci">CIVETWEB_API int mg_response_header_add_lines(struct mg_connection *conn, const char *http1_headers)</div></div>
<div class="ttc" id="astructmg__file__stat_html_ad44111c877cb3ec536731c125b4589ef"><div class="ttname"><a href="structmg__file__stat.html#ad44111c877cb3ec536731c125b4589ef">mg_file_stat::is_gzipped</a></div><div class="ttdeci">int is_gzipped</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01874">civetweb.c:1874</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02536">mg_connection::accept_gzip</a>, <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l10181">construct_etag()</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l10196">fclose_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l08354">get_mime_type()</a>, <a class="el" href="civetweb_8c_source.html#l03341">gmt_time_string()</a>, <a class="el" href="civetweb_8c_source.html#l00926">INT64_FMT</a>, <a class="el" href="civetweb_8c_source.html#l00513">INT64_MAX</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l01874">mg_file_stat::is_gzipped</a>, <a class="el" href="civetweb_8c_source.html#l01872">mg_file_stat::last_modified</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l00478">MG_FILE_COMPRESSION_SIZE_LIMIT</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02843">MG_FOPEN_MODE_READ</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#af2fea4b4a82311588a9914b6d8491661">mg_response_header_add_lines()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="civetweb_8c_source.html#l08224">mime_type</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l10169">parse_range_header()</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, <a class="el" href="civetweb_8c_source.html#l02466">PROTOCOL_TYPE_HTTP1</a>, <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04149">send_cors_header()</a>, <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>, <a class="el" href="civetweb_8c_source.html#l04074">send_static_cache_header()</a>, <a class="el" href="civetweb_8c_source.html#l01871">mg_file_stat::size</a>, <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>, <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>, and <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l15354">handle_file_based_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>.</p>

</div>
</div>
<a id="a1bc2585ae2ab78f91db4346a574d58ac" name="a1bc2585ae2ab78f91db4346a574d58ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bc2585ae2ab78f91db4346a574d58ac">&#9670;&#160;</a></span>header_has_option()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int header_has_option </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>header</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>option</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03956">3956</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3957</span>{</div>
<div class="line"><span class="lineno"> 3958</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> opt_vec;</div>
<div class="line"><span class="lineno"> 3959</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> eq_vec;</div>
<div class="line"><span class="lineno"> 3960</span> </div>
<div class="line"><span class="lineno"> 3961</span>    <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(option != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 3962</span>    <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(option[0] != <span class="charliteral">&#39;\0&#39;</span>);</div>
<div class="line"><span class="lineno"> 3963</span> </div>
<div class="line"><span class="lineno"> 3964</span>    <span class="keywordflow">while</span> ((header = <a class="code hl_function" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a>(header, &amp;opt_vec, &amp;eq_vec)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3965</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(option, opt_vec.ptr, opt_vec.len) == 0)</div>
<div class="line"><span class="lineno"> 3966</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 3967</span>    }</div>
<div class="line"><span class="lineno"> 3968</span> </div>
<div class="line"><span class="lineno"> 3969</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 3970</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00260">DEBUG_ASSERT</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8c_source.html#l03019">mg_strncasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l03899">next_option()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03984">should_keep_alive()</a>.</p>

</div>
</div>
<a id="a9bd30673001e62b1d44baa0caeb0da97" name="a9bd30673001e62b1d44baa0caeb0da97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bd30673001e62b1d44baa0caeb0da97">&#9670;&#160;</a></span>header_val()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * header_val </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>header</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16046">16046</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16047</span>{</div>
<div class="line"><span class="lineno">16048</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *header_value;</div>
<div class="line"><span class="lineno">16049</span> </div>
<div class="line"><span class="lineno">16050</span>    <span class="keywordflow">if</span> ((header_value = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, header)) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16051</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;-&quot;</span>;</div>
<div class="line"><span class="lineno">16052</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16053</span>        <span class="keywordflow">return</span> header_value;</div>
<div class="line"><span class="lineno">16054</span>    }</div>
<div class="line"><span class="lineno">16055</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>.</p>

</div>
</div>
<a id="a79a94c1836be39ee8d6bcbee626493c5" name="a79a94c1836be39ee8d6bcbee626493c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79a94c1836be39ee8d6bcbee626493c5">&#9670;&#160;</a></span>hexdump2string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int hexdump2string </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>mem</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>memlen</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>buflen</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16594">16594</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16595</span>{</div>
<div class="line"><span class="lineno">16596</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">16597</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> hexdigit[] = <span class="stringliteral">&quot;0123456789abcdef&quot;</span>;</div>
<div class="line"><span class="lineno">16598</span> </div>
<div class="line"><span class="lineno">16599</span>    <span class="keywordflow">if</span> ((memlen &lt;= 0) || (buflen &lt;= 0)) {</div>
<div class="line"><span class="lineno">16600</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16601</span>    }</div>
<div class="line"><span class="lineno">16602</span>    <span class="keywordflow">if</span> (buflen &lt; (3 * memlen)) {</div>
<div class="line"><span class="lineno">16603</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16604</span>    }</div>
<div class="line"><span class="lineno">16605</span> </div>
<div class="line"><span class="lineno">16606</span>    <span class="keywordflow">for</span> (i = 0; i &lt; memlen; i++) {</div>
<div class="line"><span class="lineno">16607</span>        <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><span class="lineno">16608</span>            buf[3 * i - 1] = <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><span class="lineno">16609</span>        }</div>
<div class="line"><span class="lineno">16610</span>        buf[3 * i] = hexdigit[(((uint8_t *)mem)[i] &gt;&gt; 4) &amp; 0xF];</div>
<div class="line"><span class="lineno">16611</span>        buf[3 * i + 1] = hexdigit[((uint8_t *)mem)[i] &amp; 0xF];</div>
<div class="line"><span class="lineno">16612</span>    }</div>
<div class="line"><span class="lineno">16613</span>    buf[3 * memlen - 1] = 0;</div>
<div class="line"><span class="lineno">16614</span> </div>
<div class="line"><span class="lineno">16615</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">16616</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16620">ssl_get_client_cert_info()</a>.</p>

</div>
</div>
<a id="ae40e268aca47c39d1f151a60655f3f70" name="ae40e268aca47c39d1f151a60655f3f70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae40e268aca47c39d1f151a60655f3f70">&#9670;&#160;</a></span>init_connection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void init_connection </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19329">19329</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19330</span>{</div>
<div class="line"><span class="lineno">19331</span>    <span class="comment">/* Is keep alive allowed by the server */</span></div>
<div class="line"><span class="lineno">19332</span>    <span class="keywordtype">int</span> keep_alive_enabled =</div>
<div class="line"><span class="lineno">19333</span>        !<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba39a8b8c4df6154e815a5a49da528ce5c">ENABLE_KEEP_ALIVE</a>], <span class="stringliteral">&quot;yes&quot;</span>);</div>
<div class="line"><span class="lineno">19334</span> </div>
<div class="line"><span class="lineno">19335</span>    <span class="keywordflow">if</span> (!keep_alive_enabled) {</div>
<div class="line"><span class="lineno">19336</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">19337</span>    }</div>
<div class="line"><span class="lineno">19338</span> </div>
<div class="line"><span class="lineno">19339</span>    <span class="comment">/* Important: on new connection, reset the receiving buffer. Credit</span></div>
<div class="line"><span class="lineno">19340</span><span class="comment">     * goes to crule42. */</span></div>
<div class="line"><span class="lineno">19341</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> = 0;</div>
<div class="line"><span class="lineno">19342</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ad423caedb8c37f057f26a96153fd5e72">handled_requests</a> = 0;</div>
<div class="line"><span class="lineno">19343</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04ad728da0f171f49e9778426365c03eef1">CONNECTION_TYPE_INVALID</a>;</div>
<div class="line"><span class="lineno">19344</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#ae3d29a3501fca9f046a13bcbe7ae86ec">acceptedWebSocketSubprotocol</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19345</span>    <a class="code hl_function" href="#a83b9266322b1883981ec399cfce275a4">mg_set_user_connection_data</a>(conn, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">19346</span> </div>
<div class="line"><span class="lineno">19347</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">19348</span>    conn-&gt;conn_state = 2; <span class="comment">/* init */</span></div>
<div class="line"><span class="lineno">19349</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19350</span> </div>
<div class="line"><span class="lineno">19351</span>    <span class="comment">/* call the init_connection callback if assigned */</span></div>
<div class="line"><span class="lineno">19352</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a6c814dc27526bf4270c7e286cb24fd43">init_connection</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">19353</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099">CONTEXT_SERVER</a>) {</div>
<div class="line"><span class="lineno">19354</span>            <span class="keywordtype">void</span> *conn_data = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19355</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a6c814dc27526bf4270c7e286cb24fd43">init_connection</a>(conn, &amp;conn_data);</div>
<div class="line"><span class="lineno">19356</span>            <a class="code hl_function" href="#a83b9266322b1883981ec399cfce275a4">mg_set_user_connection_data</a>(conn, conn_data);</div>
<div class="line"><span class="lineno">19357</span>        }</div>
<div class="line"><span class="lineno">19358</span>    }</div>
<div class="line"><span class="lineno">19359</span>}</div>
<div class="ttc" id="astructmg__callbacks_html_a6c814dc27526bf4270c7e286cb24fd43"><div class="ttname"><a href="structmg__callbacks.html#a6c814dc27526bf4270c7e286cb24fd43">mg_callbacks::init_connection</a></div><div class="ttdeci">int(* init_connection)(const struct mg_connection *conn, void **conn_data)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00417">civetweb.h:417</a></div></div>
<div class="ttc" id="astructmg__connection_html_ad423caedb8c37f057f26a96153fd5e72"><div class="ttname"><a href="structmg__connection.html#ad423caedb8c37f057f26a96153fd5e72">mg_connection::handled_requests</a></div><div class="ttdeci">int handled_requests</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02554">civetweb.c:2554</a></div></div>
<div class="ttc" id="astructmg__request__info_html_ae3d29a3501fca9f046a13bcbe7ae86ec"><div class="ttname"><a href="structmg__request__info.html#ae3d29a3501fca9f046a13bcbe7ae86ec">mg_request_info::acceptedWebSocketSubprotocol</a></div><div class="ttdeci">const char * acceptedWebSocketSubprotocol</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00184">civetweb.h:184</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00184">mg_request_info::acceptedWebSocketSubprotocol</a>, <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02486">mg_connection::connection_type</a>, <a class="el" href="civetweb_8c_source.html#l02460">CONNECTION_TYPE_INVALID</a>, <a class="el" href="civetweb_8c_source.html#l02263">CONTEXT_SERVER</a>, <a class="el" href="civetweb_8c_source.html#l02354">mg_context::context_type</a>, <a class="el" href="civetweb_8c_source.html#l02558">mg_connection::data_len</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01936">ENABLE_KEEP_ALIVE</a>, <a class="el" href="civetweb_8c_source.html#l02554">mg_connection::handled_requests</a>, <a class="el" href="civetweb_8h_source.html#l00417">mg_callbacks::init_connection</a>, <a class="el" href="civetweb_8c_source.html#l03225">mg_set_user_connection_data()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, and <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="ae2d6e50236af5e059e4c3e28cc232cff" name="ae2d6e50236af5e059e4c3e28cc232cff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2d6e50236af5e059e4c3e28cc232cff">&#9670;&#160;</a></span>init_ssl_ctx()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int init_ssl_ctx </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>phys_ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__domain__context.html">mg_domain_context</a> *</td>          <td class="paramname"><span class="paramname"><em>dom_ctx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17485">17485</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17486</span>{</div>
<div class="line"><span class="lineno">17487</span>    <span class="keywordtype">void</span> *ssl_ctx = 0;</div>
<div class="line"><span class="lineno">17488</span>    <span class="keywordtype">int</span> callback_ret;</div>
<div class="line"><span class="lineno">17489</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *pem;</div>
<div class="line"><span class="lineno">17490</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *chain;</div>
<div class="line"><span class="lineno">17491</span>    <span class="keywordtype">char</span> ebuf[128];</div>
<div class="line"><span class="lineno">17492</span> </div>
<div class="line"><span class="lineno">17493</span>    <span class="keywordflow">if</span> (!phys_ctx) {</div>
<div class="line"><span class="lineno">17494</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17495</span>    }</div>
<div class="line"><span class="lineno">17496</span> </div>
<div class="line"><span class="lineno">17497</span>    <span class="keywordflow">if</span> (!dom_ctx) {</div>
<div class="line"><span class="lineno">17498</span>        dom_ctx = &amp;(phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>);</div>
<div class="line"><span class="lineno">17499</span>    }</div>
<div class="line"><span class="lineno">17500</span> </div>
<div class="line"><span class="lineno">17501</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#ae3eb055e17e5fa3eb02ce4873e76e884">is_ssl_port_used</a>(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e">LISTENING_PORTS</a>])) {</div>
<div class="line"><span class="lineno">17502</span>        <span class="comment">/* No SSL port is set. No need to setup SSL. */</span></div>
<div class="line"><span class="lineno">17503</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">17504</span>    }</div>
<div class="line"><span class="lineno">17505</span> </div>
<div class="line"><span class="lineno">17506</span>    <span class="comment">/* Check for external SSL_CTX */</span></div>
<div class="line"><span class="lineno">17507</span>    callback_ret =</div>
<div class="line"><span class="lineno">17508</span>        (phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aa2b516914e543464e16033e16481f6fe">external_ssl_ctx</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">17509</span>            ? 0</div>
<div class="line"><span class="lineno">17510</span>            : (phys_ctx-&gt;callbacks.external_ssl_ctx(&amp;ssl_ctx,</div>
<div class="line"><span class="lineno">17511</span>                                                    phys_ctx-&gt;user_data));</div>
<div class="line"><span class="lineno">17512</span> </div>
<div class="line"><span class="lineno">17513</span>    <span class="keywordflow">if</span> (callback_ret &lt; 0) {</div>
<div class="line"><span class="lineno">17514</span>        <span class="comment">/* Callback exists and returns &lt;0: Initializing failed. */</span></div>
<div class="line"><span class="lineno">17515</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">17516</span>                            <span class="stringliteral">&quot;external_ssl_ctx callback returned error: %i&quot;</span>,</div>
<div class="line"><span class="lineno">17517</span>                            callback_ret);</div>
<div class="line"><span class="lineno">17518</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17519</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (callback_ret &gt; 0) {</div>
<div class="line"><span class="lineno">17520</span>        <span class="comment">/* Callback exists and returns &gt;0: Initializing complete,</span></div>
<div class="line"><span class="lineno">17521</span><span class="comment">         * civetweb should not modify the SSL context. */</span></div>
<div class="line"><span class="lineno">17522</span>        dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a> = (SSL_CTX *)ssl_ctx;</div>
<div class="line"><span class="lineno">17523</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#af5e3c74304e46cc4c4774c35bf248d99">initialize_openssl</a>(ebuf, <span class="keyword">sizeof</span>(ebuf))) {</div>
<div class="line"><span class="lineno">17524</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx, <span class="stringliteral">&quot;%s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">17525</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17526</span>        }</div>
<div class="line"><span class="lineno">17527</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">17528</span>    }</div>
<div class="line"><span class="lineno">17529</span>    <span class="comment">/* If the callback does not exist or return 0, civetweb must initialize</span></div>
<div class="line"><span class="lineno">17530</span><span class="comment">     * the SSL context. Handle &quot;domain&quot; callback next. */</span></div>
<div class="line"><span class="lineno">17531</span> </div>
<div class="line"><span class="lineno">17532</span>    <span class="comment">/* Check for external domain SSL_CTX callback. */</span></div>
<div class="line"><span class="lineno">17533</span>    callback_ret = (phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#ad65fb1190b6d276c001396a9ae8b7609">external_ssl_ctx_domain</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">17534</span>                       ? 0</div>
<div class="line"><span class="lineno">17535</span>                       : (phys_ctx-&gt;callbacks.external_ssl_ctx_domain(</div>
<div class="line"><span class="lineno">17536</span>                             dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>],</div>
<div class="line"><span class="lineno">17537</span>                             &amp;ssl_ctx,</div>
<div class="line"><span class="lineno">17538</span>                             phys_ctx-&gt;user_data));</div>
<div class="line"><span class="lineno">17539</span> </div>
<div class="line"><span class="lineno">17540</span>    <span class="keywordflow">if</span> (callback_ret &lt; 0) {</div>
<div class="line"><span class="lineno">17541</span>        <span class="comment">/* Callback &lt; 0: Error. Abort init. */</span></div>
<div class="line"><span class="lineno">17542</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(</div>
<div class="line"><span class="lineno">17543</span>            phys_ctx,</div>
<div class="line"><span class="lineno">17544</span>            <span class="stringliteral">&quot;external_ssl_ctx_domain callback returned error: %i&quot;</span>,</div>
<div class="line"><span class="lineno">17545</span>            callback_ret);</div>
<div class="line"><span class="lineno">17546</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17547</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (callback_ret &gt; 0) {</div>
<div class="line"><span class="lineno">17548</span>        <span class="comment">/* Callback &gt; 0: Consider init done. */</span></div>
<div class="line"><span class="lineno">17549</span>        dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a> = (SSL_CTX *)ssl_ctx;</div>
<div class="line"><span class="lineno">17550</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#af5e3c74304e46cc4c4774c35bf248d99">initialize_openssl</a>(ebuf, <span class="keyword">sizeof</span>(ebuf))) {</div>
<div class="line"><span class="lineno">17551</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx, <span class="stringliteral">&quot;%s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">17552</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17553</span>        }</div>
<div class="line"><span class="lineno">17554</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">17555</span>    }</div>
<div class="line"><span class="lineno">17556</span>    <span class="comment">/* else: external_ssl_ctx/external_ssl_ctx_domain do not exist or return</span></div>
<div class="line"><span class="lineno">17557</span><span class="comment">     * 0, CivetWeb should continue initializing SSL */</span></div>
<div class="line"><span class="lineno">17558</span> </div>
<div class="line"><span class="lineno">17559</span>    <span class="comment">/* If PEM file is not specified and the init_ssl callbacks</span></div>
<div class="line"><span class="lineno">17560</span><span class="comment">     * are not specified, setup will fail. */</span></div>
<div class="line"><span class="lineno">17561</span>    <span class="keywordflow">if</span> (((pem = dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1bb8ebf1124ab1bb589866f06e54e71f">SSL_CERTIFICATE</a>]) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">17562</span>        &amp;&amp; (phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a05c7c568d4cc1bc84beb0ad9bb8a4d36">init_ssl</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">17563</span>        &amp;&amp; (phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a8b204cb8511bcb86c7ab9629a1b62748">init_ssl_domain</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">17564</span>        <span class="comment">/* No certificate and no init_ssl callbacks:</span></div>
<div class="line"><span class="lineno">17565</span><span class="comment">         * Essential data to set up TLS is missing.</span></div>
<div class="line"><span class="lineno">17566</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">17567</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">17568</span>                            <span class="stringliteral">&quot;Initializing SSL failed: -%s is not set&quot;</span>,</div>
<div class="line"><span class="lineno">17569</span>                            <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1bb8ebf1124ab1bb589866f06e54e71f">SSL_CERTIFICATE</a>].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">17570</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17571</span>    }</div>
<div class="line"><span class="lineno">17572</span> </div>
<div class="line"><span class="lineno">17573</span>    <span class="comment">/* If a certificate chain is configured, use it. */</span></div>
<div class="line"><span class="lineno">17574</span>    chain = dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baacb7b39407a541fbda68aafd33193470">SSL_CERTIFICATE_CHAIN</a>];</div>
<div class="line"><span class="lineno">17575</span>    <span class="keywordflow">if</span> (chain == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17576</span>        <span class="comment">/* Default: certificate chain in PEM file */</span></div>
<div class="line"><span class="lineno">17577</span>        chain = pem;</div>
<div class="line"><span class="lineno">17578</span>    }</div>
<div class="line"><span class="lineno">17579</span>    <span class="keywordflow">if</span> ((chain != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (*chain == 0)) {</div>
<div class="line"><span class="lineno">17580</span>        <span class="comment">/* If the chain is an empty string, don&#39;t use it. */</span></div>
<div class="line"><span class="lineno">17581</span>        chain = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17582</span>    }</div>
<div class="line"><span class="lineno">17583</span> </div>
<div class="line"><span class="lineno">17584</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#af5e3c74304e46cc4c4774c35bf248d99">initialize_openssl</a>(ebuf, <span class="keyword">sizeof</span>(ebuf))) {</div>
<div class="line"><span class="lineno">17585</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx, <span class="stringliteral">&quot;%s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">17586</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17587</span>    }</div>
<div class="line"><span class="lineno">17588</span> </div>
<div class="line"><span class="lineno">17589</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a69044be28d28031d573838a7bbf2168d">init_ssl_ctx_impl</a>(phys_ctx, dom_ctx, pem, chain);</div>
<div class="line"><span class="lineno">17590</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a69044be28d28031d573838a7bbf2168d"><div class="ttname"><a href="#a69044be28d28031d573838a7bbf2168d">init_ssl_ctx_impl</a></div><div class="ttdeci">static int init_ssl_ctx_impl(struct mg_context *phys_ctx, struct mg_domain_context *dom_ctx, const char *pem, const char *chain)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17239">civetweb.c:17239</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ae3eb055e17e5fa3eb02ce4873e76e884"><div class="ttname"><a href="#ae3eb055e17e5fa3eb02ce4873e76e884">is_ssl_port_used</a></div><div class="ttdeci">static int is_ssl_port_used(const char *ports)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l15679">civetweb.c:15679</a></div></div>
<div class="ttc" id="acivetweb_8c_html_af5e3c74304e46cc4c4774c35bf248d99"><div class="ttname"><a href="#af5e3c74304e46cc4c4774c35bf248d99">initialize_openssl</a></div><div class="ttdeci">static int initialize_openssl(char *ebuf, size_t ebuf_len)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16821">civetweb.c:16821</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_a05c7c568d4cc1bc84beb0ad9bb8a4d36"><div class="ttname"><a href="structmg__callbacks.html#a05c7c568d4cc1bc84beb0ad9bb8a4d36">mg_callbacks::init_ssl</a></div><div class="ttdeci">int(* init_ssl)(void *ssl_ctx, void *user_data)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00254">civetweb.h:254</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_a8b204cb8511bcb86c7ab9629a1b62748"><div class="ttname"><a href="structmg__callbacks.html#a8b204cb8511bcb86c7ab9629a1b62748">mg_callbacks::init_ssl_domain</a></div><div class="ttdeci">int(* init_ssl_domain)(const char *server_domain, void *ssl_ctx, void *user_data)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00265">civetweb.h:265</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_ad65fb1190b6d276c001396a9ae8b7609"><div class="ttname"><a href="structmg__callbacks.html#ad65fb1190b6d276c001396a9ae8b7609">mg_callbacks::external_ssl_ctx_domain</a></div><div class="ttdeci">int(* external_ssl_ctx_domain)(const char *server_domain, void **ssl_ctx, void *user_data)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00290">civetweb.h:290</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01999">AUTHENTICATION_DOMAIN</a>, <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8h_source.html#l00278">mg_callbacks::external_ssl_ctx</a>, <a class="el" href="civetweb_8h_source.html#l00290">mg_callbacks::external_ssl_ctx_domain</a>, <a class="el" href="civetweb_8h_source.html#l00254">mg_callbacks::init_ssl</a>, <a class="el" href="civetweb_8c_source.html#l17239">init_ssl_ctx_impl()</a>, <a class="el" href="civetweb_8h_source.html#l00265">mg_callbacks::init_ssl_domain</a>, <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, <a class="el" href="civetweb_8c_source.html#l15679">is_ssl_port_used()</a>, <a class="el" href="civetweb_8c_source.html#l01920">LISTENING_PORTS</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02008">SSL_CERTIFICATE</a>, <a class="el" href="civetweb_8c_source.html#l02009">SSL_CERTIFICATE_CHAIN</a>, <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>, and <a class="el" href="civetweb_8c_source.html#l02433">mg_context::user_data</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, and <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>.</p>

</div>
</div>
<a id="a69044be28d28031d573838a7bbf2168d" name="a69044be28d28031d573838a7bbf2168d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69044be28d28031d573838a7bbf2168d">&#9670;&#160;</a></span>init_ssl_ctx_impl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int init_ssl_ctx_impl </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>phys_ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__domain__context.html">mg_domain_context</a> *</td>          <td class="paramname"><span class="paramname"><em>dom_ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>pem</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>chain</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17239">17239</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17243</span>{</div>
<div class="line"><span class="lineno">17244</span>    <span class="keywordtype">int</span> callback_ret;</div>
<div class="line"><span class="lineno">17245</span>    <span class="keywordtype">int</span> should_verify_peer;</div>
<div class="line"><span class="lineno">17246</span>    <span class="keywordtype">int</span> peer_certificate_optional;</div>
<div class="line"><span class="lineno">17247</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *ca_path;</div>
<div class="line"><span class="lineno">17248</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *ca_file;</div>
<div class="line"><span class="lineno">17249</span>    <span class="keywordtype">int</span> use_default_verify_paths;</div>
<div class="line"><span class="lineno">17250</span>    <span class="keywordtype">int</span> verify_depth;</div>
<div class="line"><span class="lineno">17251</span>    <span class="keyword">struct </span>timespec now_mt;</div>
<div class="line"><span class="lineno">17252</span>    md5_byte_t ssl_context_id[16];</div>
<div class="line"><span class="lineno">17253</span>    md5_state_t md5state;</div>
<div class="line"><span class="lineno">17254</span>    <span class="keywordtype">int</span> protocol_ver;</div>
<div class="line"><span class="lineno">17255</span>    <span class="keywordtype">int</span> ssl_cache_timeout;</div>
<div class="line"><span class="lineno">17256</span> </div>
<div class="line"><span class="lineno">17257</span><span class="preprocessor">#if (defined(OPENSSL_API_1_1) || defined(OPENSSL_API_3_0))                     \</span></div>
<div class="line"><span class="lineno">17258</span><span class="preprocessor">    &amp;&amp; !defined(NO_SSL_DL)</span></div>
<div class="line"><span class="lineno">17259</span>    <span class="keywordflow">if</span> ((dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a> = SSL_CTX_new(TLS_server_method())) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17260</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">17261</span>                            <span class="stringliteral">&quot;SSL_CTX_new (server) error: %s&quot;</span>,</div>
<div class="line"><span class="lineno">17262</span>                            <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">17263</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17264</span>    }</div>
<div class="line"><span class="lineno">17265</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">17266</span>    <span class="keywordflow">if</span> ((dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a> = SSL_CTX_new(SSLv23_server_method())) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17267</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">17268</span>                            <span class="stringliteral">&quot;SSL_CTX_new (server) error: %s&quot;</span>,</div>
<div class="line"><span class="lineno">17269</span>                            <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">17270</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17271</span>    }</div>
<div class="line"><span class="lineno">17272</span><span class="preprocessor">#endif </span><span class="comment">/* OPENSSL_API_1_1 || OPENSSL_API_3_0 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">17273</span> </div>
<div class="line"><span class="lineno">17274</span><span class="preprocessor">#if defined(SSL_OP_NO_TLSv1_3)</span></div>
<div class="line"><span class="lineno">17275</span>    SSL_CTX_clear_options(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>,</div>
<div class="line"><span class="lineno">17276</span>                          SSL_OP_NO_SSLv2 | SSL_OP_NO_SSLv3 | SSL_OP_NO_TLSv1</div>
<div class="line"><span class="lineno">17277</span>                              | SSL_OP_NO_TLSv1_1 | SSL_OP_NO_TLSv1_2</div>
<div class="line"><span class="lineno">17278</span>                              | SSL_OP_NO_TLSv1_3);</div>
<div class="line"><span class="lineno">17279</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">17280</span>    SSL_CTX_clear_options(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>,</div>
<div class="line"><span class="lineno">17281</span>                          SSL_OP_NO_SSLv2 | SSL_OP_NO_SSLv3 | SSL_OP_NO_TLSv1</div>
<div class="line"><span class="lineno">17282</span>                              | SSL_OP_NO_TLSv1_1 | SSL_OP_NO_TLSv1_2);</div>
<div class="line"><span class="lineno">17283</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17284</span> </div>
<div class="line"><span class="lineno">17285</span>    protocol_ver = atoi(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1997d8cac42e06e1a65c2da6e80f9706">SSL_PROTOCOL_VERSION</a>]);</div>
<div class="line"><span class="lineno">17286</span>    SSL_CTX_set_options(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>, <a class="code hl_function" href="#a542ed428fa93885ec11ff0e8aabf1768">ssl_get_protocol</a>(protocol_ver));</div>
<div class="line"><span class="lineno">17287</span>    SSL_CTX_set_options(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>, SSL_OP_SINGLE_DH_USE);</div>
<div class="line"><span class="lineno">17288</span>    SSL_CTX_set_options(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>, SSL_OP_CIPHER_SERVER_PREFERENCE);</div>
<div class="line"><span class="lineno">17289</span>    SSL_CTX_set_options(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>,</div>
<div class="line"><span class="lineno">17290</span>                        SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION);</div>
<div class="line"><span class="lineno">17291</span>    SSL_CTX_set_options(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>, SSL_OP_NO_COMPRESSION);</div>
<div class="line"><span class="lineno">17292</span> </div>
<div class="line"><span class="lineno">17293</span><span class="preprocessor">#if defined(SSL_OP_NO_RENEGOTIATION)</span></div>
<div class="line"><span class="lineno">17294</span>    SSL_CTX_set_options(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>, SSL_OP_NO_RENEGOTIATION);</div>
<div class="line"><span class="lineno">17295</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17296</span> </div>
<div class="line"><span class="lineno">17297</span><span class="preprocessor">#if !defined(NO_SSL_DL)</span></div>
<div class="line"><span class="lineno">17298</span>    SSL_CTX_set_ecdh_auto(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>, 1);</div>
<div class="line"><span class="lineno">17299</span><span class="preprocessor">#endif </span><span class="comment">/* NO_SSL_DL */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">17300</span> </div>
<div class="line"><span class="lineno">17301</span>    <span class="comment">/* In SSL documentation examples callback defined without const</span></div>
<div class="line"><span class="lineno">17302</span><span class="comment">     * specifier &#39;void (*)(SSL *, int, int)&#39;   See:</span></div>
<div class="line"><span class="lineno">17303</span><span class="comment">     * https://www.openssl.org/docs/man1.0.2/ssl/ssl.html</span></div>
<div class="line"><span class="lineno">17304</span><span class="comment">     * https://www.openssl.org/docs/man1.1.0/ssl/ssl.html</span></div>
<div class="line"><span class="lineno">17305</span><span class="comment">     * But in the source code const SSL is used:</span></div>
<div class="line"><span class="lineno">17306</span><span class="comment">     * &#39;void (*)(const SSL *, int, int)&#39; See:</span></div>
<div class="line"><span class="lineno">17307</span><span class="comment">     * https://github.com/openssl/openssl/blob/1d97c8435171a7af575f73c526d79e1ef0ee5960/ssl/ssl.h#L1173</span></div>
<div class="line"><span class="lineno">17308</span><span class="comment">     * Problem about wrong documentation described, but not resolved:</span></div>
<div class="line"><span class="lineno">17309</span><span class="comment">     * https://bugs.launchpad.net/ubuntu/+source/openssl/+bug/1147526</span></div>
<div class="line"><span class="lineno">17310</span><span class="comment">     * Wrong const cast ignored on C or can be suppressed by compiler flags.</span></div>
<div class="line"><span class="lineno">17311</span><span class="comment">     * But when compiled with modern C++ compiler, correct const should be</span></div>
<div class="line"><span class="lineno">17312</span><span class="comment">     * provided</span></div>
<div class="line"><span class="lineno">17313</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">17314</span>    SSL_CTX_set_info_callback(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>, <a class="code hl_function" href="#a84798111da4d1707bb9ab1ba73b1e072">ssl_info_callback</a>);</div>
<div class="line"><span class="lineno">17315</span> </div>
<div class="line"><span class="lineno">17316</span>    SSL_CTX_set_tlsext_servername_callback(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>,</div>
<div class="line"><span class="lineno">17317</span>                                           <a class="code hl_function" href="#a634412d7196b236a4abb02caa0ea2d5a">ssl_servername_callback</a>);</div>
<div class="line"><span class="lineno">17318</span> </div>
<div class="line"><span class="lineno">17319</span>    <span class="comment">/* If a callback has been specified, call it. */</span></div>
<div class="line"><span class="lineno">17320</span>    callback_ret = (phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a05c7c568d4cc1bc84beb0ad9bb8a4d36">init_ssl</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">17321</span>                       ? 0</div>
<div class="line"><span class="lineno">17322</span>                       : (phys_ctx-&gt;callbacks.init_ssl(dom_ctx-&gt;ssl_ctx,</div>
<div class="line"><span class="lineno">17323</span>                                                       phys_ctx-&gt;user_data));</div>
<div class="line"><span class="lineno">17324</span> </div>
<div class="line"><span class="lineno">17325</span>    <span class="comment">/* If callback returns 0, civetweb sets up the SSL certificate.</span></div>
<div class="line"><span class="lineno">17326</span><span class="comment">     * If it returns 1, civetweb assumes the callback already did this.</span></div>
<div class="line"><span class="lineno">17327</span><span class="comment">     * If it returns -1, initializing ssl fails. */</span></div>
<div class="line"><span class="lineno">17328</span>    <span class="keywordflow">if</span> (callback_ret &lt; 0) {</div>
<div class="line"><span class="lineno">17329</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">17330</span>                            <span class="stringliteral">&quot;SSL callback returned error: %i&quot;</span>,</div>
<div class="line"><span class="lineno">17331</span>                            callback_ret);</div>
<div class="line"><span class="lineno">17332</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17333</span>    }</div>
<div class="line"><span class="lineno">17334</span>    <span class="keywordflow">if</span> (callback_ret &gt; 0) {</div>
<div class="line"><span class="lineno">17335</span>        <span class="comment">/* Callback did everything. */</span></div>
<div class="line"><span class="lineno">17336</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">17337</span>    }</div>
<div class="line"><span class="lineno">17338</span> </div>
<div class="line"><span class="lineno">17339</span>    <span class="comment">/* If a domain callback has been specified, call it. */</span></div>
<div class="line"><span class="lineno">17340</span>    callback_ret = (phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a8b204cb8511bcb86c7ab9629a1b62748">init_ssl_domain</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">17341</span>                       ? 0</div>
<div class="line"><span class="lineno">17342</span>                       : (phys_ctx-&gt;callbacks.init_ssl_domain(</div>
<div class="line"><span class="lineno">17343</span>                             dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>],</div>
<div class="line"><span class="lineno">17344</span>                             dom_ctx-&gt;ssl_ctx,</div>
<div class="line"><span class="lineno">17345</span>                             phys_ctx-&gt;user_data));</div>
<div class="line"><span class="lineno">17346</span> </div>
<div class="line"><span class="lineno">17347</span>    <span class="comment">/* If domain callback returns 0, civetweb sets up the SSL certificate.</span></div>
<div class="line"><span class="lineno">17348</span><span class="comment">     * If it returns 1, civetweb assumes the callback already did this.</span></div>
<div class="line"><span class="lineno">17349</span><span class="comment">     * If it returns -1, initializing ssl fails. */</span></div>
<div class="line"><span class="lineno">17350</span>    <span class="keywordflow">if</span> (callback_ret &lt; 0) {</div>
<div class="line"><span class="lineno">17351</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">17352</span>                            <span class="stringliteral">&quot;Domain SSL callback returned error: %i&quot;</span>,</div>
<div class="line"><span class="lineno">17353</span>                            callback_ret);</div>
<div class="line"><span class="lineno">17354</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17355</span>    }</div>
<div class="line"><span class="lineno">17356</span>    <span class="keywordflow">if</span> (callback_ret &gt; 0) {</div>
<div class="line"><span class="lineno">17357</span>        <span class="comment">/* Domain callback did everything. */</span></div>
<div class="line"><span class="lineno">17358</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">17359</span>    }</div>
<div class="line"><span class="lineno">17360</span> </div>
<div class="line"><span class="lineno">17361</span>    <span class="comment">/* Use some combination of start time, domain and port as a SSL</span></div>
<div class="line"><span class="lineno">17362</span><span class="comment">     * context ID. This should be unique on the current machine. */</span></div>
<div class="line"><span class="lineno">17363</span>    md5_init(&amp;md5state);</div>
<div class="line"><span class="lineno">17364</span>    clock_gettime(CLOCK_MONOTONIC, &amp;now_mt);</div>
<div class="line"><span class="lineno">17365</span>    md5_append(&amp;md5state, (<span class="keyword">const</span> md5_byte_t *)&amp;now_mt, <span class="keyword">sizeof</span>(now_mt));</div>
<div class="line"><span class="lineno">17366</span>    md5_append(&amp;md5state,</div>
<div class="line"><span class="lineno">17367</span>               (<span class="keyword">const</span> md5_byte_t *)phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e">LISTENING_PORTS</a>],</div>
<div class="line"><span class="lineno">17368</span>               strlen(phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e">LISTENING_PORTS</a>]));</div>
<div class="line"><span class="lineno">17369</span>    md5_append(&amp;md5state,</div>
<div class="line"><span class="lineno">17370</span>               (<span class="keyword">const</span> md5_byte_t *)dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>],</div>
<div class="line"><span class="lineno">17371</span>               strlen(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>]));</div>
<div class="line"><span class="lineno">17372</span>    md5_append(&amp;md5state, (<span class="keyword">const</span> md5_byte_t *)phys_ctx, <span class="keyword">sizeof</span>(*phys_ctx));</div>
<div class="line"><span class="lineno">17373</span>    md5_append(&amp;md5state, (<span class="keyword">const</span> md5_byte_t *)dom_ctx, <span class="keyword">sizeof</span>(*dom_ctx));</div>
<div class="line"><span class="lineno">17374</span>    md5_finish(&amp;md5state, ssl_context_id);</div>
<div class="line"><span class="lineno">17375</span> </div>
<div class="line"><span class="lineno">17376</span>    SSL_CTX_set_session_id_context(dom_ctx-&gt;ssl_ctx,</div>
<div class="line"><span class="lineno">17377</span>                                   (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)ssl_context_id,</div>
<div class="line"><span class="lineno">17378</span>                                   <span class="keyword">sizeof</span>(ssl_context_id));</div>
<div class="line"><span class="lineno">17379</span> </div>
<div class="line"><span class="lineno">17380</span>    <span class="keywordflow">if</span> (pem != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17381</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a36ba2de78f1cacfe1b95106a834b970d">ssl_use_pem_file</a>(phys_ctx, dom_ctx, pem, chain)) {</div>
<div class="line"><span class="lineno">17382</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17383</span>        }</div>
<div class="line"><span class="lineno">17384</span>    }</div>
<div class="line"><span class="lineno">17385</span> </div>
<div class="line"><span class="lineno">17386</span>    <span class="comment">/* Should we support client certificates? */</span></div>
<div class="line"><span class="lineno">17387</span>    <span class="comment">/* Default is &quot;no&quot;. */</span></div>
<div class="line"><span class="lineno">17388</span>    should_verify_peer = 0;</div>
<div class="line"><span class="lineno">17389</span>    peer_certificate_optional = 0;</div>
<div class="line"><span class="lineno">17390</span>    <span class="keywordflow">if</span> (dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac">SSL_DO_VERIFY_PEER</a>] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17391</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac">SSL_DO_VERIFY_PEER</a>], <span class="stringliteral">&quot;yes&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">17392</span>            <span class="comment">/* Yes, they are mandatory */</span></div>
<div class="line"><span class="lineno">17393</span>            should_verify_peer = 1;</div>
<div class="line"><span class="lineno">17394</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac">SSL_DO_VERIFY_PEER</a>],</div>
<div class="line"><span class="lineno">17395</span>                                 <span class="stringliteral">&quot;optional&quot;</span>)</div>
<div class="line"><span class="lineno">17396</span>                   == 0) {</div>
<div class="line"><span class="lineno">17397</span>            <span class="comment">/* Yes, they are optional */</span></div>
<div class="line"><span class="lineno">17398</span>            should_verify_peer = 1;</div>
<div class="line"><span class="lineno">17399</span>            peer_certificate_optional = 1;</div>
<div class="line"><span class="lineno">17400</span>        }</div>
<div class="line"><span class="lineno">17401</span>    }</div>
<div class="line"><span class="lineno">17402</span> </div>
<div class="line"><span class="lineno">17403</span>    use_default_verify_paths =</div>
<div class="line"><span class="lineno">17404</span>        (dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba5965f9b2d16d3989a9a8411486e8dd08">SSL_DEFAULT_VERIFY_PATHS</a>] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">17405</span>        &amp;&amp; (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba5965f9b2d16d3989a9a8411486e8dd08">SSL_DEFAULT_VERIFY_PATHS</a>], <span class="stringliteral">&quot;yes&quot;</span>)</div>
<div class="line"><span class="lineno">17406</span>            == 0);</div>
<div class="line"><span class="lineno">17407</span> </div>
<div class="line"><span class="lineno">17408</span>    <span class="keywordflow">if</span> (should_verify_peer) {</div>
<div class="line"><span class="lineno">17409</span>        ca_path = dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba3e3b29034498dd70486ada574bcd4d6d">SSL_CA_PATH</a>];</div>
<div class="line"><span class="lineno">17410</span>        ca_file = dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baeae84e3e129de97ee8fdad5fd628683f">SSL_CA_FILE</a>];</div>
<div class="line"><span class="lineno">17411</span>        <span class="keywordflow">if</span> (SSL_CTX_load_verify_locations(dom_ctx-&gt;ssl_ctx, ca_file, ca_path)</div>
<div class="line"><span class="lineno">17412</span>            != 1) {</div>
<div class="line"><span class="lineno">17413</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">17414</span>                                <span class="stringliteral">&quot;SSL_CTX_load_verify_locations error: %s &quot;</span></div>
<div class="line"><span class="lineno">17415</span>                                <span class="stringliteral">&quot;ssl_verify_peer requires setting &quot;</span></div>
<div class="line"><span class="lineno">17416</span>                                <span class="stringliteral">&quot;either ssl_ca_path or ssl_ca_file. &quot;</span></div>
<div class="line"><span class="lineno">17417</span>                                <span class="stringliteral">&quot;Is any of them present in the &quot;</span></div>
<div class="line"><span class="lineno">17418</span>                                <span class="stringliteral">&quot;.conf file?&quot;</span>,</div>
<div class="line"><span class="lineno">17419</span>                                <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">17420</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17421</span>        }</div>
<div class="line"><span class="lineno">17422</span> </div>
<div class="line"><span class="lineno">17423</span>        <span class="keywordflow">if</span> (peer_certificate_optional) {</div>
<div class="line"><span class="lineno">17424</span>            SSL_CTX_set_verify(dom_ctx-&gt;ssl_ctx, SSL_VERIFY_PEER, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">17425</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">17426</span>            SSL_CTX_set_verify(dom_ctx-&gt;ssl_ctx,</div>
<div class="line"><span class="lineno">17427</span>                               SSL_VERIFY_PEER</div>
<div class="line"><span class="lineno">17428</span>                                   | SSL_VERIFY_FAIL_IF_NO_PEER_CERT,</div>
<div class="line"><span class="lineno">17429</span>                               <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">17430</span>        }</div>
<div class="line"><span class="lineno">17431</span> </div>
<div class="line"><span class="lineno">17432</span>        <span class="keywordflow">if</span> (use_default_verify_paths</div>
<div class="line"><span class="lineno">17433</span>            &amp;&amp; (SSL_CTX_set_default_verify_paths(dom_ctx-&gt;ssl_ctx) != 1)) {</div>
<div class="line"><span class="lineno">17434</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">17435</span>                                <span class="stringliteral">&quot;SSL_CTX_set_default_verify_paths error: %s&quot;</span>,</div>
<div class="line"><span class="lineno">17436</span>                                <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">17437</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17438</span>        }</div>
<div class="line"><span class="lineno">17439</span> </div>
<div class="line"><span class="lineno">17440</span>        <span class="keywordflow">if</span> (dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1707f77739201a2e6bd9c894c473a244">SSL_VERIFY_DEPTH</a>]) {</div>
<div class="line"><span class="lineno">17441</span>            verify_depth = atoi(dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1707f77739201a2e6bd9c894c473a244">SSL_VERIFY_DEPTH</a>]);</div>
<div class="line"><span class="lineno">17442</span>            SSL_CTX_set_verify_depth(dom_ctx-&gt;ssl_ctx, verify_depth);</div>
<div class="line"><span class="lineno">17443</span>        }</div>
<div class="line"><span class="lineno">17444</span>    }</div>
<div class="line"><span class="lineno">17445</span> </div>
<div class="line"><span class="lineno">17446</span>    <span class="keywordflow">if</span> (dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba78ec09de569b58d0a71425ee91b02f44">SSL_CIPHER_LIST</a>] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17447</span>        <span class="keywordflow">if</span> (SSL_CTX_set_cipher_list(dom_ctx-&gt;ssl_ctx,</div>
<div class="line"><span class="lineno">17448</span>                                    dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba78ec09de569b58d0a71425ee91b02f44">SSL_CIPHER_LIST</a>])</div>
<div class="line"><span class="lineno">17449</span>            != 1) {</div>
<div class="line"><span class="lineno">17450</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">17451</span>                                <span class="stringliteral">&quot;SSL_CTX_set_cipher_list error: %s&quot;</span>,</div>
<div class="line"><span class="lineno">17452</span>                                <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">17453</span>        }</div>
<div class="line"><span class="lineno">17454</span>    }</div>
<div class="line"><span class="lineno">17455</span> </div>
<div class="line"><span class="lineno">17456</span>    <span class="comment">/* SSL session caching */</span></div>
<div class="line"><span class="lineno">17457</span>    ssl_cache_timeout = ((dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba359ab5a360678365c390cba52eef08ba">SSL_CACHE_TIMEOUT</a>] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">17458</span>                             ? atoi(dom_ctx-&gt;config[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba359ab5a360678365c390cba52eef08ba">SSL_CACHE_TIMEOUT</a>])</div>
<div class="line"><span class="lineno">17459</span>                             : 0);</div>
<div class="line"><span class="lineno">17460</span>    <span class="keywordflow">if</span> (ssl_cache_timeout &gt; 0) {</div>
<div class="line"><span class="lineno">17461</span>        SSL_CTX_set_session_cache_mode(dom_ctx-&gt;ssl_ctx, SSL_SESS_CACHE_BOTH);</div>
<div class="line"><span class="lineno">17462</span>        <span class="comment">/* SSL_CTX_sess_set_cache_size(dom_ctx-&gt;ssl_ctx, 10000);  ... use</span></div>
<div class="line"><span class="lineno">17463</span><span class="comment">         * default */</span></div>
<div class="line"><span class="lineno">17464</span>        SSL_CTX_set_timeout(dom_ctx-&gt;ssl_ctx, (<span class="keywordtype">long</span>)ssl_cache_timeout);</div>
<div class="line"><span class="lineno">17465</span>    }</div>
<div class="line"><span class="lineno">17466</span> </div>
<div class="line"><span class="lineno">17467</span><span class="preprocessor">#if defined(USE_ALPN)</span></div>
<div class="line"><span class="lineno">17468</span>    <span class="comment">/* Initialize ALPN only of TLS library (OpenSSL version) supports ALPN */</span></div>
<div class="line"><span class="lineno">17469</span><span class="preprocessor">#if !defined(NO_SSL_DL)</span></div>
<div class="line"><span class="lineno">17470</span>    <span class="keywordflow">if</span> (!tls_feature_missing[TLS_ALPN])</div>
<div class="line"><span class="lineno">17471</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17472</span>    {</div>
<div class="line"><span class="lineno">17473</span>        init_alpn(phys_ctx, dom_ctx);</div>
<div class="line"><span class="lineno">17474</span>    }</div>
<div class="line"><span class="lineno">17475</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17476</span> </div>
<div class="line"><span class="lineno">17477</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">17478</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a36ba2de78f1cacfe1b95106a834b970d"><div class="ttname"><a href="#a36ba2de78f1cacfe1b95106a834b970d">ssl_use_pem_file</a></div><div class="ttdeci">static int ssl_use_pem_file(struct mg_context *phys_ctx, struct mg_domain_context *dom_ctx, const char *pem, const char *chain)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16940">civetweb.c:16940</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a3754dec11e945be1db7482091a4cd5ae"><div class="ttname"><a href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a></div><div class="ttdeci">static const char * ssl_error(void)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16585">civetweb.c:16585</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a542ed428fa93885ec11ff0e8aabf1768"><div class="ttname"><a href="#a542ed428fa93885ec11ff0e8aabf1768">ssl_get_protocol</a></div><div class="ttdeci">static long ssl_get_protocol(int version_id)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17017">civetweb.c:17017</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a634412d7196b236a4abb02caa0ea2d5a"><div class="ttname"><a href="#a634412d7196b236a4abb02caa0ea2d5a">ssl_servername_callback</a></div><div class="ttdeci">static int ssl_servername_callback(SSL *ssl, int *ad, void *arg)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17066">civetweb.c:17066</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a84798111da4d1707bb9ab1ba73b1e072"><div class="ttname"><a href="#a84798111da4d1707bb9ab1ba73b1e072">ssl_info_callback</a></div><div class="ttdeci">static void ssl_info_callback(const SSL *ssl, int what, int ret)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17050">civetweb.c:17050</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01999">AUTHENTICATION_DOMAIN</a>, <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8h_source.html#l00254">mg_callbacks::init_ssl</a>, <a class="el" href="civetweb_8h_source.html#l00265">mg_callbacks::init_ssl_domain</a>, <a class="el" href="civetweb_8c_source.html#l01920">LISTENING_PORTS</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02015">SSL_CA_FILE</a>, <a class="el" href="civetweb_8c_source.html#l02014">SSL_CA_PATH</a>, <a class="el" href="civetweb_8c_source.html#l02013">SSL_CACHE_TIMEOUT</a>, <a class="el" href="civetweb_8c_source.html#l02018">SSL_CIPHER_LIST</a>, <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02017">SSL_DEFAULT_VERIFY_PATHS</a>, <a class="el" href="civetweb_8c_source.html#l02012">SSL_DO_VERIFY_PEER</a>, <a class="el" href="civetweb_8c_source.html#l16585">ssl_error()</a>, <a class="el" href="civetweb_8c_source.html#l17017">ssl_get_protocol()</a>, <a class="el" href="civetweb_8c_source.html#l17050">ssl_info_callback()</a>, <a class="el" href="civetweb_8c_source.html#l02019">SSL_PROTOCOL_VERSION</a>, <a class="el" href="civetweb_8c_source.html#l17066">ssl_servername_callback()</a>, <a class="el" href="civetweb_8c_source.html#l16940">ssl_use_pem_file()</a>, <a class="el" href="civetweb_8c_source.html#l02016">SSL_VERIFY_DEPTH</a>, and <a class="el" href="civetweb_8c_source.html#l02433">mg_context::user_data</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17485">init_ssl_ctx()</a>.</p>

</div>
</div>
<a id="af5e3c74304e46cc4c4774c35bf248d99" name="af5e3c74304e46cc4c4774c35bf248d99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5e3c74304e46cc4c4774c35bf248d99">&#9670;&#160;</a></span>initialize_openssl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int initialize_openssl </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>ebuf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>ebuf_len</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16821">16821</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16822</span>{</div>
<div class="line"><span class="lineno">16823</span><span class="preprocessor">#if !defined(OPENSSL_API_1_1) &amp;&amp; !defined(OPENSSL_API_3_0)</span></div>
<div class="line"><span class="lineno">16824</span>    <span class="keywordtype">int</span> i, num_locks;</div>
<div class="line"><span class="lineno">16825</span>    <span class="keywordtype">size_t</span> size;</div>
<div class="line"><span class="lineno">16826</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">16827</span> </div>
<div class="line"><span class="lineno">16828</span>    <span class="keywordflow">if</span> (ebuf_len &gt; 0) {</div>
<div class="line"><span class="lineno">16829</span>        ebuf[0] = 0;</div>
<div class="line"><span class="lineno">16830</span>    }</div>
<div class="line"><span class="lineno">16831</span> </div>
<div class="line"><span class="lineno">16832</span><span class="preprocessor">#if !defined(NO_SSL_DL)</span></div>
<div class="line"><span class="lineno">16833</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="#ad6ec95caddfbfbbe177b2e95ec9d17b3">cryptolib_dll_handle</a>) {</div>
<div class="line"><span class="lineno">16834</span>        memset(tls_feature_missing, 0, <span class="keyword">sizeof</span>(tls_feature_missing));</div>
<div class="line"><span class="lineno">16835</span>        <a class="code hl_variable" href="#ad6ec95caddfbfbbe177b2e95ec9d17b3">cryptolib_dll_handle</a> = <a class="code hl_function" href="#a7dcb20f5797258e244f21fc4d62ce828">load_tls_dll</a>(</div>
<div class="line"><span class="lineno">16836</span>            ebuf, ebuf_len, <a class="code hl_define" href="#a52cf22e0f16c8a5c8c60788eec654e30">CRYPTO_LIB</a>, crypto_sw, tls_feature_missing);</div>
<div class="line"><span class="lineno">16837</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="#ad6ec95caddfbfbbe177b2e95ec9d17b3">cryptolib_dll_handle</a>) {</div>
<div class="line"><span class="lineno">16838</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">16839</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">16840</span>                        ebuf,</div>
<div class="line"><span class="lineno">16841</span>                        ebuf_len,</div>
<div class="line"><span class="lineno">16842</span>                        <span class="stringliteral">&quot;%s: error loading library %s&quot;</span>,</div>
<div class="line"><span class="lineno">16843</span>                        __func__,</div>
<div class="line"><span class="lineno">16844</span>                        <a class="code hl_define" href="#a52cf22e0f16c8a5c8c60788eec654e30">CRYPTO_LIB</a>);</div>
<div class="line"><span class="lineno">16845</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">16846</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16847</span>        }</div>
<div class="line"><span class="lineno">16848</span>    }</div>
<div class="line"><span class="lineno">16849</span><span class="preprocessor">#endif </span><span class="comment">/* NO_SSL_DL */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">16850</span> </div>
<div class="line"><span class="lineno">16851</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac84429c87794be46b88e30fbd3b0bcfa">mg_atomic_inc</a>(&amp;<a class="code hl_variable" href="#a5254c431a0b51011fbb000d383bf56fd">cryptolib_users</a>) &gt; 1) {</div>
<div class="line"><span class="lineno">16852</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">16853</span>    }</div>
<div class="line"><span class="lineno">16854</span> </div>
<div class="line"><span class="lineno">16855</span><span class="preprocessor">#if !defined(OPENSSL_API_1_1) &amp;&amp; !defined(OPENSSL_API_3_0)</span></div>
<div class="line"><span class="lineno">16856</span>    <span class="comment">/* Initialize locking callbacks, needed for thread safety.</span></div>
<div class="line"><span class="lineno">16857</span><span class="comment">     * http://www.openssl.org/support/faq.html#PROG1</span></div>
<div class="line"><span class="lineno">16858</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">16859</span>    num_locks = CRYPTO_num_locks();</div>
<div class="line"><span class="lineno">16860</span>    <span class="keywordflow">if</span> (num_locks &lt; 0) {</div>
<div class="line"><span class="lineno">16861</span>        num_locks = 0;</div>
<div class="line"><span class="lineno">16862</span>    }</div>
<div class="line"><span class="lineno">16863</span>    size = <span class="keyword">sizeof</span>(pthread_mutex_t) * ((<span class="keywordtype">size_t</span>)(num_locks));</div>
<div class="line"><span class="lineno">16864</span> </div>
<div class="line"><span class="lineno">16865</span>    <span class="comment">/* allocate mutex array, if required */</span></div>
<div class="line"><span class="lineno">16866</span>    <span class="keywordflow">if</span> (num_locks == 0) {</div>
<div class="line"><span class="lineno">16867</span>        <span class="comment">/* No mutex array required */</span></div>
<div class="line"><span class="lineno">16868</span>        <a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16869</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16870</span>        <span class="comment">/* Mutex array required - allocate it */</span></div>
<div class="line"><span class="lineno">16871</span>        <a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a> = (pthread_mutex_t *)<a class="code hl_function" href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a>(size);</div>
<div class="line"><span class="lineno">16872</span> </div>
<div class="line"><span class="lineno">16873</span>        <span class="comment">/* Check OOM */</span></div>
<div class="line"><span class="lineno">16874</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16875</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">16876</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">16877</span>                        ebuf,</div>
<div class="line"><span class="lineno">16878</span>                        ebuf_len,</div>
<div class="line"><span class="lineno">16879</span>                        <span class="stringliteral">&quot;%s: cannot allocate mutexes: %s&quot;</span>,</div>
<div class="line"><span class="lineno">16880</span>                        __func__,</div>
<div class="line"><span class="lineno">16881</span>                        <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">16882</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">16883</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16884</span>        }</div>
<div class="line"><span class="lineno">16885</span> </div>
<div class="line"><span class="lineno">16886</span>        <span class="comment">/* initialize mutex array */</span></div>
<div class="line"><span class="lineno">16887</span>        <span class="keywordflow">for</span> (i = 0; i &lt; num_locks; i++) {</div>
<div class="line"><span class="lineno">16888</span>            <span class="keywordflow">if</span> (0 != pthread_mutex_init(&amp;<a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a>[i], &amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>)) {</div>
<div class="line"><span class="lineno">16889</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">16890</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">16891</span>                            ebuf,</div>
<div class="line"><span class="lineno">16892</span>                            ebuf_len,</div>
<div class="line"><span class="lineno">16893</span>                            <span class="stringliteral">&quot;%s: error initializing mutex %i of %i&quot;</span>,</div>
<div class="line"><span class="lineno">16894</span>                            __func__,</div>
<div class="line"><span class="lineno">16895</span>                            i,</div>
<div class="line"><span class="lineno">16896</span>                            num_locks);</div>
<div class="line"><span class="lineno">16897</span>                <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">16898</span>                <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(<a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a>);</div>
<div class="line"><span class="lineno">16899</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16900</span>            }</div>
<div class="line"><span class="lineno">16901</span>        }</div>
<div class="line"><span class="lineno">16902</span>    }</div>
<div class="line"><span class="lineno">16903</span> </div>
<div class="line"><span class="lineno">16904</span>    CRYPTO_set_locking_callback(&amp;<a class="code hl_function" href="#a1483ed6424f4762bba17221c2be5e7b1">ssl_locking_callback</a>);</div>
<div class="line"><span class="lineno">16905</span>    CRYPTO_set_id_callback(&amp;<a class="code hl_function" href="#a4212925fe8cca547d2be85b99d8f7c56">mg_current_thread_id</a>);</div>
<div class="line"><span class="lineno">16906</span><span class="preprocessor">#endif </span><span class="comment">/* OPENSSL_API_1_1 || OPENSSL_API_3_0 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">16907</span> </div>
<div class="line"><span class="lineno">16908</span><span class="preprocessor">#if !defined(NO_SSL_DL)</span></div>
<div class="line"><span class="lineno">16909</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="#aeca28977786ca2960224e23c8c19d8ca">ssllib_dll_handle</a>) {</div>
<div class="line"><span class="lineno">16910</span>        <a class="code hl_variable" href="#aeca28977786ca2960224e23c8c19d8ca">ssllib_dll_handle</a> =</div>
<div class="line"><span class="lineno">16911</span>            <a class="code hl_function" href="#a7dcb20f5797258e244f21fc4d62ce828">load_tls_dll</a>(ebuf, ebuf_len, <a class="code hl_define" href="#a9822f5260f90216b615dd7435274a83a">SSL_LIB</a>, ssl_sw, tls_feature_missing);</div>
<div class="line"><span class="lineno">16912</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="#aeca28977786ca2960224e23c8c19d8ca">ssllib_dll_handle</a>) {</div>
<div class="line"><span class="lineno">16913</span><span class="preprocessor">#if !defined(OPENSSL_API_1_1)</span></div>
<div class="line"><span class="lineno">16914</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(<a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a>);</div>
<div class="line"><span class="lineno">16915</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">16916</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">16917</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16918</span>        }</div>
<div class="line"><span class="lineno">16919</span>    }</div>
<div class="line"><span class="lineno">16920</span><span class="preprocessor">#endif </span><span class="comment">/* NO_SSL_DL */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">16921</span> </div>
<div class="line"><span class="lineno">16922</span><span class="preprocessor">#if (defined(OPENSSL_API_1_1) || defined(OPENSSL_API_3_0))                     \</span></div>
<div class="line"><span class="lineno">16923</span><span class="preprocessor">    &amp;&amp; !defined(NO_SSL_DL)</span></div>
<div class="line"><span class="lineno">16924</span>    <span class="comment">/* Initialize SSL library */</span></div>
<div class="line"><span class="lineno">16925</span>    OPENSSL_init_ssl(0, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">16926</span>    OPENSSL_init_ssl(OPENSSL_INIT_LOAD_SSL_STRINGS</div>
<div class="line"><span class="lineno">16927</span>                         | OPENSSL_INIT_LOAD_CRYPTO_STRINGS,</div>
<div class="line"><span class="lineno">16928</span>                     <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">16929</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">16930</span>    <span class="comment">/* Initialize SSL library */</span></div>
<div class="line"><span class="lineno">16931</span>    SSL_library_init();</div>
<div class="line"><span class="lineno">16932</span>    SSL_load_error_strings();</div>
<div class="line"><span class="lineno">16933</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">16934</span> </div>
<div class="line"><span class="lineno">16935</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">16936</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a1483ed6424f4762bba17221c2be5e7b1"><div class="ttname"><a href="#a1483ed6424f4762bba17221c2be5e7b1">ssl_locking_callback</a></div><div class="ttdeci">static void ssl_locking_callback(int mode, int mutex_num, const char *file, int line)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16697">civetweb.c:16697</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a4212925fe8cca547d2be85b99d8f7c56"><div class="ttname"><a href="#a4212925fe8cca547d2be85b99d8f7c56">mg_current_thread_id</a></div><div class="ttdeci">static FUNCTION_MAY_BE_UNUSED unsigned long mg_current_thread_id(void)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01626">civetweb.c:1626</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a4bb32ca4bd6292bd0d47491d9b7b3996"><div class="ttname"><a href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a></div><div class="ttdeci">static pthread_mutex_t * ssl_mutexes</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16451">civetweb.c:16451</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a5254c431a0b51011fbb000d383bf56fd"><div class="ttname"><a href="#a5254c431a0b51011fbb000d383bf56fd">cryptolib_users</a></div><div class="ttdeci">static volatile ptrdiff_t cryptolib_users</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16815">civetweb.c:16815</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a52cf22e0f16c8a5c8c60788eec654e30"><div class="ttname"><a href="#a52cf22e0f16c8a5c8c60788eec654e30">CRYPTO_LIB</a></div><div class="ttdeci">#define CRYPTO_LIB</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00911">civetweb.c:911</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a5fea1ce44dd3b119b5edd85d330d8143"><div class="ttname"><a href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a></div><div class="ttdeci">static pthread_mutexattr_t pthread_mutex_attr</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01074">civetweb.c:1074</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a7dcb20f5797258e244f21fc4d62ce828"><div class="ttname"><a href="#a7dcb20f5797258e244f21fc4d62ce828">load_tls_dll</a></div><div class="ttdeci">static void * load_tls_dll(char *ebuf, size_t ebuf_len, const char *dll_name, struct ssl_func *sw, int *feature_missing)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16715">civetweb.c:16715</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a9822f5260f90216b615dd7435274a83a"><div class="ttname"><a href="#a9822f5260f90216b615dd7435274a83a">SSL_LIB</a></div><div class="ttdeci">#define SSL_LIB</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00908">civetweb.c:908</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac84429c87794be46b88e30fbd3b0bcfa"><div class="ttname"><a href="#ac84429c87794be46b88e30fbd3b0bcfa">mg_atomic_inc</a></div><div class="ttdeci">static FUNCTION_MAY_BE_UNUSED ptrdiff_t mg_atomic_inc(volatile ptrdiff_t *addr)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01121">civetweb.c:1121</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad6ec95caddfbfbbe177b2e95ec9d17b3"><div class="ttname"><a href="#ad6ec95caddfbfbbe177b2e95ec9d17b3">cryptolib_dll_handle</a></div><div class="ttdeci">static void * cryptolib_dll_handle</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16806">civetweb.c:16806</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aeca28977786ca2960224e23c8c19d8ca"><div class="ttname"><a href="#aeca28977786ca2960224e23c8c19d8ca">ssllib_dll_handle</a></div><div class="ttdeci">static void * ssllib_dll_handle</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16805">civetweb.c:16805</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00911">CRYPTO_LIB</a>, <a class="el" href="civetweb_8c_source.html#l16806">cryptolib_dll_handle</a>, <a class="el" href="civetweb_8c_source.html#l16815">cryptolib_users</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l16715">load_tls_dll()</a>, <a class="el" href="civetweb_8c_source.html#l01121">mg_atomic_inc()</a>, <a class="el" href="civetweb_8c_source.html#l01626">mg_current_thread_id()</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01474">mg_malloc()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01074">pthread_mutex_attr</a>, <a class="el" href="civetweb_8c_source.html#l16585">ssl_error()</a>, <a class="el" href="civetweb_8c_source.html#l00908">SSL_LIB</a>, <a class="el" href="civetweb_8c_source.html#l16697">ssl_locking_callback()</a>, <a class="el" href="civetweb_8c_source.html#l16451">ssl_mutexes</a>, and <a class="el" href="civetweb_8c_source.html#l16805">ssllib_dll_handle</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17485">init_ssl_ctx()</a>, and <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>.</p>

</div>
</div>
<a id="ab1681f675e3235a77787a2a174e1f9a5" name="ab1681f675e3235a77787a2a174e1f9a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1681f675e3235a77787a2a174e1f9a5">&#9670;&#160;</a></span>interpret_uri()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void interpret_uri </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>filename</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>filename_buf_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *</td>          <td class="paramname"><span class="paramname"><em>filestat</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>is_found</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>is_script_resource</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>is_websocket_request</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>is_put_or_delete_request</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>is_webdav_request</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>is_template_text</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07622">7622</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7633</span>{</div>
<div class="line"><span class="lineno"> 7634</span>    <span class="keywordtype">char</span> <span class="keyword">const</span> *accept_encoding;</div>
<div class="line"><span class="lineno"> 7635</span> </div>
<div class="line"><span class="lineno"> 7636</span><span class="preprocessor">#if !defined(NO_FILES)</span></div>
<div class="line"><span class="lineno"> 7637</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *uri = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>;</div>
<div class="line"><span class="lineno"> 7638</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *root = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>];</div>
<div class="line"><span class="lineno"> 7639</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *rewrite;</div>
<div class="line"><span class="lineno"> 7640</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> <a class="code hl_class" href="classa.html">a</a>, b;</div>
<div class="line"><span class="lineno"> 7641</span>    ptrdiff_t match_len;</div>
<div class="line"><span class="lineno"> 7642</span>    <span class="keywordtype">char</span> gz_path[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>];</div>
<div class="line"><span class="lineno"> 7643</span>    <span class="keywordtype">int</span> truncated;</div>
<div class="line"><span class="lineno"> 7644</span><span class="preprocessor">#if !defined(NO_CGI) || defined(USE_LUA) || defined(USE_DUKTAPE)</span></div>
<div class="line"><span class="lineno"> 7645</span>    <span class="keywordtype">char</span> *tmp_str;</div>
<div class="line"><span class="lineno"> 7646</span>    <span class="keywordtype">size_t</span> tmp_str_len, sep_pos;</div>
<div class="line"><span class="lineno"> 7647</span>    <span class="keywordtype">int</span> allow_substitute_script_subresources;</div>
<div class="line"><span class="lineno"> 7648</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 7649</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 7650</span>    (void)filename_buf_len; <span class="comment">/* unused if NO_FILES is defined */</span></div>
<div class="line"><span class="lineno"> 7651</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 7652</span> </div>
<div class="line"><span class="lineno"> 7653</span>    <span class="comment">/* Step 1: Set all initially unknown outputs to zero */</span></div>
<div class="line"><span class="lineno"> 7654</span>    memset(filestat, 0, <span class="keyword">sizeof</span>(*filestat));</div>
<div class="line"><span class="lineno"> 7655</span>    *filename = 0;</div>
<div class="line"><span class="lineno"> 7656</span>    *is_found = 0;</div>
<div class="line"><span class="lineno"> 7657</span>    *is_script_resource = 0;</div>
<div class="line"><span class="lineno"> 7658</span>    *is_template_text = 0;</div>
<div class="line"><span class="lineno"> 7659</span> </div>
<div class="line"><span class="lineno"> 7660</span>    <span class="comment">/* Step 2: Classify the request method */</span></div>
<div class="line"><span class="lineno"> 7661</span>    <span class="comment">/* Step 2a: Check if the request attempts to modify the file system */</span></div>
<div class="line"><span class="lineno"> 7662</span>    *is_put_or_delete_request = <a class="code hl_function" href="#ab8aa528da861495a7c5655dd89eaecb1">is_put_or_delete_method</a>(conn);</div>
<div class="line"><span class="lineno"> 7663</span>    <span class="comment">/* Step 2b: Check if the request uses WebDav method that requires special</span></div>
<div class="line"><span class="lineno"> 7664</span><span class="comment">     * handling */</span></div>
<div class="line"><span class="lineno"> 7665</span>    *is_webdav_request = <a class="code hl_function" href="#a1b3a33060a5555c75a320a23898c056f">is_civetweb_webdav_method</a>(conn);</div>
<div class="line"><span class="lineno"> 7666</span> </div>
<div class="line"><span class="lineno"> 7667</span>    <span class="comment">/* Step 3: Check if it is a websocket request, and modify the document</span></div>
<div class="line"><span class="lineno"> 7668</span><span class="comment">     * root if required */</span></div>
<div class="line"><span class="lineno"> 7669</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno"> 7670</span>    *is_websocket_request = (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436">PROTOCOL_TYPE_WEBSOCKET</a>);</div>
<div class="line"><span class="lineno"> 7671</span><span class="preprocessor">#if !defined(NO_FILES)</span></div>
<div class="line"><span class="lineno"> 7672</span>    <span class="keywordflow">if</span> ((*is_websocket_request) &amp;&amp; conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[WEBSOCKET_ROOT]) {</div>
<div class="line"><span class="lineno"> 7673</span>        root = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[WEBSOCKET_ROOT];</div>
<div class="line"><span class="lineno"> 7674</span>    }</div>
<div class="line"><span class="lineno"> 7675</span><span class="preprocessor">#endif </span><span class="comment">/* !NO_FILES */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 7676</span><span class="preprocessor">#else  </span><span class="comment">/* USE_WEBSOCKET */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 7677</span>    *is_websocket_request = 0;</div>
<div class="line"><span class="lineno"> 7678</span><span class="preprocessor">#endif </span><span class="comment">/* USE_WEBSOCKET */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 7679</span> </div>
<div class="line"><span class="lineno"> 7680</span>    <span class="comment">/* Step 4: Check if gzip encoded response is allowed */</span></div>
<div class="line"><span class="lineno"> 7681</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa0fc1462c76f9504a16825147b8db3d1">accept_gzip</a> = 0;</div>
<div class="line"><span class="lineno"> 7682</span>    <span class="keywordflow">if</span> ((accept_encoding = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Accept-Encoding&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7683</span>        <span class="keywordflow">if</span> (strstr(accept_encoding, <span class="stringliteral">&quot;gzip&quot;</span>) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7684</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa0fc1462c76f9504a16825147b8db3d1">accept_gzip</a> = 1;</div>
<div class="line"><span class="lineno"> 7685</span>        }</div>
<div class="line"><span class="lineno"> 7686</span>    }</div>
<div class="line"><span class="lineno"> 7687</span> </div>
<div class="line"><span class="lineno"> 7688</span><span class="preprocessor">#if !defined(NO_FILES)</span></div>
<div class="line"><span class="lineno"> 7689</span>    <span class="comment">/* Step 5: If there is no root directory, don&#39;t look for files. */</span></div>
<div class="line"><span class="lineno"> 7690</span>    <span class="comment">/* Note that root == NULL is a regular use case here. This occurs,</span></div>
<div class="line"><span class="lineno"> 7691</span><span class="comment">     * if all requests are handled by callbacks, so the WEBSOCKET_ROOT</span></div>
<div class="line"><span class="lineno"> 7692</span><span class="comment">     * config is not required. */</span></div>
<div class="line"><span class="lineno"> 7693</span>    <span class="keywordflow">if</span> (root == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7694</span>        <span class="comment">/* all file related outputs have already been set to 0, just return</span></div>
<div class="line"><span class="lineno"> 7695</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 7696</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 7697</span>    }</div>
<div class="line"><span class="lineno"> 7698</span> </div>
<div class="line"><span class="lineno"> 7699</span>    <span class="comment">/* Step 6: Determine the local file path from the root path and the</span></div>
<div class="line"><span class="lineno"> 7700</span><span class="comment">     * request uri. */</span></div>
<div class="line"><span class="lineno"> 7701</span>    <span class="comment">/* Using filename_buf_len - 1 because memmove() for PATH_INFO may shift</span></div>
<div class="line"><span class="lineno"> 7702</span><span class="comment">     * part of the path one byte on the right. */</span></div>
<div class="line"><span class="lineno"> 7703</span>    truncated = 0;</div>
<div class="line"><span class="lineno"> 7704</span>    <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(</div>
<div class="line"><span class="lineno"> 7705</span>        conn, &amp;truncated, filename, filename_buf_len - 1, <span class="stringliteral">&quot;%s%s&quot;</span>, root, uri);</div>
<div class="line"><span class="lineno"> 7706</span> </div>
<div class="line"><span class="lineno"> 7707</span>    <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno"> 7708</span>        <span class="keywordflow">goto</span> interpret_cleanup;</div>
<div class="line"><span class="lineno"> 7709</span>    }</div>
<div class="line"><span class="lineno"> 7710</span> </div>
<div class="line"><span class="lineno"> 7711</span>    <span class="comment">/* Step 7: URI rewriting */</span></div>
<div class="line"><span class="lineno"> 7712</span>    rewrite = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba73b1fb0778577d79d9a9906538f397b7">URL_REWRITE_PATTERN</a>];</div>
<div class="line"><span class="lineno"> 7713</span>    <span class="keywordflow">while</span> ((rewrite = <a class="code hl_function" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a>(rewrite, &amp;<a class="code hl_class" href="classa.html">a</a>, &amp;b)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7714</span>        <span class="keywordflow">if</span> ((match_len = match_prefix(<a class="code hl_class" href="classa.html">a</a>.ptr, <a class="code hl_class" href="classa.html">a</a>.len, uri)) &gt; 0) {</div>
<div class="line"><span class="lineno"> 7715</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 7716</span>                        &amp;truncated,</div>
<div class="line"><span class="lineno"> 7717</span>                        filename,</div>
<div class="line"><span class="lineno"> 7718</span>                        filename_buf_len - 1,</div>
<div class="line"><span class="lineno"> 7719</span>                        <span class="stringliteral">&quot;%.*s%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 7720</span>                        (<span class="keywordtype">int</span>)b.len,</div>
<div class="line"><span class="lineno"> 7721</span>                        b.ptr,</div>
<div class="line"><span class="lineno"> 7722</span>                        uri + match_len);</div>
<div class="line"><span class="lineno"> 7723</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 7724</span>        }</div>
<div class="line"><span class="lineno"> 7725</span>    }</div>
<div class="line"><span class="lineno"> 7726</span> </div>
<div class="line"><span class="lineno"> 7727</span>    <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno"> 7728</span>        <span class="keywordflow">goto</span> interpret_cleanup;</div>
<div class="line"><span class="lineno"> 7729</span>    }</div>
<div class="line"><span class="lineno"> 7730</span> </div>
<div class="line"><span class="lineno"> 7731</span>    <span class="comment">/* Step 8: Check if the file exists at the server */</span></div>
<div class="line"><span class="lineno"> 7732</span>    <span class="comment">/* Local file path and name, corresponding to requested URI</span></div>
<div class="line"><span class="lineno"> 7733</span><span class="comment">     * is now stored in &quot;filename&quot; variable. */</span></div>
<div class="line"><span class="lineno"> 7734</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, filename, filestat)) {</div>
<div class="line"><span class="lineno"> 7735</span>        <span class="keywordtype">int</span> uri_len = (int)strlen(uri);</div>
<div class="line"><span class="lineno"> 7736</span>        <span class="keywordtype">int</span> is_uri_end_slash = (uri_len &gt; 0) &amp;&amp; (uri[uri_len - 1] == <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno"> 7737</span> </div>
<div class="line"><span class="lineno"> 7738</span>        <span class="comment">/* 8.1: File exists. */</span></div>
<div class="line"><span class="lineno"> 7739</span>        *is_found = 1;</div>
<div class="line"><span class="lineno"> 7740</span> </div>
<div class="line"><span class="lineno"> 7741</span>        <span class="comment">/* 8.2: Check if it is a script type. */</span></div>
<div class="line"><span class="lineno"> 7742</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5e07d608a1551b747130ac4f1e41f547">extention_matches_script</a>(conn, filename)) {</div>
<div class="line"><span class="lineno"> 7743</span>            <span class="comment">/* The request addresses a CGI resource, Lua script or</span></div>
<div class="line"><span class="lineno"> 7744</span><span class="comment">             * server-side javascript.</span></div>
<div class="line"><span class="lineno"> 7745</span><span class="comment">             * The URI corresponds to the script itself (like</span></div>
<div class="line"><span class="lineno"> 7746</span><span class="comment">             * /path/script.cgi), and there is no additional resource</span></div>
<div class="line"><span class="lineno"> 7747</span><span class="comment">             * path (like /path/script.cgi/something).</span></div>
<div class="line"><span class="lineno"> 7748</span><span class="comment">             * Requests that modify (replace or delete) a resource, like</span></div>
<div class="line"><span class="lineno"> 7749</span><span class="comment">             * PUT and DELETE requests, should replace/delete the script</span></div>
<div class="line"><span class="lineno"> 7750</span><span class="comment">             * file.</span></div>
<div class="line"><span class="lineno"> 7751</span><span class="comment">             * Requests that read or write from/to a resource, like GET and</span></div>
<div class="line"><span class="lineno"> 7752</span><span class="comment">             * POST requests, should call the script and return the</span></div>
<div class="line"><span class="lineno"> 7753</span><span class="comment">             * generated response. */</span></div>
<div class="line"><span class="lineno"> 7754</span>            *is_script_resource = (!*is_put_or_delete_request);</div>
<div class="line"><span class="lineno"> 7755</span>        }</div>
<div class="line"><span class="lineno"> 7756</span> </div>
<div class="line"><span class="lineno"> 7757</span>        <span class="comment">/* 8.3: Check for SSI and LSP files */</span></div>
<div class="line"><span class="lineno"> 7758</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac32269ba42b000939c92b695049fe0be">extention_matches_template_text</a>(conn, filename)) {</div>
<div class="line"><span class="lineno"> 7759</span>            <span class="comment">/* Same as above, but for *.lsp and *.shtml files. */</span></div>
<div class="line"><span class="lineno"> 7760</span>            <span class="comment">/* A &quot;template text&quot; is a file delivered directly to the client,</span></div>
<div class="line"><span class="lineno"> 7761</span><span class="comment">             * but with some text tags replaced by dynamic content.</span></div>
<div class="line"><span class="lineno"> 7762</span><span class="comment">             * E.g. a Server Side Include (SSI) or Lua Page/Lua Server Page</span></div>
<div class="line"><span class="lineno"> 7763</span><span class="comment">             * (LP, LSP) file. */</span></div>
<div class="line"><span class="lineno"> 7764</span>            *is_template_text = (!*is_put_or_delete_request);</div>
<div class="line"><span class="lineno"> 7765</span>        }</div>
<div class="line"><span class="lineno"> 7766</span> </div>
<div class="line"><span class="lineno"> 7767</span>        <span class="comment">/* 8.4: If the request target is a directory, there could be</span></div>
<div class="line"><span class="lineno"> 7768</span><span class="comment">         * a substitute file (index.html, index.cgi, ...). */</span></div>
<div class="line"><span class="lineno"> 7769</span>        <span class="comment">/* But do not substitute a directory for a WebDav request */</span></div>
<div class="line"><span class="lineno"> 7770</span>        <span class="keywordflow">if</span> (filestat-&gt;<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a> &amp;&amp; is_uri_end_slash</div>
<div class="line"><span class="lineno"> 7771</span>            &amp;&amp; (!*is_webdav_request)) {</div>
<div class="line"><span class="lineno"> 7772</span>            <span class="comment">/* Use a local copy here, since substitute_index_file will</span></div>
<div class="line"><span class="lineno"> 7773</span><span class="comment">             * change the content of the file status */</span></div>
<div class="line"><span class="lineno"> 7774</span>            <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file__stat.html">mg_file_stat</a> tmp_filestat;</div>
<div class="line"><span class="lineno"> 7775</span>            memset(&amp;tmp_filestat, 0, <span class="keyword">sizeof</span>(tmp_filestat));</div>
<div class="line"><span class="lineno"> 7776</span> </div>
<div class="line"><span class="lineno"> 7777</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#af6b0cd03c015fee859606ab8b09db8e0">substitute_index_file</a>(</div>
<div class="line"><span class="lineno"> 7778</span>                    conn, filename, filename_buf_len, &amp;tmp_filestat)) {</div>
<div class="line"><span class="lineno"> 7779</span> </div>
<div class="line"><span class="lineno"> 7780</span>                <span class="comment">/* Substitute file found. Copy stat to the output, then</span></div>
<div class="line"><span class="lineno"> 7781</span><span class="comment">                 * check if the file is a script file */</span></div>
<div class="line"><span class="lineno"> 7782</span>                *filestat = tmp_filestat;</div>
<div class="line"><span class="lineno"> 7783</span> </div>
<div class="line"><span class="lineno"> 7784</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5e07d608a1551b747130ac4f1e41f547">extention_matches_script</a>(conn, filename)) {</div>
<div class="line"><span class="lineno"> 7785</span>                    <span class="comment">/* Substitute file is a script file */</span></div>
<div class="line"><span class="lineno"> 7786</span>                    *is_script_resource = 1;</div>
<div class="line"><span class="lineno"> 7787</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac32269ba42b000939c92b695049fe0be">extention_matches_template_text</a>(conn, filename)) {</div>
<div class="line"><span class="lineno"> 7788</span>                    <span class="comment">/* Substitute file is a LSP or SSI file */</span></div>
<div class="line"><span class="lineno"> 7789</span>                    *is_template_text = 1;</div>
<div class="line"><span class="lineno"> 7790</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 7791</span>                    <span class="comment">/* Substitute file is a regular file */</span></div>
<div class="line"><span class="lineno"> 7792</span>                    *is_script_resource = 0;</div>
<div class="line"><span class="lineno"> 7793</span>                    *is_found = (<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, filename, filestat) ? 1 : 0);</div>
<div class="line"><span class="lineno"> 7794</span>                }</div>
<div class="line"><span class="lineno"> 7795</span>            }</div>
<div class="line"><span class="lineno"> 7796</span>            <span class="comment">/* If there is no substitute file, the server could return</span></div>
<div class="line"><span class="lineno"> 7797</span><span class="comment">             * a directory listing in a later step */</span></div>
<div class="line"><span class="lineno"> 7798</span>        }</div>
<div class="line"><span class="lineno"> 7799</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 7800</span>    }</div>
<div class="line"><span class="lineno"> 7801</span> </div>
<div class="line"><span class="lineno"> 7802</span>    <span class="comment">/* Step 9: Check for zipped files: */</span></div>
<div class="line"><span class="lineno"> 7803</span>    <span class="comment">/* If we can&#39;t find the actual file, look for the file</span></div>
<div class="line"><span class="lineno"> 7804</span><span class="comment">     * with the same name but a .gz extension. If we find it,</span></div>
<div class="line"><span class="lineno"> 7805</span><span class="comment">     * use that and set the gzipped flag in the file struct</span></div>
<div class="line"><span class="lineno"> 7806</span><span class="comment">     * to indicate that the response need to have the content-</span></div>
<div class="line"><span class="lineno"> 7807</span><span class="comment">     * encoding: gzip header.</span></div>
<div class="line"><span class="lineno"> 7808</span><span class="comment">     * We can only do this if the browser declares support. */</span></div>
<div class="line"><span class="lineno"> 7809</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa0fc1462c76f9504a16825147b8db3d1">accept_gzip</a>) {</div>
<div class="line"><span class="lineno"> 7810</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(</div>
<div class="line"><span class="lineno"> 7811</span>            conn, &amp;truncated, gz_path, <span class="keyword">sizeof</span>(gz_path), <span class="stringliteral">&quot;%s.gz&quot;</span>, filename);</div>
<div class="line"><span class="lineno"> 7812</span> </div>
<div class="line"><span class="lineno"> 7813</span>        <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno"> 7814</span>            <span class="keywordflow">goto</span> interpret_cleanup;</div>
<div class="line"><span class="lineno"> 7815</span>        }</div>
<div class="line"><span class="lineno"> 7816</span> </div>
<div class="line"><span class="lineno"> 7817</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, gz_path, filestat)) {</div>
<div class="line"><span class="lineno"> 7818</span>            <span class="keywordflow">if</span> (filestat) {</div>
<div class="line"><span class="lineno"> 7819</span>                filestat-&gt;<a class="code hl_variable" href="structmg__file__stat.html#ad44111c877cb3ec536731c125b4589ef">is_gzipped</a> = 1;</div>
<div class="line"><span class="lineno"> 7820</span>                *is_found = 1;</div>
<div class="line"><span class="lineno"> 7821</span>            }</div>
<div class="line"><span class="lineno"> 7822</span>            <span class="comment">/* Currently gz files can not be scripts. */</span></div>
<div class="line"><span class="lineno"> 7823</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 7824</span>        }</div>
<div class="line"><span class="lineno"> 7825</span>    }</div>
<div class="line"><span class="lineno"> 7826</span> </div>
<div class="line"><span class="lineno"> 7827</span><span class="preprocessor">#if !defined(NO_CGI) || defined(USE_LUA) || defined(USE_DUKTAPE)</span></div>
<div class="line"><span class="lineno"> 7828</span>    <span class="comment">/* Step 10: Script resources may handle sub-resources */</span></div>
<div class="line"><span class="lineno"> 7829</span>    <span class="comment">/* Support PATH_INFO for CGI scripts. */</span></div>
<div class="line"><span class="lineno"> 7830</span>    tmp_str_len = strlen(filename);</div>
<div class="line"><span class="lineno"> 7831</span>    tmp_str =</div>
<div class="line"><span class="lineno"> 7832</span>        (<span class="keywordtype">char</span> *)<a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(tmp_str_len + <a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a> + 1, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno"> 7833</span>    <span class="keywordflow">if</span> (!tmp_str) {</div>
<div class="line"><span class="lineno"> 7834</span>        <span class="comment">/* Out of memory */</span></div>
<div class="line"><span class="lineno"> 7835</span>        <span class="keywordflow">goto</span> interpret_cleanup;</div>
<div class="line"><span class="lineno"> 7836</span>    }</div>
<div class="line"><span class="lineno"> 7837</span>    memcpy(tmp_str, filename, tmp_str_len + 1);</div>
<div class="line"><span class="lineno"> 7838</span> </div>
<div class="line"><span class="lineno"> 7839</span>    <span class="comment">/* Check config, if index scripts may have sub-resources */</span></div>
<div class="line"><span class="lineno"> 7840</span>    allow_substitute_script_subresources =</div>
<div class="line"><span class="lineno"> 7841</span>        !<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba2b3396fe44b8e2601349457d7357f6cc">ALLOW_INDEX_SCRIPT_SUB_RES</a>],</div>
<div class="line"><span class="lineno"> 7842</span>                       <span class="stringliteral">&quot;yes&quot;</span>);</div>
<div class="line"><span class="lineno"> 7843</span>    <span class="keywordflow">if</span> (*is_webdav_request) {</div>
<div class="line"><span class="lineno"> 7844</span>        <span class="comment">/* TO BE DEFINED: Should scripts handle special WebDAV methods lile</span></div>
<div class="line"><span class="lineno"> 7845</span><span class="comment">         * PROPFIND for their subresources? */</span></div>
<div class="line"><span class="lineno"> 7846</span>        <span class="comment">/* allow_substitute_script_subresources = 0; */</span></div>
<div class="line"><span class="lineno"> 7847</span>    }</div>
<div class="line"><span class="lineno"> 7848</span> </div>
<div class="line"><span class="lineno"> 7849</span>    sep_pos = tmp_str_len;</div>
<div class="line"><span class="lineno"> 7850</span>    <span class="keywordflow">while</span> (sep_pos &gt; 0) {</div>
<div class="line"><span class="lineno"> 7851</span>        sep_pos--;</div>
<div class="line"><span class="lineno"> 7852</span>        <span class="keywordflow">if</span> (tmp_str[sep_pos] == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno"> 7853</span>            <span class="keywordtype">int</span> is_script = 0, does_exist = 0;</div>
<div class="line"><span class="lineno"> 7854</span> </div>
<div class="line"><span class="lineno"> 7855</span>            tmp_str[sep_pos] = 0;</div>
<div class="line"><span class="lineno"> 7856</span>            <span class="keywordflow">if</span> (tmp_str[0]) {</div>
<div class="line"><span class="lineno"> 7857</span>                is_script = <a class="code hl_function" href="#a5e07d608a1551b747130ac4f1e41f547">extention_matches_script</a>(conn, tmp_str);</div>
<div class="line"><span class="lineno"> 7858</span>                does_exist = <a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, tmp_str, filestat);</div>
<div class="line"><span class="lineno"> 7859</span>            }</div>
<div class="line"><span class="lineno"> 7860</span> </div>
<div class="line"><span class="lineno"> 7861</span>            <span class="keywordflow">if</span> (does_exist &amp;&amp; is_script) {</div>
<div class="line"><span class="lineno"> 7862</span>                filename[sep_pos] = 0;</div>
<div class="line"><span class="lineno"> 7863</span>                memmove(filename + sep_pos + 2,</div>
<div class="line"><span class="lineno"> 7864</span>                        filename + sep_pos + 1,</div>
<div class="line"><span class="lineno"> 7865</span>                        strlen(filename + sep_pos + 1) + 1);</div>
<div class="line"><span class="lineno"> 7866</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a> = filename + sep_pos + 1;</div>
<div class="line"><span class="lineno"> 7867</span>                filename[sep_pos + 1] = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno"> 7868</span>                *is_script_resource = 1;</div>
<div class="line"><span class="lineno"> 7869</span>                *is_found = 1;</div>
<div class="line"><span class="lineno"> 7870</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 7871</span>            }</div>
<div class="line"><span class="lineno"> 7872</span> </div>
<div class="line"><span class="lineno"> 7873</span>            <span class="keywordflow">if</span> (allow_substitute_script_subresources) {</div>
<div class="line"><span class="lineno"> 7874</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="#af6b0cd03c015fee859606ab8b09db8e0">substitute_index_file</a>(</div>
<div class="line"><span class="lineno"> 7875</span>                        conn, tmp_str, tmp_str_len + <a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>, filestat)) {</div>
<div class="line"><span class="lineno"> 7876</span> </div>
<div class="line"><span class="lineno"> 7877</span>                    <span class="comment">/* some intermediate directory has an index file */</span></div>
<div class="line"><span class="lineno"> 7878</span>                    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5e07d608a1551b747130ac4f1e41f547">extention_matches_script</a>(conn, tmp_str)) {</div>
<div class="line"><span class="lineno"> 7879</span> </div>
<div class="line"><span class="lineno"> 7880</span>                        <span class="keywordtype">size_t</span> script_name_len = strlen(tmp_str);</div>
<div class="line"><span class="lineno"> 7881</span> </div>
<div class="line"><span class="lineno"> 7882</span>                        <span class="comment">/* subres_name read before this memory locatio will be</span></div>
<div class="line"><span class="lineno"> 7883</span><span class="comment">                        overwritten */</span></div>
<div class="line"><span class="lineno"> 7884</span>                        <span class="keywordtype">char</span> *subres_name = filename + sep_pos;</div>
<div class="line"><span class="lineno"> 7885</span>                        <span class="keywordtype">size_t</span> subres_name_len = strlen(subres_name);</div>
<div class="line"><span class="lineno"> 7886</span> </div>
<div class="line"><span class="lineno"> 7887</span>                        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Substitute script %s serving path %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 7888</span>                                    tmp_str,</div>
<div class="line"><span class="lineno"> 7889</span>                                    filename);</div>
<div class="line"><span class="lineno"> 7890</span> </div>
<div class="line"><span class="lineno"> 7891</span>                        <span class="comment">/* this index file is a script */</span></div>
<div class="line"><span class="lineno"> 7892</span>                        <span class="keywordflow">if</span> ((script_name_len + subres_name_len + 2)</div>
<div class="line"><span class="lineno"> 7893</span>                            &gt;= filename_buf_len) {</div>
<div class="line"><span class="lineno"> 7894</span>                            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(tmp_str);</div>
<div class="line"><span class="lineno"> 7895</span>                            <span class="keywordflow">goto</span> interpret_cleanup;</div>
<div class="line"><span class="lineno"> 7896</span>                        }</div>
<div class="line"><span class="lineno"> 7897</span> </div>
<div class="line"><span class="lineno"> 7898</span>                        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a> =</div>
<div class="line"><span class="lineno"> 7899</span>                            filename + script_name_len + 1; <span class="comment">/* new target */</span></div>
<div class="line"><span class="lineno"> 7900</span>                        memmove(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a>, subres_name, subres_name_len);</div>
<div class="line"><span class="lineno"> 7901</span>                        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a>[subres_name_len] = 0;</div>
<div class="line"><span class="lineno"> 7902</span>                        memcpy(filename, tmp_str, script_name_len + 1);</div>
<div class="line"><span class="lineno"> 7903</span> </div>
<div class="line"><span class="lineno"> 7904</span>                        *is_script_resource = 1;</div>
<div class="line"><span class="lineno"> 7905</span>                        *is_found = 1;</div>
<div class="line"><span class="lineno"> 7906</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 7907</span> </div>
<div class="line"><span class="lineno"> 7908</span>                    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 7909</span> </div>
<div class="line"><span class="lineno"> 7910</span>                        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Substitute file %s serving path %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 7911</span>                                    tmp_str,</div>
<div class="line"><span class="lineno"> 7912</span>                                    filename);</div>
<div class="line"><span class="lineno"> 7913</span> </div>
<div class="line"><span class="lineno"> 7914</span>                        <span class="comment">/* non-script files will not have sub-resources */</span></div>
<div class="line"><span class="lineno"> 7915</span>                        filename[sep_pos] = 0;</div>
<div class="line"><span class="lineno"> 7916</span>                        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a> = 0;</div>
<div class="line"><span class="lineno"> 7917</span>                        *is_script_resource = 0;</div>
<div class="line"><span class="lineno"> 7918</span>                        *is_found = 0;</div>
<div class="line"><span class="lineno"> 7919</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 7920</span>                    }</div>
<div class="line"><span class="lineno"> 7921</span>                }</div>
<div class="line"><span class="lineno"> 7922</span>            }</div>
<div class="line"><span class="lineno"> 7923</span> </div>
<div class="line"><span class="lineno"> 7924</span>            tmp_str[sep_pos] = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno"> 7925</span>        }</div>
<div class="line"><span class="lineno"> 7926</span>    }</div>
<div class="line"><span class="lineno"> 7927</span> </div>
<div class="line"><span class="lineno"> 7928</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(tmp_str);</div>
<div class="line"><span class="lineno"> 7929</span> </div>
<div class="line"><span class="lineno"> 7930</span><span class="preprocessor">#endif </span><span class="comment">/* !defined(NO_CGI) || defined(USE_LUA) || defined(USE_DUKTAPE) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 7931</span><span class="preprocessor">#endif </span><span class="comment">/* !defined(NO_FILES) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 7932</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 7933</span> </div>
<div class="line"><span class="lineno"> 7934</span><span class="preprocessor">#if !defined(NO_FILES)</span></div>
<div class="line"><span class="lineno"> 7935</span><span class="comment">/* Reset all outputs */</span></div>
<div class="line"><span class="lineno"> 7936</span>interpret_cleanup:</div>
<div class="line"><span class="lineno"> 7937</span>    memset(filestat, 0, <span class="keyword">sizeof</span>(*filestat));</div>
<div class="line"><span class="lineno"> 7938</span>    *filename = 0;</div>
<div class="line"><span class="lineno"> 7939</span>    *is_found = 0;</div>
<div class="line"><span class="lineno"> 7940</span>    *is_script_resource = 0;</div>
<div class="line"><span class="lineno"> 7941</span>    *is_websocket_request = 0;</div>
<div class="line"><span class="lineno"> 7942</span>    *is_put_or_delete_request = 0;</div>
<div class="line"><span class="lineno"> 7943</span><span class="preprocessor">#endif </span><span class="comment">/* !defined(NO_FILES) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 7944</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a1b3a33060a5555c75a320a23898c056f"><div class="ttname"><a href="#a1b3a33060a5555c75a320a23898c056f">is_civetweb_webdav_method</a></div><div class="ttdeci">static int is_civetweb_webdav_method(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07482">civetweb.c:7482</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a5e07d608a1551b747130ac4f1e41f547"><div class="ttname"><a href="#a5e07d608a1551b747130ac4f1e41f547">extention_matches_script</a></div><div class="ttdeci">static int extention_matches_script(struct mg_connection *conn, const char *filename)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07504">civetweb.c:7504</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac32269ba42b000939c92b695049fe0be"><div class="ttname"><a href="#ac32269ba42b000939c92b695049fe0be">extention_matches_template_text</a></div><div class="ttdeci">static int extention_matches_template_text(struct mg_connection *conn, const char *filename)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07550">civetweb.c:7550</a></div></div>
<div class="ttc" id="acivetweb_8c_html_af6b0cd03c015fee859606ab8b09db8e0"><div class="ttname"><a href="#af6b0cd03c015fee859606ab8b09db8e0">substitute_index_file</a></div><div class="ttdeci">static int substitute_index_file(struct mg_connection *conn, char *path, size_t path_len, struct mg_file_stat *filestat)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07574">civetweb.c:7574</a></div></div>
<div class="ttc" id="astructmg__connection_html_a450fa6c33039516685824a5f7fbdcec5"><div class="ttname"><a href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">mg_connection::path_info</a></div><div class="ttdeci">char * path_info</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02533">civetweb.c:2533</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02536">mg_connection::accept_gzip</a>, <a class="el" href="civetweb_8c_source.html#l02053">ALLOW_INDEX_SCRIPT_SUB_RES</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l01954">DOCUMENT_ROOT</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l07504">extention_matches_script()</a>, <a class="el" href="civetweb_8c_source.html#l07550">extention_matches_template_text()</a>, <a class="el" href="civetweb_8c_source.html#l07482">is_civetweb_webdav_method()</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l01874">mg_file_stat::is_gzipped</a>, <a class="el" href="civetweb_8c_source.html#l07464">is_put_or_delete_method()</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8c_source.html#l01497">mg_malloc_ctx</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l03899">next_option()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02533">mg_connection::path_info</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, <a class="el" href="civetweb_8c_source.html#l02467">PROTOCOL_TYPE_WEBSOCKET</a>, <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l07574">substitute_index_file()</a>, <a class="el" href="civetweb_8c_source.html#l02010">URL_REWRITE_PATTERN</a>, and <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a01cd34a432a273eba4e48fb327503bc8" name="a01cd34a432a273eba4e48fb327503bc8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01cd34a432a273eba4e48fb327503bc8">&#9670;&#160;</a></span>is_authorized_for_put()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_authorized_for_put </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09035">9035</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9036</span>{</div>
<div class="line"><span class="lineno"> 9037</span>    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><span class="lineno"> 9038</span> </div>
<div class="line"><span class="lineno"> 9039</span>    <span class="keywordflow">if</span> (conn) {</div>
<div class="line"><span class="lineno"> 9040</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno"> 9041</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *passfile = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba9f0c9561bdb0b2b975178617c8d3c59a">PUT_DELETE_PASSWORDS_FILE</a>];</div>
<div class="line"><span class="lineno"> 9042</span> </div>
<div class="line"><span class="lineno"> 9043</span>        <span class="keywordflow">if</span> (passfile != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><span class="lineno"> 9044</span>            &amp;&amp; <a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, passfile, <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>, &amp;file)) {</div>
<div class="line"><span class="lineno"> 9045</span>            ret = <a class="code hl_function" href="#abbf5e7625b9c8d60ffc4d84b02923943">authorize</a>(conn, &amp;file, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 9046</span>            (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>); <span class="comment">/* ignore error on read only file */</span></div>
<div class="line"><span class="lineno"> 9047</span>        }</div>
<div class="line"><span class="lineno"> 9048</span>    }</div>
<div class="line"><span class="lineno"> 9049</span> </div>
<div class="line"><span class="lineno"> 9050</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;file write authorization: %i&quot;</span>, ret);</div>
<div class="line"><span class="lineno"> 9051</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno"> 9052</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l08861">authorize()</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02843">MG_FOPEN_MODE_READ</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01997">PUT_DELETE_PASSWORDS_FILE</a>, and <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a1b3a33060a5555c75a320a23898c056f" name="a1b3a33060a5555c75a320a23898c056f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b3a33060a5555c75a320a23898c056f">&#9670;&#160;</a></span>is_civetweb_webdav_method()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_civetweb_webdav_method </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07482">7482</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7483</span>{</div>
<div class="line"><span class="lineno"> 7484</span>    <span class="comment">/* Note: Here we only have to identify the WebDav methods that need special</span></div>
<div class="line"><span class="lineno"> 7485</span><span class="comment">     * handling in the CivetWeb code - not all methods used in WebDav. In</span></div>
<div class="line"><span class="lineno"> 7486</span><span class="comment">     * particular, methods used on directories (when using Windows Explorer as</span></div>
<div class="line"><span class="lineno"> 7487</span><span class="comment">     * WebDav client).</span></div>
<div class="line"><span class="lineno"> 7488</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 7489</span>    <span class="keywordflow">if</span> (conn) {</div>
<div class="line"><span class="lineno"> 7490</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>;</div>
<div class="line"><span class="lineno"> 7491</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7492</span>            <span class="comment">/* These are the civetweb builtin DAV methods */</span></div>
<div class="line"><span class="lineno"> 7493</span>            <span class="keywordflow">return</span> (!strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;PROPFIND&quot;</span>) || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;PROPPATCH&quot;</span>)</div>
<div class="line"><span class="lineno"> 7494</span>                    || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;LOCK&quot;</span>) || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;UNLOCK&quot;</span>)</div>
<div class="line"><span class="lineno"> 7495</span>                    || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;MOVE&quot;</span>) || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;COPY&quot;</span>));</div>
<div class="line"><span class="lineno"> 7496</span>        }</div>
<div class="line"><span class="lineno"> 7497</span>    }</div>
<div class="line"><span class="lineno"> 7498</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 7499</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, and <a class="el" href="multi_8h_source.html#l00318">s</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>.</p>

</div>
</div>
<a id="aabc2fa59339cbedec7cf5855e5e8e89c" name="aabc2fa59339cbedec7cf5855e5e8e89c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabc2fa59339cbedec7cf5855e5e8e89c">&#9670;&#160;</a></span>is_file_opened()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_file_opened </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__file__access.html">mg_file_access</a> *</td>          <td class="paramname"><span class="paramname"><em>fileacc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02853">2853</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2854</span>{</div>
<div class="line"><span class="lineno"> 2855</span>    <span class="keywordflow">if</span> (!fileacc) {</div>
<div class="line"><span class="lineno"> 2856</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2857</span>    }</div>
<div class="line"><span class="lineno"> 2858</span> </div>
<div class="line"><span class="lineno"> 2859</span>    <span class="keywordflow">return</span> (fileacc-&gt;<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 2860</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>.</p>

</div>
</div>
<a id="ac4e67843460a2634c2ccd7f1f0343877" name="ac4e67843460a2634c2ccd7f1f0343877"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4e67843460a2634c2ccd7f1f0343877">&#9670;&#160;</a></span>is_in_script_path()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_in_script_path </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14645">14645</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14646</span>{</div>
<div class="line"><span class="lineno">14647</span>    <span class="comment">/* TODO (Feature): Add config value for allowed script path.</span></div>
<div class="line"><span class="lineno">14648</span><span class="comment">     * Default: All allowed. */</span></div>
<div class="line"><span class="lineno">14649</span>    (void)conn;</div>
<div class="line"><span class="lineno">14650</span>    (void)path;</div>
<div class="line"><span class="lineno">14651</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">14652</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l15354">handle_file_based_request()</a>, and <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="aa81530fc67a88c3191c00c52ec06065b" name="aa81530fc67a88c3191c00c52ec06065b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa81530fc67a88c3191c00c52ec06065b">&#9670;&#160;</a></span>is_not_modified()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_not_modified </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *</td>          <td class="paramname"><span class="paramname"><em>filestat</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10468">10468</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10470</span>{</div>
<div class="line"><span class="lineno">10471</span>    <span class="keywordtype">char</span> etag[64];</div>
<div class="line"><span class="lineno">10472</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *ims = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;If-Modified-Since&quot;</span>);</div>
<div class="line"><span class="lineno">10473</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *inm = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;If-None-Match&quot;</span>);</div>
<div class="line"><span class="lineno">10474</span>    <a class="code hl_function" href="#ac715f770ccb10deba796a43cb10cfd46">construct_etag</a>(etag, <span class="keyword">sizeof</span>(etag), filestat);</div>
<div class="line"><span class="lineno">10475</span> </div>
<div class="line"><span class="lineno">10476</span>    <span class="keywordflow">return</span> ((inm != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; !<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(etag, inm))</div>
<div class="line"><span class="lineno">10477</span>           || ((ims != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">10478</span>               &amp;&amp; (filestat-&gt;<a class="code hl_variable" href="structmg__file__stat.html#aa767e15073ca34ce0bd9fdcfe05e6ddc">last_modified</a> &lt;= <a class="code hl_function" href="#a8d431c80187736408d57f4c83bcfa5a2">parse_date_string</a>(ims)));</div>
<div class="line"><span class="lineno">10479</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a8d431c80187736408d57f4c83bcfa5a2"><div class="ttname"><a href="#a8d431c80187736408d57f4c83bcfa5a2">parse_date_string</a></div><div class="ttdeci">static time_t parse_date_string(const char *datetime)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08005">civetweb.c:8005</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l10181">construct_etag()</a>, <a class="el" href="civetweb_8c_source.html#l01872">mg_file_stat::last_modified</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l08005">parse_date_string()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l15354">handle_file_based_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>.</p>

</div>
</div>
<a id="ab8aa528da861495a7c5655dd89eaecb1" name="ab8aa528da861495a7c5655dd89eaecb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8aa528da861495a7c5655dd89eaecb1">&#9670;&#160;</a></span>is_put_or_delete_method()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_put_or_delete_method </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07464">7464</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7465</span>{</div>
<div class="line"><span class="lineno"> 7466</span>    <span class="keywordflow">if</span> (conn) {</div>
<div class="line"><span class="lineno"> 7467</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>;</div>
<div class="line"><span class="lineno"> 7468</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7469</span>            <span class="comment">/* PUT, DELETE, MKCOL, PATCH, LOCK, UNLOCK, PROPPATCH, MOVE, COPY */</span></div>
<div class="line"><span class="lineno"> 7470</span>            <span class="keywordflow">return</span> (!strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;PUT&quot;</span>) || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;DELETE&quot;</span>)</div>
<div class="line"><span class="lineno"> 7471</span>                    || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;MKCOL&quot;</span>) || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;PATCH&quot;</span>)</div>
<div class="line"><span class="lineno"> 7472</span>                    || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;LOCK&quot;</span>) || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;UNLOCK&quot;</span>)</div>
<div class="line"><span class="lineno"> 7473</span>                    || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;PROPPATCH&quot;</span>) || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;MOVE&quot;</span>)</div>
<div class="line"><span class="lineno"> 7474</span>                    || !strcmp(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;COPY&quot;</span>));</div>
<div class="line"><span class="lineno"> 7475</span>        }</div>
<div class="line"><span class="lineno"> 7476</span>    }</div>
<div class="line"><span class="lineno"> 7477</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 7478</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, and <a class="el" href="multi_8h_source.html#l00318">s</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>.</p>

</div>
</div>
<a id="ae3eb055e17e5fa3eb02ce4873e76e884" name="ae3eb055e17e5fa3eb02ce4873e76e884"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3eb055e17e5fa3eb02ce4873e76e884">&#9670;&#160;</a></span>is_ssl_port_used()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_ssl_port_used </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>ports</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l15679">15679</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">15680</span>{</div>
<div class="line"><span class="lineno">15681</span>    <span class="keywordflow">if</span> (ports) {</div>
<div class="line"><span class="lineno">15682</span>        <span class="comment">/* There are several different allowed syntax variants:</span></div>
<div class="line"><span class="lineno">15683</span><span class="comment">         * - &quot;80&quot; for a single port using every network interface</span></div>
<div class="line"><span class="lineno">15684</span><span class="comment">         * - &quot;localhost:80&quot; for a single port using only localhost</span></div>
<div class="line"><span class="lineno">15685</span><span class="comment">         * - &quot;80,localhost:8080&quot; for two ports, one bound to localhost</span></div>
<div class="line"><span class="lineno">15686</span><span class="comment">         * - &quot;80,127.0.0.1:8084,[::1]:8086&quot; for three ports, one bound</span></div>
<div class="line"><span class="lineno">15687</span><span class="comment">         *   to IPv4 localhost, one to IPv6 localhost</span></div>
<div class="line"><span class="lineno">15688</span><span class="comment">         * - &quot;+80&quot; use port 80 for IPv4 and IPv6</span></div>
<div class="line"><span class="lineno">15689</span><span class="comment">         * - &quot;+80r,+443s&quot; port 80 (HTTP) is a redirect to port 443 (HTTPS),</span></div>
<div class="line"><span class="lineno">15690</span><span class="comment">         *   for both: IPv4 and IPv4</span></div>
<div class="line"><span class="lineno">15691</span><span class="comment">         * - &quot;+443s,localhost:8080&quot; port 443 (HTTPS) for every interface,</span></div>
<div class="line"><span class="lineno">15692</span><span class="comment">         *   additionally port 8080 bound to localhost connections</span></div>
<div class="line"><span class="lineno">15693</span><span class="comment">         *</span></div>
<div class="line"><span class="lineno">15694</span><span class="comment">         * If we just look for &#39;s&#39; anywhere in the string, &quot;localhost:80&quot;</span></div>
<div class="line"><span class="lineno">15695</span><span class="comment">         * will be detected as SSL (false positive).</span></div>
<div class="line"><span class="lineno">15696</span><span class="comment">         * Looking for &#39;s&#39; after a digit may cause false positives in</span></div>
<div class="line"><span class="lineno">15697</span><span class="comment">         * &quot;my24service:8080&quot;.</span></div>
<div class="line"><span class="lineno">15698</span><span class="comment">         * Looking from &#39;s&#39; backward if there are only &#39;:&#39; and numbers</span></div>
<div class="line"><span class="lineno">15699</span><span class="comment">         * before will not work for &quot;24service:8080&quot; (non SSL, port 8080)</span></div>
<div class="line"><span class="lineno">15700</span><span class="comment">         * or &quot;24s&quot; (SSL, port 24).</span></div>
<div class="line"><span class="lineno">15701</span><span class="comment">         *</span></div>
<div class="line"><span class="lineno">15702</span><span class="comment">         * Remark: Initially hostnames were not allowed to start with a</span></div>
<div class="line"><span class="lineno">15703</span><span class="comment">         * digit (according to RFC 952), this was allowed later (RFC 1123,</span></div>
<div class="line"><span class="lineno">15704</span><span class="comment">         * Section 2.1).</span></div>
<div class="line"><span class="lineno">15705</span><span class="comment">         *</span></div>
<div class="line"><span class="lineno">15706</span><span class="comment">         * To get this correct, the entire string must be parsed as a whole,</span></div>
<div class="line"><span class="lineno">15707</span><span class="comment">         * reading it as a list element for element and parsing with an</span></div>
<div class="line"><span class="lineno">15708</span><span class="comment">         * algorithm equivalent to parse_port_string.</span></div>
<div class="line"><span class="lineno">15709</span><span class="comment">         *</span></div>
<div class="line"><span class="lineno">15710</span><span class="comment">         * In fact, we use local interface names here, not arbitrary</span></div>
<div class="line"><span class="lineno">15711</span><span class="comment">         * hostnames, so in most cases the only name will be &quot;localhost&quot;.</span></div>
<div class="line"><span class="lineno">15712</span><span class="comment">         *</span></div>
<div class="line"><span class="lineno">15713</span><span class="comment">         * So, for now, we use this simple algorithm, that may still return</span></div>
<div class="line"><span class="lineno">15714</span><span class="comment">         * a false positive in bizarre cases.</span></div>
<div class="line"><span class="lineno">15715</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">15716</span>        <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">15717</span>        <span class="keywordtype">int</span> portslen = (int)strlen(ports);</div>
<div class="line"><span class="lineno">15718</span>        <span class="keywordtype">char</span> prevIsNumber = 0;</div>
<div class="line"><span class="lineno">15719</span> </div>
<div class="line"><span class="lineno">15720</span>        <span class="keywordflow">for</span> (i = 0; i &lt; portslen; i++) {</div>
<div class="line"><span class="lineno">15721</span>            <span class="keywordflow">if</span> (prevIsNumber &amp;&amp; (ports[i] == <span class="charliteral">&#39;s&#39;</span> || ports[i] == <span class="charliteral">&#39;r&#39;</span>)) {</div>
<div class="line"><span class="lineno">15722</span>                <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">15723</span>            }</div>
<div class="line"><span class="lineno">15724</span>            <span class="keywordflow">if</span> (ports[i] &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; ports[i] &lt;= <span class="charliteral">&#39;9&#39;</span>) {</div>
<div class="line"><span class="lineno">15725</span>                prevIsNumber = 1;</div>
<div class="line"><span class="lineno">15726</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15727</span>                prevIsNumber = 0;</div>
<div class="line"><span class="lineno">15728</span>            }</div>
<div class="line"><span class="lineno">15729</span>        }</div>
<div class="line"><span class="lineno">15730</span>    }</div>
<div class="line"><span class="lineno">15731</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">15732</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17485">init_ssl_ctx()</a>, and <a class="el" href="civetweb_8c_source.html#l20436">legacy_init()</a>.</p>

</div>
</div>
<a id="affc32c6a90f6b193dda6fbe4c600769c" name="affc32c6a90f6b193dda6fbe4c600769c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affc32c6a90f6b193dda6fbe4c600769c">&#9670;&#160;</a></span>is_valid_http_method()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_valid_http_method </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>method</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10899">10899</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10900</span>{</div>
<div class="line"><span class="lineno">10901</span>    <span class="keywordflow">return</span> (<a class="code hl_function" href="#a4291431186c67ce74663a2f32ec7dce4">get_http_method_info</a>(method) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">10902</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a4291431186c67ce74663a2f32ec7dce4"><div class="ttname"><a href="#a4291431186c67ce74663a2f32ec7dce4">get_http_method_info</a></div><div class="ttdeci">static const struct mg_http_method_info * get_http_method_info(const char *method)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10880">civetweb.c:10880</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l10880">get_http_method_info()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10915">parse_http_request()</a>.</p>

</div>
</div>
<a id="ab0cba7d970883b21a4db625c33cba9ac" name="ab0cba7d970883b21a4db625c33cba9ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0cba7d970883b21a4db625c33cba9ac">&#9670;&#160;</a></span>is_valid_port()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_valid_port </td>
          <td>(</td>
          <td class="paramtype">unsigned long</td>          <td class="paramname"><span class="paramname"><em>port</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09239">9239</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9240</span>{</div>
<div class="line"><span class="lineno"> 9241</span>    <span class="keywordflow">return</span> (port &lt;= 0xffff);</div>
<div class="line"><span class="lineno"> 9242</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l18465">get_rel_url_at_current_server()</a>, <a class="el" href="civetweb_8c_source.html#l18395">get_uri_type()</a>, and <a class="el" href="civetweb_8c_source.html#l15501">parse_port_string()</a>.</p>

</div>
</div>
<a id="ac610da3b9f5e065811120249a2f488ac" name="ac610da3b9f5e065811120249a2f488ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac610da3b9f5e065811120249a2f488ac">&#9670;&#160;</a></span>legacy_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void legacy_init </td>
          <td>(</td>
          <td class="paramtype">const char **</td>          <td class="paramname"><span class="paramname"><em>options</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l20436">20436</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">20437</span>{</div>
<div class="line"><span class="lineno">20438</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *ports_option = <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e">LISTENING_PORTS</a>].<a class="code hl_variable" href="structmg__option.html#a59f8f8b81585ce50d69dcc1b094a0067">default_value</a>;</div>
<div class="line"><span class="lineno">20439</span> </div>
<div class="line"><span class="lineno">20440</span>    <span class="keywordflow">if</span> (options) {</div>
<div class="line"><span class="lineno">20441</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> **run_options = options;</div>
<div class="line"><span class="lineno">20442</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *optname = <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e">LISTENING_PORTS</a>].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a>;</div>
<div class="line"><span class="lineno">20443</span> </div>
<div class="line"><span class="lineno">20444</span>        <span class="comment">/* Try to find the &quot;listening_ports&quot; option */</span></div>
<div class="line"><span class="lineno">20445</span>        <span class="keywordflow">while</span> (*run_options) {</div>
<div class="line"><span class="lineno">20446</span>            <span class="keywordflow">if</span> (!strcmp(*run_options, optname)) {</div>
<div class="line"><span class="lineno">20447</span>                ports_option = run_options[1];</div>
<div class="line"><span class="lineno">20448</span>            }</div>
<div class="line"><span class="lineno">20449</span>            run_options += 2;</div>
<div class="line"><span class="lineno">20450</span>        }</div>
<div class="line"><span class="lineno">20451</span>    }</div>
<div class="line"><span class="lineno">20452</span> </div>
<div class="line"><span class="lineno">20453</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#ae3eb055e17e5fa3eb02ce4873e76e884">is_ssl_port_used</a>(ports_option)) {</div>
<div class="line"><span class="lineno">20454</span>        <span class="comment">/* Initialize with SSL support */</span></div>
<div class="line"><span class="lineno">20455</span>        <a class="code hl_function" href="#ac6e9ad2a3e4f0beb2a938f52c3df50a9">mg_init_library</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da976c9faad41b9bc5c161c37d8e4c72ec">MG_FEATURES_TLS</a>);</div>
<div class="line"><span class="lineno">20456</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">20457</span>        <span class="comment">/* Initialize without SSL support */</span></div>
<div class="line"><span class="lineno">20458</span>        <a class="code hl_function" href="#ac6e9ad2a3e4f0beb2a938f52c3df50a9">mg_init_library</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da8c5ba5c3477db3ee940a77a9364a4b5b">MG_FEATURES_DEFAULT</a>);</div>
<div class="line"><span class="lineno">20459</span>    }</div>
<div class="line"><span class="lineno">20460</span>}</div>
<div class="ttc" id="acivetweb_8c_html_ac6e9ad2a3e4f0beb2a938f52c3df50a9"><div class="ttname"><a href="#ac6e9ad2a3e4f0beb2a938f52c3df50a9">mg_init_library</a></div><div class="ttdeci">CIVETWEB_API unsigned mg_init_library(unsigned features)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l22347">civetweb.c:22347</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da8c5ba5c3477db3ee940a77a9364a4b5b"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da8c5ba5c3477db3ee940a77a9364a4b5b">MG_FEATURES_DEFAULT</a></div><div class="ttdeci">@ MG_FEATURES_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00057">civetweb.h:57</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da976c9faad41b9bc5c161c37d8e4c72ec"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da976c9faad41b9bc5c161c37d8e4c72ec">MG_FEATURES_TLS</a></div><div class="ttdeci">@ MG_FEATURES_TLS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00066">civetweb.h:66</a></div></div>
<div class="ttc" id="astructmg__option_html_a59f8f8b81585ce50d69dcc1b094a0067"><div class="ttname"><a href="structmg__option.html#a59f8f8b81585ce50d69dcc1b094a0067">mg_option::default_value</a></div><div class="ttdeci">const char * default_value</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00688">civetweb.h:688</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8h_source.html#l00688">mg_option::default_value</a>, <a class="el" href="civetweb_8c_source.html#l15679">is_ssl_port_used()</a>, <a class="el" href="civetweb_8c_source.html#l01920">LISTENING_PORTS</a>, <a class="el" href="civetweb_8h_source.html#l00057">MG_FEATURES_DEFAULT</a>, <a class="el" href="civetweb_8h_source.html#l00066">MG_FEATURES_TLS</a>, <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>, and <a class="el" href="civetweb_8h_source.html#l00686">mg_option::name</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="a7dcb20f5797258e244f21fc4d62ce828" name="a7dcb20f5797258e244f21fc4d62ce828"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7dcb20f5797258e244f21fc4d62ce828">&#9670;&#160;</a></span>load_tls_dll()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void * load_tls_dll </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>ebuf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>ebuf_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>dll_name</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ssl_func *</td>          <td class="paramname"><span class="paramname"><em>sw</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>feature_missing</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16715">16715</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16720</span>{</div>
<div class="line"><span class="lineno">16721</span>    <span class="keyword">union </span>{</div>
<div class="line"><span class="lineno">16722</span>        <span class="keywordtype">void</span> *p;</div>
<div class="line"><span class="lineno">16723</span>        void (*fp)(void);</div>
<div class="line"><span class="lineno">16724</span>    } u;</div>
<div class="line"><span class="lineno">16725</span>    <span class="keywordtype">void</span> *dll_handle;</div>
<div class="line"><span class="lineno">16726</span>    <span class="keyword">struct </span>ssl_func *fp;</div>
<div class="line"><span class="lineno">16727</span>    <span class="keywordtype">int</span> ok;</div>
<div class="line"><span class="lineno">16728</span>    <span class="keywordtype">int</span> truncated = 0;</div>
<div class="line"><span class="lineno">16729</span> </div>
<div class="line"><span class="lineno">16730</span>    <span class="keywordflow">if</span> ((dll_handle = dlopen(dll_name, RTLD_LAZY)) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16731</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">16732</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">16733</span>                    ebuf,</div>
<div class="line"><span class="lineno">16734</span>                    ebuf_len,</div>
<div class="line"><span class="lineno">16735</span>                    <span class="stringliteral">&quot;%s: cannot load %s&quot;</span>,</div>
<div class="line"><span class="lineno">16736</span>                    __func__,</div>
<div class="line"><span class="lineno">16737</span>                    dll_name);</div>
<div class="line"><span class="lineno">16738</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16739</span>    }</div>
<div class="line"><span class="lineno">16740</span> </div>
<div class="line"><span class="lineno">16741</span>    ok = 1;</div>
<div class="line"><span class="lineno">16742</span>    <span class="keywordflow">for</span> (fp = sw; fp-&gt;name != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; fp++) {</div>
<div class="line"><span class="lineno">16743</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">16744</span>        <span class="comment">/* GetProcAddress() returns pointer to function */</span></div>
<div class="line"><span class="lineno">16745</span>        u.fp = (void (*)(void))dlsym(dll_handle, fp-&gt;name);</div>
<div class="line"><span class="lineno">16746</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">16747</span>        <span class="comment">/* dlsym() on UNIX returns void *. ISO C forbids casts of data</span></div>
<div class="line"><span class="lineno">16748</span><span class="comment">         * pointers to function pointers. We need to use a union to make a</span></div>
<div class="line"><span class="lineno">16749</span><span class="comment">         * cast. */</span></div>
<div class="line"><span class="lineno">16750</span>        u.p = dlsym(dll_handle, fp-&gt;name);</div>
<div class="line"><span class="lineno">16751</span><span class="preprocessor">#endif </span><span class="comment">/* _WIN32 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">16752</span> </div>
<div class="line"><span class="lineno">16753</span>        <span class="comment">/* Set pointer (might be NULL) */</span></div>
<div class="line"><span class="lineno">16754</span>        fp-&gt;ptr = u.fp;</div>
<div class="line"><span class="lineno">16755</span> </div>
<div class="line"><span class="lineno">16756</span>        <span class="keywordflow">if</span> (u.fp == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16757</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Missing function: %s\n&quot;</span>, fp-&gt;name);</div>
<div class="line"><span class="lineno">16758</span>            <span class="keywordflow">if</span> (feature_missing) {</div>
<div class="line"><span class="lineno">16759</span>                feature_missing[fp-&gt;required]++;</div>
<div class="line"><span class="lineno">16760</span>            }</div>
<div class="line"><span class="lineno">16761</span>            <span class="keywordflow">if</span> (fp-&gt;required == TLS_Mandatory) {</div>
<div class="line"><span class="lineno">16762</span>                <span class="comment">/* Mandatory function is missing */</span></div>
<div class="line"><span class="lineno">16763</span>                <span class="keywordflow">if</span> (ok) {</div>
<div class="line"><span class="lineno">16764</span>                    <span class="comment">/* This is the first missing function.</span></div>
<div class="line"><span class="lineno">16765</span><span class="comment">                     * Create a new error message. */</span></div>
<div class="line"><span class="lineno">16766</span>                    <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">16767</span>                                &amp;truncated,</div>
<div class="line"><span class="lineno">16768</span>                                ebuf,</div>
<div class="line"><span class="lineno">16769</span>                                ebuf_len,</div>
<div class="line"><span class="lineno">16770</span>                                <span class="stringliteral">&quot;%s: %s: cannot find %s&quot;</span>,</div>
<div class="line"><span class="lineno">16771</span>                                __func__,</div>
<div class="line"><span class="lineno">16772</span>                                dll_name,</div>
<div class="line"><span class="lineno">16773</span>                                fp-&gt;name);</div>
<div class="line"><span class="lineno">16774</span>                    ok = 0;</div>
<div class="line"><span class="lineno">16775</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16776</span>                    <span class="comment">/* This is yet anothermissing function.</span></div>
<div class="line"><span class="lineno">16777</span><span class="comment">                     * Append existing error message. */</span></div>
<div class="line"><span class="lineno">16778</span>                    <span class="keywordtype">size_t</span> cur_len = strlen(ebuf);</div>
<div class="line"><span class="lineno">16779</span>                    <span class="keywordflow">if</span> (!truncated &amp;&amp; ((ebuf_len - cur_len) &gt; 3)) {</div>
<div class="line"><span class="lineno">16780</span>                        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">16781</span>                                    &amp;truncated,</div>
<div class="line"><span class="lineno">16782</span>                                    ebuf + cur_len,</div>
<div class="line"><span class="lineno">16783</span>                                    ebuf_len - cur_len - 3,</div>
<div class="line"><span class="lineno">16784</span>                                    <span class="stringliteral">&quot;, %s&quot;</span>,</div>
<div class="line"><span class="lineno">16785</span>                                    fp-&gt;name);</div>
<div class="line"><span class="lineno">16786</span>                        <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno">16787</span>                            <span class="comment">/* If truncated, add &quot;...&quot; */</span></div>
<div class="line"><span class="lineno">16788</span>                            strcat(ebuf, <span class="stringliteral">&quot;...&quot;</span>);</div>
<div class="line"><span class="lineno">16789</span>                        }</div>
<div class="line"><span class="lineno">16790</span>                    }</div>
<div class="line"><span class="lineno">16791</span>                }</div>
<div class="line"><span class="lineno">16792</span>            }</div>
<div class="line"><span class="lineno">16793</span>        }</div>
<div class="line"><span class="lineno">16794</span>    }</div>
<div class="line"><span class="lineno">16795</span> </div>
<div class="line"><span class="lineno">16796</span>    <span class="keywordflow">if</span> (!ok) {</div>
<div class="line"><span class="lineno">16797</span>        (void)dlclose(dll_handle);</div>
<div class="line"><span class="lineno">16798</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16799</span>    }</div>
<div class="line"><span class="lineno">16800</span> </div>
<div class="line"><span class="lineno">16801</span>    <span class="keywordflow">return</span> dll_handle;</div>
<div class="line"><span class="lineno">16802</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>.</p>

</div>
</div>
<a id="a395e0410a86d3aa491b7efe4d081a60e" name="a395e0410a86d3aa491b7efe4d081a60e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a395e0410a86d3aa491b7efe4d081a60e">&#9670;&#160;</a></span>log_access()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void log_access </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16063">16063</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16064</span>{</div>
<div class="line"><span class="lineno">16065</span>    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structmg__request__info.html">mg_request_info</a> *ri;</div>
<div class="line"><span class="lineno">16066</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> fi;</div>
<div class="line"><span class="lineno">16067</span>    <span class="keywordtype">char</span> date[64], src_addr[<a class="code hl_define" href="#a0563a85b179703339cbf223e7e1c0454">IP_ADDR_STR_LEN</a>];</div>
<div class="line"><span class="lineno">16068</span><span class="preprocessor">#if defined(REENTRANT_TIME)</span></div>
<div class="line"><span class="lineno">16069</span>    <span class="keyword">struct </span>tm _tm;</div>
<div class="line"><span class="lineno">16070</span>    <span class="keyword">struct </span>tm *tm = &amp;_tm;</div>
<div class="line"><span class="lineno">16071</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">16072</span>    <span class="keyword">struct </span>tm *tm;</div>
<div class="line"><span class="lineno">16073</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">16074</span> </div>
<div class="line"><span class="lineno">16075</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *referer;</div>
<div class="line"><span class="lineno">16076</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *user_agent;</div>
<div class="line"><span class="lineno">16077</span> </div>
<div class="line"><span class="lineno">16078</span>    <span class="keywordtype">char</span> log_buf[4096];</div>
<div class="line"><span class="lineno">16079</span> </div>
<div class="line"><span class="lineno">16080</span>    <span class="keywordflow">if</span> (!conn || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno">16081</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">16082</span>    }</div>
<div class="line"><span class="lineno">16083</span> </div>
<div class="line"><span class="lineno">16084</span>    <span class="comment">/* Set log message to &quot;empty&quot; */</span></div>
<div class="line"><span class="lineno">16085</span>    log_buf[0] = 0;</div>
<div class="line"><span class="lineno">16086</span> </div>
<div class="line"><span class="lineno">16087</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">16088</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;lua_bg_log_available) {</div>
<div class="line"><span class="lineno">16089</span>        <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">16090</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__context.html">mg_context</a> *ctx = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>;</div>
<div class="line"><span class="lineno">16091</span>        <a class="code hl_struct" href="structlua__State.html">lua_State</a> *lstate = (<a class="code hl_struct" href="structlua__State.html">lua_State</a> *)ctx-&gt;lua_background_state;</div>
<div class="line"><span class="lineno">16092</span>        pthread_mutex_lock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">16093</span>        <span class="comment">/* call &quot;log()&quot; in Lua */</span></div>
<div class="line"><span class="lineno">16094</span>        <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#abc2f6fef4682c1d4cdc33206aaf42bec">lua_getglobal</a>(lstate, <span class="stringliteral">&quot;log&quot;</span>);</div>
<div class="line"><span class="lineno">16095</span>        prepare_lua_request_info_inner(conn, lstate);</div>
<div class="line"><span class="lineno">16096</span>        push_lua_response_log_data(conn, lstate);</div>
<div class="line"><span class="lineno">16097</span> </div>
<div class="line"><span class="lineno">16098</span>        ret = <a class="code hl_define" href="lua-5_82_84_2src_2lua_8h.html#a589d7e3fd4c388d64056c88bf4672431">lua_pcall</a>(lstate, <span class="comment">/* args */</span> 2, <span class="comment">/* results */</span> 1, 0);</div>
<div class="line"><span class="lineno">16099</span>        <span class="keywordflow">if</span> (ret == 0) {</div>
<div class="line"><span class="lineno">16100</span>            <span class="keywordtype">int</span> t = <a class="code hl_function" href="lua-5_81_85_2src_2lapi_8c.html#a652b273947f0656686f998d8e90cd3ea">lua_type</a>(lstate, -1);</div>
<div class="line"><span class="lineno">16101</span>            <span class="keywordflow">if</span> (t == <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#a611808ed12d4c2aee2a9e298a9d9a9bf">LUA_TBOOLEAN</a>) {</div>
<div class="line"><span class="lineno">16102</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lapi_8c.html#a444aee9aa56b0b06175ee3c7bcf7927c">lua_toboolean</a>(lstate, -1) == 0) {</div>
<div class="line"><span class="lineno">16103</span>                    <span class="comment">/* log() returned false: do not log */</span></div>
<div class="line"><span class="lineno">16104</span>                    pthread_mutex_unlock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">16105</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">16106</span>                }</div>
<div class="line"><span class="lineno">16107</span>                <span class="comment">/* log returned true: continue logging */</span></div>
<div class="line"><span class="lineno">16108</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t == <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#a57de20d87bb5131a3159f2bd52e3fab6">LUA_TSTRING</a>) {</div>
<div class="line"><span class="lineno">16109</span>                <span class="keywordtype">size_t</span> len;</div>
<div class="line"><span class="lineno">16110</span>                <span class="keyword">const</span> <span class="keywordtype">char</span> *txt = <a class="code hl_function" href="lua-5_81_85_2src_2lapi_8c.html#a5fbc943e3486fad9672f9a74d7cb49b4">lua_tolstring</a>(lstate, -1, &amp;len);</div>
<div class="line"><span class="lineno">16111</span>                <span class="keywordflow">if</span> ((len == 0) || (*txt == 0)) {</div>
<div class="line"><span class="lineno">16112</span>                    <span class="comment">/* log() returned empty string: do not log */</span></div>
<div class="line"><span class="lineno">16113</span>                    pthread_mutex_unlock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">16114</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">16115</span>                }</div>
<div class="line"><span class="lineno">16116</span>                <span class="comment">/* Copy test from Lua into log_buf */</span></div>
<div class="line"><span class="lineno">16117</span>                <span class="keywordflow">if</span> (len &gt;= <span class="keyword">sizeof</span>(log_buf)) {</div>
<div class="line"><span class="lineno">16118</span>                    len = <span class="keyword">sizeof</span>(log_buf) - 1;</div>
<div class="line"><span class="lineno">16119</span>                }</div>
<div class="line"><span class="lineno">16120</span>                memcpy(log_buf, txt, len);</div>
<div class="line"><span class="lineno">16121</span>                log_buf[len] = 0;</div>
<div class="line"><span class="lineno">16122</span>            }</div>
<div class="line"><span class="lineno">16123</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16124</span>            lua_cry(conn, ret, lstate, <span class="stringliteral">&quot;lua_background_script&quot;</span>, <span class="stringliteral">&quot;log&quot;</span>);</div>
<div class="line"><span class="lineno">16125</span>        }</div>
<div class="line"><span class="lineno">16126</span>        pthread_mutex_unlock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">16127</span>    }</div>
<div class="line"><span class="lineno">16128</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">16129</span> </div>
<div class="line"><span class="lineno">16130</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bac3c40480ddeeae7beeed79fc399329e3">ACCESS_LOG_FILE</a>] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16131</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn,</div>
<div class="line"><span class="lineno">16132</span>                     conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bac3c40480ddeeae7beeed79fc399329e3">ACCESS_LOG_FILE</a>],</div>
<div class="line"><span class="lineno">16133</span>                     <a class="code hl_define" href="#a88232e9595ccceb9a04b106cc6d2739c">MG_FOPEN_MODE_APPEND</a>,</div>
<div class="line"><span class="lineno">16134</span>                     &amp;fi)</div>
<div class="line"><span class="lineno">16135</span>            == 0) {</div>
<div class="line"><span class="lineno">16136</span>            fi.access.fp = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16137</span>        }</div>
<div class="line"><span class="lineno">16138</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16139</span>        fi.access.fp = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16140</span>    }</div>
<div class="line"><span class="lineno">16141</span> </div>
<div class="line"><span class="lineno">16142</span>    <span class="comment">/* Log is written to a file and/or a callback. If both are not set,</span></div>
<div class="line"><span class="lineno">16143</span><span class="comment">     * executing the rest of the function is pointless. */</span></div>
<div class="line"><span class="lineno">16144</span>    <span class="keywordflow">if</span> ((fi.access.fp == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">16145</span>        &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aac1a77ed5f32b08fbaefa5f574fa1d78">log_access</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">16146</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">16147</span>    }</div>
<div class="line"><span class="lineno">16148</span> </div>
<div class="line"><span class="lineno">16149</span>    <span class="comment">/* If we did not get a log message from Lua, create it here. */</span></div>
<div class="line"><span class="lineno">16150</span>    <span class="keywordflow">if</span> (!log_buf[0]) {</div>
<div class="line"><span class="lineno">16151</span><span class="preprocessor">#if defined(REENTRANT_TIME)</span></div>
<div class="line"><span class="lineno">16152</span>        localtime_r(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#acc800b7c744ad9f71401fae6048f6995">conn_birth_time</a>, tm);</div>
<div class="line"><span class="lineno">16153</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">16154</span>        tm = localtime(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#acc800b7c744ad9f71401fae6048f6995">conn_birth_time</a>);</div>
<div class="line"><span class="lineno">16155</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">16156</span>        <span class="keywordflow">if</span> (tm != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16157</span>            strftime(date, <span class="keyword">sizeof</span>(date), <span class="stringliteral">&quot;%d/%b/%Y:%H:%M:%S %z&quot;</span>, tm);</div>
<div class="line"><span class="lineno">16158</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16159</span>            <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(date, <span class="stringliteral">&quot;01/Jan/1970:00:00:00 +0000&quot;</span>, <span class="keyword">sizeof</span>(date));</div>
<div class="line"><span class="lineno">16160</span>        }</div>
<div class="line"><span class="lineno">16161</span> </div>
<div class="line"><span class="lineno">16162</span>        ri = &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>;</div>
<div class="line"><span class="lineno">16163</span> </div>
<div class="line"><span class="lineno">16164</span>        <a class="code hl_function" href="#a043f416da5d5ec0b9a0f39e7a34250c2">sockaddr_to_string</a>(src_addr, <span class="keyword">sizeof</span>(src_addr), &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#afe3a45fe832ca19cc85299b9a96d8feb">rsa</a>);</div>
<div class="line"><span class="lineno">16165</span>        referer = <a class="code hl_function" href="#a9bd30673001e62b1d44baa0caeb0da97">header_val</a>(conn, <span class="stringliteral">&quot;Referer&quot;</span>);</div>
<div class="line"><span class="lineno">16166</span>        user_agent = <a class="code hl_function" href="#a9bd30673001e62b1d44baa0caeb0da97">header_val</a>(conn, <span class="stringliteral">&quot;User-Agent&quot;</span>);</div>
<div class="line"><span class="lineno">16167</span> </div>
<div class="line"><span class="lineno">16168</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">16169</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* Ignore truncation in access log */</span></div>
<div class="line"><span class="lineno">16170</span>                    log_buf,</div>
<div class="line"><span class="lineno">16171</span>                    <span class="keyword">sizeof</span>(log_buf),</div>
<div class="line"><span class="lineno">16172</span>                    <span class="stringliteral">&quot;%s - %s [%s] \&quot;%s %s%s%s HTTP/%s\&quot; %d %&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a></div>
<div class="line"><span class="lineno">16173</span>                    <span class="stringliteral">&quot; %s %s&quot;</span>,</div>
<div class="line"><span class="lineno">16174</span>                    src_addr,</div>
<div class="line"><span class="lineno">16175</span>                    (ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? <span class="stringliteral">&quot;-&quot;</span> : ri-&gt;remote_user,</div>
<div class="line"><span class="lineno">16176</span>                    date,</div>
<div class="line"><span class="lineno">16177</span>                    ri-&gt;request_method ? ri-&gt;request_method : <span class="stringliteral">&quot;-&quot;</span>,</div>
<div class="line"><span class="lineno">16178</span>                    ri-&gt;request_uri ? ri-&gt;request_uri : <span class="stringliteral">&quot;-&quot;</span>,</div>
<div class="line"><span class="lineno">16179</span>                    ri-&gt;query_string ? <span class="stringliteral">&quot;?&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">16180</span>                    ri-&gt;query_string ? ri-&gt;query_string : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">16181</span>                    ri-&gt;http_version,</div>
<div class="line"><span class="lineno">16182</span>                    conn-&gt;status_code,</div>
<div class="line"><span class="lineno">16183</span>                    conn-&gt;num_bytes_sent,</div>
<div class="line"><span class="lineno">16184</span>                    referer,</div>
<div class="line"><span class="lineno">16185</span>                    user_agent);</div>
<div class="line"><span class="lineno">16186</span>    }</div>
<div class="line"><span class="lineno">16187</span> </div>
<div class="line"><span class="lineno">16188</span>    <span class="comment">/* Here we have a log message in log_buf. Call the callback */</span></div>
<div class="line"><span class="lineno">16189</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aac1a77ed5f32b08fbaefa5f574fa1d78">log_access</a>) {</div>
<div class="line"><span class="lineno">16190</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aac1a77ed5f32b08fbaefa5f574fa1d78">log_access</a>(conn, log_buf)) {</div>
<div class="line"><span class="lineno">16191</span>            <span class="comment">/* do not log if callback returns non-zero */</span></div>
<div class="line"><span class="lineno">16192</span>            <span class="keywordflow">if</span> (fi.access.fp) {</div>
<div class="line"><span class="lineno">16193</span>                <a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;fi.access);</div>
<div class="line"><span class="lineno">16194</span>            }</div>
<div class="line"><span class="lineno">16195</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">16196</span>        }</div>
<div class="line"><span class="lineno">16197</span>    }</div>
<div class="line"><span class="lineno">16198</span> </div>
<div class="line"><span class="lineno">16199</span>    <span class="comment">/* Store in file */</span></div>
<div class="line"><span class="lineno">16200</span>    <span class="keywordflow">if</span> (fi.access.fp) {</div>
<div class="line"><span class="lineno">16201</span>        <span class="keywordtype">int</span> ok = 1;</div>
<div class="line"><span class="lineno">16202</span>        flockfile(fi.access.fp);</div>
<div class="line"><span class="lineno">16203</span>        <span class="keywordflow">if</span> (fprintf(fi.access.fp, <span class="stringliteral">&quot;%s\n&quot;</span>, log_buf) &lt; 1) {</div>
<div class="line"><span class="lineno">16204</span>            ok = 0;</div>
<div class="line"><span class="lineno">16205</span>        }</div>
<div class="line"><span class="lineno">16206</span>        <span class="keywordflow">if</span> (fflush(fi.access.fp) != 0) {</div>
<div class="line"><span class="lineno">16207</span>            ok = 0;</div>
<div class="line"><span class="lineno">16208</span>        }</div>
<div class="line"><span class="lineno">16209</span>        funlockfile(fi.access.fp);</div>
<div class="line"><span class="lineno">16210</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;fi.access) != 0) {</div>
<div class="line"><span class="lineno">16211</span>            ok = 0;</div>
<div class="line"><span class="lineno">16212</span>        }</div>
<div class="line"><span class="lineno">16213</span>        <span class="keywordflow">if</span> (!ok) {</div>
<div class="line"><span class="lineno">16214</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">16215</span>                            <span class="stringliteral">&quot;Error writing log file %s&quot;</span>,</div>
<div class="line"><span class="lineno">16216</span>                            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bac3c40480ddeeae7beeed79fc399329e3">ACCESS_LOG_FILE</a>]);</div>
<div class="line"><span class="lineno">16217</span>        }</div>
<div class="line"><span class="lineno">16218</span>    }</div>
<div class="line"><span class="lineno">16219</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a88232e9595ccceb9a04b106cc6d2739c"><div class="ttname"><a href="#a88232e9595ccceb9a04b106cc6d2739c">MG_FOPEN_MODE_APPEND</a></div><div class="ttdeci">#define MG_FOPEN_MODE_APPEND</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02849">civetweb.c:2849</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a9bd30673001e62b1d44baa0caeb0da97"><div class="ttname"><a href="#a9bd30673001e62b1d44baa0caeb0da97">header_val</a></div><div class="ttdeci">static const char * header_val(const struct mg_connection *conn, const char *header)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16046">civetweb.c:16046</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lapi_8c_html_a444aee9aa56b0b06175ee3c7bcf7927c"><div class="ttname"><a href="lua-5_81_85_2src_2lapi_8c.html#a444aee9aa56b0b06175ee3c7bcf7927c">lua_toboolean</a></div><div class="ttdeci">LUA_API int lua_toboolean(lua_State *L, int idx)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lapi_8c_source.html#l00337">lua-5.1.5/src/lapi.c:337</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lapi_8c_html_a5fbc943e3486fad9672f9a74d7cb49b4"><div class="ttname"><a href="lua-5_81_85_2src_2lapi_8c.html#a5fbc943e3486fad9672f9a74d7cb49b4">lua_tolstring</a></div><div class="ttdeci">LUA_API const char * lua_tolstring(lua_State *L, int idx, size_t *len)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lapi_8c_source.html#l00343">lua-5.1.5/src/lapi.c:343</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lapi_8c_html_a652b273947f0656686f998d8e90cd3ea"><div class="ttname"><a href="lua-5_81_85_2src_2lapi_8c.html#a652b273947f0656686f998d8e90cd3ea">lua_type</a></div><div class="ttdeci">LUA_API int lua_type(lua_State *L, int idx)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lapi_8c_source.html#l00242">lua-5.1.5/src/lapi.c:242</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lua_8h_html_a57de20d87bb5131a3159f2bd52e3fab6"><div class="ttname"><a href="lua-5_81_85_2src_2lua_8h.html#a57de20d87bb5131a3159f2bd52e3fab6">LUA_TSTRING</a></div><div class="ttdeci">#define LUA_TSTRING</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lua_8h_source.html#l00078">lua-5.1.5/src/lua.h:78</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lua_8h_html_a611808ed12d4c2aee2a9e298a9d9a9bf"><div class="ttname"><a href="lua-5_81_85_2src_2lua_8h.html#a611808ed12d4c2aee2a9e298a9d9a9bf">LUA_TBOOLEAN</a></div><div class="ttdeci">#define LUA_TBOOLEAN</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lua_8h_source.html#l00075">lua-5.1.5/src/lua.h:75</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lua_8h_html_abc2f6fef4682c1d4cdc33206aaf42bec"><div class="ttname"><a href="lua-5_81_85_2src_2lua_8h.html#abc2f6fef4682c1d4cdc33206aaf42bec">lua_getglobal</a></div><div class="ttdeci">#define lua_getglobal(L, s)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lua_8h_source.html#l00277">lua-5.1.5/src/lua.h:277</a></div></div>
<div class="ttc" id="alua-5_82_84_2src_2lua_8h_html_a589d7e3fd4c388d64056c88bf4672431"><div class="ttname"><a href="lua-5_82_84_2src_2lua_8h.html#a589d7e3fd4c388d64056c88bf4672431">lua_pcall</a></div><div class="ttdeci">#define lua_pcall(L, n, r, f)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_82_84_2src_2lua_8h_source.html#l00259">lua-5.2.4/src/lua.h:259</a></div></div>
<div class="ttc" id="astructlua__State_html"><div class="ttname"><a href="structlua__State.html">lua_State</a></div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lstate_8h_source.html#l00100">lua-5.1.5/src/lstate.h:100</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_aac1a77ed5f32b08fbaefa5f574fa1d78"><div class="ttname"><a href="structmg__callbacks.html#aac1a77ed5f32b08fbaefa5f574fa1d78">mg_callbacks::log_access</a></div><div class="ttdeci">int(* log_access)(const struct mg_connection *, const char *message)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00244">civetweb.h:244</a></div></div>
<div class="ttc" id="astructmg__connection_html_acc800b7c744ad9f71401fae6048f6995"><div class="ttname"><a href="structmg__connection.html#acc800b7c744ad9f71401fae6048f6995">mg_connection::conn_birth_time</a></div><div class="ttdeci">time_t conn_birth_time</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02508">civetweb.c:2508</a></div></div>
<div class="ttc" id="astructmg__context_html"><div class="ttname"><a href="structmg__context.html">mg_context</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02345">civetweb.c:2345</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l01956">ACCESS_LOG_FILE</a>, <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02508">mg_connection::conn_birth_time</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, <a class="el" href="civetweb_8c_source.html#l16046">header_val()</a>, <a class="el" href="civetweb_8h_source.html#l00161">mg_request_info::http_version</a>, <a class="el" href="civetweb_8c_source.html#l00926">INT64_FMT</a>, <a class="el" href="civetweb_8c_source.html#l01732">IP_ADDR_STR_LEN</a>, <a class="el" href="civetweb_8h_source.html#l00244">mg_callbacks::log_access</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00277">lua_getglobal</a>, <a class="el" href="lua-5_82_84_2src_2lua_8h_source.html#l00259">lua_pcall</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00075">LUA_TBOOLEAN</a>, <a class="el" href="lua-5_81_85_2src_2lapi_8c_source.html#l00337">lua_toboolean()</a>, <a class="el" href="lua-5_81_85_2src_2lapi_8c_source.html#l00343">lua_tolstring()</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00078">LUA_TSTRING</a>, <a class="el" href="lua-5_81_85_2src_2lapi_8c_source.html#l00242">lua_type()</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02849">MG_FOPEN_MODE_APPEND</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02517">mg_connection::num_bytes_sent</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8h_source.html#l00162">mg_request_info::query_string</a>, <a class="el" href="civetweb_8h_source.html#l00164">mg_request_info::remote_user</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>, <a class="el" href="civetweb_8c_source.html#l01905">socket::rsa</a>, <a class="el" href="civetweb_8c_source.html#l03292">sockaddr_to_string()</a>, and <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06562">handle_request_stat_log()</a>.</p>

</div>
</div>
<a id="a9682bb02df6aff4820e030d3c730872e" name="a9682bb02df6aff4820e030d3c730872e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9682bb02df6aff4820e030d3c730872e">&#9670;&#160;</a></span>lowercase()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int lowercase </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>s</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03012">3012</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3013</span>{</div>
<div class="line"><span class="lineno"> 3014</span>    <span class="keywordflow">return</span> tolower((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno"> 3015</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="multi_8h_source.html#l00318">s</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l03019">mg_strncasecmp()</a>, and <a class="el" href="civetweb_8c_source.html#l14075">set_throttle()</a>.</p>

</div>
</div>
<a id="aab5946d38d4ebb16c9dc8cd45a913e99" name="aab5946d38d4ebb16c9dc8cd45a913e99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab5946d38d4ebb16c9dc8cd45a913e99">&#9670;&#160;</a></span>master_thread()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void * master_thread </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>thread_func_param</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l20231">20231</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">20232</span>{</div>
<div class="line"><span class="lineno">20233</span><span class="preprocessor">#if !defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno">20234</span>    <span class="keyword">struct </span>sigaction sa;</div>
<div class="line"><span class="lineno">20235</span> </div>
<div class="line"><span class="lineno">20236</span>    <span class="comment">/* Ignore SIGPIPE */</span></div>
<div class="line"><span class="lineno">20237</span>    memset(&amp;sa, 0, <span class="keyword">sizeof</span>(sa));</div>
<div class="line"><span class="lineno">20238</span>    sa.sa_handler = SIG_IGN;</div>
<div class="line"><span class="lineno">20239</span>    sigaction(SIGPIPE, &amp;sa, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20240</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20241</span> </div>
<div class="line"><span class="lineno">20242</span>    <a class="code hl_function" href="#a4eeba62c0424eafcf42845c3688e81b2">master_thread_run</a>((<span class="keyword">struct</span> <a class="code hl_struct" href="structmg__context.html">mg_context</a> *)thread_func_param);</div>
<div class="line"><span class="lineno">20243</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20244</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a4eeba62c0424eafcf42845c3688e81b2"><div class="ttname"><a href="#a4eeba62c0424eafcf42845c3688e81b2">master_thread_run</a></div><div class="ttdeci">static void master_thread_run(struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l20044">civetweb.c:20044</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="a4eeba62c0424eafcf42845c3688e81b2" name="a4eeba62c0424eafcf42845c3688e81b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4eeba62c0424eafcf42845c3688e81b2">&#9670;&#160;</a></span>master_thread_run()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void master_thread_run </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l20044">20044</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">20045</span>{</div>
<div class="line"><span class="lineno">20046</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> tls;</div>
<div class="line"><span class="lineno">20047</span>    <span class="keyword">struct </span><a class="code hl_define" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> *pfd;</div>
<div class="line"><span class="lineno">20048</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">20049</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> workerthreadcount;</div>
<div class="line"><span class="lineno">20050</span> </div>
<div class="line"><span class="lineno">20051</span>    <span class="keywordflow">if</span> (!ctx) {</div>
<div class="line"><span class="lineno">20052</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">20053</span>    }</div>
<div class="line"><span class="lineno">20054</span> </div>
<div class="line"><span class="lineno">20055</span>    <a class="code hl_function" href="#a4c02435b9feed10fb546e874e85ecf83">mg_set_thread_name</a>(<span class="stringliteral">&quot;master&quot;</span>);</div>
<div class="line"><span class="lineno">20056</span> </div>
<div class="line"><span class="lineno">20057</span>    <span class="comment">/* Increase priority of the master thread */</span></div>
<div class="line"><span class="lineno">20058</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">20059</span>    SetThreadPriority(GetCurrentThread(), THREAD_PRIORITY_ABOVE_NORMAL);</div>
<div class="line"><span class="lineno">20060</span><span class="preprocessor">#elif defined(USE_MASTER_THREAD_PRIORITY)</span></div>
<div class="line"><span class="lineno">20061</span>    <span class="keywordtype">int</span> min_prio = sched_get_priority_min(SCHED_RR);</div>
<div class="line"><span class="lineno">20062</span>    <span class="keywordtype">int</span> max_prio = sched_get_priority_max(SCHED_RR);</div>
<div class="line"><span class="lineno">20063</span>    <span class="keywordflow">if</span> ((min_prio &gt;= 0) &amp;&amp; (max_prio &gt;= 0)</div>
<div class="line"><span class="lineno">20064</span>        &amp;&amp; ((USE_MASTER_THREAD_PRIORITY) &lt;= max_prio)</div>
<div class="line"><span class="lineno">20065</span>        &amp;&amp; ((USE_MASTER_THREAD_PRIORITY) &gt;= min_prio)) {</div>
<div class="line"><span class="lineno">20066</span>        <span class="keyword">struct </span>sched_param sched_param = {0};</div>
<div class="line"><span class="lineno">20067</span>        sched_param.sched_priority = (USE_MASTER_THREAD_PRIORITY);</div>
<div class="line"><span class="lineno">20068</span>        pthread_setschedparam(pthread_self(), SCHED_RR, &amp;sched_param);</div>
<div class="line"><span class="lineno">20069</span>    }</div>
<div class="line"><span class="lineno">20070</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20071</span> </div>
<div class="line"><span class="lineno">20072</span>    <span class="comment">/* Initialize thread local storage */</span></div>
<div class="line"><span class="lineno">20073</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">20074</span>    tls.pthread_cond_helper_mutex = CreateEvent(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_define" href="gmacros_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code hl_define" href="gmacros_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20075</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20076</span>    tls.is_master = 1;</div>
<div class="line"><span class="lineno">20077</span>    pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, &amp;tls);</div>
<div class="line"><span class="lineno">20078</span> </div>
<div class="line"><span class="lineno">20079</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a68d88b77432b851cab0918eb2ce9d434">init_thread</a>) {</div>
<div class="line"><span class="lineno">20080</span>        <span class="comment">/* Callback for the master thread (type 0) */</span></div>
<div class="line"><span class="lineno">20081</span>        tls.user_ptr = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a68d88b77432b851cab0918eb2ce9d434">init_thread</a>(ctx, 0);</div>
<div class="line"><span class="lineno">20082</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">20083</span>        tls.user_ptr = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20084</span>    }</div>
<div class="line"><span class="lineno">20085</span> </div>
<div class="line"><span class="lineno">20086</span>    <span class="comment">/* Lua background script &quot;start&quot; event */</span></div>
<div class="line"><span class="lineno">20087</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">20088</span>    <span class="keywordflow">if</span> (ctx-&gt;lua_background_state) {</div>
<div class="line"><span class="lineno">20089</span>        <a class="code hl_struct" href="structlua__State.html">lua_State</a> *lstate = (<a class="code hl_struct" href="structlua__State.html">lua_State</a> *)ctx-&gt;lua_background_state;</div>
<div class="line"><span class="lineno">20090</span>        pthread_mutex_lock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">20091</span> </div>
<div class="line"><span class="lineno">20092</span>        <span class="comment">/* call &quot;start()&quot; in Lua */</span></div>
<div class="line"><span class="lineno">20093</span>        <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#abc2f6fef4682c1d4cdc33206aaf42bec">lua_getglobal</a>(lstate, <span class="stringliteral">&quot;start&quot;</span>);</div>
<div class="line"><span class="lineno">20094</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lapi_8c.html#a652b273947f0656686f998d8e90cd3ea">lua_type</a>(lstate, -1) == <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#adaa7fa6e2561c1bc428ba8d265171494">LUA_TFUNCTION</a>) {</div>
<div class="line"><span class="lineno">20095</span>            <span class="keywordtype">int</span> ret = <a class="code hl_define" href="lua-5_82_84_2src_2lua_8h.html#a589d7e3fd4c388d64056c88bf4672431">lua_pcall</a>(lstate, <span class="comment">/* args */</span> 0, <span class="comment">/* results */</span> 0, 0);</div>
<div class="line"><span class="lineno">20096</span>            <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line"><span class="lineno">20097</span>                <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> fc;</div>
<div class="line"><span class="lineno">20098</span>                lua_cry(<a class="code hl_function" href="#a46e65877beedb5fed507ad30dbf76d86">fake_connection</a>(&amp;fc, ctx),</div>
<div class="line"><span class="lineno">20099</span>                        ret,</div>
<div class="line"><span class="lineno">20100</span>                        lstate,</div>
<div class="line"><span class="lineno">20101</span>                        <span class="stringliteral">&quot;lua_background_script&quot;</span>,</div>
<div class="line"><span class="lineno">20102</span>                        <span class="stringliteral">&quot;start&quot;</span>);</div>
<div class="line"><span class="lineno">20103</span>            }</div>
<div class="line"><span class="lineno">20104</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">20105</span>            <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#abb8eae2164badeafdb037bc1e03cc822">lua_pop</a>(lstate, 1);</div>
<div class="line"><span class="lineno">20106</span>        }</div>
<div class="line"><span class="lineno">20107</span> </div>
<div class="line"><span class="lineno">20108</span>        <span class="comment">/* determine if there is a &quot;log()&quot; function in Lua background script */</span></div>
<div class="line"><span class="lineno">20109</span>        <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#abc2f6fef4682c1d4cdc33206aaf42bec">lua_getglobal</a>(lstate, <span class="stringliteral">&quot;log&quot;</span>);</div>
<div class="line"><span class="lineno">20110</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lapi_8c.html#a652b273947f0656686f998d8e90cd3ea">lua_type</a>(lstate, -1) == <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#adaa7fa6e2561c1bc428ba8d265171494">LUA_TFUNCTION</a>) {</div>
<div class="line"><span class="lineno">20111</span>            ctx-&gt;lua_bg_log_available = 1;</div>
<div class="line"><span class="lineno">20112</span>        }</div>
<div class="line"><span class="lineno">20113</span>        <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#abb8eae2164badeafdb037bc1e03cc822">lua_pop</a>(lstate, 1);</div>
<div class="line"><span class="lineno">20114</span> </div>
<div class="line"><span class="lineno">20115</span>        pthread_mutex_unlock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">20116</span>    }</div>
<div class="line"><span class="lineno">20117</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20118</span> </div>
<div class="line"><span class="lineno">20119</span>    <span class="comment">/* Server starts *now* */</span></div>
<div class="line"><span class="lineno">20120</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a0084702a827547767b25513d4400ce46">start_time</a> = time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20121</span> </div>
<div class="line"><span class="lineno">20122</span>    <span class="comment">/* Server accept loop */</span></div>
<div class="line"><span class="lineno">20123</span>    pfd = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a9ed2145955cdb391d6ffba32a1df8d16">listening_socket_fds</a>;</div>
<div class="line"><span class="lineno">20124</span>    <span class="keywordflow">while</span> (<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno">20125</span>        <span class="keywordflow">for</span> (i = 0; i &lt; ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ade1ccb738022fd01597c1816cb88d1e4">num_listening_sockets</a>; i++) {</div>
<div class="line"><span class="lineno">20126</span>            pfd[i].fd = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>;</div>
<div class="line"><span class="lineno">20127</span>            pfd[i].events = POLLIN;</div>
<div class="line"><span class="lineno">20128</span>        }</div>
<div class="line"><span class="lineno">20129</span> </div>
<div class="line"><span class="lineno">20130</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a3b9904a2b6ed6d472f5ee35c7c588863">mg_poll</a>(pfd,</div>
<div class="line"><span class="lineno">20131</span>                    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ade1ccb738022fd01597c1816cb88d1e4">num_listening_sockets</a>,</div>
<div class="line"><span class="lineno">20132</span>                    <a class="code hl_define" href="#abd345577a07dba9941d4cea32b4cf4fd">SOCKET_TIMEOUT_QUANTUM</a>,</div>
<div class="line"><span class="lineno">20133</span>                    &amp;(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>))</div>
<div class="line"><span class="lineno">20134</span>            &gt; 0) {</div>
<div class="line"><span class="lineno">20135</span>            <span class="keywordflow">for</span> (i = 0; i &lt; ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ade1ccb738022fd01597c1816cb88d1e4">num_listening_sockets</a>; i++) {</div>
<div class="line"><span class="lineno">20136</span>                <span class="comment">/* NOTE(lsm): on QNX, poll() returns POLLRDNORM after the</span></div>
<div class="line"><span class="lineno">20137</span><span class="comment">                 * successful poll, and POLLIN is defined as</span></div>
<div class="line"><span class="lineno">20138</span><span class="comment">                 * (POLLRDNORM | POLLRDBAND)</span></div>
<div class="line"><span class="lineno">20139</span><span class="comment">                 * Therefore, we&#39;re checking pfd[i].revents &amp; POLLIN, not</span></div>
<div class="line"><span class="lineno">20140</span><span class="comment">                 * pfd[i].revents == POLLIN. */</span></div>
<div class="line"><span class="lineno">20141</span>                <span class="keywordflow">if</span> (<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)</div>
<div class="line"><span class="lineno">20142</span>                    &amp;&amp; (pfd[i].revents &amp; POLLIN)) {</div>
<div class="line"><span class="lineno">20143</span>                    <a class="code hl_function" href="#a5231c9ac67e436368ba0fd12a7406701">accept_new_connection</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i], ctx);</div>
<div class="line"><span class="lineno">20144</span>                }</div>
<div class="line"><span class="lineno">20145</span>            }</div>
<div class="line"><span class="lineno">20146</span>        }</div>
<div class="line"><span class="lineno">20147</span>    }</div>
<div class="line"><span class="lineno">20148</span> </div>
<div class="line"><span class="lineno">20149</span>    <span class="comment">/* Here stop_flag is 1 - Initiate shutdown. */</span></div>
<div class="line"><span class="lineno">20150</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;stopping workers&quot;</span>);</div>
<div class="line"><span class="lineno">20151</span> </div>
<div class="line"><span class="lineno">20152</span>    <span class="comment">/* Stop signal received: somebody called mg_stop. Quit. */</span></div>
<div class="line"><span class="lineno">20153</span>    <a class="code hl_function" href="#a3c23cebc85fcd88f7a1cf2227a7e1889">close_all_listening_sockets</a>(ctx);</div>
<div class="line"><span class="lineno">20154</span> </div>
<div class="line"><span class="lineno">20155</span>    <span class="comment">/* Wakeup workers that are waiting for connections to handle. */</span></div>
<div class="line"><span class="lineno">20156</span><span class="preprocessor">#if defined(ALTERNATIVE_QUEUE)</span></div>
<div class="line"><span class="lineno">20157</span>    <span class="keywordflow">for</span> (i = 0; i &lt; ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a>; i++) {</div>
<div class="line"><span class="lineno">20158</span>        event_signal(ctx-&gt;client_wait_events[i]);</div>
<div class="line"><span class="lineno">20159</span>    }</div>
<div class="line"><span class="lineno">20160</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">20161</span>    (void)pthread_mutex_lock(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">thread_mutex</a>);</div>
<div class="line"><span class="lineno">20162</span>    pthread_cond_broadcast(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aad49398eacc039c312d58c55530c65fa">sq_full</a>);</div>
<div class="line"><span class="lineno">20163</span>    (void)pthread_mutex_unlock(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">thread_mutex</a>);</div>
<div class="line"><span class="lineno">20164</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20165</span> </div>
<div class="line"><span class="lineno">20166</span>    <span class="comment">/* Join all worker threads to avoid leaking threads. */</span></div>
<div class="line"><span class="lineno">20167</span>    workerthreadcount = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a>;</div>
<div class="line"><span class="lineno">20168</span>    <span class="keywordflow">for</span> (i = 0; i &lt; workerthreadcount; i++) {</div>
<div class="line"><span class="lineno">20169</span>        <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>[i] != 0) {</div>
<div class="line"><span class="lineno">20170</span>            <a class="code hl_function" href="#adfdfa9abee970034383cfb3e832d2217">mg_join_thread</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>[i]);</div>
<div class="line"><span class="lineno">20171</span>        }</div>
<div class="line"><span class="lineno">20172</span>    }</div>
<div class="line"><span class="lineno">20173</span> </div>
<div class="line"><span class="lineno">20174</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">20175</span>    <span class="comment">/* Free Lua state of lua background task */</span></div>
<div class="line"><span class="lineno">20176</span>    <span class="keywordflow">if</span> (ctx-&gt;lua_background_state) {</div>
<div class="line"><span class="lineno">20177</span>        <a class="code hl_struct" href="structlua__State.html">lua_State</a> *lstate = (<a class="code hl_struct" href="structlua__State.html">lua_State</a> *)ctx-&gt;lua_background_state;</div>
<div class="line"><span class="lineno">20178</span>        ctx-&gt;lua_bg_log_available = 0;</div>
<div class="line"><span class="lineno">20179</span> </div>
<div class="line"><span class="lineno">20180</span>        <span class="comment">/* call &quot;stop()&quot; in Lua */</span></div>
<div class="line"><span class="lineno">20181</span>        pthread_mutex_lock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">20182</span>        <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#abc2f6fef4682c1d4cdc33206aaf42bec">lua_getglobal</a>(lstate, <span class="stringliteral">&quot;stop&quot;</span>);</div>
<div class="line"><span class="lineno">20183</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lapi_8c.html#a652b273947f0656686f998d8e90cd3ea">lua_type</a>(lstate, -1) == <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#adaa7fa6e2561c1bc428ba8d265171494">LUA_TFUNCTION</a>) {</div>
<div class="line"><span class="lineno">20184</span>            <span class="keywordtype">int</span> ret = <a class="code hl_define" href="lua-5_82_84_2src_2lua_8h.html#a589d7e3fd4c388d64056c88bf4672431">lua_pcall</a>(lstate, <span class="comment">/* args */</span> 0, <span class="comment">/* results */</span> 0, 0);</div>
<div class="line"><span class="lineno">20185</span>            <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line"><span class="lineno">20186</span>                <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> fc;</div>
<div class="line"><span class="lineno">20187</span>                lua_cry(<a class="code hl_function" href="#a46e65877beedb5fed507ad30dbf76d86">fake_connection</a>(&amp;fc, ctx),</div>
<div class="line"><span class="lineno">20188</span>                        ret,</div>
<div class="line"><span class="lineno">20189</span>                        lstate,</div>
<div class="line"><span class="lineno">20190</span>                        <span class="stringliteral">&quot;lua_background_script&quot;</span>,</div>
<div class="line"><span class="lineno">20191</span>                        <span class="stringliteral">&quot;stop&quot;</span>);</div>
<div class="line"><span class="lineno">20192</span>            }</div>
<div class="line"><span class="lineno">20193</span>        }</div>
<div class="line"><span class="lineno">20194</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Close Lua background state %p&quot;</span>, lstate);</div>
<div class="line"><span class="lineno">20195</span>        <a class="code hl_function" href="lua-5_81_85_2src_2lstate_8c.html#a5d903983f1497b2fc58fba9df09e354d">lua_close</a>(lstate);</div>
<div class="line"><span class="lineno">20196</span> </div>
<div class="line"><span class="lineno">20197</span>        ctx-&gt;lua_background_state = 0;</div>
<div class="line"><span class="lineno">20198</span>        pthread_mutex_unlock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">20199</span>    }</div>
<div class="line"><span class="lineno">20200</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20201</span> </div>
<div class="line"><span class="lineno">20202</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;exiting&quot;</span>);</div>
<div class="line"><span class="lineno">20203</span> </div>
<div class="line"><span class="lineno">20204</span>    <span class="comment">/* call exit thread callback */</span></div>
<div class="line"><span class="lineno">20205</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aa591ee8f5b639f726a87601261ecfa9b">exit_thread</a>) {</div>
<div class="line"><span class="lineno">20206</span>        <span class="comment">/* Callback for the master thread (type 0) */</span></div>
<div class="line"><span class="lineno">20207</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aa591ee8f5b639f726a87601261ecfa9b">exit_thread</a>(ctx, 0, tls.user_ptr);</div>
<div class="line"><span class="lineno">20208</span>    }</div>
<div class="line"><span class="lineno">20209</span> </div>
<div class="line"><span class="lineno">20210</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">20211</span>    CloseHandle(tls.pthread_cond_helper_mutex);</div>
<div class="line"><span class="lineno">20212</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20213</span>    pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20214</span> </div>
<div class="line"><span class="lineno">20215</span>    <span class="comment">/* Signal mg_stop() that we&#39;re done.</span></div>
<div class="line"><span class="lineno">20216</span><span class="comment">     * WARNING: This must be the very last thing this</span></div>
<div class="line"><span class="lineno">20217</span><span class="comment">     * thread does, as ctx becomes invalid after this line. */</span></div>
<div class="line"><span class="lineno">20218</span>    <a class="code hl_define" href="#a5cd88c4a6b9186f77507c50a6ae6625f">STOP_FLAG_ASSIGN</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>, 2);</div>
<div class="line"><span class="lineno">20219</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a03c9b752bc27bdf5941ddde6f615dd44"><div class="ttname"><a href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a></div><div class="ttdeci">static pthread_key_t sTlsKey</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01580">civetweb.c:1580</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a3c23cebc85fcd88f7a1cf2227a7e1889"><div class="ttname"><a href="#a3c23cebc85fcd88f7a1cf2227a7e1889">close_all_listening_sockets</a></div><div class="ttdeci">static void close_all_listening_sockets(struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l15456">civetweb.c:15456</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a46e65877beedb5fed507ad30dbf76d86"><div class="ttname"><a href="#a46e65877beedb5fed507ad30dbf76d86">fake_connection</a></div><div class="ttdeci">static struct mg_connection * fake_connection(struct mg_connection *fc, struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03470">civetweb.c:3470</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a4c02435b9feed10fb546e874e85ecf83"><div class="ttname"><a href="#a4c02435b9feed10fb546e874e85ecf83">mg_set_thread_name</a></div><div class="ttdeci">static void static void mg_set_thread_name(const char *name)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02780">civetweb.c:2780</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a5231c9ac67e436368ba0fd12a7406701"><div class="ttname"><a href="#a5231c9ac67e436368ba0fd12a7406701">accept_new_connection</a></div><div class="ttdeci">static void accept_new_connection(const struct socket *listener, struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l19957">civetweb.c:19957</a></div></div>
<div class="ttc" id="acivetweb_8c_html_abd345577a07dba9941d4cea32b4cf4fd"><div class="ttname"><a href="#abd345577a07dba9941d4cea32b4cf4fd">SOCKET_TIMEOUT_QUANTUM</a></div><div class="ttdeci">#define SOCKET_TIMEOUT_QUANTUM</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00473">civetweb.c:473</a></div></div>
<div class="ttc" id="acivetweb_8c_html_adfdfa9abee970034383cfb3e832d2217"><div class="ttname"><a href="#adfdfa9abee970034383cfb3e832d2217">mg_join_thread</a></div><div class="ttdeci">static int mg_join_thread(pthread_t threadid)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l05757">civetweb.c:5757</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lstate_8c_html_a5d903983f1497b2fc58fba9df09e354d"><div class="ttname"><a href="lua-5_81_85_2src_2lstate_8c.html#a5d903983f1497b2fc58fba9df09e354d">lua_close</a></div><div class="ttdeci">LUA_API void lua_close(lua_State *L)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lstate_8c_source.html#l00199">lua-5.1.5/src/lstate.c:199</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lua_8h_html_abb8eae2164badeafdb037bc1e03cc822"><div class="ttname"><a href="lua-5_81_85_2src_2lua_8h.html#abb8eae2164badeafdb037bc1e03cc822">lua_pop</a></div><div class="ttdeci">#define lua_pop(L, n)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lua_8h_source.html#l00254">lua-5.1.5/src/lua.h:254</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lua_8h_html_adaa7fa6e2561c1bc428ba8d265171494"><div class="ttname"><a href="lua-5_81_85_2src_2lua_8h.html#adaa7fa6e2561c1bc428ba8d265171494">LUA_TFUNCTION</a></div><div class="ttdeci">#define LUA_TFUNCTION</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lua_8h_source.html#l00080">lua-5.1.5/src/lua.h:80</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_a68d88b77432b851cab0918eb2ce9d434"><div class="ttname"><a href="structmg__callbacks.html#a68d88b77432b851cab0918eb2ce9d434">mg_callbacks::init_thread</a></div><div class="ttdeci">void *(* init_thread)(const struct mg_context *ctx, int thread_type)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00393">civetweb.h:393</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_aa591ee8f5b639f726a87601261ecfa9b"><div class="ttname"><a href="structmg__callbacks.html#aa591ee8f5b639f726a87601261ecfa9b">mg_callbacks::exit_thread</a></div><div class="ttdeci">void(* exit_thread)(const struct mg_context *ctx, int thread_type, void *thread_pointer)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00400">civetweb.h:400</a></div></div>
<div class="ttc" id="astructmg__context_html_a0084702a827547767b25513d4400ce46"><div class="ttname"><a href="structmg__context.html#a0084702a827547767b25513d4400ce46">mg_context::start_time</a></div><div class="ttdeci">time_t start_time</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02412">civetweb.c:2412</a></div></div>
<div class="ttc" id="astructmg__context_html_afa57b9192357ddbae3c0fc3b5481425a"><div class="ttname"><a href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">mg_context::cfg_worker_threads</a></div><div class="ttdeci">unsigned int cfg_worker_threads</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02378">civetweb.c:2378</a></div></div>
<div class="ttc" id="astructmg__workerTLS_html"><div class="ttname"><a href="structmg__workerTLS.html">mg_workerTLS</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01587">civetweb.c:1587</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02378">mg_context::cfg_worker_threads</a>, <a class="el" href="civetweb_8c_source.html#l15456">close_all_listening_sockets()</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8h_source.html#l00400">mg_callbacks::exit_thread</a>, <a class="el" href="civetweb_8c_source.html#l03470">fake_connection()</a>, <a class="el" href="gmacros_8h_source.html#l00929">FALSE</a>, <a class="el" href="civetweb_8h_source.html#l00393">mg_callbacks::init_thread</a>, <a class="el" href="civetweb_8c_source.html#l01588">mg_workerTLS::is_master</a>, <a class="el" href="civetweb_8c_source.html#l02357">mg_context::listening_socket_fds</a>, <a class="el" href="civetweb_8c_source.html#l02356">mg_context::listening_sockets</a>, <a class="el" href="lua-5_81_85_2src_2lstate_8c_source.html#l00199">lua_close()</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00277">lua_getglobal</a>, <a class="el" href="lua-5_82_84_2src_2lua_8h_source.html#l00259">lua_pcall</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00254">lua_pop</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00080">LUA_TFUNCTION</a>, <a class="el" href="lua-5_81_85_2src_2lapi_8c_source.html#l00242">lua_type()</a>, <a class="el" href="civetweb_8c_source.html#l05757">mg_join_thread()</a>, <a class="el" href="civetweb_8c_source.html#l05938">mg_poll()</a>, <a class="el" href="civetweb_8c_source.html#l00948">mg_pollfd</a>, <a class="el" href="civetweb_8c_source.html#l02780">mg_set_thread_name()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02358">mg_context::num_listening_sockets</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, <a class="el" href="civetweb_8c_source.html#l00473">SOCKET_TIMEOUT_QUANTUM</a>, <a class="el" href="civetweb_8c_source.html#l02391">mg_context::sq_full</a>, <a class="el" href="civetweb_8c_source.html#l02412">mg_context::start_time</a>, <a class="el" href="civetweb_8c_source.html#l01580">sTlsKey</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, <a class="el" href="civetweb_8c_source.html#l02324">STOP_FLAG_ASSIGN</a>, <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>, <a class="el" href="civetweb_8c_source.html#l02374">mg_context::thread_mutex</a>, <a class="el" href="civetweb_8c_source.html#l01590">mg_workerTLS::user_ptr</a>, and <a class="el" href="civetweb_8c_source.html#l02379">mg_context::worker_threadids</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20231">master_thread()</a>.</p>

</div>
</div>
<a id="a68810f97aa216df1fa96103dec93fca3" name="a68810f97aa216df1fa96103dec93fca3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68810f97aa216df1fa96103dec93fca3">&#9670;&#160;</a></span>mg_atomic_dec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> ptrdiff_t mg_atomic_dec </td>
          <td>(</td>
          <td class="paramtype">volatile ptrdiff_t *</td>          <td class="paramname"><span class="paramname"><em>addr</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01144">1144</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1145</span>{</div>
<div class="line"><span class="lineno"> 1146</span>    ptrdiff_t ret;</div>
<div class="line"><span class="lineno"> 1147</span> </div>
<div class="line"><span class="lineno"> 1148</span><span class="preprocessor">#if defined(_WIN64) &amp;&amp; !defined(NO_ATOMICS)</span></div>
<div class="line"><span class="lineno"> 1149</span>    ret = InterlockedDecrement64(addr);</div>
<div class="line"><span class="lineno"> 1150</span><span class="preprocessor">#elif defined(_WIN32) &amp;&amp; !defined(NO_ATOMICS)</span></div>
<div class="line"><span class="lineno"> 1151</span>    ret = InterlockedDecrement(addr);</div>
<div class="line"><span class="lineno"> 1152</span><span class="preprocessor">#elif defined(__GNUC__)                                                        \</span></div>
<div class="line"><span class="lineno"> 1153</span><span class="preprocessor">    &amp;&amp; ((__GNUC__ &gt; 4) || ((__GNUC__ == 4) &amp;&amp; (__GNUC_MINOR__ &gt; 0)))           \</span></div>
<div class="line"><span class="lineno"> 1154</span><span class="preprocessor">    &amp;&amp; !defined(NO_ATOMICS)</span></div>
<div class="line"><span class="lineno"> 1155</span>    ret = __sync_sub_and_fetch(addr, 1);</div>
<div class="line"><span class="lineno"> 1156</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 1157</span>    <a class="code hl_function" href="#af9c2267422f7bd2de7c610a4e0eb8fb0">mg_global_lock</a>();</div>
<div class="line"><span class="lineno"> 1158</span>    ret = (--(*addr));</div>
<div class="line"><span class="lineno"> 1159</span>    <a class="code hl_function" href="#af8b5fc3bd1b6de9fe6137e7daea140ac">mg_global_unlock</a>();</div>
<div class="line"><span class="lineno"> 1160</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1161</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno"> 1162</span>}</div>
<div class="ttc" id="acivetweb_8c_html_af8b5fc3bd1b6de9fe6137e7daea140ac"><div class="ttname"><a href="#af8b5fc3bd1b6de9fe6137e7daea140ac">mg_global_unlock</a></div><div class="ttdeci">static FUNCTION_MAY_BE_UNUSED void mg_global_unlock(void)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01102">civetweb.c:1102</a></div></div>
<div class="ttc" id="acivetweb_8c_html_af9c2267422f7bd2de7c610a4e0eb8fb0"><div class="ttname"><a href="#af9c2267422f7bd2de7c610a4e0eb8fb0">mg_global_lock</a></div><div class="ttdeci">static FUNCTION_MAY_BE_UNUSED void mg_global_lock(void)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01094">civetweb.c:1094</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01094">mg_global_lock()</a>, and <a class="el" href="civetweb_8c_source.html#l01102">mg_global_unlock()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11552">abort_cgi_process()</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l17594">uninitialize_openssl()</a>.</p>

</div>
</div>
<a id="ac84429c87794be46b88e30fbd3b0bcfa" name="ac84429c87794be46b88e30fbd3b0bcfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac84429c87794be46b88e30fbd3b0bcfa">&#9670;&#160;</a></span>mg_atomic_inc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> ptrdiff_t mg_atomic_inc </td>
          <td>(</td>
          <td class="paramtype">volatile ptrdiff_t *</td>          <td class="paramname"><span class="paramname"><em>addr</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01121">1121</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1122</span>{</div>
<div class="line"><span class="lineno"> 1123</span>    ptrdiff_t ret;</div>
<div class="line"><span class="lineno"> 1124</span> </div>
<div class="line"><span class="lineno"> 1125</span><span class="preprocessor">#if defined(_WIN64) &amp;&amp; !defined(NO_ATOMICS)</span></div>
<div class="line"><span class="lineno"> 1126</span>    ret = InterlockedIncrement64(addr);</div>
<div class="line"><span class="lineno"> 1127</span><span class="preprocessor">#elif defined(_WIN32) &amp;&amp; !defined(NO_ATOMICS)</span></div>
<div class="line"><span class="lineno"> 1128</span>    ret = InterlockedIncrement(addr);</div>
<div class="line"><span class="lineno"> 1129</span><span class="preprocessor">#elif defined(__GNUC__)                                                        \</span></div>
<div class="line"><span class="lineno"> 1130</span><span class="preprocessor">    &amp;&amp; ((__GNUC__ &gt; 4) || ((__GNUC__ == 4) &amp;&amp; (__GNUC_MINOR__ &gt; 0)))           \</span></div>
<div class="line"><span class="lineno"> 1131</span><span class="preprocessor">    &amp;&amp; !defined(NO_ATOMICS)</span></div>
<div class="line"><span class="lineno"> 1132</span>    ret = __sync_add_and_fetch(addr, 1);</div>
<div class="line"><span class="lineno"> 1133</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 1134</span>    <a class="code hl_function" href="#af9c2267422f7bd2de7c610a4e0eb8fb0">mg_global_lock</a>();</div>
<div class="line"><span class="lineno"> 1135</span>    ret = (++(*addr));</div>
<div class="line"><span class="lineno"> 1136</span>    <a class="code hl_function" href="#af8b5fc3bd1b6de9fe6137e7daea140ac">mg_global_unlock</a>();</div>
<div class="line"><span class="lineno"> 1137</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1138</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno"> 1139</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01094">mg_global_lock()</a>, and <a class="el" href="civetweb_8c_source.html#l01102">mg_global_unlock()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, <a class="el" href="civetweb_8c_source.html#l01626">mg_current_thread_id()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a40d10ad1edce124016cf9efee6cb79c7" name="a40d10ad1edce124016cf9efee6cb79c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40d10ad1edce124016cf9efee6cb79c7">&#9670;&#160;</a></span>mg_base64_decode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_base64_decode </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>src</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>src_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *</td>          <td class="paramname"><span class="paramname"><em>dst</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *</td>          <td class="paramname"><span class="paramname"><em>dst_len</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07383">7383</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7387</span>{</div>
<div class="line"><span class="lineno"> 7388</span>    <span class="keywordtype">size_t</span> i;</div>
<div class="line"><span class="lineno"> 7389</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code hl_class" href="classa.html">a</a>, b, c, d;</div>
<div class="line"><span class="lineno"> 7390</span>    <span class="keywordtype">size_t</span> dst_len_limit = (size_t)-1;</div>
<div class="line"><span class="lineno"> 7391</span>    <span class="keywordtype">size_t</span> dst_len_used = 0;</div>
<div class="line"><span class="lineno"> 7392</span> </div>
<div class="line"><span class="lineno"> 7393</span>    <span class="keywordflow">if</span> (dst_len != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7394</span>        dst_len_limit = *dst_len;</div>
<div class="line"><span class="lineno"> 7395</span>        *dst_len = 0;</div>
<div class="line"><span class="lineno"> 7396</span>    }</div>
<div class="line"><span class="lineno"> 7397</span> </div>
<div class="line"><span class="lineno"> 7398</span>    <span class="keywordflow">for</span> (i = 0; i &lt; src_len; i += 4) {</div>
<div class="line"><span class="lineno"> 7399</span>        <span class="comment">/* Read 4 characters from BASE64 string */</span></div>
<div class="line"><span class="lineno"> 7400</span>        <a class="code hl_class" href="classa.html">a</a> = <a class="code hl_function" href="#accf1ea390b445a26d81f9e25692fc267">b64reverse</a>(src[i]);</div>
<div class="line"><span class="lineno"> 7401</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classa.html">a</a> &gt;= 254) {</div>
<div class="line"><span class="lineno"> 7402</span>            <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)i;</div>
<div class="line"><span class="lineno"> 7403</span>        }</div>
<div class="line"><span class="lineno"> 7404</span> </div>
<div class="line"><span class="lineno"> 7405</span>        b = <a class="code hl_function" href="#accf1ea390b445a26d81f9e25692fc267">b64reverse</a>(((i + 1) &gt;= src_len) ? 0 : src[i + 1]);</div>
<div class="line"><span class="lineno"> 7406</span>        <span class="keywordflow">if</span> (b &gt;= 254) {</div>
<div class="line"><span class="lineno"> 7407</span>            <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)i + 1;</div>
<div class="line"><span class="lineno"> 7408</span>        }</div>
<div class="line"><span class="lineno"> 7409</span> </div>
<div class="line"><span class="lineno"> 7410</span>        c = <a class="code hl_function" href="#accf1ea390b445a26d81f9e25692fc267">b64reverse</a>(((i + 2) &gt;= src_len) ? 0 : src[i + 2]);</div>
<div class="line"><span class="lineno"> 7411</span>        <span class="keywordflow">if</span> (c == 254) {</div>
<div class="line"><span class="lineno"> 7412</span>            <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)i + 2;</div>
<div class="line"><span class="lineno"> 7413</span>        }</div>
<div class="line"><span class="lineno"> 7414</span> </div>
<div class="line"><span class="lineno"> 7415</span>        d = <a class="code hl_function" href="#accf1ea390b445a26d81f9e25692fc267">b64reverse</a>(((i + 3) &gt;= src_len) ? 0 : src[i + 3]);</div>
<div class="line"><span class="lineno"> 7416</span>        <span class="keywordflow">if</span> (d == 254) {</div>
<div class="line"><span class="lineno"> 7417</span>            <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)i + 3;</div>
<div class="line"><span class="lineno"> 7418</span>        }</div>
<div class="line"><span class="lineno"> 7419</span> </div>
<div class="line"><span class="lineno"> 7420</span>        <span class="comment">/* Add first (of 3) decoded character */</span></div>
<div class="line"><span class="lineno"> 7421</span>        <span class="keywordflow">if</span> (dst_len_used &lt; dst_len_limit) {</div>
<div class="line"><span class="lineno"> 7422</span>            dst[dst_len_used] = (<span class="keywordtype">unsigned</span> char)((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(<a class="code hl_class" href="classa.html">a</a> &lt;&lt; 2)</div>
<div class="line"><span class="lineno"> 7423</span>                                                + (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(b &gt;&gt; 4));</div>
<div class="line"><span class="lineno"> 7424</span>        }</div>
<div class="line"><span class="lineno"> 7425</span>        dst_len_used++;</div>
<div class="line"><span class="lineno"> 7426</span> </div>
<div class="line"><span class="lineno"> 7427</span>        <span class="keywordflow">if</span> (c != 255) {</div>
<div class="line"><span class="lineno"> 7428</span>            <span class="keywordflow">if</span> (dst_len_used &lt; dst_len_limit) {</div>
<div class="line"><span class="lineno"> 7429</span> </div>
<div class="line"><span class="lineno"> 7430</span>                dst[dst_len_used] = (<span class="keywordtype">unsigned</span> char)((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(b &lt;&lt; 4)</div>
<div class="line"><span class="lineno"> 7431</span>                                                    + (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(c &gt;&gt; 2));</div>
<div class="line"><span class="lineno"> 7432</span>            }</div>
<div class="line"><span class="lineno"> 7433</span>            dst_len_used++;</div>
<div class="line"><span class="lineno"> 7434</span>            <span class="keywordflow">if</span> (d != 255) {</div>
<div class="line"><span class="lineno"> 7435</span>                <span class="keywordflow">if</span> (dst_len_used &lt; dst_len_limit) {</div>
<div class="line"><span class="lineno"> 7436</span>                    dst[dst_len_used] =</div>
<div class="line"><span class="lineno"> 7437</span>                        (<span class="keywordtype">unsigned</span> char)((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(c &lt;&lt; 6) + d);</div>
<div class="line"><span class="lineno"> 7438</span>                }</div>
<div class="line"><span class="lineno"> 7439</span>                dst_len_used++;</div>
<div class="line"><span class="lineno"> 7440</span>            }</div>
<div class="line"><span class="lineno"> 7441</span>        }</div>
<div class="line"><span class="lineno"> 7442</span>    }</div>
<div class="line"><span class="lineno"> 7443</span> </div>
<div class="line"><span class="lineno"> 7444</span>    <span class="comment">/* Add terminating zero */</span></div>
<div class="line"><span class="lineno"> 7445</span>    <span class="keywordflow">if</span> (dst_len_used &lt; dst_len_limit) {</div>
<div class="line"><span class="lineno"> 7446</span>        dst[dst_len_used] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 7447</span>    }</div>
<div class="line"><span class="lineno"> 7448</span>    dst_len_used++;</div>
<div class="line"><span class="lineno"> 7449</span>    <span class="keywordflow">if</span> (dst_len != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7450</span>        *dst_len = dst_len_used;</div>
<div class="line"><span class="lineno"> 7451</span>    }</div>
<div class="line"><span class="lineno"> 7452</span> </div>
<div class="line"><span class="lineno"> 7453</span>    <span class="keywordflow">if</span> (dst_len_used &gt; dst_len_limit) {</div>
<div class="line"><span class="lineno"> 7454</span>        <span class="comment">/* Out of memory */</span></div>
<div class="line"><span class="lineno"> 7455</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 7456</span>    }</div>
<div class="line"><span class="lineno"> 7457</span> </div>
<div class="line"><span class="lineno"> 7458</span>    <span class="comment">/* Return -1 for &quot;OK&quot; */</span></div>
<div class="line"><span class="lineno"> 7459</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 7460</span>}</div>
<div class="ttc" id="acivetweb_8c_html_accf1ea390b445a26d81f9e25692fc267"><div class="ttname"><a href="#accf1ea390b445a26d81f9e25692fc267">b64reverse</a></div><div class="ttdeci">static unsigned char b64reverse(char letter)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07358">civetweb.c:7358</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l07358">b64reverse()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08555">parse_auth_header()</a>.</p>

</div>
</div>
<a id="a16f495b82ab6766de6c2d0e86ea4a82d" name="a16f495b82ab6766de6c2d0e86ea4a82d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16f495b82ab6766de6c2d0e86ea4a82d">&#9670;&#160;</a></span>mg_base64_encode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_base64_encode </td>
          <td>(</td>
          <td class="paramtype">const unsigned char *</td>          <td class="paramname"><span class="paramname"><em>src</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>src_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>dst</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *</td>          <td class="paramname"><span class="paramname"><em>dst_len</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07305">7305</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7309</span>{</div>
<div class="line"><span class="lineno"> 7310</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *b64 =</div>
<div class="line"><span class="lineno"> 7311</span>        <span class="stringliteral">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;</div>
<div class="line"><span class="lineno"> 7312</span>    <span class="keywordtype">size_t</span> i, j;</div>
<div class="line"><span class="lineno"> 7313</span>    <span class="keywordtype">int</span> <a class="code hl_class" href="classa.html">a</a>, b, c;</div>
<div class="line"><span class="lineno"> 7314</span> </div>
<div class="line"><span class="lineno"> 7315</span>    <span class="keywordflow">if</span> (dst_len != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7316</span>        <span class="comment">/* Expected length including 0 termination: */</span></div>
<div class="line"><span class="lineno"> 7317</span>        <span class="comment">/* IN 1 -&gt; OUT 5, IN 2 -&gt; OUT 5, IN 3 -&gt; OUT 5, IN 4 -&gt; OUT 9,</span></div>
<div class="line"><span class="lineno"> 7318</span><span class="comment">         * IN 5 -&gt; OUT 9, IN 6 -&gt; OUT 9, IN 7 -&gt; OUT 13, etc. */</span></div>
<div class="line"><span class="lineno"> 7319</span>        <span class="keywordtype">size_t</span> expected_len = ((src_len + 2) / 3) * 4 + 1;</div>
<div class="line"><span class="lineno"> 7320</span>        <span class="keywordflow">if</span> (*dst_len &lt; expected_len) {</div>
<div class="line"><span class="lineno"> 7321</span>            <span class="keywordflow">if</span> (*dst_len &gt; 0) {</div>
<div class="line"><span class="lineno"> 7322</span>                dst[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 7323</span>            }</div>
<div class="line"><span class="lineno"> 7324</span>            *dst_len = expected_len;</div>
<div class="line"><span class="lineno"> 7325</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 7326</span>        }</div>
<div class="line"><span class="lineno"> 7327</span>    }</div>
<div class="line"><span class="lineno"> 7328</span> </div>
<div class="line"><span class="lineno"> 7329</span>    <span class="keywordflow">for</span> (i = j = 0; i &lt; src_len; i += 3) {</div>
<div class="line"><span class="lineno"> 7330</span>        <a class="code hl_class" href="classa.html">a</a> = src[i];</div>
<div class="line"><span class="lineno"> 7331</span>        b = ((i + 1) &gt;= src_len) ? 0 : src[i + 1];</div>
<div class="line"><span class="lineno"> 7332</span>        c = ((i + 2) &gt;= src_len) ? 0 : src[i + 2];</div>
<div class="line"><span class="lineno"> 7333</span> </div>
<div class="line"><span class="lineno"> 7334</span>        dst[j++] = b64[<a class="code hl_class" href="classa.html">a</a> &gt;&gt; 2];</div>
<div class="line"><span class="lineno"> 7335</span>        dst[j++] = b64[((<a class="code hl_class" href="classa.html">a</a> &amp; 3) &lt;&lt; 4) | (b &gt;&gt; 4)];</div>
<div class="line"><span class="lineno"> 7336</span>        <span class="keywordflow">if</span> (i + 1 &lt; src_len) {</div>
<div class="line"><span class="lineno"> 7337</span>            dst[j++] = b64[(b &amp; 15) &lt;&lt; 2 | (c &gt;&gt; 6)];</div>
<div class="line"><span class="lineno"> 7338</span>        }</div>
<div class="line"><span class="lineno"> 7339</span>        <span class="keywordflow">if</span> (i + 2 &lt; src_len) {</div>
<div class="line"><span class="lineno"> 7340</span>            dst[j++] = b64[c &amp; 63];</div>
<div class="line"><span class="lineno"> 7341</span>        }</div>
<div class="line"><span class="lineno"> 7342</span>    }</div>
<div class="line"><span class="lineno"> 7343</span>    <span class="keywordflow">while</span> (j % 4 != 0) {</div>
<div class="line"><span class="lineno"> 7344</span>        dst[j++] = <span class="charliteral">&#39;=&#39;</span>;</div>
<div class="line"><span class="lineno"> 7345</span>    }</div>
<div class="line"><span class="lineno"> 7346</span>    dst[j++] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 7347</span> </div>
<div class="line"><span class="lineno"> 7348</span>    <span class="keywordflow">if</span> (dst_len != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7349</span>        *dst_len = (size_t)j;</div>
<div class="line"><span class="lineno"> 7350</span>    }</div>
<div class="line"><span class="lineno"> 7351</span> </div>
<div class="line"><span class="lineno"> 7352</span>    <span class="comment">/* Return -1 for &quot;OK&quot; */</span></div>
<div class="line"><span class="lineno"> 7353</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 7354</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

</div>
</div>
<a id="ad3552193bd019b58e092032223ac38f1" name="ad3552193bd019b58e092032223ac38f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3552193bd019b58e092032223ac38f1">&#9670;&#160;</a></span>mg_calloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static __inline void * mg_calloc </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>a</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>b</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01480">1480</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1481</span>{</div>
<div class="line"><span class="lineno"> 1482</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="#a84beef8cc122add35118ec7cd35286c4">calloc</a>(<a class="code hl_class" href="classa.html">a</a>, b);</div>
<div class="line"><span class="lineno"> 1483</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a84beef8cc122add35118ec7cd35286c4"><div class="ttname"><a href="#a84beef8cc122add35118ec7cd35286c4">calloc</a></div><div class="ttdeci">#define calloc</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01540">civetweb.c:1540</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01540">calloc</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l09057">mg_modify_passwords_file_ha1()</a>, and <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="a8e38f4db9a8d42ff57623b15f11f93b1" name="a8e38f4db9a8d42ff57623b15f11f93b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e38f4db9a8d42ff57623b15f11f93b1">&#9670;&#160;</a></span>mg_check_digest_access_authentication()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_check_digest_access_authentication </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>realm</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>filename</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08893">8893</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8896</span>{</div>
<div class="line"><span class="lineno"> 8897</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno"> 8898</span>    <span class="keywordtype">int</span> auth;</div>
<div class="line"><span class="lineno"> 8899</span> </div>
<div class="line"><span class="lineno"> 8900</span>    <span class="keywordflow">if</span> (!conn || !filename) {</div>
<div class="line"><span class="lineno"> 8901</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 8902</span>    }</div>
<div class="line"><span class="lineno"> 8903</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, filename, <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>, &amp;file)) {</div>
<div class="line"><span class="lineno"> 8904</span>        <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 8905</span>    }</div>
<div class="line"><span class="lineno"> 8906</span> </div>
<div class="line"><span class="lineno"> 8907</span>    auth = <a class="code hl_function" href="#abbf5e7625b9c8d60ffc4d84b02923943">authorize</a>(conn, &amp;file, realm);</div>
<div class="line"><span class="lineno"> 8908</span> </div>
<div class="line"><span class="lineno"> 8909</span>    <a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>);</div>
<div class="line"><span class="lineno"> 8910</span> </div>
<div class="line"><span class="lineno"> 8911</span>    <span class="keywordflow">return</span> auth;</div>
<div class="line"><span class="lineno"> 8912</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l08861">authorize()</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02843">MG_FOPEN_MODE_READ</a>, and <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>.</p>

</div>
</div>
<a id="ad6e4a71c131991d1bf9dac0c74b7e8b2" name="ad6e4a71c131991d1bf9dac0c74b7e8b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">&#9670;&#160;</a></span>mg_check_feature()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> unsigned mg_check_feature </td>
          <td>(</td>
          <td class="paramtype">unsigned</td>          <td class="paramname"><span class="paramname"><em>feature</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l21430">21430</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">21431</span>{</div>
<div class="line"><span class="lineno">21432</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> feature_set = 0</div>
<div class="line"><span class="lineno">21433</span>    <span class="comment">/* Set bits for available features according to API documentation.</span></div>
<div class="line"><span class="lineno">21434</span><span class="comment">     * This bit mask is created at compile time, according to the active</span></div>
<div class="line"><span class="lineno">21435</span><span class="comment">     * preprocessor defines. It is a single const value at runtime. */</span></div>
<div class="line"><span class="lineno">21436</span><span class="preprocessor">#if !defined(NO_FILES)</span></div>
<div class="line"><span class="lineno">21437</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da79f7476503d279aebb8e29415c310ba1">MG_FEATURES_FILES</a></div>
<div class="line"><span class="lineno">21438</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21439</span><span class="preprocessor">#if !defined(NO_SSL) || defined(USE_MBEDTLS)</span></div>
<div class="line"><span class="lineno">21440</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daba4b4d11dd0dec1ba0833f0bb1de2b0e">MG_FEATURES_SSL</a></div>
<div class="line"><span class="lineno">21441</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21442</span><span class="preprocessor">#if !defined(NO_CGI)</span></div>
<div class="line"><span class="lineno">21443</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da84fc7ef257026875a66d71eddd99a52a">MG_FEATURES_CGI</a></div>
<div class="line"><span class="lineno">21444</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21445</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">21446</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da899e17934638eaac9928e3ca39c4b4ba">MG_FEATURES_IPV6</a></div>
<div class="line"><span class="lineno">21447</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21448</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno">21449</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daeb94a2a63430c86ebbae4dfe84e7f8de">MG_FEATURES_WEBSOCKET</a></div>
<div class="line"><span class="lineno">21450</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21451</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">21452</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dad09716f1978e57ab93c65da1c53ccb1d">MG_FEATURES_LUA</a></div>
<div class="line"><span class="lineno">21453</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21454</span><span class="preprocessor">#if defined(USE_DUKTAPE)</span></div>
<div class="line"><span class="lineno">21455</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daec89c7f60acc1228627d697da889dfa6">MG_FEATURES_SSJS</a></div>
<div class="line"><span class="lineno">21456</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21457</span><span class="preprocessor">#if !defined(NO_CACHING)</span></div>
<div class="line"><span class="lineno">21458</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da65c4232cdd767df45fcd9abea0cc66e2">MG_FEATURES_CACHE</a></div>
<div class="line"><span class="lineno">21459</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21460</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">21461</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da56a0059eeae63a991e650d956719db5b">MG_FEATURES_STATS</a></div>
<div class="line"><span class="lineno">21462</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21463</span><span class="preprocessor">#if defined(USE_ZLIB)</span></div>
<div class="line"><span class="lineno">21464</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dafafb5cadff6871526c7b6db515983eef">MG_FEATURES_COMPRESSION</a></div>
<div class="line"><span class="lineno">21465</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21466</span><span class="preprocessor">#if defined(USE_HTTP2)</span></div>
<div class="line"><span class="lineno">21467</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da04681512f408a96ac398846b65eb74ec">MG_FEATURES_HTTP2</a></div>
<div class="line"><span class="lineno">21468</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21469</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno">21470</span>                                        | <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daabd5074b3d3bb11e9528c539274c6841">MG_FEATURES_X_DOMAIN_SOCKET</a></div>
<div class="line"><span class="lineno">21471</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21472</span> </div>
<div class="line"><span class="lineno">21473</span>    <span class="comment">/* Set some extra bits not defined in the API documentation.</span></div>
<div class="line"><span class="lineno">21474</span><span class="comment">     * These bits may change without further notice. */</span></div>
<div class="line"><span class="lineno">21475</span><span class="preprocessor">#if defined(MG_LEGACY_INTERFACE)</span></div>
<div class="line"><span class="lineno">21476</span>                                        | 0x80000000u</div>
<div class="line"><span class="lineno">21477</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21478</span><span class="preprocessor">#if defined(MG_EXPERIMENTAL_INTERFACES)</span></div>
<div class="line"><span class="lineno">21479</span>                                        | 0x40000000u</div>
<div class="line"><span class="lineno">21480</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21481</span><span class="preprocessor">#if !defined(NO_RESPONSE_BUFFERING)</span></div>
<div class="line"><span class="lineno">21482</span>                                        | 0x20000000u</div>
<div class="line"><span class="lineno">21483</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21484</span><span class="preprocessor">#if defined(MEMORY_DEBUGGING)</span></div>
<div class="line"><span class="lineno">21485</span>                                        | 0x10000000u</div>
<div class="line"><span class="lineno">21486</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21487</span>        ;</div>
<div class="line"><span class="lineno">21488</span>    <span class="keywordflow">return</span> (feature &amp; feature_set);</div>
<div class="line"><span class="lineno">21489</span>}</div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da04681512f408a96ac398846b65eb74ec"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da04681512f408a96ac398846b65eb74ec">MG_FEATURES_HTTP2</a></div><div class="ttdeci">@ MG_FEATURES_HTTP2</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00102">civetweb.h:102</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da56a0059eeae63a991e650d956719db5b"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da56a0059eeae63a991e650d956719db5b">MG_FEATURES_STATS</a></div><div class="ttdeci">@ MG_FEATURES_STATS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00095">civetweb.h:95</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da65c4232cdd767df45fcd9abea0cc66e2"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da65c4232cdd767df45fcd9abea0cc66e2">MG_FEATURES_CACHE</a></div><div class="ttdeci">@ MG_FEATURES_CACHE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00091">civetweb.h:91</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da79f7476503d279aebb8e29415c310ba1"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da79f7476503d279aebb8e29415c310ba1">MG_FEATURES_FILES</a></div><div class="ttdeci">@ MG_FEATURES_FILES</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00061">civetweb.h:61</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da84fc7ef257026875a66d71eddd99a52a"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da84fc7ef257026875a66d71eddd99a52a">MG_FEATURES_CGI</a></div><div class="ttdeci">@ MG_FEATURES_CGI</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00071">civetweb.h:71</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da899e17934638eaac9928e3ca39c4b4ba"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da899e17934638eaac9928e3ca39c4b4ba">MG_FEATURES_IPV6</a></div><div class="ttdeci">@ MG_FEATURES_IPV6</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00075">civetweb.h:75</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2daabd5074b3d3bb11e9528c539274c6841"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daabd5074b3d3bb11e9528c539274c6841">MG_FEATURES_X_DOMAIN_SOCKET</a></div><div class="ttdeci">@ MG_FEATURES_X_DOMAIN_SOCKET</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00105">civetweb.h:105</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2daba4b4d11dd0dec1ba0833f0bb1de2b0e"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daba4b4d11dd0dec1ba0833f0bb1de2b0e">MG_FEATURES_SSL</a></div><div class="ttdeci">@ MG_FEATURES_SSL</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00067">civetweb.h:67</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2dad09716f1978e57ab93c65da1c53ccb1d"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dad09716f1978e57ab93c65da1c53ccb1d">MG_FEATURES_LUA</a></div><div class="ttdeci">@ MG_FEATURES_LUA</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00083">civetweb.h:83</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2daeb94a2a63430c86ebbae4dfe84e7f8de"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daeb94a2a63430c86ebbae4dfe84e7f8de">MG_FEATURES_WEBSOCKET</a></div><div class="ttdeci">@ MG_FEATURES_WEBSOCKET</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00079">civetweb.h:79</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2daec89c7f60acc1228627d697da889dfa6"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daec89c7f60acc1228627d697da889dfa6">MG_FEATURES_SSJS</a></div><div class="ttdeci">@ MG_FEATURES_SSJS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00087">civetweb.h:87</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2dafafb5cadff6871526c7b6db515983eef"><div class="ttname"><a href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dafafb5cadff6871526c7b6db515983eef">MG_FEATURES_COMPRESSION</a></div><div class="ttdeci">@ MG_FEATURES_COMPRESSION</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00099">civetweb.h:99</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00091">MG_FEATURES_CACHE</a>, <a class="el" href="civetweb_8h_source.html#l00071">MG_FEATURES_CGI</a>, <a class="el" href="civetweb_8h_source.html#l00099">MG_FEATURES_COMPRESSION</a>, <a class="el" href="civetweb_8h_source.html#l00061">MG_FEATURES_FILES</a>, <a class="el" href="civetweb_8h_source.html#l00102">MG_FEATURES_HTTP2</a>, <a class="el" href="civetweb_8h_source.html#l00075">MG_FEATURES_IPV6</a>, <a class="el" href="civetweb_8h_source.html#l00083">MG_FEATURES_LUA</a>, <a class="el" href="civetweb_8h_source.html#l00087">MG_FEATURES_SSJS</a>, <a class="el" href="civetweb_8h_source.html#l00067">MG_FEATURES_SSL</a>, <a class="el" href="civetweb_8h_source.html#l00095">MG_FEATURES_STATS</a>, <a class="el" href="civetweb_8h_source.html#l00079">MG_FEATURES_WEBSOCKET</a>, and <a class="el" href="civetweb_8h_source.html#l00105">MG_FEATURES_X_DOMAIN_SOCKET</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l21512">mg_get_system_info()</a>, and <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>.</p>

</div>
</div>
<a id="ae3c0b2bb9143f8eebd7c4c12fc4f0333" name="ae3c0b2bb9143f8eebd7c4c12fc4f0333"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3c0b2bb9143f8eebd7c4c12fc4f0333">&#9670;&#160;</a></span>mg_close_connection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_close_connection </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17938">17938</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17939</span>{</div>
<div class="line"><span class="lineno">17940</span>    <span class="keywordflow">if</span> ((conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">17941</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">17942</span>    }</div>
<div class="line"><span class="lineno">17943</span> </div>
<div class="line"><span class="lineno">17944</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno">17945</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099">CONTEXT_SERVER</a>) {</div>
<div class="line"><span class="lineno">17946</span>        <span class="keywordflow">if</span> (conn-&gt;in_websocket_handling) {</div>
<div class="line"><span class="lineno">17947</span>            <span class="comment">/* Set close flag, so the server thread can exit. */</span></div>
<div class="line"><span class="lineno">17948</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">17949</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">17950</span>        }</div>
<div class="line"><span class="lineno">17951</span>    }</div>
<div class="line"><span class="lineno">17952</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a03e63e1c82cfb5e937a777e71c4a40f2">CONTEXT_WS_CLIENT</a>) {</div>
<div class="line"><span class="lineno">17953</span> </div>
<div class="line"><span class="lineno">17954</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">17955</span> </div>
<div class="line"><span class="lineno">17956</span>        <span class="comment">/* client context: loops must end */</span></div>
<div class="line"><span class="lineno">17957</span>        <a class="code hl_define" href="#a5cd88c4a6b9186f77507c50a6ae6625f">STOP_FLAG_ASSIGN</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>, 1);</div>
<div class="line"><span class="lineno">17958</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">17959</span> </div>
<div class="line"><span class="lineno">17960</span>        <span class="comment">/* We need to get the client thread out of the select/recv call</span></div>
<div class="line"><span class="lineno">17961</span><span class="comment">         * here. */</span></div>
<div class="line"><span class="lineno">17962</span>        <span class="comment">/* Since we use a sleep quantum of some seconds to check for recv</span></div>
<div class="line"><span class="lineno">17963</span><span class="comment">         * timeouts, we will just wait a few seconds in mg_join_thread. */</span></div>
<div class="line"><span class="lineno">17964</span> </div>
<div class="line"><span class="lineno">17965</span>        <span class="comment">/* join worker thread */</span></div>
<div class="line"><span class="lineno">17966</span>        <span class="keywordflow">for</span> (i = 0; i &lt; conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a>; i++) {</div>
<div class="line"><span class="lineno">17967</span>            <a class="code hl_function" href="#adfdfa9abee970034383cfb3e832d2217">mg_join_thread</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>[i]);</div>
<div class="line"><span class="lineno">17968</span>        }</div>
<div class="line"><span class="lineno">17969</span>    }</div>
<div class="line"><span class="lineno">17970</span><span class="preprocessor">#endif </span><span class="comment">/* defined(USE_WEBSOCKET) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">17971</span> </div>
<div class="line"><span class="lineno">17972</span>    <a class="code hl_function" href="#af4b9971ca12d36d97d92dd7980059fb0">close_connection</a>(conn);</div>
<div class="line"><span class="lineno">17973</span> </div>
<div class="line"><span class="lineno">17974</span><span class="preprocessor">#if !defined(NO_SSL) &amp;&amp; !defined(USE_MBEDTLS) </span><span class="comment">// TODO: mbedTLS client</span></div>
<div class="line"><span class="lineno">17975</span>    <span class="keywordflow">if</span> (((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5ac5e9108e1a7588fe9429108516575440">CONTEXT_HTTP_CLIENT</a>)</div>
<div class="line"><span class="lineno">17976</span>         || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a03e63e1c82cfb5e937a777e71c4a40f2">CONTEXT_WS_CLIENT</a>))</div>
<div class="line"><span class="lineno">17977</span>        &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">17978</span>        SSL_CTX_free(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>);</div>
<div class="line"><span class="lineno">17979</span>    }</div>
<div class="line"><span class="lineno">17980</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17981</span> </div>
<div class="line"><span class="lineno">17982</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno">17983</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a03e63e1c82cfb5e937a777e71c4a40f2">CONTEXT_WS_CLIENT</a>) {</div>
<div class="line"><span class="lineno">17984</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>);</div>
<div class="line"><span class="lineno">17985</span>        (void)pthread_mutex_destroy(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a641ac188409fd64c07e486b265d58a03">mutex</a>);</div>
<div class="line"><span class="lineno">17986</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn);</div>
<div class="line"><span class="lineno">17987</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5ac5e9108e1a7588fe9429108516575440">CONTEXT_HTTP_CLIENT</a>) {</div>
<div class="line"><span class="lineno">17988</span>        (void)pthread_mutex_destroy(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a641ac188409fd64c07e486b265d58a03">mutex</a>);</div>
<div class="line"><span class="lineno">17989</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn);</div>
<div class="line"><span class="lineno">17990</span>    }</div>
<div class="line"><span class="lineno">17991</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">17992</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5ac5e9108e1a7588fe9429108516575440">CONTEXT_HTTP_CLIENT</a>) { <span class="comment">/* Client */</span></div>
<div class="line"><span class="lineno">17993</span>        (void)pthread_mutex_destroy(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a641ac188409fd64c07e486b265d58a03">mutex</a>);</div>
<div class="line"><span class="lineno">17994</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn);</div>
<div class="line"><span class="lineno">17995</span>    }</div>
<div class="line"><span class="lineno">17996</span><span class="preprocessor">#endif </span><span class="comment">/* defined(USE_WEBSOCKET) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">17997</span>}</div>
<div class="ttc" id="acivetweb_8c_html_af4b9971ca12d36d97d92dd7980059fb0"><div class="ttname"><a href="#af4b9971ca12d36d97d92dd7980059fb0">close_connection</a></div><div class="ttdeci">static void close_connection(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17864">civetweb.c:17864</a></div></div>
<div class="ttc" id="astructmg__connection_html_a641ac188409fd64c07e486b265d58a03"><div class="ttname"><a href="structmg__connection.html#a641ac188409fd64c07e486b265d58a03">mg_connection::mutex</a></div><div class="ttdeci">pthread_mutex_t mutex</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02565">civetweb.c:2565</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02378">mg_context::cfg_worker_threads</a>, <a class="el" href="civetweb_8c_source.html#l17864">close_connection()</a>, <a class="el" href="civetweb_8c_source.html#l02264">CONTEXT_HTTP_CLIENT</a>, <a class="el" href="civetweb_8c_source.html#l02263">CONTEXT_SERVER</a>, <a class="el" href="civetweb_8c_source.html#l02354">mg_context::context_type</a>, <a class="el" href="civetweb_8c_source.html#l02265">CONTEXT_WS_CLIENT</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l05757">mg_join_thread()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="civetweb_8c_source.html#l02565">mg_connection::mutex</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, <a class="el" href="civetweb_8c_source.html#l02324">STOP_FLAG_ASSIGN</a>, and <a class="el" href="civetweb_8c_source.html#l02379">mg_context::worker_threadids</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l18874">mg_download()</a>, and <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00995">run_client()</a>.</p>

</div>
</div>
<a id="ace350941110e963aeb1ce985260c6a51" name="ace350941110e963aeb1ce985260c6a51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace350941110e963aeb1ce985260c6a51">&#9670;&#160;</a></span>mg_connect_client()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> * mg_connect_client </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>host</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>port</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>use_ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>error_buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>error_buffer_size</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18253">18253</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">18258</span>{</div>
<div class="line"><span class="lineno">18259</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__client__options.html">mg_client_options</a> opts;</div>
<div class="line"><span class="lineno">18260</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__init__data.html">mg_init_data</a> init;</div>
<div class="line"><span class="lineno">18261</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__error__data.html">mg_error_data</a> <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>;</div>
<div class="line"><span class="lineno">18262</span> </div>
<div class="line"><span class="lineno">18263</span>    memset(&amp;init, 0, <span class="keyword">sizeof</span>(init));</div>
<div class="line"><span class="lineno">18264</span> </div>
<div class="line"><span class="lineno">18265</span>    memset(&amp;<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>));</div>
<div class="line"><span class="lineno">18266</span>    <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>.text_buffer_size = error_buffer_size;</div>
<div class="line"><span class="lineno">18267</span>    <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>.text = error_buffer;</div>
<div class="line"><span class="lineno">18268</span> </div>
<div class="line"><span class="lineno">18269</span>    memset(&amp;opts, 0, <span class="keyword">sizeof</span>(opts));</div>
<div class="line"><span class="lineno">18270</span>    opts.host = host;</div>
<div class="line"><span class="lineno">18271</span>    opts.port = port;</div>
<div class="line"><span class="lineno">18272</span>    <span class="keywordflow">if</span> (use_ssl) {</div>
<div class="line"><span class="lineno">18273</span>        opts.host_name = host;</div>
<div class="line"><span class="lineno">18274</span>    }</div>
<div class="line"><span class="lineno">18275</span> </div>
<div class="line"><span class="lineno">18276</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#adc29128579a051d08c3d735ea3e1de2f">mg_connect_client_impl</a>(&amp;opts, use_ssl, &amp;init, &amp;<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>);</div>
<div class="line"><span class="lineno">18277</span>}</div>
<div class="ttc" id="acivetweb_8c_html_adc29128579a051d08c3d735ea3e1de2f"><div class="ttname"><a href="#adc29128579a051d08c3d735ea3e1de2f">mg_connect_client_impl</a></div><div class="ttdeci">static struct mg_connection * mg_connect_client_impl(const struct mg_client_options *client_options, int use_ssl, struct mg_init_data *init, struct mg_error_data *error)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18001">civetweb.c:18001</a></div></div>
<div class="ttc" id="astructmg__client__options_html"><div class="ttname"><a href="structmg__client__options.html">mg_client_options</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01483">civetweb.h:1483</a></div></div>
<div class="ttc" id="astructmg__error__data_html"><div class="ttname"><a href="structmg__error__data.html">mg_error_data</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01723">civetweb.h:1723</a></div></div>
<div class="ttc" id="astructmg__init__data_html"><div class="ttname"><a href="structmg__init__data.html">mg_init_data</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01798">civetweb.h:1798</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lua-5_81_85_2src_2lundump_8c_source.html#l00036">error()</a>, <a class="el" href="civetweb_8h_source.html#l01484">mg_client_options::host</a>, <a class="el" href="civetweb_8h_source.html#l01488">mg_client_options::host_name</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, and <a class="el" href="civetweb_8h_source.html#l01485">mg_client_options::port</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18874">mg_download()</a>, and <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00995">run_client()</a>.</p>

</div>
</div>
<a id="adc29128579a051d08c3d735ea3e1de2f" name="adc29128579a051d08c3d735ea3e1de2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc29128579a051d08c3d735ea3e1de2f">&#9670;&#160;</a></span>mg_connect_client_impl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structmg__connection.html">mg_connection</a> * mg_connect_client_impl </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *</td>          <td class="paramname"><span class="paramname"><em>client_options</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>use_ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__init__data.html">mg_init_data</a> *</td>          <td class="paramname"><span class="paramname"><em>init</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__error__data.html">mg_error_data</a> *</td>          <td class="paramname"><span class="paramname"><em>error</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18001">18001</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">18005</span>{</div>
<div class="line"><span class="lineno">18006</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *conn = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18007</span>    <a class="code hl_typedef" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a> sock;</div>
<div class="line"><span class="lineno">18008</span>    <span class="keyword">union </span><a class="code hl_union" href="unionusa.html">usa</a> <a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>;</div>
<div class="line"><span class="lineno">18009</span>    <span class="keyword">struct </span>sockaddr *psa;</div>
<div class="line"><span class="lineno">18010</span>    socklen_t len;</div>
<div class="line"><span class="lineno">18011</span> </div>
<div class="line"><span class="lineno">18012</span>    <span class="keywordtype">unsigned</span> max_req_size =</div>
<div class="line"><span class="lineno">18013</span>        (unsigned)atoi(<a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5">MAX_REQUEST_SIZE</a>].default_value);</div>
<div class="line"><span class="lineno">18014</span> </div>
<div class="line"><span class="lineno">18015</span>    <span class="comment">/* Size of structures, aligned to 8 bytes */</span></div>
<div class="line"><span class="lineno">18016</span>    <span class="keywordtype">size_t</span> conn_size = ((<span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a>) + 7) &gt;&gt; 3) &lt;&lt; 3;</div>
<div class="line"><span class="lineno">18017</span>    <span class="keywordtype">size_t</span> ctx_size = ((<span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code hl_struct" href="structmg__context.html">mg_context</a>) + 7) &gt;&gt; 3) &lt;&lt; 3;</div>
<div class="line"><span class="lineno">18018</span>    <span class="keywordtype">size_t</span> alloc_size = conn_size + ctx_size + max_req_size;</div>
<div class="line"><span class="lineno">18019</span> </div>
<div class="line"><span class="lineno">18020</span>    (void)init; <span class="comment">/* TODO: Implement required options */</span></div>
<div class="line"><span class="lineno">18021</span> </div>
<div class="line"><span class="lineno">18022</span>    conn = (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)<a class="code hl_function" href="#ad3552193bd019b58e092032223ac38f1">mg_calloc</a>(1, alloc_size);</div>
<div class="line"><span class="lineno">18023</span> </div>
<div class="line"><span class="lineno">18024</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18025</span>        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea6f2b13fd162f7422b5ff4e6dc317e650">MG_ERROR_DATA_CODE_OK</a>;</div>
<div class="line"><span class="lineno">18026</span>        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = 0;</div>
<div class="line"><span class="lineno">18027</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size &gt; 0) {</div>
<div class="line"><span class="lineno">18028</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text[0] = 0;</div>
<div class="line"><span class="lineno">18029</span>        }</div>
<div class="line"><span class="lineno">18030</span>    }</div>
<div class="line"><span class="lineno">18031</span> </div>
<div class="line"><span class="lineno">18032</span>    <span class="keywordflow">if</span> (conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18033</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18034</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead54ef9d63e339f4c05c12cb56564e319">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>;</div>
<div class="line"><span class="lineno">18035</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)alloc_size;</div>
<div class="line"><span class="lineno">18036</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">18037</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18038</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">18039</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">18040</span>                        <span class="stringliteral">&quot;calloc(): %s&quot;</span>,</div>
<div class="line"><span class="lineno">18041</span>                        strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">18042</span>        }</div>
<div class="line"><span class="lineno">18043</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18044</span>    }</div>
<div class="line"><span class="lineno">18045</span> </div>
<div class="line"><span class="lineno">18046</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno">18047</span><span class="preprocessor">#pragma GCC diagnostic push</span></div>
<div class="line"><span class="lineno">18048</span><span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wcast-align&quot;</span></div>
<div class="line"><span class="lineno">18049</span><span class="preprocessor">#endif </span><span class="comment">/* defined(GCC_DIAGNOSTIC) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">18050</span>    <span class="comment">/* conn_size is aligned to 8 bytes */</span></div>
<div class="line"><span class="lineno">18051</span> </div>
<div class="line"><span class="lineno">18052</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a> = (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__context.html">mg_context</a> *)(((<span class="keywordtype">char</span> *)conn) + conn_size);</div>
<div class="line"><span class="lineno">18053</span> </div>
<div class="line"><span class="lineno">18054</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno">18055</span><span class="preprocessor">#pragma GCC diagnostic pop</span></div>
<div class="line"><span class="lineno">18056</span><span class="preprocessor">#endif </span><span class="comment">/* defined(GCC_DIAGNOSTIC) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">18057</span> </div>
<div class="line"><span class="lineno">18058</span>    conn-&gt;buf = (((<span class="keywordtype">char</span> *)conn) + conn_size + ctx_size);</div>
<div class="line"><span class="lineno">18059</span>    conn-&gt;buf_size = (int)max_req_size;</div>
<div class="line"><span class="lineno">18060</span>    conn-&gt;phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> = <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5ac5e9108e1a7588fe9429108516575440">CONTEXT_HTTP_CLIENT</a>;</div>
<div class="line"><span class="lineno">18061</span>    conn-&gt;dom_ctx = &amp;(conn-&gt;phys_ctx-&gt;dd);</div>
<div class="line"><span class="lineno">18062</span> </div>
<div class="line"><span class="lineno">18063</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a34c01d95bd26a8b8be2db7cd87efe701">connect_socket</a>(conn-&gt;phys_ctx,</div>
<div class="line"><span class="lineno">18064</span>                        client_options-&gt;<a class="code hl_variable" href="structmg__client__options.html#aeaa7ef9674ac7115eff7ca61568c622c">host</a>,</div>
<div class="line"><span class="lineno">18065</span>                        client_options-&gt;<a class="code hl_variable" href="structmg__client__options.html#a78729888713a12037fa617a6a8ee4461">port</a>,</div>
<div class="line"><span class="lineno">18066</span>                        use_ssl,</div>
<div class="line"><span class="lineno">18067</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>,</div>
<div class="line"><span class="lineno">18068</span>                        &amp;sock,</div>
<div class="line"><span class="lineno">18069</span>                        &amp;sa)) {</div>
<div class="line"><span class="lineno">18070</span>        <span class="comment">/* &quot;error&quot; will be set by connect_socket. */</span></div>
<div class="line"><span class="lineno">18071</span>        <span class="comment">/* free all memory and return NULL; */</span></div>
<div class="line"><span class="lineno">18072</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn);</div>
<div class="line"><span class="lineno">18073</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18074</span>    }</div>
<div class="line"><span class="lineno">18075</span> </div>
<div class="line"><span class="lineno">18076</span><span class="preprocessor">#if !defined(NO_SSL) &amp;&amp; !defined(USE_MBEDTLS) </span><span class="comment">// TODO: mbedTLS client</span></div>
<div class="line"><span class="lineno">18077</span><span class="preprocessor">#if (defined(OPENSSL_API_1_1) || defined(OPENSSL_API_3_0))                     \</span></div>
<div class="line"><span class="lineno">18078</span><span class="preprocessor">    &amp;&amp; !defined(NO_SSL_DL)</span></div>
<div class="line"><span class="lineno">18079</span> </div>
<div class="line"><span class="lineno">18080</span>    <span class="keywordflow">if</span> (use_ssl</div>
<div class="line"><span class="lineno">18081</span>        &amp;&amp; (conn-&gt;dom_ctx-&gt;ssl_ctx = SSL_CTX_new(TLS_client_method()))</div>
<div class="line"><span class="lineno">18082</span>               == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18083</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18084</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead5f94e3f9ddc28c9d4a05f18bed659c7">MG_ERROR_DATA_CODE_INIT_TLS_FAILED</a>;</div>
<div class="line"><span class="lineno">18085</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">18086</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18087</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">18088</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">18089</span>                        <span class="stringliteral">&quot;SSL_CTX_new error: %s&quot;</span>,</div>
<div class="line"><span class="lineno">18090</span>                        <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">18091</span>        }</div>
<div class="line"><span class="lineno">18092</span> </div>
<div class="line"><span class="lineno">18093</span>        <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(sock);</div>
<div class="line"><span class="lineno">18094</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn);</div>
<div class="line"><span class="lineno">18095</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18096</span>    }</div>
<div class="line"><span class="lineno">18097</span> </div>
<div class="line"><span class="lineno">18098</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">18099</span> </div>
<div class="line"><span class="lineno">18100</span>    <span class="keywordflow">if</span> (use_ssl</div>
<div class="line"><span class="lineno">18101</span>        &amp;&amp; (conn-&gt;dom_ctx-&gt;ssl_ctx = SSL_CTX_new(SSLv23_client_method()))</div>
<div class="line"><span class="lineno">18102</span>               == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18103</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18104</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead5f94e3f9ddc28c9d4a05f18bed659c7">MG_ERROR_DATA_CODE_INIT_TLS_FAILED</a>;</div>
<div class="line"><span class="lineno">18105</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">18106</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18107</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">18108</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">18109</span>                        <span class="stringliteral">&quot;SSL_CTX_new error: %s&quot;</span>,</div>
<div class="line"><span class="lineno">18110</span>                        <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">18111</span>        }</div>
<div class="line"><span class="lineno">18112</span> </div>
<div class="line"><span class="lineno">18113</span>        <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(sock);</div>
<div class="line"><span class="lineno">18114</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn);</div>
<div class="line"><span class="lineno">18115</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18116</span>    }</div>
<div class="line"><span class="lineno">18117</span> </div>
<div class="line"><span class="lineno">18118</span><span class="preprocessor">#endif </span><span class="comment">/* OPENSSL_API_1_1 || OPENSSL_API_3_0 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">18119</span><span class="preprocessor">#endif </span><span class="comment">/* NO_SSL */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">18120</span> </div>
<div class="line"><span class="lineno">18121</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">18122</span>    len = (sa.sa.sa_family == AF_INET) ? <span class="keyword">sizeof</span>(conn-&gt;client.rsa.sin)</div>
<div class="line"><span class="lineno">18123</span>                                       : <span class="keyword">sizeof</span>(conn-&gt;client.rsa.sin6);</div>
<div class="line"><span class="lineno">18124</span>    psa = (sa.sa.sa_family == AF_INET)</div>
<div class="line"><span class="lineno">18125</span>              ? (<span class="keyword">struct</span> sockaddr *)&amp;(conn-&gt;client.rsa.sin)</div>
<div class="line"><span class="lineno">18126</span>              : (struct sockaddr *)&amp;(conn-&gt;client.rsa.sin6);</div>
<div class="line"><span class="lineno">18127</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">18128</span>    len = <span class="keyword">sizeof</span>(conn-&gt;client.rsa.sin);</div>
<div class="line"><span class="lineno">18129</span>    psa = (<span class="keyword">struct </span>sockaddr *)&amp;(conn-&gt;client.rsa.sin);</div>
<div class="line"><span class="lineno">18130</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">18131</span> </div>
<div class="line"><span class="lineno">18132</span>    conn-&gt;client.sock = sock;</div>
<div class="line"><span class="lineno">18133</span>    conn-&gt;client.lsa = sa;</div>
<div class="line"><span class="lineno">18134</span> </div>
<div class="line"><span class="lineno">18135</span>    <span class="keywordflow">if</span> (getsockname(sock, psa, &amp;len) != 0) {</div>
<div class="line"><span class="lineno">18136</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">18137</span>                        <span class="stringliteral">&quot;%s: getsockname() failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno">18138</span>                        __func__,</div>
<div class="line"><span class="lineno">18139</span>                        strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">18140</span>    }</div>
<div class="line"><span class="lineno">18141</span> </div>
<div class="line"><span class="lineno">18142</span>    conn-&gt;client.is_ssl = use_ssl ? 1 : 0;</div>
<div class="line"><span class="lineno">18143</span>    <span class="keywordflow">if</span> (0 != pthread_mutex_init(&amp;conn-&gt;mutex, &amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>)) {</div>
<div class="line"><span class="lineno">18144</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18145</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea4ec7bbc93f6f6d5d1f91b2bda132b7f6">MG_ERROR_DATA_CODE_OS_ERROR</a>;</div>
<div class="line"><span class="lineno">18146</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno">18147</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">18148</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18149</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">18150</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">18151</span>                        <span class="stringliteral">&quot;Can not create mutex&quot;</span>);</div>
<div class="line"><span class="lineno">18152</span>        }</div>
<div class="line"><span class="lineno">18153</span><span class="preprocessor">#if !defined(NO_SSL) &amp;&amp; !defined(USE_MBEDTLS) </span><span class="comment">// TODO: mbedTLS client</span></div>
<div class="line"><span class="lineno">18154</span>        SSL_CTX_free(conn-&gt;dom_ctx-&gt;ssl_ctx);</div>
<div class="line"><span class="lineno">18155</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">18156</span>        <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(sock);</div>
<div class="line"><span class="lineno">18157</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn);</div>
<div class="line"><span class="lineno">18158</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18159</span>    }</div>
<div class="line"><span class="lineno">18160</span> </div>
<div class="line"><span class="lineno">18161</span><span class="preprocessor">#if !defined(NO_SSL) &amp;&amp; !defined(USE_MBEDTLS) </span><span class="comment">// TODO: mbedTLS client</span></div>
<div class="line"><span class="lineno">18162</span>    <span class="keywordflow">if</span> (use_ssl) {</div>
<div class="line"><span class="lineno">18163</span>        <span class="comment">/* TODO: Check ssl_verify_peer and ssl_ca_path here.</span></div>
<div class="line"><span class="lineno">18164</span><span class="comment">         * SSL_CTX_set_verify call is needed to switch off server</span></div>
<div class="line"><span class="lineno">18165</span><span class="comment">         * certificate checking, which is off by default in OpenSSL and</span></div>
<div class="line"><span class="lineno">18166</span><span class="comment">         * on in yaSSL. */</span></div>
<div class="line"><span class="lineno">18167</span>        <span class="comment">/* TODO: SSL_CTX_set_verify(conn-&gt;dom_ctx,</span></div>
<div class="line"><span class="lineno">18168</span><span class="comment">         * SSL_VERIFY_PEER, verify_ssl_server); */</span></div>
<div class="line"><span class="lineno">18169</span> </div>
<div class="line"><span class="lineno">18170</span>        <span class="keywordflow">if</span> (client_options-&gt;<a class="code hl_variable" href="structmg__client__options.html#a76d71606ba3eaba0583fddc2152b8f93">client_cert</a>) {</div>
<div class="line"><span class="lineno">18171</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a36ba2de78f1cacfe1b95106a834b970d">ssl_use_pem_file</a>(conn-&gt;phys_ctx,</div>
<div class="line"><span class="lineno">18172</span>                                  conn-&gt;dom_ctx,</div>
<div class="line"><span class="lineno">18173</span>                                  client_options-&gt;<a class="code hl_variable" href="structmg__client__options.html#a76d71606ba3eaba0583fddc2152b8f93">client_cert</a>,</div>
<div class="line"><span class="lineno">18174</span>                                  <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">18175</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18176</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaecf7f3126fc1b6947b427962f8018b93">MG_ERROR_DATA_CODE_TLS_CLIENT_CERT_ERROR</a>;</div>
<div class="line"><span class="lineno">18177</span>                    <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">18178</span>                                <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18179</span>                                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">18180</span>                                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">18181</span>                                <span class="stringliteral">&quot;Can not use SSL client certificate&quot;</span>);</div>
<div class="line"><span class="lineno">18182</span>                }</div>
<div class="line"><span class="lineno">18183</span> </div>
<div class="line"><span class="lineno">18184</span>                SSL_CTX_free(conn-&gt;dom_ctx-&gt;ssl_ctx);</div>
<div class="line"><span class="lineno">18185</span>                <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(sock);</div>
<div class="line"><span class="lineno">18186</span>                <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn);</div>
<div class="line"><span class="lineno">18187</span>                <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18188</span>            }</div>
<div class="line"><span class="lineno">18189</span>        }</div>
<div class="line"><span class="lineno">18190</span> </div>
<div class="line"><span class="lineno">18191</span>        <span class="keywordflow">if</span> (client_options-&gt;<a class="code hl_variable" href="structmg__client__options.html#acb24330b4da0a19f3bee2d3f41ae5e24">server_cert</a>) {</div>
<div class="line"><span class="lineno">18192</span>            <span class="keywordflow">if</span> (SSL_CTX_load_verify_locations(conn-&gt;dom_ctx-&gt;ssl_ctx,</div>
<div class="line"><span class="lineno">18193</span>                                              client_options-&gt;<a class="code hl_variable" href="structmg__client__options.html#acb24330b4da0a19f3bee2d3f41ae5e24">server_cert</a>,</div>
<div class="line"><span class="lineno">18194</span>                                              <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">18195</span>                != 1) {</div>
<div class="line"><span class="lineno">18196</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18197</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea972160ef063d2c1c3a712d616860272e">MG_ERROR_DATA_CODE_TLS_SERVER_CERT_ERROR</a>;</div>
<div class="line"><span class="lineno">18198</span>                    <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">18199</span>                                <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18200</span>                                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">18201</span>                                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">18202</span>                                <span class="stringliteral">&quot;SSL_CTX_load_verify_locations error: %s&quot;</span>,</div>
<div class="line"><span class="lineno">18203</span>                                <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">18204</span>                }</div>
<div class="line"><span class="lineno">18205</span>                SSL_CTX_free(conn-&gt;dom_ctx-&gt;ssl_ctx);</div>
<div class="line"><span class="lineno">18206</span>                <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(sock);</div>
<div class="line"><span class="lineno">18207</span>                <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn);</div>
<div class="line"><span class="lineno">18208</span>                <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18209</span>            }</div>
<div class="line"><span class="lineno">18210</span>            SSL_CTX_set_verify(conn-&gt;dom_ctx-&gt;ssl_ctx, SSL_VERIFY_PEER, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">18211</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">18212</span>            SSL_CTX_set_verify(conn-&gt;dom_ctx-&gt;ssl_ctx, SSL_VERIFY_NONE, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">18213</span>        }</div>
<div class="line"><span class="lineno">18214</span> </div>
<div class="line"><span class="lineno">18215</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#ac5ddf37dfcbb5287702f50354be5ab54">sslize</a>(conn, SSL_connect, client_options)) {</div>
<div class="line"><span class="lineno">18216</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18217</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea2874806b86f32e40ef428caa15d27c08">MG_ERROR_DATA_CODE_TLS_CONNECT_ERROR</a>;</div>
<div class="line"><span class="lineno">18218</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">18219</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18220</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">18221</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">18222</span>                            <span class="stringliteral">&quot;SSL connection error&quot;</span>);</div>
<div class="line"><span class="lineno">18223</span>            }</div>
<div class="line"><span class="lineno">18224</span>            SSL_CTX_free(conn-&gt;dom_ctx-&gt;ssl_ctx);</div>
<div class="line"><span class="lineno">18225</span>            <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(sock);</div>
<div class="line"><span class="lineno">18226</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn);</div>
<div class="line"><span class="lineno">18227</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18228</span>        }</div>
<div class="line"><span class="lineno">18229</span>    }</div>
<div class="line"><span class="lineno">18230</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">18231</span> </div>
<div class="line"><span class="lineno">18232</span>    <span class="keywordflow">return</span> conn;</div>
<div class="line"><span class="lineno">18233</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a34c01d95bd26a8b8be2db7cd87efe701"><div class="ttname"><a href="#a34c01d95bd26a8b8be2db7cd87efe701">connect_socket</a></div><div class="ttdeci">static int connect_socket(struct mg_context *ctx, const char *host, int port, int use_ssl, struct mg_error_data *error, SOCKET *sock, union usa *sa)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09287">civetweb.c:9287</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a8dc8083897335125630f1af5dafd5831"><div class="ttname"><a href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a></div><div class="ttdeci">int SOCKET</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00928">civetweb.c:928</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac5ddf37dfcbb5287702f50354be5ab54"><div class="ttname"><a href="#ac5ddf37dfcbb5287702f50354be5ab54">sslize</a></div><div class="ttdeci">static int sslize(struct mg_connection *conn, int(*func)(SSL *), const struct mg_client_options *client_options)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16455">civetweb.c:16455</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad3552193bd019b58e092032223ac38f1"><div class="ttname"><a href="#ad3552193bd019b58e092032223ac38f1">mg_calloc</a></div><div class="ttdeci">static __inline void * mg_calloc(size_t a, size_t b)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01480">civetweb.c:1480</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea2874806b86f32e40ef428caa15d27c08"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea2874806b86f32e40ef428caa15d27c08">MG_ERROR_DATA_CODE_TLS_CONNECT_ERROR</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_TLS_CONNECT_ERROR</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01795">civetweb.h:1794</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea6f2b13fd162f7422b5ff4e6dc317e650"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea6f2b13fd162f7422b5ff4e6dc317e650">MG_ERROR_DATA_CODE_OK</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_OK</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01734">civetweb.h:1734</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea972160ef063d2c1c3a712d616860272e"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea972160ef063d2c1c3a712d616860272e">MG_ERROR_DATA_CODE_TLS_SERVER_CERT_ERROR</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_TLS_SERVER_CERT_ERROR</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01791">civetweb.h:1791</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ead54ef9d63e339f4c05c12cb56564e319"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead54ef9d63e339f4c05c12cb56564e319">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_OUT_OF_MEMORY</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01752">civetweb.h:1752</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ead5f94e3f9ddc28c9d4a05f18bed659c7"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead5f94e3f9ddc28c9d4a05f18bed659c7">MG_ERROR_DATA_CODE_INIT_TLS_FAILED</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_INIT_TLS_FAILED</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01743">civetweb.h:1743</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9eaecf7f3126fc1b6947b427962f8018b93"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaecf7f3126fc1b6947b427962f8018b93">MG_ERROR_DATA_CODE_TLS_CLIENT_CERT_ERROR</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_TLS_CLIENT_CERT_ERROR</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01788">civetweb.h:1788</a></div></div>
<div class="ttc" id="astructmg__client__options_html_a76d71606ba3eaba0583fddc2152b8f93"><div class="ttname"><a href="structmg__client__options.html#a76d71606ba3eaba0583fddc2152b8f93">mg_client_options::client_cert</a></div><div class="ttdeci">const char * client_cert</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01486">civetweb.h:1486</a></div></div>
<div class="ttc" id="astructmg__client__options_html_a78729888713a12037fa617a6a8ee4461"><div class="ttname"><a href="structmg__client__options.html#a78729888713a12037fa617a6a8ee4461">mg_client_options::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01485">civetweb.h:1485</a></div></div>
<div class="ttc" id="astructmg__client__options_html_acb24330b4da0a19f3bee2d3f41ae5e24"><div class="ttname"><a href="structmg__client__options.html#acb24330b4da0a19f3bee2d3f41ae5e24">mg_client_options::server_cert</a></div><div class="ttdeci">const char * server_cert</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01487">civetweb.h:1487</a></div></div>
<div class="ttc" id="astructmg__client__options_html_aeaa7ef9674ac7115eff7ca61568c622c"><div class="ttname"><a href="structmg__client__options.html#aeaa7ef9674ac7115eff7ca61568c622c">mg_client_options::host</a></div><div class="ttdeci">const char * host</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01484">civetweb.h:1484</a></div></div>
<div class="ttc" id="aunionusa_html"><div class="ttname"><a href="unionusa.html">usa</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01832">civetweb.c:1832</a></div></div>
<div class="ttc" id="aunionusa_html_a3bc7f8512f2fb0e7ef3e8c69dd794df1"><div class="ttname"><a href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">usa::sa</a></div><div class="ttdeci">struct sockaddr sa</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01833">civetweb.c:1833</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02532">mg_connection::buf</a>, <a class="el" href="civetweb_8c_source.html#l02556">mg_connection::buf_size</a>, <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8h_source.html#l01486">mg_client_options::client_cert</a>, <a class="el" href="civetweb_8c_source.html#l00917">closesocket</a>, <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l02264">CONTEXT_HTTP_CLIENT</a>, <a class="el" href="civetweb_8c_source.html#l02354">mg_context::context_type</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="lua-5_81_85_2src_2lundump_8c_source.html#l00036">error()</a>, <a class="el" href="civetweb_8h_source.html#l01484">mg_client_options::host</a>, <a class="el" href="civetweb_8c_source.html#l01906">socket::is_ssl</a>, <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l01925">MAX_REQUEST_SIZE</a>, <a class="el" href="civetweb_8c_source.html#l01480">mg_calloc()</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8h_source.html#l01743">MG_ERROR_DATA_CODE_INIT_TLS_FAILED</a>, <a class="el" href="civetweb_8h_source.html#l01734">MG_ERROR_DATA_CODE_OK</a>, <a class="el" href="civetweb_8h_source.html#l01761">MG_ERROR_DATA_CODE_OS_ERROR</a>, <a class="el" href="civetweb_8h_source.html#l01752">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>, <a class="el" href="civetweb_8h_source.html#l01788">MG_ERROR_DATA_CODE_TLS_CLIENT_CERT_ERROR</a>, <a class="el" href="civetweb_8h_source.html#l01794">MG_ERROR_DATA_CODE_TLS_CONNECT_ERROR</a>, <a class="el" href="civetweb_8h_source.html#l01791">MG_ERROR_DATA_CODE_TLS_SERVER_CERT_ERROR</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l02565">mg_connection::mutex</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8h_source.html#l01485">mg_client_options::port</a>, <a class="el" href="civetweb_8c_source.html#l01074">pthread_mutex_attr</a>, <a class="el" href="civetweb_8c_source.html#l01905">socket::rsa</a>, <a class="el" href="civetweb_8c_source.html#l01833">usa::sa</a>, <a class="el" href="civetweb_8h_source.html#l01487">mg_client_options::server_cert</a>, <a class="el" href="civetweb_8c_source.html#l01834">usa::sin</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>, <a class="el" href="civetweb_8c_source.html#l16585">ssl_error()</a>, <a class="el" href="civetweb_8c_source.html#l16940">ssl_use_pem_file()</a>, and <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18253">mg_connect_client()</a>, <a class="el" href="civetweb_8c_source.html#l18237">mg_connect_client_secure()</a>, and <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>.</p>

</div>
</div>
<a id="aa0900e7049ba69cd81fd36844820ae95" name="aa0900e7049ba69cd81fd36844820ae95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0900e7049ba69cd81fd36844820ae95">&#9670;&#160;</a></span>mg_connect_client_secure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> * mg_connect_client_secure </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *</td>          <td class="paramname"><span class="paramname"><em>client_options</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>error_buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>error_buffer_size</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18237">18237</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">18240</span>{</div>
<div class="line"><span class="lineno">18241</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__init__data.html">mg_init_data</a> init;</div>
<div class="line"><span class="lineno">18242</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__error__data.html">mg_error_data</a> <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>;</div>
<div class="line"><span class="lineno">18243</span> </div>
<div class="line"><span class="lineno">18244</span>    memset(&amp;init, 0, <span class="keyword">sizeof</span>(init));</div>
<div class="line"><span class="lineno">18245</span>    memset(&amp;<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>));</div>
<div class="line"><span class="lineno">18246</span>    <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>.text_buffer_size = error_buffer_size;</div>
<div class="line"><span class="lineno">18247</span>    <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>.text = error_buffer;</div>
<div class="line"><span class="lineno">18248</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#adc29128579a051d08c3d735ea3e1de2f">mg_connect_client_impl</a>(client_options, 1, &amp;init, &amp;<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>);</div>
<div class="line"><span class="lineno">18249</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lua-5_81_85_2src_2lundump_8c_source.html#l00036">error()</a>, and <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>.</p>

</div>
</div>
<a id="a5da8b47d8e2795d68cccc0f72b231835" name="a5da8b47d8e2795d68cccc0f72b231835"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5da8b47d8e2795d68cccc0f72b231835">&#9670;&#160;</a></span>mg_connect_websocket_client()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> * mg_connect_websocket_client </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>host</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>port</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>use_ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>error_buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>error_buffer_size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>origin</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a></td>          <td class="paramname"><span class="paramname"><em>data_func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a></td>          <td class="paramname"><span class="paramname"><em>close_func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>user_data</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19212">19212</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19222</span>{</div>
<div class="line"><span class="lineno">19223</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__client__options.html">mg_client_options</a> client_options;</div>
<div class="line"><span class="lineno">19224</span>    memset(&amp;client_options, 0, <span class="keyword">sizeof</span>(client_options));</div>
<div class="line"><span class="lineno">19225</span>    client_options.host = <a class="code hl_variable" href="structmg__client__options.html#aeaa7ef9674ac7115eff7ca61568c622c">host</a>;</div>
<div class="line"><span class="lineno">19226</span>    client_options.port = <a class="code hl_variable" href="structmg__client__options.html#a78729888713a12037fa617a6a8ee4461">port</a>;</div>
<div class="line"><span class="lineno">19227</span> </div>
<div class="line"><span class="lineno">19228</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#adaf75d5a293cb52138c36e0b7a4fb0e4">mg_connect_websocket_client_impl</a>(&amp;client_options,</div>
<div class="line"><span class="lineno">19229</span>                                            use_ssl,</div>
<div class="line"><span class="lineno">19230</span>                                            error_buffer,</div>
<div class="line"><span class="lineno">19231</span>                                            error_buffer_size,</div>
<div class="line"><span class="lineno">19232</span>                                            path,</div>
<div class="line"><span class="lineno">19233</span>                                            origin,</div>
<div class="line"><span class="lineno">19234</span>                                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">19235</span>                                            data_func,</div>
<div class="line"><span class="lineno">19236</span>                                            <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>,</div>
<div class="line"><span class="lineno">19237</span>                                            user_data);</div>
<div class="line"><span class="lineno">19238</span>}</div>
<div class="ttc" id="acivetweb_8c_html_adaf75d5a293cb52138c36e0b7a4fb0e4"><div class="ttname"><a href="#adaf75d5a293cb52138c36e0b7a4fb0e4">mg_connect_websocket_client_impl</a></div><div class="ttdeci">static struct mg_connection * mg_connect_websocket_client_impl(const struct mg_client_options *client_options, int use_ssl, char *error_buffer, size_t error_buffer_size, const char *path, const char *origin, const char *extensions, mg_websocket_data_handler data_func, mg_websocket_close_handler close_func, void *user_data)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18997">civetweb.c:18997</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lparser_8c_html_a46bd6da1ec8052eeaf6fd524199ca72a"><div class="ttname"><a href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a></div><div class="ttdeci">static void close_func(LexState *ls)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lparser_8c_source.html#l00356">lua-5.1.5/src/lparser.c:356</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lua-5_81_85_2src_2lparser_8c_source.html#l00356">close_func()</a>, <a class="el" href="civetweb_8h_source.html#l01484">mg_client_options::host</a>, <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8h_source.html#l01485">mg_client_options::port</a>.</p>

</div>
</div>
<a id="adfcb6a406ff449ca3eb9b78ab37805d4" name="adfcb6a406ff449ca3eb9b78ab37805d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfcb6a406ff449ca3eb9b78ab37805d4">&#9670;&#160;</a></span>mg_connect_websocket_client_extensions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> * mg_connect_websocket_client_extensions </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>host</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>port</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>use_ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>error_buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>error_buffer_size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>origin</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>extensions</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a></td>          <td class="paramname"><span class="paramname"><em>data_func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a></td>          <td class="paramname"><span class="paramname"><em>close_func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>user_data</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19269">19269</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19280</span>{</div>
<div class="line"><span class="lineno">19281</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__client__options.html">mg_client_options</a> client_options;</div>
<div class="line"><span class="lineno">19282</span>    memset(&amp;client_options, 0, <span class="keyword">sizeof</span>(client_options));</div>
<div class="line"><span class="lineno">19283</span>    client_options.host = <a class="code hl_variable" href="structmg__client__options.html#aeaa7ef9674ac7115eff7ca61568c622c">host</a>;</div>
<div class="line"><span class="lineno">19284</span>    client_options.port = <a class="code hl_variable" href="structmg__client__options.html#a78729888713a12037fa617a6a8ee4461">port</a>;</div>
<div class="line"><span class="lineno">19285</span> </div>
<div class="line"><span class="lineno">19286</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#adaf75d5a293cb52138c36e0b7a4fb0e4">mg_connect_websocket_client_impl</a>(&amp;client_options,</div>
<div class="line"><span class="lineno">19287</span>                                            use_ssl,</div>
<div class="line"><span class="lineno">19288</span>                                            error_buffer,</div>
<div class="line"><span class="lineno">19289</span>                                            error_buffer_size,</div>
<div class="line"><span class="lineno">19290</span>                                            path,</div>
<div class="line"><span class="lineno">19291</span>                                            origin,</div>
<div class="line"><span class="lineno">19292</span>                                            extensions,</div>
<div class="line"><span class="lineno">19293</span>                                            data_func,</div>
<div class="line"><span class="lineno">19294</span>                                            <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>,</div>
<div class="line"><span class="lineno">19295</span>                                            user_data);</div>
<div class="line"><span class="lineno">19296</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lua-5_81_85_2src_2lparser_8c_source.html#l00356">close_func()</a>, <a class="el" href="civetweb_8h_source.html#l01484">mg_client_options::host</a>, <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, and <a class="el" href="civetweb_8h_source.html#l01485">mg_client_options::port</a>.</p>

</div>
</div>
<a id="adaf75d5a293cb52138c36e0b7a4fb0e4" name="adaf75d5a293cb52138c36e0b7a4fb0e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaf75d5a293cb52138c36e0b7a4fb0e4">&#9670;&#160;</a></span>mg_connect_websocket_client_impl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structmg__connection.html">mg_connection</a> * mg_connect_websocket_client_impl </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *</td>          <td class="paramname"><span class="paramname"><em>client_options</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>use_ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>error_buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>error_buffer_size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>origin</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>extensions</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a></td>          <td class="paramname"><span class="paramname"><em>data_func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a></td>          <td class="paramname"><span class="paramname"><em>close_func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>user_data</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18997">18997</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19007</span>{</div>
<div class="line"><span class="lineno">19008</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *conn = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19009</span> </div>
<div class="line"><span class="lineno">19010</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno">19011</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structwebsocket__client__thread__data.html">websocket_client_thread_data</a> *thread_data;</div>
<div class="line"><span class="lineno">19012</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *magic = <span class="stringliteral">&quot;x3JJHMbDL1EzLkh9GBhXDw==&quot;</span>;</div>
<div class="line"><span class="lineno">19013</span> </div>
<div class="line"><span class="lineno">19014</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *host = client_options-&gt;<a class="code hl_variable" href="structmg__client__options.html#aeaa7ef9674ac7115eff7ca61568c622c">host</a>;</div>
<div class="line"><span class="lineno">19015</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">19016</span> </div>
<div class="line"><span class="lineno">19017</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__init__data.html">mg_init_data</a> init;</div>
<div class="line"><span class="lineno">19018</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__error__data.html">mg_error_data</a> <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>;</div>
<div class="line"><span class="lineno">19019</span> </div>
<div class="line"><span class="lineno">19020</span>    memset(&amp;init, 0, <span class="keyword">sizeof</span>(init));</div>
<div class="line"><span class="lineno">19021</span>    memset(&amp;<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>));</div>
<div class="line"><span class="lineno">19022</span>    <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>.text_buffer_size = error_buffer_size;</div>
<div class="line"><span class="lineno">19023</span>    <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>.text = error_buffer;</div>
<div class="line"><span class="lineno">19024</span> </div>
<div class="line"><span class="lineno">19025</span><span class="preprocessor">#if defined(__clang__)</span></div>
<div class="line"><span class="lineno">19026</span><span class="preprocessor">#pragma clang diagnostic push</span></div>
<div class="line"><span class="lineno">19027</span><span class="preprocessor">#pragma clang diagnostic ignored &quot;-Wformat-nonliteral&quot;</span></div>
<div class="line"><span class="lineno">19028</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19029</span> </div>
<div class="line"><span class="lineno">19030</span>    <span class="comment">/* Establish the client connection and request upgrade */</span></div>
<div class="line"><span class="lineno">19031</span>    conn = <a class="code hl_function" href="#adc29128579a051d08c3d735ea3e1de2f">mg_connect_client_impl</a>(client_options, use_ssl, &amp;init, &amp;<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>);</div>
<div class="line"><span class="lineno">19032</span> </div>
<div class="line"><span class="lineno">19033</span>    <span class="comment">/* Connection object will be null if something goes wrong */</span></div>
<div class="line"><span class="lineno">19034</span>    <span class="keywordflow">if</span> (conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">19035</span>        <span class="comment">/* error_buffer should be already filled ... */</span></div>
<div class="line"><span class="lineno">19036</span>        <span class="keywordflow">if</span> (!error_buffer[0]) {</div>
<div class="line"><span class="lineno">19037</span>            <span class="comment">/* ... if not add an error message */</span></div>
<div class="line"><span class="lineno">19038</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">19039</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">19040</span>                        error_buffer,</div>
<div class="line"><span class="lineno">19041</span>                        error_buffer_size,</div>
<div class="line"><span class="lineno">19042</span>                        <span class="stringliteral">&quot;Unexpected error&quot;</span>);</div>
<div class="line"><span class="lineno">19043</span>        }</div>
<div class="line"><span class="lineno">19044</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19045</span>    }</div>
<div class="line"><span class="lineno">19046</span> </div>
<div class="line"><span class="lineno">19047</span>    <span class="keywordflow">if</span> (origin != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">19048</span>        <span class="keywordflow">if</span> (extensions != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">19049</span>            i = <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">19050</span>                          <span class="stringliteral">&quot;GET %s HTTP/1.1\r\n&quot;</span></div>
<div class="line"><span class="lineno">19051</span>                          <span class="stringliteral">&quot;Host: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19052</span>                          <span class="stringliteral">&quot;Upgrade: websocket\r\n&quot;</span></div>
<div class="line"><span class="lineno">19053</span>                          <span class="stringliteral">&quot;Connection: Upgrade\r\n&quot;</span></div>
<div class="line"><span class="lineno">19054</span>                          <span class="stringliteral">&quot;Sec-WebSocket-Key: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19055</span>                          <span class="stringliteral">&quot;Sec-WebSocket-Version: 13\r\n&quot;</span></div>
<div class="line"><span class="lineno">19056</span>                          <span class="stringliteral">&quot;Sec-WebSocket-Extensions: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19057</span>                          <span class="stringliteral">&quot;Origin: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19058</span>                          <span class="stringliteral">&quot;\r\n&quot;</span>,</div>
<div class="line"><span class="lineno">19059</span>                          path,</div>
<div class="line"><span class="lineno">19060</span>                          host,</div>
<div class="line"><span class="lineno">19061</span>                          magic,</div>
<div class="line"><span class="lineno">19062</span>                          extensions,</div>
<div class="line"><span class="lineno">19063</span>                          origin);</div>
<div class="line"><span class="lineno">19064</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19065</span>            i = <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">19066</span>                          <span class="stringliteral">&quot;GET %s HTTP/1.1\r\n&quot;</span></div>
<div class="line"><span class="lineno">19067</span>                          <span class="stringliteral">&quot;Host: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19068</span>                          <span class="stringliteral">&quot;Upgrade: websocket\r\n&quot;</span></div>
<div class="line"><span class="lineno">19069</span>                          <span class="stringliteral">&quot;Connection: Upgrade\r\n&quot;</span></div>
<div class="line"><span class="lineno">19070</span>                          <span class="stringliteral">&quot;Sec-WebSocket-Key: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19071</span>                          <span class="stringliteral">&quot;Sec-WebSocket-Version: 13\r\n&quot;</span></div>
<div class="line"><span class="lineno">19072</span>                          <span class="stringliteral">&quot;Origin: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19073</span>                          <span class="stringliteral">&quot;\r\n&quot;</span>,</div>
<div class="line"><span class="lineno">19074</span>                          path,</div>
<div class="line"><span class="lineno">19075</span>                          host,</div>
<div class="line"><span class="lineno">19076</span>                          magic,</div>
<div class="line"><span class="lineno">19077</span>                          origin);</div>
<div class="line"><span class="lineno">19078</span>        }</div>
<div class="line"><span class="lineno">19079</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19080</span> </div>
<div class="line"><span class="lineno">19081</span>        <span class="keywordflow">if</span> (extensions != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">19082</span>            i = <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">19083</span>                          <span class="stringliteral">&quot;GET %s HTTP/1.1\r\n&quot;</span></div>
<div class="line"><span class="lineno">19084</span>                          <span class="stringliteral">&quot;Host: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19085</span>                          <span class="stringliteral">&quot;Upgrade: websocket\r\n&quot;</span></div>
<div class="line"><span class="lineno">19086</span>                          <span class="stringliteral">&quot;Connection: Upgrade\r\n&quot;</span></div>
<div class="line"><span class="lineno">19087</span>                          <span class="stringliteral">&quot;Sec-WebSocket-Key: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19088</span>                          <span class="stringliteral">&quot;Sec-WebSocket-Version: 13\r\n&quot;</span></div>
<div class="line"><span class="lineno">19089</span>                          <span class="stringliteral">&quot;Sec-WebSocket-Extensions: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19090</span>                          <span class="stringliteral">&quot;\r\n&quot;</span>,</div>
<div class="line"><span class="lineno">19091</span>                          path,</div>
<div class="line"><span class="lineno">19092</span>                          host,</div>
<div class="line"><span class="lineno">19093</span>                          magic,</div>
<div class="line"><span class="lineno">19094</span>                          extensions);</div>
<div class="line"><span class="lineno">19095</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19096</span>            i = <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">19097</span>                          <span class="stringliteral">&quot;GET %s HTTP/1.1\r\n&quot;</span></div>
<div class="line"><span class="lineno">19098</span>                          <span class="stringliteral">&quot;Host: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19099</span>                          <span class="stringliteral">&quot;Upgrade: websocket\r\n&quot;</span></div>
<div class="line"><span class="lineno">19100</span>                          <span class="stringliteral">&quot;Connection: Upgrade\r\n&quot;</span></div>
<div class="line"><span class="lineno">19101</span>                          <span class="stringliteral">&quot;Sec-WebSocket-Key: %s\r\n&quot;</span></div>
<div class="line"><span class="lineno">19102</span>                          <span class="stringliteral">&quot;Sec-WebSocket-Version: 13\r\n&quot;</span></div>
<div class="line"><span class="lineno">19103</span>                          <span class="stringliteral">&quot;\r\n&quot;</span>,</div>
<div class="line"><span class="lineno">19104</span>                          path,</div>
<div class="line"><span class="lineno">19105</span>                          host,</div>
<div class="line"><span class="lineno">19106</span>                          magic);</div>
<div class="line"><span class="lineno">19107</span>        }</div>
<div class="line"><span class="lineno">19108</span>    }</div>
<div class="line"><span class="lineno">19109</span>    <span class="keywordflow">if</span> (i &lt;= 0) {</div>
<div class="line"><span class="lineno">19110</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">19111</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">19112</span>                    error_buffer,</div>
<div class="line"><span class="lineno">19113</span>                    error_buffer_size,</div>
<div class="line"><span class="lineno">19114</span>                    <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">19115</span>                    <span class="stringliteral">&quot;Error sending request&quot;</span>);</div>
<div class="line"><span class="lineno">19116</span>        <a class="code hl_function" href="#ae3c0b2bb9143f8eebd7c4c12fc4f0333">mg_close_connection</a>(conn);</div>
<div class="line"><span class="lineno">19117</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19118</span>    }</div>
<div class="line"><span class="lineno">19119</span> </div>
<div class="line"><span class="lineno">19120</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> = 0;</div>
<div class="line"><span class="lineno">19121</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a453db96888b9c0e4b7afd85f3778afb2">get_response</a>(conn, error_buffer, error_buffer_size, &amp;i)) {</div>
<div class="line"><span class="lineno">19122</span>        <a class="code hl_function" href="#ae3c0b2bb9143f8eebd7c4c12fc4f0333">mg_close_connection</a>(conn);</div>
<div class="line"><span class="lineno">19123</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19124</span>    }</div>
<div class="line"><span class="lineno">19125</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a>;</div>
<div class="line"><span class="lineno">19126</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a>;</div>
<div class="line"><span class="lineno">19127</span> </div>
<div class="line"><span class="lineno">19128</span><span class="preprocessor">#if defined(__clang__)</span></div>
<div class="line"><span class="lineno">19129</span><span class="preprocessor">#pragma clang diagnostic pop</span></div>
<div class="line"><span class="lineno">19130</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19131</span> </div>
<div class="line"><span class="lineno">19132</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">status_code</a> != 101) {</div>
<div class="line"><span class="lineno">19133</span>        <span class="comment">/* We sent an &quot;upgrade&quot; request. For a correct websocket</span></div>
<div class="line"><span class="lineno">19134</span><span class="comment">         * protocol handshake, we expect a &quot;101 Continue&quot; response.</span></div>
<div class="line"><span class="lineno">19135</span><span class="comment">         * Otherwise it is a protocol violation. Maybe the HTTP</span></div>
<div class="line"><span class="lineno">19136</span><span class="comment">         * Server does not know websockets. */</span></div>
<div class="line"><span class="lineno">19137</span>        <span class="keywordflow">if</span> (!*error_buffer) {</div>
<div class="line"><span class="lineno">19138</span>            <span class="comment">/* set an error, if not yet set */</span></div>
<div class="line"><span class="lineno">19139</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">19140</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">19141</span>                        error_buffer,</div>
<div class="line"><span class="lineno">19142</span>                        error_buffer_size,</div>
<div class="line"><span class="lineno">19143</span>                        <span class="stringliteral">&quot;Unexpected server reply&quot;</span>);</div>
<div class="line"><span class="lineno">19144</span>        }</div>
<div class="line"><span class="lineno">19145</span> </div>
<div class="line"><span class="lineno">19146</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Websocket client connect error: %s\r\n&quot;</span>, error_buffer);</div>
<div class="line"><span class="lineno">19147</span>        <a class="code hl_function" href="#ae3c0b2bb9143f8eebd7c4c12fc4f0333">mg_close_connection</a>(conn);</div>
<div class="line"><span class="lineno">19148</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19149</span>    }</div>
<div class="line"><span class="lineno">19150</span> </div>
<div class="line"><span class="lineno">19151</span>    thread_data = (<span class="keyword">struct </span><a class="code hl_struct" href="structwebsocket__client__thread__data.html">websocket_client_thread_data</a> *)<a class="code hl_define" href="#a29f85c2d195a7eb5893fdd101383681b">mg_calloc_ctx</a>(</div>
<div class="line"><span class="lineno">19152</span>        1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="structwebsocket__client__thread__data.html">websocket_client_thread_data</a>), <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">19153</span>    <span class="keywordflow">if</span> (!thread_data) {</div>
<div class="line"><span class="lineno">19154</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s\r\n&quot;</span>, <span class="stringliteral">&quot;Out of memory&quot;</span>);</div>
<div class="line"><span class="lineno">19155</span>        <a class="code hl_function" href="#ae3c0b2bb9143f8eebd7c4c12fc4f0333">mg_close_connection</a>(<a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>);</div>
<div class="line"><span class="lineno">19156</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19157</span>    }</div>
<div class="line"><span class="lineno">19158</span> </div>
<div class="line"><span class="lineno">19159</span>    thread_data-&gt;<a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a> = <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>;</div>
<div class="line"><span class="lineno">19160</span>    thread_data-&gt;<a class="code hl_variable" href="structwebsocket__client__thread__data.html#a84a45a90c49c709720bef58b1942ebf8">data_handler</a> = data_func;</div>
<div class="line"><span class="lineno">19161</span>    thread_data-&gt;<a class="code hl_variable" href="structwebsocket__client__thread__data.html#a20cd6d1506e6d5bc07a30325d937d0b0">close_handler</a> = <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>;</div>
<div class="line"><span class="lineno">19162</span>    thread_data-&gt;<a class="code hl_variable" href="structwebsocket__client__thread__data.html#afa1b434cfdfe46c8d3d362e7dde72534">callback_data</a> = user_data;</div>
<div class="line"><span class="lineno">19163</span> </div>
<div class="line"><span class="lineno">19164</span>    <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a> =</div>
<div class="line"><span class="lineno">19165</span>        (pthread_t *)<a class="code hl_define" href="#a29f85c2d195a7eb5893fdd101383681b">mg_calloc_ctx</a>(1, <span class="keyword">sizeof</span>(pthread_t), <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">19166</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>) {</div>
<div class="line"><span class="lineno">19167</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s\r\n&quot;</span>, <span class="stringliteral">&quot;Out of memory&quot;</span>);</div>
<div class="line"><span class="lineno">19168</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(thread_data);</div>
<div class="line"><span class="lineno">19169</span>        <a class="code hl_function" href="#ae3c0b2bb9143f8eebd7c4c12fc4f0333">mg_close_connection</a>(<a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>);</div>
<div class="line"><span class="lineno">19170</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19171</span>    }</div>
<div class="line"><span class="lineno">19172</span> </div>
<div class="line"><span class="lineno">19173</span>    <span class="comment">/* Now upgrade to ws/wss client context */</span></div>
<div class="line"><span class="lineno">19174</span>    <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a73a26dd1c9abead88b40b2d226ad9f28">user_data</a> = user_data;</div>
<div class="line"><span class="lineno">19175</span>    <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> = <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a03e63e1c82cfb5e937a777e71c4a40f2">CONTEXT_WS_CLIENT</a>;</div>
<div class="line"><span class="lineno">19176</span>    <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a> = 1; <span class="comment">/* one worker thread */</span></div>
<div class="line"><span class="lineno">19177</span> </div>
<div class="line"><span class="lineno">19178</span>    <span class="comment">/* Start a thread to read the websocket client connection</span></div>
<div class="line"><span class="lineno">19179</span><span class="comment">     * This thread will automatically stop when mg_disconnect is</span></div>
<div class="line"><span class="lineno">19180</span><span class="comment">     * called on the client connection */</span></div>
<div class="line"><span class="lineno">19181</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a7da29c2b36cd27b1467771e8ac52404e">mg_start_thread_with_id</a>(websocket_client_thread,</div>
<div class="line"><span class="lineno">19182</span>                                thread_data,</div>
<div class="line"><span class="lineno">19183</span>                                <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>)</div>
<div class="line"><span class="lineno">19184</span>        != 0) {</div>
<div class="line"><span class="lineno">19185</span>        <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a> = 0;</div>
<div class="line"><span class="lineno">19186</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(thread_data);</div>
<div class="line"><span class="lineno">19187</span>        <a class="code hl_function" href="#ae3c0b2bb9143f8eebd7c4c12fc4f0333">mg_close_connection</a>(<a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>);</div>
<div class="line"><span class="lineno">19188</span>        <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19189</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">19190</span>                    <span class="stringliteral">&quot;Websocket client connect thread could not be started\r\n&quot;</span>);</div>
<div class="line"><span class="lineno">19191</span>    }</div>
<div class="line"><span class="lineno">19192</span> </div>
<div class="line"><span class="lineno">19193</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">19194</span>    <span class="comment">/* Appease &quot;unused parameter&quot; warnings */</span></div>
<div class="line"><span class="lineno">19195</span>    (void)client_options;</div>
<div class="line"><span class="lineno">19196</span>    (void)use_ssl;</div>
<div class="line"><span class="lineno">19197</span>    (void)error_buffer;</div>
<div class="line"><span class="lineno">19198</span>    (void)error_buffer_size;</div>
<div class="line"><span class="lineno">19199</span>    (void)path;</div>
<div class="line"><span class="lineno">19200</span>    (void)origin;</div>
<div class="line"><span class="lineno">19201</span>    (void)extensions;</div>
<div class="line"><span class="lineno">19202</span>    (void)user_data;</div>
<div class="line"><span class="lineno">19203</span>    (void)data_func;</div>
<div class="line"><span class="lineno">19204</span>    (void)<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>;</div>
<div class="line"><span class="lineno">19205</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19206</span> </div>
<div class="line"><span class="lineno">19207</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">conn</a>;</div>
<div class="line"><span class="lineno">19208</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a29f85c2d195a7eb5893fdd101383681b"><div class="ttname"><a href="#a29f85c2d195a7eb5893fdd101383681b">mg_calloc_ctx</a></div><div class="ttdeci">#define mg_calloc_ctx(a, b, c)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01498">civetweb.c:1498</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a453db96888b9c0e4b7afd85f3778afb2"><div class="ttname"><a href="#a453db96888b9c0e4b7afd85f3778afb2">get_response</a></div><div class="ttdeci">static int get_response(struct mg_connection *conn, char *ebuf, size_t ebuf_len, int *err)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18737">civetweb.c:18737</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a7da29c2b36cd27b1467771e8ac52404e"><div class="ttname"><a href="#a7da29c2b36cd27b1467771e8ac52404e">mg_start_thread_with_id</a></div><div class="ttdeci">static int mg_start_thread_with_id(mg_thread_func_t func, void *param, pthread_t *threadidptr)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l05726">civetweb.c:5726</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ae3c0b2bb9143f8eebd7c4c12fc4f0333"><div class="ttname"><a href="#ae3c0b2bb9143f8eebd7c4c12fc4f0333">mg_close_connection</a></div><div class="ttdeci">CIVETWEB_API void mg_close_connection(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17938">civetweb.c:17938</a></div></div>
<div class="ttc" id="astructwebsocket__client__thread__data_html"><div class="ttname"><a href="structwebsocket__client__thread__data.html">websocket_client_thread_data</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18926">civetweb.c:18926</a></div></div>
<div class="ttc" id="astructwebsocket__client__thread__data_html_a20cd6d1506e6d5bc07a30325d937d0b0"><div class="ttname"><a href="structwebsocket__client__thread__data.html#a20cd6d1506e6d5bc07a30325d937d0b0">websocket_client_thread_data::close_handler</a></div><div class="ttdeci">mg_websocket_close_handler close_handler</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18929">civetweb.c:18929</a></div></div>
<div class="ttc" id="astructwebsocket__client__thread__data_html_a84a45a90c49c709720bef58b1942ebf8"><div class="ttname"><a href="structwebsocket__client__thread__data.html#a84a45a90c49c709720bef58b1942ebf8">websocket_client_thread_data::data_handler</a></div><div class="ttdeci">mg_websocket_data_handler data_handler</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18928">civetweb.c:18928</a></div></div>
<div class="ttc" id="astructwebsocket__client__thread__data_html_ac7b84ec2d4ef845e903a5900f2d0220c"><div class="ttname"><a href="structwebsocket__client__thread__data.html#ac7b84ec2d4ef845e903a5900f2d0220c">websocket_client_thread_data::conn</a></div><div class="ttdeci">struct mg_connection * conn</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18927">civetweb.c:18927</a></div></div>
<div class="ttc" id="astructwebsocket__client__thread__data_html_afa1b434cfdfe46c8d3d362e7dde72534"><div class="ttname"><a href="structwebsocket__client__thread__data.html#afa1b434cfdfe46c8d3d362e7dde72534">websocket_client_thread_data::callback_data</a></div><div class="ttdeci">void * callback_data</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18930">civetweb.c:18930</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l18930">websocket_client_thread_data::callback_data</a>, <a class="el" href="civetweb_8c_source.html#l02378">mg_context::cfg_worker_threads</a>, <a class="el" href="lua-5_81_85_2src_2lparser_8c_source.html#l00356">close_func()</a>, <a class="el" href="civetweb_8c_source.html#l18929">websocket_client_thread_data::close_handler</a>, <a class="el" href="civetweb_8c_source.html#l18927">websocket_client_thread_data::conn</a>, <a class="el" href="civetweb_8c_source.html#l02354">mg_context::context_type</a>, <a class="el" href="civetweb_8c_source.html#l02265">CONTEXT_WS_CLIENT</a>, <a class="el" href="civetweb_8c_source.html#l18928">websocket_client_thread_data::data_handler</a>, <a class="el" href="civetweb_8c_source.html#l02558">mg_connection::data_len</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="lua-5_81_85_2src_2lundump_8c_source.html#l00036">error()</a>, <a class="el" href="civetweb_8c_source.html#l18737">get_response()</a>, <a class="el" href="civetweb_8h_source.html#l01484">mg_client_options::host</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8h_source.html#l00154">mg_request_info::local_uri_raw</a>, <a class="el" href="civetweb_8c_source.html#l01498">mg_calloc_ctx</a>, <a class="el" href="civetweb_8c_source.html#l17938">mg_close_connection()</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l05726">mg_start_thread_with_id()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>, <a class="el" href="civetweb_8c_source.html#l02495">mg_connection::response_info</a>, <a class="el" href="civetweb_8h_source.html#l00192">mg_response_info::status_code</a>, <a class="el" href="civetweb_8c_source.html#l02433">mg_context::user_data</a>, and <a class="el" href="civetweb_8c_source.html#l02379">mg_context::worker_threadids</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19212">mg_connect_websocket_client()</a>, <a class="el" href="civetweb_8c_source.html#l19269">mg_connect_websocket_client_extensions()</a>, <a class="el" href="civetweb_8c_source.html#l19242">mg_connect_websocket_client_secure()</a>, and <a class="el" href="civetweb_8c_source.html#l19300">mg_connect_websocket_client_secure_extensions()</a>.</p>

</div>
</div>
<a id="a82872c373eedb743614f2df8653a1fb9" name="a82872c373eedb743614f2df8653a1fb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82872c373eedb743614f2df8653a1fb9">&#9670;&#160;</a></span>mg_connect_websocket_client_secure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> * mg_connect_websocket_client_secure </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *</td>          <td class="paramname"><span class="paramname"><em>client_options</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>error_buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>error_buffer_size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>origin</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a></td>          <td class="paramname"><span class="paramname"><em>data_func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a></td>          <td class="paramname"><span class="paramname"><em>close_func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>user_data</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19242">19242</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19251</span>{</div>
<div class="line"><span class="lineno">19252</span>    <span class="keywordflow">if</span> (!client_options) {</div>
<div class="line"><span class="lineno">19253</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19254</span>    }</div>
<div class="line"><span class="lineno">19255</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#adaf75d5a293cb52138c36e0b7a4fb0e4">mg_connect_websocket_client_impl</a>(client_options,</div>
<div class="line"><span class="lineno">19256</span>                                            1,</div>
<div class="line"><span class="lineno">19257</span>                                            error_buffer,</div>
<div class="line"><span class="lineno">19258</span>                                            error_buffer_size,</div>
<div class="line"><span class="lineno">19259</span>                                            path,</div>
<div class="line"><span class="lineno">19260</span>                                            origin,</div>
<div class="line"><span class="lineno">19261</span>                                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">19262</span>                                            data_func,</div>
<div class="line"><span class="lineno">19263</span>                                            <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>,</div>
<div class="line"><span class="lineno">19264</span>                                            user_data);</div>
<div class="line"><span class="lineno">19265</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lua-5_81_85_2src_2lparser_8c_source.html#l00356">close_func()</a>, <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

</div>
</div>
<a id="a6c7dc2b030def4a350fecbb70652aaa0" name="a6c7dc2b030def4a350fecbb70652aaa0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c7dc2b030def4a350fecbb70652aaa0">&#9670;&#160;</a></span>mg_connect_websocket_client_secure_extensions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> * mg_connect_websocket_client_secure_extensions </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *</td>          <td class="paramname"><span class="paramname"><em>client_options</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>error_buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>error_buffer_size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>origin</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>extensions</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a></td>          <td class="paramname"><span class="paramname"><em>data_func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a></td>          <td class="paramname"><span class="paramname"><em>close_func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>user_data</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19300">19300</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19310</span>{</div>
<div class="line"><span class="lineno">19311</span>    <span class="keywordflow">if</span> (!client_options) {</div>
<div class="line"><span class="lineno">19312</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19313</span>    }</div>
<div class="line"><span class="lineno">19314</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#adaf75d5a293cb52138c36e0b7a4fb0e4">mg_connect_websocket_client_impl</a>(client_options,</div>
<div class="line"><span class="lineno">19315</span>                                            1,</div>
<div class="line"><span class="lineno">19316</span>                                            error_buffer,</div>
<div class="line"><span class="lineno">19317</span>                                            error_buffer_size,</div>
<div class="line"><span class="lineno">19318</span>                                            path,</div>
<div class="line"><span class="lineno">19319</span>                                            origin,</div>
<div class="line"><span class="lineno">19320</span>                                            extensions,</div>
<div class="line"><span class="lineno">19321</span>                                            data_func,</div>
<div class="line"><span class="lineno">19322</span>                                            <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a46bd6da1ec8052eeaf6fd524199ca72a">close_func</a>,</div>
<div class="line"><span class="lineno">19323</span>                                            user_data);</div>
<div class="line"><span class="lineno">19324</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lua-5_81_85_2src_2lparser_8c_source.html#l00356">close_func()</a>, <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

</div>
</div>
<a id="acb99501ab73e2f08414accf1a7d108c1" name="acb99501ab73e2f08414accf1a7d108c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb99501ab73e2f08414accf1a7d108c1">&#9670;&#160;</a></span>mg_construct_local_link()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_construct_local_link </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>buflen</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>define_proto</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>define_port</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>define_uri</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03601">3601</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3607</span>{</div>
<div class="line"><span class="lineno"> 3608</span>    <span class="keywordflow">if</span> ((buflen &lt; 1) || (buf == 0) || (conn == 0)) {</div>
<div class="line"><span class="lineno"> 3609</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 3610</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3611</span>        <span class="keywordtype">int</span> i, j;</div>
<div class="line"><span class="lineno"> 3612</span>        <span class="keywordtype">int</span> truncated = 0;</div>
<div class="line"><span class="lineno"> 3613</span>        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structmg__request__info.html">mg_request_info</a> *ri = &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>;</div>
<div class="line"><span class="lineno"> 3614</span> </div>
<div class="line"><span class="lineno"> 3615</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="#a1491042fd5b61bf39023b8df4c736128">proto</a> =</div>
<div class="line"><span class="lineno"> 3616</span>            (define_proto != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? define_proto : <a class="code hl_function" href="#aaa28a4d9a3623da0fc3cbf1fd71acf8b">get_proto_name</a>(conn);</div>
<div class="line"><span class="lineno"> 3617</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *uri =</div>
<div class="line"><span class="lineno"> 3618</span>            (define_uri != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno"> 3619</span>                ? define_uri</div>
<div class="line"><span class="lineno"> 3620</span>                : ((ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a> : ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno"> 3621</span>        <span class="keywordtype">int</span> port = (define_port &gt; 0) ? define_port : ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a0edacbaca9b971ced5f00a7dfae06165">server_port</a>;</div>
<div class="line"><span class="lineno"> 3622</span>        <span class="keywordtype">int</span> <a class="code hl_variable" href="#a44d2ac6d2bf6a4654389c5e778e7414c">default_port</a> = 80;</div>
<div class="line"><span class="lineno"> 3623</span>        <span class="keywordtype">char</span> *uri_encoded;</div>
<div class="line"><span class="lineno"> 3624</span>        <span class="keywordtype">size_t</span> uri_encoded_len;</div>
<div class="line"><span class="lineno"> 3625</span> </div>
<div class="line"><span class="lineno"> 3626</span>        <span class="keywordflow">if</span> (uri == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3627</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 3628</span>        }</div>
<div class="line"><span class="lineno"> 3629</span> </div>
<div class="line"><span class="lineno"> 3630</span>        uri_encoded_len = strlen(uri) * 3 + 1;</div>
<div class="line"><span class="lineno"> 3631</span>        uri_encoded = (<span class="keywordtype">char</span> *)<a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(uri_encoded_len, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno"> 3632</span>        <span class="keywordflow">if</span> (uri_encoded == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3633</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 3634</span>        }</div>
<div class="line"><span class="lineno"> 3635</span>        <a class="code hl_function" href="#afec55bb47160c2d4fe76c5df4ce54f56">mg_url_encode</a>(uri, uri_encoded, uri_encoded_len);</div>
<div class="line"><span class="lineno"> 3636</span> </div>
<div class="line"><span class="lineno"> 3637</span>        <span class="comment">/* Directory separator should be preserved. */</span></div>
<div class="line"><span class="lineno"> 3638</span>        <span class="keywordflow">for</span> (i = j = 0; uri_encoded[i]; j++) {</div>
<div class="line"><span class="lineno"> 3639</span>            <span class="keywordflow">if</span> (!strncmp(uri_encoded + i, <span class="stringliteral">&quot;%2f&quot;</span>, 3)) {</div>
<div class="line"><span class="lineno"> 3640</span>                uri_encoded[j] = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno"> 3641</span>                i += 3;</div>
<div class="line"><span class="lineno"> 3642</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3643</span>                uri_encoded[j] = uri_encoded[i++];</div>
<div class="line"><span class="lineno"> 3644</span>            }</div>
<div class="line"><span class="lineno"> 3645</span>        }</div>
<div class="line"><span class="lineno"> 3646</span>        uri_encoded[j] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 3647</span> </div>
<div class="line"><span class="lineno"> 3648</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno"> 3649</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family == AF_UNIX) {</div>
<div class="line"><span class="lineno"> 3650</span>            <span class="comment">/* TODO: Define and document a link for UNIX domain sockets. */</span></div>
<div class="line"><span class="lineno"> 3651</span>            <span class="comment">/* There seems to be no official standard for this.</span></div>
<div class="line"><span class="lineno"> 3652</span><span class="comment">             * Common uses seem to be &quot;httpunix://&quot;, &quot;http.unix://&quot; or</span></div>
<div class="line"><span class="lineno"> 3653</span><span class="comment">             * &quot;http+unix://&quot; as a protocol definition string, followed by</span></div>
<div class="line"><span class="lineno"> 3654</span><span class="comment">             * &quot;localhost&quot; or &quot;127.0.0.1&quot; or &quot;/tmp/unix/path&quot; or</span></div>
<div class="line"><span class="lineno"> 3655</span><span class="comment">             * &quot;%2Ftmp%2Funix%2Fpath&quot; (url % encoded) or</span></div>
<div class="line"><span class="lineno"> 3656</span><span class="comment">             * &quot;localhost:%2Ftmp%2Funix%2Fpath&quot; (domain socket path as port) or</span></div>
<div class="line"><span class="lineno"> 3657</span><span class="comment">             * &quot;&quot; (completely skipping the server name part). In any case, the</span></div>
<div class="line"><span class="lineno"> 3658</span><span class="comment">             * last part is the server local path. */</span></div>
<div class="line"><span class="lineno"> 3659</span>            <span class="keyword">const</span> <span class="keywordtype">char</span> *server_name = UNIX_DOMAIN_SOCKET_SERVER_NAME;</div>
<div class="line"><span class="lineno"> 3660</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 3661</span>                        &amp;truncated,</div>
<div class="line"><span class="lineno"> 3662</span>                        buf,</div>
<div class="line"><span class="lineno"> 3663</span>                        buflen,</div>
<div class="line"><span class="lineno"> 3664</span>                        <span class="stringliteral">&quot;%s.unix://%s%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 3665</span>                        <a class="code hl_variable" href="#a1491042fd5b61bf39023b8df4c736128">proto</a>,</div>
<div class="line"><span class="lineno"> 3666</span>                        server_name,</div>
<div class="line"><span class="lineno"> 3667</span>                        ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno"> 3668</span>            <a class="code hl_variable" href="#a44d2ac6d2bf6a4654389c5e778e7414c">default_port</a> = 0;</div>
<div class="line"><span class="lineno"> 3669</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(uri_encoded);</div>
<div class="line"><span class="lineno"> 3670</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 3671</span>        }</div>
<div class="line"><span class="lineno"> 3672</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3673</span> </div>
<div class="line"><span class="lineno"> 3674</span>        <span class="keywordflow">if</span> (define_proto) {</div>
<div class="line"><span class="lineno"> 3675</span>            <span class="comment">/* If we got a protocol name, use the default port accordingly. */</span></div>
<div class="line"><span class="lineno"> 3676</span>            <span class="keywordflow">if</span> ((0 == strcmp(define_proto, <span class="stringliteral">&quot;https&quot;</span>))</div>
<div class="line"><span class="lineno"> 3677</span>                || (0 == strcmp(define_proto, <span class="stringliteral">&quot;wss&quot;</span>))) {</div>
<div class="line"><span class="lineno"> 3678</span>                <a class="code hl_variable" href="#a44d2ac6d2bf6a4654389c5e778e7414c">default_port</a> = 443;</div>
<div class="line"><span class="lineno"> 3679</span>            }</div>
<div class="line"><span class="lineno"> 3680</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#af66a6c4c2364a37b87f646f76b9e7d3d">is_ssl</a>) {</div>
<div class="line"><span class="lineno"> 3681</span>            <span class="comment">/* If we did not get a protocol name, use TLS as default if it is</span></div>
<div class="line"><span class="lineno"> 3682</span><span class="comment">             * already used. */</span></div>
<div class="line"><span class="lineno"> 3683</span>            <a class="code hl_variable" href="#a44d2ac6d2bf6a4654389c5e778e7414c">default_port</a> = 443;</div>
<div class="line"><span class="lineno"> 3684</span>        }</div>
<div class="line"><span class="lineno"> 3685</span> </div>
<div class="line"><span class="lineno"> 3686</span>        {</div>
<div class="line"><span class="lineno"> 3687</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno"> 3688</span>            <span class="keywordtype">int</span> is_ipv6 = (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family == AF_INET6);</div>
<div class="line"><span class="lineno"> 3689</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3690</span>            <span class="keywordtype">int</span> auth_domain_check_enabled =</div>
<div class="line"><span class="lineno"> 3691</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa196eb33164714d8b04ace074a72c492">ENABLE_AUTH_DOMAIN_CHECK</a>]</div>
<div class="line"><span class="lineno"> 3692</span>                &amp;&amp; (!<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(</div>
<div class="line"><span class="lineno"> 3693</span>                       conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa196eb33164714d8b04ace074a72c492">ENABLE_AUTH_DOMAIN_CHECK</a>], <span class="stringliteral">&quot;yes&quot;</span>));</div>
<div class="line"><span class="lineno"> 3694</span> </div>
<div class="line"><span class="lineno"> 3695</span>            <span class="keyword">const</span> <span class="keywordtype">char</span> *server_domain =</div>
<div class="line"><span class="lineno"> 3696</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>];</div>
<div class="line"><span class="lineno"> 3697</span> </div>
<div class="line"><span class="lineno"> 3698</span>            <span class="keywordtype">char</span> portstr[16];</div>
<div class="line"><span class="lineno"> 3699</span>            <span class="keywordtype">char</span> server_ip[48];</div>
<div class="line"><span class="lineno"> 3700</span> </div>
<div class="line"><span class="lineno"> 3701</span>            <span class="keywordflow">if</span> (port != <a class="code hl_variable" href="#a44d2ac6d2bf6a4654389c5e778e7414c">default_port</a>) {</div>
<div class="line"><span class="lineno"> 3702</span>                sprintf(portstr, <span class="stringliteral">&quot;:%u&quot;</span>, (<span class="keywordtype">unsigned</span>)port);</div>
<div class="line"><span class="lineno"> 3703</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3704</span>                portstr[0] = 0;</div>
<div class="line"><span class="lineno"> 3705</span>            }</div>
<div class="line"><span class="lineno"> 3706</span> </div>
<div class="line"><span class="lineno"> 3707</span>            <span class="keywordflow">if</span> (!auth_domain_check_enabled || !server_domain) {</div>
<div class="line"><span class="lineno"> 3708</span> </div>
<div class="line"><span class="lineno"> 3709</span>                <a class="code hl_function" href="#a043f416da5d5ec0b9a0f39e7a34250c2">sockaddr_to_string</a>(server_ip,</div>
<div class="line"><span class="lineno"> 3710</span>                                   <span class="keyword">sizeof</span>(server_ip),</div>
<div class="line"><span class="lineno"> 3711</span>                                   &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>);</div>
<div class="line"><span class="lineno"> 3712</span> </div>
<div class="line"><span class="lineno"> 3713</span>                server_domain = server_ip;</div>
<div class="line"><span class="lineno"> 3714</span>            }</div>
<div class="line"><span class="lineno"> 3715</span> </div>
<div class="line"><span class="lineno"> 3716</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 3717</span>                        &amp;truncated,</div>
<div class="line"><span class="lineno"> 3718</span>                        buf,</div>
<div class="line"><span class="lineno"> 3719</span>                        buflen,</div>
<div class="line"><span class="lineno"> 3720</span>#<span class="keywordflow">if</span> defined(USE_IPV6)</div>
<div class="line"><span class="lineno"> 3721</span>                        <span class="stringliteral">&quot;%s://%s%s%s%s%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 3722</span>                        <a class="code hl_variable" href="#a1491042fd5b61bf39023b8df4c736128">proto</a>,</div>
<div class="line"><span class="lineno"> 3723</span>                        (is_ipv6 &amp;&amp; (server_domain == server_ip)) ? <span class="stringliteral">&quot;[&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno"> 3724</span>                        server_domain,</div>
<div class="line"><span class="lineno"> 3725</span>                        (is_ipv6 &amp;&amp; (server_domain == server_ip)) ? <span class="stringliteral">&quot;]&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno"> 3726</span>#else</div>
<div class="line"><span class="lineno"> 3727</span>                        <span class="stringliteral">&quot;%s://%s%s%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 3728</span>                        <a class="code hl_variable" href="#a1491042fd5b61bf39023b8df4c736128">proto</a>,</div>
<div class="line"><span class="lineno"> 3729</span>                        server_domain,</div>
<div class="line"><span class="lineno"> 3730</span>#endif</div>
<div class="line"><span class="lineno"> 3731</span>                        portstr,</div>
<div class="line"><span class="lineno"> 3732</span>                        uri_encoded);</div>
<div class="line"><span class="lineno"> 3733</span> </div>
<div class="line"><span class="lineno"> 3734</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(uri_encoded);</div>
<div class="line"><span class="lineno"> 3735</span>            <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno"> 3736</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 3737</span>            }</div>
<div class="line"><span class="lineno"> 3738</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 3739</span>        }</div>
<div class="line"><span class="lineno"> 3740</span>    }</div>
<div class="line"><span class="lineno"> 3741</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a44d2ac6d2bf6a4654389c5e778e7414c"><div class="ttname"><a href="#a44d2ac6d2bf6a4654389c5e778e7414c">default_port</a></div><div class="ttdeci">unsigned default_port</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18380">civetweb.c:18380</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aaa28a4d9a3623da0fc3cbf1fd71acf8b"><div class="ttname"><a href="#aaa28a4d9a3623da0fc3cbf1fd71acf8b">get_proto_name</a></div><div class="ttdeci">static const char * get_proto_name(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03574">civetweb.c:3574</a></div></div>
<div class="ttc" id="acivetweb_8c_html_afec55bb47160c2d4fe76c5df4ce54f56"><div class="ttname"><a href="#afec55bb47160c2d4fe76c5df4ce54f56">mg_url_encode</a></div><div class="ttdeci">CIVETWEB_API int mg_url_encode(const char *src, char *dst, size_t dst_len)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09581">civetweb.c:9581</a></div></div>
<div class="ttc" id="astructmg__request__info_html_a0edacbaca9b971ced5f00a7dfae06165"><div class="ttname"><a href="structmg__request__info.html#a0edacbaca9b971ced5f00a7dfae06165">mg_request_info::server_port</a></div><div class="ttdeci">int server_port</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00171">civetweb.h:171</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01999">AUTHENTICATION_DOMAIN</a>, <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l18380">default_port</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02000">ENABLE_AUTH_DOMAIN_CHECK</a>, <a class="el" href="civetweb_8c_source.html#l03574">get_proto_name()</a>, <a class="el" href="civetweb_8h_source.html#l00173">mg_request_info::is_ssl</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01497">mg_malloc_ctx</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l09581">mg_url_encode()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l18378">proto</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>, <a class="el" href="civetweb_8c_source.html#l01833">usa::sa</a>, <a class="el" href="civetweb_8h_source.html#l00171">mg_request_info::server_port</a>, and <a class="el" href="civetweb_8c_source.html#l03292">sockaddr_to_string()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03745">mg_get_request_link()</a>, <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>, and <a class="el" href="civetweb_8c_source.html#l14235">redirect_to_https_port()</a>.</p>

</div>
</div>
<a id="ad8b54e2069d196bd535dbcb3bc806e96" name="ad8b54e2069d196bd535dbcb3bc806e96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8b54e2069d196bd535dbcb3bc806e96">&#9670;&#160;</a></span>mg_cry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_cry </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03501">3501</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3502</span>{</div>
<div class="line"><span class="lineno"> 3503</span>    va_list ap;</div>
<div class="line"><span class="lineno"> 3504</span>    va_start(ap, fmt);</div>
<div class="line"><span class="lineno"> 3505</span>    <a class="code hl_function" href="#a15063d3ea09051aad3f87c5cafa22d3e">mg_cry_internal_impl</a>(conn, <span class="stringliteral">&quot;user&quot;</span>, 0, fmt, ap);</div>
<div class="line"><span class="lineno"> 3506</span>    va_end(ap);</div>
<div class="line"><span class="lineno"> 3507</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a15063d3ea09051aad3f87c5cafa22d3e"><div class="ttname"><a href="#a15063d3ea09051aad3f87c5cafa22d3e">mg_cry_internal_impl</a></div><div class="ttdeci">static void mg_cry_internal_impl(const struct mg_connection *conn, const char *func, unsigned line, const char *fmt, va_list ap)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03382">civetweb.c:3382</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>.</p>

</div>
</div>
<a id="a15063d3ea09051aad3f87c5cafa22d3e" name="a15063d3ea09051aad3f87c5cafa22d3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15063d3ea09051aad3f87c5cafa22d3e">&#9670;&#160;</a></span>mg_cry_internal_impl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mg_cry_internal_impl </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned</td>          <td class="paramname"><span class="paramname"><em>line</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list</td>          <td class="paramname"><span class="paramname"><em>ap</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03382">3382</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3387</span>{</div>
<div class="line"><span class="lineno"> 3388</span>    <span class="keywordtype">char</span> buf[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>], src_addr[<a class="code hl_define" href="#a0563a85b179703339cbf223e7e1c0454">IP_ADDR_STR_LEN</a>];</div>
<div class="line"><span class="lineno"> 3389</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> fi;</div>
<div class="line"><span class="lineno"> 3390</span>    time_t timestamp;</div>
<div class="line"><span class="lineno"> 3391</span> </div>
<div class="line"><span class="lineno"> 3392</span>    <span class="comment">/* Unused, in the RELEASE build */</span></div>
<div class="line"><span class="lineno"> 3393</span>    (void)func;</div>
<div class="line"><span class="lineno"> 3394</span>    (void)line;</div>
<div class="line"><span class="lineno"> 3395</span> </div>
<div class="line"><span class="lineno"> 3396</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno"> 3397</span><span class="preprocessor">#pragma GCC diagnostic push</span></div>
<div class="line"><span class="lineno"> 3398</span><span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wformat-nonliteral&quot;</span></div>
<div class="line"><span class="lineno"> 3399</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3400</span> </div>
<div class="line"><span class="lineno"> 3401</span>    <a class="code hl_define" href="#ad78a7b8419e5ec9f2cc7d310fcf142d7">IGNORE_UNUSED_RESULT</a>(<a class="code hl_define" href="#a095b3b42df21f6e5d4377e299da56a79">vsnprintf_impl</a>(buf, <span class="keyword">sizeof</span>(buf), fmt, ap));</div>
<div class="line"><span class="lineno"> 3402</span> </div>
<div class="line"><span class="lineno"> 3403</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno"> 3404</span><span class="preprocessor">#pragma GCC diagnostic pop</span></div>
<div class="line"><span class="lineno"> 3405</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3406</span> </div>
<div class="line"><span class="lineno"> 3407</span>    buf[<span class="keyword">sizeof</span>(buf) - 1] = 0;</div>
<div class="line"><span class="lineno"> 3408</span> </div>
<div class="line"><span class="lineno"> 3409</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;mg_cry called from %s:%u: %s&quot;</span>, func, line, buf);</div>
<div class="line"><span class="lineno"> 3410</span> </div>
<div class="line"><span class="lineno"> 3411</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno"> 3412</span>        puts(buf);</div>
<div class="line"><span class="lineno"> 3413</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 3414</span>    }</div>
<div class="line"><span class="lineno"> 3415</span> </div>
<div class="line"><span class="lineno"> 3416</span>    <span class="comment">/* Do not lock when getting the callback value, here and below.</span></div>
<div class="line"><span class="lineno"> 3417</span><span class="comment">     * I suppose this is fine, since function cannot disappear in the</span></div>
<div class="line"><span class="lineno"> 3418</span><span class="comment">     * same way string option can. */</span></div>
<div class="line"><span class="lineno"> 3419</span>    <span class="keywordflow">if</span> ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a2a24303cdd0175f9d8243402b268306e">log_message</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno"> 3420</span>        || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a2a24303cdd0175f9d8243402b268306e">log_message</a>(conn, buf) == 0)) {</div>
<div class="line"><span class="lineno"> 3421</span> </div>
<div class="line"><span class="lineno"> 3422</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba66ac785400448f574aa25e2943f3a854">ERROR_LOG_FILE</a>] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3423</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn,</div>
<div class="line"><span class="lineno"> 3424</span>                         conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba66ac785400448f574aa25e2943f3a854">ERROR_LOG_FILE</a>],</div>
<div class="line"><span class="lineno"> 3425</span>                         <a class="code hl_define" href="#a88232e9595ccceb9a04b106cc6d2739c">MG_FOPEN_MODE_APPEND</a>,</div>
<div class="line"><span class="lineno"> 3426</span>                         &amp;fi)</div>
<div class="line"><span class="lineno"> 3427</span>                == 0) {</div>
<div class="line"><span class="lineno"> 3428</span>                fi.access.fp = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3429</span>            }</div>
<div class="line"><span class="lineno"> 3430</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3431</span>            fi.access.fp = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3432</span>        }</div>
<div class="line"><span class="lineno"> 3433</span> </div>
<div class="line"><span class="lineno"> 3434</span>        <span class="keywordflow">if</span> (fi.access.fp != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3435</span>            flockfile(fi.access.fp);</div>
<div class="line"><span class="lineno"> 3436</span>            timestamp = time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 3437</span> </div>
<div class="line"><span class="lineno"> 3438</span>            <a class="code hl_function" href="#a043f416da5d5ec0b9a0f39e7a34250c2">sockaddr_to_string</a>(src_addr, <span class="keyword">sizeof</span>(src_addr), &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#afe3a45fe832ca19cc85299b9a96d8feb">rsa</a>);</div>
<div class="line"><span class="lineno"> 3439</span>            fprintf(fi.access.fp,</div>
<div class="line"><span class="lineno"> 3440</span>                    <span class="stringliteral">&quot;[%010lu] [error] [client %s] &quot;</span>,</div>
<div class="line"><span class="lineno"> 3441</span>                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)timestamp,</div>
<div class="line"><span class="lineno"> 3442</span>                    src_addr);</div>
<div class="line"><span class="lineno"> 3443</span> </div>
<div class="line"><span class="lineno"> 3444</span>            <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3445</span>                fprintf(fi.access.fp,</div>
<div class="line"><span class="lineno"> 3446</span>                        <span class="stringliteral">&quot;%s %s: &quot;</span>,</div>
<div class="line"><span class="lineno"> 3447</span>                        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno"> 3448</span>                        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a></div>
<div class="line"><span class="lineno"> 3449</span>                            ? conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a></div>
<div class="line"><span class="lineno"> 3450</span>                            : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno"> 3451</span>            }</div>
<div class="line"><span class="lineno"> 3452</span> </div>
<div class="line"><span class="lineno"> 3453</span>            fprintf(fi.access.fp, <span class="stringliteral">&quot;%s&quot;</span>, buf);</div>
<div class="line"><span class="lineno"> 3454</span>            fputc(<span class="charliteral">&#39;\n&#39;</span>, fi.access.fp);</div>
<div class="line"><span class="lineno"> 3455</span>            fflush(fi.access.fp);</div>
<div class="line"><span class="lineno"> 3456</span>            funlockfile(fi.access.fp);</div>
<div class="line"><span class="lineno"> 3457</span>            (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;fi.access); <span class="comment">/* Ignore errors. We can&#39;t call</span></div>
<div class="line"><span class="lineno"> 3458</span><span class="comment">                                          * mg_cry here anyway ;-) */</span></div>
<div class="line"><span class="lineno"> 3459</span>        }</div>
<div class="line"><span class="lineno"> 3460</span>    }</div>
<div class="line"><span class="lineno"> 3461</span>}</div>
<div class="ttc" id="astructmg__callbacks_html_a2a24303cdd0175f9d8243402b268306e"><div class="ttname"><a href="structmg__callbacks.html#a2a24303cdd0175f9d8243402b268306e">mg_callbacks::log_message</a></div><div class="ttdeci">int(* log_message)(const struct mg_connection *, const char *message)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00240">civetweb.h:240</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01957">ERROR_LOG_FILE</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, <a class="el" href="civetweb_8c_source.html#l00291">IGNORE_UNUSED_RESULT</a>, <a class="el" href="civetweb_8c_source.html#l01732">IP_ADDR_STR_LEN</a>, <a class="el" href="civetweb_8h_source.html#l00240">mg_callbacks::log_message</a>, <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02849">MG_FOPEN_MODE_APPEND</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>, <a class="el" href="civetweb_8c_source.html#l01905">socket::rsa</a>, <a class="el" href="civetweb_8c_source.html#l03292">sockaddr_to_string()</a>, and <a class="el" href="civetweb_8c_source.html#l00897">vsnprintf_impl</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03501">mg_cry()</a>, and <a class="el" href="civetweb_8c_source.html#l03481">mg_cry_internal_wrap()</a>.</p>

</div>
</div>
<a id="a148db84e7bdb695f1a072e0b5997fac5" name="a148db84e7bdb695f1a072e0b5997fac5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a148db84e7bdb695f1a072e0b5997fac5">&#9670;&#160;</a></span>mg_cry_internal_wrap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mg_cry_internal_wrap </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned</td>          <td class="paramname"><span class="paramname"><em>line</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03481">3481</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3487</span>{</div>
<div class="line"><span class="lineno"> 3488</span>    va_list ap;</div>
<div class="line"><span class="lineno"> 3489</span>    va_start(ap, fmt);</div>
<div class="line"><span class="lineno"> 3490</span>    <span class="keywordflow">if</span> (!conn &amp;&amp; ctx) {</div>
<div class="line"><span class="lineno"> 3491</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> fc;</div>
<div class="line"><span class="lineno"> 3492</span>        <a class="code hl_function" href="#a15063d3ea09051aad3f87c5cafa22d3e">mg_cry_internal_impl</a>(<a class="code hl_function" href="#a46e65877beedb5fed507ad30dbf76d86">fake_connection</a>(&amp;fc, ctx), func, line, fmt, ap);</div>
<div class="line"><span class="lineno"> 3493</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3494</span>        <a class="code hl_function" href="#a15063d3ea09051aad3f87c5cafa22d3e">mg_cry_internal_impl</a>(conn, func, line, fmt, ap);</div>
<div class="line"><span class="lineno"> 3495</span>    }</div>
<div class="line"><span class="lineno"> 3496</span>    va_end(ap);</div>
<div class="line"><span class="lineno"> 3497</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03470">fake_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>.</p>

</div>
</div>
<a id="a4212925fe8cca547d2be85b99d8f7c56" name="a4212925fe8cca547d2be85b99d8f7c56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4212925fe8cca547d2be85b99d8f7c56">&#9670;&#160;</a></span>mg_current_thread_id()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> unsigned long mg_current_thread_id </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01626">1626</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1627</span>{</div>
<div class="line"><span class="lineno"> 1628</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 1629</span>    <span class="keywordflow">return</span> GetCurrentThreadId();</div>
<div class="line"><span class="lineno"> 1630</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 1631</span> </div>
<div class="line"><span class="lineno"> 1632</span><span class="preprocessor">#if defined(__clang__)</span></div>
<div class="line"><span class="lineno"> 1633</span><span class="preprocessor">#pragma clang diagnostic push</span></div>
<div class="line"><span class="lineno"> 1634</span><span class="preprocessor">#pragma clang diagnostic ignored &quot;-Wunreachable-code&quot;</span></div>
<div class="line"><span class="lineno"> 1635</span>    <span class="comment">/* For every compiler, either &quot;sizeof(pthread_t) &gt; sizeof(unsigned long)&quot;</span></div>
<div class="line"><span class="lineno"> 1636</span><span class="comment">     * or not, so one of the two conditions will be unreachable by construction.</span></div>
<div class="line"><span class="lineno"> 1637</span><span class="comment">     * Unfortunately the C standard does not define a way to check this at</span></div>
<div class="line"><span class="lineno"> 1638</span><span class="comment">     * compile time, since the #if preprocessor conditions can not use the</span></div>
<div class="line"><span class="lineno"> 1639</span><span class="comment">     * sizeof operator as an argument. */</span></div>
<div class="line"><span class="lineno"> 1640</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1641</span> </div>
<div class="line"><span class="lineno"> 1642</span>    <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(pthread_t) &gt; <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)) {</div>
<div class="line"><span class="lineno"> 1643</span>        <span class="comment">/* This is the problematic case for CRYPTO_set_id_callback:</span></div>
<div class="line"><span class="lineno"> 1644</span><span class="comment">         * The OS pthread_t can not be cast to unsigned long. */</span></div>
<div class="line"><span class="lineno"> 1645</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> *tls =</div>
<div class="line"><span class="lineno"> 1646</span>            (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> *)pthread_getspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>);</div>
<div class="line"><span class="lineno"> 1647</span>        <span class="keywordflow">if</span> (tls == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 1648</span>            <span class="comment">/* SSL called from an unknown thread: Create some thread index.</span></div>
<div class="line"><span class="lineno"> 1649</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno"> 1650</span>            tls = (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> *)<a class="code hl_function" href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a>));</div>
<div class="line"><span class="lineno"> 1651</span>            tls-&gt;<a class="code hl_variable" href="structmg__workerTLS.html#afb66eb6c9a175525b219dfcda7b40c7e">is_master</a> = -2; <span class="comment">/* -2 means &quot;3rd party thread&quot; */</span></div>
<div class="line"><span class="lineno"> 1652</span>            tls-&gt;<a class="code hl_variable" href="structmg__workerTLS.html#aff70c6a5939daba5919683e36d2e6ff9">thread_idx</a> = (unsigned)<a class="code hl_function" href="#ac84429c87794be46b88e30fbd3b0bcfa">mg_atomic_inc</a>(&amp;<a class="code hl_variable" href="#af79aed9cc77304a39b3e031b2730e38b">thread_idx_max</a>);</div>
<div class="line"><span class="lineno"> 1653</span>            pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, tls);</div>
<div class="line"><span class="lineno"> 1654</span>        }</div>
<div class="line"><span class="lineno"> 1655</span>        <span class="keywordflow">return</span> tls-&gt;<a class="code hl_variable" href="structmg__workerTLS.html#aff70c6a5939daba5919683e36d2e6ff9">thread_idx</a>;</div>
<div class="line"><span class="lineno"> 1656</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1657</span>        <span class="comment">/* pthread_t may be any data type, so a simple cast to unsigned long</span></div>
<div class="line"><span class="lineno"> 1658</span><span class="comment">         * can rise a warning/error, depending on the platform.</span></div>
<div class="line"><span class="lineno"> 1659</span><span class="comment">         * Here memcpy is used as an anything-to-anything cast. */</span></div>
<div class="line"><span class="lineno"> 1660</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ret = 0;</div>
<div class="line"><span class="lineno"> 1661</span>        pthread_t t = pthread_self();</div>
<div class="line"><span class="lineno"> 1662</span>        memcpy(&amp;ret, &amp;t, <span class="keyword">sizeof</span>(pthread_t));</div>
<div class="line"><span class="lineno"> 1663</span>        <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno"> 1664</span>    }</div>
<div class="line"><span class="lineno"> 1665</span> </div>
<div class="line"><span class="lineno"> 1666</span><span class="preprocessor">#if defined(__clang__)</span></div>
<div class="line"><span class="lineno"> 1667</span><span class="preprocessor">#pragma clang diagnostic pop</span></div>
<div class="line"><span class="lineno"> 1668</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1669</span> </div>
<div class="line"><span class="lineno"> 1670</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1671</span>}</div>
<div class="ttc" id="acivetweb_8c_html_af79aed9cc77304a39b3e031b2730e38b"><div class="ttname"><a href="#af79aed9cc77304a39b3e031b2730e38b">thread_idx_max</a></div><div class="ttdeci">static volatile ptrdiff_t thread_idx_max</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01581">civetweb.c:1581</a></div></div>
<div class="ttc" id="astructmg__workerTLS_html_afb66eb6c9a175525b219dfcda7b40c7e"><div class="ttname"><a href="structmg__workerTLS.html#afb66eb6c9a175525b219dfcda7b40c7e">mg_workerTLS::is_master</a></div><div class="ttdeci">int is_master</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01588">civetweb.c:1588</a></div></div>
<div class="ttc" id="astructmg__workerTLS_html_aff70c6a5939daba5919683e36d2e6ff9"><div class="ttname"><a href="structmg__workerTLS.html#aff70c6a5939daba5919683e36d2e6ff9">mg_workerTLS::thread_idx</a></div><div class="ttdeci">unsigned long thread_idx</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01589">civetweb.c:1589</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01588">mg_workerTLS::is_master</a>, <a class="el" href="civetweb_8c_source.html#l01121">mg_atomic_inc()</a>, <a class="el" href="civetweb_8c_source.html#l01474">mg_malloc()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01580">sTlsKey</a>, <a class="el" href="civetweb_8c_source.html#l01589">mg_workerTLS::thread_idx</a>, and <a class="el" href="civetweb_8c_source.html#l01581">thread_idx_max</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>.</p>

</div>
</div>
<a id="ac54e1770467596ef9b50e658a2672a6c" name="ac54e1770467596ef9b50e658a2672a6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac54e1770467596ef9b50e658a2672a6c">&#9670;&#160;</a></span>mg_difftimespec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double mg_difftimespec </td>
          <td>(</td>
          <td class="paramtype">const struct timespec *</td>          <td class="paramname"><span class="paramname"><em>ts_now</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct timespec *</td>          <td class="paramname"><span class="paramname"><em>ts_before</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03364">3364</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3365</span>{</div>
<div class="line"><span class="lineno"> 3366</span>    <span class="keywordflow">return</span> (<span class="keywordtype">double</span>)(ts_now-&gt;tv_nsec - ts_before-&gt;tv_nsec) * 1.0E-9</div>
<div class="line"><span class="lineno"> 3367</span>           + (<span class="keywordtype">double</span>)(ts_now-&gt;tv_sec - ts_before-&gt;tv_sec);</div>
<div class="line"><span class="lineno"> 3368</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06562">handle_request_stat_log()</a>, and <a class="el" href="civetweb_8c_source.html#l11107">read_message()</a>.</p>

</div>
</div>
<a id="a9e467f9e2b0dcca696fbbd1da1a01f21" name="a9e467f9e2b0dcca696fbbd1da1a01f21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e467f9e2b0dcca696fbbd1da1a01f21">&#9670;&#160;</a></span>mg_disable_connection_keep_alive()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_disable_connection_keep_alive </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l22042">22042</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">22043</span>{</div>
<div class="line"><span class="lineno">22044</span>    <span class="comment">/* https://github.com/civetweb/civetweb/issues/727 */</span></div>
<div class="line"><span class="lineno">22045</span>    <span class="keywordflow">if</span> (conn != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">22046</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">22047</span>    }</div>
<div class="line"><span class="lineno">22048</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

</div>
</div>
<a id="a641f57d35a9decf941d198a92ba10b64" name="a641f57d35a9decf941d198a92ba10b64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a641f57d35a9decf941d198a92ba10b64">&#9670;&#160;</a></span>mg_download()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__connection.html">mg_connection</a> * mg_download </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>host</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>port</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>use_ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>ebuf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>ebuf_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18874">18874</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">18881</span>{</div>
<div class="line"><span class="lineno">18882</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *conn;</div>
<div class="line"><span class="lineno">18883</span>    va_list ap;</div>
<div class="line"><span class="lineno">18884</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">18885</span>    <span class="keywordtype">int</span> reqerr;</div>
<div class="line"><span class="lineno">18886</span> </div>
<div class="line"><span class="lineno">18887</span>    <span class="keywordflow">if</span> (ebuf_len &gt; 0) {</div>
<div class="line"><span class="lineno">18888</span>        ebuf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">18889</span>    }</div>
<div class="line"><span class="lineno">18890</span> </div>
<div class="line"><span class="lineno">18891</span>    va_start(ap, fmt);</div>
<div class="line"><span class="lineno">18892</span> </div>
<div class="line"><span class="lineno">18893</span>    <span class="comment">/* open a connection */</span></div>
<div class="line"><span class="lineno">18894</span>    conn = <a class="code hl_function" href="#ace350941110e963aeb1ce985260c6a51">mg_connect_client</a>(host, port, use_ssl, ebuf, ebuf_len);</div>
<div class="line"><span class="lineno">18895</span> </div>
<div class="line"><span class="lineno">18896</span>    <span class="keywordflow">if</span> (conn != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">18897</span>        i = <a class="code hl_function" href="#ab1c003c5b952dd24c95b887def277814">mg_vprintf</a>(conn, fmt, ap);</div>
<div class="line"><span class="lineno">18898</span>        <span class="keywordflow">if</span> (i &lt;= 0) {</div>
<div class="line"><span class="lineno">18899</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18900</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18901</span>                        ebuf,</div>
<div class="line"><span class="lineno">18902</span>                        ebuf_len,</div>
<div class="line"><span class="lineno">18903</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18904</span>                        <span class="stringliteral">&quot;Error sending request&quot;</span>);</div>
<div class="line"><span class="lineno">18905</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">18906</span>            <span class="comment">/* make sure the buffer is clear */</span></div>
<div class="line"><span class="lineno">18907</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> = 0;</div>
<div class="line"><span class="lineno">18908</span>            <a class="code hl_function" href="#a453db96888b9c0e4b7afd85f3778afb2">get_response</a>(conn, ebuf, ebuf_len, &amp;reqerr);</div>
<div class="line"><span class="lineno">18909</span> </div>
<div class="line"><span class="lineno">18910</span>            <span class="comment">/* TODO: here, the URI is the http response code */</span></div>
<div class="line"><span class="lineno">18911</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a>;</div>
<div class="line"><span class="lineno">18912</span>        }</div>
<div class="line"><span class="lineno">18913</span>    }</div>
<div class="line"><span class="lineno">18914</span> </div>
<div class="line"><span class="lineno">18915</span>    <span class="comment">/* if an error occurred, close the connection */</span></div>
<div class="line"><span class="lineno">18916</span>    <span class="keywordflow">if</span> ((ebuf[0] != <span class="charliteral">&#39;\0&#39;</span>) &amp;&amp; (conn != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">18917</span>        <a class="code hl_function" href="#ae3c0b2bb9143f8eebd7c4c12fc4f0333">mg_close_connection</a>(conn);</div>
<div class="line"><span class="lineno">18918</span>        conn = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18919</span>    }</div>
<div class="line"><span class="lineno">18920</span> </div>
<div class="line"><span class="lineno">18921</span>    va_end(ap);</div>
<div class="line"><span class="lineno">18922</span>    <span class="keywordflow">return</span> conn;</div>
<div class="line"><span class="lineno">18923</span>}</div>
<div class="ttc" id="acivetweb_8c_html_ab1c003c5b952dd24c95b887def277814"><div class="ttname"><a href="#ab1c003c5b952dd24c95b887def277814">mg_vprintf</a></div><div class="ttdeci">static int mg_vprintf(struct mg_connection *conn, const char *fmt, va_list ap)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07016">civetweb.c:7016</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ace350941110e963aeb1ce985260c6a51"><div class="ttname"><a href="#ace350941110e963aeb1ce985260c6a51">mg_connect_client</a></div><div class="ttdeci">CIVETWEB_API struct mg_connection * mg_connect_client(const char *host, int port, int use_ssl, char *error_buffer, size_t error_buffer_size)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18253">civetweb.c:18253</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02558">mg_connection::data_len</a>, <a class="el" href="civetweb_8c_source.html#l18737">get_response()</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8c_source.html#l17938">mg_close_connection()</a>, <a class="el" href="civetweb_8c_source.html#l18253">mg_connect_client()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l07016">mg_vprintf()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, and <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>.</p>

</div>
</div>
<a id="a6f1f2195be687bba095938a263869d61" name="a6f1f2195be687bba095938a263869d61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f1f2195be687bba095938a263869d61">&#9670;&#160;</a></span>mg_exit_library()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> unsigned mg_exit_library </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l22477">22477</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">22478</span>{</div>
<div class="line"><span class="lineno">22479</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a> &lt;= 0) {</div>
<div class="line"><span class="lineno">22480</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">22481</span>    }</div>
<div class="line"><span class="lineno">22482</span> </div>
<div class="line"><span class="lineno">22483</span>    <a class="code hl_function" href="#af9c2267422f7bd2de7c610a4e0eb8fb0">mg_global_lock</a>();</div>
<div class="line"><span class="lineno">22484</span> </div>
<div class="line"><span class="lineno">22485</span>    <a class="code hl_variable" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a>--;</div>
<div class="line"><span class="lineno">22486</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a> == 0) {</div>
<div class="line"><span class="lineno">22487</span><span class="preprocessor">#if (defined(OPENSSL_API_1_0) || defined(OPENSSL_API_1_1)) &amp;&amp; !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno">22488</span>        <span class="keywordflow">if</span> (mg_openssl_initialized) {</div>
<div class="line"><span class="lineno">22489</span>            <a class="code hl_function" href="#a8e8a676fa79a0e0095c1ebfeab44b224">uninitialize_openssl</a>();</div>
<div class="line"><span class="lineno">22490</span>            mg_openssl_initialized = 0;</div>
<div class="line"><span class="lineno">22491</span>        }</div>
<div class="line"><span class="lineno">22492</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">22493</span> </div>
<div class="line"><span class="lineno">22494</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">22495</span>        (void)WSACleanup();</div>
<div class="line"><span class="lineno">22496</span>        (void)pthread_mutex_destroy(&amp;global_log_file_lock);</div>
<div class="line"><span class="lineno">22497</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">22498</span>        (void)pthread_mutexattr_destroy(&amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>);</div>
<div class="line"><span class="lineno">22499</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">22500</span> </div>
<div class="line"><span class="lineno">22501</span>        (void)pthread_key_delete(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>);</div>
<div class="line"><span class="lineno">22502</span> </div>
<div class="line"><span class="lineno">22503</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">22504</span>        lua_exit_optional_libraries();</div>
<div class="line"><span class="lineno">22505</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">22506</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(<a class="code hl_variable" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a>);</div>
<div class="line"><span class="lineno">22507</span>        <a class="code hl_variable" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">22508</span> </div>
<div class="line"><span class="lineno">22509</span>        <a class="code hl_function" href="#af8b5fc3bd1b6de9fe6137e7daea140ac">mg_global_unlock</a>();</div>
<div class="line"><span class="lineno">22510</span>        (void)pthread_mutex_destroy(&amp;<a class="code hl_variable" href="#a52fa011c62bacc213572e7464ca702dd">global_lock_mutex</a>);</div>
<div class="line"><span class="lineno">22511</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">22512</span>    }</div>
<div class="line"><span class="lineno">22513</span> </div>
<div class="line"><span class="lineno">22514</span>    <a class="code hl_function" href="#af8b5fc3bd1b6de9fe6137e7daea140ac">mg_global_unlock</a>();</div>
<div class="line"><span class="lineno">22515</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">22516</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a52fa011c62bacc213572e7464ca702dd"><div class="ttname"><a href="#a52fa011c62bacc213572e7464ca702dd">global_lock_mutex</a></div><div class="ttdeci">static pthread_mutex_t global_lock_mutex</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01089">civetweb.c:1089</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a553c3bf49335ca7c4ef0af9293ff30cb"><div class="ttname"><a href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a></div><div class="ttdeci">static int mg_init_library_called</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01552">civetweb.c:1552</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a8c57fa7eeaaed403927368aa20e4efd5"><div class="ttname"><a href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a></div><div class="ttdeci">static char * all_methods</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10876">civetweb.c:10876</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a8e8a676fa79a0e0095c1ebfeab44b224"><div class="ttname"><a href="#a8e8a676fa79a0e0095c1ebfeab44b224">uninitialize_openssl</a></div><div class="ttdeci">static void uninitialize_openssl(void)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17594">civetweb.c:17594</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l10876">all_methods</a>, <a class="el" href="civetweb_8c_source.html#l01089">global_lock_mutex</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01094">mg_global_lock()</a>, <a class="el" href="civetweb_8c_source.html#l01102">mg_global_unlock()</a>, <a class="el" href="civetweb_8c_source.html#l01552">mg_init_library_called</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01074">pthread_mutex_attr</a>, <a class="el" href="civetweb_8c_source.html#l01580">sTlsKey</a>, and <a class="el" href="civetweb_8c_source.html#l17594">uninitialize_openssl()</a>.</p>

<p class="reference">Referenced by <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00995">run_client()</a>.</p>

</div>
</div>
<a id="ada8ae98eea53a76bee149585c48beca3" name="ada8ae98eea53a76bee149585c48beca3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada8ae98eea53a76bee149585c48beca3">&#9670;&#160;</a></span>mg_fclose()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_fclose </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__file__access.html">mg_file_access</a> *</td>          <td class="paramname"><span class="paramname"><em>fileacc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02986">2986</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2987</span>{</div>
<div class="line"><span class="lineno"> 2988</span>    <span class="keywordtype">int</span> ret = -1;</div>
<div class="line"><span class="lineno"> 2989</span>    <span class="keywordflow">if</span> (fileacc != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 2990</span>        <span class="keywordflow">if</span> (fileacc-&gt;<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 2991</span>            ret = fclose(fileacc-&gt;<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a>);</div>
<div class="line"><span class="lineno"> 2992</span>        }</div>
<div class="line"><span class="lineno"> 2993</span>        <span class="comment">/* reset all members of fileacc */</span></div>
<div class="line"><span class="lineno"> 2994</span>        memset(fileacc, 0, <span class="keyword">sizeof</span>(*fileacc));</div>
<div class="line"><span class="lineno"> 2995</span>    }</div>
<div class="line"><span class="lineno"> 2996</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno"> 2997</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l09035">is_authorized_for_put()</a>, <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>, <a class="el" href="civetweb_8c_source.html#l08893">mg_check_digest_access_authentication()</a>, <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>, <a class="el" href="civetweb_8c_source.html#l10451">mg_send_file_body()</a>, <a class="el" href="civetweb_8c_source.html#l10622">mg_store_body()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, and <a class="el" href="civetweb_8c_source.html#l08733">read_auth_file()</a>.</p>

</div>
</div>
<a id="aed4461cf7bdfb82230d646e48611be11" name="aed4461cf7bdfb82230d646e48611be11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed4461cf7bdfb82230d646e48611be11">&#9670;&#160;</a></span>mg_fgetc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_fgetc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12467">12467</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12468</span>{</div>
<div class="line"><span class="lineno">12469</span>    <span class="keywordflow">if</span> (filep == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">12470</span>        <span class="keywordflow">return</span> EOF;</div>
<div class="line"><span class="lineno">12471</span>    }</div>
<div class="line"><span class="lineno">12472</span> </div>
<div class="line"><span class="lineno">12473</span>    <span class="keywordflow">if</span> (filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">12474</span>        <span class="keywordflow">return</span> fgetc(filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a>);</div>
<div class="line"><span class="lineno">12475</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12476</span>        <span class="keywordflow">return</span> EOF;</div>
<div class="line"><span class="lineno">12477</span>    }</div>
<div class="line"><span class="lineno">12478</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12482">send_ssi_file()</a>.</p>

</div>
</div>
<a id="ad749ad33438ec816162818fd6974a433" name="ad749ad33438ec816162818fd6974a433"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad749ad33438ec816162818fd6974a433">&#9670;&#160;</a></span>mg_fgets()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * mg_fgets </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08696">8696</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8697</span>{</div>
<div class="line"><span class="lineno"> 8698</span>    <span class="keywordflow">if</span> (!filep) {</div>
<div class="line"><span class="lineno"> 8699</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 8700</span>    }</div>
<div class="line"><span class="lineno"> 8701</span> </div>
<div class="line"><span class="lineno"> 8702</span>    <span class="keywordflow">if</span> (filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8703</span>        <span class="keywordflow">return</span> fgets(buf, (<span class="keywordtype">int</span>)size, filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a>);</div>
<div class="line"><span class="lineno"> 8704</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 8705</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 8706</span>    }</div>
<div class="line"><span class="lineno"> 8707</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08733">read_auth_file()</a>.</p>

</div>
</div>
<a id="a3341033fb439f4b1566fa8bc71f28e2b" name="a3341033fb439f4b1566fa8bc71f28e2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3341033fb439f4b1566fa8bc71f28e2b">&#9670;&#160;</a></span>mg_fopen()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_fopen </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>mode</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02915">2915</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2919</span>{</div>
<div class="line"><span class="lineno"> 2920</span>    <span class="keywordtype">int</span> found;</div>
<div class="line"><span class="lineno"> 2921</span> </div>
<div class="line"><span class="lineno"> 2922</span>    <span class="keywordflow">if</span> (!filep) {</div>
<div class="line"><span class="lineno"> 2923</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2924</span>    }</div>
<div class="line"><span class="lineno"> 2925</span>    filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 2926</span> </div>
<div class="line"><span class="lineno"> 2927</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a11ef653a52d878a00eb3d51b73c966f5">mg_path_suspicious</a>(conn, path)) {</div>
<div class="line"><span class="lineno"> 2928</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2929</span>    }</div>
<div class="line"><span class="lineno"> 2930</span> </div>
<div class="line"><span class="lineno"> 2931</span>    <span class="comment">/* filep is initialized in mg_stat: all fields with memset to,</span></div>
<div class="line"><span class="lineno"> 2932</span><span class="comment">     * some fields like size and modification date with values */</span></div>
<div class="line"><span class="lineno"> 2933</span>    found = <a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path, &amp;(filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>));</div>
<div class="line"><span class="lineno"> 2934</span> </div>
<div class="line"><span class="lineno"> 2935</span>    <span class="keywordflow">if</span> ((mode == <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>) &amp;&amp; (!found)) {</div>
<div class="line"><span class="lineno"> 2936</span>        <span class="comment">/* file does not exist and will not be created */</span></div>
<div class="line"><span class="lineno"> 2937</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2938</span>    }</div>
<div class="line"><span class="lineno"> 2939</span> </div>
<div class="line"><span class="lineno"> 2940</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 2941</span>    {</div>
<div class="line"><span class="lineno"> 2942</span>        <span class="keywordtype">wchar_t</span> wbuf[UTF16_PATH_MAX];</div>
<div class="line"><span class="lineno"> 2943</span>        path_to_unicode(conn, path, wbuf, <a class="code hl_define" href="#a70c57aae3eb654e205459b4362c8089a">ARRAY_SIZE</a>(wbuf));</div>
<div class="line"><span class="lineno"> 2944</span>        <span class="keywordflow">switch</span> (mode) {</div>
<div class="line"><span class="lineno"> 2945</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>:</div>
<div class="line"><span class="lineno"> 2946</span>            filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> = _wfopen(wbuf, L<span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><span class="lineno"> 2947</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2948</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="#abb547e0027f87aeb69575479967c1f5f">MG_FOPEN_MODE_WRITE</a>:</div>
<div class="line"><span class="lineno"> 2949</span>            filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> = _wfopen(wbuf, L<span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line"><span class="lineno"> 2950</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2951</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="#a88232e9595ccceb9a04b106cc6d2739c">MG_FOPEN_MODE_APPEND</a>:</div>
<div class="line"><span class="lineno"> 2952</span>            filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> = _wfopen(wbuf, L<span class="stringliteral">&quot;ab&quot;</span>);</div>
<div class="line"><span class="lineno"> 2953</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2954</span>        }</div>
<div class="line"><span class="lineno"> 2955</span>    }</div>
<div class="line"><span class="lineno"> 2956</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 2957</span>    <span class="comment">/* Linux et al already use unicode. No need to convert. */</span></div>
<div class="line"><span class="lineno"> 2958</span>    <span class="keywordflow">switch</span> (mode) {</div>
<div class="line"><span class="lineno"> 2959</span>    <span class="keywordflow">case</span> <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>:</div>
<div class="line"><span class="lineno"> 2960</span>        filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> = fopen(path, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno"> 2961</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2962</span>    <span class="keywordflow">case</span> <a class="code hl_define" href="#abb547e0027f87aeb69575479967c1f5f">MG_FOPEN_MODE_WRITE</a>:</div>
<div class="line"><span class="lineno"> 2963</span>        filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> = fopen(path, <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><span class="lineno"> 2964</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2965</span>    <span class="keywordflow">case</span> <a class="code hl_define" href="#a88232e9595ccceb9a04b106cc6d2739c">MG_FOPEN_MODE_APPEND</a>:</div>
<div class="line"><span class="lineno"> 2966</span>        filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> = fopen(path, <span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line"><span class="lineno"> 2967</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2968</span>    }</div>
<div class="line"><span class="lineno"> 2969</span> </div>
<div class="line"><span class="lineno"> 2970</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2971</span>    <span class="keywordflow">if</span> (!found) {</div>
<div class="line"><span class="lineno"> 2972</span>        <span class="comment">/* File did not exist before fopen was called.</span></div>
<div class="line"><span class="lineno"> 2973</span><span class="comment">         * Maybe it has been created now. Get stat info</span></div>
<div class="line"><span class="lineno"> 2974</span><span class="comment">         * like creation time now. */</span></div>
<div class="line"><span class="lineno"> 2975</span>        found = <a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path, &amp;(filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>));</div>
<div class="line"><span class="lineno"> 2976</span>        (void)found;</div>
<div class="line"><span class="lineno"> 2977</span>    }</div>
<div class="line"><span class="lineno"> 2978</span> </div>
<div class="line"><span class="lineno"> 2979</span>    <span class="comment">/* return OK if file is opened */</span></div>
<div class="line"><span class="lineno"> 2980</span>    <span class="keywordflow">return</span> (filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 2981</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a11ef653a52d878a00eb3d51b73c966f5"><div class="ttname"><a href="#a11ef653a52d878a00eb3d51b73c966f5">mg_path_suspicious</a></div><div class="ttdeci">static int mg_path_suspicious(const struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02871">civetweb.c:2871</a></div></div>
<div class="ttc" id="acivetweb_8c_html_abb547e0027f87aeb69575479967c1f5f"><div class="ttname"><a href="#abb547e0027f87aeb69575479967c1f5f">MG_FOPEN_MODE_WRITE</a></div><div class="ttdeci">#define MG_FOPEN_MODE_WRITE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02846">civetweb.c:2846</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l00506">ARRAY_SIZE</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, <a class="el" href="civetweb_8c_source.html#l02849">MG_FOPEN_MODE_APPEND</a>, <a class="el" href="civetweb_8c_source.html#l02843">MG_FOPEN_MODE_READ</a>, <a class="el" href="civetweb_8c_source.html#l02846">MG_FOPEN_MODE_WRITE</a>, <a class="el" href="civetweb_8c_source.html#l02871">mg_path_suspicious()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l09035">is_authorized_for_put()</a>, <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>, <a class="el" href="civetweb_8c_source.html#l08893">mg_check_digest_access_authentication()</a>, <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>, <a class="el" href="civetweb_8c_source.html#l10451">mg_send_file_body()</a>, <a class="el" href="civetweb_8c_source.html#l10622">mg_store_body()</a>, <a class="el" href="civetweb_8c_source.html#l08472">open_auth_file()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, and <a class="el" href="civetweb_8c_source.html#l08733">read_auth_file()</a>.</p>

</div>
</div>
<a id="adc85e6b6e1bec856e91dc0346f49d9da" name="adc85e6b6e1bec856e91dc0346f49d9da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc85e6b6e1bec856e91dc0346f49d9da">&#9670;&#160;</a></span>mg_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static __inline void mg_free </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>a</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01492">1492</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1493</span>{</div>
<div class="line"><span class="lineno"> 1494</span>    <a class="code hl_define" href="#a2c6efa7679f8cd9f61af96e105017560">free</a>(<a class="code hl_class" href="classa.html">a</a>);</div>
<div class="line"><span class="lineno"> 1495</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a2c6efa7679f8cd9f61af96e105017560"><div class="ttname"><a href="#a2c6efa7679f8cd9f61af96e105017560">free</a></div><div class="ttdeci">#define free</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01542">civetweb.c:1542</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01542">free</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11552">abort_cgi_process()</a>, <a class="el" href="civetweb_8c_source.html#l06906">alloc_vprintf2()</a>, <a class="el" href="civetweb_8c_source.html#l15456">close_all_listening_sockets()</a>, <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l20249">free_context()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>, <a class="el" href="civetweb_8c_source.html#l17938">mg_close_connection()</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>, <a class="el" href="civetweb_8c_source.html#l22477">mg_exit_library()</a>, <a class="el" href="civetweb_8c_source.html#l09057">mg_modify_passwords_file_ha1()</a>, <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, <a class="el" href="civetweb_8c_source.html#l07016">mg_vprintf()</a>, <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>, <a class="el" href="civetweb_8c_source.html#l09609">print_dir_entry()</a>, <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l17676">reset_per_request_attributes()</a>, <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>, <a class="el" href="civetweb_8c_source.html#l16620">ssl_get_client_cert_info()</a>, <a class="el" href="civetweb_8c_source.html#l16321">tls_dtor()</a>, <a class="el" href="civetweb_8c_source.html#l17594">uninitialize_openssl()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a7cd400c299dd350acc398055918d75a9" name="a7cd400c299dd350acc398055918d75a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cd400c299dd350acc398055918d75a9">&#9670;&#160;</a></span>mg_get_builtin_mime_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const char * mg_get_builtin_mime_type </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08332">8332</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8333</span>{</div>
<div class="line"><span class="lineno"> 8334</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *ext;</div>
<div class="line"><span class="lineno"> 8335</span>    <span class="keywordtype">size_t</span> i, path_len;</div>
<div class="line"><span class="lineno"> 8336</span> </div>
<div class="line"><span class="lineno"> 8337</span>    path_len = strlen(path);</div>
<div class="line"><span class="lineno"> 8338</span> </div>
<div class="line"><span class="lineno"> 8339</span>    <span class="keywordflow">for</span> (i = 0; <a class="code hl_variable" href="#a76f932e4783a1729837a1ea72e730127">builtin_mime_types</a>[i].extension != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; i++) {</div>
<div class="line"><span class="lineno"> 8340</span>        ext = path + (path_len - <a class="code hl_variable" href="#a76f932e4783a1729837a1ea72e730127">builtin_mime_types</a>[i].ext_len);</div>
<div class="line"><span class="lineno"> 8341</span>        <span class="keywordflow">if</span> ((path_len &gt; <a class="code hl_variable" href="#a76f932e4783a1729837a1ea72e730127">builtin_mime_types</a>[i].<a class="code hl_variable" href="#a267ce87a2a38d9f1e99d345dbde97c28">ext_len</a>)</div>
<div class="line"><span class="lineno"> 8342</span>            &amp;&amp; (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(ext, <a class="code hl_variable" href="#a76f932e4783a1729837a1ea72e730127">builtin_mime_types</a>[i].<a class="code hl_variable" href="#a3a21b674a056eab8a11436300ae02d00">extension</a>) == 0)) {</div>
<div class="line"><span class="lineno"> 8343</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="#a76f932e4783a1729837a1ea72e730127">builtin_mime_types</a>[i].mime_type;</div>
<div class="line"><span class="lineno"> 8344</span>        }</div>
<div class="line"><span class="lineno"> 8345</span>    }</div>
<div class="line"><span class="lineno"> 8346</span> </div>
<div class="line"><span class="lineno"> 8347</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;text/plain&quot;</span>;</div>
<div class="line"><span class="lineno"> 8348</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a267ce87a2a38d9f1e99d345dbde97c28"><div class="ttname"><a href="#a267ce87a2a38d9f1e99d345dbde97c28">ext_len</a></div><div class="ttdeci">size_t ext_len</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08223">civetweb.c:8223</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a3a21b674a056eab8a11436300ae02d00"><div class="ttname"><a href="#a3a21b674a056eab8a11436300ae02d00">extension</a></div><div class="ttdeci">const char * extension</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08222">civetweb.c:8222</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a76f932e4783a1729837a1ea72e730127"><div class="ttname"><a href="#a76f932e4783a1729837a1ea72e730127">builtin_mime_types</a></div><div class="ttdeci">static const struct @5 builtin_mime_types[]</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#a76f932e4783a1729837a1ea72e730127">builtin_mime_types</a>, <a class="el" href="civetweb_8c_source.html#l08223">ext_len</a>, <a class="el" href="civetweb_8c_source.html#l08222">extension</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08354">get_mime_type()</a>.</p>

</div>
</div>
<a id="a7377f2af53b0a3e0a154a2c186f2f2d4" name="a7377f2af53b0a3e0a154a2c186f2f2d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7377f2af53b0a3e0a154a2c186f2f2d4">&#9670;&#160;</a></span>mg_get_context()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__context.html">mg_context</a> * mg_get_context </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03188">3188</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3189</span>{</div>
<div class="line"><span class="lineno"> 3190</span>    <span class="keywordflow">return</span> (conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__context.html">mg_context</a> *)<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> : (conn-&gt;phys_ctx);</div>
<div class="line"><span class="lineno"> 3191</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03202">mg_get_user_context_data()</a>.</p>

</div>
</div>
<a id="a73bb6d799210c1e057478648919f8fa8" name="a73bb6d799210c1e057478648919f8fa8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73bb6d799210c1e057478648919f8fa8">&#9670;&#160;</a></span>mg_get_context_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_get_context_info </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>buflen</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l21843">21843</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">21844</span>{</div>
<div class="line"><span class="lineno">21845</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">21846</span>    <span class="keywordtype">char</span> *end, *append_eoobj = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>[256];</div>
<div class="line"><span class="lineno">21847</span>    <span class="keywordtype">size_t</span> context_info_length = 0;</div>
<div class="line"><span class="lineno">21848</span> </div>
<div class="line"><span class="lineno">21849</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">21850</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> eol[] = <span class="stringliteral">&quot;\r\n&quot;</span>, eoobj[] = <span class="stringliteral">&quot;\r\n}\r\n&quot;</span>;</div>
<div class="line"><span class="lineno">21851</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">21852</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> eol[] = <span class="stringliteral">&quot;\n&quot;</span>, eoobj[] = <span class="stringliteral">&quot;\n}\n&quot;</span>;</div>
<div class="line"><span class="lineno">21853</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21854</span>    <span class="keyword">struct </span>mg_memory_stat *ms = get_memory_stat((<span class="keyword">struct</span> <a class="code hl_struct" href="structmg__context.html">mg_context</a> *)ctx);</div>
<div class="line"><span class="lineno">21855</span> </div>
<div class="line"><span class="lineno">21856</span>    <span class="keywordflow">if</span> ((buffer == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (buflen &lt; 1)) {</div>
<div class="line"><span class="lineno">21857</span>        buflen = 0;</div>
<div class="line"><span class="lineno">21858</span>        end = buffer;</div>
<div class="line"><span class="lineno">21859</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">21860</span>        *buffer = 0;</div>
<div class="line"><span class="lineno">21861</span>        end = buffer + buflen;</div>
<div class="line"><span class="lineno">21862</span>    }</div>
<div class="line"><span class="lineno">21863</span>    <span class="keywordflow">if</span> (buflen &gt; (<span class="keywordtype">int</span>)(<span class="keyword">sizeof</span>(eoobj) - 1)) {</div>
<div class="line"><span class="lineno">21864</span>        <span class="comment">/* has enough space to append eoobj */</span></div>
<div class="line"><span class="lineno">21865</span>        append_eoobj = buffer;</div>
<div class="line"><span class="lineno">21866</span>        end -= <span class="keyword">sizeof</span>(eoobj) - 1;</div>
<div class="line"><span class="lineno">21867</span>    }</div>
<div class="line"><span class="lineno">21868</span> </div>
<div class="line"><span class="lineno">21869</span>    context_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <span class="stringliteral">&quot;{&quot;</span>);</div>
<div class="line"><span class="lineno">21870</span> </div>
<div class="line"><span class="lineno">21871</span>    <span class="keywordflow">if</span> (ms) { <span class="comment">/* &lt;-- should be always true */</span></div>
<div class="line"><span class="lineno">21872</span>              <span class="comment">/* Memory information */</span></div>
<div class="line"><span class="lineno">21873</span>        <span class="keywordtype">int</span> blockCount = (int)ms-&gt;blockCount;</div>
<div class="line"><span class="lineno">21874</span>        int64_t totalMemUsed = ms-&gt;totalMemUsed;</div>
<div class="line"><span class="lineno">21875</span>        int64_t maxMemUsed = ms-&gt;maxMemUsed;</div>
<div class="line"><span class="lineno">21876</span>        <span class="keywordflow">if</span> (totalMemUsed &gt; maxMemUsed) {</div>
<div class="line"><span class="lineno">21877</span>            maxMemUsed = totalMemUsed;</div>
<div class="line"><span class="lineno">21878</span>        }</div>
<div class="line"><span class="lineno">21879</span> </div>
<div class="line"><span class="lineno">21880</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21881</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21882</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21883</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21884</span>                    <span class="stringliteral">&quot;%s\&quot;memory\&quot; : {%s&quot;</span></div>
<div class="line"><span class="lineno">21885</span>                    <span class="stringliteral">&quot;\&quot;blocks\&quot; : %i,%s&quot;</span></div>
<div class="line"><span class="lineno">21886</span>                    <span class="stringliteral">&quot;\&quot;used\&quot; : %&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a> <span class="stringliteral">&quot;,%s&quot;</span></div>
<div class="line"><span class="lineno">21887</span>                    <span class="stringliteral">&quot;\&quot;maxUsed\&quot; : %&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a> <span class="stringliteral">&quot;%s&quot;</span></div>
<div class="line"><span class="lineno">21888</span>                    <span class="stringliteral">&quot;}&quot;</span>,</div>
<div class="line"><span class="lineno">21889</span>                    eol,</div>
<div class="line"><span class="lineno">21890</span>                    eol,</div>
<div class="line"><span class="lineno">21891</span>                    blockCount,</div>
<div class="line"><span class="lineno">21892</span>                    eol,</div>
<div class="line"><span class="lineno">21893</span>                    totalMemUsed,</div>
<div class="line"><span class="lineno">21894</span>                    eol,</div>
<div class="line"><span class="lineno">21895</span>                    maxMemUsed,</div>
<div class="line"><span class="lineno">21896</span>                    eol);</div>
<div class="line"><span class="lineno">21897</span>        context_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21898</span>    }</div>
<div class="line"><span class="lineno">21899</span> </div>
<div class="line"><span class="lineno">21900</span>    <span class="keywordflow">if</span> (ctx) {</div>
<div class="line"><span class="lineno">21901</span>        <span class="comment">/* Declare all variables at begin of the block, to comply</span></div>
<div class="line"><span class="lineno">21902</span><span class="comment">         * with old C standards. */</span></div>
<div class="line"><span class="lineno">21903</span>        <span class="keywordtype">char</span> start_time_str[64] = {0};</div>
<div class="line"><span class="lineno">21904</span>        <span class="keywordtype">char</span> now_str[64] = {0};</div>
<div class="line"><span class="lineno">21905</span>        time_t start_time = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a0084702a827547767b25513d4400ce46">start_time</a>;</div>
<div class="line"><span class="lineno">21906</span>        time_t now = time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">21907</span>        int64_t total_data_read, total_data_written;</div>
<div class="line"><span class="lineno">21908</span>        <span class="keywordtype">int</span> active_connections = (int)ctx-&gt;active_connections;</div>
<div class="line"><span class="lineno">21909</span>        <span class="keywordtype">int</span> max_active_connections = (int)ctx-&gt;max_active_connections;</div>
<div class="line"><span class="lineno">21910</span>        <span class="keywordtype">int</span> total_connections = (int)ctx-&gt;total_connections;</div>
<div class="line"><span class="lineno">21911</span>        <span class="keywordflow">if</span> (active_connections &gt; max_active_connections) {</div>
<div class="line"><span class="lineno">21912</span>            max_active_connections = active_connections;</div>
<div class="line"><span class="lineno">21913</span>        }</div>
<div class="line"><span class="lineno">21914</span>        <span class="keywordflow">if</span> (active_connections &gt; total_connections) {</div>
<div class="line"><span class="lineno">21915</span>            total_connections = active_connections;</div>
<div class="line"><span class="lineno">21916</span>        }</div>
<div class="line"><span class="lineno">21917</span> </div>
<div class="line"><span class="lineno">21918</span>        <span class="comment">/* Connections information */</span></div>
<div class="line"><span class="lineno">21919</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21920</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21921</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21922</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21923</span>                    <span class="stringliteral">&quot;,%s\&quot;connections\&quot; : {%s&quot;</span></div>
<div class="line"><span class="lineno">21924</span>                    <span class="stringliteral">&quot;\&quot;active\&quot; : %i,%s&quot;</span></div>
<div class="line"><span class="lineno">21925</span>                    <span class="stringliteral">&quot;\&quot;maxActive\&quot; : %i,%s&quot;</span></div>
<div class="line"><span class="lineno">21926</span>                    <span class="stringliteral">&quot;\&quot;total\&quot; : %i%s&quot;</span></div>
<div class="line"><span class="lineno">21927</span>                    <span class="stringliteral">&quot;}&quot;</span>,</div>
<div class="line"><span class="lineno">21928</span>                    eol,</div>
<div class="line"><span class="lineno">21929</span>                    eol,</div>
<div class="line"><span class="lineno">21930</span>                    active_connections,</div>
<div class="line"><span class="lineno">21931</span>                    eol,</div>
<div class="line"><span class="lineno">21932</span>                    max_active_connections,</div>
<div class="line"><span class="lineno">21933</span>                    eol,</div>
<div class="line"><span class="lineno">21934</span>                    total_connections,</div>
<div class="line"><span class="lineno">21935</span>                    eol);</div>
<div class="line"><span class="lineno">21936</span>        context_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21937</span> </div>
<div class="line"><span class="lineno">21938</span>        <span class="comment">/* Queue information */</span></div>
<div class="line"><span class="lineno">21939</span><span class="preprocessor">#if !defined(ALTERNATIVE_QUEUE)</span></div>
<div class="line"><span class="lineno">21940</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21941</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21942</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21943</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21944</span>                    <span class="stringliteral">&quot;,%s\&quot;queue\&quot; : {%s&quot;</span></div>
<div class="line"><span class="lineno">21945</span>                    <span class="stringliteral">&quot;\&quot;length\&quot; : %i,%s&quot;</span></div>
<div class="line"><span class="lineno">21946</span>                    <span class="stringliteral">&quot;\&quot;filled\&quot; : %i,%s&quot;</span></div>
<div class="line"><span class="lineno">21947</span>                    <span class="stringliteral">&quot;\&quot;maxFilled\&quot; : %i,%s&quot;</span></div>
<div class="line"><span class="lineno">21948</span>                    <span class="stringliteral">&quot;\&quot;full\&quot; : %s%s&quot;</span></div>
<div class="line"><span class="lineno">21949</span>                    <span class="stringliteral">&quot;}&quot;</span>,</div>
<div class="line"><span class="lineno">21950</span>                    eol,</div>
<div class="line"><span class="lineno">21951</span>                    eol,</div>
<div class="line"><span class="lineno">21952</span>                    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ae906ea24151aba96333859c9b759ccc1">sq_size</a>,</div>
<div class="line"><span class="lineno">21953</span>                    eol,</div>
<div class="line"><span class="lineno">21954</span>                    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a6df1d217787a1f213ddb9873f545d23f">sq_head</a> - ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">sq_tail</a>,</div>
<div class="line"><span class="lineno">21955</span>                    eol,</div>
<div class="line"><span class="lineno">21956</span>                    ctx-&gt;sq_max_fill,</div>
<div class="line"><span class="lineno">21957</span>                    eol,</div>
<div class="line"><span class="lineno">21958</span>                    (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#affbc1f904d30b616b26c9e9261ca4959">sq_blocked</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>),</div>
<div class="line"><span class="lineno">21959</span>                    eol);</div>
<div class="line"><span class="lineno">21960</span>        context_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21961</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21962</span> </div>
<div class="line"><span class="lineno">21963</span>        <span class="comment">/* Requests information */</span></div>
<div class="line"><span class="lineno">21964</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21965</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21966</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21967</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21968</span>                    <span class="stringliteral">&quot;,%s\&quot;requests\&quot; : {%s&quot;</span></div>
<div class="line"><span class="lineno">21969</span>                    <span class="stringliteral">&quot;\&quot;total\&quot; : %lu%s&quot;</span></div>
<div class="line"><span class="lineno">21970</span>                    <span class="stringliteral">&quot;}&quot;</span>,</div>
<div class="line"><span class="lineno">21971</span>                    eol,</div>
<div class="line"><span class="lineno">21972</span>                    eol,</div>
<div class="line"><span class="lineno">21973</span>                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)ctx-&gt;total_requests,</div>
<div class="line"><span class="lineno">21974</span>                    eol);</div>
<div class="line"><span class="lineno">21975</span>        context_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21976</span> </div>
<div class="line"><span class="lineno">21977</span>        <span class="comment">/* Data information */</span></div>
<div class="line"><span class="lineno">21978</span>        total_data_read =</div>
<div class="line"><span class="lineno">21979</span>            mg_atomic_add64((<span class="keyword">volatile</span> int64_t *)&amp;ctx-&gt;total_data_read, 0);</div>
<div class="line"><span class="lineno">21980</span>        total_data_written =</div>
<div class="line"><span class="lineno">21981</span>            mg_atomic_add64((<span class="keyword">volatile</span> int64_t *)&amp;ctx-&gt;total_data_written, 0);</div>
<div class="line"><span class="lineno">21982</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21983</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21984</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21985</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21986</span>                    <span class="stringliteral">&quot;,%s\&quot;data\&quot; : {%s&quot;</span></div>
<div class="line"><span class="lineno">21987</span>                    <span class="stringliteral">&quot;\&quot;read\&quot; : %&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a> <span class="stringliteral">&quot;,%s&quot;</span></div>
<div class="line"><span class="lineno">21988</span>                    <span class="stringliteral">&quot;\&quot;written\&quot; : %&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a> <span class="stringliteral">&quot;%s&quot;</span></div>
<div class="line"><span class="lineno">21989</span>                    <span class="stringliteral">&quot;}&quot;</span>,</div>
<div class="line"><span class="lineno">21990</span>                    eol,</div>
<div class="line"><span class="lineno">21991</span>                    eol,</div>
<div class="line"><span class="lineno">21992</span>                    total_data_read,</div>
<div class="line"><span class="lineno">21993</span>                    eol,</div>
<div class="line"><span class="lineno">21994</span>                    total_data_written,</div>
<div class="line"><span class="lineno">21995</span>                    eol);</div>
<div class="line"><span class="lineno">21996</span>        context_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21997</span> </div>
<div class="line"><span class="lineno">21998</span>        <span class="comment">/* Execution time information */</span></div>
<div class="line"><span class="lineno">21999</span>        <a class="code hl_function" href="#a7ef6ebce89c81f7218a0968e3aa9107f">gmt_time_string</a>(start_time_str,</div>
<div class="line"><span class="lineno">22000</span>                        <span class="keyword">sizeof</span>(start_time_str) - 1,</div>
<div class="line"><span class="lineno">22001</span>                        &amp;start_time);</div>
<div class="line"><span class="lineno">22002</span>        <a class="code hl_function" href="#a7ef6ebce89c81f7218a0968e3aa9107f">gmt_time_string</a>(now_str, <span class="keyword">sizeof</span>(now_str) - 1, &amp;now);</div>
<div class="line"><span class="lineno">22003</span> </div>
<div class="line"><span class="lineno">22004</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">22005</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">22006</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">22007</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">22008</span>                    <span class="stringliteral">&quot;,%s\&quot;time\&quot; : {%s&quot;</span></div>
<div class="line"><span class="lineno">22009</span>                    <span class="stringliteral">&quot;\&quot;uptime\&quot; : %.0f,%s&quot;</span></div>
<div class="line"><span class="lineno">22010</span>                    <span class="stringliteral">&quot;\&quot;start\&quot; : \&quot;%s\&quot;,%s&quot;</span></div>
<div class="line"><span class="lineno">22011</span>                    <span class="stringliteral">&quot;\&quot;now\&quot; : \&quot;%s\&quot;%s&quot;</span></div>
<div class="line"><span class="lineno">22012</span>                    <span class="stringliteral">&quot;}&quot;</span>,</div>
<div class="line"><span class="lineno">22013</span>                    eol,</div>
<div class="line"><span class="lineno">22014</span>                    eol,</div>
<div class="line"><span class="lineno">22015</span>                    difftime(now, start_time),</div>
<div class="line"><span class="lineno">22016</span>                    eol,</div>
<div class="line"><span class="lineno">22017</span>                    start_time_str,</div>
<div class="line"><span class="lineno">22018</span>                    eol,</div>
<div class="line"><span class="lineno">22019</span>                    now_str,</div>
<div class="line"><span class="lineno">22020</span>                    eol);</div>
<div class="line"><span class="lineno">22021</span>        context_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">22022</span>    }</div>
<div class="line"><span class="lineno">22023</span> </div>
<div class="line"><span class="lineno">22024</span>    <span class="comment">/* Terminate string */</span></div>
<div class="line"><span class="lineno">22025</span>    <span class="keywordflow">if</span> (append_eoobj) {</div>
<div class="line"><span class="lineno">22026</span>        strcat(append_eoobj, eoobj);</div>
<div class="line"><span class="lineno">22027</span>    }</div>
<div class="line"><span class="lineno">22028</span>    context_info_length += <span class="keyword">sizeof</span>(eoobj) - 1;</div>
<div class="line"><span class="lineno">22029</span> </div>
<div class="line"><span class="lineno">22030</span>    <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)context_info_length;</div>
<div class="line"><span class="lineno">22031</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">22032</span>    (void)ctx;</div>
<div class="line"><span class="lineno">22033</span>    <span class="keywordflow">if</span> ((buffer != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (buflen &gt; 0)) {</div>
<div class="line"><span class="lineno">22034</span>        *buffer = 0;</div>
<div class="line"><span class="lineno">22035</span>    }</div>
<div class="line"><span class="lineno">22036</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">22037</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">22038</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a56edd9d2b1961442b88fb2e0419cdac8"><div class="ttname"><a href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a></div><div class="ttdeci">static size_t mg_str_append(char **dst, char *end, const char *src)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l21493">civetweb.c:21493</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lparser_8c_html_a235428bed4c6be6cb6d2760cd0fa9d34"><div class="ttname"><a href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a></div><div class="ttdeci">static void block(LexState *ls)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lparser_8c_source.html#l00881">lua-5.1.5/src/lparser.c:881</a></div></div>
<div class="ttc" id="astructmg__context_html_affbc1f904d30b616b26c9e9261ca4959"><div class="ttname"><a href="structmg__context.html#affbc1f904d30b616b26c9e9261ca4959">mg_context::sq_blocked</a></div><div class="ttdeci">volatile int sq_blocked</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02393">civetweb.c:2393</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lua-5_81_85_2src_2lparser_8c_source.html#l00881">block()</a>, <a class="el" href="civetweb_8c_source.html#l03341">gmt_time_string()</a>, <a class="el" href="civetweb_8c_source.html#l00926">INT64_FMT</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l21493">mg_str_append()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02393">mg_context::sq_blocked</a>, <a class="el" href="civetweb_8c_source.html#l02389">mg_context::sq_head</a>, <a class="el" href="civetweb_8c_source.html#l02394">mg_context::sq_size</a>, <a class="el" href="civetweb_8c_source.html#l02390">mg_context::sq_tail</a>, and <a class="el" href="civetweb_8c_source.html#l02412">mg_context::start_time</a>.</p>

</div>
</div>
<a id="a46916a747f8cbeca1ecd94007496f5c8" name="a46916a747f8cbeca1ecd94007496f5c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46916a747f8cbeca1ecd94007496f5c8">&#9670;&#160;</a></span>mg_get_cookie()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_get_cookie </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>cookie_header</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>var_name</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>dst</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>dst_size</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07256">7256</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7260</span>{</div>
<div class="line"><span class="lineno"> 7261</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, *p, *end;</div>
<div class="line"><span class="lineno"> 7262</span>    <span class="keywordtype">int</span> name_len, len = -1;</div>
<div class="line"><span class="lineno"> 7263</span> </div>
<div class="line"><span class="lineno"> 7264</span>    <span class="keywordflow">if</span> ((dst == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (dst_size == 0)) {</div>
<div class="line"><span class="lineno"> 7265</span>        <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 7266</span>    }</div>
<div class="line"><span class="lineno"> 7267</span> </div>
<div class="line"><span class="lineno"> 7268</span>    dst[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 7269</span>    <span class="keywordflow">if</span> ((var_name == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = cookie_header) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 7270</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 7271</span>    }</div>
<div class="line"><span class="lineno"> 7272</span> </div>
<div class="line"><span class="lineno"> 7273</span>    name_len = (int)strlen(var_name);</div>
<div class="line"><span class="lineno"> 7274</span>    end = <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> + strlen(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno"> 7275</span>    <span class="keywordflow">for</span> (; (<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = <a class="code hl_function" href="#a804c91443edc3fa4d74cfe88b1dd3ac8">mg_strcasestr</a>(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, var_name)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> += name_len) {</div>
<div class="line"><span class="lineno"> 7276</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>[name_len] == <span class="charliteral">&#39;=&#39;</span>) {</div>
<div class="line"><span class="lineno"> 7277</span>            <span class="comment">/* HCP24: now check is it a substring or a full cookie name */</span></div>
<div class="line"><span class="lineno"> 7278</span>            <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> == cookie_header) || (<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>[-1] == <span class="charliteral">&#39; &#39;</span>)) {</div>
<div class="line"><span class="lineno"> 7279</span>                <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> += name_len + 1;</div>
<div class="line"><span class="lineno"> 7280</span>                <span class="keywordflow">if</span> ((p = strchr(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="charliteral">&#39; &#39;</span>)) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7281</span>                    p = end;</div>
<div class="line"><span class="lineno"> 7282</span>                }</div>
<div class="line"><span class="lineno"> 7283</span>                <span class="keywordflow">if</span> (p[-1] == <span class="charliteral">&#39;;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 7284</span>                    p--;</div>
<div class="line"><span class="lineno"> 7285</span>                }</div>
<div class="line"><span class="lineno"> 7286</span>                <span class="keywordflow">if</span> ((*<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> == <span class="charliteral">&#39;&quot;&#39;</span>) &amp;&amp; (p[-1] == <span class="charliteral">&#39;&quot;&#39;</span>) &amp;&amp; (p &gt; <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> + 1)) {</div>
<div class="line"><span class="lineno"> 7287</span>                    <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>++;</div>
<div class="line"><span class="lineno"> 7288</span>                    p--;</div>
<div class="line"><span class="lineno"> 7289</span>                }</div>
<div class="line"><span class="lineno"> 7290</span>                <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)(p - <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>) &lt; dst_size) {</div>
<div class="line"><span class="lineno"> 7291</span>                    len = (int)(p - <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno"> 7292</span>                    <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(dst, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, (<span class="keywordtype">size_t</span>)len + 1);</div>
<div class="line"><span class="lineno"> 7293</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 7294</span>                    len = -3;</div>
<div class="line"><span class="lineno"> 7295</span>                }</div>
<div class="line"><span class="lineno"> 7296</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 7297</span>            }</div>
<div class="line"><span class="lineno"> 7298</span>        }</div>
<div class="line"><span class="lineno"> 7299</span>    }</div>
<div class="line"><span class="lineno"> 7300</span>    <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno"> 7301</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a804c91443edc3fa4d74cfe88b1dd3ac8"><div class="ttname"><a href="#a804c91443edc3fa4d74cfe88b1dd3ac8">mg_strcasestr</a></div><div class="ttdeci">static const char * mg_strcasestr(const char *big_str, const char *small_str)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03075">civetweb.c:3075</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03075">mg_strcasestr()</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="multi_8h_source.html#l00318">s</a>.</p>

</div>
</div>
<a id="a2040e14dfbc73e3fad6b7971613243ea" name="a2040e14dfbc73e3fad6b7971613243ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2040e14dfbc73e3fad6b7971613243ea">&#9670;&#160;</a></span>mg_get_current_time_ns()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> uint64_t mg_get_current_time_ns </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01676">1676</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1677</span>{</div>
<div class="line"><span class="lineno"> 1678</span>    <span class="keyword">struct </span>timespec tsnow;</div>
<div class="line"><span class="lineno"> 1679</span>    clock_gettime(CLOCK_REALTIME, &amp;tsnow);</div>
<div class="line"><span class="lineno"> 1680</span>    <span class="keywordflow">return</span> (((uint64_t)tsnow.tv_sec) * 1000000000) + (uint64_t)tsnow.tv_nsec;</div>
<div class="line"><span class="lineno"> 1681</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l05909">get_random()</a>, <a class="el" href="civetweb_8c_source.html#l06439">pull_all()</a>, and <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>.</p>

</div>
</div>
<a id="a2565ee5d9358284c1312e957271fccfb" name="a2565ee5d9358284c1312e957271fccfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2565ee5d9358284c1312e957271fccfb">&#9670;&#160;</a></span>mg_get_header()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const char * mg_get_header </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03855">3855</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3856</span>{</div>
<div class="line"><span class="lineno"> 3857</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno"> 3858</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3859</span>    }</div>
<div class="line"><span class="lineno"> 3860</span> </div>
<div class="line"><span class="lineno"> 3861</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> == <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a>) {</div>
<div class="line"><span class="lineno"> 3862</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>,</div>
<div class="line"><span class="lineno"> 3863</span>                          conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a>,</div>
<div class="line"><span class="lineno"> 3864</span>                          <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno"> 3865</span>    }</div>
<div class="line"><span class="lineno"> 3866</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> == <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411">CONNECTION_TYPE_RESPONSE</a>) {</div>
<div class="line"><span class="lineno"> 3867</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="#a67c4b5d95b3233717b80963b979724da">get_header</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#af6cc6e0a5264c89cfd54e84461a462c8">http_headers</a>,</div>
<div class="line"><span class="lineno"> 3868</span>                          conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a3becae78e0589983f147dbfd19ae33dc">num_headers</a>,</div>
<div class="line"><span class="lineno"> 3869</span>                          <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno"> 3870</span>    }</div>
<div class="line"><span class="lineno"> 3871</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3872</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02486">mg_connection::connection_type</a>, <a class="el" href="civetweb_8c_source.html#l02461">CONNECTION_TYPE_REQUEST</a>, <a class="el" href="civetweb_8c_source.html#l02462">CONNECTION_TYPE_RESPONSE</a>, <a class="el" href="civetweb_8c_source.html#l03820">get_header()</a>, <a class="el" href="civetweb_8h_source.html#l00179">mg_request_info::http_headers</a>, <a class="el" href="civetweb_8h_source.html#l00200">mg_response_info::http_headers</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00178">mg_request_info::num_headers</a>, <a class="el" href="civetweb_8h_source.html#l00199">mg_response_info::num_headers</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, and <a class="el" href="civetweb_8c_source.html#l02495">mg_connection::response_info</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l11184">forward_body_data()</a>, <a class="el" href="civetweb_8c_source.html#l12759">handle_propfind()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l16046">header_val()</a>, <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>, <a class="el" href="civetweb_8c_source.html#l10468">is_not_modified()</a>, <a class="el" href="civetweb_8c_source.html#l08555">parse_auth_header()</a>, <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, <a class="el" href="civetweb_8c_source.html#l04149">send_cors_header()</a>, <a class="el" href="civetweb_8c_source.html#l03984">should_keep_alive()</a>, and <a class="el" href="civetweb_8c_source.html#l13912">should_switch_to_protocol()</a>.</p>

</div>
</div>
<a id="a9e4552bbdf9a0c9a6a579ed38e813a4e" name="a9e4552bbdf9a0c9a6a579ed38e813a4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e4552bbdf9a0c9a6a579ed38e813a4e">&#9670;&#160;</a></span>mg_get_option()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const char * mg_get_option </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03173">3173</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3174</span>{</div>
<div class="line"><span class="lineno"> 3175</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno"> 3176</span>    <span class="keywordflow">if</span> ((i = <a class="code hl_function" href="#a4d2d84ca4d747d172e74257a176d216d">get_option_index</a>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)) == -1) {</div>
<div class="line"><span class="lineno"> 3177</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3178</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!ctx || ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[i] == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3179</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno"> 3180</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3181</span>        <span class="keywordflow">return</span> ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[i];</div>
<div class="line"><span class="lineno"> 3182</span>    }</div>
<div class="line"><span class="lineno"> 3183</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a4d2d84ca4d747d172e74257a176d216d"><div class="ttname"><a href="#a4d2d84ca4d747d172e74257a176d216d">get_option_index</a></div><div class="ttdeci">static int get_option_index(const char *name)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03159">civetweb.c:3159</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l03159">get_option_index()</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

</div>
</div>
<a id="a882484e3a6894f40748e04fa78e52903" name="a882484e3a6894f40748e04fa78e52903"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a882484e3a6894f40748e04fa78e52903">&#9670;&#160;</a></span>mg_get_request_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const struct <a class="el" href="structmg__request__info.html">mg_request_info</a> * mg_get_request_info </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03521">3521</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3522</span>{</div>
<div class="line"><span class="lineno"> 3523</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno"> 3524</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3525</span>    }</div>
<div class="line"><span class="lineno"> 3526</span><span class="preprocessor">#if defined(MG_ALLOW_USING_GET_REQUEST_INFO_FOR_RESPONSE)</span></div>
<div class="line"><span class="lineno"> 3527</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> == <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411">CONNECTION_TYPE_RESPONSE</a>) {</div>
<div class="line"><span class="lineno"> 3528</span>        <span class="keywordtype">char</span> txt[16];</div>
<div class="line"><span class="lineno"> 3529</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> *tls =</div>
<div class="line"><span class="lineno"> 3530</span>            (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> *)pthread_getspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>);</div>
<div class="line"><span class="lineno"> 3531</span> </div>
<div class="line"><span class="lineno"> 3532</span>        sprintf(txt, <span class="stringliteral">&quot;%03i&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">status_code</a>);</div>
<div class="line"><span class="lineno"> 3533</span>        <span class="keywordflow">if</span> (strlen(txt) == 3) {</div>
<div class="line"><span class="lineno"> 3534</span>            memcpy(tls-&gt;txtbuf, txt, 4);</div>
<div class="line"><span class="lineno"> 3535</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3536</span>            strcpy(tls-&gt;txtbuf, <span class="stringliteral">&quot;ERR&quot;</span>);</div>
<div class="line"><span class="lineno"> 3537</span>        }</div>
<div class="line"><span class="lineno"> 3538</span> </div>
<div class="line"><span class="lineno"> 3539</span>        ((<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)conn)-&gt;request_info.local_uri =</div>
<div class="line"><span class="lineno"> 3540</span>            tls-&gt;txtbuf; <span class="comment">/* use thread safe buffer */</span></div>
<div class="line"><span class="lineno"> 3541</span>        ((<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)conn)-&gt;request_info.local_uri_raw =</div>
<div class="line"><span class="lineno"> 3542</span>            tls-&gt;txtbuf; <span class="comment">/* use the same thread safe buffer */</span></div>
<div class="line"><span class="lineno"> 3543</span>        ((<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)conn)-&gt;request_info.request_uri =</div>
<div class="line"><span class="lineno"> 3544</span>            tls-&gt;txtbuf; <span class="comment">/* use  the same thread safe buffer */</span></div>
<div class="line"><span class="lineno"> 3545</span> </div>
<div class="line"><span class="lineno"> 3546</span>        ((<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)conn)-&gt;request_info.num_headers =</div>
<div class="line"><span class="lineno"> 3547</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a3becae78e0589983f147dbfd19ae33dc">num_headers</a>;</div>
<div class="line"><span class="lineno"> 3548</span>        memcpy(((<span class="keyword">struct</span> <a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)conn)-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>,</div>
<div class="line"><span class="lineno"> 3549</span>               conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#af6cc6e0a5264c89cfd54e84461a462c8">http_headers</a>,</div>
<div class="line"><span class="lineno"> 3550</span>               <span class="keyword">sizeof</span>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#af6cc6e0a5264c89cfd54e84461a462c8">http_headers</a>));</div>
<div class="line"><span class="lineno"> 3551</span>    } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 3552</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3553</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> != <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a>) {</div>
<div class="line"><span class="lineno"> 3554</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3555</span>    }</div>
<div class="line"><span class="lineno"> 3556</span>    <span class="keywordflow">return</span> &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>;</div>
<div class="line"><span class="lineno"> 3557</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02486">mg_connection::connection_type</a>, <a class="el" href="civetweb_8c_source.html#l02461">CONNECTION_TYPE_REQUEST</a>, <a class="el" href="civetweb_8c_source.html#l02462">CONNECTION_TYPE_RESPONSE</a>, <a class="el" href="civetweb_8h_source.html#l00179">mg_request_info::http_headers</a>, <a class="el" href="civetweb_8h_source.html#l00200">mg_response_info::http_headers</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00199">mg_response_info::num_headers</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l02495">mg_connection::response_info</a>, <a class="el" href="civetweb_8h_source.html#l00192">mg_response_info::status_code</a>, and <a class="el" href="civetweb_8c_source.html#l01580">sTlsKey</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14560">get_request_handler()</a>, and <a class="el" href="server_8c_source.html#l00026">user_handler()</a>.</p>

</div>
</div>
<a id="a81ef64a9ffadd917ddc7f4615cf5dc07" name="a81ef64a9ffadd917ddc7f4615cf5dc07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81ef64a9ffadd917ddc7f4615cf5dc07">&#9670;&#160;</a></span>mg_get_request_link()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_get_request_link </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>buflen</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03745">3745</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3746</span>{</div>
<div class="line"><span class="lineno"> 3747</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#acb99501ab73e2f08414accf1a7d108c1">mg_construct_local_link</a>(conn, buf, buflen, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -1, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 3748</span>}</div>
<div class="ttc" id="acivetweb_8c_html_acb99501ab73e2f08414accf1a7d108c1"><div class="ttname"><a href="#acb99501ab73e2f08414accf1a7d108c1">mg_construct_local_link</a></div><div class="ttdeci">static int mg_construct_local_link(const struct mg_connection *conn, char *buf, size_t buflen, const char *define_proto, int define_port, const char *define_uri)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03601">civetweb.c:3601</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l12964">dav_proppatch()</a>, <a class="el" href="civetweb_8c_source.html#l12931">dav_unlock_file()</a>, and <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a6b725ab96450f33c87ab3ef5e7e8baab" name="a6b725ab96450f33c87ab3ef5e7e8baab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b725ab96450f33c87ab3ef5e7e8baab">&#9670;&#160;</a></span>mg_get_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_get_response </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>ebuf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>ebuf_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>timeout</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18822">18822</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">18826</span>{</div>
<div class="line"><span class="lineno">18827</span>    <span class="keywordtype">int</span> err, ret;</div>
<div class="line"><span class="lineno">18828</span>    <span class="keywordtype">char</span> txt[32]; <span class="comment">/* will not overflow */</span></div>
<div class="line"><span class="lineno">18829</span>    <span class="keywordtype">char</span> *save_timeout;</div>
<div class="line"><span class="lineno">18830</span>    <span class="keywordtype">char</span> *new_timeout;</div>
<div class="line"><span class="lineno">18831</span> </div>
<div class="line"><span class="lineno">18832</span>    <span class="keywordflow">if</span> (ebuf_len &gt; 0) {</div>
<div class="line"><span class="lineno">18833</span>        ebuf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">18834</span>    }</div>
<div class="line"><span class="lineno">18835</span> </div>
<div class="line"><span class="lineno">18836</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno">18837</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">18838</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">18839</span>                    ebuf,</div>
<div class="line"><span class="lineno">18840</span>                    ebuf_len,</div>
<div class="line"><span class="lineno">18841</span>                    <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">18842</span>                    <span class="stringliteral">&quot;Parameter error&quot;</span>);</div>
<div class="line"><span class="lineno">18843</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">18844</span>    }</div>
<div class="line"><span class="lineno">18845</span> </div>
<div class="line"><span class="lineno">18846</span>    <span class="comment">/* Reset the previous responses */</span></div>
<div class="line"><span class="lineno">18847</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> = 0;</div>
<div class="line"><span class="lineno">18848</span> </div>
<div class="line"><span class="lineno">18849</span>    <span class="comment">/* Implementation of API function for HTTP clients */</span></div>
<div class="line"><span class="lineno">18850</span>    save_timeout = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>];</div>
<div class="line"><span class="lineno">18851</span> </div>
<div class="line"><span class="lineno">18852</span>    <span class="keywordflow">if</span> (timeout &gt;= 0) {</div>
<div class="line"><span class="lineno">18853</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, txt, <span class="keyword">sizeof</span>(txt), <span class="stringliteral">&quot;%i&quot;</span>, timeout);</div>
<div class="line"><span class="lineno">18854</span>        new_timeout = txt;</div>
<div class="line"><span class="lineno">18855</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">18856</span>        new_timeout = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">18857</span>    }</div>
<div class="line"><span class="lineno">18858</span> </div>
<div class="line"><span class="lineno">18859</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>] = new_timeout;</div>
<div class="line"><span class="lineno">18860</span>    ret = <a class="code hl_function" href="#a453db96888b9c0e4b7afd85f3778afb2">get_response</a>(conn, ebuf, ebuf_len, &amp;err);</div>
<div class="line"><span class="lineno">18861</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>] = save_timeout;</div>
<div class="line"><span class="lineno">18862</span> </div>
<div class="line"><span class="lineno">18863</span>    <span class="comment">/* TODO: here, the URI is the http response code */</span></div>
<div class="line"><span class="lineno">18864</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a>;</div>
<div class="line"><span class="lineno">18865</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a>;</div>
<div class="line"><span class="lineno">18866</span> </div>
<div class="line"><span class="lineno">18867</span>    <span class="comment">/* TODO (mid): Define proper return values - maybe return length?</span></div>
<div class="line"><span class="lineno">18868</span><span class="comment">     * For the first test use &lt;0 for error and &gt;0 for OK */</span></div>
<div class="line"><span class="lineno">18869</span>    <span class="keywordflow">return</span> (ret == 0) ? -1 : +1;</div>
<div class="line"><span class="lineno">18870</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02558">mg_connection::data_len</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l18737">get_response()</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8h_source.html#l00154">mg_request_info::local_uri_raw</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l01937">REQUEST_TIMEOUT</a>, and <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>.</p>

<p class="reference">Referenced by <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00995">run_client()</a>.</p>

</div>
</div>
<a id="a08ef1e77e39a65d2b0eb84328291cae1" name="a08ef1e77e39a65d2b0eb84328291cae1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08ef1e77e39a65d2b0eb84328291cae1">&#9670;&#160;</a></span>mg_get_response_code_text()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const char * mg_get_response_code_text </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>response_code</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04176">4176</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4177</span>{</div>
<div class="line"><span class="lineno"> 4178</span>    <span class="comment">/* See IANA HTTP status code assignment:</span></div>
<div class="line"><span class="lineno"> 4179</span><span class="comment">     * http://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml</span></div>
<div class="line"><span class="lineno"> 4180</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 4181</span> </div>
<div class="line"><span class="lineno"> 4182</span>    <span class="keywordflow">switch</span> (response_code) {</div>
<div class="line"><span class="lineno"> 4183</span>        <span class="comment">/* RFC2616 Section 10.1 - Informational 1xx */</span></div>
<div class="line"><span class="lineno"> 4184</span>    <span class="keywordflow">case</span> 100:</div>
<div class="line"><span class="lineno"> 4185</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Continue&quot;</span>; <span class="comment">/* RFC2616 Section 10.1.1 */</span></div>
<div class="line"><span class="lineno"> 4186</span>    <span class="keywordflow">case</span> 101:</div>
<div class="line"><span class="lineno"> 4187</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Switching Protocols&quot;</span>; <span class="comment">/* RFC2616 Section 10.1.2 */</span></div>
<div class="line"><span class="lineno"> 4188</span>    <span class="keywordflow">case</span> 102:</div>
<div class="line"><span class="lineno"> 4189</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Processing&quot;</span>; <span class="comment">/* RFC2518 Section 10.1 */</span></div>
<div class="line"><span class="lineno"> 4190</span> </div>
<div class="line"><span class="lineno"> 4191</span>        <span class="comment">/* RFC2616 Section 10.2 - Successful 2xx */</span></div>
<div class="line"><span class="lineno"> 4192</span>    <span class="keywordflow">case</span> 200:</div>
<div class="line"><span class="lineno"> 4193</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;OK&quot;</span>; <span class="comment">/* RFC2616 Section 10.2.1 */</span></div>
<div class="line"><span class="lineno"> 4194</span>    <span class="keywordflow">case</span> 201:</div>
<div class="line"><span class="lineno"> 4195</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Created&quot;</span>; <span class="comment">/* RFC2616 Section 10.2.2 */</span></div>
<div class="line"><span class="lineno"> 4196</span>    <span class="keywordflow">case</span> 202:</div>
<div class="line"><span class="lineno"> 4197</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Accepted&quot;</span>; <span class="comment">/* RFC2616 Section 10.2.3 */</span></div>
<div class="line"><span class="lineno"> 4198</span>    <span class="keywordflow">case</span> 203:</div>
<div class="line"><span class="lineno"> 4199</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Non-Authoritative Information&quot;</span>; <span class="comment">/* RFC2616 Section 10.2.4 */</span></div>
<div class="line"><span class="lineno"> 4200</span>    <span class="keywordflow">case</span> 204:</div>
<div class="line"><span class="lineno"> 4201</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;No Content&quot;</span>; <span class="comment">/* RFC2616 Section 10.2.5 */</span></div>
<div class="line"><span class="lineno"> 4202</span>    <span class="keywordflow">case</span> 205:</div>
<div class="line"><span class="lineno"> 4203</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Reset Content&quot;</span>; <span class="comment">/* RFC2616 Section 10.2.6 */</span></div>
<div class="line"><span class="lineno"> 4204</span>    <span class="keywordflow">case</span> 206:</div>
<div class="line"><span class="lineno"> 4205</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Partial Content&quot;</span>; <span class="comment">/* RFC2616 Section 10.2.7 */</span></div>
<div class="line"><span class="lineno"> 4206</span>    <span class="keywordflow">case</span> 207:</div>
<div class="line"><span class="lineno"> 4207</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Multi-Status&quot;</span>; <span class="comment">/* RFC2518 Section 10.2, RFC4918 Section 11.1</span></div>
<div class="line"><span class="lineno"> 4208</span><span class="comment">                                */</span></div>
<div class="line"><span class="lineno"> 4209</span>    <span class="keywordflow">case</span> 208:</div>
<div class="line"><span class="lineno"> 4210</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Already Reported&quot;</span>; <span class="comment">/* RFC5842 Section 7.1 */</span></div>
<div class="line"><span class="lineno"> 4211</span> </div>
<div class="line"><span class="lineno"> 4212</span>    <span class="keywordflow">case</span> 226:</div>
<div class="line"><span class="lineno"> 4213</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;IM used&quot;</span>; <span class="comment">/* RFC3229 Section 10.4.1 */</span></div>
<div class="line"><span class="lineno"> 4214</span> </div>
<div class="line"><span class="lineno"> 4215</span>        <span class="comment">/* RFC2616 Section 10.3 - Redirection 3xx */</span></div>
<div class="line"><span class="lineno"> 4216</span>    <span class="keywordflow">case</span> 300:</div>
<div class="line"><span class="lineno"> 4217</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Multiple Choices&quot;</span>; <span class="comment">/* RFC2616 Section 10.3.1 */</span></div>
<div class="line"><span class="lineno"> 4218</span>    <span class="keywordflow">case</span> 301:</div>
<div class="line"><span class="lineno"> 4219</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Moved Permanently&quot;</span>; <span class="comment">/* RFC2616 Section 10.3.2 */</span></div>
<div class="line"><span class="lineno"> 4220</span>    <span class="keywordflow">case</span> 302:</div>
<div class="line"><span class="lineno"> 4221</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Found&quot;</span>; <span class="comment">/* RFC2616 Section 10.3.3 */</span></div>
<div class="line"><span class="lineno"> 4222</span>    <span class="keywordflow">case</span> 303:</div>
<div class="line"><span class="lineno"> 4223</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;See Other&quot;</span>; <span class="comment">/* RFC2616 Section 10.3.4 */</span></div>
<div class="line"><span class="lineno"> 4224</span>    <span class="keywordflow">case</span> 304:</div>
<div class="line"><span class="lineno"> 4225</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not Modified&quot;</span>; <span class="comment">/* RFC2616 Section 10.3.5 */</span></div>
<div class="line"><span class="lineno"> 4226</span>    <span class="keywordflow">case</span> 305:</div>
<div class="line"><span class="lineno"> 4227</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Use Proxy&quot;</span>; <span class="comment">/* RFC2616 Section 10.3.6 */</span></div>
<div class="line"><span class="lineno"> 4228</span>    <span class="keywordflow">case</span> 307:</div>
<div class="line"><span class="lineno"> 4229</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Temporary Redirect&quot;</span>; <span class="comment">/* RFC2616 Section 10.3.8 */</span></div>
<div class="line"><span class="lineno"> 4230</span>    <span class="keywordflow">case</span> 308:</div>
<div class="line"><span class="lineno"> 4231</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Permanent Redirect&quot;</span>; <span class="comment">/* RFC7238 Section 3 */</span></div>
<div class="line"><span class="lineno"> 4232</span> </div>
<div class="line"><span class="lineno"> 4233</span>        <span class="comment">/* RFC2616 Section 10.4 - Client Error 4xx */</span></div>
<div class="line"><span class="lineno"> 4234</span>    <span class="keywordflow">case</span> 400:</div>
<div class="line"><span class="lineno"> 4235</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Bad Request&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.1 */</span></div>
<div class="line"><span class="lineno"> 4236</span>    <span class="keywordflow">case</span> 401:</div>
<div class="line"><span class="lineno"> 4237</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unauthorized&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.2 */</span></div>
<div class="line"><span class="lineno"> 4238</span>    <span class="keywordflow">case</span> 402:</div>
<div class="line"><span class="lineno"> 4239</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Payment Required&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.3 */</span></div>
<div class="line"><span class="lineno"> 4240</span>    <span class="keywordflow">case</span> 403:</div>
<div class="line"><span class="lineno"> 4241</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Forbidden&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.4 */</span></div>
<div class="line"><span class="lineno"> 4242</span>    <span class="keywordflow">case</span> 404:</div>
<div class="line"><span class="lineno"> 4243</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not Found&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.5 */</span></div>
<div class="line"><span class="lineno"> 4244</span>    <span class="keywordflow">case</span> 405:</div>
<div class="line"><span class="lineno"> 4245</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Method Not Allowed&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.6 */</span></div>
<div class="line"><span class="lineno"> 4246</span>    <span class="keywordflow">case</span> 406:</div>
<div class="line"><span class="lineno"> 4247</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not Acceptable&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.7 */</span></div>
<div class="line"><span class="lineno"> 4248</span>    <span class="keywordflow">case</span> 407:</div>
<div class="line"><span class="lineno"> 4249</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Proxy Authentication Required&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.8 */</span></div>
<div class="line"><span class="lineno"> 4250</span>    <span class="keywordflow">case</span> 408:</div>
<div class="line"><span class="lineno"> 4251</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Request Time-out&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.9 */</span></div>
<div class="line"><span class="lineno"> 4252</span>    <span class="keywordflow">case</span> 409:</div>
<div class="line"><span class="lineno"> 4253</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Conflict&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.10 */</span></div>
<div class="line"><span class="lineno"> 4254</span>    <span class="keywordflow">case</span> 410:</div>
<div class="line"><span class="lineno"> 4255</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Gone&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.11 */</span></div>
<div class="line"><span class="lineno"> 4256</span>    <span class="keywordflow">case</span> 411:</div>
<div class="line"><span class="lineno"> 4257</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Length Required&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.12 */</span></div>
<div class="line"><span class="lineno"> 4258</span>    <span class="keywordflow">case</span> 412:</div>
<div class="line"><span class="lineno"> 4259</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Precondition Failed&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.13 */</span></div>
<div class="line"><span class="lineno"> 4260</span>    <span class="keywordflow">case</span> 413:</div>
<div class="line"><span class="lineno"> 4261</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Request Entity Too Large&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.14 */</span></div>
<div class="line"><span class="lineno"> 4262</span>    <span class="keywordflow">case</span> 414:</div>
<div class="line"><span class="lineno"> 4263</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Request-URI Too Large&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.15 */</span></div>
<div class="line"><span class="lineno"> 4264</span>    <span class="keywordflow">case</span> 415:</div>
<div class="line"><span class="lineno"> 4265</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unsupported Media Type&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.16 */</span></div>
<div class="line"><span class="lineno"> 4266</span>    <span class="keywordflow">case</span> 416:</div>
<div class="line"><span class="lineno"> 4267</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Requested range not satisfiable&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.17</span></div>
<div class="line"><span class="lineno"> 4268</span><span class="comment">                                                   */</span></div>
<div class="line"><span class="lineno"> 4269</span>    <span class="keywordflow">case</span> 417:</div>
<div class="line"><span class="lineno"> 4270</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Expectation Failed&quot;</span>; <span class="comment">/* RFC2616 Section 10.4.18 */</span></div>
<div class="line"><span class="lineno"> 4271</span> </div>
<div class="line"><span class="lineno"> 4272</span>    <span class="keywordflow">case</span> 421:</div>
<div class="line"><span class="lineno"> 4273</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Misdirected Request&quot;</span>; <span class="comment">/* RFC7540 Section 9.1.2 */</span></div>
<div class="line"><span class="lineno"> 4274</span>    <span class="keywordflow">case</span> 422:</div>
<div class="line"><span class="lineno"> 4275</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unproccessable entity&quot;</span>; <span class="comment">/* RFC2518 Section 10.3, RFC4918</span></div>
<div class="line"><span class="lineno"> 4276</span><span class="comment">                                         * Section 11.2 */</span></div>
<div class="line"><span class="lineno"> 4277</span>    <span class="keywordflow">case</span> 423:</div>
<div class="line"><span class="lineno"> 4278</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Locked&quot;</span>; <span class="comment">/* RFC2518 Section 10.4, RFC4918 Section 11.3 */</span></div>
<div class="line"><span class="lineno"> 4279</span>    <span class="keywordflow">case</span> 424:</div>
<div class="line"><span class="lineno"> 4280</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Failed Dependency&quot;</span>; <span class="comment">/* RFC2518 Section 10.5, RFC4918</span></div>
<div class="line"><span class="lineno"> 4281</span><span class="comment">                                     * Section 11.4 */</span></div>
<div class="line"><span class="lineno"> 4282</span> </div>
<div class="line"><span class="lineno"> 4283</span>    <span class="keywordflow">case</span> 426:</div>
<div class="line"><span class="lineno"> 4284</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Upgrade Required&quot;</span>; <span class="comment">/* RFC 2817 Section 4 */</span></div>
<div class="line"><span class="lineno"> 4285</span> </div>
<div class="line"><span class="lineno"> 4286</span>    <span class="keywordflow">case</span> 428:</div>
<div class="line"><span class="lineno"> 4287</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Precondition Required&quot;</span>; <span class="comment">/* RFC 6585, Section 3 */</span></div>
<div class="line"><span class="lineno"> 4288</span>    <span class="keywordflow">case</span> 429:</div>
<div class="line"><span class="lineno"> 4289</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Too Many Requests&quot;</span>; <span class="comment">/* RFC 6585, Section 4 */</span></div>
<div class="line"><span class="lineno"> 4290</span> </div>
<div class="line"><span class="lineno"> 4291</span>    <span class="keywordflow">case</span> 431:</div>
<div class="line"><span class="lineno"> 4292</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Request Header Fields Too Large&quot;</span>; <span class="comment">/* RFC 6585, Section 5 */</span></div>
<div class="line"><span class="lineno"> 4293</span> </div>
<div class="line"><span class="lineno"> 4294</span>    <span class="keywordflow">case</span> 451:</div>
<div class="line"><span class="lineno"> 4295</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unavailable For Legal Reasons&quot;</span>; <span class="comment">/* draft-tbray-http-legally-restricted-status-05,</span></div>
<div class="line"><span class="lineno"> 4296</span><span class="comment">                                                 * Section 3 */</span></div>
<div class="line"><span class="lineno"> 4297</span> </div>
<div class="line"><span class="lineno"> 4298</span>        <span class="comment">/* RFC2616 Section 10.5 - Server Error 5xx */</span></div>
<div class="line"><span class="lineno"> 4299</span>    <span class="keywordflow">case</span> 500:</div>
<div class="line"><span class="lineno"> 4300</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Internal Server Error&quot;</span>; <span class="comment">/* RFC2616 Section 10.5.1 */</span></div>
<div class="line"><span class="lineno"> 4301</span>    <span class="keywordflow">case</span> 501:</div>
<div class="line"><span class="lineno"> 4302</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not Implemented&quot;</span>; <span class="comment">/* RFC2616 Section 10.5.2 */</span></div>
<div class="line"><span class="lineno"> 4303</span>    <span class="keywordflow">case</span> 502:</div>
<div class="line"><span class="lineno"> 4304</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Bad Gateway&quot;</span>; <span class="comment">/* RFC2616 Section 10.5.3 */</span></div>
<div class="line"><span class="lineno"> 4305</span>    <span class="keywordflow">case</span> 503:</div>
<div class="line"><span class="lineno"> 4306</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Service Unavailable&quot;</span>; <span class="comment">/* RFC2616 Section 10.5.4 */</span></div>
<div class="line"><span class="lineno"> 4307</span>    <span class="keywordflow">case</span> 504:</div>
<div class="line"><span class="lineno"> 4308</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Gateway Time-out&quot;</span>; <span class="comment">/* RFC2616 Section 10.5.5 */</span></div>
<div class="line"><span class="lineno"> 4309</span>    <span class="keywordflow">case</span> 505:</div>
<div class="line"><span class="lineno"> 4310</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;HTTP Version not supported&quot;</span>; <span class="comment">/* RFC2616 Section 10.5.6 */</span></div>
<div class="line"><span class="lineno"> 4311</span>    <span class="keywordflow">case</span> 506:</div>
<div class="line"><span class="lineno"> 4312</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Variant Also Negotiates&quot;</span>; <span class="comment">/* RFC 2295, Section 8.1 */</span></div>
<div class="line"><span class="lineno"> 4313</span>    <span class="keywordflow">case</span> 507:</div>
<div class="line"><span class="lineno"> 4314</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Insufficient Storage&quot;</span>; <span class="comment">/* RFC2518 Section 10.6, RFC4918</span></div>
<div class="line"><span class="lineno"> 4315</span><span class="comment">                                        * Section 11.5 */</span></div>
<div class="line"><span class="lineno"> 4316</span>    <span class="keywordflow">case</span> 508:</div>
<div class="line"><span class="lineno"> 4317</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Loop Detected&quot;</span>; <span class="comment">/* RFC5842 Section 7.1 */</span></div>
<div class="line"><span class="lineno"> 4318</span> </div>
<div class="line"><span class="lineno"> 4319</span>    <span class="keywordflow">case</span> 510:</div>
<div class="line"><span class="lineno"> 4320</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not Extended&quot;</span>; <span class="comment">/* RFC 2774, Section 7 */</span></div>
<div class="line"><span class="lineno"> 4321</span>    <span class="keywordflow">case</span> 511:</div>
<div class="line"><span class="lineno"> 4322</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Network Authentication Required&quot;</span>; <span class="comment">/* RFC 6585, Section 6 */</span></div>
<div class="line"><span class="lineno"> 4323</span> </div>
<div class="line"><span class="lineno"> 4324</span>        <span class="comment">/* Other status codes, not shown in the IANA HTTP status code</span></div>
<div class="line"><span class="lineno"> 4325</span><span class="comment">         * assignment.</span></div>
<div class="line"><span class="lineno"> 4326</span><span class="comment">         * E.g., &quot;de facto&quot; standards due to common use, ... */</span></div>
<div class="line"><span class="lineno"> 4327</span>    <span class="keywordflow">case</span> 418:</div>
<div class="line"><span class="lineno"> 4328</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;I am a teapot&quot;</span>; <span class="comment">/* RFC2324 Section 2.3.2 */</span></div>
<div class="line"><span class="lineno"> 4329</span>    <span class="keywordflow">case</span> 419:</div>
<div class="line"><span class="lineno"> 4330</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Authentication Timeout&quot;</span>; <span class="comment">/* common use */</span></div>
<div class="line"><span class="lineno"> 4331</span>    <span class="keywordflow">case</span> 420:</div>
<div class="line"><span class="lineno"> 4332</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Enhance Your Calm&quot;</span>; <span class="comment">/* common use */</span></div>
<div class="line"><span class="lineno"> 4333</span>    <span class="keywordflow">case</span> 440:</div>
<div class="line"><span class="lineno"> 4334</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Login Timeout&quot;</span>; <span class="comment">/* common use */</span></div>
<div class="line"><span class="lineno"> 4335</span>    <span class="keywordflow">case</span> 509:</div>
<div class="line"><span class="lineno"> 4336</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Bandwidth Limit Exceeded&quot;</span>; <span class="comment">/* common use */</span></div>
<div class="line"><span class="lineno"> 4337</span> </div>
<div class="line"><span class="lineno"> 4338</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno"> 4339</span>        <span class="comment">/* This error code is unknown. This should not happen. */</span></div>
<div class="line"><span class="lineno"> 4340</span>        <span class="keywordflow">if</span> (conn) {</div>
<div class="line"><span class="lineno"> 4341</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno"> 4342</span>                            <span class="stringliteral">&quot;Unknown HTTP response code: %u&quot;</span>,</div>
<div class="line"><span class="lineno"> 4343</span>                            response_code);</div>
<div class="line"><span class="lineno"> 4344</span>        }</div>
<div class="line"><span class="lineno"> 4345</span> </div>
<div class="line"><span class="lineno"> 4346</span>        <span class="comment">/* Return at least a category according to RFC 2616 Section 10. */</span></div>
<div class="line"><span class="lineno"> 4347</span>        <span class="keywordflow">if</span> (response_code &gt;= 100 &amp;&amp; response_code &lt; 200) {</div>
<div class="line"><span class="lineno"> 4348</span>            <span class="comment">/* Unknown informational status code */</span></div>
<div class="line"><span class="lineno"> 4349</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Information&quot;</span>;</div>
<div class="line"><span class="lineno"> 4350</span>        }</div>
<div class="line"><span class="lineno"> 4351</span>        <span class="keywordflow">if</span> (response_code &gt;= 200 &amp;&amp; response_code &lt; 300) {</div>
<div class="line"><span class="lineno"> 4352</span>            <span class="comment">/* Unknown success code */</span></div>
<div class="line"><span class="lineno"> 4353</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Success&quot;</span>;</div>
<div class="line"><span class="lineno"> 4354</span>        }</div>
<div class="line"><span class="lineno"> 4355</span>        <span class="keywordflow">if</span> (response_code &gt;= 300 &amp;&amp; response_code &lt; 400) {</div>
<div class="line"><span class="lineno"> 4356</span>            <span class="comment">/* Unknown redirection code */</span></div>
<div class="line"><span class="lineno"> 4357</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Redirection&quot;</span>;</div>
<div class="line"><span class="lineno"> 4358</span>        }</div>
<div class="line"><span class="lineno"> 4359</span>        <span class="keywordflow">if</span> (response_code &gt;= 400 &amp;&amp; response_code &lt; 500) {</div>
<div class="line"><span class="lineno"> 4360</span>            <span class="comment">/* Unknown request error code */</span></div>
<div class="line"><span class="lineno"> 4361</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Client Error&quot;</span>;</div>
<div class="line"><span class="lineno"> 4362</span>        }</div>
<div class="line"><span class="lineno"> 4363</span>        <span class="keywordflow">if</span> (response_code &gt;= 500 &amp;&amp; response_code &lt; 600) {</div>
<div class="line"><span class="lineno"> 4364</span>            <span class="comment">/* Unknown server error code */</span></div>
<div class="line"><span class="lineno"> 4365</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server Error&quot;</span>;</div>
<div class="line"><span class="lineno"> 4366</span>        }</div>
<div class="line"><span class="lineno"> 4367</span> </div>
<div class="line"><span class="lineno"> 4368</span>        <span class="comment">/* Response code not even within reasonable range */</span></div>
<div class="line"><span class="lineno"> 4369</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno"> 4370</span>    }</div>
<div class="line"><span class="lineno"> 4371</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>.</p>

</div>
</div>
<a id="a6447b006fb71eb53c324291b17b9f41f" name="a6447b006fb71eb53c324291b17b9f41f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6447b006fb71eb53c324291b17b9f41f">&#9670;&#160;</a></span>mg_get_response_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const struct <a class="el" href="structmg__response__info.html">mg_response_info</a> * mg_get_response_info </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03561">3561</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3562</span>{</div>
<div class="line"><span class="lineno"> 3563</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno"> 3564</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3565</span>    }</div>
<div class="line"><span class="lineno"> 3566</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> != <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04aa45754d1cc862db401a33486ebefe411">CONNECTION_TYPE_RESPONSE</a>) {</div>
<div class="line"><span class="lineno"> 3567</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3568</span>    }</div>
<div class="line"><span class="lineno"> 3569</span>    <span class="keywordflow">return</span> &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>;</div>
<div class="line"><span class="lineno"> 3570</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02486">mg_connection::connection_type</a>, <a class="el" href="civetweb_8c_source.html#l02462">CONNECTION_TYPE_RESPONSE</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l02495">mg_connection::response_info</a>.</p>

<p class="reference">Referenced by <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00995">run_client()</a>.</p>

</div>
</div>
<a id="a4dce566e09bfb338699720d1ce69c8d4" name="a4dce566e09bfb338699720d1ce69c8d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dce566e09bfb338699720d1ce69c8d4">&#9670;&#160;</a></span>mg_get_server_ports()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_get_server_ports </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__server__port.html">mg_server_port</a> *</td>          <td class="paramname"><span class="paramname"><em>ports</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03248">3248</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3251</span>{</div>
<div class="line"><span class="lineno"> 3252</span>    <span class="keywordtype">int</span> i, cnt = 0;</div>
<div class="line"><span class="lineno"> 3253</span> </div>
<div class="line"><span class="lineno"> 3254</span>    <span class="keywordflow">if</span> (size &lt;= 0) {</div>
<div class="line"><span class="lineno"> 3255</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 3256</span>    }</div>
<div class="line"><span class="lineno"> 3257</span>    memset(ports, 0, <span class="keyword">sizeof</span>(*ports) * (<span class="keywordtype">size_t</span>)size);</div>
<div class="line"><span class="lineno"> 3258</span>    <span class="keywordflow">if</span> (!ctx) {</div>
<div class="line"><span class="lineno"> 3259</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 3260</span>    }</div>
<div class="line"><span class="lineno"> 3261</span>    <span class="keywordflow">if</span> (!ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>) {</div>
<div class="line"><span class="lineno"> 3262</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 3263</span>    }</div>
<div class="line"><span class="lineno"> 3264</span> </div>
<div class="line"><span class="lineno"> 3265</span>    <span class="keywordflow">for</span> (i = 0; (i &lt; size) &amp;&amp; (i &lt; (<span class="keywordtype">int</span>)ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ade1ccb738022fd01597c1816cb88d1e4">num_listening_sockets</a>); i++) {</div>
<div class="line"><span class="lineno"> 3266</span> </div>
<div class="line"><span class="lineno"> 3267</span>        ports[cnt].<a class="code hl_variable" href="structmg__server__port.html#abb93ebe061666ce256ea17a55fd38b9c">port</a> =</div>
<div class="line"><span class="lineno"> 3268</span>            ntohs(<a class="code hl_define" href="#a58f28d0739c8e6a66ffce338daef408c">USA_IN_PORT_UNSAFE</a>(&amp;(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>)));</div>
<div class="line"><span class="lineno"> 3269</span>        ports[cnt].<a class="code hl_variable" href="structmg__server__port.html#aff67341f9b687bc643a281d0efb5906b">is_ssl</a> = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#a2d1d5b8ef7da25d5e7e666e023a9b733">is_ssl</a>;</div>
<div class="line"><span class="lineno"> 3270</span>        ports[cnt].<a class="code hl_variable" href="structmg__server__port.html#aae57d94862923cb1bef63e5872008233">is_redirect</a> = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#ab6adc40d94d436862c00b586f1455f5c">ssl_redir</a>;</div>
<div class="line"><span class="lineno"> 3271</span> </div>
<div class="line"><span class="lineno"> 3272</span>        <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family == AF_INET) {</div>
<div class="line"><span class="lineno"> 3273</span>            <span class="comment">/* IPv4 */</span></div>
<div class="line"><span class="lineno"> 3274</span>            ports[cnt].<a class="code hl_variable" href="structmg__server__port.html#a67e6e3f3cfcee612e69b4fb3f3e1458f">protocol</a> = 1;</div>
<div class="line"><span class="lineno"> 3275</span>            cnt++;</div>
<div class="line"><span class="lineno"> 3276</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[i].<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family == AF_INET6) {</div>
<div class="line"><span class="lineno"> 3277</span>            <span class="comment">/* IPv6 */</span></div>
<div class="line"><span class="lineno"> 3278</span>            ports[cnt].<a class="code hl_variable" href="structmg__server__port.html#a67e6e3f3cfcee612e69b4fb3f3e1458f">protocol</a> = 3;</div>
<div class="line"><span class="lineno"> 3279</span>            cnt++;</div>
<div class="line"><span class="lineno"> 3280</span>        }</div>
<div class="line"><span class="lineno"> 3281</span>    }</div>
<div class="line"><span class="lineno"> 3282</span> </div>
<div class="line"><span class="lineno"> 3283</span>    <span class="keywordflow">return</span> cnt;</div>
<div class="line"><span class="lineno"> 3284</span>}</div>
<div class="ttc" id="astructmg__server__port_html_a67e6e3f3cfcee612e69b4fb3f3e1458f"><div class="ttname"><a href="structmg__server__port.html#a67e6e3f3cfcee612e69b4fb3f3e1458f">mg_server_port::protocol</a></div><div class="ttdeci">int protocol</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00713">civetweb.h:713</a></div></div>
<div class="ttc" id="astructmg__server__port_html_aae57d94862923cb1bef63e5872008233"><div class="ttname"><a href="structmg__server__port.html#aae57d94862923cb1bef63e5872008233">mg_server_port::is_redirect</a></div><div class="ttdeci">int is_redirect</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00716">civetweb.h:716</a></div></div>
<div class="ttc" id="astructmg__server__port_html_abb93ebe061666ce256ea17a55fd38b9c"><div class="ttname"><a href="structmg__server__port.html#abb93ebe061666ce256ea17a55fd38b9c">mg_server_port::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00714">civetweb.h:714</a></div></div>
<div class="ttc" id="astructmg__server__port_html_aff67341f9b687bc643a281d0efb5906b"><div class="ttname"><a href="structmg__server__port.html#aff67341f9b687bc643a281d0efb5906b">mg_server_port::is_ssl</a></div><div class="ttdeci">int is_ssl</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00715">civetweb.h:715</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00716">mg_server_port::is_redirect</a>, <a class="el" href="civetweb_8c_source.html#l01906">socket::is_ssl</a>, <a class="el" href="civetweb_8h_source.html#l00715">mg_server_port::is_ssl</a>, <a class="el" href="civetweb_8c_source.html#l02356">mg_context::listening_sockets</a>, <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l02358">mg_context::num_listening_sockets</a>, <a class="el" href="civetweb_8h_source.html#l00714">mg_server_port::port</a>, <a class="el" href="civetweb_8h_source.html#l00713">mg_server_port::protocol</a>, <a class="el" href="civetweb_8c_source.html#l01833">usa::sa</a>, <a class="el" href="civetweb_8c_source.html#l01907">socket::ssl_redir</a>, and <a class="el" href="civetweb_8c_source.html#l01860">USA_IN_PORT_UNSAFE</a>.</p>

</div>
</div>
<a id="af7b80bf53a5b2c2453734e64203d3f7e" name="af7b80bf53a5b2c2453734e64203d3f7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7b80bf53a5b2c2453734e64203d3f7e">&#9670;&#160;</a></span>mg_get_system_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_get_system_info </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>buflen</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l21512">21512</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">21513</span>{</div>
<div class="line"><span class="lineno">21514</span>    <span class="keywordtype">char</span> *end, *append_eoobj = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>[256];</div>
<div class="line"><span class="lineno">21515</span>    <span class="keywordtype">size_t</span> system_info_length = 0;</div>
<div class="line"><span class="lineno">21516</span> </div>
<div class="line"><span class="lineno">21517</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">21518</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> eol[] = <span class="stringliteral">&quot;\r\n&quot;</span>, eoobj[] = <span class="stringliteral">&quot;\r\n}\r\n&quot;</span>;</div>
<div class="line"><span class="lineno">21519</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">21520</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> eol[] = <span class="stringliteral">&quot;\n&quot;</span>, eoobj[] = <span class="stringliteral">&quot;\n}\n&quot;</span>;</div>
<div class="line"><span class="lineno">21521</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21522</span> </div>
<div class="line"><span class="lineno">21523</span>    <span class="keywordflow">if</span> ((buffer == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (buflen &lt; 1)) {</div>
<div class="line"><span class="lineno">21524</span>        buflen = 0;</div>
<div class="line"><span class="lineno">21525</span>        end = buffer;</div>
<div class="line"><span class="lineno">21526</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">21527</span>        *buffer = 0;</div>
<div class="line"><span class="lineno">21528</span>        end = buffer + buflen;</div>
<div class="line"><span class="lineno">21529</span>    }</div>
<div class="line"><span class="lineno">21530</span>    <span class="keywordflow">if</span> (buflen &gt; (<span class="keywordtype">int</span>)(<span class="keyword">sizeof</span>(eoobj) - 1)) {</div>
<div class="line"><span class="lineno">21531</span>        <span class="comment">/* has enough space to append eoobj */</span></div>
<div class="line"><span class="lineno">21532</span>        append_eoobj = buffer;</div>
<div class="line"><span class="lineno">21533</span>        <span class="keywordflow">if</span> (end) {</div>
<div class="line"><span class="lineno">21534</span>            end -= <span class="keyword">sizeof</span>(eoobj) - 1;</div>
<div class="line"><span class="lineno">21535</span>        }</div>
<div class="line"><span class="lineno">21536</span>    }</div>
<div class="line"><span class="lineno">21537</span> </div>
<div class="line"><span class="lineno">21538</span>    system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <span class="stringliteral">&quot;{&quot;</span>);</div>
<div class="line"><span class="lineno">21539</span> </div>
<div class="line"><span class="lineno">21540</span>    <span class="comment">/* Server version */</span></div>
<div class="line"><span class="lineno">21541</span>    {</div>
<div class="line"><span class="lineno">21542</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *version = <a class="code hl_function" href="#a057ebd236dc84e6e8f6c9765da609329">mg_version</a>();</div>
<div class="line"><span class="lineno">21543</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21544</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21545</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21546</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21547</span>                    <span class="stringliteral">&quot;%s\&quot;version\&quot; : \&quot;%s\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21548</span>                    eol,</div>
<div class="line"><span class="lineno">21549</span>                    version);</div>
<div class="line"><span class="lineno">21550</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21551</span>    }</div>
<div class="line"><span class="lineno">21552</span> </div>
<div class="line"><span class="lineno">21553</span>    <span class="comment">/* System info */</span></div>
<div class="line"><span class="lineno">21554</span>    {</div>
<div class="line"><span class="lineno">21555</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">21556</span>        DWORD dwVersion = 0;</div>
<div class="line"><span class="lineno">21557</span>        DWORD dwMajorVersion = 0;</div>
<div class="line"><span class="lineno">21558</span>        DWORD dwMinorVersion = 0;</div>
<div class="line"><span class="lineno">21559</span>        SYSTEM_INFO si;</div>
<div class="line"><span class="lineno">21560</span> </div>
<div class="line"><span class="lineno">21561</span>        GetSystemInfo(&amp;si);</div>
<div class="line"><span class="lineno">21562</span> </div>
<div class="line"><span class="lineno">21563</span><span class="preprocessor">#if defined(_MSC_VER)</span></div>
<div class="line"><span class="lineno">21564</span><span class="preprocessor">#pragma warning(push)</span></div>
<div class="line"><span class="lineno">21565</span>        <span class="comment">/* GetVersion was declared deprecated */</span></div>
<div class="line"><span class="lineno">21566</span><span class="preprocessor">#pragma warning(disable : 4996)</span></div>
<div class="line"><span class="lineno">21567</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21568</span>        dwVersion = GetVersion();</div>
<div class="line"><span class="lineno">21569</span><span class="preprocessor">#if defined(_MSC_VER)</span></div>
<div class="line"><span class="lineno">21570</span><span class="preprocessor">#pragma warning(pop)</span></div>
<div class="line"><span class="lineno">21571</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21572</span> </div>
<div class="line"><span class="lineno">21573</span>        dwMajorVersion = (DWORD)(LOBYTE(LOWORD(dwVersion)));</div>
<div class="line"><span class="lineno">21574</span>        dwMinorVersion = (DWORD)(HIBYTE(LOWORD(dwVersion)));</div>
<div class="line"><span class="lineno">21575</span> </div>
<div class="line"><span class="lineno">21576</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21577</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21578</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21579</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21580</span>                    <span class="stringliteral">&quot;,%s\&quot;os\&quot; : \&quot;Windows %u.%u\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21581</span>                    eol,</div>
<div class="line"><span class="lineno">21582</span>                    (<span class="keywordtype">unsigned</span>)dwMajorVersion,</div>
<div class="line"><span class="lineno">21583</span>                    (<span class="keywordtype">unsigned</span>)dwMinorVersion);</div>
<div class="line"><span class="lineno">21584</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21585</span> </div>
<div class="line"><span class="lineno">21586</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21587</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21588</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21589</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21590</span>                    <span class="stringliteral">&quot;,%s\&quot;cpu\&quot; : \&quot;type %u, cores %u, mask %x\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21591</span>                    eol,</div>
<div class="line"><span class="lineno">21592</span>                    (<span class="keywordtype">unsigned</span>)si.wProcessorArchitecture,</div>
<div class="line"><span class="lineno">21593</span>                    (<span class="keywordtype">unsigned</span>)si.dwNumberOfProcessors,</div>
<div class="line"><span class="lineno">21594</span>                    (<span class="keywordtype">unsigned</span>)si.dwActiveProcessorMask);</div>
<div class="line"><span class="lineno">21595</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21596</span><span class="preprocessor">#elif defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno">21597</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21598</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21599</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21600</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21601</span>                    <span class="stringliteral">&quot;,%s\&quot;os\&quot; : \&quot;%s %s\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21602</span>                    eol,</div>
<div class="line"><span class="lineno">21603</span>                    <span class="stringliteral">&quot;Zephyr OS&quot;</span>,</div>
<div class="line"><span class="lineno">21604</span>                    ZEPHYR_VERSION);</div>
<div class="line"><span class="lineno">21605</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21606</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">21607</span>        <span class="keyword">struct </span>utsname <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>;</div>
<div class="line"><span class="lineno">21608</span>        memset(&amp;<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>));</div>
<div class="line"><span class="lineno">21609</span>        uname(&amp;<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">21610</span> </div>
<div class="line"><span class="lineno">21611</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21612</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21613</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21614</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21615</span>                    <span class="stringliteral">&quot;,%s\&quot;os\&quot; : \&quot;%s %s (%s) - %s\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21616</span>                    eol,</div>
<div class="line"><span class="lineno">21617</span>                    <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.sysname,</div>
<div class="line"><span class="lineno">21618</span>                    <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.version,</div>
<div class="line"><span class="lineno">21619</span>                    <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.release,</div>
<div class="line"><span class="lineno">21620</span>                    <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.machine);</div>
<div class="line"><span class="lineno">21621</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21622</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21623</span>    }</div>
<div class="line"><span class="lineno">21624</span> </div>
<div class="line"><span class="lineno">21625</span>    <span class="comment">/* Features */</span></div>
<div class="line"><span class="lineno">21626</span>    {</div>
<div class="line"><span class="lineno">21627</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21628</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21629</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21630</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21631</span>                    <span class="stringliteral">&quot;,%s\&quot;features\&quot; : %lu&quot;</span></div>
<div class="line"><span class="lineno">21632</span>                    <span class="stringliteral">&quot;,%s\&quot;feature_list\&quot; : \&quot;Server:%s%s%s%s%s%s%s%s%s\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21633</span>                    eol,</div>
<div class="line"><span class="lineno">21634</span>                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(0xFFFFFFFFu),</div>
<div class="line"><span class="lineno">21635</span>                    eol,</div>
<div class="line"><span class="lineno">21636</span>                    <a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da79f7476503d279aebb8e29415c310ba1">MG_FEATURES_FILES</a>) ? <span class="stringliteral">&quot; Files&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21637</span>                    <a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daba4b4d11dd0dec1ba0833f0bb1de2b0e">MG_FEATURES_SSL</a>) ? <span class="stringliteral">&quot; HTTPS&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21638</span>                    <a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da84fc7ef257026875a66d71eddd99a52a">MG_FEATURES_CGI</a>) ? <span class="stringliteral">&quot; CGI&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21639</span>                    <a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da899e17934638eaac9928e3ca39c4b4ba">MG_FEATURES_IPV6</a>) ? <span class="stringliteral">&quot; IPv6&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21640</span>                    <a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daeb94a2a63430c86ebbae4dfe84e7f8de">MG_FEATURES_WEBSOCKET</a>) ? <span class="stringliteral">&quot; WebSockets&quot;</span></div>
<div class="line"><span class="lineno">21641</span>                                                            : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21642</span>                    <a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dad09716f1978e57ab93c65da1c53ccb1d">MG_FEATURES_LUA</a>) ? <span class="stringliteral">&quot; Lua&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21643</span>                    <a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daec89c7f60acc1228627d697da889dfa6">MG_FEATURES_SSJS</a>) ? <span class="stringliteral">&quot; JavaScript&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21644</span>                    <a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da65c4232cdd767df45fcd9abea0cc66e2">MG_FEATURES_CACHE</a>) ? <span class="stringliteral">&quot; Cache&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21645</span>                    <a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da56a0059eeae63a991e650d956719db5b">MG_FEATURES_STATS</a>) ? <span class="stringliteral">&quot; Stats&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">21646</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21647</span> </div>
<div class="line"><span class="lineno">21648</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">21649</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21650</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21651</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21652</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21653</span>                    <span class="stringliteral">&quot;,%s\&quot;lua_version\&quot; : \&quot;%u (%s)\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21654</span>                    eol,</div>
<div class="line"><span class="lineno">21655</span>                    (<span class="keywordtype">unsigned</span>)<a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#a4c575ef5fb9bad1872613a9d832486a5">LUA_VERSION_NUM</a>,</div>
<div class="line"><span class="lineno">21656</span>                    <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#abeb7a5ea7080e8ef597181124801f759">LUA_RELEASE</a>);</div>
<div class="line"><span class="lineno">21657</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21658</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21659</span><span class="preprocessor">#if defined(USE_DUKTAPE)</span></div>
<div class="line"><span class="lineno">21660</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21661</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21662</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21663</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21664</span>                    <span class="stringliteral">&quot;,%s\&quot;javascript\&quot; : \&quot;Duktape %u.%u.%u\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21665</span>                    eol,</div>
<div class="line"><span class="lineno">21666</span>                    (<span class="keywordtype">unsigned</span>)<a class="code hl_define" href="duktape-1_85_82_2src-noline_2duktape_8h.html#a64d5ac9273205b66a33c2895e5b4ddfa">DUK_VERSION</a> / 10000,</div>
<div class="line"><span class="lineno">21667</span>                    ((<span class="keywordtype">unsigned</span>)<a class="code hl_define" href="duktape-1_85_82_2src-noline_2duktape_8h.html#a64d5ac9273205b66a33c2895e5b4ddfa">DUK_VERSION</a> / 100) % 100,</div>
<div class="line"><span class="lineno">21668</span>                    (<span class="keywordtype">unsigned</span>)<a class="code hl_define" href="duktape-1_85_82_2src-noline_2duktape_8h.html#a64d5ac9273205b66a33c2895e5b4ddfa">DUK_VERSION</a> % 100);</div>
<div class="line"><span class="lineno">21669</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21670</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21671</span>    }</div>
<div class="line"><span class="lineno">21672</span> </div>
<div class="line"><span class="lineno">21673</span>    <span class="comment">/* Build identifier. If BUILD_DATE is not set, __DATE__ will be used. */</span></div>
<div class="line"><span class="lineno">21674</span>    {</div>
<div class="line"><span class="lineno">21675</span><span class="preprocessor">#if defined(BUILD_DATE)</span></div>
<div class="line"><span class="lineno">21676</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *bd = BUILD_DATE;</div>
<div class="line"><span class="lineno">21677</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">21678</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno">21679</span><span class="preprocessor">#if GCC_VERSION &gt;= 40900</span></div>
<div class="line"><span class="lineno">21680</span><span class="preprocessor">#pragma GCC diagnostic push</span></div>
<div class="line"><span class="lineno">21681</span>        <span class="comment">/* Disable idiotic compiler warning -Wdate-time, appeared in gcc5. This</span></div>
<div class="line"><span class="lineno">21682</span><span class="comment">         * does not work in some versions. If &quot;BUILD_DATE&quot; is defined to some</span></div>
<div class="line"><span class="lineno">21683</span><span class="comment">         * string, it is used instead of __DATE__. */</span></div>
<div class="line"><span class="lineno">21684</span><span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wdate-time&quot;</span></div>
<div class="line"><span class="lineno">21685</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21686</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21687</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *bd = __DATE__;</div>
<div class="line"><span class="lineno">21688</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno">21689</span><span class="preprocessor">#if GCC_VERSION &gt;= 40900</span></div>
<div class="line"><span class="lineno">21690</span><span class="preprocessor">#pragma GCC diagnostic pop</span></div>
<div class="line"><span class="lineno">21691</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21692</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21693</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21694</span> </div>
<div class="line"><span class="lineno">21695</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(</div>
<div class="line"><span class="lineno">21696</span>            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>, <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>), <span class="stringliteral">&quot;,%s\&quot;build\&quot; : \&quot;%s\&quot;&quot;</span>, eol, bd);</div>
<div class="line"><span class="lineno">21697</span> </div>
<div class="line"><span class="lineno">21698</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21699</span>    }</div>
<div class="line"><span class="lineno">21700</span> </div>
<div class="line"><span class="lineno">21701</span>    <span class="comment">/* Compiler information */</span></div>
<div class="line"><span class="lineno">21702</span>    <span class="comment">/* http://sourceforge.net/p/predef/wiki/Compilers/ */</span></div>
<div class="line"><span class="lineno">21703</span>    {</div>
<div class="line"><span class="lineno">21704</span><span class="preprocessor">#if defined(_MSC_VER)</span></div>
<div class="line"><span class="lineno">21705</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21706</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21707</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21708</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21709</span>                    <span class="stringliteral">&quot;,%s\&quot;compiler\&quot; : \&quot;MSC: %u (%u)\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21710</span>                    eol,</div>
<div class="line"><span class="lineno">21711</span>                    (<span class="keywordtype">unsigned</span>)_MSC_VER,</div>
<div class="line"><span class="lineno">21712</span>                    (<span class="keywordtype">unsigned</span>)_MSC_FULL_VER);</div>
<div class="line"><span class="lineno">21713</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21714</span><span class="preprocessor">#elif defined(__MINGW64__)</span></div>
<div class="line"><span class="lineno">21715</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21716</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21717</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21718</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21719</span>                    <span class="stringliteral">&quot;,%s\&quot;compiler\&quot; : \&quot;MinGW64: %u.%u\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21720</span>                    eol,</div>
<div class="line"><span class="lineno">21721</span>                    (<span class="keywordtype">unsigned</span>)__MINGW64_VERSION_MAJOR,</div>
<div class="line"><span class="lineno">21722</span>                    (<span class="keywordtype">unsigned</span>)__MINGW64_VERSION_MINOR);</div>
<div class="line"><span class="lineno">21723</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21724</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21725</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21726</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21727</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21728</span>                    <span class="stringliteral">&quot;,%s\&quot;compiler\&quot; : \&quot;MinGW32: %u.%u\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21729</span>                    eol,</div>
<div class="line"><span class="lineno">21730</span>                    (<span class="keywordtype">unsigned</span>)__MINGW32_MAJOR_VERSION,</div>
<div class="line"><span class="lineno">21731</span>                    (<span class="keywordtype">unsigned</span>)__MINGW32_MINOR_VERSION);</div>
<div class="line"><span class="lineno">21732</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21733</span><span class="preprocessor">#elif defined(__MINGW32__)</span></div>
<div class="line"><span class="lineno">21734</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21735</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21736</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21737</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21738</span>                    <span class="stringliteral">&quot;,%s\&quot;compiler\&quot; : \&quot;MinGW32: %u.%u\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21739</span>                    eol,</div>
<div class="line"><span class="lineno">21740</span>                    (<span class="keywordtype">unsigned</span>)__MINGW32_MAJOR_VERSION,</div>
<div class="line"><span class="lineno">21741</span>                    (<span class="keywordtype">unsigned</span>)__MINGW32_MINOR_VERSION);</div>
<div class="line"><span class="lineno">21742</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21743</span><span class="preprocessor">#elif defined(__clang__)</span></div>
<div class="line"><span class="lineno">21744</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21745</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21746</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21747</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21748</span>                    <span class="stringliteral">&quot;,%s\&quot;compiler\&quot; : \&quot;clang: %u.%u.%u (%s)\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21749</span>                    eol,</div>
<div class="line"><span class="lineno">21750</span>                    __clang_major__,</div>
<div class="line"><span class="lineno">21751</span>                    __clang_minor__,</div>
<div class="line"><span class="lineno">21752</span>                    __clang_patchlevel__,</div>
<div class="line"><span class="lineno">21753</span>                    __clang_version__);</div>
<div class="line"><span class="lineno">21754</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21755</span><span class="preprocessor">#elif defined(__GNUC__)</span></div>
<div class="line"><span class="lineno">21756</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21757</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21758</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21759</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21760</span>                    <span class="stringliteral">&quot;,%s\&quot;compiler\&quot; : \&quot;gcc: %u.%u.%u\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21761</span>                    eol,</div>
<div class="line"><span class="lineno">21762</span>                    (<span class="keywordtype">unsigned</span>)__GNUC__,</div>
<div class="line"><span class="lineno">21763</span>                    (<span class="keywordtype">unsigned</span>)__GNUC_MINOR__,</div>
<div class="line"><span class="lineno">21764</span>                    (<span class="keywordtype">unsigned</span>)__GNUC_PATCHLEVEL__);</div>
<div class="line"><span class="lineno">21765</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21766</span><span class="preprocessor">#elif defined(__INTEL_COMPILER)</span></div>
<div class="line"><span class="lineno">21767</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21768</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21769</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21770</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21771</span>                    <span class="stringliteral">&quot;,%s\&quot;compiler\&quot; : \&quot;Intel C/C++: %u\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21772</span>                    eol,</div>
<div class="line"><span class="lineno">21773</span>                    (<span class="keywordtype">unsigned</span>)__INTEL_COMPILER);</div>
<div class="line"><span class="lineno">21774</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21775</span><span class="preprocessor">#elif defined(__BORLANDC__)</span></div>
<div class="line"><span class="lineno">21776</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21777</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21778</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21779</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21780</span>                    <span class="stringliteral">&quot;,%s\&quot;compiler\&quot; : \&quot;Borland C: 0x%x\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21781</span>                    eol,</div>
<div class="line"><span class="lineno">21782</span>                    (<span class="keywordtype">unsigned</span>)__BORLANDC__);</div>
<div class="line"><span class="lineno">21783</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21784</span><span class="preprocessor">#elif defined(__SUNPRO_C)</span></div>
<div class="line"><span class="lineno">21785</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21786</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21787</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21788</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21789</span>                    <span class="stringliteral">&quot;,%s\&quot;compiler\&quot; : \&quot;Solaris: 0x%x\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21790</span>                    eol,</div>
<div class="line"><span class="lineno">21791</span>                    (<span class="keywordtype">unsigned</span>)__SUNPRO_C);</div>
<div class="line"><span class="lineno">21792</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21793</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">21794</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21795</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21796</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21797</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21798</span>                    <span class="stringliteral">&quot;,%s\&quot;compiler\&quot; : \&quot;other\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21799</span>                    eol);</div>
<div class="line"><span class="lineno">21800</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21801</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21802</span>    }</div>
<div class="line"><span class="lineno">21803</span> </div>
<div class="line"><span class="lineno">21804</span>    <span class="comment">/* Determine 32/64 bit data mode.</span></div>
<div class="line"><span class="lineno">21805</span><span class="comment">     * see https://en.wikipedia.org/wiki/64-bit_computing */</span></div>
<div class="line"><span class="lineno">21806</span>    {</div>
<div class="line"><span class="lineno">21807</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21808</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21809</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>,</div>
<div class="line"><span class="lineno">21810</span>                    <span class="keyword">sizeof</span>(<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>),</div>
<div class="line"><span class="lineno">21811</span>                    <span class="stringliteral">&quot;,%s\&quot;data_model\&quot; : \&quot;int:%u/%u/%u/%u, float:%u/%u/%u, &quot;</span></div>
<div class="line"><span class="lineno">21812</span>                    <span class="stringliteral">&quot;char:%u/%u, &quot;</span></div>
<div class="line"><span class="lineno">21813</span>                    <span class="stringliteral">&quot;ptr:%u, size:%u, time:%u\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">21814</span>                    eol,</div>
<div class="line"><span class="lineno">21815</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">short</span>),</div>
<div class="line"><span class="lineno">21816</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),</div>
<div class="line"><span class="lineno">21817</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">long</span>),</div>
<div class="line"><span class="lineno">21818</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span>),</div>
<div class="line"><span class="lineno">21819</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),</div>
<div class="line"><span class="lineno">21820</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),</div>
<div class="line"><span class="lineno">21821</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">double</span>),</div>
<div class="line"><span class="lineno">21822</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),</div>
<div class="line"><span class="lineno">21823</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">wchar_t</span>),</div>
<div class="line"><span class="lineno">21824</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *),</div>
<div class="line"><span class="lineno">21825</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>),</div>
<div class="line"><span class="lineno">21826</span>                    (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(time_t));</div>
<div class="line"><span class="lineno">21827</span>        system_info_length += <a class="code hl_function" href="#a56edd9d2b1961442b88fb2e0419cdac8">mg_str_append</a>(&amp;buffer, end, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a235428bed4c6be6cb6d2760cd0fa9d34">block</a>);</div>
<div class="line"><span class="lineno">21828</span>    }</div>
<div class="line"><span class="lineno">21829</span> </div>
<div class="line"><span class="lineno">21830</span>    <span class="comment">/* Terminate string */</span></div>
<div class="line"><span class="lineno">21831</span>    <span class="keywordflow">if</span> (append_eoobj) {</div>
<div class="line"><span class="lineno">21832</span>        strcat(append_eoobj, eoobj);</div>
<div class="line"><span class="lineno">21833</span>    }</div>
<div class="line"><span class="lineno">21834</span>    system_info_length += <span class="keyword">sizeof</span>(eoobj) - 1;</div>
<div class="line"><span class="lineno">21835</span> </div>
<div class="line"><span class="lineno">21836</span>    <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)system_info_length;</div>
<div class="line"><span class="lineno">21837</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a057ebd236dc84e6e8f6c9765da609329"><div class="ttname"><a href="#a057ebd236dc84e6e8f6c9765da609329">mg_version</a></div><div class="ttdeci">CIVETWEB_API const char * mg_version(void)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03514">civetweb.c:3514</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad6e4a71c131991d1bf9dac0c74b7e8b2"><div class="ttname"><a href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a></div><div class="ttdeci">CIVETWEB_API unsigned mg_check_feature(unsigned feature)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l21430">civetweb.c:21430</a></div></div>
<div class="ttc" id="aduktape-1_85_82_2src-noline_2duktape_8h_html_a64d5ac9273205b66a33c2895e5b4ddfa"><div class="ttname"><a href="duktape-1_85_82_2src-noline_2duktape_8h.html#a64d5ac9273205b66a33c2895e5b4ddfa">DUK_VERSION</a></div><div class="ttdeci">#define DUK_VERSION</div><div class="ttdef"><b>Definition</b> <a href="duktape-1_85_82_2src-noline_2duktape_8h_source.html#l00221">duktape-1.5.2/src-noline/duktape.h:221</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lua_8h_html_a4c575ef5fb9bad1872613a9d832486a5"><div class="ttname"><a href="lua-5_81_85_2src_2lua_8h.html#a4c575ef5fb9bad1872613a9d832486a5">LUA_VERSION_NUM</a></div><div class="ttdeci">#define LUA_VERSION_NUM</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lua_8h_source.html#l00021">lua-5.1.5/src/lua.h:21</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lua_8h_html_abeb7a5ea7080e8ef597181124801f759"><div class="ttname"><a href="lua-5_81_85_2src_2lua_8h.html#abeb7a5ea7080e8ef597181124801f759">LUA_RELEASE</a></div><div class="ttdeci">#define LUA_RELEASE</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lua_8h_source.html#l00020">lua-5.1.5/src/lua.h:20</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lua-5_81_85_2src_2lparser_8c_source.html#l00881">block()</a>, <a class="el" href="duktape-1_85_82_2src-noline_2duktape_8h_source.html#l00221">DUK_VERSION</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00020">LUA_RELEASE</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00021">LUA_VERSION_NUM</a>, <a class="el" href="civetweb_8c_source.html#l21430">mg_check_feature()</a>, <a class="el" href="civetweb_8h_source.html#l00091">MG_FEATURES_CACHE</a>, <a class="el" href="civetweb_8h_source.html#l00071">MG_FEATURES_CGI</a>, <a class="el" href="civetweb_8h_source.html#l00061">MG_FEATURES_FILES</a>, <a class="el" href="civetweb_8h_source.html#l00075">MG_FEATURES_IPV6</a>, <a class="el" href="civetweb_8h_source.html#l00083">MG_FEATURES_LUA</a>, <a class="el" href="civetweb_8h_source.html#l00087">MG_FEATURES_SSJS</a>, <a class="el" href="civetweb_8h_source.html#l00067">MG_FEATURES_SSL</a>, <a class="el" href="civetweb_8h_source.html#l00095">MG_FEATURES_STATS</a>, <a class="el" href="civetweb_8h_source.html#l00079">MG_FEATURES_WEBSOCKET</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l21493">mg_str_append()</a>, <a class="el" href="civetweb_8c_source.html#l03514">mg_version()</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00825">init_system_info()</a>.</p>

</div>
</div>
<a id="a1563cc12250b9d00836709ac8bbe804b" name="a1563cc12250b9d00836709ac8bbe804b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1563cc12250b9d00836709ac8bbe804b">&#9670;&#160;</a></span>mg_get_thread_pointer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void * mg_get_thread_pointer </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03209">3209</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3210</span>{</div>
<div class="line"><span class="lineno"> 3211</span>    <span class="comment">/* both methods should return the same pointer */</span></div>
<div class="line"><span class="lineno"> 3212</span>    <span class="keywordflow">if</span> (conn) {</div>
<div class="line"><span class="lineno"> 3213</span>        <span class="comment">/* quick access, in case conn is known */</span></div>
<div class="line"><span class="lineno"> 3214</span>        <span class="keywordflow">return</span> conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aac018bc9711d0644676f33e396027000">tls_user_ptr</a>;</div>
<div class="line"><span class="lineno"> 3215</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3216</span>        <span class="comment">/* otherwise get pointer from thread local storage (TLS) */</span></div>
<div class="line"><span class="lineno"> 3217</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> *tls =</div>
<div class="line"><span class="lineno"> 3218</span>            (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> *)pthread_getspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>);</div>
<div class="line"><span class="lineno"> 3219</span>        <span class="keywordflow">return</span> tls-&gt;<a class="code hl_variable" href="structmg__workerTLS.html#a1d9e297c87be3d5eebf4d653a3816a46">user_ptr</a>;</div>
<div class="line"><span class="lineno"> 3220</span>    }</div>
<div class="line"><span class="lineno"> 3221</span>}</div>
<div class="ttc" id="astructmg__connection_html_aac018bc9711d0644676f33e396027000"><div class="ttname"><a href="structmg__connection.html#aac018bc9711d0644676f33e396027000">mg_connection::tls_user_ptr</a></div><div class="ttdeci">void * tls_user_ptr</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02571">civetweb.c:2571</a></div></div>
<div class="ttc" id="astructmg__workerTLS_html_a1d9e297c87be3d5eebf4d653a3816a46"><div class="ttname"><a href="structmg__workerTLS.html#a1d9e297c87be3d5eebf4d653a3816a46">mg_workerTLS::user_ptr</a></div><div class="ttdeci">void * user_ptr</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01590">civetweb.c:1590</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01580">sTlsKey</a>, <a class="el" href="civetweb_8c_source.html#l02571">mg_connection::tls_user_ptr</a>, and <a class="el" href="civetweb_8c_source.html#l01590">mg_workerTLS::user_ptr</a>.</p>

</div>
</div>
<a id="a97448fad91e328252f159bbbdeaed589" name="a97448fad91e328252f159bbbdeaed589"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97448fad91e328252f159bbbdeaed589">&#9670;&#160;</a></span>mg_get_user_connection_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void * mg_get_user_connection_data </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03238">3238</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3239</span>{</div>
<div class="line"><span class="lineno"> 3240</span>    <span class="keywordflow">if</span> (conn != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3241</span>        <span class="keywordflow">return</span> conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aad3d4e3de727f7424ff7526ed085716e">conn_data</a>;</div>
<div class="line"><span class="lineno"> 3242</span>    }</div>
<div class="line"><span class="lineno"> 3243</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3244</span>}</div>
<div class="ttc" id="astructmg__request__info_html_aad3d4e3de727f7424ff7526ed085716e"><div class="ttname"><a href="structmg__request__info.html#aad3d4e3de727f7424ff7526ed085716e">mg_request_info::conn_data</a></div><div class="ttdeci">void * conn_data</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00176">civetweb.h:176</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00176">mg_request_info::conn_data</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>.</p>

</div>
</div>
<a id="ae08477dcd7ad0ea27a6a35becf732e50" name="ae08477dcd7ad0ea27a6a35becf732e50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae08477dcd7ad0ea27a6a35becf732e50">&#9670;&#160;</a></span>mg_get_user_context_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void * mg_get_user_context_data </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03202">3202</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3203</span>{</div>
<div class="line"><span class="lineno"> 3204</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a17a41b88e5484900a2d01cad3c8fec20">mg_get_user_data</a>(<a class="code hl_function" href="#a7377f2af53b0a3e0a154a2c186f2f2d4">mg_get_context</a>(conn));</div>
<div class="line"><span class="lineno"> 3205</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a17a41b88e5484900a2d01cad3c8fec20"><div class="ttname"><a href="#a17a41b88e5484900a2d01cad3c8fec20">mg_get_user_data</a></div><div class="ttdeci">CIVETWEB_API void * mg_get_user_data(const struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03195">civetweb.c:3195</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a7377f2af53b0a3e0a154a2c186f2f2d4"><div class="ttname"><a href="#a7377f2af53b0a3e0a154a2c186f2f2d4">mg_get_context</a></div><div class="ttdeci">CIVETWEB_API struct mg_context * mg_get_context(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03188">civetweb.c:3188</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03188">mg_get_context()</a>, and <a class="el" href="civetweb_8c_source.html#l03195">mg_get_user_data()</a>.</p>

</div>
</div>
<a id="a17a41b88e5484900a2d01cad3c8fec20" name="a17a41b88e5484900a2d01cad3c8fec20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17a41b88e5484900a2d01cad3c8fec20">&#9670;&#160;</a></span>mg_get_user_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void * mg_get_user_data </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03195">3195</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3196</span>{</div>
<div class="line"><span class="lineno"> 3197</span>    <span class="keywordflow">return</span> (ctx == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> : ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a73a26dd1c9abead88b40b2d226ad9f28">user_data</a>;</div>
<div class="line"><span class="lineno"> 3198</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l02433">mg_context::user_data</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03202">mg_get_user_context_data()</a>.</p>

</div>
</div>
<a id="a86730990d410cecb18a1dbeee4ccd657" name="a86730990d410cecb18a1dbeee4ccd657"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86730990d410cecb18a1dbeee4ccd657">&#9670;&#160;</a></span>mg_get_valid_options()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const struct <a class="el" href="structmg__option.html">mg_option</a> * mg_get_valid_options </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02833">2833</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2834</span>{</div>
<div class="line"><span class="lineno"> 2835</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>;</div>
<div class="line"><span class="lineno"> 2836</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>.</p>

<p class="reference">Referenced by <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00495">set_option()</a>, and <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00319">show_usage_and_exit()</a>.</p>

</div>
</div>
<a id="a9af16bbe4c94107c76ee815af622e61f" name="a9af16bbe4c94107c76ee815af622e61f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9af16bbe4c94107c76ee815af622e61f">&#9670;&#160;</a></span>mg_get_var()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_get_var </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>data</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>data_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>dst</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>dst_len</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07088">7088</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7093</span>{</div>
<div class="line"><span class="lineno"> 7094</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a3d66a21c6795562fbd1412d9c9557306">mg_get_var2</a>(data, data_len, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, dst, dst_len, 0);</div>
<div class="line"><span class="lineno"> 7095</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a3d66a21c6795562fbd1412d9c9557306"><div class="ttname"><a href="#a3d66a21c6795562fbd1412d9c9557306">mg_get_var2</a></div><div class="ttdeci">CIVETWEB_API int mg_get_var2(const char *data, size_t data_len, const char *name, char *dst, size_t dst_len, size_t occurrence)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07099">civetweb.c:7099</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l07099">mg_get_var2()</a>, and <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>.</p>

</div>
</div>
<a id="a3d66a21c6795562fbd1412d9c9557306" name="a3d66a21c6795562fbd1412d9c9557306"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d66a21c6795562fbd1412d9c9557306">&#9670;&#160;</a></span>mg_get_var2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_get_var2 </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>data</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>data_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>dst</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>dst_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>occurrence</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07099">7099</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7105</span>{</div>
<div class="line"><span class="lineno"> 7106</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *e, *<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>;</div>
<div class="line"><span class="lineno"> 7107</span>    <span class="keywordtype">size_t</span> name_len;</div>
<div class="line"><span class="lineno"> 7108</span>    <span class="keywordtype">int</span> len;</div>
<div class="line"><span class="lineno"> 7109</span> </div>
<div class="line"><span class="lineno"> 7110</span>    <span class="keywordflow">if</span> ((dst == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (dst_len == 0)) {</div>
<div class="line"><span class="lineno"> 7111</span>        len = -2;</div>
<div class="line"><span class="lineno"> 7112</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((data == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (data_len == 0)) {</div>
<div class="line"><span class="lineno"> 7113</span>        len = -1;</div>
<div class="line"><span class="lineno"> 7114</span>        dst[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 7115</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 7116</span>        name_len = strlen(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno"> 7117</span>        e = data + data_len;</div>
<div class="line"><span class="lineno"> 7118</span>        len = -1;</div>
<div class="line"><span class="lineno"> 7119</span>        dst[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 7120</span> </div>
<div class="line"><span class="lineno"> 7121</span>        <span class="comment">/* data is &quot;var1=val1&amp;var2=val2...&quot;. Find variable first */</span></div>
<div class="line"><span class="lineno"> 7122</span>        <span class="keywordflow">for</span> (p = data; p + name_len &lt; e; p++) {</div>
<div class="line"><span class="lineno"> 7123</span>            <span class="keywordflow">if</span> (((p == data) || (p[-1] == <span class="charliteral">&#39;&amp;&#39;</span>)) &amp;&amp; (p[name_len] == <span class="charliteral">&#39;=&#39;</span>)</div>
<div class="line"><span class="lineno"> 7124</span>                &amp;&amp; !<a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, p, name_len) &amp;&amp; 0 == occurrence--) {</div>
<div class="line"><span class="lineno"> 7125</span>                <span class="comment">/* Point p to variable value */</span></div>
<div class="line"><span class="lineno"> 7126</span>                p += name_len + 1;</div>
<div class="line"><span class="lineno"> 7127</span> </div>
<div class="line"><span class="lineno"> 7128</span>                <span class="comment">/* Point s to the end of the value */</span></div>
<div class="line"><span class="lineno"> 7129</span>                <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)memchr(p, <span class="charliteral">&#39;&amp;&#39;</span>, (<span class="keywordtype">size_t</span>)(e - p));</div>
<div class="line"><span class="lineno"> 7130</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7131</span>                    <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = e;</div>
<div class="line"><span class="lineno"> 7132</span>                }</div>
<div class="line"><span class="lineno"> 7133</span>                <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> &gt;= p);</div>
<div class="line"><span class="lineno"> 7134</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> &lt; p) {</div>
<div class="line"><span class="lineno"> 7135</span>                    <span class="keywordflow">return</span> -3;</div>
<div class="line"><span class="lineno"> 7136</span>                }</div>
<div class="line"><span class="lineno"> 7137</span> </div>
<div class="line"><span class="lineno"> 7138</span>                <span class="comment">/* Decode variable into destination buffer */</span></div>
<div class="line"><span class="lineno"> 7139</span>                len = <a class="code hl_function" href="#a3bdfbeb661f200bdbe2e19e6258bb937">mg_url_decode</a>(p, (<span class="keywordtype">int</span>)(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> - p), dst, (<span class="keywordtype">int</span>)dst_len, 1);</div>
<div class="line"><span class="lineno"> 7140</span> </div>
<div class="line"><span class="lineno"> 7141</span>                <span class="comment">/* Redirect error code from -1 to -2 (destination buffer too</span></div>
<div class="line"><span class="lineno"> 7142</span><span class="comment">                 * small). */</span></div>
<div class="line"><span class="lineno"> 7143</span>                <span class="keywordflow">if</span> (len == -1) {</div>
<div class="line"><span class="lineno"> 7144</span>                    len = -2;</div>
<div class="line"><span class="lineno"> 7145</span>                }</div>
<div class="line"><span class="lineno"> 7146</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 7147</span>            }</div>
<div class="line"><span class="lineno"> 7148</span>        }</div>
<div class="line"><span class="lineno"> 7149</span>    }</div>
<div class="line"><span class="lineno"> 7150</span> </div>
<div class="line"><span class="lineno"> 7151</span>    <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno"> 7152</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00260">DEBUG_ASSERT</a>, <a class="el" href="civetweb_8c_source.html#l03019">mg_strncasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l07048">mg_url_decode()</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="multi_8h_source.html#l00318">s</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l07088">mg_get_var()</a>.</p>

</div>
</div>
<a id="af9c2267422f7bd2de7c610a4e0eb8fb0" name="af9c2267422f7bd2de7c610a4e0eb8fb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9c2267422f7bd2de7c610a4e0eb8fb0">&#9670;&#160;</a></span>mg_global_lock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> void mg_global_lock </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01094">1094</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1095</span>{</div>
<div class="line"><span class="lineno"> 1096</span>    (void)pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a52fa011c62bacc213572e7464ca702dd">global_lock_mutex</a>);</div>
<div class="line"><span class="lineno"> 1097</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01089">global_lock_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l01144">mg_atomic_dec()</a>, <a class="el" href="civetweb_8c_source.html#l01121">mg_atomic_inc()</a>, <a class="el" href="civetweb_8c_source.html#l22477">mg_exit_library()</a>, and <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>.</p>

</div>
</div>
<a id="af8b5fc3bd1b6de9fe6137e7daea140ac" name="af8b5fc3bd1b6de9fe6137e7daea140ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8b5fc3bd1b6de9fe6137e7daea140ac">&#9670;&#160;</a></span>mg_global_unlock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="#a4a93d2e02678a8ce969395e383cdd3e0">FUNCTION_MAY_BE_UNUSED</a> void mg_global_unlock </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01102">1102</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1103</span>{</div>
<div class="line"><span class="lineno"> 1104</span>    (void)pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a52fa011c62bacc213572e7464ca702dd">global_lock_mutex</a>);</div>
<div class="line"><span class="lineno"> 1105</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01089">global_lock_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l01144">mg_atomic_dec()</a>, <a class="el" href="civetweb_8c_source.html#l01121">mg_atomic_inc()</a>, <a class="el" href="civetweb_8c_source.html#l22477">mg_exit_library()</a>, and <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>.</p>

</div>
</div>
<a id="a68fa0720ca91d2de27f7770afa229002" name="a68fa0720ca91d2de27f7770afa229002"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68fa0720ca91d2de27f7770afa229002">&#9670;&#160;</a></span>mg_inet_pton()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_inet_pton </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>af</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>src</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>dst</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>dstlen</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>resolve_src</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09246">9246</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9247</span>{</div>
<div class="line"><span class="lineno"> 9248</span>    <span class="keyword">struct </span>addrinfo hints, *res, *ressave;</div>
<div class="line"><span class="lineno"> 9249</span>    <span class="keywordtype">int</span> func_ret = 0;</div>
<div class="line"><span class="lineno"> 9250</span>    <span class="keywordtype">int</span> gai_ret;</div>
<div class="line"><span class="lineno"> 9251</span> </div>
<div class="line"><span class="lineno"> 9252</span>    memset(&amp;hints, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> addrinfo));</div>
<div class="line"><span class="lineno"> 9253</span>    hints.ai_family = af;</div>
<div class="line"><span class="lineno"> 9254</span>    <span class="keywordflow">if</span> (!resolve_src) {</div>
<div class="line"><span class="lineno"> 9255</span>        hints.ai_flags = AI_NUMERICHOST;</div>
<div class="line"><span class="lineno"> 9256</span>    }</div>
<div class="line"><span class="lineno"> 9257</span> </div>
<div class="line"><span class="lineno"> 9258</span>    gai_ret = getaddrinfo(src, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;hints, &amp;res);</div>
<div class="line"><span class="lineno"> 9259</span>    <span class="keywordflow">if</span> (gai_ret != 0) {</div>
<div class="line"><span class="lineno"> 9260</span>        <span class="comment">/* gai_strerror could be used to convert gai_ret to a string */</span></div>
<div class="line"><span class="lineno"> 9261</span>        <span class="comment">/* POSIX return values: see</span></div>
<div class="line"><span class="lineno"> 9262</span><span class="comment">         * http://pubs.opengroup.org/onlinepubs/9699919799/functions/freeaddrinfo.html</span></div>
<div class="line"><span class="lineno"> 9263</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 9264</span>        <span class="comment">/* Windows return values: see</span></div>
<div class="line"><span class="lineno"> 9265</span><span class="comment">         * https://msdn.microsoft.com/en-us/library/windows/desktop/ms738520%28v=vs.85%29.aspx</span></div>
<div class="line"><span class="lineno"> 9266</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 9267</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9268</span>    }</div>
<div class="line"><span class="lineno"> 9269</span> </div>
<div class="line"><span class="lineno"> 9270</span>    ressave = res;</div>
<div class="line"><span class="lineno"> 9271</span> </div>
<div class="line"><span class="lineno"> 9272</span>    <span class="keywordflow">while</span> (res) {</div>
<div class="line"><span class="lineno"> 9273</span>        <span class="keywordflow">if</span> ((dstlen &gt;= (<span class="keywordtype">size_t</span>)res-&gt;ai_addrlen)</div>
<div class="line"><span class="lineno"> 9274</span>            &amp;&amp; (res-&gt;ai_addr-&gt;sa_family == af)) {</div>
<div class="line"><span class="lineno"> 9275</span>            memcpy(dst, res-&gt;ai_addr, res-&gt;ai_addrlen);</div>
<div class="line"><span class="lineno"> 9276</span>            func_ret = 1;</div>
<div class="line"><span class="lineno"> 9277</span>        }</div>
<div class="line"><span class="lineno"> 9278</span>        res = res-&gt;ai_next;</div>
<div class="line"><span class="lineno"> 9279</span>    }</div>
<div class="line"><span class="lineno"> 9280</span> </div>
<div class="line"><span class="lineno"> 9281</span>    freeaddrinfo(ressave);</div>
<div class="line"><span class="lineno"> 9282</span>    <span class="keywordflow">return</span> func_ret;</div>
<div class="line"><span class="lineno"> 9283</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l13966">parse_match_net()</a>, and <a class="el" href="civetweb_8c_source.html#l15501">parse_port_string()</a>.</p>

</div>
</div>
<a id="ac6e9ad2a3e4f0beb2a938f52c3df50a9" name="ac6e9ad2a3e4f0beb2a938f52c3df50a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6e9ad2a3e4f0beb2a938f52c3df50a9">&#9670;&#160;</a></span>mg_init_library()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> unsigned mg_init_library </td>
          <td>(</td>
          <td class="paramtype">unsigned</td>          <td class="paramname"><span class="paramname"><em>features</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l22347">22347</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">22348</span>{</div>
<div class="line"><span class="lineno">22349</span>    <span class="keywordtype">unsigned</span> features_to_init = <a class="code hl_function" href="#ad6e4a71c131991d1bf9dac0c74b7e8b2">mg_check_feature</a>(features &amp; 0xFFu);</div>
<div class="line"><span class="lineno">22350</span>    <span class="keywordtype">unsigned</span> features_inited = features_to_init;</div>
<div class="line"><span class="lineno">22351</span> </div>
<div class="line"><span class="lineno">22352</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a> &lt;= 0) {</div>
<div class="line"><span class="lineno">22353</span>        <span class="comment">/* Not initialized yet */</span></div>
<div class="line"><span class="lineno">22354</span>        <span class="keywordflow">if</span> (0 != pthread_mutex_init(&amp;<a class="code hl_variable" href="#a52fa011c62bacc213572e7464ca702dd">global_lock_mutex</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">22355</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">22356</span>        }</div>
<div class="line"><span class="lineno">22357</span>    }</div>
<div class="line"><span class="lineno">22358</span> </div>
<div class="line"><span class="lineno">22359</span>    <a class="code hl_function" href="#af9c2267422f7bd2de7c610a4e0eb8fb0">mg_global_lock</a>();</div>
<div class="line"><span class="lineno">22360</span> </div>
<div class="line"><span class="lineno">22361</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a> &lt;= 0) {</div>
<div class="line"><span class="lineno">22362</span>        <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">22363</span>        <span class="keywordtype">size_t</span> len;</div>
<div class="line"><span class="lineno">22364</span> </div>
<div class="line"><span class="lineno">22365</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">22366</span>        <span class="keywordtype">int</span> file_mutex_init = 1;</div>
<div class="line"><span class="lineno">22367</span>        <span class="keywordtype">int</span> wsa = 1;</div>
<div class="line"><span class="lineno">22368</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">22369</span>        <span class="keywordtype">int</span> mutexattr_init = 1;</div>
<div class="line"><span class="lineno">22370</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">22371</span>        <span class="keywordtype">int</span> failed = 1;</div>
<div class="line"><span class="lineno">22372</span>        <span class="keywordtype">int</span> key_create = pthread_key_create(&amp;<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_function" href="#a1b3061c039f873bc927e2947b4e46bae">tls_dtor</a>);</div>
<div class="line"><span class="lineno">22373</span> </div>
<div class="line"><span class="lineno">22374</span>        <span class="keywordflow">if</span> (key_create == 0) {</div>
<div class="line"><span class="lineno">22375</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">22376</span>            file_mutex_init =</div>
<div class="line"><span class="lineno">22377</span>                pthread_mutex_init(&amp;global_log_file_lock, &amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>);</div>
<div class="line"><span class="lineno">22378</span>            <span class="keywordflow">if</span> (file_mutex_init == 0) {</div>
<div class="line"><span class="lineno">22379</span>                <span class="comment">/* Start WinSock */</span></div>
<div class="line"><span class="lineno">22380</span>                WSADATA data;</div>
<div class="line"><span class="lineno">22381</span>                failed = wsa = WSAStartup(MAKEWORD(2, 2), &amp;data);</div>
<div class="line"><span class="lineno">22382</span>            }</div>
<div class="line"><span class="lineno">22383</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">22384</span>            mutexattr_init = pthread_mutexattr_init(&amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>);</div>
<div class="line"><span class="lineno">22385</span>            <span class="keywordflow">if</span> (mutexattr_init == 0) {</div>
<div class="line"><span class="lineno">22386</span>                failed = pthread_mutexattr_settype(&amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>,</div>
<div class="line"><span class="lineno">22387</span>                                                   PTHREAD_MUTEX_RECURSIVE);</div>
<div class="line"><span class="lineno">22388</span>            }</div>
<div class="line"><span class="lineno">22389</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">22390</span>        }</div>
<div class="line"><span class="lineno">22391</span> </div>
<div class="line"><span class="lineno">22392</span>        <span class="keywordflow">if</span> (failed) {</div>
<div class="line"><span class="lineno">22393</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">22394</span>            <span class="keywordflow">if</span> (wsa == 0) {</div>
<div class="line"><span class="lineno">22395</span>                (void)WSACleanup();</div>
<div class="line"><span class="lineno">22396</span>            }</div>
<div class="line"><span class="lineno">22397</span>            <span class="keywordflow">if</span> (file_mutex_init == 0) {</div>
<div class="line"><span class="lineno">22398</span>                (void)pthread_mutex_destroy(&amp;global_log_file_lock);</div>
<div class="line"><span class="lineno">22399</span>            }</div>
<div class="line"><span class="lineno">22400</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">22401</span>            <span class="keywordflow">if</span> (mutexattr_init == 0) {</div>
<div class="line"><span class="lineno">22402</span>                (void)pthread_mutexattr_destroy(&amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>);</div>
<div class="line"><span class="lineno">22403</span>            }</div>
<div class="line"><span class="lineno">22404</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">22405</span>            <span class="keywordflow">if</span> (key_create == 0) {</div>
<div class="line"><span class="lineno">22406</span>                (void)pthread_key_delete(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>);</div>
<div class="line"><span class="lineno">22407</span>            }</div>
<div class="line"><span class="lineno">22408</span>            <a class="code hl_function" href="#af8b5fc3bd1b6de9fe6137e7daea140ac">mg_global_unlock</a>();</div>
<div class="line"><span class="lineno">22409</span>            (void)pthread_mutex_destroy(&amp;<a class="code hl_variable" href="#a52fa011c62bacc213572e7464ca702dd">global_lock_mutex</a>);</div>
<div class="line"><span class="lineno">22410</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">22411</span>        }</div>
<div class="line"><span class="lineno">22412</span> </div>
<div class="line"><span class="lineno">22413</span>        len = 1;</div>
<div class="line"><span class="lineno">22414</span>        <span class="keywordflow">for</span> (i = 0; <a class="code hl_variable" href="#a7b17944603d3fb09046b30ffef0cbfc6">http_methods</a>[i].<a class="code hl_variable" href="structmg__http__method__info.html#afb93afda546e6a8fc26e135c7b1a15f6">name</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; i++) {</div>
<div class="line"><span class="lineno">22415</span>            <span class="keywordtype">size_t</span> sl = strlen(<a class="code hl_variable" href="#a7b17944603d3fb09046b30ffef0cbfc6">http_methods</a>[i].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">22416</span>            len += sl;</div>
<div class="line"><span class="lineno">22417</span>            <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><span class="lineno">22418</span>                len += 2;</div>
<div class="line"><span class="lineno">22419</span>            }</div>
<div class="line"><span class="lineno">22420</span>        }</div>
<div class="line"><span class="lineno">22421</span>        <a class="code hl_variable" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a> = (<span class="keywordtype">char</span> *)<a class="code hl_function" href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a>(len);</div>
<div class="line"><span class="lineno">22422</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a>) {</div>
<div class="line"><span class="lineno">22423</span>            <span class="comment">/* Must never happen */</span></div>
<div class="line"><span class="lineno">22424</span>            <a class="code hl_function" href="#af8b5fc3bd1b6de9fe6137e7daea140ac">mg_global_unlock</a>();</div>
<div class="line"><span class="lineno">22425</span>            (void)pthread_mutex_destroy(&amp;<a class="code hl_variable" href="#a52fa011c62bacc213572e7464ca702dd">global_lock_mutex</a>);</div>
<div class="line"><span class="lineno">22426</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">22427</span>        }</div>
<div class="line"><span class="lineno">22428</span>        <a class="code hl_variable" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a>[0] = 0;</div>
<div class="line"><span class="lineno">22429</span>        <span class="keywordflow">for</span> (i = 0; <a class="code hl_variable" href="#a7b17944603d3fb09046b30ffef0cbfc6">http_methods</a>[i].<a class="code hl_variable" href="structmg__http__method__info.html#afb93afda546e6a8fc26e135c7b1a15f6">name</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; i++) {</div>
<div class="line"><span class="lineno">22430</span>            <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><span class="lineno">22431</span>                strcat(<a class="code hl_variable" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a>, <span class="stringliteral">&quot;, &quot;</span>);</div>
<div class="line"><span class="lineno">22432</span>                strcat(<a class="code hl_variable" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a>, <a class="code hl_variable" href="#a7b17944603d3fb09046b30ffef0cbfc6">http_methods</a>[i].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">22433</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">22434</span>                strcpy(<a class="code hl_variable" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a>, <a class="code hl_variable" href="#a7b17944603d3fb09046b30ffef0cbfc6">http_methods</a>[i].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">22435</span>            }</div>
<div class="line"><span class="lineno">22436</span>        }</div>
<div class="line"><span class="lineno">22437</span>    }</div>
<div class="line"><span class="lineno">22438</span> </div>
<div class="line"><span class="lineno">22439</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">22440</span>    lua_init_optional_libraries();</div>
<div class="line"><span class="lineno">22441</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">22442</span> </div>
<div class="line"><span class="lineno">22443</span><span class="preprocessor">#if (defined(OPENSSL_API_1_0) || defined(OPENSSL_API_1_1)                      \</span></div>
<div class="line"><span class="lineno">22444</span><span class="preprocessor">     || defined(OPENSSL_API_3_0))                                              \</span></div>
<div class="line"><span class="lineno">22445</span><span class="preprocessor">    &amp;&amp; !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno">22446</span> </div>
<div class="line"><span class="lineno">22447</span>    <span class="keywordflow">if</span> (features_to_init &amp; <a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daba4b4d11dd0dec1ba0833f0bb1de2b0e">MG_FEATURES_SSL</a>) {</div>
<div class="line"><span class="lineno">22448</span>        <span class="keywordflow">if</span> (!mg_openssl_initialized) {</div>
<div class="line"><span class="lineno">22449</span>            <span class="keywordtype">char</span> ebuf[128];</div>
<div class="line"><span class="lineno">22450</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#af5e3c74304e46cc4c4774c35bf248d99">initialize_openssl</a>(ebuf, <span class="keyword">sizeof</span>(ebuf))) {</div>
<div class="line"><span class="lineno">22451</span>                mg_openssl_initialized = 1;</div>
<div class="line"><span class="lineno">22452</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">22453</span>                (void)ebuf;</div>
<div class="line"><span class="lineno">22454</span>                <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Initializing SSL failed: %s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">22455</span>                features_inited &amp;= ~((unsigned)(<a class="code hl_enumvalue" href="civetweb_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2daba4b4d11dd0dec1ba0833f0bb1de2b0e">MG_FEATURES_SSL</a>));</div>
<div class="line"><span class="lineno">22456</span>            }</div>
<div class="line"><span class="lineno">22457</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">22458</span>            <span class="comment">/* ssl already initialized */</span></div>
<div class="line"><span class="lineno">22459</span>        }</div>
<div class="line"><span class="lineno">22460</span>    }</div>
<div class="line"><span class="lineno">22461</span> </div>
<div class="line"><span class="lineno">22462</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">22463</span> </div>
<div class="line"><span class="lineno">22464</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a> &lt;= 0) {</div>
<div class="line"><span class="lineno">22465</span>        <a class="code hl_variable" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a> = 1;</div>
<div class="line"><span class="lineno">22466</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">22467</span>        <a class="code hl_variable" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a>++;</div>
<div class="line"><span class="lineno">22468</span>    }</div>
<div class="line"><span class="lineno">22469</span>    <a class="code hl_function" href="#af8b5fc3bd1b6de9fe6137e7daea140ac">mg_global_unlock</a>();</div>
<div class="line"><span class="lineno">22470</span> </div>
<div class="line"><span class="lineno">22471</span>    <span class="keywordflow">return</span> features_inited;</div>
<div class="line"><span class="lineno">22472</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a1b3061c039f873bc927e2947b4e46bae"><div class="ttname"><a href="#a1b3061c039f873bc927e2947b4e46bae">tls_dtor</a></div><div class="ttdeci">static void tls_dtor(void *key)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16321">civetweb.c:16321</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l10876">all_methods</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l01089">global_lock_mutex</a>, <a class="el" href="civetweb_8c_source.html#l10813">http_methods</a>, <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, <a class="el" href="civetweb_8c_source.html#l21430">mg_check_feature()</a>, <a class="el" href="civetweb_8h_source.html#l00067">MG_FEATURES_SSL</a>, <a class="el" href="civetweb_8c_source.html#l01094">mg_global_lock()</a>, <a class="el" href="civetweb_8c_source.html#l01102">mg_global_unlock()</a>, <a class="el" href="civetweb_8c_source.html#l01552">mg_init_library_called</a>, <a class="el" href="civetweb_8c_source.html#l01474">mg_malloc()</a>, <a class="el" href="civetweb_8c_source.html#l10803">mg_http_method_info::name</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01074">pthread_mutex_attr</a>, <a class="el" href="civetweb_8c_source.html#l01580">sTlsKey</a>, and <a class="el" href="civetweb_8c_source.html#l16321">tls_dtor()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20436">legacy_init()</a>, and <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00995">run_client()</a>.</p>

</div>
</div>
<a id="adfdfa9abee970034383cfb3e832d2217" name="adfdfa9abee970034383cfb3e832d2217"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfdfa9abee970034383cfb3e832d2217">&#9670;&#160;</a></span>mg_join_thread()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_join_thread </td>
          <td>(</td>
          <td class="paramtype">pthread_t</td>          <td class="paramname"><span class="paramname"><em>threadid</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l05757">5757</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 5758</span>{</div>
<div class="line"><span class="lineno"> 5759</span>    <span class="keywordtype">int</span> result;</div>
<div class="line"><span class="lineno"> 5760</span> </div>
<div class="line"><span class="lineno"> 5761</span>    result = pthread_join(<a class="code hl_define" href="sqlite3_8c.html#afa8ef032e5cdbbbc7df8cc41bdfc865f">threadid</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 5762</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno"> 5763</span>}</div>
<div class="ttc" id="asqlite3_8c_html_afa8ef032e5cdbbbc7df8cc41bdfc865f"><div class="ttname"><a href="sqlite3_8c.html#afa8ef032e5cdbbbc7df8cc41bdfc865f">threadid</a></div><div class="ttdeci">#define threadid</div><div class="ttdef"><b>Definition</b> <a href="sqlite3_8c_source.html#l33865">sqlite3.c:33865</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="sqlite3_8c_source.html#l33865">threadid</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, <a class="el" href="civetweb_8c_source.html#l17938">mg_close_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l20346">mg_stop()</a>.</p>

</div>
</div>
<a id="a149a7777de4ad5702dfc3a50271e6fb9" name="a149a7777de4ad5702dfc3a50271e6fb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a149a7777de4ad5702dfc3a50271e6fb9">&#9670;&#160;</a></span>mg_lock_connection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_lock_connection </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l13000">13000</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">13001</span>{</div>
<div class="line"><span class="lineno">13002</span>    <span class="keywordflow">if</span> (conn) {</div>
<div class="line"><span class="lineno">13003</span>        (void)pthread_mutex_lock(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a641ac188409fd64c07e486b265d58a03">mutex</a>);</div>
<div class="line"><span class="lineno">13004</span>    }</div>
<div class="line"><span class="lineno">13005</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02565">mg_connection::mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17864">close_connection()</a>.</p>

</div>
</div>
<a id="a0110b7fe742fb4ee2ab467151e4df7c2" name="a0110b7fe742fb4ee2ab467151e4df7c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0110b7fe742fb4ee2ab467151e4df7c2">&#9670;&#160;</a></span>mg_lock_context()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_lock_context </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l13018">13018</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">13019</span>{</div>
<div class="line"><span class="lineno">13020</span>    <span class="keywordflow">if</span> (ctx &amp;&amp; (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099">CONTEXT_SERVER</a>)) {</div>
<div class="line"><span class="lineno">13021</span>        (void)pthread_mutex_lock(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afc4b8c1d52b30239820683d842e975fe">nonce_mutex</a>);</div>
<div class="line"><span class="lineno">13022</span>    }</div>
<div class="line"><span class="lineno">13023</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02263">CONTEXT_SERVER</a>, <a class="el" href="civetweb_8c_source.html#l02354">mg_context::context_type</a>, and <a class="el" href="civetweb_8c_source.html#l02427">mg_context::nonce_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l12931">dav_unlock_file()</a>, <a class="el" href="civetweb_8c_source.html#l14560">get_request_handler()</a>, <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, <a class="el" href="civetweb_8c_source.html#l16377">refresh_trust()</a>, <a class="el" href="civetweb_8c_source.html#l14687">release_handler_ref()</a>, <a class="el" href="civetweb_8c_source.html#l08974">send_authorization_request()</a>, <a class="el" href="civetweb_8c_source.html#l17066">ssl_servername_callback()</a>, <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>, and <a class="el" href="civetweb_8c_source.html#l14174">switch_domain_context()</a>.</p>

</div>
</div>
<a id="a31c4ed6838b7bb49804a5ffa030762e5" name="a31c4ed6838b7bb49804a5ffa030762e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31c4ed6838b7bb49804a5ffa030762e5">&#9670;&#160;</a></span>mg_malloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static __inline void * mg_malloc </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>a</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01474">1474</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1475</span>{</div>
<div class="line"><span class="lineno"> 1476</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="#acf143577800376dd931c059ecc61ba06">malloc</a>(<a class="code hl_class" href="classa.html">a</a>);</div>
<div class="line"><span class="lineno"> 1477</span>}</div>
<div class="ttc" id="acivetweb_8c_html_acf143577800376dd931c059ecc61ba06"><div class="ttname"><a href="#acf143577800376dd931c059ecc61ba06">malloc</a></div><div class="ttdeci">#define malloc</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01539">civetweb.c:1539</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01539">malloc</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06939">alloc_vprintf()</a>, <a class="el" href="civetweb_8c_source.html#l06906">alloc_vprintf2()</a>, <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, <a class="el" href="civetweb_8c_source.html#l01626">mg_current_thread_id()</a>, <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>, and <a class="el" href="civetweb_8c_source.html#l09609">print_dir_entry()</a>.</p>

</div>
</div>
<a id="a9a1f27cd059fa56ead5cecaf7885582f" name="a9a1f27cd059fa56ead5cecaf7885582f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a1f27cd059fa56ead5cecaf7885582f">&#9670;&#160;</a></span>mg_md5()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> char * mg_md5 </td>
          <td>(</td>
          <td class="paramtype">char</td>          <td class="paramname"><span class="paramname"><em>buf</em>[33], </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08404">8404</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8405</span>{</div>
<div class="line"><span class="lineno"> 8406</span>    md5_byte_t hash[16];</div>
<div class="line"><span class="lineno"> 8407</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *p;</div>
<div class="line"><span class="lineno"> 8408</span>    va_list ap;</div>
<div class="line"><span class="lineno"> 8409</span>    md5_state_t ctx;</div>
<div class="line"><span class="lineno"> 8410</span> </div>
<div class="line"><span class="lineno"> 8411</span>    md5_init(&amp;ctx);</div>
<div class="line"><span class="lineno"> 8412</span> </div>
<div class="line"><span class="lineno"> 8413</span>    va_start(ap, buf);</div>
<div class="line"><span class="lineno"> 8414</span>    <span class="keywordflow">while</span> ((p = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8415</span>        md5_append(&amp;ctx, (<span class="keyword">const</span> md5_byte_t *)p, strlen(p));</div>
<div class="line"><span class="lineno"> 8416</span>    }</div>
<div class="line"><span class="lineno"> 8417</span>    va_end(ap);</div>
<div class="line"><span class="lineno"> 8418</span> </div>
<div class="line"><span class="lineno"> 8419</span>    md5_finish(&amp;ctx, hash);</div>
<div class="line"><span class="lineno"> 8420</span>    <a class="code hl_function" href="#a8694301743d1c8f3bc37f058a1e0de2a">bin2str</a>(buf, hash, <span class="keyword">sizeof</span>(hash));</div>
<div class="line"><span class="lineno"> 8421</span>    <span class="keywordflow">return</span> buf;</div>
<div class="line"><span class="lineno"> 8422</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a8694301743d1c8f3bc37f058a1e0de2a"><div class="ttname"><a href="#a8694301743d1c8f3bc37f058a1e0de2a">bin2str</a></div><div class="ttdeci">static void bin2str(char *to, const unsigned char *p, size_t len)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08389">civetweb.c:8389</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l08389">bin2str()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08427">check_password_digest()</a>, <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l09220">mg_modify_passwords_file()</a>, and <a class="el" href="civetweb_8c_source.html#l08733">read_auth_file()</a>.</p>

</div>
</div>
<a id="a7953fa655c4cfce96b429267e2b4ba67" name="a7953fa655c4cfce96b429267e2b4ba67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7953fa655c4cfce96b429267e2b4ba67">&#9670;&#160;</a></span>mg_modify_passwords_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_modify_passwords_file </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fname</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>domain</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>user</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>pass</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09220">9220</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9224</span>{</div>
<div class="line"><span class="lineno"> 9225</span>    <span class="keywordtype">char</span> ha1buf[33];</div>
<div class="line"><span class="lineno"> 9226</span>    <span class="keywordflow">if</span> ((fname == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (domain == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (user == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 9227</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9228</span>    }</div>
<div class="line"><span class="lineno"> 9229</span>    <span class="keywordflow">if</span> ((pass == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (pass[0] == 0)) {</div>
<div class="line"><span class="lineno"> 9230</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="#aa9da2dc01380431f8028fee47b939bcd">mg_modify_passwords_file_ha1</a>(fname, domain, user, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 9231</span>    }</div>
<div class="line"><span class="lineno"> 9232</span> </div>
<div class="line"><span class="lineno"> 9233</span>    <a class="code hl_function" href="#a9a1f27cd059fa56ead5cecaf7885582f">mg_md5</a>(ha1buf, user, <span class="stringliteral">&quot;:&quot;</span>, domain, <span class="stringliteral">&quot;:&quot;</span>, pass, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 9234</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#aa9da2dc01380431f8028fee47b939bcd">mg_modify_passwords_file_ha1</a>(fname, domain, user, ha1buf);</div>
<div class="line"><span class="lineno"> 9235</span>}</div>
<div class="ttc" id="acivetweb_8c_html_aa9da2dc01380431f8028fee47b939bcd"><div class="ttname"><a href="#aa9da2dc01380431f8028fee47b939bcd">mg_modify_passwords_file_ha1</a></div><div class="ttdeci">CIVETWEB_API int mg_modify_passwords_file_ha1(const char *fname, const char *domain, const char *user, const char *ha1)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l09057">civetweb.c:9057</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l08404">mg_md5()</a>, <a class="el" href="civetweb_8c_source.html#l09057">mg_modify_passwords_file_ha1()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="vendor_2civetweb_2main_8c_source.html#l01181">start_civetweb()</a>.</p>

</div>
</div>
<a id="aa9da2dc01380431f8028fee47b939bcd" name="aa9da2dc01380431f8028fee47b939bcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9da2dc01380431f8028fee47b939bcd">&#9670;&#160;</a></span>mg_modify_passwords_file_ha1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_modify_passwords_file_ha1 </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fname</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>domain</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>user</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>ha1</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09057">9057</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9061</span>{</div>
<div class="line"><span class="lineno"> 9062</span>    <span class="keywordtype">int</span> found = 0, i, result = 1;</div>
<div class="line"><span class="lineno"> 9063</span>    <span class="keywordtype">char</span> line[512], u[256], d[256], h[256];</div>
<div class="line"><span class="lineno"> 9064</span>    <span class="keyword">struct </span>stat st = {0};</div>
<div class="line"><span class="lineno"> 9065</span>    FILE *fp = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 9066</span>    <span class="keywordtype">char</span> *temp_file = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 9067</span>    <span class="keywordtype">int</span> temp_file_offs = 0;</div>
<div class="line"><span class="lineno"> 9068</span> </div>
<div class="line"><span class="lineno"> 9069</span>    <span class="comment">/* Regard empty password as no password - remove user record. */</span></div>
<div class="line"><span class="lineno"> 9070</span>    <span class="keywordflow">if</span> ((ha1 != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (ha1[0] == <span class="charliteral">&#39;\0&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 9071</span>        ha1 = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 9072</span>    }</div>
<div class="line"><span class="lineno"> 9073</span> </div>
<div class="line"><span class="lineno"> 9074</span>    <span class="comment">/* Other arguments must not be empty */</span></div>
<div class="line"><span class="lineno"> 9075</span>    <span class="keywordflow">if</span> ((fname == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (domain == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (user == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 9076</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9077</span>    }</div>
<div class="line"><span class="lineno"> 9078</span> </div>
<div class="line"><span class="lineno"> 9079</span>    <span class="comment">/* Using the given file format, user name and domain must not contain</span></div>
<div class="line"><span class="lineno"> 9080</span><span class="comment">     * the &#39;:&#39; character */</span></div>
<div class="line"><span class="lineno"> 9081</span>    <span class="keywordflow">if</span> (strchr(user, <span class="charliteral">&#39;:&#39;</span>) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9082</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9083</span>    }</div>
<div class="line"><span class="lineno"> 9084</span>    <span class="keywordflow">if</span> (strchr(domain, <span class="charliteral">&#39;:&#39;</span>) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9085</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9086</span>    }</div>
<div class="line"><span class="lineno"> 9087</span> </div>
<div class="line"><span class="lineno"> 9088</span>    <span class="comment">/* Do not allow control characters like newline in user name and domain.</span></div>
<div class="line"><span class="lineno"> 9089</span><span class="comment">     * Do not allow excessively long names either. */</span></div>
<div class="line"><span class="lineno"> 9090</span>    <span class="keywordflow">for</span> (i = 0; ((i &lt; 255) &amp;&amp; (user[i] != 0)); i++) {</div>
<div class="line"><span class="lineno"> 9091</span>        <span class="keywordflow">if</span> (iscntrl((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)user[i])) {</div>
<div class="line"><span class="lineno"> 9092</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9093</span>        }</div>
<div class="line"><span class="lineno"> 9094</span>    }</div>
<div class="line"><span class="lineno"> 9095</span>    <span class="keywordflow">if</span> (user[i]) {</div>
<div class="line"><span class="lineno"> 9096</span>        <span class="keywordflow">return</span> 0; <span class="comment">/* user name too long */</span></div>
<div class="line"><span class="lineno"> 9097</span>    }</div>
<div class="line"><span class="lineno"> 9098</span>    <span class="keywordflow">for</span> (i = 0; ((i &lt; 255) &amp;&amp; (domain[i] != 0)); i++) {</div>
<div class="line"><span class="lineno"> 9099</span>        <span class="keywordflow">if</span> (iscntrl((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)domain[i])) {</div>
<div class="line"><span class="lineno"> 9100</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9101</span>        }</div>
<div class="line"><span class="lineno"> 9102</span>    }</div>
<div class="line"><span class="lineno"> 9103</span>    <span class="keywordflow">if</span> (domain[i]) {</div>
<div class="line"><span class="lineno"> 9104</span>        <span class="keywordflow">return</span> 0; <span class="comment">/* domain name too long */</span></div>
<div class="line"><span class="lineno"> 9105</span>    }</div>
<div class="line"><span class="lineno"> 9106</span> </div>
<div class="line"><span class="lineno"> 9107</span>    <span class="comment">/* The maximum length of the path to the password file is limited */</span></div>
<div class="line"><span class="lineno"> 9108</span>    <span class="keywordflow">if</span> (strlen(fname) &gt;= <a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>) {</div>
<div class="line"><span class="lineno"> 9109</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9110</span>    }</div>
<div class="line"><span class="lineno"> 9111</span> </div>
<div class="line"><span class="lineno"> 9112</span>    <span class="comment">/* Check if the file exists, and get file size */</span></div>
<div class="line"><span class="lineno"> 9113</span>    <span class="keywordflow">if</span> (0 == stat(fname, &amp;st)) {</div>
<div class="line"><span class="lineno"> 9114</span>        <span class="keywordtype">int</span> temp_buf_len;</div>
<div class="line"><span class="lineno"> 9115</span>        <span class="keywordflow">if</span> (st.st_size &gt; 10485760) {</div>
<div class="line"><span class="lineno"> 9116</span>            <span class="comment">/* Some funster provided a &gt;10 MB text file */</span></div>
<div class="line"><span class="lineno"> 9117</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9118</span>        }</div>
<div class="line"><span class="lineno"> 9119</span> </div>
<div class="line"><span class="lineno"> 9120</span>        <span class="comment">/* Add enough space for one more line */</span></div>
<div class="line"><span class="lineno"> 9121</span>        temp_buf_len = (int)st.st_size + 1024;</div>
<div class="line"><span class="lineno"> 9122</span> </div>
<div class="line"><span class="lineno"> 9123</span>        <span class="comment">/* Allocate memory (instead of using a temporary file) */</span></div>
<div class="line"><span class="lineno"> 9124</span>        temp_file = (<span class="keywordtype">char</span> *)<a class="code hl_function" href="#ad3552193bd019b58e092032223ac38f1">mg_calloc</a>((<span class="keywordtype">size_t</span>)temp_buf_len, 1);</div>
<div class="line"><span class="lineno"> 9125</span>        <span class="keywordflow">if</span> (!temp_file) {</div>
<div class="line"><span class="lineno"> 9126</span>            <span class="comment">/* Out of memory */</span></div>
<div class="line"><span class="lineno"> 9127</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9128</span>        }</div>
<div class="line"><span class="lineno"> 9129</span> </div>
<div class="line"><span class="lineno"> 9130</span>        <span class="comment">/* File exists. Read it into a memory buffer. */</span></div>
<div class="line"><span class="lineno"> 9131</span>        fp = fopen(fname, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno"> 9132</span>        <span class="keywordflow">if</span> (fp == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9133</span>            <span class="comment">/* Cannot read file. No permission? */</span></div>
<div class="line"><span class="lineno"> 9134</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(temp_file);</div>
<div class="line"><span class="lineno"> 9135</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9136</span>        }</div>
<div class="line"><span class="lineno"> 9137</span> </div>
<div class="line"><span class="lineno"> 9138</span>        <span class="comment">/* Read content and store in memory */</span></div>
<div class="line"><span class="lineno"> 9139</span>        <span class="keywordflow">while</span> ((fgets(line, <span class="keyword">sizeof</span>(line), fp) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno"> 9140</span>               &amp;&amp; ((temp_file_offs + 600) &lt; temp_buf_len)) {</div>
<div class="line"><span class="lineno"> 9141</span>            <span class="comment">/* file format is &quot;user:domain:hash\n&quot; */</span></div>
<div class="line"><span class="lineno"> 9142</span>            <span class="keywordflow">if</span> (sscanf(line, <span class="stringliteral">&quot;%255[^:]:%255[^:]:%255s&quot;</span>, u, d, h) != 3) {</div>
<div class="line"><span class="lineno"> 9143</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 9144</span>            }</div>
<div class="line"><span class="lineno"> 9145</span>            u[255] = 0;</div>
<div class="line"><span class="lineno"> 9146</span>            d[255] = 0;</div>
<div class="line"><span class="lineno"> 9147</span>            h[255] = 0;</div>
<div class="line"><span class="lineno"> 9148</span> </div>
<div class="line"><span class="lineno"> 9149</span>            <span class="keywordflow">if</span> (!strcmp(u, user) &amp;&amp; !strcmp(d, domain)) {</div>
<div class="line"><span class="lineno"> 9150</span>                <span class="comment">/* Found the user: change the password hash or drop the user</span></div>
<div class="line"><span class="lineno"> 9151</span><span class="comment">                 */</span></div>
<div class="line"><span class="lineno"> 9152</span>                <span class="keywordflow">if</span> ((ha1 != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (!found)) {</div>
<div class="line"><span class="lineno"> 9153</span>                    i = sprintf(temp_file + temp_file_offs,</div>
<div class="line"><span class="lineno"> 9154</span>                                <span class="stringliteral">&quot;%s:%s:%s\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 9155</span>                                user,</div>
<div class="line"><span class="lineno"> 9156</span>                                domain,</div>
<div class="line"><span class="lineno"> 9157</span>                                ha1);</div>
<div class="line"><span class="lineno"> 9158</span>                    <span class="keywordflow">if</span> (i &lt; 1) {</div>
<div class="line"><span class="lineno"> 9159</span>                        fclose(fp);</div>
<div class="line"><span class="lineno"> 9160</span>                        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(temp_file);</div>
<div class="line"><span class="lineno"> 9161</span>                        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9162</span>                    }</div>
<div class="line"><span class="lineno"> 9163</span>                    temp_file_offs += i;</div>
<div class="line"><span class="lineno"> 9164</span>                }</div>
<div class="line"><span class="lineno"> 9165</span>                found = 1;</div>
<div class="line"><span class="lineno"> 9166</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 9167</span>                <span class="comment">/* Copy existing user, including password hash */</span></div>
<div class="line"><span class="lineno"> 9168</span>                i = sprintf(temp_file + temp_file_offs, <span class="stringliteral">&quot;%s:%s:%s\n&quot;</span>, u, d, h);</div>
<div class="line"><span class="lineno"> 9169</span>                <span class="keywordflow">if</span> (i &lt; 1) {</div>
<div class="line"><span class="lineno"> 9170</span>                    fclose(fp);</div>
<div class="line"><span class="lineno"> 9171</span>                    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(temp_file);</div>
<div class="line"><span class="lineno"> 9172</span>                    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9173</span>                }</div>
<div class="line"><span class="lineno"> 9174</span>                temp_file_offs += i;</div>
<div class="line"><span class="lineno"> 9175</span>            }</div>
<div class="line"><span class="lineno"> 9176</span>        }</div>
<div class="line"><span class="lineno"> 9177</span>        fclose(fp);</div>
<div class="line"><span class="lineno"> 9178</span>    }</div>
<div class="line"><span class="lineno"> 9179</span> </div>
<div class="line"><span class="lineno"> 9180</span>    <span class="comment">/* Create new file */</span></div>
<div class="line"><span class="lineno"> 9181</span>    fp = fopen(fname, <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><span class="lineno"> 9182</span>    <span class="keywordflow">if</span> (!fp) {</div>
<div class="line"><span class="lineno"> 9183</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(temp_file);</div>
<div class="line"><span class="lineno"> 9184</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9185</span>    }</div>
<div class="line"><span class="lineno"> 9186</span> </div>
<div class="line"><span class="lineno"> 9187</span><span class="preprocessor">#if !defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 9188</span>    <span class="comment">/* On Linux &amp; co., restrict file read/write permissions to the owner */</span></div>
<div class="line"><span class="lineno"> 9189</span>    <span class="keywordflow">if</span> (fchmod(fileno(fp), S_IRUSR | S_IWUSR) != 0) {</div>
<div class="line"><span class="lineno"> 9190</span>        result = 0;</div>
<div class="line"><span class="lineno"> 9191</span>    }</div>
<div class="line"><span class="lineno"> 9192</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9193</span> </div>
<div class="line"><span class="lineno"> 9194</span>    <span class="keywordflow">if</span> ((temp_file != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (temp_file_offs &gt; 0)) {</div>
<div class="line"><span class="lineno"> 9195</span>        <span class="comment">/* Store buffered content of old file */</span></div>
<div class="line"><span class="lineno"> 9196</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite</a>(temp_file, 1, (<span class="keywordtype">size_t</span>)temp_file_offs, fp)</div>
<div class="line"><span class="lineno"> 9197</span>            != (<span class="keywordtype">size_t</span>)temp_file_offs) {</div>
<div class="line"><span class="lineno"> 9198</span>            result = 0;</div>
<div class="line"><span class="lineno"> 9199</span>        }</div>
<div class="line"><span class="lineno"> 9200</span>    }</div>
<div class="line"><span class="lineno"> 9201</span> </div>
<div class="line"><span class="lineno"> 9202</span>    <span class="comment">/* If new user, just add it */</span></div>
<div class="line"><span class="lineno"> 9203</span>    <span class="keywordflow">if</span> ((ha1 != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (!found)) {</div>
<div class="line"><span class="lineno"> 9204</span>        <span class="keywordflow">if</span> (fprintf(fp, <span class="stringliteral">&quot;%s:%s:%s\n&quot;</span>, user, domain, ha1) &lt; 6) {</div>
<div class="line"><span class="lineno"> 9205</span>            result = 0;</div>
<div class="line"><span class="lineno"> 9206</span>        }</div>
<div class="line"><span class="lineno"> 9207</span>    }</div>
<div class="line"><span class="lineno"> 9208</span> </div>
<div class="line"><span class="lineno"> 9209</span>    <span class="comment">/* All data written */</span></div>
<div class="line"><span class="lineno"> 9210</span>    <span class="keywordflow">if</span> (fclose(fp) != 0) {</div>
<div class="line"><span class="lineno"> 9211</span>        result = 0;</div>
<div class="line"><span class="lineno"> 9212</span>    }</div>
<div class="line"><span class="lineno"> 9213</span> </div>
<div class="line"><span class="lineno"> 9214</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(temp_file);</div>
<div class="line"><span class="lineno"> 9215</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno"> 9216</span>}</div>
<div class="ttc" id="astdcheaders_8h_html_ae791f89cbd418b3074b1349d8f5075dd"><div class="ttname"><a href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite</a></div><div class="ttdeci">size_t fwrite(const void *, size_t, size_t, FILE *)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite()</a>, <a class="el" href="civetweb_8c_source.html#l01480">mg_calloc()</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09220">mg_modify_passwords_file()</a>.</p>

</div>
</div>
<a id="a11ef653a52d878a00eb3d51b73c966f5" name="a11ef653a52d878a00eb3d51b73c966f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11ef653a52d878a00eb3d51b73c966f5">&#9670;&#160;</a></span>mg_path_suspicious()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_path_suspicious </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02871">2871</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2872</span>{</div>
<div class="line"><span class="lineno"> 2873</span>    <span class="keyword">const</span> uint8_t *c = (<span class="keyword">const</span> uint8_t *)path;</div>
<div class="line"><span class="lineno"> 2874</span>    (void)conn; <span class="comment">/* not used */</span></div>
<div class="line"><span class="lineno"> 2875</span> </div>
<div class="line"><span class="lineno"> 2876</span>    <span class="keywordflow">if</span> ((c == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (c[0] == 0)) {</div>
<div class="line"><span class="lineno"> 2877</span>        <span class="comment">/* Null pointer or empty path --&gt; suspicious */</span></div>
<div class="line"><span class="lineno"> 2878</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 2879</span>    }</div>
<div class="line"><span class="lineno"> 2880</span> </div>
<div class="line"><span class="lineno"> 2881</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 2882</span>    <span class="keywordflow">while</span> (*c) {</div>
<div class="line"><span class="lineno"> 2883</span>        <span class="keywordflow">if</span> (*c &lt; 32) {</div>
<div class="line"><span class="lineno"> 2884</span>            <span class="comment">/* Control character */</span></div>
<div class="line"><span class="lineno"> 2885</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 2886</span>        }</div>
<div class="line"><span class="lineno"> 2887</span>        <span class="keywordflow">if</span> ((*c == <span class="charliteral">&#39;&gt;&#39;</span>) || (*c == <span class="charliteral">&#39;&lt;&#39;</span>) || (*c == <span class="charliteral">&#39;|&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 2888</span>            <span class="comment">/* stdin/stdout redirection character */</span></div>
<div class="line"><span class="lineno"> 2889</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 2890</span>        }</div>
<div class="line"><span class="lineno"> 2891</span>        <span class="keywordflow">if</span> ((*c == <span class="charliteral">&#39;*&#39;</span>) || (*c == <span class="charliteral">&#39;?&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 2892</span>            <span class="comment">/* Wildcard character */</span></div>
<div class="line"><span class="lineno"> 2893</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 2894</span>        }</div>
<div class="line"><span class="lineno"> 2895</span>        <span class="keywordflow">if</span> (*c == <span class="charliteral">&#39;&quot;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 2896</span>            <span class="comment">/* Windows quotation */</span></div>
<div class="line"><span class="lineno"> 2897</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 2898</span>        }</div>
<div class="line"><span class="lineno"> 2899</span>        c++;</div>
<div class="line"><span class="lineno"> 2900</span>    }</div>
<div class="line"><span class="lineno"> 2901</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2902</span> </div>
<div class="line"><span class="lineno"> 2903</span>    <span class="comment">/* Nothing suspicious found */</span></div>
<div class="line"><span class="lineno"> 2904</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2905</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, and <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>.</p>

</div>
</div>
<a id="a3b9904a2b6ed6d472f5ee35c7c588863" name="a3b9904a2b6ed6d472f5ee35c7c588863"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b9904a2b6ed6d472f5ee35c7c588863">&#9670;&#160;</a></span>mg_poll()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_poll </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> *</td>          <td class="paramname"><span class="paramname"><em>pfd</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>n</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>milliseconds</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="#ac751248c6cb5f0bce10051d41a22d964">stop_flag_t</a> *</td>          <td class="paramname"><span class="paramname"><em>stop_flag</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l05938">5938</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 5942</span>{</div>
<div class="line"><span class="lineno"> 5943</span>    <span class="comment">/* Call poll, but only for a maximum time of a few seconds.</span></div>
<div class="line"><span class="lineno"> 5944</span><span class="comment">     * This will allow to stop the server after some seconds, instead</span></div>
<div class="line"><span class="lineno"> 5945</span><span class="comment">     * of having to wait for a long socket timeout. */</span></div>
<div class="line"><span class="lineno"> 5946</span>    <span class="keywordtype">int</span> ms_now = <a class="code hl_define" href="#abd345577a07dba9941d4cea32b4cf4fd">SOCKET_TIMEOUT_QUANTUM</a>; <span class="comment">/* Sleep quantum in ms */</span></div>
<div class="line"><span class="lineno"> 5947</span> </div>
<div class="line"><span class="lineno"> 5948</span>    <span class="keywordtype">int</span> check_pollerr = 0;</div>
<div class="line"><span class="lineno"> 5949</span>    <span class="keywordflow">if</span> ((n == 1) &amp;&amp; ((pfd[0].events &amp; POLLERR) == 0)) {</div>
<div class="line"><span class="lineno"> 5950</span>        <span class="comment">/* If we wait for only one file descriptor, wait on error as well */</span></div>
<div class="line"><span class="lineno"> 5951</span>        pfd[0].events |= POLLERR;</div>
<div class="line"><span class="lineno"> 5952</span>        check_pollerr = 1;</div>
<div class="line"><span class="lineno"> 5953</span>    }</div>
<div class="line"><span class="lineno"> 5954</span> </div>
<div class="line"><span class="lineno"> 5955</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 5956</span>        <span class="keywordtype">int</span> result;</div>
<div class="line"><span class="lineno"> 5957</span> </div>
<div class="line"><span class="lineno"> 5958</span>        <span class="keywordflow">if</span> (!<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;*stop_flag)) {</div>
<div class="line"><span class="lineno"> 5959</span>            <span class="comment">/* Shut down signal */</span></div>
<div class="line"><span class="lineno"> 5960</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 5961</span>        }</div>
<div class="line"><span class="lineno"> 5962</span> </div>
<div class="line"><span class="lineno"> 5963</span>        <span class="keywordflow">if</span> ((milliseconds &gt;= 0) &amp;&amp; (milliseconds &lt; ms_now)) {</div>
<div class="line"><span class="lineno"> 5964</span>            ms_now = milliseconds;</div>
<div class="line"><span class="lineno"> 5965</span>        }</div>
<div class="line"><span class="lineno"> 5966</span> </div>
<div class="line"><span class="lineno"> 5967</span>        result = poll(pfd, n, ms_now);</div>
<div class="line"><span class="lineno"> 5968</span>        <span class="keywordflow">if</span> (result != 0) {</div>
<div class="line"><span class="lineno"> 5969</span>            <span class="keywordtype">int</span> err = <a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno"> 5970</span>            <span class="keywordflow">if</span> ((result == 1) || (!<a class="code hl_define" href="#accab0bdb9395175c8b0f2565d2f862b5">ERROR_TRY_AGAIN</a>(err))) {</div>
<div class="line"><span class="lineno"> 5971</span>                <span class="comment">/* Poll returned either success (1) or error (-1).</span></div>
<div class="line"><span class="lineno"> 5972</span><span class="comment">                 * Forward both to the caller. */</span></div>
<div class="line"><span class="lineno"> 5973</span>                <span class="keywordflow">if</span> ((check_pollerr)</div>
<div class="line"><span class="lineno"> 5974</span>                    &amp;&amp; ((pfd[0].revents &amp; (POLLIN | POLLOUT | POLLERR))</div>
<div class="line"><span class="lineno"> 5975</span>                        == POLLERR)) {</div>
<div class="line"><span class="lineno"> 5976</span>                    <span class="comment">/* One and only file descriptor returned error */</span></div>
<div class="line"><span class="lineno"> 5977</span>                    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 5978</span>                }</div>
<div class="line"><span class="lineno"> 5979</span>                <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno"> 5980</span>            }</div>
<div class="line"><span class="lineno"> 5981</span>        }</div>
<div class="line"><span class="lineno"> 5982</span> </div>
<div class="line"><span class="lineno"> 5983</span>        <span class="comment">/* Poll returned timeout (0). */</span></div>
<div class="line"><span class="lineno"> 5984</span>        <span class="keywordflow">if</span> (milliseconds &gt; 0) {</div>
<div class="line"><span class="lineno"> 5985</span>            milliseconds -= ms_now;</div>
<div class="line"><span class="lineno"> 5986</span>        }</div>
<div class="line"><span class="lineno"> 5987</span> </div>
<div class="line"><span class="lineno"> 5988</span>    } <span class="keywordflow">while</span> (milliseconds &gt; 0);</div>
<div class="line"><span class="lineno"> 5989</span> </div>
<div class="line"><span class="lineno"> 5990</span>    <span class="comment">/* timeout: return 0 */</span></div>
<div class="line"><span class="lineno"> 5991</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 5992</span>}</div>
<div class="ttc" id="acivetweb_8c_html_accab0bdb9395175c8b0f2565d2f862b5"><div class="ttname"><a href="#accab0bdb9395175c8b0f2565d2f862b5">ERROR_TRY_AGAIN</a></div><div class="ttdeci">#define ERROR_TRY_AGAIN(err)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00447">civetweb.c:447</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l00447">ERROR_TRY_AGAIN</a>, <a class="el" href="civetweb_8c_source.html#l00473">SOCKET_TIMEOUT_QUANTUM</a>, and <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, <a class="el" href="civetweb_8c_source.html#l06210">pull_inner()</a>, <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>, and <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>.</p>

</div>
</div>
<a id="accee9ed1fe40036abe9b36eac86b4121" name="accee9ed1fe40036abe9b36eac86b4121"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accee9ed1fe40036abe9b36eac86b4121">&#9670;&#160;</a></span>mg_printf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_printf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07034">7034</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7035</span>{</div>
<div class="line"><span class="lineno"> 7036</span>    va_list ap;</div>
<div class="line"><span class="lineno"> 7037</span>    <span class="keywordtype">int</span> result;</div>
<div class="line"><span class="lineno"> 7038</span> </div>
<div class="line"><span class="lineno"> 7039</span>    va_start(ap, fmt);</div>
<div class="line"><span class="lineno"> 7040</span>    result = <a class="code hl_function" href="#ab1c003c5b952dd24c95b887def277814">mg_vprintf</a>(conn, fmt, ap);</div>
<div class="line"><span class="lineno"> 7041</span>    va_end(ap);</div>
<div class="line"><span class="lineno"> 7042</span> </div>
<div class="line"><span class="lineno"> 7043</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno"> 7044</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l07016">mg_vprintf()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l12964">dav_proppatch()</a>, <a class="el" href="civetweb_8c_source.html#l11184">forward_body_data()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l12759">handle_propfind()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l09609">print_dir_entry()</a>, <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>, <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00995">run_client()</a>, and <a class="el" href="server_8c_source.html#l00026">user_handler()</a>.</p>

</div>
</div>
<a id="afeb3b13a0524f5532d16953927743966" name="afeb3b13a0524f5532d16953927743966"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeb3b13a0524f5532d16953927743966">&#9670;&#160;</a></span>mg_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06614">6614</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6615</span>{</div>
<div class="line"><span class="lineno"> 6616</span>    <span class="keywordflow">if</span> (len &gt; INT_MAX) {</div>
<div class="line"><span class="lineno"> 6617</span>        len = INT_MAX;</div>
<div class="line"><span class="lineno"> 6618</span>    }</div>
<div class="line"><span class="lineno"> 6619</span> </div>
<div class="line"><span class="lineno"> 6620</span>    <span class="keywordflow">if</span> (conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6621</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 6622</span>    }</div>
<div class="line"><span class="lineno"> 6623</span> </div>
<div class="line"><span class="lineno"> 6624</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a>) {</div>
<div class="line"><span class="lineno"> 6625</span>        <span class="keywordtype">size_t</span> all_read = 0;</div>
<div class="line"><span class="lineno"> 6626</span> </div>
<div class="line"><span class="lineno"> 6627</span>        <span class="keywordflow">while</span> (len &gt; 0) {</div>
<div class="line"><span class="lineno"> 6628</span>            <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> &gt;= 3) {</div>
<div class="line"><span class="lineno"> 6629</span>                <span class="comment">/* No more data left to read */</span></div>
<div class="line"><span class="lineno"> 6630</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 6631</span>            }</div>
<div class="line"><span class="lineno"> 6632</span>            <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> != 1) {</div>
<div class="line"><span class="lineno"> 6633</span>                <span class="comment">/* Has error */</span></div>
<div class="line"><span class="lineno"> 6634</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6635</span>            }</div>
<div class="line"><span class="lineno"> 6636</span> </div>
<div class="line"><span class="lineno"> 6637</span>            <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a> != conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>) {</div>
<div class="line"><span class="lineno"> 6638</span>                <span class="comment">/* copy from the current chunk */</span></div>
<div class="line"><span class="lineno"> 6639</span>                <span class="keywordtype">int</span> read_ret = <a class="code hl_function" href="#a59c90f7b25d805478984a16ba5ee5fc7">mg_read_inner</a>(conn, (<span class="keywordtype">char</span> *)buf + all_read, len);</div>
<div class="line"><span class="lineno"> 6640</span> </div>
<div class="line"><span class="lineno"> 6641</span>                <span class="keywordflow">if</span> (read_ret &lt; 1) {</div>
<div class="line"><span class="lineno"> 6642</span>                    <span class="comment">/* read error */</span></div>
<div class="line"><span class="lineno"> 6643</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 2;</div>
<div class="line"><span class="lineno"> 6644</span>                    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6645</span>                }</div>
<div class="line"><span class="lineno"> 6646</span> </div>
<div class="line"><span class="lineno"> 6647</span>                all_read += (size_t)read_ret;</div>
<div class="line"><span class="lineno"> 6648</span>                len -= (size_t)read_ret;</div>
<div class="line"><span class="lineno"> 6649</span> </div>
<div class="line"><span class="lineno"> 6650</span>                <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a> == conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>) {</div>
<div class="line"><span class="lineno"> 6651</span>                    <span class="comment">/* Add data bytes in the current chunk have been read,</span></div>
<div class="line"><span class="lineno"> 6652</span><span class="comment">                     * so we are expecting \r\n now. */</span></div>
<div class="line"><span class="lineno"> 6653</span>                    <span class="keywordtype">char</span> x[2];</div>
<div class="line"><span class="lineno"> 6654</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> += 2;</div>
<div class="line"><span class="lineno"> 6655</span>                    <span class="keywordflow">if</span> ((<a class="code hl_function" href="#a59c90f7b25d805478984a16ba5ee5fc7">mg_read_inner</a>(conn, x, 2) != 2) || (x[0] != <span class="charliteral">&#39;\r&#39;</span>)</div>
<div class="line"><span class="lineno"> 6656</span>                        || (x[1] != <span class="charliteral">&#39;\n&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 6657</span>                        <span class="comment">/* Protocol violation */</span></div>
<div class="line"><span class="lineno"> 6658</span>                        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 2;</div>
<div class="line"><span class="lineno"> 6659</span>                        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6660</span>                    }</div>
<div class="line"><span class="lineno"> 6661</span>                }</div>
<div class="line"><span class="lineno"> 6662</span> </div>
<div class="line"><span class="lineno"> 6663</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6664</span>                <span class="comment">/* fetch a new chunk */</span></div>
<div class="line"><span class="lineno"> 6665</span>                <span class="keywordtype">size_t</span> i;</div>
<div class="line"><span class="lineno"> 6666</span>                <span class="keywordtype">char</span> lenbuf[64];</div>
<div class="line"><span class="lineno"> 6667</span>                <span class="keywordtype">char</span> *end = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 6668</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> chunkSize = 0;</div>
<div class="line"><span class="lineno"> 6669</span> </div>
<div class="line"><span class="lineno"> 6670</span>                <span class="keywordflow">for</span> (i = 0; i &lt; (<span class="keyword">sizeof</span>(lenbuf) - 1); i++) {</div>
<div class="line"><span class="lineno"> 6671</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>++;</div>
<div class="line"><span class="lineno"> 6672</span>                    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a59c90f7b25d805478984a16ba5ee5fc7">mg_read_inner</a>(conn, lenbuf + i, 1) != 1) {</div>
<div class="line"><span class="lineno"> 6673</span>                        lenbuf[i] = 0;</div>
<div class="line"><span class="lineno"> 6674</span>                    }</div>
<div class="line"><span class="lineno"> 6675</span>                    <span class="keywordflow">if</span> ((i &gt; 0) &amp;&amp; (lenbuf[i] == <span class="charliteral">&#39;;&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 6676</span>                        <span class="comment">// chunk extension --&gt; skip chars until next CR</span></div>
<div class="line"><span class="lineno"> 6677</span>                        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 6678</span>                        <span class="comment">// RFC 2616, 3.6.1 Chunked Transfer Coding</span></div>
<div class="line"><span class="lineno"> 6679</span>                        <span class="comment">// (https://www.rfc-editor.org/rfc/rfc2616#page-25)</span></div>
<div class="line"><span class="lineno"> 6680</span>                        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 6681</span>                        <span class="comment">// chunk          = chunk-size [ chunk-extension ] CRLF</span></div>
<div class="line"><span class="lineno"> 6682</span>                        <span class="comment">//                  chunk-data CRLF</span></div>
<div class="line"><span class="lineno"> 6683</span>                        <span class="comment">// ...</span></div>
<div class="line"><span class="lineno"> 6684</span>                        <span class="comment">// chunk-extension= *( &quot;;&quot; chunk-ext-name [ &quot;=&quot;</span></div>
<div class="line"><span class="lineno"> 6685</span>                        <span class="comment">// chunk-ext-val ] )</span></div>
<div class="line"><span class="lineno"> 6686</span>                        <span class="keywordflow">do</span></div>
<div class="line"><span class="lineno"> 6687</span>                            ++conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>;</div>
<div class="line"><span class="lineno"> 6688</span>                        <span class="keywordflow">while</span> (<a class="code hl_function" href="#a59c90f7b25d805478984a16ba5ee5fc7">mg_read_inner</a>(conn, lenbuf + i, 1) == 1</div>
<div class="line"><span class="lineno"> 6689</span>                               &amp;&amp; lenbuf[i] != <span class="charliteral">&#39;\r&#39;</span>);</div>
<div class="line"><span class="lineno"> 6690</span>                    }</div>
<div class="line"><span class="lineno"> 6691</span>                    <span class="keywordflow">if</span> ((i &gt; 0) &amp;&amp; (lenbuf[i] == <span class="charliteral">&#39;\r&#39;</span>)</div>
<div class="line"><span class="lineno"> 6692</span>                        &amp;&amp; (lenbuf[i - 1] != <span class="charliteral">&#39;\r&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 6693</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 6694</span>                    }</div>
<div class="line"><span class="lineno"> 6695</span>                    <span class="keywordflow">if</span> ((i &gt; 1) &amp;&amp; (lenbuf[i] == <span class="charliteral">&#39;\n&#39;</span>)</div>
<div class="line"><span class="lineno"> 6696</span>                        &amp;&amp; (lenbuf[i - 1] == <span class="charliteral">&#39;\r&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 6697</span>                        lenbuf[i + 1] = 0;</div>
<div class="line"><span class="lineno"> 6698</span>                        chunkSize = strtoul(lenbuf, &amp;end, 16);</div>
<div class="line"><span class="lineno"> 6699</span>                        <span class="keywordflow">if</span> (chunkSize == 0) {</div>
<div class="line"><span class="lineno"> 6700</span>                            <span class="comment">/* regular end of content */</span></div>
<div class="line"><span class="lineno"> 6701</span>                            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 3;</div>
<div class="line"><span class="lineno"> 6702</span>                        }</div>
<div class="line"><span class="lineno"> 6703</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 6704</span>                    }</div>
<div class="line"><span class="lineno"> 6705</span>                    <span class="keywordflow">if</span> (!isxdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)lenbuf[i])) {</div>
<div class="line"><span class="lineno"> 6706</span>                        <span class="comment">/* illegal character for chunk length */</span></div>
<div class="line"><span class="lineno"> 6707</span>                        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 2;</div>
<div class="line"><span class="lineno"> 6708</span>                        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6709</span>                    }</div>
<div class="line"><span class="lineno"> 6710</span>                }</div>
<div class="line"><span class="lineno"> 6711</span>                <span class="keywordflow">if</span> ((end == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (*end != <span class="charliteral">&#39;\r&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 6712</span>                    <span class="comment">/* chunksize not set correctly */</span></div>
<div class="line"><span class="lineno"> 6713</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 2;</div>
<div class="line"><span class="lineno"> 6714</span>                    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6715</span>                }</div>
<div class="line"><span class="lineno"> 6716</span>                <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> == 3) {</div>
<div class="line"><span class="lineno"> 6717</span>                    <span class="comment">/* try discarding trailer for keep-alive */</span></div>
<div class="line"><span class="lineno"> 6718</span> </div>
<div class="line"><span class="lineno"> 6719</span>                    <span class="comment">// We found the last chunk (length 0) including the</span></div>
<div class="line"><span class="lineno"> 6720</span>                    <span class="comment">// CRLF that terminates that chunk. Now follows a possibly</span></div>
<div class="line"><span class="lineno"> 6721</span>                    <span class="comment">// empty trailer and a final CRLF.</span></div>
<div class="line"><span class="lineno"> 6722</span>                    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 6723</span>                    <span class="comment">// see RFC 2616, 3.6.1 Chunked Transfer Coding</span></div>
<div class="line"><span class="lineno"> 6724</span>                    <span class="comment">// (https://www.rfc-editor.org/rfc/rfc2616#page-25)</span></div>
<div class="line"><span class="lineno"> 6725</span>                    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 6726</span>                    <span class="comment">// Chunked-Body   = *chunk</span></div>
<div class="line"><span class="lineno"> 6727</span>                    <span class="comment">//                  last-chunk</span></div>
<div class="line"><span class="lineno"> 6728</span>                    <span class="comment">//                  trailer</span></div>
<div class="line"><span class="lineno"> 6729</span>                    <span class="comment">//                  CRLF</span></div>
<div class="line"><span class="lineno"> 6730</span>                    <span class="comment">// ...</span></div>
<div class="line"><span class="lineno"> 6731</span>                    <span class="comment">// last-chunk     = 1*(&quot;0&quot;) [ chunk-extension ] CRLF</span></div>
<div class="line"><span class="lineno"> 6732</span>                    <span class="comment">// ...</span></div>
<div class="line"><span class="lineno"> 6733</span>                    <span class="comment">// trailer        = *(entity-header CRLF)</span></div>
<div class="line"><span class="lineno"> 6734</span> </div>
<div class="line"><span class="lineno"> 6735</span>                    <span class="keywordtype">int</span> crlf_count = 2; <span class="comment">// one CRLF already determined</span></div>
<div class="line"><span class="lineno"> 6736</span> </div>
<div class="line"><span class="lineno"> 6737</span>                    <span class="keywordflow">while</span> (crlf_count &lt; 4 &amp;&amp; conn-&gt;is_chunked == 3) {</div>
<div class="line"><span class="lineno"> 6738</span>                        ++conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>;</div>
<div class="line"><span class="lineno"> 6739</span>                        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a59c90f7b25d805478984a16ba5ee5fc7">mg_read_inner</a>(conn, lenbuf, 1) == 1) {</div>
<div class="line"><span class="lineno"> 6740</span>                            <span class="keywordflow">if</span> ((crlf_count == 0 || crlf_count == 2)) {</div>
<div class="line"><span class="lineno"> 6741</span>                                <span class="keywordflow">if</span> (lenbuf[0] == <span class="charliteral">&#39;\r&#39;</span>)</div>
<div class="line"><span class="lineno"> 6742</span>                                    ++crlf_count;</div>
<div class="line"><span class="lineno"> 6743</span>                                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 6744</span>                                    crlf_count = 0;</div>
<div class="line"><span class="lineno"> 6745</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6746</span>                                <span class="comment">// previous character was a CR</span></div>
<div class="line"><span class="lineno"> 6747</span>                                <span class="comment">// --&gt; next character must be LF</span></div>
<div class="line"><span class="lineno"> 6748</span> </div>
<div class="line"><span class="lineno"> 6749</span>                                <span class="keywordflow">if</span> (lenbuf[0] == <span class="charliteral">&#39;\n&#39;</span>)</div>
<div class="line"><span class="lineno"> 6750</span>                                    ++crlf_count;</div>
<div class="line"><span class="lineno"> 6751</span>                                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 6752</span>                                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 2;</div>
<div class="line"><span class="lineno"> 6753</span>                            }</div>
<div class="line"><span class="lineno"> 6754</span>                        } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 6755</span>                            <span class="comment">// premature end of trailer</span></div>
<div class="line"><span class="lineno"> 6756</span>                            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 2;</div>
<div class="line"><span class="lineno"> 6757</span>                    }</div>
<div class="line"><span class="lineno"> 6758</span> </div>
<div class="line"><span class="lineno"> 6759</span>                    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> == 2)</div>
<div class="line"><span class="lineno"> 6760</span>                        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6761</span>                    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 6762</span>                        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 4;</div>
<div class="line"><span class="lineno"> 6763</span> </div>
<div class="line"><span class="lineno"> 6764</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 6765</span>                }</div>
<div class="line"><span class="lineno"> 6766</span> </div>
<div class="line"><span class="lineno"> 6767</span>                <span class="comment">/* append a new chunk */</span></div>
<div class="line"><span class="lineno"> 6768</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> += (int64_t)chunkSize;</div>
<div class="line"><span class="lineno"> 6769</span>            }</div>
<div class="line"><span class="lineno"> 6770</span>        }</div>
<div class="line"><span class="lineno"> 6771</span> </div>
<div class="line"><span class="lineno"> 6772</span>        <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)all_read;</div>
<div class="line"><span class="lineno"> 6773</span>    }</div>
<div class="line"><span class="lineno"> 6774</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a59c90f7b25d805478984a16ba5ee5fc7">mg_read_inner</a>(conn, buf, len);</div>
<div class="line"><span class="lineno"> 6775</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a59c90f7b25d805478984a16ba5ee5fc7"><div class="ttname"><a href="#a59c90f7b25d805478984a16ba5ee5fc7">mg_read_inner</a></div><div class="ttdeci">static int mg_read_inner(struct mg_connection *conn, void *buf, size_t len)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06494">civetweb.c:6494</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02524">mg_connection::consumed_content</a>, <a class="el" href="civetweb_8c_source.html#l02518">mg_connection::content_len</a>, <a class="el" href="civetweb_8c_source.html#l02525">mg_connection::is_chunked</a>, <a class="el" href="civetweb_8c_source.html#l06494">mg_read_inner()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06484">discard_unread_request_data()</a>, <a class="el" href="civetweb_8c_source.html#l11184">forward_body_data()</a>, <a class="el" href="civetweb_8c_source.html#l10622">mg_store_body()</a>, and <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00995">run_client()</a>.</p>

</div>
</div>
<a id="a59c90f7b25d805478984a16ba5ee5fc7" name="a59c90f7b25d805478984a16ba5ee5fc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59c90f7b25d805478984a16ba5ee5fc7">&#9670;&#160;</a></span>mg_read_inner()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_read_inner </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06494">6494</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6495</span>{</div>
<div class="line"><span class="lineno"> 6496</span>    int64_t content_len, n, buffered_len, nread;</div>
<div class="line"><span class="lineno"> 6497</span>    int64_t len64 =</div>
<div class="line"><span class="lineno"> 6498</span>        (int64_t)((len &gt; INT_MAX) ? INT_MAX : len); <span class="comment">/* since the return value is</span></div>
<div class="line"><span class="lineno"> 6499</span><span class="comment">                                                     * int, we may not read more</span></div>
<div class="line"><span class="lineno"> 6500</span><span class="comment">                                                     * bytes */</span></div>
<div class="line"><span class="lineno"> 6501</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#ad3d32c5366d3b1577b7eefe5e843dd5d">body</a>;</div>
<div class="line"><span class="lineno"> 6502</span> </div>
<div class="line"><span class="lineno"> 6503</span>    <span class="keywordflow">if</span> (conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6504</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 6505</span>    }</div>
<div class="line"><span class="lineno"> 6506</span> </div>
<div class="line"><span class="lineno"> 6507</span>    <span class="comment">/* If Content-Length is not set for a response with body data,</span></div>
<div class="line"><span class="lineno"> 6508</span><span class="comment">     * we do not know in advance how much data should be read. */</span></div>
<div class="line"><span class="lineno"> 6509</span>    content_len = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>;</div>
<div class="line"><span class="lineno"> 6510</span>    <span class="keywordflow">if</span> (content_len &lt; 0) {</div>
<div class="line"><span class="lineno"> 6511</span>        <span class="comment">/* The body data is completed when the connection is closed. */</span></div>
<div class="line"><span class="lineno"> 6512</span>        content_len = <a class="code hl_define" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a>;</div>
<div class="line"><span class="lineno"> 6513</span>    }</div>
<div class="line"><span class="lineno"> 6514</span> </div>
<div class="line"><span class="lineno"> 6515</span>    nread = 0;</div>
<div class="line"><span class="lineno"> 6516</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a> &lt; content_len) {</div>
<div class="line"><span class="lineno"> 6517</span>        <span class="comment">/* Adjust number of bytes to read. */</span></div>
<div class="line"><span class="lineno"> 6518</span>        int64_t left_to_read = content_len - conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a>;</div>
<div class="line"><span class="lineno"> 6519</span>        <span class="keywordflow">if</span> (left_to_read &lt; len64) {</div>
<div class="line"><span class="lineno"> 6520</span>            <span class="comment">/* Do not read more than the total content length of the</span></div>
<div class="line"><span class="lineno"> 6521</span><span class="comment">             * request.</span></div>
<div class="line"><span class="lineno"> 6522</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno"> 6523</span>            len64 = left_to_read;</div>
<div class="line"><span class="lineno"> 6524</span>        }</div>
<div class="line"><span class="lineno"> 6525</span> </div>
<div class="line"><span class="lineno"> 6526</span>        <span class="comment">/* Return buffered data */</span></div>
<div class="line"><span class="lineno"> 6527</span>        buffered_len = (int64_t)(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a>) - (int64_t)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a></div>
<div class="line"><span class="lineno"> 6528</span>                       - conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a>;</div>
<div class="line"><span class="lineno"> 6529</span>        <span class="keywordflow">if</span> (buffered_len &gt; 0) {</div>
<div class="line"><span class="lineno"> 6530</span>            <span class="keywordflow">if</span> (len64 &lt; buffered_len) {</div>
<div class="line"><span class="lineno"> 6531</span>                buffered_len = len64;</div>
<div class="line"><span class="lineno"> 6532</span>            }</div>
<div class="line"><span class="lineno"> 6533</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#ad3d32c5366d3b1577b7eefe5e843dd5d">body</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a> + conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> + conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a>;</div>
<div class="line"><span class="lineno"> 6534</span>            memcpy(buf, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#ad3d32c5366d3b1577b7eefe5e843dd5d">body</a>, (<span class="keywordtype">size_t</span>)buffered_len);</div>
<div class="line"><span class="lineno"> 6535</span>            len64 -= buffered_len;</div>
<div class="line"><span class="lineno"> 6536</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a> += buffered_len;</div>
<div class="line"><span class="lineno"> 6537</span>            nread += buffered_len;</div>
<div class="line"><span class="lineno"> 6538</span>            buf = (<span class="keywordtype">char</span> *)buf + buffered_len;</div>
<div class="line"><span class="lineno"> 6539</span>        }</div>
<div class="line"><span class="lineno"> 6540</span> </div>
<div class="line"><span class="lineno"> 6541</span>        <span class="comment">/* We have returned all buffered data. Read new data from the remote</span></div>
<div class="line"><span class="lineno"> 6542</span><span class="comment">         * socket.</span></div>
<div class="line"><span class="lineno"> 6543</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 6544</span>        <span class="keywordflow">if</span> ((n = <a class="code hl_function" href="#a807c2737d59afedd4cc79747f416ea42">pull_all</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, conn, (<span class="keywordtype">char</span> *)buf, (<span class="keywordtype">int</span>)len64)) &gt;= 0) {</div>
<div class="line"><span class="lineno"> 6545</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a> += n;</div>
<div class="line"><span class="lineno"> 6546</span>            nread += n;</div>
<div class="line"><span class="lineno"> 6547</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6548</span>            nread = ((nread &gt; 0) ? nread : n);</div>
<div class="line"><span class="lineno"> 6549</span>        }</div>
<div class="line"><span class="lineno"> 6550</span>    }</div>
<div class="line"><span class="lineno"> 6551</span>    <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)nread;</div>
<div class="line"><span class="lineno"> 6552</span>}</div>
<div class="ttc" id="alua-5_81_85_2src_2lparser_8c_html_ad3d32c5366d3b1577b7eefe5e843dd5d"><div class="ttname"><a href="lua-5_81_85_2src_2lparser_8c.html#ad3d32c5366d3b1577b7eefe5e843dd5d">body</a></div><div class="ttdeci">static void body(LexState *ls, expdesc *e, int needself, int line)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lparser_8c_source.html#l00576">lua-5.1.5/src/lparser.c:576</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lua-5_81_85_2src_2lparser_8c_source.html#l00576">body()</a>, <a class="el" href="civetweb_8c_source.html#l02532">mg_connection::buf</a>, <a class="el" href="civetweb_8c_source.html#l02524">mg_connection::consumed_content</a>, <a class="el" href="civetweb_8c_source.html#l02518">mg_connection::content_len</a>, <a class="el" href="civetweb_8c_source.html#l02558">mg_connection::data_len</a>, <a class="el" href="civetweb_8c_source.html#l00513">INT64_MAX</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l06439">pull_all()</a>, and <a class="el" href="civetweb_8c_source.html#l02557">mg_connection::request_len</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06614">mg_read()</a>.</p>

</div>
</div>
<a id="a5185c288b713841c3c37118b5028bb42" name="a5185c288b713841c3c37118b5028bb42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5185c288b713841c3c37118b5028bb42">&#9670;&#160;</a></span>mg_realloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static __inline void * mg_realloc </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>a</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>b</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01486">1486</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1487</span>{</div>
<div class="line"><span class="lineno"> 1488</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="#a1b739878adcdb46fb5d209af7ce79628">realloc</a>(<a class="code hl_class" href="classa.html">a</a>, b);</div>
<div class="line"><span class="lineno"> 1489</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a1b739878adcdb46fb5d209af7ce79628"><div class="ttname"><a href="#a1b739878adcdb46fb5d209af7ce79628">realloc</a></div><div class="ttdeci">#define realloc</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01541">civetweb.c:1541</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01541">realloc</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09911">dir_scan_callback()</a>.</p>

</div>
</div>
<a id="abc4c4a1fa3a55e2b562da0ba4bf38e20" name="abc4c4a1fa3a55e2b562da0ba4bf38e20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc4c4a1fa3a55e2b562da0ba4bf38e20">&#9670;&#160;</a></span>mg_send_chunk()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_send_chunk </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>chunk</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>chunk_len</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06860">6860</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6863</span>{</div>
<div class="line"><span class="lineno"> 6864</span>    <span class="keywordtype">char</span> lenbuf[16];</div>
<div class="line"><span class="lineno"> 6865</span>    <span class="keywordtype">size_t</span> lenbuf_len;</div>
<div class="line"><span class="lineno"> 6866</span>    <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno"> 6867</span>    <span class="keywordtype">int</span> t;</div>
<div class="line"><span class="lineno"> 6868</span> </div>
<div class="line"><span class="lineno"> 6869</span>    <span class="comment">/* First store the length information in a text buffer. */</span></div>
<div class="line"><span class="lineno"> 6870</span>    sprintf(lenbuf, <span class="stringliteral">&quot;%x\r\n&quot;</span>, chunk_len);</div>
<div class="line"><span class="lineno"> 6871</span>    lenbuf_len = strlen(lenbuf);</div>
<div class="line"><span class="lineno"> 6872</span> </div>
<div class="line"><span class="lineno"> 6873</span>    <span class="comment">/* Then send length information, chunk and terminating \r\n. */</span></div>
<div class="line"><span class="lineno"> 6874</span>    ret = <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, lenbuf, lenbuf_len);</div>
<div class="line"><span class="lineno"> 6875</span>    <span class="keywordflow">if</span> (ret != (<span class="keywordtype">int</span>)lenbuf_len) {</div>
<div class="line"><span class="lineno"> 6876</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6877</span>    }</div>
<div class="line"><span class="lineno"> 6878</span>    t = ret;</div>
<div class="line"><span class="lineno"> 6879</span> </div>
<div class="line"><span class="lineno"> 6880</span>    ret = <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, <a class="code hl_function" href="lua-5_81_85_2src_2lparser_8c.html#a250d5faeaacc40c8a7e1822f5621c292">chunk</a>, chunk_len);</div>
<div class="line"><span class="lineno"> 6881</span>    <span class="keywordflow">if</span> (ret != (<span class="keywordtype">int</span>)chunk_len) {</div>
<div class="line"><span class="lineno"> 6882</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6883</span>    }</div>
<div class="line"><span class="lineno"> 6884</span>    t += ret;</div>
<div class="line"><span class="lineno"> 6885</span> </div>
<div class="line"><span class="lineno"> 6886</span>    ret = <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, <span class="stringliteral">&quot;\r\n&quot;</span>, 2);</div>
<div class="line"><span class="lineno"> 6887</span>    <span class="keywordflow">if</span> (ret != 2) {</div>
<div class="line"><span class="lineno"> 6888</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6889</span>    }</div>
<div class="line"><span class="lineno"> 6890</span>    t += ret;</div>
<div class="line"><span class="lineno"> 6891</span> </div>
<div class="line"><span class="lineno"> 6892</span>    <span class="keywordflow">return</span> t;</div>
<div class="line"><span class="lineno"> 6893</span>}</div>
<div class="ttc" id="alua-5_81_85_2src_2lparser_8c_html_a250d5faeaacc40c8a7e1822f5621c292"><div class="ttname"><a href="lua-5_81_85_2src_2lparser_8c.html#a250d5faeaacc40c8a7e1822f5621c292">chunk</a></div><div class="ttdeci">static void chunk(LexState *ls)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lparser_8c_source.html#l01325">lua-5.1.5/src/lparser.c:1325</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lua-5_81_85_2src_2lparser_8c_source.html#l01325">chunk()</a>, and <a class="el" href="civetweb_8c_source.html#l06779">mg_write()</a>.</p>

</div>
</div>
<a id="a62341459408ee3d4ae77df385a4d332f" name="a62341459408ee3d4ae77df385a4d332f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62341459408ee3d4ae77df385a4d332f">&#9670;&#160;</a></span>mg_send_digest_access_authentication_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_send_digest_access_authentication_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>realm</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09022">9022</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9024</span>{</div>
<div class="line"><span class="lineno"> 9025</span>    <span class="keywordflow">if</span> (conn &amp;&amp; conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno"> 9026</span>        <a class="code hl_function" href="#a3e30365a0294614e545550653e71c809">send_authorization_request</a>(conn, realm);</div>
<div class="line"><span class="lineno"> 9027</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9028</span>    }</div>
<div class="line"><span class="lineno"> 9029</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 9030</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, and <a class="el" href="civetweb_8c_source.html#l08974">send_authorization_request()</a>.</p>

</div>
</div>
<a id="af485479c8d173f829c88a4aed927d6fc" name="af485479c8d173f829c88a4aed927d6fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af485479c8d173f829c88a4aed927d6fc">&#9670;&#160;</a></span>mg_send_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_send_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10510">10510</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10511</span>{</div>
<div class="line"><span class="lineno">10512</span>    <a class="code hl_function" href="#ac7547ded66b30ef8d6924f8b8734cfe3">mg_send_mime_file2</a>(conn, path, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">10513</span>}</div>
<div class="ttc" id="acivetweb_8c_html_ac7547ded66b30ef8d6924f8b8734cfe3"><div class="ttname"><a href="#ac7547ded66b30ef8d6924f8b8734cfe3">mg_send_mime_file2</a></div><div class="ttdeci">CIVETWEB_API void mg_send_mime_file2(struct mg_connection *conn, const char *path, const char *mime_type, const char *additional_headers)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10526">civetweb.c:10526</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

</div>
</div>
<a id="a4c440a246bb1f1d223456de874c17f59" name="a4c440a246bb1f1d223456de874c17f59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c440a246bb1f1d223456de874c17f59">&#9670;&#160;</a></span>mg_send_file_body()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_send_file_body </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10451">10451</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10452</span>{</div>
<div class="line"><span class="lineno">10453</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">10454</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, path, <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>, &amp;file)) {</div>
<div class="line"><span class="lineno">10455</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10456</span>    }</div>
<div class="line"><span class="lineno">10457</span>    <a class="code hl_function" href="#a66af55875eb933f2969b8bed72ab9ef4">fclose_on_exec</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>, conn);</div>
<div class="line"><span class="lineno">10458</span>    <a class="code hl_function" href="#a528545b68103ca8848caaea2c5316ec2">send_file_data</a>(conn, &amp;file, 0, <a class="code hl_define" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a>, 0); <span class="comment">/* send static file */</span></div>
<div class="line"><span class="lineno">10459</span>    (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>); <span class="comment">/* Ignore errors for readonly files */</span></div>
<div class="line"><span class="lineno">10460</span>    <span class="keywordflow">return</span> 0;                      <span class="comment">/* &gt;= 0 for OK */</span></div>
<div class="line"><span class="lineno">10461</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l10196">fclose_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l00513">INT64_MAX</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02843">MG_FOPEN_MODE_READ</a>, <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>, and <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>.</p>

</div>
</div>
<a id="aca46fdde7db996eb011a1ac6a28bea98" name="aca46fdde7db996eb011a1ac6a28bea98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca46fdde7db996eb011a1ac6a28bea98">&#9670;&#160;</a></span>mg_send_http_error()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_send_http_error </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>status</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04562">4562</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4563</span>{</div>
<div class="line"><span class="lineno"> 4564</span>    va_list ap;</div>
<div class="line"><span class="lineno"> 4565</span>    <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno"> 4566</span> </div>
<div class="line"><span class="lineno"> 4567</span>    va_start(ap, fmt);</div>
<div class="line"><span class="lineno"> 4568</span>    ret = <a class="code hl_function" href="#a5a4e417915ab57988e9b1379da483cc2">mg_send_http_error_impl</a>(conn, status, fmt, ap);</div>
<div class="line"><span class="lineno"> 4569</span>    va_end(ap);</div>
<div class="line"><span class="lineno"> 4570</span> </div>
<div class="line"><span class="lineno"> 4571</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno"> 4572</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a5a4e417915ab57988e9b1379da483cc2"><div class="ttname"><a href="#a5a4e417915ab57988e9b1379da483cc2">mg_send_http_error_impl</a></div><div class="ttdeci">static int mg_send_http_error_impl(struct mg_connection *conn, int status, const char *fmt, va_list args)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04375">civetweb.c:4375</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l11915">dav_mkcol()</a>, <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l12931">dav_unlock_file()</a>, <a class="el" href="civetweb_8c_source.html#l12293">delete_file()</a>, <a class="el" href="civetweb_8c_source.html#l11184">forward_body_data()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l15354">handle_file_based_request()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, <a class="el" href="civetweb_8c_source.html#l14235">redirect_to_https_port()</a>, and <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>.</p>

</div>
</div>
<a id="a5a4e417915ab57988e9b1379da483cc2" name="a5a4e417915ab57988e9b1379da483cc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a4e417915ab57988e9b1379da483cc2">&#9670;&#160;</a></span>mg_send_http_error_impl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_send_http_error_impl </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>status</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list</td>          <td class="paramname"><span class="paramname"><em>args</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04375">4375</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4379</span>{</div>
<div class="line"><span class="lineno"> 4380</span>    <span class="keywordtype">char</span> errmsg_buf[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno"> 4381</span>    va_list ap;</div>
<div class="line"><span class="lineno"> 4382</span>    <span class="keywordtype">int</span> has_body;</div>
<div class="line"><span class="lineno"> 4383</span> </div>
<div class="line"><span class="lineno"> 4384</span><span class="preprocessor">#if !defined(NO_FILESYSTEMS)</span></div>
<div class="line"><span class="lineno"> 4385</span>    <span class="keywordtype">char</span> path_buf[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>];</div>
<div class="line"><span class="lineno"> 4386</span>    <span class="keywordtype">int</span> len, i, page_handler_found, scope, truncated;</div>
<div class="line"><span class="lineno"> 4387</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *error_handler = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 4388</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> error_page_file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno"> 4389</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *error_page_file_ext, *tstr;</div>
<div class="line"><span class="lineno"> 4390</span><span class="preprocessor">#endif </span><span class="comment">/* NO_FILESYSTEMS */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 4391</span>    <span class="keywordtype">int</span> handled_by_callback = 0;</div>
<div class="line"><span class="lineno"> 4392</span> </div>
<div class="line"><span class="lineno"> 4393</span>    <span class="keywordflow">if</span> ((conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (fmt == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 4394</span>        <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 4395</span>    }</div>
<div class="line"><span class="lineno"> 4396</span> </div>
<div class="line"><span class="lineno"> 4397</span>    <span class="comment">/* Set status (for log) */</span></div>
<div class="line"><span class="lineno"> 4398</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = status;</div>
<div class="line"><span class="lineno"> 4399</span> </div>
<div class="line"><span class="lineno"> 4400</span>    <span class="comment">/* Errors 1xx, 204 and 304 MUST NOT send a body */</span></div>
<div class="line"><span class="lineno"> 4401</span>    has_body = ((status &gt; 199) &amp;&amp; (status != 204) &amp;&amp; (status != 304));</div>
<div class="line"><span class="lineno"> 4402</span> </div>
<div class="line"><span class="lineno"> 4403</span>    <span class="comment">/* Prepare message in buf, if required */</span></div>
<div class="line"><span class="lineno"> 4404</span>    <span class="keywordflow">if</span> (has_body</div>
<div class="line"><span class="lineno"> 4405</span>        || (!conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac5ff30ba1c73afd0f9932c4dac17ea5a">in_error_handler</a></div>
<div class="line"><span class="lineno"> 4406</span>            &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a7ea680aa175209187bd1939fcfce5ade">http_error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div>
<div class="line"><span class="lineno"> 4407</span>        <span class="comment">/* Store error message in errmsg_buf */</span></div>
<div class="line"><span class="lineno"> 4408</span>        <a class="code hl_define" href="#ad5936237ef8db6bc39470efaef9d151d">va_copy</a>(ap, args);</div>
<div class="line"><span class="lineno"> 4409</span>        <a class="code hl_function" href="#aca9e6d65ed7802c47e4e3ef6413d8c39">mg_vsnprintf</a>(conn, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, errmsg_buf, <span class="keyword">sizeof</span>(errmsg_buf), fmt, ap);</div>
<div class="line"><span class="lineno"> 4410</span>        va_end(ap);</div>
<div class="line"><span class="lineno"> 4411</span>        <span class="comment">/* In a debug build, print all html errors */</span></div>
<div class="line"><span class="lineno"> 4412</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Error %i - [%s]&quot;</span>, status, errmsg_buf);</div>
<div class="line"><span class="lineno"> 4413</span>    }</div>
<div class="line"><span class="lineno"> 4414</span> </div>
<div class="line"><span class="lineno"> 4415</span>    <span class="comment">/* If there is a http_error callback, call it.</span></div>
<div class="line"><span class="lineno"> 4416</span><span class="comment">     * But don&#39;t do it recursively, if callback calls mg_send_http_error again.</span></div>
<div class="line"><span class="lineno"> 4417</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 4418</span>    <span class="keywordflow">if</span> (!conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac5ff30ba1c73afd0f9932c4dac17ea5a">in_error_handler</a></div>
<div class="line"><span class="lineno"> 4419</span>        &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a7ea680aa175209187bd1939fcfce5ade">http_error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 4420</span>        <span class="comment">/* Mark in_error_handler to avoid recursion and call user callback. */</span></div>
<div class="line"><span class="lineno"> 4421</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac5ff30ba1c73afd0f9932c4dac17ea5a">in_error_handler</a> = 1;</div>
<div class="line"><span class="lineno"> 4422</span>        handled_by_callback =</div>
<div class="line"><span class="lineno"> 4423</span>            (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a7ea680aa175209187bd1939fcfce5ade">http_error</a>(conn, status, errmsg_buf)</div>
<div class="line"><span class="lineno"> 4424</span>             == 0);</div>
<div class="line"><span class="lineno"> 4425</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac5ff30ba1c73afd0f9932c4dac17ea5a">in_error_handler</a> = 0;</div>
<div class="line"><span class="lineno"> 4426</span>    }</div>
<div class="line"><span class="lineno"> 4427</span> </div>
<div class="line"><span class="lineno"> 4428</span>    <span class="keywordflow">if</span> (!handled_by_callback) {</div>
<div class="line"><span class="lineno"> 4429</span>        <span class="comment">/* Check for recursion */</span></div>
<div class="line"><span class="lineno"> 4430</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac5ff30ba1c73afd0f9932c4dac17ea5a">in_error_handler</a>) {</div>
<div class="line"><span class="lineno"> 4431</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(</div>
<div class="line"><span class="lineno"> 4432</span>                <span class="stringliteral">&quot;Recursion when handling error %u - fall back to default&quot;</span>,</div>
<div class="line"><span class="lineno"> 4433</span>                status);</div>
<div class="line"><span class="lineno"> 4434</span><span class="preprocessor">#if !defined(NO_FILESYSTEMS)</span></div>
<div class="line"><span class="lineno"> 4435</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 4436</span>            <span class="comment">/* Send user defined error pages, if defined */</span></div>
<div class="line"><span class="lineno"> 4437</span>            error_handler = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba80a0b839f2bfedfe7e973a0e1211a6d6">ERROR_PAGES</a>];</div>
<div class="line"><span class="lineno"> 4438</span>            error_page_file_ext = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bafa9f4efa175d81e138ff3aa53aa00930">INDEX_FILES</a>];</div>
<div class="line"><span class="lineno"> 4439</span>            page_handler_found = 0;</div>
<div class="line"><span class="lineno"> 4440</span> </div>
<div class="line"><span class="lineno"> 4441</span>            <span class="keywordflow">if</span> (error_handler != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 4442</span>                <span class="keywordflow">for</span> (scope = 1; (scope &lt;= 3) &amp;&amp; !page_handler_found; scope++) {</div>
<div class="line"><span class="lineno"> 4443</span>                    <span class="keywordflow">switch</span> (scope) {</div>
<div class="line"><span class="lineno"> 4444</span>                    <span class="keywordflow">case</span> 1: <span class="comment">/* Handler for specific error, e.g. 404 error */</span></div>
<div class="line"><span class="lineno"> 4445</span>                        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 4446</span>                                    &amp;truncated,</div>
<div class="line"><span class="lineno"> 4447</span>                                    path_buf,</div>
<div class="line"><span class="lineno"> 4448</span>                                    <span class="keyword">sizeof</span>(path_buf) - 32,</div>
<div class="line"><span class="lineno"> 4449</span>                                    <span class="stringliteral">&quot;%serror%03u.&quot;</span>,</div>
<div class="line"><span class="lineno"> 4450</span>                                    error_handler,</div>
<div class="line"><span class="lineno"> 4451</span>                                    status);</div>
<div class="line"><span class="lineno"> 4452</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 4453</span>                    <span class="keywordflow">case</span> 2: <span class="comment">/* Handler for error group, e.g., 5xx error</span></div>
<div class="line"><span class="lineno"> 4454</span><span class="comment">                             * handler</span></div>
<div class="line"><span class="lineno"> 4455</span><span class="comment">                             * for all server errors (500-599) */</span></div>
<div class="line"><span class="lineno"> 4456</span>                        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 4457</span>                                    &amp;truncated,</div>
<div class="line"><span class="lineno"> 4458</span>                                    path_buf,</div>
<div class="line"><span class="lineno"> 4459</span>                                    <span class="keyword">sizeof</span>(path_buf) - 32,</div>
<div class="line"><span class="lineno"> 4460</span>                                    <span class="stringliteral">&quot;%serror%01uxx.&quot;</span>,</div>
<div class="line"><span class="lineno"> 4461</span>                                    error_handler,</div>
<div class="line"><span class="lineno"> 4462</span>                                    status / 100);</div>
<div class="line"><span class="lineno"> 4463</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 4464</span>                    <span class="keywordflow">default</span>: <span class="comment">/* Handler for all errors */</span></div>
<div class="line"><span class="lineno"> 4465</span>                        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 4466</span>                                    &amp;truncated,</div>
<div class="line"><span class="lineno"> 4467</span>                                    path_buf,</div>
<div class="line"><span class="lineno"> 4468</span>                                    <span class="keyword">sizeof</span>(path_buf) - 32,</div>
<div class="line"><span class="lineno"> 4469</span>                                    <span class="stringliteral">&quot;%serror.&quot;</span>,</div>
<div class="line"><span class="lineno"> 4470</span>                                    error_handler);</div>
<div class="line"><span class="lineno"> 4471</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 4472</span>                    }</div>
<div class="line"><span class="lineno"> 4473</span> </div>
<div class="line"><span class="lineno"> 4474</span>                    <span class="comment">/* String truncation in buf may only occur if</span></div>
<div class="line"><span class="lineno"> 4475</span><span class="comment">                     * error_handler is too long. This string is</span></div>
<div class="line"><span class="lineno"> 4476</span><span class="comment">                     * from the config, not from a client. */</span></div>
<div class="line"><span class="lineno"> 4477</span>                    (void)truncated;</div>
<div class="line"><span class="lineno"> 4478</span> </div>
<div class="line"><span class="lineno"> 4479</span>                    <span class="comment">/* The following code is redundant, but it should avoid</span></div>
<div class="line"><span class="lineno"> 4480</span><span class="comment">                     * false positives in static source code analyzers and</span></div>
<div class="line"><span class="lineno"> 4481</span><span class="comment">                     * vulnerability scanners.</span></div>
<div class="line"><span class="lineno"> 4482</span><span class="comment">                     */</span></div>
<div class="line"><span class="lineno"> 4483</span>                    path_buf[<span class="keyword">sizeof</span>(path_buf) - 32] = 0;</div>
<div class="line"><span class="lineno"> 4484</span>                    len = (int)strlen(path_buf);</div>
<div class="line"><span class="lineno"> 4485</span>                    <span class="keywordflow">if</span> (len &gt; (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(path_buf) - 32) {</div>
<div class="line"><span class="lineno"> 4486</span>                        len = (int)<span class="keyword">sizeof</span>(path_buf) - 32;</div>
<div class="line"><span class="lineno"> 4487</span>                    }</div>
<div class="line"><span class="lineno"> 4488</span> </div>
<div class="line"><span class="lineno"> 4489</span>                    <span class="comment">/* Start with the file extension from the configuration. */</span></div>
<div class="line"><span class="lineno"> 4490</span>                    tstr = strchr(error_page_file_ext, <span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line"><span class="lineno"> 4491</span> </div>
<div class="line"><span class="lineno"> 4492</span>                    <span class="keywordflow">while</span> (tstr) {</div>
<div class="line"><span class="lineno"> 4493</span>                        <span class="keywordflow">for</span> (i = 1;</div>
<div class="line"><span class="lineno"> 4494</span>                             (i &lt; 32) &amp;&amp; (tstr[i] != 0) &amp;&amp; (tstr[i] != <span class="charliteral">&#39;,&#39;</span>);</div>
<div class="line"><span class="lineno"> 4495</span>                             i++) {</div>
<div class="line"><span class="lineno"> 4496</span>                            <span class="comment">/* buffer overrun is not possible here, since</span></div>
<div class="line"><span class="lineno"> 4497</span><span class="comment">                             * (i &lt; 32) &amp;&amp; (len &lt; sizeof(path_buf) - 32)</span></div>
<div class="line"><span class="lineno"> 4498</span><span class="comment">                             * ==&gt; (i + len) &lt; sizeof(path_buf) */</span></div>
<div class="line"><span class="lineno"> 4499</span>                            path_buf[len + i - 1] = tstr[i];</div>
<div class="line"><span class="lineno"> 4500</span>                        }</div>
<div class="line"><span class="lineno"> 4501</span>                        <span class="comment">/* buffer overrun is not possible here, since</span></div>
<div class="line"><span class="lineno"> 4502</span><span class="comment">                         * (i &lt;= 32) &amp;&amp; (len &lt; sizeof(path_buf) - 32)</span></div>
<div class="line"><span class="lineno"> 4503</span><span class="comment">                         * ==&gt; (i + len) &lt;= sizeof(path_buf) */</span></div>
<div class="line"><span class="lineno"> 4504</span>                        path_buf[len + i - 1] = 0;</div>
<div class="line"><span class="lineno"> 4505</span> </div>
<div class="line"><span class="lineno"> 4506</span>                        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path_buf, &amp;error_page_file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>)) {</div>
<div class="line"><span class="lineno"> 4507</span>                            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Check error page %s - found&quot;</span>,</div>
<div class="line"><span class="lineno"> 4508</span>                                        path_buf);</div>
<div class="line"><span class="lineno"> 4509</span>                            page_handler_found = 1;</div>
<div class="line"><span class="lineno"> 4510</span>                            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 4511</span>                        }</div>
<div class="line"><span class="lineno"> 4512</span>                        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Check error page %s - not found&quot;</span>,</div>
<div class="line"><span class="lineno"> 4513</span>                                    path_buf);</div>
<div class="line"><span class="lineno"> 4514</span> </div>
<div class="line"><span class="lineno"> 4515</span>                        <span class="comment">/* Continue with the next file extension from the</span></div>
<div class="line"><span class="lineno"> 4516</span><span class="comment">                         * configuration (if there is a next one). */</span></div>
<div class="line"><span class="lineno"> 4517</span>                        tstr = strchr(tstr + i, <span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line"><span class="lineno"> 4518</span>                    }</div>
<div class="line"><span class="lineno"> 4519</span>                }</div>
<div class="line"><span class="lineno"> 4520</span>            }</div>
<div class="line"><span class="lineno"> 4521</span> </div>
<div class="line"><span class="lineno"> 4522</span>            <span class="keywordflow">if</span> (page_handler_found) {</div>
<div class="line"><span class="lineno"> 4523</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac5ff30ba1c73afd0f9932c4dac17ea5a">in_error_handler</a> = 1;</div>
<div class="line"><span class="lineno"> 4524</span>                <a class="code hl_function" href="#a4761bad9f703f9d51380597f4b1a694c">handle_file_based_request</a>(conn, path_buf, &amp;error_page_file);</div>
<div class="line"><span class="lineno"> 4525</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac5ff30ba1c73afd0f9932c4dac17ea5a">in_error_handler</a> = 0;</div>
<div class="line"><span class="lineno"> 4526</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 4527</span>            }</div>
<div class="line"><span class="lineno"> 4528</span><span class="preprocessor">#endif </span><span class="comment">/* NO_FILESYSTEMS */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 4529</span>        }</div>
<div class="line"><span class="lineno"> 4530</span> </div>
<div class="line"><span class="lineno"> 4531</span>        <span class="comment">/* No custom error page. Send default error page. */</span></div>
<div class="line"><span class="lineno"> 4532</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno"> 4533</span>        <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, status);</div>
<div class="line"><span class="lineno"> 4534</span>        <a class="code hl_function" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4535</span>        <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4536</span>        <a class="code hl_function" href="#acce3a614f601b06f0120faad9421e25f">send_cors_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4537</span>        <span class="keywordflow">if</span> (has_body) {</div>
<div class="line"><span class="lineno"> 4538</span>            <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn,</div>
<div class="line"><span class="lineno"> 4539</span>                                   <span class="stringliteral">&quot;Content-Type&quot;</span>,</div>
<div class="line"><span class="lineno"> 4540</span>                                   <span class="stringliteral">&quot;text/plain; charset=utf-8&quot;</span>,</div>
<div class="line"><span class="lineno"> 4541</span>                                   -1);</div>
<div class="line"><span class="lineno"> 4542</span>        }</div>
<div class="line"><span class="lineno"> 4543</span>        <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno"> 4544</span> </div>
<div class="line"><span class="lineno"> 4545</span>        <span class="comment">/* HTTP responses 1xx, 204 and 304 MUST NOT send a body */</span></div>
<div class="line"><span class="lineno"> 4546</span>        <span class="keywordflow">if</span> (has_body) {</div>
<div class="line"><span class="lineno"> 4547</span>            <span class="comment">/* For other errors, send a generic error message. */</span></div>
<div class="line"><span class="lineno"> 4548</span>            <span class="keyword">const</span> <span class="keywordtype">char</span> *status_text = <a class="code hl_function" href="#a08ef1e77e39a65d2b0eb84328291cae1">mg_get_response_code_text</a>(conn, status);</div>
<div class="line"><span class="lineno"> 4549</span>            <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn, <span class="stringliteral">&quot;Error %d: %s\n&quot;</span>, status, status_text);</div>
<div class="line"><span class="lineno"> 4550</span>            <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, errmsg_buf, strlen(errmsg_buf));</div>
<div class="line"><span class="lineno"> 4551</span> </div>
<div class="line"><span class="lineno"> 4552</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 4553</span>            <span class="comment">/* No body allowed. Close the connection. */</span></div>
<div class="line"><span class="lineno"> 4554</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Error %i&quot;</span>, status);</div>
<div class="line"><span class="lineno"> 4555</span>        }</div>
<div class="line"><span class="lineno"> 4556</span>    }</div>
<div class="line"><span class="lineno"> 4557</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 4558</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a08ef1e77e39a65d2b0eb84328291cae1"><div class="ttname"><a href="#a08ef1e77e39a65d2b0eb84328291cae1">mg_get_response_code_text</a></div><div class="ttdeci">CIVETWEB_API const char * mg_get_response_code_text(const struct mg_connection *conn, int response_code)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l04176">civetweb.c:4176</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_a7ea680aa175209187bd1939fcfce5ade"><div class="ttname"><a href="structmg__callbacks.html#a7ea680aa175209187bd1939fcfce5ade">mg_callbacks::http_error</a></div><div class="ttdeci">int(* http_error)(struct mg_connection *conn, int status, const char *errmsg)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00359">civetweb.h:359</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02044">ERROR_PAGES</a>, <a class="el" href="civetweb_8c_source.html#l15354">handle_file_based_request()</a>, <a class="el" href="civetweb_8h_source.html#l00359">mg_callbacks::http_error</a>, <a class="el" href="civetweb_8c_source.html#l02537">mg_connection::in_error_handler</a>, <a class="el" href="civetweb_8c_source.html#l02005">INDEX_FILES</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l04176">mg_get_response_code_text()</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="civetweb_8c_source.html#l03094">mg_vsnprintf()</a>, <a class="el" href="civetweb_8c_source.html#l06779">mg_write()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04149">send_cors_header()</a>, <a class="el" href="civetweb_8c_source.html#l04056">send_no_cache_header()</a>, <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>, <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>, <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>, <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>, and <a class="el" href="civetweb_8c_source.html#l01003">va_copy</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>.</p>

</div>
</div>
<a id="ae0be5c92db7782f5be9d5d3effcd479e" name="ae0be5c92db7782f5be9d5d3effcd479e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0be5c92db7782f5be9d5d3effcd479e">&#9670;&#160;</a></span>mg_send_http_ok()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_send_http_ok </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>mime_type</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long</td>          <td class="paramname"><span class="paramname"><em>content_length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04576">4576</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4579</span>{</div>
<div class="line"><span class="lineno"> 4580</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (*<a class="code hl_variable" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a> == 0)) {</div>
<div class="line"><span class="lineno"> 4581</span>        <span class="comment">/* No content type defined: default to text/html */</span></div>
<div class="line"><span class="lineno"> 4582</span>        <a class="code hl_variable" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a> = <span class="stringliteral">&quot;text/html&quot;</span>;</div>
<div class="line"><span class="lineno"> 4583</span>    }</div>
<div class="line"><span class="lineno"> 4584</span> </div>
<div class="line"><span class="lineno"> 4585</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 200);</div>
<div class="line"><span class="lineno"> 4586</span>    <a class="code hl_function" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4587</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4588</span>    <a class="code hl_function" href="#acce3a614f601b06f0120faad9421e25f">send_cors_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4589</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Type&quot;</span>, <a class="code hl_variable" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a>, -1);</div>
<div class="line"><span class="lineno"> 4590</span>    <span class="keywordflow">if</span> (content_length &lt; 0) {</div>
<div class="line"><span class="lineno"> 4591</span>        <span class="comment">/* Size not known. Use chunked encoding (HTTP/1.x) */</span></div>
<div class="line"><span class="lineno"> 4592</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a>) {</div>
<div class="line"><span class="lineno"> 4593</span>            <span class="comment">/* Only HTTP/1.x defines &quot;chunked&quot; encoding, HTTP/2 does not*/</span></div>
<div class="line"><span class="lineno"> 4594</span>            <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Transfer-Encoding&quot;</span>, <span class="stringliteral">&quot;chunked&quot;</span>, -1);</div>
<div class="line"><span class="lineno"> 4595</span>        }</div>
<div class="line"><span class="lineno"> 4596</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 4597</span>        <span class="keywordtype">char</span> len[32];</div>
<div class="line"><span class="lineno"> 4598</span>        <span class="keywordtype">int</span> trunc = 0;</div>
<div class="line"><span class="lineno"> 4599</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 4600</span>                    &amp;trunc,</div>
<div class="line"><span class="lineno"> 4601</span>                    len,</div>
<div class="line"><span class="lineno"> 4602</span>                    <span class="keyword">sizeof</span>(len),</div>
<div class="line"><span class="lineno"> 4603</span>                    <span class="stringliteral">&quot;%&quot;</span> <a class="code hl_define" href="#a21ef7c3a4e9f99f62cf64329f965d2ed">UINT64_FMT</a>,</div>
<div class="line"><span class="lineno"> 4604</span>                    (uint64_t)content_length);</div>
<div class="line"><span class="lineno"> 4605</span>        <span class="keywordflow">if</span> (!trunc) {</div>
<div class="line"><span class="lineno"> 4606</span>            <span class="comment">/* Since 32 bytes is enough to hold any 64 bit decimal number,</span></div>
<div class="line"><span class="lineno"> 4607</span><span class="comment">             * !trunc is always true */</span></div>
<div class="line"><span class="lineno"> 4608</span>            <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>, len, -1);</div>
<div class="line"><span class="lineno"> 4609</span>        }</div>
<div class="line"><span class="lineno"> 4610</span>    }</div>
<div class="line"><span class="lineno"> 4611</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno"> 4612</span> </div>
<div class="line"><span class="lineno"> 4613</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 4614</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l08224">mime_type</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, <a class="el" href="civetweb_8c_source.html#l02466">PROTOCOL_TYPE_HTTP1</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04149">send_cors_header()</a>, <a class="el" href="civetweb_8c_source.html#l04056">send_no_cache_header()</a>, and <a class="el" href="civetweb_8c_source.html#l00927">UINT64_FMT</a>.</p>

</div>
</div>
<a id="acbacd157c3e4a32ef99a0088a36e06af" name="acbacd157c3e4a32ef99a0088a36e06af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acbacd157c3e4a32ef99a0088a36e06af">&#9670;&#160;</a></span>mg_send_http_redirect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_send_http_redirect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>target_url</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>redirect_code</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04618">4618</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4621</span>{</div>
<div class="line"><span class="lineno"> 4622</span>    <span class="comment">/* Send a 30x redirect response.</span></div>
<div class="line"><span class="lineno"> 4623</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno"> 4624</span><span class="comment">     * Redirect types (status codes):</span></div>
<div class="line"><span class="lineno"> 4625</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno"> 4626</span><span class="comment">     * Status | Perm/Temp | Method              | Version</span></div>
<div class="line"><span class="lineno"> 4627</span><span class="comment">     *   301  | permanent | POST-&gt;GET undefined | HTTP/1.0</span></div>
<div class="line"><span class="lineno"> 4628</span><span class="comment">     *   302  | temporary | POST-&gt;GET undefined | HTTP/1.0</span></div>
<div class="line"><span class="lineno"> 4629</span><span class="comment">     *   303  | temporary | always use GET      | HTTP/1.1</span></div>
<div class="line"><span class="lineno"> 4630</span><span class="comment">     *   307  | temporary | always keep method  | HTTP/1.1</span></div>
<div class="line"><span class="lineno"> 4631</span><span class="comment">     *   308  | permanent | always keep method  | HTTP/1.1</span></div>
<div class="line"><span class="lineno"> 4632</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 4633</span> </div>
<div class="line"><span class="lineno"> 4634</span><span class="preprocessor">#if defined(MG_SEND_REDIRECT_BODY)</span></div>
<div class="line"><span class="lineno"> 4635</span>    <span class="keywordtype">char</span> redirect_body[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno"> 4636</span>    <span class="keywordtype">size_t</span> content_len = 0;</div>
<div class="line"><span class="lineno"> 4637</span>    <span class="keywordtype">char</span> content_len_text[32];</div>
<div class="line"><span class="lineno"> 4638</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 4639</span> </div>
<div class="line"><span class="lineno"> 4640</span>    <span class="comment">/* In case redirect_code=0, use 307. */</span></div>
<div class="line"><span class="lineno"> 4641</span>    <span class="keywordflow">if</span> (redirect_code == 0) {</div>
<div class="line"><span class="lineno"> 4642</span>        redirect_code = 307;</div>
<div class="line"><span class="lineno"> 4643</span>    }</div>
<div class="line"><span class="lineno"> 4644</span> </div>
<div class="line"><span class="lineno"> 4645</span>    <span class="comment">/* In case redirect_code is none of the above, return error. */</span></div>
<div class="line"><span class="lineno"> 4646</span>    <span class="keywordflow">if</span> ((redirect_code != 301) &amp;&amp; (redirect_code != 302)</div>
<div class="line"><span class="lineno"> 4647</span>        &amp;&amp; (redirect_code != 303) &amp;&amp; (redirect_code != 307)</div>
<div class="line"><span class="lineno"> 4648</span>        &amp;&amp; (redirect_code != 308)) {</div>
<div class="line"><span class="lineno"> 4649</span>        <span class="comment">/* Parameter error */</span></div>
<div class="line"><span class="lineno"> 4650</span>        <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 4651</span>    }</div>
<div class="line"><span class="lineno"> 4652</span> </div>
<div class="line"><span class="lineno"> 4653</span>    <span class="comment">/* If target_url is not defined, redirect to &quot;/&quot;. */</span></div>
<div class="line"><span class="lineno"> 4654</span>    <span class="keywordflow">if</span> ((target_url == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (*target_url == 0)) {</div>
<div class="line"><span class="lineno"> 4655</span>        target_url = <span class="stringliteral">&quot;/&quot;</span>;</div>
<div class="line"><span class="lineno"> 4656</span>    }</div>
<div class="line"><span class="lineno"> 4657</span> </div>
<div class="line"><span class="lineno"> 4658</span><span class="preprocessor">#if defined(MG_SEND_REDIRECT_BODY)</span></div>
<div class="line"><span class="lineno"> 4659</span>    <span class="comment">/* TODO: condition name? */</span></div>
<div class="line"><span class="lineno"> 4660</span> </div>
<div class="line"><span class="lineno"> 4661</span>    <span class="comment">/* Prepare a response body with a hyperlink.</span></div>
<div class="line"><span class="lineno"> 4662</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno"> 4663</span><span class="comment">     * According to RFC2616 (and RFC1945 before):</span></div>
<div class="line"><span class="lineno"> 4664</span><span class="comment">     * Unless the request method was HEAD, the entity of the</span></div>
<div class="line"><span class="lineno"> 4665</span><span class="comment">     * response SHOULD contain a short hypertext note with a hyperlink to</span></div>
<div class="line"><span class="lineno"> 4666</span><span class="comment">     * the new URI(s).</span></div>
<div class="line"><span class="lineno"> 4667</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno"> 4668</span><span class="comment">     * However, this response body is not useful in M2M communication.</span></div>
<div class="line"><span class="lineno"> 4669</span><span class="comment">     * Probably the original reason in the RFC was, clients not supporting</span></div>
<div class="line"><span class="lineno"> 4670</span><span class="comment">     * a 30x HTTP redirect could still show the HTML page and let the user</span></div>
<div class="line"><span class="lineno"> 4671</span><span class="comment">     * press the link. Since current browsers support 30x HTTP, the additional</span></div>
<div class="line"><span class="lineno"> 4672</span><span class="comment">     * HTML body does not seem to make sense anymore.</span></div>
<div class="line"><span class="lineno"> 4673</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno"> 4674</span><span class="comment">     * The new RFC7231 (Section 6.4) does no longer recommend it (&quot;SHOULD&quot;),</span></div>
<div class="line"><span class="lineno"> 4675</span><span class="comment">     * but it only notes:</span></div>
<div class="line"><span class="lineno"> 4676</span><span class="comment">     * The server&#39;s response payload usually contains a short</span></div>
<div class="line"><span class="lineno"> 4677</span><span class="comment">     * hypertext note with a hyperlink to the new URI(s).</span></div>
<div class="line"><span class="lineno"> 4678</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno"> 4679</span><span class="comment">     * Deactivated by default. If you need the 30x body, set the define.</span></div>
<div class="line"><span class="lineno"> 4680</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 4681</span>    <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(</div>
<div class="line"><span class="lineno"> 4682</span>        conn,</div>
<div class="line"><span class="lineno"> 4683</span>        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> <span class="comment">/* ignore truncation */</span>,</div>
<div class="line"><span class="lineno"> 4684</span>        redirect_body,</div>
<div class="line"><span class="lineno"> 4685</span>        <span class="keyword">sizeof</span>(redirect_body),</div>
<div class="line"><span class="lineno"> 4686</span>        <span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;%s&lt;/head&gt;&lt;body&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>,</div>
<div class="line"><span class="lineno"> 4687</span>        redirect_text,</div>
<div class="line"><span class="lineno"> 4688</span>        target_url,</div>
<div class="line"><span class="lineno"> 4689</span>        target_url);</div>
<div class="line"><span class="lineno"> 4690</span>    content_len = strlen(reply);</div>
<div class="line"><span class="lineno"> 4691</span>    sprintf(content_len_text, <span class="stringliteral">&quot;%lu&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)content_len);</div>
<div class="line"><span class="lineno"> 4692</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 4693</span> </div>
<div class="line"><span class="lineno"> 4694</span>    <span class="comment">/* Send all required headers */</span></div>
<div class="line"><span class="lineno"> 4695</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, redirect_code);</div>
<div class="line"><span class="lineno"> 4696</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Location&quot;</span>, target_url, -1);</div>
<div class="line"><span class="lineno"> 4697</span>    <span class="keywordflow">if</span> ((redirect_code == 301) || (redirect_code == 308)) {</div>
<div class="line"><span class="lineno"> 4698</span>        <span class="comment">/* Permanent redirect */</span></div>
<div class="line"><span class="lineno"> 4699</span>        <a class="code hl_function" href="#a229f03c60c42b8f390449a8e1324f22f">send_static_cache_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4700</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 4701</span>        <span class="comment">/* Temporary redirect */</span></div>
<div class="line"><span class="lineno"> 4702</span>        <a class="code hl_function" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4703</span>    }</div>
<div class="line"><span class="lineno"> 4704</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4705</span>    <a class="code hl_function" href="#acce3a614f601b06f0120faad9421e25f">send_cors_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4706</span><span class="preprocessor">#if defined(MG_SEND_REDIRECT_BODY)</span></div>
<div class="line"><span class="lineno"> 4707</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Type&quot;</span>, <span class="stringliteral">&quot;text/html&quot;</span>, -1);</div>
<div class="line"><span class="lineno"> 4708</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>, content_len_text, -1);</div>
<div class="line"><span class="lineno"> 4709</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 4710</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, 1);</div>
<div class="line"><span class="lineno"> 4711</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 4712</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno"> 4713</span> </div>
<div class="line"><span class="lineno"> 4714</span><span class="preprocessor">#if defined(MG_SEND_REDIRECT_BODY)</span></div>
<div class="line"><span class="lineno"> 4715</span>    <span class="comment">/* Send response body */</span></div>
<div class="line"><span class="lineno"> 4716</span>    <span class="comment">/* ... unless it is a HEAD request */</span></div>
<div class="line"><span class="lineno"> 4717</span>    <span class="keywordflow">if</span> (0 != strcmp(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>, <span class="stringliteral">&quot;HEAD&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 4718</span>        ret = <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, redirect_body, content_len);</div>
<div class="line"><span class="lineno"> 4719</span>    }</div>
<div class="line"><span class="lineno"> 4720</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 4721</span> </div>
<div class="line"><span class="lineno"> 4722</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 4723</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l06779">mg_write()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04149">send_cors_header()</a>, <a class="el" href="civetweb_8c_source.html#l04056">send_no_cache_header()</a>, and <a class="el" href="civetweb_8c_source.html#l04074">send_static_cache_header()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l14235">redirect_to_https_port()</a>.</p>

</div>
</div>
<a id="a1999d3a7cd176207cc30dcc3205a57c3" name="a1999d3a7cd176207cc30dcc3205a57c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1999d3a7cd176207cc30dcc3205a57c3">&#9670;&#160;</a></span>mg_send_mime_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_send_mime_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>mime_type</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10517">10517</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10520</span>{</div>
<div class="line"><span class="lineno">10521</span>    <a class="code hl_function" href="#ac7547ded66b30ef8d6924f8b8734cfe3">mg_send_mime_file2</a>(conn, path, <a class="code hl_variable" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">10522</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>, <a class="el" href="civetweb_8c_source.html#l08224">mime_type</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

</div>
</div>
<a id="ac7547ded66b30ef8d6924f8b8734cfe3" name="ac7547ded66b30ef8d6924f8b8734cfe3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7547ded66b30ef8d6924f8b8734cfe3">&#9670;&#160;</a></span>mg_send_mime_file2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_send_mime_file2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>mime_type</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>additional_headers</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10526">10526</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10530</span>{</div>
<div class="line"><span class="lineno">10531</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">10532</span> </div>
<div class="line"><span class="lineno">10533</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno">10534</span>        <span class="comment">/* No conn */</span></div>
<div class="line"><span class="lineno">10535</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">10536</span>    }</div>
<div class="line"><span class="lineno">10537</span> </div>
<div class="line"><span class="lineno">10538</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path, &amp;file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>)) {</div>
<div class="line"><span class="lineno">10539</span><span class="preprocessor">#if !defined(NO_CACHING)</span></div>
<div class="line"><span class="lineno">10540</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#aa81530fc67a88c3191c00c52ec06065b">is_not_modified</a>(conn, &amp;file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>)) {</div>
<div class="line"><span class="lineno">10541</span>            <span class="comment">/* Send 304 &quot;Not Modified&quot; - this must not send any body data */</span></div>
<div class="line"><span class="lineno">10542</span>            <a class="code hl_function" href="#ae261fe366cffadac8da5a02c285b9653">handle_not_modified_static_file_request</a>(conn, &amp;file);</div>
<div class="line"><span class="lineno">10543</span>        } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">10544</span><span class="preprocessor">#endif </span><span class="comment">/* NO_CACHING */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">10545</span>            <span class="keywordflow">if</span> (file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a>) {</div>
<div class="line"><span class="lineno">10546</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba00459f3ca65ce96fa33c3d5230624328">ENABLE_DIRECTORY_LISTING</a>],</div>
<div class="line"><span class="lineno">10547</span>                               <span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><span class="lineno">10548</span>                <a class="code hl_function" href="#a7b85ac81c14209bfd8102abe7af190f7">handle_directory_request</a>(conn, path);</div>
<div class="line"><span class="lineno">10549</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">10550</span>                <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">10551</span>                                   403,</div>
<div class="line"><span class="lineno">10552</span>                                   <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">10553</span>                                   <span class="stringliteral">&quot;Error: Directory listing denied&quot;</span>);</div>
<div class="line"><span class="lineno">10554</span>            }</div>
<div class="line"><span class="lineno">10555</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">10556</span>            <a class="code hl_function" href="#a35e5540a0d567e223008b77b2bacb2d5">handle_static_file_request</a>(</div>
<div class="line"><span class="lineno">10557</span>                conn, path, &amp;file, <a class="code hl_variable" href="#a12139285594e136f3f40ec07d2fdc5c5">mime_type</a>, additional_headers);</div>
<div class="line"><span class="lineno">10558</span>        }</div>
<div class="line"><span class="lineno">10559</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">10560</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 404, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Error: File not found&quot;</span>);</div>
<div class="line"><span class="lineno">10561</span>    }</div>
<div class="line"><span class="lineno">10562</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02002">ENABLE_DIRECTORY_LISTING</a>, <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l10483">handle_not_modified_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l10468">is_not_modified()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l08224">mime_type</a>, <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>, and <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10510">mg_send_file()</a>, and <a class="el" href="civetweb_8c_source.html#l10517">mg_send_mime_file()</a>.</p>

</div>
</div>
<a id="a8cacb89c8bc07d18aa4d895d154653a9" name="a8cacb89c8bc07d18aa4d895d154653a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cacb89c8bc07d18aa4d895d154653a9">&#9670;&#160;</a></span>mg_set_auth_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_set_auth_handler </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uri</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a3e8733a4d6d7ae85f0daec45df36f024">mg_authorization_handler</a></td>          <td class="paramname"><span class="paramname"><em>handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>cbdata</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14538">14538</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14542</span>{</div>
<div class="line"><span class="lineno">14543</span>    <a class="code hl_function" href="#aab7fcd7152bcc85bd49b2422f520db2f">mg_set_handler_type</a>(ctx,</div>
<div class="line"><span class="lineno">14544</span>                        &amp;(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>),</div>
<div class="line"><span class="lineno">14545</span>                        uri,</div>
<div class="line"><span class="lineno">14546</span>                        <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7a8617f4f76318f5c524016c5bc6fa864c">AUTH_HANDLER</a>,</div>
<div class="line"><span class="lineno">14547</span>                        handler == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14548</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14549</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14550</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14551</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14552</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14553</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14554</span>                        handler,</div>
<div class="line"><span class="lineno">14555</span>                        cbdata);</div>
<div class="line"><span class="lineno">14556</span>}</div>
<div class="ttc" id="acivetweb_8c_html_aab7fcd7152bcc85bd49b2422f520db2f"><div class="ttname"><a href="#aab7fcd7152bcc85bd49b2422f520db2f">mg_set_handler_type</a></div><div class="ttdeci">static void mg_set_handler_type(struct mg_context *phys_ctx, struct mg_domain_context *dom_ctx, const char *uri, int handler_type, int is_delete_request, mg_request_handler handler, struct mg_websocket_subprotocols *subprotocols, mg_websocket_connect_handler connect_handler, mg_websocket_ready_handler ready_handler, mg_websocket_data_handler data_handler, mg_websocket_close_handler close_handler, mg_authorization_handler auth_handler, void *cbdata)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14280">civetweb.c:14280</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02225">AUTH_HANDLER</a>, <a class="el" href="civetweb_8c_source.html#l02254">mg_handler_info::cbdata</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l02237">mg_handler_info::handler</a>, <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l02230">mg_handler_info::uri</a>.</p>

</div>
</div>
<a id="aab7fcd7152bcc85bd49b2422f520db2f" name="aab7fcd7152bcc85bd49b2422f520db2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab7fcd7152bcc85bd49b2422f520db2f">&#9670;&#160;</a></span>mg_set_handler_type()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mg_set_handler_type </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>phys_ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__domain__context.html">mg_domain_context</a> *</td>          <td class="paramname"><span class="paramname"><em>dom_ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uri</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>handler_type</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>is_delete_request</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac452a63f6ff0d7fd18a143de72a7fd08">mg_request_handler</a></td>          <td class="paramname"><span class="paramname"><em>handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__websocket__subprotocols.html">mg_websocket_subprotocols</a> *</td>          <td class="paramname"><span class="paramname"><em>subprotocols</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ae1e201a8ea4f6895a8cc4e2e2c58da03">mg_websocket_connect_handler</a></td>          <td class="paramname"><span class="paramname"><em>connect_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a5b940f052d5de72f651a9a1e810bed0f">mg_websocket_ready_handler</a></td>          <td class="paramname"><span class="paramname"><em>ready_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a></td>          <td class="paramname"><span class="paramname"><em>data_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a></td>          <td class="paramname"><span class="paramname"><em>close_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a3e8733a4d6d7ae85f0daec45df36f024">mg_authorization_handler</a></td>          <td class="paramname"><span class="paramname"><em>auth_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>cbdata</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14280">14280</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14293</span>{</div>
<div class="line"><span class="lineno">14294</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__handler__info.html">mg_handler_info</a> *tmp_rh, **lastref;</div>
<div class="line"><span class="lineno">14295</span>    <span class="keywordtype">size_t</span> urilen = strlen(<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>);</div>
<div class="line"><span class="lineno">14296</span> </div>
<div class="line"><span class="lineno">14297</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484">WEBSOCKET_HANDLER</a>) {</div>
<div class="line"><span class="lineno">14298</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(<a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14299</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(is_delete_request || <a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><span class="lineno">14300</span>                     || <a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || <a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><span class="lineno">14301</span>                     || <a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14302</span> </div>
<div class="line"><span class="lineno">14303</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(<a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14304</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14305</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14306</span>        }</div>
<div class="line"><span class="lineno">14307</span>        <span class="keywordflow">if</span> (!is_delete_request &amp;&amp; (<a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">14308</span>            &amp;&amp; (<a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (<a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">14309</span>            &amp;&amp; (<a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">14310</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14311</span>        }</div>
<div class="line"><span class="lineno">14312</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14313</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14314</span>        }</div>
<div class="line"><span class="lineno">14315</span> </div>
<div class="line"><span class="lineno">14316</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a>) {</div>
<div class="line"><span class="lineno">14317</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(<a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; <a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><span class="lineno">14318</span>                     &amp;&amp; <a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; <a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14319</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(is_delete_request || (<a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div>
<div class="line"><span class="lineno">14320</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(<a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14321</span> </div>
<div class="line"><span class="lineno">14322</span>        <span class="keywordflow">if</span> ((<a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (<a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">14323</span>            || (<a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (<a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">14324</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14325</span>        }</div>
<div class="line"><span class="lineno">14326</span>        <span class="keywordflow">if</span> (!is_delete_request &amp;&amp; (<a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">14327</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14328</span>        }</div>
<div class="line"><span class="lineno">14329</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14330</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14331</span>        }</div>
<div class="line"><span class="lineno">14332</span> </div>
<div class="line"><span class="lineno">14333</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7a8617f4f76318f5c524016c5bc6fa864c">AUTH_HANDLER</a>) {</div>
<div class="line"><span class="lineno">14334</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(<a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14335</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(<a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; <a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><span class="lineno">14336</span>                     &amp;&amp; <a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; <a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14337</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(is_delete_request || (<a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div>
<div class="line"><span class="lineno">14338</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14339</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14340</span>        }</div>
<div class="line"><span class="lineno">14341</span>        <span class="keywordflow">if</span> ((<a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (<a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">14342</span>            || (<a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (<a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">14343</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14344</span>        }</div>
<div class="line"><span class="lineno">14345</span>        <span class="keywordflow">if</span> (!is_delete_request &amp;&amp; (<a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">14346</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14347</span>        }</div>
<div class="line"><span class="lineno">14348</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14349</span>        <span class="comment">/* Unknown handler type. */</span></div>
<div class="line"><span class="lineno">14350</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14351</span>    }</div>
<div class="line"><span class="lineno">14352</span> </div>
<div class="line"><span class="lineno">14353</span>    <span class="keywordflow">if</span> (!phys_ctx || !dom_ctx) {</div>
<div class="line"><span class="lineno">14354</span>        <span class="comment">/* no context available */</span></div>
<div class="line"><span class="lineno">14355</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14356</span>    }</div>
<div class="line"><span class="lineno">14357</span> </div>
<div class="line"><span class="lineno">14358</span>    <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(phys_ctx);</div>
<div class="line"><span class="lineno">14359</span> </div>
<div class="line"><span class="lineno">14360</span>    <span class="comment">/* first try to find an existing handler */</span></div>
<div class="line"><span class="lineno">14361</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">14362</span>        lastref = &amp;(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#af15ef8d6a276c40c4caeeba414e20aff">handlers</a>);</div>
<div class="line"><span class="lineno">14363</span>        <span class="keywordflow">for</span> (tmp_rh = dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#af15ef8d6a276c40c4caeeba414e20aff">handlers</a>; tmp_rh != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14364</span>             tmp_rh = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a4bfd90da42444fa125cbf0c8ca5d0f8d">next</a>) {</div>
<div class="line"><span class="lineno">14365</span>            <span class="keywordflow">if</span> (tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a></div>
<div class="line"><span class="lineno">14366</span>                &amp;&amp; (urilen == tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a1c9d5733a3887f335361eb5fe5c64941">uri_len</a>) &amp;&amp; !strcmp(tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>, <a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>)) {</div>
<div class="line"><span class="lineno">14367</span>                <span class="keywordflow">if</span> (!is_delete_request) {</div>
<div class="line"><span class="lineno">14368</span>                    <span class="comment">/* update existing handler */</span></div>
<div class="line"><span class="lineno">14369</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a>) {</div>
<div class="line"><span class="lineno">14370</span>                        <span class="comment">/* Wait for end of use before updating */</span></div>
<div class="line"><span class="lineno">14371</span>                        <span class="keywordflow">if</span> (tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a79608a153a2518c199d63e4129b2ec11">refcount</a>) {</div>
<div class="line"><span class="lineno">14372</span>                            <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(phys_ctx);</div>
<div class="line"><span class="lineno">14373</span>                            <a class="code hl_define" href="#af1af7c8ef16047616b5bee88aeee10d6">mg_sleep</a>(1);</div>
<div class="line"><span class="lineno">14374</span>                            <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(phys_ctx);</div>
<div class="line"><span class="lineno">14375</span>                            <span class="comment">/* tmp_rh might have been freed, search again. */</span></div>
<div class="line"><span class="lineno">14376</span>                            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">14377</span>                        }</div>
<div class="line"><span class="lineno">14378</span>                        <span class="comment">/* Ok, the handler is no more use -&gt; Update it */</span></div>
<div class="line"><span class="lineno">14379</span>                        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a>;</div>
<div class="line"><span class="lineno">14380</span>                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484">WEBSOCKET_HANDLER</a>) {</div>
<div class="line"><span class="lineno">14381</span>                        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#ac72d0a5b9cafe4be0b3dafa8d568517f">subprotocols</a> = <a class="code hl_variable" href="structmg__handler__info.html#ac72d0a5b9cafe4be0b3dafa8d568517f">subprotocols</a>;</div>
<div class="line"><span class="lineno">14382</span>                        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a>;</div>
<div class="line"><span class="lineno">14383</span>                        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a>;</div>
<div class="line"><span class="lineno">14384</span>                        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a>;</div>
<div class="line"><span class="lineno">14385</span>                        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a>;</div>
<div class="line"><span class="lineno">14386</span>                    } <span class="keywordflow">else</span> { <span class="comment">/* AUTH_HANDLER */</span></div>
<div class="line"><span class="lineno">14387</span>                        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a>;</div>
<div class="line"><span class="lineno">14388</span>                    }</div>
<div class="line"><span class="lineno">14389</span>                    tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#aaabae3fb2c47d2894fa11beedcca33aa">cbdata</a> = <a class="code hl_variable" href="structmg__handler__info.html#aaabae3fb2c47d2894fa11beedcca33aa">cbdata</a>;</div>
<div class="line"><span class="lineno">14390</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14391</span>                    <span class="comment">/* remove existing handler */</span></div>
<div class="line"><span class="lineno">14392</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a>) {</div>
<div class="line"><span class="lineno">14393</span>                        <span class="comment">/* Wait for end of use before removing */</span></div>
<div class="line"><span class="lineno">14394</span>                        <span class="keywordflow">if</span> (tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a79608a153a2518c199d63e4129b2ec11">refcount</a>) {</div>
<div class="line"><span class="lineno">14395</span>                            tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#ada360840d8b7aa626ee0a6342df03c72">removing</a> = 1;</div>
<div class="line"><span class="lineno">14396</span>                            <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(phys_ctx);</div>
<div class="line"><span class="lineno">14397</span>                            <a class="code hl_define" href="#af1af7c8ef16047616b5bee88aeee10d6">mg_sleep</a>(1);</div>
<div class="line"><span class="lineno">14398</span>                            <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(phys_ctx);</div>
<div class="line"><span class="lineno">14399</span>                            <span class="comment">/* tmp_rh might have been freed, search again. */</span></div>
<div class="line"><span class="lineno">14400</span>                            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">14401</span>                        }</div>
<div class="line"><span class="lineno">14402</span>                        <span class="comment">/* Ok, the handler is no more used */</span></div>
<div class="line"><span class="lineno">14403</span>                    }</div>
<div class="line"><span class="lineno">14404</span>                    *lastref = tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a4bfd90da42444fa125cbf0c8ca5d0f8d">next</a>;</div>
<div class="line"><span class="lineno">14405</span>                    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>);</div>
<div class="line"><span class="lineno">14406</span>                    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(tmp_rh);</div>
<div class="line"><span class="lineno">14407</span>                }</div>
<div class="line"><span class="lineno">14408</span>                <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(phys_ctx);</div>
<div class="line"><span class="lineno">14409</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14410</span>            }</div>
<div class="line"><span class="lineno">14411</span>            lastref = &amp;(tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a4bfd90da42444fa125cbf0c8ca5d0f8d">next</a>);</div>
<div class="line"><span class="lineno">14412</span>        }</div>
<div class="line"><span class="lineno">14413</span>    } <span class="keywordflow">while</span> (tmp_rh != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14414</span> </div>
<div class="line"><span class="lineno">14415</span>    <span class="keywordflow">if</span> (is_delete_request) {</div>
<div class="line"><span class="lineno">14416</span>        <span class="comment">/* no handler to set, this was a remove request to a non-existing</span></div>
<div class="line"><span class="lineno">14417</span><span class="comment">         * handler */</span></div>
<div class="line"><span class="lineno">14418</span>        <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(phys_ctx);</div>
<div class="line"><span class="lineno">14419</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14420</span>    }</div>
<div class="line"><span class="lineno">14421</span> </div>
<div class="line"><span class="lineno">14422</span>    tmp_rh =</div>
<div class="line"><span class="lineno">14423</span>        (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__handler__info.html">mg_handler_info</a> *)<a class="code hl_define" href="#a29f85c2d195a7eb5893fdd101383681b">mg_calloc_ctx</a>(1,</div>
<div class="line"><span class="lineno">14424</span>                                                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="structmg__handler__info.html">mg_handler_info</a>),</div>
<div class="line"><span class="lineno">14425</span>                                                phys_ctx);</div>
<div class="line"><span class="lineno">14426</span>    <span class="keywordflow">if</span> (tmp_rh == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14427</span>        <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(phys_ctx);</div>
<div class="line"><span class="lineno">14428</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">14429</span>                            <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">14430</span>                            <span class="stringliteral">&quot;Cannot create new request handler struct, OOM&quot;</span>);</div>
<div class="line"><span class="lineno">14431</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14432</span>    }</div>
<div class="line"><span class="lineno">14433</span>    tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a> = <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>, phys_ctx);</div>
<div class="line"><span class="lineno">14434</span>    <span class="keywordflow">if</span> (!tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a6df1d0bf772ff0cc74e912b0ffb7264f">uri</a>) {</div>
<div class="line"><span class="lineno">14435</span>        <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(phys_ctx);</div>
<div class="line"><span class="lineno">14436</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(tmp_rh);</div>
<div class="line"><span class="lineno">14437</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">14438</span>                            <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">14439</span>                            <span class="stringliteral">&quot;Cannot create new request handler struct, OOM&quot;</span>);</div>
<div class="line"><span class="lineno">14440</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14441</span>    }</div>
<div class="line"><span class="lineno">14442</span>    tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a1c9d5733a3887f335361eb5fe5c64941">uri_len</a> = urilen;</div>
<div class="line"><span class="lineno">14443</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a>) {</div>
<div class="line"><span class="lineno">14444</span>        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a79608a153a2518c199d63e4129b2ec11">refcount</a> = 0;</div>
<div class="line"><span class="lineno">14445</span>        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#ada360840d8b7aa626ee0a6342df03c72">removing</a> = 0;</div>
<div class="line"><span class="lineno">14446</span>        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#a096c87d46d44f772efb8a53cae02f5a6">handler</a>;</div>
<div class="line"><span class="lineno">14447</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> == <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484">WEBSOCKET_HANDLER</a>) {</div>
<div class="line"><span class="lineno">14448</span>        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#ac72d0a5b9cafe4be0b3dafa8d568517f">subprotocols</a> = <a class="code hl_variable" href="structmg__handler__info.html#ac72d0a5b9cafe4be0b3dafa8d568517f">subprotocols</a>;</div>
<div class="line"><span class="lineno">14449</span>        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#a8ae6876cf6b88993ce82a15560222b66">connect_handler</a>;</div>
<div class="line"><span class="lineno">14450</span>        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#af585e57a9161da42bfe794d7a9468a89">ready_handler</a>;</div>
<div class="line"><span class="lineno">14451</span>        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#adbd9ef4cefda366e3ec0fc51f0c0668e">data_handler</a>;</div>
<div class="line"><span class="lineno">14452</span>        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#a2c6c179c31ba34d5b628b1a61f5b5f3b">close_handler</a>;</div>
<div class="line"><span class="lineno">14453</span>    } <span class="keywordflow">else</span> { <span class="comment">/* AUTH_HANDLER */</span></div>
<div class="line"><span class="lineno">14454</span>        tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a> = <a class="code hl_variable" href="structmg__handler__info.html#a24edb38fe79621c4b10e01c29bb67a5e">auth_handler</a>;</div>
<div class="line"><span class="lineno">14455</span>    }</div>
<div class="line"><span class="lineno">14456</span>    tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#aaabae3fb2c47d2894fa11beedcca33aa">cbdata</a> = <a class="code hl_variable" href="structmg__handler__info.html#aaabae3fb2c47d2894fa11beedcca33aa">cbdata</a>;</div>
<div class="line"><span class="lineno">14457</span>    tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a> = <a class="code hl_variable" href="structmg__handler__info.html#ad914eff891a0a9d15c6622b77a78dfa3">handler_type</a>;</div>
<div class="line"><span class="lineno">14458</span>    tmp_rh-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a4bfd90da42444fa125cbf0c8ca5d0f8d">next</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">14459</span> </div>
<div class="line"><span class="lineno">14460</span>    *lastref = tmp_rh;</div>
<div class="line"><span class="lineno">14461</span>    <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(phys_ctx);</div>
<div class="line"><span class="lineno">14462</span>}</div>
<div class="ttc" id="acivetweb_8c_html_af1af7c8ef16047616b5bee88aeee10d6"><div class="ttname"><a href="#af1af7c8ef16047616b5bee88aeee10d6">mg_sleep</a></div><div class="ttdeci">#define mg_sleep(x)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00920">civetweb.c:920</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02225">AUTH_HANDLER</a>, <a class="el" href="civetweb_8c_source.html#l02251">mg_handler_info::auth_handler</a>, <a class="el" href="civetweb_8c_source.html#l02254">mg_handler_info::cbdata</a>, <a class="el" href="civetweb_8c_source.html#l02245">mg_handler_info::close_handler</a>, <a class="el" href="civetweb_8c_source.html#l02242">mg_handler_info::connect_handler</a>, <a class="el" href="civetweb_8c_source.html#l02244">mg_handler_info::data_handler</a>, <a class="el" href="civetweb_8c_source.html#l00260">DEBUG_ASSERT</a>, <a class="el" href="civetweb_8c_source.html#l02237">mg_handler_info::handler</a>, <a class="el" href="civetweb_8c_source.html#l02234">mg_handler_info::handler_type</a>, <a class="el" href="civetweb_8c_source.html#l02272">mg_domain_context::handlers</a>, <a class="el" href="civetweb_8c_source.html#l01498">mg_calloc_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="civetweb_8c_source.html#l00920">mg_sleep</a>, <a class="el" href="civetweb_8c_source.html#l03062">mg_strdup_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="civetweb_8c_source.html#l02257">mg_handler_info::next</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02243">mg_handler_info::ready_handler</a>, <a class="el" href="civetweb_8c_source.html#l02238">mg_handler_info::refcount</a>, <a class="el" href="civetweb_8c_source.html#l02239">mg_handler_info::removing</a>, <a class="el" href="civetweb_8c_source.html#l02225">REQUEST_HANDLER</a>, <a class="el" href="civetweb_8c_source.html#l02248">mg_handler_info::subprotocols</a>, <a class="el" href="civetweb_8c_source.html#l02230">mg_handler_info::uri</a>, <a class="el" href="civetweb_8c_source.html#l02231">mg_handler_info::uri_len</a>, and <a class="el" href="civetweb_8c_source.html#l02225">WEBSOCKET_HANDLER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14538">mg_set_auth_handler()</a>, <a class="el" href="civetweb_8c_source.html#l14466">mg_set_request_handler()</a>, and <a class="el" href="civetweb_8c_source.html#l14508">mg_set_websocket_handler_with_subprotocols()</a>.</p>

</div>
</div>
<a id="aef622eb42a2ac7fcc825620b952a36dc" name="aef622eb42a2ac7fcc825620b952a36dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef622eb42a2ac7fcc825620b952a36dc">&#9670;&#160;</a></span>mg_set_request_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_set_request_handler </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uri</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac452a63f6ff0d7fd18a143de72a7fd08">mg_request_handler</a></td>          <td class="paramname"><span class="paramname"><em>handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>cbdata</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14466">14466</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14470</span>{</div>
<div class="line"><span class="lineno">14471</span>    <a class="code hl_function" href="#aab7fcd7152bcc85bd49b2422f520db2f">mg_set_handler_type</a>(ctx,</div>
<div class="line"><span class="lineno">14472</span>                        &amp;(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>),</div>
<div class="line"><span class="lineno">14473</span>                        uri,</div>
<div class="line"><span class="lineno">14474</span>                        <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7aeb4819ce8254cd0515c896d0d479aa0e">REQUEST_HANDLER</a>,</div>
<div class="line"><span class="lineno">14475</span>                        handler == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14476</span>                        handler,</div>
<div class="line"><span class="lineno">14477</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14478</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14479</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14480</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14481</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14482</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14483</span>                        cbdata);</div>
<div class="line"><span class="lineno">14484</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02254">mg_handler_info::cbdata</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l02237">mg_handler_info::handler</a>, <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02225">REQUEST_HANDLER</a>, and <a class="el" href="civetweb_8c_source.html#l02230">mg_handler_info::uri</a>.</p>

<p class="reference">Referenced by <a class="el" href="server_8c_source.html#l00059">start_http_server()</a>.</p>

</div>
</div>
<a id="a4c02435b9feed10fb546e874e85ecf83" name="a4c02435b9feed10fb546e874e85ecf83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c02435b9feed10fb546e874e85ecf83">&#9670;&#160;</a></span>mg_set_thread_name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void static void mg_set_thread_name </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02780">2780</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2781</span>{</div>
<div class="line"><span class="lineno"> 2782</span>    <span class="keywordtype">char</span> threadName[16 + 1]; <span class="comment">/* 16 = Max. thread length in Linux/OSX/.. */</span></div>
<div class="line"><span class="lineno"> 2783</span> </div>
<div class="line"><span class="lineno"> 2784</span>    <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(</div>
<div class="line"><span class="lineno"> 2785</span>        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, threadName, <span class="keyword">sizeof</span>(threadName), <span class="stringliteral">&quot;civetweb-%s&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno"> 2786</span> </div>
<div class="line"><span class="lineno"> 2787</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 2788</span><span class="preprocessor">#if defined(_MSC_VER)</span></div>
<div class="line"><span class="lineno"> 2789</span>    <span class="comment">/* Windows and Visual Studio Compiler */</span></div>
<div class="line"><span class="lineno"> 2790</span>    __try {</div>
<div class="line"><span class="lineno"> 2791</span>        THREADNAME_INFO info;</div>
<div class="line"><span class="lineno"> 2792</span>        info.dwType = 0x1000;</div>
<div class="line"><span class="lineno"> 2793</span>        info.szName = threadName;</div>
<div class="line"><span class="lineno"> 2794</span>        info.dwThreadID = ~0U;</div>
<div class="line"><span class="lineno"> 2795</span>        info.dwFlags = 0;</div>
<div class="line"><span class="lineno"> 2796</span> </div>
<div class="line"><span class="lineno"> 2797</span>        RaiseException(0x406D1388,</div>
<div class="line"><span class="lineno"> 2798</span>                       0,</div>
<div class="line"><span class="lineno"> 2799</span>                       <span class="keyword">sizeof</span>(info) / <span class="keyword">sizeof</span>(ULONG_PTR),</div>
<div class="line"><span class="lineno"> 2800</span>                       (ULONG_PTR *)&amp;info);</div>
<div class="line"><span class="lineno"> 2801</span>    } __except (EXCEPTION_EXECUTE_HANDLER) {</div>
<div class="line"><span class="lineno"> 2802</span>    }</div>
<div class="line"><span class="lineno"> 2803</span><span class="preprocessor">#elif defined(__MINGW32__)</span></div>
<div class="line"><span class="lineno"> 2804</span>    <span class="comment">/* No option known to set thread name for MinGW known */</span></div>
<div class="line"><span class="lineno"> 2805</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2806</span><span class="preprocessor">#elif defined(_GNU_SOURCE) &amp;&amp; defined(__GLIBC__)                               \</span></div>
<div class="line"><span class="lineno"> 2807</span><span class="preprocessor">    &amp;&amp; ((__GLIBC__ &gt; 2) || ((__GLIBC__ == 2) &amp;&amp; (__GLIBC_MINOR__ &gt;= 12)))</span></div>
<div class="line"><span class="lineno"> 2808</span>    <span class="comment">/* pthread_setname_np first appeared in glibc in version 2.12 */</span></div>
<div class="line"><span class="lineno"> 2809</span><span class="preprocessor">#if defined(__MACH__) &amp;&amp; defined(__APPLE__)</span></div>
<div class="line"><span class="lineno"> 2810</span>    <span class="comment">/* OS X only current thread name can be changed */</span></div>
<div class="line"><span class="lineno"> 2811</span>    (void)pthread_setname_np(threadName);</div>
<div class="line"><span class="lineno"> 2812</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 2813</span>    (void)pthread_setname_np(pthread_self(), threadName);</div>
<div class="line"><span class="lineno"> 2814</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2815</span><span class="preprocessor">#elif defined(__linux__)</span></div>
<div class="line"><span class="lineno"> 2816</span>    <span class="comment">/* On Linux we can use the prctl function.</span></div>
<div class="line"><span class="lineno"> 2817</span><span class="comment">     * When building for Linux Standard Base (LSB) use</span></div>
<div class="line"><span class="lineno"> 2818</span><span class="comment">     * NO_THREAD_NAME. However, thread names are a big</span></div>
<div class="line"><span class="lineno"> 2819</span><span class="comment">     * help for debugging, so the stadard is to set them.</span></div>
<div class="line"><span class="lineno"> 2820</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 2821</span>    (void)prctl(PR_SET_NAME, threadName, 0, 0, 0);</div>
<div class="line"><span class="lineno"> 2822</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2823</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a83b9266322b1883981ec399cfce275a4" name="a83b9266322b1883981ec399cfce275a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83b9266322b1883981ec399cfce275a4">&#9670;&#160;</a></span>mg_set_user_connection_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_set_user_connection_data </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>const_conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>data</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03225">3225</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3226</span>{</div>
<div class="line"><span class="lineno"> 3227</span>    <span class="keywordflow">if</span> (const_conn != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3228</span>        <span class="comment">/* Const cast, since &quot;const struct mg_connection *&quot; does not mean</span></div>
<div class="line"><span class="lineno"> 3229</span><span class="comment">         * the connection object is not modified. Here &quot;const&quot; is used,</span></div>
<div class="line"><span class="lineno"> 3230</span><span class="comment">         * to indicate mg_read/mg_write/mg_send/.. must not be called. */</span></div>
<div class="line"><span class="lineno"> 3231</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *conn = (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)const_conn;</div>
<div class="line"><span class="lineno"> 3232</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aad3d4e3de727f7424ff7526ed085716e">conn_data</a> = data;</div>
<div class="line"><span class="lineno"> 3233</span>    }</div>
<div class="line"><span class="lineno"> 3234</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00176">mg_request_info::conn_data</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17864">close_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l19329">init_connection()</a>.</p>

</div>
</div>
<a id="a37cd18006941f3abb1538db60cf4f805" name="a37cd18006941f3abb1538db60cf4f805"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37cd18006941f3abb1538db60cf4f805">&#9670;&#160;</a></span>mg_set_websocket_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_set_websocket_handler </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uri</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ae1e201a8ea4f6895a8cc4e2e2c58da03">mg_websocket_connect_handler</a></td>          <td class="paramname"><span class="paramname"><em>connect_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a5b940f052d5de72f651a9a1e810bed0f">mg_websocket_ready_handler</a></td>          <td class="paramname"><span class="paramname"><em>ready_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a></td>          <td class="paramname"><span class="paramname"><em>data_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a></td>          <td class="paramname"><span class="paramname"><em>close_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>cbdata</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14488">14488</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14495</span>{</div>
<div class="line"><span class="lineno">14496</span>    <a class="code hl_function" href="#a07eff82d8b7be88f16ba1a1653d09d3d">mg_set_websocket_handler_with_subprotocols</a>(ctx,</div>
<div class="line"><span class="lineno">14497</span>                                               uri,</div>
<div class="line"><span class="lineno">14498</span>                                               <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14499</span>                                               connect_handler,</div>
<div class="line"><span class="lineno">14500</span>                                               ready_handler,</div>
<div class="line"><span class="lineno">14501</span>                                               data_handler,</div>
<div class="line"><span class="lineno">14502</span>                                               close_handler,</div>
<div class="line"><span class="lineno">14503</span>                                               cbdata);</div>
<div class="line"><span class="lineno">14504</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a07eff82d8b7be88f16ba1a1653d09d3d"><div class="ttname"><a href="#a07eff82d8b7be88f16ba1a1653d09d3d">mg_set_websocket_handler_with_subprotocols</a></div><div class="ttdeci">CIVETWEB_API void mg_set_websocket_handler_with_subprotocols(struct mg_context *ctx, const char *uri, struct mg_websocket_subprotocols *subprotocols, mg_websocket_connect_handler connect_handler, mg_websocket_ready_handler ready_handler, mg_websocket_data_handler data_handler, mg_websocket_close_handler close_handler, void *cbdata)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14508">civetweb.c:14508</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02254">mg_handler_info::cbdata</a>, <a class="el" href="civetweb_8c_source.html#l02245">mg_handler_info::close_handler</a>, <a class="el" href="civetweb_8c_source.html#l02242">mg_handler_info::connect_handler</a>, <a class="el" href="civetweb_8c_source.html#l02244">mg_handler_info::data_handler</a>, <a class="el" href="civetweb_8c_source.html#l14508">mg_set_websocket_handler_with_subprotocols()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02243">mg_handler_info::ready_handler</a>, and <a class="el" href="civetweb_8c_source.html#l02230">mg_handler_info::uri</a>.</p>

</div>
</div>
<a id="a07eff82d8b7be88f16ba1a1653d09d3d" name="a07eff82d8b7be88f16ba1a1653d09d3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07eff82d8b7be88f16ba1a1653d09d3d">&#9670;&#160;</a></span>mg_set_websocket_handler_with_subprotocols()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_set_websocket_handler_with_subprotocols </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uri</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__websocket__subprotocols.html">mg_websocket_subprotocols</a> *</td>          <td class="paramname"><span class="paramname"><em>subprotocols</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ae1e201a8ea4f6895a8cc4e2e2c58da03">mg_websocket_connect_handler</a></td>          <td class="paramname"><span class="paramname"><em>connect_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a5b940f052d5de72f651a9a1e810bed0f">mg_websocket_ready_handler</a></td>          <td class="paramname"><span class="paramname"><em>ready_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ac0e8e90ed1e8b0af95b9a940f6fee3a9">mg_websocket_data_handler</a></td>          <td class="paramname"><span class="paramname"><em>data_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#ad7e7633a49e5a5e748b0c8bdb22c336d">mg_websocket_close_handler</a></td>          <td class="paramname"><span class="paramname"><em>close_handler</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>cbdata</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14508">14508</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14517</span>{</div>
<div class="line"><span class="lineno">14518</span>    <span class="keywordtype">int</span> is_delete_request = (connect_handler == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (ready_handler == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">14519</span>                            &amp;&amp; (data_handler == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">14520</span>                            &amp;&amp; (close_handler == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">14521</span>    <a class="code hl_function" href="#aab7fcd7152bcc85bd49b2422f520db2f">mg_set_handler_type</a>(ctx,</div>
<div class="line"><span class="lineno">14522</span>                        &amp;(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>),</div>
<div class="line"><span class="lineno">14523</span>                        uri,</div>
<div class="line"><span class="lineno">14524</span>                        <a class="code hl_enumvalue" href="#adf764cbdea00d65edcd07bb9953ad2b7af74860d9cc9b0b1ddd9fb840147a8484">WEBSOCKET_HANDLER</a>,</div>
<div class="line"><span class="lineno">14525</span>                        is_delete_request,</div>
<div class="line"><span class="lineno">14526</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14527</span>                        subprotocols,</div>
<div class="line"><span class="lineno">14528</span>                        connect_handler,</div>
<div class="line"><span class="lineno">14529</span>                        ready_handler,</div>
<div class="line"><span class="lineno">14530</span>                        data_handler,</div>
<div class="line"><span class="lineno">14531</span>                        close_handler,</div>
<div class="line"><span class="lineno">14532</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">14533</span>                        cbdata);</div>
<div class="line"><span class="lineno">14534</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02254">mg_handler_info::cbdata</a>, <a class="el" href="civetweb_8c_source.html#l02245">mg_handler_info::close_handler</a>, <a class="el" href="civetweb_8c_source.html#l02242">mg_handler_info::connect_handler</a>, <a class="el" href="civetweb_8c_source.html#l02244">mg_handler_info::data_handler</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02243">mg_handler_info::ready_handler</a>, <a class="el" href="civetweb_8c_source.html#l02248">mg_handler_info::subprotocols</a>, <a class="el" href="civetweb_8c_source.html#l02230">mg_handler_info::uri</a>, and <a class="el" href="civetweb_8c_source.html#l02225">WEBSOCKET_HANDLER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14488">mg_set_websocket_handler()</a>.</p>

</div>
</div>
<a id="a1f766591e7306dab15d063b9bf7c0839" name="a1f766591e7306dab15d063b9bf7c0839"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f766591e7306dab15d063b9bf7c0839">&#9670;&#160;</a></span>mg_snprintf() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mg_snprintf </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>truncated</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>buflen</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03143">3143</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3149</span>{</div>
<div class="line"><span class="lineno"> 3150</span>    va_list ap;</div>
<div class="line"><span class="lineno"> 3151</span> </div>
<div class="line"><span class="lineno"> 3152</span>    va_start(ap, fmt);</div>
<div class="line"><span class="lineno"> 3153</span>    <a class="code hl_function" href="#aca9e6d65ed7802c47e4e3ef6413d8c39">mg_vsnprintf</a>(conn, truncated, buf, buflen, fmt, ap);</div>
<div class="line"><span class="lineno"> 3154</span>    va_end(ap);</div>
<div class="line"><span class="lineno"> 3155</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03094">mg_vsnprintf()</a>.</p>

</div>
</div>
<a id="a847434a4a5f5ea7a1a1bca87625ccb81" name="a847434a4a5f5ea7a1a1bca87625ccb81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a847434a4a5f5ea7a1a1bca87625ccb81">&#9670;&#160;</a></span>mg_snprintf() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mg_snprintf </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>truncated</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>buflen</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a2bb9db6ffe087ec4f44662ed3dfa0abd">PRINTF_FORMAT_STRING</a>(const char *fmt)</td>          <td class="paramname"><span class="paramname">, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>, <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l10181">construct_etag()</a>, <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l18569">get_message()</a>, <a class="el" href="civetweb_8c_source.html#l18645">get_request()</a>, <a class="el" href="civetweb_8c_source.html#l18737">get_response()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>, <a class="el" href="civetweb_8c_source.html#l16715">load_tls_dll()</a>, <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>, <a class="el" href="civetweb_8c_source.html#l18874">mg_download()</a>, <a class="el" href="civetweb_8c_source.html#l21843">mg_get_context_info()</a>, <a class="el" href="civetweb_8c_source.html#l18822">mg_get_response()</a>, <a class="el" href="civetweb_8c_source.html#l21512">mg_get_system_info()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l04576">mg_send_http_ok()</a>, <a class="el" href="civetweb_8c_source.html#l04618">mg_send_http_redirect()</a>, <a class="el" href="civetweb_8c_source.html#l02780">mg_set_thread_name()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, <a class="el" href="civetweb_8c_source.html#l08472">open_auth_file()</a>, <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>, <a class="el" href="civetweb_8c_source.html#l09609">print_dir_entry()</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>, <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l08974">send_authorization_request()</a>, and <a class="el" href="civetweb_8c_source.html#l04074">send_static_cache_header()</a>.</p>

</div>
</div>
<a id="ae4568e555e11dae99b04de8c0a22e358" name="ae4568e555e11dae99b04de8c0a22e358"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4568e555e11dae99b04de8c0a22e358">&#9670;&#160;</a></span>mg_split_form_urlencoded()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_split_form_urlencoded </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>data</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__header.html">mg_header</a> *</td>          <td class="paramname"><span class="paramname"><em>form_fields</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned</td>          <td class="paramname"><span class="paramname"><em>num_form_fields</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07157">7157</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7160</span>{</div>
<div class="line"><span class="lineno"> 7161</span>    <span class="keywordtype">char</span> *b;</div>
<div class="line"><span class="lineno"> 7162</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno"> 7163</span>    <span class="keywordtype">int</span> num = 0;</div>
<div class="line"><span class="lineno"> 7164</span> </div>
<div class="line"><span class="lineno"> 7165</span>    <span class="keywordflow">if</span> (data == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7166</span>        <span class="comment">/* parameter error */</span></div>
<div class="line"><span class="lineno"> 7167</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 7168</span>    }</div>
<div class="line"><span class="lineno"> 7169</span> </div>
<div class="line"><span class="lineno"> 7170</span>    <span class="keywordflow">if</span> ((form_fields == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (num_form_fields == 0)) {</div>
<div class="line"><span class="lineno"> 7171</span>        <span class="comment">/* determine the number of expected fields */</span></div>
<div class="line"><span class="lineno"> 7172</span>        <span class="keywordflow">if</span> (data[0] == 0) {</div>
<div class="line"><span class="lineno"> 7173</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 7174</span>        }</div>
<div class="line"><span class="lineno"> 7175</span>        <span class="comment">/* count number of &amp; to return the number of key-value-pairs */</span></div>
<div class="line"><span class="lineno"> 7176</span>        num = 1;</div>
<div class="line"><span class="lineno"> 7177</span>        <span class="keywordflow">while</span> (*data) {</div>
<div class="line"><span class="lineno"> 7178</span>            <span class="keywordflow">if</span> (*data == <span class="charliteral">&#39;&amp;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 7179</span>                num++;</div>
<div class="line"><span class="lineno"> 7180</span>            }</div>
<div class="line"><span class="lineno"> 7181</span>            data++;</div>
<div class="line"><span class="lineno"> 7182</span>        }</div>
<div class="line"><span class="lineno"> 7183</span>        <span class="keywordflow">return</span> num;</div>
<div class="line"><span class="lineno"> 7184</span>    }</div>
<div class="line"><span class="lineno"> 7185</span> </div>
<div class="line"><span class="lineno"> 7186</span>    <span class="keywordflow">if</span> ((form_fields == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || ((<span class="keywordtype">int</span>)num_form_fields &lt;= 0)) {</div>
<div class="line"><span class="lineno"> 7187</span>        <span class="comment">/* parameter error */</span></div>
<div class="line"><span class="lineno"> 7188</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 7189</span>    }</div>
<div class="line"><span class="lineno"> 7190</span> </div>
<div class="line"><span class="lineno"> 7191</span>    <span class="keywordflow">for</span> (i = 0; i &lt; (int)num_form_fields; i++) {</div>
<div class="line"><span class="lineno"> 7192</span>        <span class="comment">/* extract key-value pairs from input data */</span></div>
<div class="line"><span class="lineno"> 7193</span>        <span class="keywordflow">while</span> ((*data == <span class="charliteral">&#39; &#39;</span>) || (*data == <span class="charliteral">&#39;\t&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 7194</span>            <span class="comment">/* skip initial spaces */</span></div>
<div class="line"><span class="lineno"> 7195</span>            data++;</div>
<div class="line"><span class="lineno"> 7196</span>        }</div>
<div class="line"><span class="lineno"> 7197</span>        <span class="keywordflow">if</span> (*data == 0) {</div>
<div class="line"><span class="lineno"> 7198</span>            <span class="comment">/* end of string reached */</span></div>
<div class="line"><span class="lineno"> 7199</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 7200</span>        }</div>
<div class="line"><span class="lineno"> 7201</span>        form_fields[num].<a class="code hl_variable" href="structmg__header.html#ab91ffbf88fe154a963031e915adf8397">name</a> = data;</div>
<div class="line"><span class="lineno"> 7202</span> </div>
<div class="line"><span class="lineno"> 7203</span>        <span class="comment">/* find &amp; or = */</span></div>
<div class="line"><span class="lineno"> 7204</span>        b = data;</div>
<div class="line"><span class="lineno"> 7205</span>        <span class="keywordflow">while</span> ((*b != 0) &amp;&amp; (*b != <span class="charliteral">&#39;&amp;&#39;</span>) &amp;&amp; (*b != <span class="charliteral">&#39;=&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 7206</span>            b++;</div>
<div class="line"><span class="lineno"> 7207</span>        }</div>
<div class="line"><span class="lineno"> 7208</span> </div>
<div class="line"><span class="lineno"> 7209</span>        <span class="keywordflow">if</span> (*b == 0) {</div>
<div class="line"><span class="lineno"> 7210</span>            <span class="comment">/* last key without value */</span></div>
<div class="line"><span class="lineno"> 7211</span>            form_fields[num].<a class="code hl_variable" href="structmg__header.html#a9cdd7ef80ee309a6de14684059081d0d">value</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 7212</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*b == <span class="charliteral">&#39;&amp;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 7213</span>            <span class="comment">/* mid key without value */</span></div>
<div class="line"><span class="lineno"> 7214</span>            form_fields[num].<a class="code hl_variable" href="structmg__header.html#a9cdd7ef80ee309a6de14684059081d0d">value</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 7215</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 7216</span>            <span class="comment">/* terminate string */</span></div>
<div class="line"><span class="lineno"> 7217</span>            *b = 0;</div>
<div class="line"><span class="lineno"> 7218</span>            <span class="comment">/* value starts after &#39;=&#39; */</span></div>
<div class="line"><span class="lineno"> 7219</span>            data = b + 1;</div>
<div class="line"><span class="lineno"> 7220</span>            form_fields[num].<a class="code hl_variable" href="structmg__header.html#a9cdd7ef80ee309a6de14684059081d0d">value</a> = data;</div>
<div class="line"><span class="lineno"> 7221</span>        }</div>
<div class="line"><span class="lineno"> 7222</span> </div>
<div class="line"><span class="lineno"> 7223</span>        <span class="comment">/* new field is stored */</span></div>
<div class="line"><span class="lineno"> 7224</span>        num++;</div>
<div class="line"><span class="lineno"> 7225</span> </div>
<div class="line"><span class="lineno"> 7226</span>        <span class="comment">/* find a next key */</span></div>
<div class="line"><span class="lineno"> 7227</span>        b = strchr(data, <span class="charliteral">&#39;&amp;&#39;</span>);</div>
<div class="line"><span class="lineno"> 7228</span>        <span class="keywordflow">if</span> (b == 0) {</div>
<div class="line"><span class="lineno"> 7229</span>            <span class="comment">/* no more data */</span></div>
<div class="line"><span class="lineno"> 7230</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 7231</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 7232</span>            <span class="comment">/* terminate value of last field at &#39;&amp;&#39; */</span></div>
<div class="line"><span class="lineno"> 7233</span>            *b = 0;</div>
<div class="line"><span class="lineno"> 7234</span>            <span class="comment">/* next key-value-pairs starts after &#39;&amp;&#39; */</span></div>
<div class="line"><span class="lineno"> 7235</span>            data = b + 1;</div>
<div class="line"><span class="lineno"> 7236</span>        }</div>
<div class="line"><span class="lineno"> 7237</span>    }</div>
<div class="line"><span class="lineno"> 7238</span> </div>
<div class="line"><span class="lineno"> 7239</span>    <span class="comment">/* Decode all values */</span></div>
<div class="line"><span class="lineno"> 7240</span>    <span class="keywordflow">for</span> (i = 0; i &lt; num; i++) {</div>
<div class="line"><span class="lineno"> 7241</span>        <span class="keywordflow">if</span> (form_fields[i].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) {</div>
<div class="line"><span class="lineno"> 7242</span>            <a class="code hl_function" href="#affee01654ebda8d153ea3b7e7502f248">url_decode_in_place</a>((<span class="keywordtype">char</span> *)form_fields[i].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno"> 7243</span>        }</div>
<div class="line"><span class="lineno"> 7244</span>        <span class="keywordflow">if</span> (form_fields[i].<a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>) {</div>
<div class="line"><span class="lineno"> 7245</span>            <a class="code hl_function" href="#affee01654ebda8d153ea3b7e7502f248">url_decode_in_place</a>((<span class="keywordtype">char</span> *)form_fields[i].<a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div>
<div class="line"><span class="lineno"> 7246</span>        }</div>
<div class="line"><span class="lineno"> 7247</span>    }</div>
<div class="line"><span class="lineno"> 7248</span> </div>
<div class="line"><span class="lineno"> 7249</span>    <span class="comment">/* return number of fields found */</span></div>
<div class="line"><span class="lineno"> 7250</span>    <span class="keywordflow">return</span> num;</div>
<div class="line"><span class="lineno"> 7251</span>}</div>
<div class="ttc" id="alsqlite3_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition</b> <a href="lsqlite3_8c_source.html#l02155">lsqlite3.c:2155</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00144">mg_header::name</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l07080">url_decode_in_place()</a>, <a class="el" href="civetweb_8h_source.html#l00145">mg_header::value</a>, and <a class="el" href="lsqlite3_8c_source.html#l02155">value</a>.</p>

</div>
</div>
<a id="abe23ebea2d4b96873ad9b99d092af4a0" name="abe23ebea2d4b96873ad9b99d092af4a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe23ebea2d4b96873ad9b99d092af4a0">&#9670;&#160;</a></span>mg_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__context.html">mg_context</a> * mg_start </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__callbacks.html">mg_callbacks</a> *</td>          <td class="paramname"><span class="paramname"><em>callbacks</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>user_data</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **</td>          <td class="paramname"><span class="paramname"><em>options</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l21205">21205</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">21208</span>{</div>
<div class="line"><span class="lineno">21209</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__init__data.html">mg_init_data</a> init = {0};</div>
<div class="line"><span class="lineno">21210</span>    init.<a class="code hl_variable" href="structmg__init__data.html#ab30a322afe883589c6272494597e7530">callbacks</a> = <a class="code hl_variable" href="structmg__init__data.html#ab30a322afe883589c6272494597e7530">callbacks</a>;</div>
<div class="line"><span class="lineno">21211</span>    init.<a class="code hl_variable" href="structmg__init__data.html#a4cbe171982e177b9c94fed61f992a8e3">user_data</a> = <a class="code hl_variable" href="structmg__init__data.html#a4cbe171982e177b9c94fed61f992a8e3">user_data</a>;</div>
<div class="line"><span class="lineno">21212</span>    init.<a class="code hl_variable" href="structmg__init__data.html#afbf18cefd17ae897b79933b03e6174ac">configuration_options</a> = options;</div>
<div class="line"><span class="lineno">21213</span> </div>
<div class="line"><span class="lineno">21214</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a220e3ffb5ea3741a7c830a9668068617">mg_start2</a>(&amp;init, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">21215</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a220e3ffb5ea3741a7c830a9668068617"><div class="ttname"><a href="#a220e3ffb5ea3741a7c830a9668068617">mg_start2</a></div><div class="ttdeci">CIVETWEB_API struct mg_context * mg_start2(struct mg_init_data *init, struct mg_error_data *error)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l20464">civetweb.c:20464</a></div></div>
<div class="ttc" id="astructmg__init__data_html_a4cbe171982e177b9c94fed61f992a8e3"><div class="ttname"><a href="structmg__init__data.html#a4cbe171982e177b9c94fed61f992a8e3">mg_init_data::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01800">civetweb.h:1800</a></div></div>
<div class="ttc" id="astructmg__init__data_html_ab30a322afe883589c6272494597e7530"><div class="ttname"><a href="structmg__init__data.html#ab30a322afe883589c6272494597e7530">mg_init_data::callbacks</a></div><div class="ttdeci">const struct mg_callbacks * callbacks</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01799">civetweb.h:1799</a></div></div>
<div class="ttc" id="astructmg__init__data_html_afbf18cefd17ae897b79933b03e6174ac"><div class="ttname"><a href="structmg__init__data.html#afbf18cefd17ae897b79933b03e6174ac">mg_init_data::configuration_options</a></div><div class="ttdeci">const char ** configuration_options</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01801">civetweb.h:1801</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l01799">mg_init_data::callbacks</a>, <a class="el" href="civetweb_8h_source.html#l01801">mg_init_data::configuration_options</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8h_source.html#l01800">mg_init_data::user_data</a>.</p>

<p class="reference">Referenced by <a class="el" href="server_8c_source.html#l00059">start_http_server()</a>.</p>

</div>
</div>
<a id="a220e3ffb5ea3741a7c830a9668068617" name="a220e3ffb5ea3741a7c830a9668068617"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a220e3ffb5ea3741a7c830a9668068617">&#9670;&#160;</a></span>mg_start2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> struct <a class="el" href="structmg__context.html">mg_context</a> * mg_start2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__init__data.html">mg_init_data</a> *</td>          <td class="paramname"><span class="paramname"><em>init</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__error__data.html">mg_error_data</a> *</td>          <td class="paramname"><span class="paramname"><em>error</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l20464">20464</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">20465</span>{</div>
<div class="line"><span class="lineno">20466</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__context.html">mg_context</a> *ctx;</div>
<div class="line"><span class="lineno">20467</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, *<a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, *default_value;</div>
<div class="line"><span class="lineno">20468</span>    <span class="keywordtype">int</span> idx, ok, workerthreadcount;</div>
<div class="line"><span class="lineno">20469</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">20470</span>    <span class="keywordtype">int</span> itmp;</div>
<div class="line"><span class="lineno">20471</span>    void (*exit_callback)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structmg__context.html">mg_context</a> *ctx) = 0;</div>
<div class="line"><span class="lineno">20472</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> **options =</div>
<div class="line"><span class="lineno">20473</span>        ((init != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? (init-&gt;<a class="code hl_variable" href="structmg__init__data.html#afbf18cefd17ae897b79933b03e6174ac">configuration_options</a>) : (<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div>
<div class="line"><span class="lineno">20474</span> </div>
<div class="line"><span class="lineno">20475</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> tls;</div>
<div class="line"><span class="lineno">20476</span> </div>
<div class="line"><span class="lineno">20477</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20478</span>        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea6f2b13fd162f7422b5ff4e6dc317e650">MG_ERROR_DATA_CODE_OK</a>;</div>
<div class="line"><span class="lineno">20479</span>        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = 0;</div>
<div class="line"><span class="lineno">20480</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size &gt; 0) {</div>
<div class="line"><span class="lineno">20481</span>            *<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text = 0;</div>
<div class="line"><span class="lineno">20482</span>        }</div>
<div class="line"><span class="lineno">20483</span>    }</div>
<div class="line"><span class="lineno">20484</span> </div>
<div class="line"><span class="lineno">20485</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a> == 0) {</div>
<div class="line"><span class="lineno">20486</span>        <span class="comment">/* Legacy INIT, if mg_start is called without mg_init_library.</span></div>
<div class="line"><span class="lineno">20487</span><span class="comment">         * Note: This will cause a memory leak when unloading the library.</span></div>
<div class="line"><span class="lineno">20488</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">20489</span>        <a class="code hl_function" href="#ac610da3b9f5e065811120249a2f488ac">legacy_init</a>(options);</div>
<div class="line"><span class="lineno">20490</span>    }</div>
<div class="line"><span class="lineno">20491</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a553c3bf49335ca7c4ef0af9293ff30cb">mg_init_library_called</a> == 0) {</div>
<div class="line"><span class="lineno">20492</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20493</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea352663dbd53fd8f4dfcf80887961c7e4">MG_ERROR_DATA_CODE_INIT_LIBRARY_FAILED</a>;</div>
<div class="line"><span class="lineno">20494</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20495</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20496</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20497</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20498</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">20499</span>                        <span class="stringliteral">&quot;Library uninitialized&quot;</span>);</div>
<div class="line"><span class="lineno">20500</span>        }</div>
<div class="line"><span class="lineno">20501</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20502</span>    }</div>
<div class="line"><span class="lineno">20503</span> </div>
<div class="line"><span class="lineno">20504</span>    <span class="comment">/* Allocate context and initialize reasonable general case defaults. */</span></div>
<div class="line"><span class="lineno">20505</span>    ctx = (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__context.html">mg_context</a> *)<a class="code hl_function" href="#ad3552193bd019b58e092032223ac38f1">mg_calloc</a>(1, <span class="keyword">sizeof</span>(*ctx));</div>
<div class="line"><span class="lineno">20506</span>    <span class="keywordflow">if</span> (ctx == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20507</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20508</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead54ef9d63e339f4c05c12cb56564e319">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>;</div>
<div class="line"><span class="lineno">20509</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)<span class="keyword">sizeof</span>(*ctx);</div>
<div class="line"><span class="lineno">20510</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20511</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20512</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20513</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20514</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">20515</span>                        <span class="stringliteral">&quot;Out of memory&quot;</span>);</div>
<div class="line"><span class="lineno">20516</span>        }</div>
<div class="line"><span class="lineno">20517</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20518</span>    }</div>
<div class="line"><span class="lineno">20519</span> </div>
<div class="line"><span class="lineno">20520</span>    <span class="comment">/* Random number generator will initialize at the first call */</span></div>
<div class="line"><span class="lineno">20521</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a935ad1d56f46fde93d51014a96ded25d">auth_nonce_mask</a> =</div>
<div class="line"><span class="lineno">20522</span>        (uint64_t)<a class="code hl_function" href="#afcc8e6176b79900cc58605f1c884d0ab">get_random</a>() ^ (uint64_t)(ptrdiff_t)(options);</div>
<div class="line"><span class="lineno">20523</span> </div>
<div class="line"><span class="lineno">20524</span>    <span class="comment">/* Save started thread index to reuse in other external API calls</span></div>
<div class="line"><span class="lineno">20525</span><span class="comment">     * For the sake of thread synchronization all non-civetweb threads</span></div>
<div class="line"><span class="lineno">20526</span><span class="comment">     * can be considered as single external thread */</span></div>
<div class="line"><span class="lineno">20527</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a810362fe1b277e8f8a01ca5f90c0f5e8">starter_thread_idx</a> = (unsigned)<a class="code hl_function" href="#ac84429c87794be46b88e30fbd3b0bcfa">mg_atomic_inc</a>(&amp;<a class="code hl_variable" href="#af79aed9cc77304a39b3e031b2730e38b">thread_idx_max</a>);</div>
<div class="line"><span class="lineno">20528</span>    tls.is_master = -1; <span class="comment">/* Thread calling mg_start */</span></div>
<div class="line"><span class="lineno">20529</span>    tls.thread_idx = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a810362fe1b277e8f8a01ca5f90c0f5e8">starter_thread_idx</a>;</div>
<div class="line"><span class="lineno">20530</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">20531</span>    tls.pthread_cond_helper_mutex = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20532</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20533</span>    pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, &amp;tls);</div>
<div class="line"><span class="lineno">20534</span> </div>
<div class="line"><span class="lineno">20535</span>    ok = (0 == pthread_mutex_init(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">thread_mutex</a>, &amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>));</div>
<div class="line"><span class="lineno">20536</span><span class="preprocessor">#if !defined(ALTERNATIVE_QUEUE)</span></div>
<div class="line"><span class="lineno">20537</span>    ok &amp;= (0 == pthread_cond_init(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a3260d5fc8e16e35026d7d2bbcb10abf5">sq_empty</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div>
<div class="line"><span class="lineno">20538</span>    ok &amp;= (0 == pthread_cond_init(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aad49398eacc039c312d58c55530c65fa">sq_full</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div>
<div class="line"><span class="lineno">20539</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#affbc1f904d30b616b26c9e9261ca4959">sq_blocked</a> = 0;</div>
<div class="line"><span class="lineno">20540</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20541</span>    ok &amp;= (0 == pthread_mutex_init(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afc4b8c1d52b30239820683d842e975fe">nonce_mutex</a>, &amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>));</div>
<div class="line"><span class="lineno">20542</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">20543</span>    ok &amp;= (0 == pthread_mutex_init(&amp;ctx-&gt;lua_bg_mutex, &amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>));</div>
<div class="line"><span class="lineno">20544</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20545</span>    <span class="keywordflow">if</span> (!ok) {</div>
<div class="line"><span class="lineno">20546</span>        <span class="keywordtype">unsigned</span> error_id = (unsigned)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno">20547</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg =</div>
<div class="line"><span class="lineno">20548</span>            <span class="stringliteral">&quot;Cannot initialize thread synchronization objects&quot;</span>;</div>
<div class="line"><span class="lineno">20549</span>        <span class="comment">/* Fatal error - abort start. However, this situation should never</span></div>
<div class="line"><span class="lineno">20550</span><span class="comment">         * occur in practice. */</span></div>
<div class="line"><span class="lineno">20551</span> </div>
<div class="line"><span class="lineno">20552</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">20553</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20554</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea4ec7bbc93f6f6d5d1f91b2bda132b7f6">MG_ERROR_DATA_CODE_OS_ERROR</a>;</div>
<div class="line"><span class="lineno">20555</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = error_id;</div>
<div class="line"><span class="lineno">20556</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20557</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20558</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20559</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20560</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">20561</span>                        err_msg);</div>
<div class="line"><span class="lineno">20562</span>        }</div>
<div class="line"><span class="lineno">20563</span> </div>
<div class="line"><span class="lineno">20564</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx);</div>
<div class="line"><span class="lineno">20565</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20566</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20567</span>    }</div>
<div class="line"><span class="lineno">20568</span> </div>
<div class="line"><span class="lineno">20569</span>    <span class="keywordflow">if</span> ((init != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (init-&gt;<a class="code hl_variable" href="structmg__init__data.html#ab30a322afe883589c6272494597e7530">callbacks</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">20570</span>        <span class="comment">/* Set all callbacks except exit_context. */</span></div>
<div class="line"><span class="lineno">20571</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a> = *init-&gt;<a class="code hl_variable" href="structmg__init__data.html#ab30a322afe883589c6272494597e7530">callbacks</a>;</div>
<div class="line"><span class="lineno">20572</span>        exit_callback = init-&gt;<a class="code hl_variable" href="structmg__init__data.html#ab30a322afe883589c6272494597e7530">callbacks</a>-&gt;<a class="code hl_variable" href="structmg__callbacks.html#a83dd2d98afc49aeef8f1083034da3659">exit_context</a>;</div>
<div class="line"><span class="lineno">20573</span>        <span class="comment">/* The exit callback is activated once the context is successfully</span></div>
<div class="line"><span class="lineno">20574</span><span class="comment">         * created. It should not be called, if an incomplete context object</span></div>
<div class="line"><span class="lineno">20575</span><span class="comment">         * is deleted during a failed initialization. */</span></div>
<div class="line"><span class="lineno">20576</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a83dd2d98afc49aeef8f1083034da3659">exit_context</a> = 0;</div>
<div class="line"><span class="lineno">20577</span>    }</div>
<div class="line"><span class="lineno">20578</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a73a26dd1c9abead88b40b2d226ad9f28">user_data</a> = ((init != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? (init-&gt;<a class="code hl_variable" href="structmg__init__data.html#a4cbe171982e177b9c94fed61f992a8e3">user_data</a>) : (<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div>
<div class="line"><span class="lineno">20579</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#af15ef8d6a276c40c4caeeba414e20aff">handlers</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20580</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ab15afe08729b3371cf26138782732845">next</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20581</span> </div>
<div class="line"><span class="lineno">20582</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">20583</span>    lua_ctx_init(ctx);</div>
<div class="line"><span class="lineno">20584</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20585</span> </div>
<div class="line"><span class="lineno">20586</span>    <span class="comment">/* Store options */</span></div>
<div class="line"><span class="lineno">20587</span>    <span class="keywordflow">while</span> (options &amp;&amp; (<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = *options++) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20588</span>        idx = <a class="code hl_function" href="#a4d2d84ca4d747d172e74257a176d216d">get_option_index</a>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20589</span>        <span class="keywordflow">if</span> (idx == -1) {</div>
<div class="line"><span class="lineno">20590</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;Invalid option: %s&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20591</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20592</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea7fc609256283dbb6d75046dc307f38cc">MG_ERROR_DATA_CODE_INVALID_OPTION</a>;</div>
<div class="line"><span class="lineno">20593</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)-1;</div>
<div class="line"><span class="lineno">20594</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20595</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20596</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20597</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20598</span>                            <span class="stringliteral">&quot;Invalid configuration option: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20599</span>                            <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20600</span>            }</div>
<div class="line"><span class="lineno">20601</span> </div>
<div class="line"><span class="lineno">20602</span>            <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20603</span>            pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20604</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20605</span> </div>
<div class="line"><span class="lineno">20606</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> = *options++) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20607</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s: option value cannot be NULL&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20608</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20609</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea7fc609256283dbb6d75046dc307f38cc">MG_ERROR_DATA_CODE_INVALID_OPTION</a>;</div>
<div class="line"><span class="lineno">20610</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)idx;</div>
<div class="line"><span class="lineno">20611</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20612</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20613</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20614</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20615</span>                            <span class="stringliteral">&quot;Invalid configuration option value: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20616</span>                            <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20617</span>            }</div>
<div class="line"><span class="lineno">20618</span> </div>
<div class="line"><span class="lineno">20619</span>            <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20620</span>            pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20621</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20622</span>        }</div>
<div class="line"><span class="lineno">20623</span>        <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[idx] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20624</span>            <span class="comment">/* A duplicate configuration option is not an error - the last</span></div>
<div class="line"><span class="lineno">20625</span><span class="comment">             * option value will be used. */</span></div>
<div class="line"><span class="lineno">20626</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;warning: %s: duplicate option&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20627</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[idx]);</div>
<div class="line"><span class="lineno">20628</span>        }</div>
<div class="line"><span class="lineno">20629</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[idx] = <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(<a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, ctx);</div>
<div class="line"><span class="lineno">20630</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;[%s] -&gt; [%s]&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div>
<div class="line"><span class="lineno">20631</span>    }</div>
<div class="line"><span class="lineno">20632</span> </div>
<div class="line"><span class="lineno">20633</span>    <span class="comment">/* Set default value if needed */</span></div>
<div class="line"><span class="lineno">20634</span>    <span class="keywordflow">for</span> (i = 0; <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[i].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; i++) {</div>
<div class="line"><span class="lineno">20635</span>        default_value = <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[i].<a class="code hl_variable" href="structmg__option.html#a59f8f8b81585ce50d69dcc1b094a0067">default_value</a>;</div>
<div class="line"><span class="lineno">20636</span>        <span class="keywordflow">if</span> ((ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[i] == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (default_value != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">20637</span>            ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[i] = <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(default_value, ctx);</div>
<div class="line"><span class="lineno">20638</span>        }</div>
<div class="line"><span class="lineno">20639</span>    }</div>
<div class="line"><span class="lineno">20640</span> </div>
<div class="line"><span class="lineno">20641</span>    <span class="comment">/* Request size option */</span></div>
<div class="line"><span class="lineno">20642</span>    itmp = atoi(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5">MAX_REQUEST_SIZE</a>]);</div>
<div class="line"><span class="lineno">20643</span>    <span class="keywordflow">if</span> (itmp &lt; 1024) {</div>
<div class="line"><span class="lineno">20644</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">20645</span>                            <span class="stringliteral">&quot;%s too small&quot;</span>,</div>
<div class="line"><span class="lineno">20646</span>                            <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5">MAX_REQUEST_SIZE</a>].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20647</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20648</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea7fc609256283dbb6d75046dc307f38cc">MG_ERROR_DATA_CODE_INVALID_OPTION</a>;</div>
<div class="line"><span class="lineno">20649</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5">MAX_REQUEST_SIZE</a>;</div>
<div class="line"><span class="lineno">20650</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20651</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20652</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20653</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20654</span>                        <span class="stringliteral">&quot;Invalid configuration option value: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20655</span>                        <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa79a7d57f223b73b7e921e7227a55fb5">MAX_REQUEST_SIZE</a>].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a>);</div>
<div class="line"><span class="lineno">20656</span>        }</div>
<div class="line"><span class="lineno">20657</span> </div>
<div class="line"><span class="lineno">20658</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20659</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20660</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20661</span>    }</div>
<div class="line"><span class="lineno">20662</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#af17486f182c09fa18f04d21212d6d381">max_request_size</a> = (unsigned)itmp;</div>
<div class="line"><span class="lineno">20663</span> </div>
<div class="line"><span class="lineno">20664</span>    <span class="comment">/* Queue length */</span></div>
<div class="line"><span class="lineno">20665</span><span class="preprocessor">#if !defined(ALTERNATIVE_QUEUE)</span></div>
<div class="line"><span class="lineno">20666</span>    itmp = atoi(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3">CONNECTION_QUEUE_SIZE</a>]);</div>
<div class="line"><span class="lineno">20667</span>    <span class="keywordflow">if</span> (itmp &lt; 1) {</div>
<div class="line"><span class="lineno">20668</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">20669</span>                            <span class="stringliteral">&quot;%s too small&quot;</span>,</div>
<div class="line"><span class="lineno">20670</span>                            <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3">CONNECTION_QUEUE_SIZE</a>].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20671</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20672</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea7fc609256283dbb6d75046dc307f38cc">MG_ERROR_DATA_CODE_INVALID_OPTION</a>;</div>
<div class="line"><span class="lineno">20673</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3">CONNECTION_QUEUE_SIZE</a>;</div>
<div class="line"><span class="lineno">20674</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20675</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20676</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20677</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20678</span>                        <span class="stringliteral">&quot;Invalid configuration option value: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20679</span>                        <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3">CONNECTION_QUEUE_SIZE</a>].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a>);</div>
<div class="line"><span class="lineno">20680</span>        }</div>
<div class="line"><span class="lineno">20681</span> </div>
<div class="line"><span class="lineno">20682</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20683</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20684</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20685</span>    }</div>
<div class="line"><span class="lineno">20686</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a49b598c1205bc368042ca530011e3316">squeue</a> =</div>
<div class="line"><span class="lineno">20687</span>        (<span class="keyword">struct </span><a class="code hl_struct" href="structsocket.html">socket</a> *)<a class="code hl_function" href="#ad3552193bd019b58e092032223ac38f1">mg_calloc</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)itmp, <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code hl_struct" href="structsocket.html">socket</a>));</div>
<div class="line"><span class="lineno">20688</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a49b598c1205bc368042ca530011e3316">squeue</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20689</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">20690</span>                            <span class="stringliteral">&quot;Out of memory: Cannot allocate %s&quot;</span>,</div>
<div class="line"><span class="lineno">20691</span>                            <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3">CONNECTION_QUEUE_SIZE</a>].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">20692</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20693</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead54ef9d63e339f4c05c12cb56564e319">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>;</div>
<div class="line"><span class="lineno">20694</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)itmp * (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code hl_struct" href="structsocket.html">socket</a>);</div>
<div class="line"><span class="lineno">20695</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20696</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20697</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20698</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20699</span>                        <span class="stringliteral">&quot;Out of memory: Cannot allocate %s&quot;</span>,</div>
<div class="line"><span class="lineno">20700</span>                        <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba36256ef668c8c2dbe1b6e4e0c99445b3">CONNECTION_QUEUE_SIZE</a>].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a>);</div>
<div class="line"><span class="lineno">20701</span>        }</div>
<div class="line"><span class="lineno">20702</span> </div>
<div class="line"><span class="lineno">20703</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20704</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20705</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20706</span>    }</div>
<div class="line"><span class="lineno">20707</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ae906ea24151aba96333859c9b759ccc1">sq_size</a> = itmp;</div>
<div class="line"><span class="lineno">20708</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20709</span> </div>
<div class="line"><span class="lineno">20710</span>    <span class="comment">/* Worker thread count option */</span></div>
<div class="line"><span class="lineno">20711</span>    workerthreadcount = atoi(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa818676aedda10c1d780a84133662831">NUM_THREADS</a>]);</div>
<div class="line"><span class="lineno">20712</span> </div>
<div class="line"><span class="lineno">20713</span>    <span class="keywordflow">if</span> ((workerthreadcount &gt; <a class="code hl_define" href="#a1617828178ff1b5df926d7f469288d3e">MAX_WORKER_THREADS</a>) || (workerthreadcount &lt;= 0)) {</div>
<div class="line"><span class="lineno">20714</span>        <span class="keywordflow">if</span> (workerthreadcount &lt;= 0) {</div>
<div class="line"><span class="lineno">20715</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Invalid number of worker threads&quot;</span>);</div>
<div class="line"><span class="lineno">20716</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">20717</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Too many worker threads&quot;</span>);</div>
<div class="line"><span class="lineno">20718</span>        }</div>
<div class="line"><span class="lineno">20719</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20720</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea7fc609256283dbb6d75046dc307f38cc">MG_ERROR_DATA_CODE_INVALID_OPTION</a>;</div>
<div class="line"><span class="lineno">20721</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa818676aedda10c1d780a84133662831">NUM_THREADS</a>;</div>
<div class="line"><span class="lineno">20722</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20723</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20724</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20725</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20726</span>                        <span class="stringliteral">&quot;Invalid configuration option value: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20727</span>                        <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa818676aedda10c1d780a84133662831">NUM_THREADS</a>].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a>);</div>
<div class="line"><span class="lineno">20728</span>        }</div>
<div class="line"><span class="lineno">20729</span> </div>
<div class="line"><span class="lineno">20730</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20731</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20732</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20733</span>    }</div>
<div class="line"><span class="lineno">20734</span> </div>
<div class="line"><span class="lineno">20735</span>    <span class="comment">/* Document root */</span></div>
<div class="line"><span class="lineno">20736</span><span class="preprocessor">#if defined(NO_FILES)</span></div>
<div class="line"><span class="lineno">20737</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20738</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Document root must not be set&quot;</span>);</div>
<div class="line"><span class="lineno">20739</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20740</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea7fc609256283dbb6d75046dc307f38cc">MG_ERROR_DATA_CODE_INVALID_OPTION</a>;</div>
<div class="line"><span class="lineno">20741</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>;</div>
<div class="line"><span class="lineno">20742</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20743</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20744</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20745</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20746</span>                        <span class="stringliteral">&quot;Invalid configuration option value: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20747</span>                        <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a>);</div>
<div class="line"><span class="lineno">20748</span>        }</div>
<div class="line"><span class="lineno">20749</span> </div>
<div class="line"><span class="lineno">20750</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20751</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20752</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20753</span>    }</div>
<div class="line"><span class="lineno">20754</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20755</span> </div>
<div class="line"><span class="lineno">20756</span>    <a class="code hl_function" href="#a99d34b5bd845aa051904a159156abc26">get_system_name</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8b39174e87cb0b5df1b093066256b2f1">systemName</a>);</div>
<div class="line"><span class="lineno">20757</span> </div>
<div class="line"><span class="lineno">20758</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">20759</span>    <span class="comment">/* If a Lua background script has been configured, start it. */</span></div>
<div class="line"><span class="lineno">20760</span>    ctx-&gt;lua_bg_log_available = 0;</div>
<div class="line"><span class="lineno">20761</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[LUA_BACKGROUND_SCRIPT] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20762</span>        <span class="keywordtype">char</span> ebuf[256];</div>
<div class="line"><span class="lineno">20763</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> opt_vec;</div>
<div class="line"><span class="lineno">20764</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> eq_vec;</div>
<div class="line"><span class="lineno">20765</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *sparams;</div>
<div class="line"><span class="lineno">20766</span> </div>
<div class="line"><span class="lineno">20767</span>        memset(ebuf, 0, <span class="keyword">sizeof</span>(ebuf));</div>
<div class="line"><span class="lineno">20768</span>        pthread_mutex_lock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">20769</span> </div>
<div class="line"><span class="lineno">20770</span>        <span class="comment">/* Create a Lua state, load all standard libraries and the mg table */</span></div>
<div class="line"><span class="lineno">20771</span>        <a class="code hl_struct" href="structlua__State.html">lua_State</a> *state = mg_lua_context_script_prepare(</div>
<div class="line"><span class="lineno">20772</span>            ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[LUA_BACKGROUND_SCRIPT], ctx, ebuf, <span class="keyword">sizeof</span>(ebuf));</div>
<div class="line"><span class="lineno">20773</span>        <span class="keywordflow">if</span> (!state) {</div>
<div class="line"><span class="lineno">20774</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">20775</span>                                <span class="stringliteral">&quot;lua_background_script load error: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20776</span>                                ebuf);</div>
<div class="line"><span class="lineno">20777</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20778</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaa90fd2d35bca54ead229eac4bad9b02d">MG_ERROR_DATA_CODE_SCRIPT_ERROR</a>;</div>
<div class="line"><span class="lineno">20779</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20780</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20781</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20782</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20783</span>                            <span class="stringliteral">&quot;Error in script %s: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20784</span>                            <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[LUA_BACKGROUND_SCRIPT].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a>,</div>
<div class="line"><span class="lineno">20785</span>                            ebuf);</div>
<div class="line"><span class="lineno">20786</span>            }</div>
<div class="line"><span class="lineno">20787</span> </div>
<div class="line"><span class="lineno">20788</span>            pthread_mutex_unlock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">20789</span> </div>
<div class="line"><span class="lineno">20790</span>            <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20791</span>            pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20792</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20793</span>        }</div>
<div class="line"><span class="lineno">20794</span> </div>
<div class="line"><span class="lineno">20795</span>        <span class="comment">/* Add a table with parameters into mg.params */</span></div>
<div class="line"><span class="lineno">20796</span>        sparams = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[LUA_BACKGROUND_SCRIPT_PARAMS];</div>
<div class="line"><span class="lineno">20797</span>        <span class="keywordflow">if</span> (sparams &amp;&amp; sparams[0]) {</div>
<div class="line"><span class="lineno">20798</span>            <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#abc2f6fef4682c1d4cdc33206aaf42bec">lua_getglobal</a>(state, <span class="stringliteral">&quot;mg&quot;</span>);</div>
<div class="line"><span class="lineno">20799</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lapi_8c.html#a1281a7e2b52370cc416123bfd32b1b29">lua_pushstring</a>(state, <span class="stringliteral">&quot;params&quot;</span>);</div>
<div class="line"><span class="lineno">20800</span>            <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#aa59db6b784aa1ec954599a44168c7761">lua_newtable</a>(state);</div>
<div class="line"><span class="lineno">20801</span> </div>
<div class="line"><span class="lineno">20802</span>            <span class="keywordflow">while</span> ((sparams = <a class="code hl_function" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a>(sparams, &amp;opt_vec, &amp;eq_vec))</div>
<div class="line"><span class="lineno">20803</span>                   != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20804</span>                reg_llstring(</div>
<div class="line"><span class="lineno">20805</span>                    state, opt_vec.ptr, opt_vec.len, eq_vec.ptr, eq_vec.len);</div>
<div class="line"><span class="lineno">20806</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(sparams, opt_vec.ptr, opt_vec.len) == 0)</div>
<div class="line"><span class="lineno">20807</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">20808</span>            }</div>
<div class="line"><span class="lineno">20809</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lapi_8c.html#afb2d27f421677ef40425f9054ae216a7">lua_rawset</a>(state, -3);</div>
<div class="line"><span class="lineno">20810</span>            <a class="code hl_define" href="lua-5_81_85_2src_2lua_8h.html#abb8eae2164badeafdb037bc1e03cc822">lua_pop</a>(state, 1);</div>
<div class="line"><span class="lineno">20811</span>        }</div>
<div class="line"><span class="lineno">20812</span> </div>
<div class="line"><span class="lineno">20813</span>        <span class="comment">/* Call script */</span></div>
<div class="line"><span class="lineno">20814</span>        state = mg_lua_context_script_run(state,</div>
<div class="line"><span class="lineno">20815</span>                                          ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[LUA_BACKGROUND_SCRIPT],</div>
<div class="line"><span class="lineno">20816</span>                                          ctx,</div>
<div class="line"><span class="lineno">20817</span>                                          ebuf,</div>
<div class="line"><span class="lineno">20818</span>                                          <span class="keyword">sizeof</span>(ebuf));</div>
<div class="line"><span class="lineno">20819</span>        <span class="keywordflow">if</span> (!state) {</div>
<div class="line"><span class="lineno">20820</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">20821</span>                                <span class="stringliteral">&quot;lua_background_script start error: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20822</span>                                ebuf);</div>
<div class="line"><span class="lineno">20823</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20824</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaa90fd2d35bca54ead229eac4bad9b02d">MG_ERROR_DATA_CODE_SCRIPT_ERROR</a>;</div>
<div class="line"><span class="lineno">20825</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20826</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20827</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20828</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20829</span>                            <span class="stringliteral">&quot;Error in script %s: %s&quot;</span>,</div>
<div class="line"><span class="lineno">20830</span>                            <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a>,</div>
<div class="line"><span class="lineno">20831</span>                            ebuf);</div>
<div class="line"><span class="lineno">20832</span>            }</div>
<div class="line"><span class="lineno">20833</span>            pthread_mutex_unlock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">20834</span> </div>
<div class="line"><span class="lineno">20835</span>            <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20836</span>            pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20837</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20838</span>        }</div>
<div class="line"><span class="lineno">20839</span> </div>
<div class="line"><span class="lineno">20840</span>        <span class="comment">/* state remains valid */</span></div>
<div class="line"><span class="lineno">20841</span>        ctx-&gt;lua_background_state = (<span class="keywordtype">void</span> *)state;</div>
<div class="line"><span class="lineno">20842</span>        pthread_mutex_unlock(&amp;ctx-&gt;lua_bg_mutex);</div>
<div class="line"><span class="lineno">20843</span> </div>
<div class="line"><span class="lineno">20844</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">20845</span>        ctx-&gt;lua_background_state = 0;</div>
<div class="line"><span class="lineno">20846</span>    }</div>
<div class="line"><span class="lineno">20847</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20848</span> </div>
<div class="line"><span class="lineno">20849</span>    <span class="comment">/* Step by step initialization of ctx - depending on build options */</span></div>
<div class="line"><span class="lineno">20850</span><span class="preprocessor">#if !defined(NO_FILESYSTEMS)</span></div>
<div class="line"><span class="lineno">20851</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a6c0f85beb9e4157e5da9ad2550fc2258">set_gpass_option</a>(ctx, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">20852</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Invalid global password file&quot;</span>;</div>
<div class="line"><span class="lineno">20853</span>        <span class="comment">/* Fatal error - abort start. */</span></div>
<div class="line"><span class="lineno">20854</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">20855</span> </div>
<div class="line"><span class="lineno">20856</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20857</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae33de5d81924866d43155b8a3531135f">MG_ERROR_DATA_CODE_INVALID_PASS_FILE</a>;</div>
<div class="line"><span class="lineno">20858</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20859</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20860</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20861</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20862</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">20863</span>                        err_msg);</div>
<div class="line"><span class="lineno">20864</span>        }</div>
<div class="line"><span class="lineno">20865</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20866</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20867</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20868</span>    }</div>
<div class="line"><span class="lineno">20869</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20870</span> </div>
<div class="line"><span class="lineno">20871</span><span class="preprocessor">#if defined(USE_MBEDTLS)</span></div>
<div class="line"><span class="lineno">20872</span>    <span class="keywordflow">if</span> (!mg_sslctx_init(ctx, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">20873</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Error initializing SSL context&quot;</span>;</div>
<div class="line"><span class="lineno">20874</span>        <span class="comment">/* Fatal error - abort start. */</span></div>
<div class="line"><span class="lineno">20875</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">20876</span> </div>
<div class="line"><span class="lineno">20877</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20878</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead5f94e3f9ddc28c9d4a05f18bed659c7">MG_ERROR_DATA_CODE_INIT_TLS_FAILED</a>;</div>
<div class="line"><span class="lineno">20879</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20880</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20881</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20882</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20883</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">20884</span>                        err_msg);</div>
<div class="line"><span class="lineno">20885</span>        }</div>
<div class="line"><span class="lineno">20886</span> </div>
<div class="line"><span class="lineno">20887</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20888</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20889</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20890</span>    }</div>
<div class="line"><span class="lineno">20891</span> </div>
<div class="line"><span class="lineno">20892</span><span class="preprocessor">#elif !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno">20893</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#ae2d6e50236af5e059e4c3e28cc232cff">init_ssl_ctx</a>(ctx, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">20894</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Error initializing SSL context&quot;</span>;</div>
<div class="line"><span class="lineno">20895</span>        <span class="comment">/* Fatal error - abort start. */</span></div>
<div class="line"><span class="lineno">20896</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">20897</span> </div>
<div class="line"><span class="lineno">20898</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20899</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead5f94e3f9ddc28c9d4a05f18bed659c7">MG_ERROR_DATA_CODE_INIT_TLS_FAILED</a>;</div>
<div class="line"><span class="lineno">20900</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20901</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20902</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20903</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20904</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">20905</span>                        err_msg);</div>
<div class="line"><span class="lineno">20906</span>        }</div>
<div class="line"><span class="lineno">20907</span> </div>
<div class="line"><span class="lineno">20908</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20909</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20910</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20911</span>    }</div>
<div class="line"><span class="lineno">20912</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20913</span> </div>
<div class="line"><span class="lineno">20914</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a7c6eca1c5a3388266a2d289ce34fda58">set_ports_option</a>(ctx)) {</div>
<div class="line"><span class="lineno">20915</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Failed to setup server ports&quot;</span>;</div>
<div class="line"><span class="lineno">20916</span>        <span class="comment">/* Fatal error - abort start. */</span></div>
<div class="line"><span class="lineno">20917</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">20918</span> </div>
<div class="line"><span class="lineno">20919</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20920</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eab450ab40c3dc55b101012568d07d6ccc">MG_ERROR_DATA_CODE_INIT_PORTS_FAILED</a>;</div>
<div class="line"><span class="lineno">20921</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20922</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20923</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20924</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20925</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">20926</span>                        err_msg);</div>
<div class="line"><span class="lineno">20927</span>        }</div>
<div class="line"><span class="lineno">20928</span> </div>
<div class="line"><span class="lineno">20929</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20930</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20931</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20932</span>    }</div>
<div class="line"><span class="lineno">20933</span> </div>
<div class="line"><span class="lineno">20934</span><span class="preprocessor">#if !defined(_WIN32) &amp;&amp; !defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno">20935</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a462b35ed3af5d8e9f56280956ee1839e">set_uid_option</a>(ctx)) {</div>
<div class="line"><span class="lineno">20936</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Failed to run as configured user&quot;</span>;</div>
<div class="line"><span class="lineno">20937</span>        <span class="comment">/* Fatal error - abort start. */</span></div>
<div class="line"><span class="lineno">20938</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">20939</span> </div>
<div class="line"><span class="lineno">20940</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20941</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead9cfc7dc6349cd93cd1530cf59a8fa21">MG_ERROR_DATA_CODE_INIT_USER_FAILED</a>;</div>
<div class="line"><span class="lineno">20942</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20943</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20944</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20945</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20946</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">20947</span>                        err_msg);</div>
<div class="line"><span class="lineno">20948</span>        }</div>
<div class="line"><span class="lineno">20949</span> </div>
<div class="line"><span class="lineno">20950</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20951</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20952</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20953</span>    }</div>
<div class="line"><span class="lineno">20954</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20955</span> </div>
<div class="line"><span class="lineno">20956</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a9dc4b721d5bb3b8e494257027050c47f">set_acl_option</a>(ctx)) {</div>
<div class="line"><span class="lineno">20957</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Failed to setup access control list&quot;</span>;</div>
<div class="line"><span class="lineno">20958</span>        <span class="comment">/* Fatal error - abort start. */</span></div>
<div class="line"><span class="lineno">20959</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">20960</span> </div>
<div class="line"><span class="lineno">20961</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20962</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea9d7507f92b0660c66f03dd89210a8740">MG_ERROR_DATA_CODE_INIT_ACL_FAILED</a>;</div>
<div class="line"><span class="lineno">20963</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20964</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20965</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20966</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20967</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">20968</span>                        err_msg);</div>
<div class="line"><span class="lineno">20969</span>        }</div>
<div class="line"><span class="lineno">20970</span> </div>
<div class="line"><span class="lineno">20971</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20972</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20973</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">20974</span>    }</div>
<div class="line"><span class="lineno">20975</span> </div>
<div class="line"><span class="lineno">20976</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a> = ((<span class="keywordtype">unsigned</span> int)(workerthreadcount));</div>
<div class="line"><span class="lineno">20977</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a> = (pthread_t *)<a class="code hl_define" href="#a29f85c2d195a7eb5893fdd101383681b">mg_calloc_ctx</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a>,</div>
<div class="line"><span class="lineno">20978</span>                                                       <span class="keyword">sizeof</span>(pthread_t),</div>
<div class="line"><span class="lineno">20979</span>                                                       ctx);</div>
<div class="line"><span class="lineno">20980</span> </div>
<div class="line"><span class="lineno">20981</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20982</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Not enough memory for worker thread ID array&quot;</span>;</div>
<div class="line"><span class="lineno">20983</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">20984</span> </div>
<div class="line"><span class="lineno">20985</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">20986</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead54ef9d63e339f4c05c12cb56564e319">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>;</div>
<div class="line"><span class="lineno">20987</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub =</div>
<div class="line"><span class="lineno">20988</span>                (unsigned)ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a> * (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(pthread_t);</div>
<div class="line"><span class="lineno">20989</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">20990</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">20991</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">20992</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">20993</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">20994</span>                        err_msg);</div>
<div class="line"><span class="lineno">20995</span>        }</div>
<div class="line"><span class="lineno">20996</span> </div>
<div class="line"><span class="lineno">20997</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20998</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">20999</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">21000</span>    }</div>
<div class="line"><span class="lineno">21001</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a854d7b5d783f951cb08e2aeed380c481">worker_connections</a> =</div>
<div class="line"><span class="lineno">21002</span>        (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)<a class="code hl_define" href="#a29f85c2d195a7eb5893fdd101383681b">mg_calloc_ctx</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a>,</div>
<div class="line"><span class="lineno">21003</span>                                              <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="structmg__connection.html">mg_connection</a>),</div>
<div class="line"><span class="lineno">21004</span>                                              ctx);</div>
<div class="line"><span class="lineno">21005</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a854d7b5d783f951cb08e2aeed380c481">worker_connections</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21006</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg =</div>
<div class="line"><span class="lineno">21007</span>            <span class="stringliteral">&quot;Not enough memory for worker thread connection array&quot;</span>;</div>
<div class="line"><span class="lineno">21008</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">21009</span> </div>
<div class="line"><span class="lineno">21010</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21011</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead54ef9d63e339f4c05c12cb56564e319">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>;</div>
<div class="line"><span class="lineno">21012</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a></div>
<div class="line"><span class="lineno">21013</span>                              * (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a>);</div>
<div class="line"><span class="lineno">21014</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21015</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21016</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21017</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21018</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">21019</span>                        err_msg);</div>
<div class="line"><span class="lineno">21020</span>        }</div>
<div class="line"><span class="lineno">21021</span> </div>
<div class="line"><span class="lineno">21022</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">21023</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">21024</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">21025</span>    }</div>
<div class="line"><span class="lineno">21026</span> </div>
<div class="line"><span class="lineno">21027</span><span class="preprocessor">#if defined(ALTERNATIVE_QUEUE)</span></div>
<div class="line"><span class="lineno">21028</span>    ctx-&gt;client_wait_events =</div>
<div class="line"><span class="lineno">21029</span>        (<span class="keywordtype">void</span> **)<a class="code hl_define" href="#a29f85c2d195a7eb5893fdd101383681b">mg_calloc_ctx</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a>,</div>
<div class="line"><span class="lineno">21030</span>                               <span class="keyword">sizeof</span>(ctx-&gt;client_wait_events[0]),</div>
<div class="line"><span class="lineno">21031</span>                               ctx);</div>
<div class="line"><span class="lineno">21032</span>    <span class="keywordflow">if</span> (ctx-&gt;client_wait_events == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21033</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Not enough memory for worker event array&quot;</span>;</div>
<div class="line"><span class="lineno">21034</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">21035</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>);</div>
<div class="line"><span class="lineno">21036</span> </div>
<div class="line"><span class="lineno">21037</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21038</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead54ef9d63e339f4c05c12cb56564e319">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>;</div>
<div class="line"><span class="lineno">21039</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a></div>
<div class="line"><span class="lineno">21040</span>                              * (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(ctx-&gt;client_wait_events[0]);</div>
<div class="line"><span class="lineno">21041</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21042</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21043</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21044</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21045</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">21046</span>                        err_msg);</div>
<div class="line"><span class="lineno">21047</span>        }</div>
<div class="line"><span class="lineno">21048</span> </div>
<div class="line"><span class="lineno">21049</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">21050</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">21051</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">21052</span>    }</div>
<div class="line"><span class="lineno">21053</span> </div>
<div class="line"><span class="lineno">21054</span>    ctx-&gt;client_socks =</div>
<div class="line"><span class="lineno">21055</span>        (<span class="keyword">struct </span><a class="code hl_struct" href="structsocket.html">socket</a> *)<a class="code hl_define" href="#a29f85c2d195a7eb5893fdd101383681b">mg_calloc_ctx</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a>,</div>
<div class="line"><span class="lineno">21056</span>                                       <span class="keyword">sizeof</span>(ctx-&gt;client_socks[0]),</div>
<div class="line"><span class="lineno">21057</span>                                       ctx);</div>
<div class="line"><span class="lineno">21058</span>    <span class="keywordflow">if</span> (ctx-&gt;client_socks == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21059</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Not enough memory for worker socket array&quot;</span>;</div>
<div class="line"><span class="lineno">21060</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">21061</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;client_wait_events);</div>
<div class="line"><span class="lineno">21062</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>);</div>
<div class="line"><span class="lineno">21063</span> </div>
<div class="line"><span class="lineno">21064</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21065</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead54ef9d63e339f4c05c12cb56564e319">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>;</div>
<div class="line"><span class="lineno">21066</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a></div>
<div class="line"><span class="lineno">21067</span>                              * (<span class="keywordtype">unsigned</span>)<span class="keyword">sizeof</span>(ctx-&gt;client_socks[0]);</div>
<div class="line"><span class="lineno">21068</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21069</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21070</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21071</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21072</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">21073</span>                        err_msg);</div>
<div class="line"><span class="lineno">21074</span>        }</div>
<div class="line"><span class="lineno">21075</span> </div>
<div class="line"><span class="lineno">21076</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">21077</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">21078</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">21079</span>    }</div>
<div class="line"><span class="lineno">21080</span> </div>
<div class="line"><span class="lineno">21081</span>    <span class="keywordflow">for</span> (i = 0; (unsigned)i &lt; ctx-&gt;cfg_worker_threads; i++) {</div>
<div class="line"><span class="lineno">21082</span>        ctx-&gt;client_wait_events[i] = event_create();</div>
<div class="line"><span class="lineno">21083</span>        <span class="keywordflow">if</span> (ctx-&gt;client_wait_events[i] == 0) {</div>
<div class="line"><span class="lineno">21084</span>            <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Error creating worker event %i&quot;</span>;</div>
<div class="line"><span class="lineno">21085</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, err_msg, i);</div>
<div class="line"><span class="lineno">21086</span>            <span class="keywordflow">while</span> (i &gt; 0) {</div>
<div class="line"><span class="lineno">21087</span>                i--;</div>
<div class="line"><span class="lineno">21088</span>                event_destroy(ctx-&gt;client_wait_events[i]);</div>
<div class="line"><span class="lineno">21089</span>            }</div>
<div class="line"><span class="lineno">21090</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;client_socks);</div>
<div class="line"><span class="lineno">21091</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;client_wait_events);</div>
<div class="line"><span class="lineno">21092</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>);</div>
<div class="line"><span class="lineno">21093</span> </div>
<div class="line"><span class="lineno">21094</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21095</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea4ec7bbc93f6f6d5d1f91b2bda132b7f6">MG_ERROR_DATA_CODE_OS_ERROR</a>;</div>
<div class="line"><span class="lineno">21096</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno">21097</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21098</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21099</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21100</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21101</span>                            err_msg,</div>
<div class="line"><span class="lineno">21102</span>                            i);</div>
<div class="line"><span class="lineno">21103</span>            }</div>
<div class="line"><span class="lineno">21104</span> </div>
<div class="line"><span class="lineno">21105</span>            <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">21106</span>            pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">21107</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">21108</span>        }</div>
<div class="line"><span class="lineno">21109</span>    }</div>
<div class="line"><span class="lineno">21110</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21111</span> </div>
<div class="line"><span class="lineno">21112</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno">21113</span>    <span class="keywordflow">if</span> (timers_init(ctx) != 0) {</div>
<div class="line"><span class="lineno">21114</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *err_msg = <span class="stringliteral">&quot;Error creating timers&quot;</span>;</div>
<div class="line"><span class="lineno">21115</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, err_msg);</div>
<div class="line"><span class="lineno">21116</span> </div>
<div class="line"><span class="lineno">21117</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21118</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea4ec7bbc93f6f6d5d1f91b2bda132b7f6">MG_ERROR_DATA_CODE_OS_ERROR</a>;</div>
<div class="line"><span class="lineno">21119</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno">21120</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21121</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21122</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21123</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21124</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">21125</span>                        err_msg);</div>
<div class="line"><span class="lineno">21126</span>        }</div>
<div class="line"><span class="lineno">21127</span> </div>
<div class="line"><span class="lineno">21128</span>        <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">21129</span>        pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">21130</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">21131</span>    }</div>
<div class="line"><span class="lineno">21132</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21133</span> </div>
<div class="line"><span class="lineno">21134</span>    <span class="comment">/* Context has been created - init user libraries */</span></div>
<div class="line"><span class="lineno">21135</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#ab12f9824dc1f6d257fdc2f44706fc158">init_context</a>) {</div>
<div class="line"><span class="lineno">21136</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#ab12f9824dc1f6d257fdc2f44706fc158">init_context</a>(ctx);</div>
<div class="line"><span class="lineno">21137</span>    }</div>
<div class="line"><span class="lineno">21138</span> </div>
<div class="line"><span class="lineno">21139</span>    <span class="comment">/* From now, the context is successfully created.</span></div>
<div class="line"><span class="lineno">21140</span><span class="comment">     * When it is destroyed, the exit callback should be called. */</span></div>
<div class="line"><span class="lineno">21141</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a83dd2d98afc49aeef8f1083034da3659">exit_context</a> = exit_callback;</div>
<div class="line"><span class="lineno">21142</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> = <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099">CONTEXT_SERVER</a>; <span class="comment">/* server context */</span></div>
<div class="line"><span class="lineno">21143</span> </div>
<div class="line"><span class="lineno">21144</span>    <span class="comment">/* Start worker threads */</span></div>
<div class="line"><span class="lineno">21145</span>    <span class="keywordflow">for</span> (i = 0; i &lt; ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a>; i++) {</div>
<div class="line"><span class="lineno">21146</span>        <span class="comment">/* worker_thread sets up the other fields */</span></div>
<div class="line"><span class="lineno">21147</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a854d7b5d783f951cb08e2aeed380c481">worker_connections</a>[i].<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a> = ctx;</div>
<div class="line"><span class="lineno">21148</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a7da29c2b36cd27b1467771e8ac52404e">mg_start_thread_with_id</a>(<a class="code hl_function" href="#adbe073c81a7fabd2785914e1b4a8e3d0">worker_thread</a>,</div>
<div class="line"><span class="lineno">21149</span>                                    &amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a854d7b5d783f951cb08e2aeed380c481">worker_connections</a>[i],</div>
<div class="line"><span class="lineno">21150</span>                                    &amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a50c65eb1270eecad5834817246d86f2b">worker_threadids</a>[i])</div>
<div class="line"><span class="lineno">21151</span>            != 0) {</div>
<div class="line"><span class="lineno">21152</span> </div>
<div class="line"><span class="lineno">21153</span>            <span class="keywordtype">long</span> error_no = (long)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno">21154</span> </div>
<div class="line"><span class="lineno">21155</span>            <span class="comment">/* thread was not created */</span></div>
<div class="line"><span class="lineno">21156</span>            <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><span class="lineno">21157</span>                <span class="comment">/* If the second, third, ... thread cannot be created, set a</span></div>
<div class="line"><span class="lineno">21158</span><span class="comment">                 * warning, but keep running. */</span></div>
<div class="line"><span class="lineno">21159</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">21160</span>                                    <span class="stringliteral">&quot;Cannot start worker thread %i: error %ld&quot;</span>,</div>
<div class="line"><span class="lineno">21161</span>                                    i + 1,</div>
<div class="line"><span class="lineno">21162</span>                                    error_no);</div>
<div class="line"><span class="lineno">21163</span> </div>
<div class="line"><span class="lineno">21164</span>                <span class="comment">/* If the server initialization should stop here, all</span></div>
<div class="line"><span class="lineno">21165</span><span class="comment">                 * threads that have already been created must be stopped</span></div>
<div class="line"><span class="lineno">21166</span><span class="comment">                 * first, before any free_context(ctx) call.</span></div>
<div class="line"><span class="lineno">21167</span><span class="comment">                 */</span></div>
<div class="line"><span class="lineno">21168</span> </div>
<div class="line"><span class="lineno">21169</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">21170</span>                <span class="comment">/* If the first worker thread cannot be created, stop</span></div>
<div class="line"><span class="lineno">21171</span><span class="comment">                 * initialization and free the entire server context. */</span></div>
<div class="line"><span class="lineno">21172</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">21173</span>                                    <span class="stringliteral">&quot;Cannot create threads: error %ld&quot;</span>,</div>
<div class="line"><span class="lineno">21174</span>                                    error_no);</div>
<div class="line"><span class="lineno">21175</span> </div>
<div class="line"><span class="lineno">21176</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21177</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea4ec7bbc93f6f6d5d1f91b2bda132b7f6">MG_ERROR_DATA_CODE_OS_ERROR</a>;</div>
<div class="line"><span class="lineno">21178</span>                    <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)error_no;</div>
<div class="line"><span class="lineno">21179</span>                    <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(</div>
<div class="line"><span class="lineno">21180</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21181</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21182</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21183</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21184</span>                        <span class="stringliteral">&quot;Cannot create first worker thread: error %ld&quot;</span>,</div>
<div class="line"><span class="lineno">21185</span>                        error_no);</div>
<div class="line"><span class="lineno">21186</span>                }</div>
<div class="line"><span class="lineno">21187</span> </div>
<div class="line"><span class="lineno">21188</span>                <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">21189</span>                pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">21190</span>                <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">21191</span>            }</div>
<div class="line"><span class="lineno">21192</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">21193</span>        }</div>
<div class="line"><span class="lineno">21194</span>    }</div>
<div class="line"><span class="lineno">21195</span> </div>
<div class="line"><span class="lineno">21196</span>    <span class="comment">/* Start master (listening) thread */</span></div>
<div class="line"><span class="lineno">21197</span>    <a class="code hl_function" href="#a7da29c2b36cd27b1467771e8ac52404e">mg_start_thread_with_id</a>(<a class="code hl_function" href="#aab5946d38d4ebb16c9dc8cd45a913e99">master_thread</a>, ctx, &amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8bf30f14718695665927de4fa4e05104">masterthreadid</a>);</div>
<div class="line"><span class="lineno">21198</span> </div>
<div class="line"><span class="lineno">21199</span>    pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">21200</span>    <span class="keywordflow">return</span> ctx;</div>
<div class="line"><span class="lineno">21201</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a1617828178ff1b5df926d7f469288d3e"><div class="ttname"><a href="#a1617828178ff1b5df926d7f469288d3e">MAX_WORKER_THREADS</a></div><div class="ttdeci">#define MAX_WORKER_THREADS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00465">civetweb.c:465</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a462b35ed3af5d8e9f56280956ee1839e"><div class="ttname"><a href="#a462b35ed3af5d8e9f56280956ee1839e">set_uid_option</a></div><div class="ttdeci">static int set_uid_option(struct mg_context *phys_ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16267">civetweb.c:16267</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a6c0f85beb9e4157e5da9ad2550fc2258"><div class="ttname"><a href="#a6c0f85beb9e4157e5da9ad2550fc2258">set_gpass_option</a></div><div class="ttdeci">static int set_gpass_option(struct mg_context *phys_ctx, struct mg_domain_context *dom_ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17636">civetweb.c:17636</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a7c6eca1c5a3388266a2d289ce34fda58"><div class="ttname"><a href="#a7c6eca1c5a3388266a2d289ce34fda58">set_ports_option</a></div><div class="ttdeci">static int set_ports_option(struct mg_context *phys_ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l15736">civetweb.c:15736</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a99d34b5bd845aa051904a159156abc26"><div class="ttname"><a href="#a99d34b5bd845aa051904a159156abc26">get_system_name</a></div><div class="ttdeci">static void get_system_name(char **sysName)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l20389">civetweb.c:20389</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a9dc4b721d5bb3b8e494257027050c47f"><div class="ttname"><a href="#a9dc4b721d5bb3b8e494257027050c47f">set_acl_option</a></div><div class="ttdeci">static int set_acl_option(struct mg_context *phys_ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17662">civetweb.c:17662</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aab5946d38d4ebb16c9dc8cd45a913e99"><div class="ttname"><a href="#aab5946d38d4ebb16c9dc8cd45a913e99">master_thread</a></div><div class="ttdeci">static void * master_thread(void *thread_func_param)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l20231">civetweb.c:20231</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac591487b5ffc826f4824c8c1d9a4caaa"><div class="ttname"><a href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a></div><div class="ttdeci">static void free_context(struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l20249">civetweb.c:20249</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ac610da3b9f5e065811120249a2f488ac"><div class="ttname"><a href="#ac610da3b9f5e065811120249a2f488ac">legacy_init</a></div><div class="ttdeci">static void legacy_init(const char **options)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l20436">civetweb.c:20436</a></div></div>
<div class="ttc" id="acivetweb_8c_html_adbe073c81a7fabd2785914e1b4a8e3d0"><div class="ttname"><a href="#adbe073c81a7fabd2785914e1b4a8e3d0">worker_thread</a></div><div class="ttdeci">static void * worker_thread(void *thread_func_param)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l19937">civetweb.c:19937</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ae2d6e50236af5e059e4c3e28cc232cff"><div class="ttname"><a href="#ae2d6e50236af5e059e4c3e28cc232cff">init_ssl_ctx</a></div><div class="ttdeci">static int init_ssl_ctx(struct mg_context *phys_ctx, struct mg_domain_context *dom_ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l17485">civetweb.c:17485</a></div></div>
<div class="ttc" id="acivetweb_8c_html_afcc8e6176b79900cc58605f1c884d0ab"><div class="ttname"><a href="#afcc8e6176b79900cc58605f1c884d0ab">get_random</a></div><div class="ttdeci">static uint64_t get_random(void)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l05909">civetweb.c:5909</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea7fc609256283dbb6d75046dc307f38cc"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea7fc609256283dbb6d75046dc307f38cc">MG_ERROR_DATA_CODE_INVALID_OPTION</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_INVALID_OPTION</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01740">civetweb.h:1740</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea9d7507f92b0660c66f03dd89210a8740"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea9d7507f92b0660c66f03dd89210a8740">MG_ERROR_DATA_CODE_INIT_ACL_FAILED</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_INIT_ACL_FAILED</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01770">civetweb.h:1770</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9eaa90fd2d35bca54ead229eac4bad9b02d"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaa90fd2d35bca54ead229eac4bad9b02d">MG_ERROR_DATA_CODE_SCRIPT_ERROR</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_SCRIPT_ERROR</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01776">civetweb.h:1776</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9eab450ab40c3dc55b101012568d07d6ccc"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eab450ab40c3dc55b101012568d07d6ccc">MG_ERROR_DATA_CODE_INIT_PORTS_FAILED</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_INIT_PORTS_FAILED</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01764">civetweb.h:1764</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ead9cfc7dc6349cd93cd1530cf59a8fa21"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead9cfc7dc6349cd93cd1530cf59a8fa21">MG_ERROR_DATA_CODE_INIT_USER_FAILED</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_INIT_USER_FAILED</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01767">civetweb.h:1767</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9eae33de5d81924866d43155b8a3531135f"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae33de5d81924866d43155b8a3531135f">MG_ERROR_DATA_CODE_INVALID_PASS_FILE</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_INVALID_PASS_FILE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01773">civetweb.h:1773</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lapi_8c_html_a1281a7e2b52370cc416123bfd32b1b29"><div class="ttname"><a href="lua-5_81_85_2src_2lapi_8c.html#a1281a7e2b52370cc416123bfd32b1b29">lua_pushstring</a></div><div class="ttdeci">LUA_API void lua_pushstring(lua_State *L, const char *s)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lapi_8c_source.html#l00454">lua-5.1.5/src/lapi.c:454</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lapi_8c_html_afb2d27f421677ef40425f9054ae216a7"><div class="ttname"><a href="lua-5_81_85_2src_2lapi_8c.html#afb2d27f421677ef40425f9054ae216a7">lua_rawset</a></div><div class="ttdeci">LUA_API void lua_rawset(lua_State *L, int idx)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lapi_8c_source.html#l00671">lua-5.1.5/src/lapi.c:671</a></div></div>
<div class="ttc" id="alua-5_81_85_2src_2lua_8h_html_aa59db6b784aa1ec954599a44168c7761"><div class="ttname"><a href="lua-5_81_85_2src_2lua_8h.html#aa59db6b784aa1ec954599a44168c7761">lua_newtable</a></div><div class="ttdeci">#define lua_newtable(L)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_81_85_2src_2lua_8h_source.html#l00256">lua-5.1.5/src/lua.h:256</a></div></div>
<div class="ttc" id="astructmg__callbacks_html_ab12f9824dc1f6d257fdc2f44706fc158"><div class="ttname"><a href="structmg__callbacks.html#ab12f9824dc1f6d257fdc2f44706fc158">mg_callbacks::init_context</a></div><div class="ttdeci">void(* init_context)(const struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00367">civetweb.h:367</a></div></div>
<div class="ttc" id="astructmg__context_html_a810362fe1b277e8f8a01ca5f90c0f5e8"><div class="ttname"><a href="structmg__context.html#a810362fe1b277e8f8a01ca5f90c0f5e8">mg_context::starter_thread_idx</a></div><div class="ttdeci">unsigned long starter_thread_idx</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02380">civetweb.c:2380</a></div></div>
<div class="ttc" id="astructmg__context_html_a8bf30f14718695665927de4fa4e05104"><div class="ttname"><a href="structmg__context.html#a8bf30f14718695665927de4fa4e05104">mg_context::masterthreadid</a></div><div class="ttdeci">pthread_t masterthreadid</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02376">civetweb.c:2376</a></div></div>
<div class="ttc" id="astructmg__domain__context_html_a935ad1d56f46fde93d51014a96ded25d"><div class="ttname"><a href="structmg__domain__context.html#a935ad1d56f46fde93d51014a96ded25d">mg_domain_context::auth_nonce_mask</a></div><div class="ttdeci">uint64_t auth_nonce_mask</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02276">civetweb.c:2276</a></div></div>
<div class="ttc" id="astructmg__domain__context_html_ab15afe08729b3371cf26138782732845"><div class="ttname"><a href="structmg__domain__context.html#ab15afe08729b3371cf26138782732845">mg_domain_context::next</a></div><div class="ttdeci">struct mg_domain_context * next</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02285">civetweb.c:2285</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02276">mg_domain_context::auth_nonce_mask</a>, <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8h_source.html#l01799">mg_init_data::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02378">mg_context::cfg_worker_threads</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8h_source.html#l01801">mg_init_data::configuration_options</a>, <a class="el" href="civetweb_8c_source.html#l01927">CONNECTION_QUEUE_SIZE</a>, <a class="el" href="civetweb_8c_source.html#l02263">CONTEXT_SERVER</a>, <a class="el" href="civetweb_8c_source.html#l02354">mg_context::context_type</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8h_source.html#l00688">mg_option::default_value</a>, <a class="el" href="civetweb_8c_source.html#l01954">DOCUMENT_ROOT</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="lua-5_81_85_2src_2lundump_8c_source.html#l00036">error()</a>, <a class="el" href="civetweb_8h_source.html#l00372">mg_callbacks::exit_context</a>, <a class="el" href="civetweb_8c_source.html#l20249">free_context()</a>, <a class="el" href="civetweb_8c_source.html#l03159">get_option_index()</a>, <a class="el" href="civetweb_8c_source.html#l05909">get_random()</a>, <a class="el" href="civetweb_8c_source.html#l20389">get_system_name()</a>, <a class="el" href="civetweb_8c_source.html#l02272">mg_domain_context::handlers</a>, <a class="el" href="civetweb_8h_source.html#l00367">mg_callbacks::init_context</a>, <a class="el" href="civetweb_8c_source.html#l17485">init_ssl_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l01588">mg_workerTLS::is_master</a>, <a class="el" href="civetweb_8c_source.html#l20436">legacy_init()</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00277">lua_getglobal</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00256">lua_newtable</a>, <a class="el" href="lua-5_81_85_2src_2lua_8h_source.html#l00254">lua_pop</a>, <a class="el" href="lua-5_81_85_2src_2lapi_8c_source.html#l00454">lua_pushstring()</a>, <a class="el" href="lua-5_81_85_2src_2lapi_8c_source.html#l00671">lua_rawset()</a>, <a class="el" href="civetweb_8c_source.html#l20231">master_thread()</a>, <a class="el" href="civetweb_8c_source.html#l02376">mg_context::masterthreadid</a>, <a class="el" href="civetweb_8c_source.html#l01925">MAX_REQUEST_SIZE</a>, <a class="el" href="civetweb_8c_source.html#l02401">mg_context::max_request_size</a>, <a class="el" href="civetweb_8c_source.html#l00465">MAX_WORKER_THREADS</a>, <a class="el" href="civetweb_8c_source.html#l01121">mg_atomic_inc()</a>, <a class="el" href="civetweb_8c_source.html#l01480">mg_calloc()</a>, <a class="el" href="civetweb_8c_source.html#l01498">mg_calloc_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="civetweb_8h_source.html#l01770">MG_ERROR_DATA_CODE_INIT_ACL_FAILED</a>, <a class="el" href="civetweb_8h_source.html#l01758">MG_ERROR_DATA_CODE_INIT_LIBRARY_FAILED</a>, <a class="el" href="civetweb_8h_source.html#l01764">MG_ERROR_DATA_CODE_INIT_PORTS_FAILED</a>, <a class="el" href="civetweb_8h_source.html#l01743">MG_ERROR_DATA_CODE_INIT_TLS_FAILED</a>, <a class="el" href="civetweb_8h_source.html#l01767">MG_ERROR_DATA_CODE_INIT_USER_FAILED</a>, <a class="el" href="civetweb_8h_source.html#l01740">MG_ERROR_DATA_CODE_INVALID_OPTION</a>, <a class="el" href="civetweb_8h_source.html#l01773">MG_ERROR_DATA_CODE_INVALID_PASS_FILE</a>, <a class="el" href="civetweb_8h_source.html#l01734">MG_ERROR_DATA_CODE_OK</a>, <a class="el" href="civetweb_8h_source.html#l01761">MG_ERROR_DATA_CODE_OS_ERROR</a>, <a class="el" href="civetweb_8h_source.html#l01752">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>, <a class="el" href="civetweb_8h_source.html#l01776">MG_ERROR_DATA_CODE_SCRIPT_ERROR</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01552">mg_init_library_called</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l05726">mg_start_thread_with_id()</a>, <a class="el" href="civetweb_8c_source.html#l03062">mg_strdup_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l03019">mg_strncasecmp()</a>, <a class="el" href="civetweb_8h_source.html#l00686">mg_option::name</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="civetweb_8c_source.html#l02285">mg_domain_context::next</a>, <a class="el" href="civetweb_8c_source.html#l03899">next_option()</a>, <a class="el" href="civetweb_8c_source.html#l02427">mg_context::nonce_mutex</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01921">NUM_THREADS</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01074">pthread_mutex_attr</a>, <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>, <a class="el" href="civetweb_8c_source.html#l17662">set_acl_option()</a>, <a class="el" href="civetweb_8c_source.html#l17636">set_gpass_option()</a>, <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>, <a class="el" href="civetweb_8c_source.html#l16267">set_uid_option()</a>, <a class="el" href="civetweb_8c_source.html#l02393">mg_context::sq_blocked</a>, <a class="el" href="civetweb_8c_source.html#l02392">mg_context::sq_empty</a>, <a class="el" href="civetweb_8c_source.html#l02391">mg_context::sq_full</a>, <a class="el" href="civetweb_8c_source.html#l02394">mg_context::sq_size</a>, <a class="el" href="civetweb_8c_source.html#l02387">mg_context::squeue</a>, <a class="el" href="civetweb_8c_source.html#l02380">mg_context::starter_thread_idx</a>, <a class="el" href="civetweb_8c_source.html#l01580">sTlsKey</a>, <a class="el" href="civetweb_8c_source.html#l02411">mg_context::systemName</a>, <a class="el" href="civetweb_8c_source.html#l01589">mg_workerTLS::thread_idx</a>, <a class="el" href="civetweb_8c_source.html#l01581">thread_idx_max</a>, <a class="el" href="civetweb_8c_source.html#l02374">mg_context::thread_mutex</a>, <a class="el" href="civetweb_8c_source.html#l02433">mg_context::user_data</a>, <a class="el" href="civetweb_8h_source.html#l01800">mg_init_data::user_data</a>, <a class="el" href="lsqlite3_8c_source.html#l02155">value</a>, <a class="el" href="civetweb_8c_source.html#l02360">mg_context::worker_connections</a>, <a class="el" href="civetweb_8c_source.html#l19937">worker_thread()</a>, and <a class="el" href="civetweb_8c_source.html#l02379">mg_context::worker_threadids</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l21205">mg_start()</a>, and <a class="el" href="vendor_2civetweb_2main_8c_source.html#l01181">start_civetweb()</a>.</p>

</div>
</div>
<a id="a006e38be839d7fa4b17e199f108364c7" name="a006e38be839d7fa4b17e199f108364c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a006e38be839d7fa4b17e199f108364c7">&#9670;&#160;</a></span>mg_start_domain()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_start_domain </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **</td>          <td class="paramname"><span class="paramname"><em>options</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l21422">21422</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">21423</span>{</div>
<div class="line"><span class="lineno">21424</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a0483d8dd6ede11edee9fb9fa38e88cf6">mg_start_domain2</a>(ctx, options, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">21425</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a0483d8dd6ede11edee9fb9fa38e88cf6"><div class="ttname"><a href="#a0483d8dd6ede11edee9fb9fa38e88cf6">mg_start_domain2</a></div><div class="ttdeci">CIVETWEB_API int mg_start_domain2(struct mg_context *ctx, const char **options, struct mg_error_data *error)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l21220">civetweb.c:21220</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="vendor_2civetweb_2main_8c_source.html#l01181">start_civetweb()</a>.</p>

</div>
</div>
<a id="a0483d8dd6ede11edee9fb9fa38e88cf6" name="a0483d8dd6ede11edee9fb9fa38e88cf6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0483d8dd6ede11edee9fb9fa38e88cf6">&#9670;&#160;</a></span>mg_start_domain2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_start_domain2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **</td>          <td class="paramname"><span class="paramname"><em>options</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__error__data.html">mg_error_data</a> *</td>          <td class="paramname"><span class="paramname"><em>error</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l21220">21220</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">21223</span>{</div>
<div class="line"><span class="lineno">21224</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>;</div>
<div class="line"><span class="lineno">21225</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div>
<div class="line"><span class="lineno">21226</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *default_value;</div>
<div class="line"><span class="lineno">21227</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__domain__context.html">mg_domain_context</a> *new_dom;</div>
<div class="line"><span class="lineno">21228</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__domain__context.html">mg_domain_context</a> *dom;</div>
<div class="line"><span class="lineno">21229</span>    <span class="keywordtype">int</span> idx, i;</div>
<div class="line"><span class="lineno">21230</span> </div>
<div class="line"><span class="lineno">21231</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21232</span>        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea6f2b13fd162f7422b5ff4e6dc317e650">MG_ERROR_DATA_CODE_OK</a>;</div>
<div class="line"><span class="lineno">21233</span>        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = 0;</div>
<div class="line"><span class="lineno">21234</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size &gt; 0) {</div>
<div class="line"><span class="lineno">21235</span>            *<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text = 0;</div>
<div class="line"><span class="lineno">21236</span>        }</div>
<div class="line"><span class="lineno">21237</span>    }</div>
<div class="line"><span class="lineno">21238</span> </div>
<div class="line"><span class="lineno">21239</span>    <span class="keywordflow">if</span> ((ctx == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (options == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">21240</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21241</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eac88d510f7057b262ab4931fa17bd12d8">MG_ERROR_DATA_CODE_INVALID_PARAM</a>;</div>
<div class="line"><span class="lineno">21242</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21243</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21244</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21245</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21246</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">21247</span>                        <span class="stringliteral">&quot;Invalid parameters&quot;</span>);</div>
<div class="line"><span class="lineno">21248</span>        }</div>
<div class="line"><span class="lineno">21249</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">21250</span>    }</div>
<div class="line"><span class="lineno">21251</span> </div>
<div class="line"><span class="lineno">21252</span>    <span class="keywordflow">if</span> (!<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno">21253</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21254</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae05172a302f4cb45bf87aea55ec6cdc6">MG_ERROR_DATA_CODE_SERVER_STOPPED</a>;</div>
<div class="line"><span class="lineno">21255</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21256</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21257</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21258</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21259</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">21260</span>                        <span class="stringliteral">&quot;Server already stopped&quot;</span>);</div>
<div class="line"><span class="lineno">21261</span>        }</div>
<div class="line"><span class="lineno">21262</span>        <span class="keywordflow">return</span> -7;</div>
<div class="line"><span class="lineno">21263</span>    }</div>
<div class="line"><span class="lineno">21264</span> </div>
<div class="line"><span class="lineno">21265</span>    new_dom = (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__domain__context.html">mg_domain_context</a> *)</div>
<div class="line"><span class="lineno">21266</span>        <a class="code hl_define" href="#a29f85c2d195a7eb5893fdd101383681b">mg_calloc_ctx</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="structmg__domain__context.html">mg_domain_context</a>), ctx);</div>
<div class="line"><span class="lineno">21267</span> </div>
<div class="line"><span class="lineno">21268</span>    <span class="keywordflow">if</span> (!new_dom) {</div>
<div class="line"><span class="lineno">21269</span>        <span class="comment">/* Out of memory */</span></div>
<div class="line"><span class="lineno">21270</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21271</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead54ef9d63e339f4c05c12cb56564e319">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>;</div>
<div class="line"><span class="lineno">21272</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="structmg__domain__context.html">mg_domain_context</a>);</div>
<div class="line"><span class="lineno">21273</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21274</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21275</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21276</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21277</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">21278</span>                        <span class="stringliteral">&quot;Out or memory&quot;</span>);</div>
<div class="line"><span class="lineno">21279</span>        }</div>
<div class="line"><span class="lineno">21280</span>        <span class="keywordflow">return</span> -6;</div>
<div class="line"><span class="lineno">21281</span>    }</div>
<div class="line"><span class="lineno">21282</span> </div>
<div class="line"><span class="lineno">21283</span>    <span class="comment">/* Store options - TODO: unite duplicate code */</span></div>
<div class="line"><span class="lineno">21284</span>    <span class="keywordflow">while</span> (options &amp;&amp; (<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = *options++) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21285</span>        idx = <a class="code hl_function" href="#a4d2d84ca4d747d172e74257a176d216d">get_option_index</a>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">21286</span>        <span class="keywordflow">if</span> (idx == -1) {</div>
<div class="line"><span class="lineno">21287</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;Invalid option: %s&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">21288</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21289</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea7fc609256283dbb6d75046dc307f38cc">MG_ERROR_DATA_CODE_INVALID_OPTION</a>;</div>
<div class="line"><span class="lineno">21290</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)-1;</div>
<div class="line"><span class="lineno">21291</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21292</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21293</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21294</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21295</span>                            <span class="stringliteral">&quot;Invalid option: %s&quot;</span>,</div>
<div class="line"><span class="lineno">21296</span>                            <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">21297</span>            }</div>
<div class="line"><span class="lineno">21298</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(new_dom);</div>
<div class="line"><span class="lineno">21299</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno">21300</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> = *options++) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21301</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s: option value cannot be NULL&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">21302</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21303</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea7fc609256283dbb6d75046dc307f38cc">MG_ERROR_DATA_CODE_INVALID_OPTION</a>;</div>
<div class="line"><span class="lineno">21304</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = (unsigned)idx;</div>
<div class="line"><span class="lineno">21305</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21306</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21307</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21308</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21309</span>                            <span class="stringliteral">&quot;Invalid option value: %s&quot;</span>,</div>
<div class="line"><span class="lineno">21310</span>                            <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">21311</span>            }</div>
<div class="line"><span class="lineno">21312</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(new_dom);</div>
<div class="line"><span class="lineno">21313</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno">21314</span>        }</div>
<div class="line"><span class="lineno">21315</span>        <span class="keywordflow">if</span> (new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[idx] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21316</span>            <span class="comment">/* Duplicate option: Later values overwrite earlier ones. */</span></div>
<div class="line"><span class="lineno">21317</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;warning: %s: duplicate option&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">21318</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[idx]);</div>
<div class="line"><span class="lineno">21319</span>        }</div>
<div class="line"><span class="lineno">21320</span>        new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[idx] = <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(<a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, ctx);</div>
<div class="line"><span class="lineno">21321</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;[%s] -&gt; [%s]&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div>
<div class="line"><span class="lineno">21322</span>    }</div>
<div class="line"><span class="lineno">21323</span> </div>
<div class="line"><span class="lineno">21324</span>    <span class="comment">/* Authentication domain is mandatory */</span></div>
<div class="line"><span class="lineno">21325</span>    <span class="comment">/* TODO: Maybe use a new option hostname? */</span></div>
<div class="line"><span class="lineno">21326</span>    <span class="keywordflow">if</span> (!new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>]) {</div>
<div class="line"><span class="lineno">21327</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;authentication domain required&quot;</span>);</div>
<div class="line"><span class="lineno">21328</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21329</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea50ff3faabf936dfe44447e80289c57c3">MG_ERROR_DATA_CODE_MISSING_OPTION</a>;</div>
<div class="line"><span class="lineno">21330</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code_sub = <a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>;</div>
<div class="line"><span class="lineno">21331</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21332</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21333</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21334</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21335</span>                        <span class="stringliteral">&quot;Mandatory option %s missing&quot;</span>,</div>
<div class="line"><span class="lineno">21336</span>                        <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a>);</div>
<div class="line"><span class="lineno">21337</span>        }</div>
<div class="line"><span class="lineno">21338</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(new_dom);</div>
<div class="line"><span class="lineno">21339</span>        <span class="keywordflow">return</span> -4;</div>
<div class="line"><span class="lineno">21340</span>    }</div>
<div class="line"><span class="lineno">21341</span> </div>
<div class="line"><span class="lineno">21342</span>    <span class="comment">/* Set default value if needed. Take the config value from</span></div>
<div class="line"><span class="lineno">21343</span><span class="comment">     * ctx as a default value. */</span></div>
<div class="line"><span class="lineno">21344</span>    <span class="keywordflow">for</span> (i = 0; <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[i].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; i++) {</div>
<div class="line"><span class="lineno">21345</span>        default_value = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[i];</div>
<div class="line"><span class="lineno">21346</span>        <span class="keywordflow">if</span> ((new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[i] == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (default_value != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">21347</span>            new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[i] = <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(default_value, ctx);</div>
<div class="line"><span class="lineno">21348</span>        }</div>
<div class="line"><span class="lineno">21349</span>    }</div>
<div class="line"><span class="lineno">21350</span> </div>
<div class="line"><span class="lineno">21351</span>    new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#af15ef8d6a276c40c4caeeba414e20aff">handlers</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">21352</span>    new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ab15afe08729b3371cf26138782732845">next</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">21353</span>    new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a25db94e78d0710af1bb4d7f3b8bd6556">nonce_count</a> = 0;</div>
<div class="line"><span class="lineno">21354</span>    new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a935ad1d56f46fde93d51014a96ded25d">auth_nonce_mask</a> = <a class="code hl_function" href="#afcc8e6176b79900cc58605f1c884d0ab">get_random</a>() ^ (<a class="code hl_function" href="#afcc8e6176b79900cc58605f1c884d0ab">get_random</a>() &lt;&lt; 31);</div>
<div class="line"><span class="lineno">21355</span> </div>
<div class="line"><span class="lineno">21356</span><span class="preprocessor">#if defined(USE_LUA) &amp;&amp; defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno">21357</span>    new_dom-&gt;shared_lua_websockets = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">21358</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21359</span> </div>
<div class="line"><span class="lineno">21360</span><span class="preprocessor">#if !defined(NO_SSL) &amp;&amp; !defined(USE_MBEDTLS)</span></div>
<div class="line"><span class="lineno">21361</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#ae2d6e50236af5e059e4c3e28cc232cff">init_ssl_ctx</a>(ctx, new_dom)) {</div>
<div class="line"><span class="lineno">21362</span>        <span class="comment">/* Init SSL failed */</span></div>
<div class="line"><span class="lineno">21363</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21364</span>            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ead5f94e3f9ddc28c9d4a05f18bed659c7">MG_ERROR_DATA_CODE_INIT_TLS_FAILED</a>;</div>
<div class="line"><span class="lineno">21365</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21366</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21367</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21368</span>                        <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21369</span>                        <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">21370</span>                        <span class="stringliteral">&quot;Initializing SSL context failed&quot;</span>);</div>
<div class="line"><span class="lineno">21371</span>        }</div>
<div class="line"><span class="lineno">21372</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(new_dom);</div>
<div class="line"><span class="lineno">21373</span>        <span class="keywordflow">return</span> -3;</div>
<div class="line"><span class="lineno">21374</span>    }</div>
<div class="line"><span class="lineno">21375</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">21376</span> </div>
<div class="line"><span class="lineno">21377</span>    <span class="comment">/* Add element to linked list. */</span></div>
<div class="line"><span class="lineno">21378</span>    <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(ctx);</div>
<div class="line"><span class="lineno">21379</span> </div>
<div class="line"><span class="lineno">21380</span>    idx = 0;</div>
<div class="line"><span class="lineno">21381</span>    dom = &amp;(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>);</div>
<div class="line"><span class="lineno">21382</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno">21383</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>],</div>
<div class="line"><span class="lineno">21384</span>                           dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>])) {</div>
<div class="line"><span class="lineno">21385</span>            <span class="comment">/* Domain collision */</span></div>
<div class="line"><span class="lineno">21386</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">21387</span>                                <span class="stringliteral">&quot;domain %s already in use&quot;</span>,</div>
<div class="line"><span class="lineno">21388</span>                                new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>]);</div>
<div class="line"><span class="lineno">21389</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21390</span>                <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;code = <a class="code hl_enumvalue" href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea6f5aa810d39bc339497eba62fb401785">MG_ERROR_DATA_CODE_DUPLICATE_DOMAIN</a>;</div>
<div class="line"><span class="lineno">21391</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno">21392</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for error buffers */</span></div>
<div class="line"><span class="lineno">21393</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text,</div>
<div class="line"><span class="lineno">21394</span>                            <a class="code hl_function" href="lua-5_81_85_2src_2lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>-&gt;text_buffer_size,</div>
<div class="line"><span class="lineno">21395</span>                            <span class="stringliteral">&quot;Domain %s specified by %s is already in use&quot;</span>,</div>
<div class="line"><span class="lineno">21396</span>                            new_dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>],</div>
<div class="line"><span class="lineno">21397</span>                            <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>].<a class="code hl_variable" href="structmg__option.html#a86aed4136166ee660ad8bc71bb54e2bf">name</a>);</div>
<div class="line"><span class="lineno">21398</span>            }</div>
<div class="line"><span class="lineno">21399</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(new_dom);</div>
<div class="line"><span class="lineno">21400</span>            <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(ctx);</div>
<div class="line"><span class="lineno">21401</span>            <span class="keywordflow">return</span> -5;</div>
<div class="line"><span class="lineno">21402</span>        }</div>
<div class="line"><span class="lineno">21403</span> </div>
<div class="line"><span class="lineno">21404</span>        <span class="comment">/* Count number of domains */</span></div>
<div class="line"><span class="lineno">21405</span>        idx++;</div>
<div class="line"><span class="lineno">21406</span> </div>
<div class="line"><span class="lineno">21407</span>        <span class="keywordflow">if</span> (dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ab15afe08729b3371cf26138782732845">next</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">21408</span>            dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ab15afe08729b3371cf26138782732845">next</a> = new_dom;</div>
<div class="line"><span class="lineno">21409</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">21410</span>        }</div>
<div class="line"><span class="lineno">21411</span>        dom = dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ab15afe08729b3371cf26138782732845">next</a>;</div>
<div class="line"><span class="lineno">21412</span>    }</div>
<div class="line"><span class="lineno">21413</span> </div>
<div class="line"><span class="lineno">21414</span>    <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(ctx);</div>
<div class="line"><span class="lineno">21415</span> </div>
<div class="line"><span class="lineno">21416</span>    <span class="comment">/* Return domain number */</span></div>
<div class="line"><span class="lineno">21417</span>    <span class="keywordflow">return</span> idx;</div>
<div class="line"><span class="lineno">21418</span>}</div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea50ff3faabf936dfe44447e80289c57c3"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea50ff3faabf936dfe44447e80289c57c3">MG_ERROR_DATA_CODE_MISSING_OPTION</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_MISSING_OPTION</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01746">civetweb.h:1746</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea6f5aa810d39bc339497eba62fb401785"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea6f5aa810d39bc339497eba62fb401785">MG_ERROR_DATA_CODE_DUPLICATE_DOMAIN</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_DUPLICATE_DOMAIN</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01749">civetweb.h:1749</a></div></div>
<div class="ttc" id="acivetweb_8h_html_a05589fbab0657f08285ebdfe93f5ec9eae05172a302f4cb45bf87aea55ec6cdc6"><div class="ttname"><a href="civetweb_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae05172a302f4cb45bf87aea55ec6cdc6">MG_ERROR_DATA_CODE_SERVER_STOPPED</a></div><div class="ttdeci">@ MG_ERROR_DATA_CODE_SERVER_STOPPED</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01755">civetweb.h:1755</a></div></div>
<div class="ttc" id="astructmg__domain__context_html"><div class="ttname"><a href="structmg__domain__context.html">mg_domain_context</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02269">civetweb.c:2269</a></div></div>
<div class="ttc" id="astructmg__domain__context_html_a25db94e78d0710af1bb4d7f3b8bd6556"><div class="ttname"><a href="structmg__domain__context.html#a25db94e78d0710af1bb4d7f3b8bd6556">mg_domain_context::nonce_count</a></div><div class="ttdeci">unsigned long nonce_count</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02277">civetweb.c:2277</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02276">mg_domain_context::auth_nonce_mask</a>, <a class="el" href="civetweb_8c_source.html#l01999">AUTHENTICATION_DOMAIN</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="lua-5_81_85_2src_2lundump_8c_source.html#l00036">error()</a>, <a class="el" href="civetweb_8c_source.html#l03159">get_option_index()</a>, <a class="el" href="civetweb_8c_source.html#l05909">get_random()</a>, <a class="el" href="civetweb_8c_source.html#l02272">mg_domain_context::handlers</a>, <a class="el" href="civetweb_8c_source.html#l17485">init_ssl_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l01498">mg_calloc_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="civetweb_8h_source.html#l01749">MG_ERROR_DATA_CODE_DUPLICATE_DOMAIN</a>, <a class="el" href="civetweb_8h_source.html#l01743">MG_ERROR_DATA_CODE_INIT_TLS_FAILED</a>, <a class="el" href="civetweb_8h_source.html#l01740">MG_ERROR_DATA_CODE_INVALID_OPTION</a>, <a class="el" href="civetweb_8h_source.html#l01737">MG_ERROR_DATA_CODE_INVALID_PARAM</a>, <a class="el" href="civetweb_8h_source.html#l01746">MG_ERROR_DATA_CODE_MISSING_OPTION</a>, <a class="el" href="civetweb_8h_source.html#l01734">MG_ERROR_DATA_CODE_OK</a>, <a class="el" href="civetweb_8h_source.html#l01752">MG_ERROR_DATA_CODE_OUT_OF_MEMORY</a>, <a class="el" href="civetweb_8h_source.html#l01755">MG_ERROR_DATA_CODE_SERVER_STOPPED</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l03062">mg_strdup_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="civetweb_8h_source.html#l00686">mg_option::name</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="civetweb_8c_source.html#l02285">mg_domain_context::next</a>, <a class="el" href="civetweb_8c_source.html#l02277">mg_domain_context::nonce_count</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>, and <a class="el" href="lsqlite3_8c_source.html#l02155">value</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l21422">mg_start_domain()</a>.</p>

</div>
</div>
<a id="a32a9cdd8992fc2aa797e67089352be23" name="a32a9cdd8992fc2aa797e67089352be23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32a9cdd8992fc2aa797e67089352be23">&#9670;&#160;</a></span>mg_start_thread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_start_thread </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a11f18a1c01860c3928019a829cae3ba6">mg_thread_func_t</a></td>          <td class="paramname"><span class="paramname"><em>func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>param</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l05700">5700</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 5701</span>{</div>
<div class="line"><span class="lineno"> 5702</span>    pthread_t thread_id;</div>
<div class="line"><span class="lineno"> 5703</span>    pthread_attr_t attr;</div>
<div class="line"><span class="lineno"> 5704</span>    <span class="keywordtype">int</span> result;</div>
<div class="line"><span class="lineno"> 5705</span> </div>
<div class="line"><span class="lineno"> 5706</span>    (void)pthread_attr_init(&amp;attr);</div>
<div class="line"><span class="lineno"> 5707</span>    (void)pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_DETACHED);</div>
<div class="line"><span class="lineno"> 5708</span> </div>
<div class="line"><span class="lineno"> 5709</span><span class="preprocessor">#if defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno"> 5710</span>    pthread_attr_setstack(&amp;attr, &amp;civetweb_main_stack, ZEPHYR_STACK_SIZE);</div>
<div class="line"><span class="lineno"> 5711</span><span class="preprocessor">#elif defined(USE_STACK_SIZE) &amp;&amp; (USE_STACK_SIZE &gt; 1)</span></div>
<div class="line"><span class="lineno"> 5712</span>    <span class="comment">/* Compile-time option to control stack size,</span></div>
<div class="line"><span class="lineno"> 5713</span><span class="comment">     * e.g. -DUSE_STACK_SIZE=16384 */</span></div>
<div class="line"><span class="lineno"> 5714</span>    (void)pthread_attr_setstacksize(&amp;attr, USE_STACK_SIZE);</div>
<div class="line"><span class="lineno"> 5715</span><span class="preprocessor">#endif </span><span class="comment">/* defined(USE_STACK_SIZE) &amp;&amp; (USE_STACK_SIZE &gt; 1) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 5716</span> </div>
<div class="line"><span class="lineno"> 5717</span>    result = pthread_create(&amp;thread_id, &amp;attr, func, param);</div>
<div class="line"><span class="lineno"> 5718</span>    pthread_attr_destroy(&amp;attr);</div>
<div class="line"><span class="lineno"> 5719</span> </div>
<div class="line"><span class="lineno"> 5720</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno"> 5721</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a7da29c2b36cd27b1467771e8ac52404e" name="a7da29c2b36cd27b1467771e8ac52404e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7da29c2b36cd27b1467771e8ac52404e">&#9670;&#160;</a></span>mg_start_thread_with_id()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_start_thread_with_id </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="civetweb_8h.html#a11f18a1c01860c3928019a829cae3ba6">mg_thread_func_t</a></td>          <td class="paramname"><span class="paramname"><em>func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>param</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pthread_t *</td>          <td class="paramname"><span class="paramname"><em>threadidptr</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l05726">5726</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 5729</span>{</div>
<div class="line"><span class="lineno"> 5730</span>    pthread_t thread_id;</div>
<div class="line"><span class="lineno"> 5731</span>    pthread_attr_t attr;</div>
<div class="line"><span class="lineno"> 5732</span>    <span class="keywordtype">int</span> result;</div>
<div class="line"><span class="lineno"> 5733</span> </div>
<div class="line"><span class="lineno"> 5734</span>    (void)pthread_attr_init(&amp;attr);</div>
<div class="line"><span class="lineno"> 5735</span> </div>
<div class="line"><span class="lineno"> 5736</span><span class="preprocessor">#if defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno"> 5737</span>    pthread_attr_setstack(&amp;attr,</div>
<div class="line"><span class="lineno"> 5738</span>                          &amp;civetweb_worker_stacks[zephyr_worker_stack_index++],</div>
<div class="line"><span class="lineno"> 5739</span>                          ZEPHYR_STACK_SIZE);</div>
<div class="line"><span class="lineno"> 5740</span><span class="preprocessor">#elif defined(USE_STACK_SIZE) &amp;&amp; (USE_STACK_SIZE &gt; 1)</span></div>
<div class="line"><span class="lineno"> 5741</span>    <span class="comment">/* Compile-time option to control stack size,</span></div>
<div class="line"><span class="lineno"> 5742</span><span class="comment">     * e.g. -DUSE_STACK_SIZE=16384 */</span></div>
<div class="line"><span class="lineno"> 5743</span>    (void)pthread_attr_setstacksize(&amp;attr, USE_STACK_SIZE);</div>
<div class="line"><span class="lineno"> 5744</span><span class="preprocessor">#endif </span><span class="comment">/* defined(USE_STACK_SIZE) &amp;&amp; USE_STACK_SIZE &gt; 1 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 5745</span> </div>
<div class="line"><span class="lineno"> 5746</span>    result = pthread_create(&amp;thread_id, &amp;attr, func, param);</div>
<div class="line"><span class="lineno"> 5747</span>    pthread_attr_destroy(&amp;attr);</div>
<div class="line"><span class="lineno"> 5748</span>    <span class="keywordflow">if</span> ((result == 0) &amp;&amp; (threadidptr != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 5749</span>        *threadidptr = thread_id;</div>
<div class="line"><span class="lineno"> 5750</span>    }</div>
<div class="line"><span class="lineno"> 5751</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno"> 5752</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18997">mg_connect_websocket_client_impl()</a>, and <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="a97625a7b1941b770798e090232bdfb6f" name="a97625a7b1941b770798e090232bdfb6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97625a7b1941b770798e090232bdfb6f">&#9670;&#160;</a></span>mg_stat()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_stat </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l05650">5650</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 5653</span>{</div>
<div class="line"><span class="lineno"> 5654</span>    <span class="keyword">struct </span>stat st;</div>
<div class="line"><span class="lineno"> 5655</span>    <span class="keywordflow">if</span> (!filep) {</div>
<div class="line"><span class="lineno"> 5656</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 5657</span>    }</div>
<div class="line"><span class="lineno"> 5658</span>    memset(filep, 0, <span class="keyword">sizeof</span>(*filep));</div>
<div class="line"><span class="lineno"> 5659</span> </div>
<div class="line"><span class="lineno"> 5660</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a11ef653a52d878a00eb3d51b73c966f5">mg_path_suspicious</a>(conn, path)) {</div>
<div class="line"><span class="lineno"> 5661</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 5662</span>    }</div>
<div class="line"><span class="lineno"> 5663</span> </div>
<div class="line"><span class="lineno"> 5664</span>    <span class="keywordflow">if</span> (0 == stat(path, &amp;st)) {</div>
<div class="line"><span class="lineno"> 5665</span>        filep-&gt;<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> = (uint64_t)(st.st_size);</div>
<div class="line"><span class="lineno"> 5666</span>        filep-&gt;<a class="code hl_variable" href="structmg__file__stat.html#aa767e15073ca34ce0bd9fdcfe05e6ddc">last_modified</a> = st.st_mtime;</div>
<div class="line"><span class="lineno"> 5667</span>        filep-&gt;<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a> = S_ISDIR(st.st_mode);</div>
<div class="line"><span class="lineno"> 5668</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 5669</span>    }</div>
<div class="line"><span class="lineno"> 5670</span> </div>
<div class="line"><span class="lineno"> 5671</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 5672</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l01872">mg_file_stat::last_modified</a>, <a class="el" href="civetweb_8c_source.html#l02871">mg_path_suspicious()</a>, and <a class="el" href="civetweb_8c_source.html#l01871">mg_file_stat::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11915">dav_mkcol()</a>, <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l12293">delete_file()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>, <a class="el" href="civetweb_8c_source.html#l08472">open_auth_file()</a>, <a class="el" href="civetweb_8c_source.html#l10572">put_dir()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>, <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>, <a class="el" href="civetweb_8c_source.html#l17636">set_gpass_option()</a>, and <a class="el" href="civetweb_8c_source.html#l07574">substitute_index_file()</a>.</p>

</div>
</div>
<a id="a8e1dd67c325872836c12a8bdc4bbd103" name="a8e1dd67c325872836c12a8bdc4bbd103"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e1dd67c325872836c12a8bdc4bbd103">&#9670;&#160;</a></span>mg_static_assert() <span class="overload">[1/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mg_static_assert </td>
          <td>(</td>
          <td class="paramtype">(sizeof(<a class="el" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>)/sizeof(<a class="el" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[0]))</td>          <td class="paramname"><span class="paramname"><span class="paramdefsep"> = </span><span class="paramdefval">=(<a class="el" href="#a06fc87d81c62e9abb8790b6e5713c55baa287c83808b815cdf6a1c2756b6332f1">NUM_OPTIONS</a>+1)</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;config_options and enum not sync&quot;</td>          <td class="paramname"><span class="paramname"></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab61f16184c342680b3b020076b50270a" name="ab61f16184c342680b3b020076b50270a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab61f16184c342680b3b020076b50270a">&#9670;&#160;</a></span>mg_static_assert() <span class="overload">[2/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mg_static_assert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="#a1617828178ff1b5df926d7f469288d3e">MAX_WORKER_THREADS</a> &gt;=</td>          <td class="paramname"><span class="paramname"><em>1</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;worker threads must be <a class="el" href="classa.html">a</a> positive number&quot;</td>          <td class="paramname"><span class="paramname"></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a88a19edecab59a12f954e82f9405b080" name="a88a19edecab59a12f954e82f9405b080"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88a19edecab59a12f954e82f9405b080">&#9670;&#160;</a></span>mg_static_assert() <span class="overload">[3/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mg_static_assert </td>
          <td>(</td>
          <td class="paramtype">sizeof(int)</td>          <td class="paramname"><span class="paramname"><span class="paramdefsep"> = </span><span class="paramdefval">=4||sizeof(int)==8</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;int data type size check&quot;</td>          <td class="paramname"><span class="paramname"></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a901c5ff0ac86e7662428a76c1623c030" name="a901c5ff0ac86e7662428a76c1623c030"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a901c5ff0ac86e7662428a76c1623c030">&#9670;&#160;</a></span>mg_static_assert() <span class="overload">[4/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mg_static_assert </td>
          <td>(</td>
          <td class="paramtype">sizeof(size_t)</td>          <td class="paramname"><span class="paramname"><span class="paramdefsep"> = </span><span class="paramdefval">=4||sizeof(size_t)==8</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;size_t data type size check&quot;</td>          <td class="paramname"><span class="paramname"></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7cfeaae2f6971bd83dd50106848e0b50" name="a7cfeaae2f6971bd83dd50106848e0b50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cfeaae2f6971bd83dd50106848e0b50">&#9670;&#160;</a></span>mg_static_assert() <span class="overload">[5/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mg_static_assert </td>
          <td>(</td>
          <td class="paramtype">sizeof(void *) &gt;=sizeof(int)</td>          <td class="paramname"><span class="paramname">, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;data type size check&quot;</td>          <td class="paramname"><span class="paramname"></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="afe86da572c0da272c1707d5f19b45efe" name="afe86da572c0da272c1707d5f19b45efe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe86da572c0da272c1707d5f19b45efe">&#9670;&#160;</a></span>mg_static_assert() <span class="overload">[6/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mg_static_assert </td>
          <td>(</td>
          <td class="paramtype">sizeof(void *)</td>          <td class="paramname"><span class="paramname"><span class="paramdefsep"> = </span><span class="paramdefval">=4||sizeof(void&#160;*)==8</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;pointer data type size check&quot;</td>          <td class="paramname"><span class="paramname"></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a442a9f9023051aa5e12cc2bea06e55d1" name="a442a9f9023051aa5e12cc2bea06e55d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a442a9f9023051aa5e12cc2bea06e55d1">&#9670;&#160;</a></span>mg_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l20346">20346</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">20347</span>{</div>
<div class="line"><span class="lineno">20348</span>    pthread_t mt;</div>
<div class="line"><span class="lineno">20349</span>    <span class="keywordflow">if</span> (!ctx) {</div>
<div class="line"><span class="lineno">20350</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">20351</span>    }</div>
<div class="line"><span class="lineno">20352</span> </div>
<div class="line"><span class="lineno">20353</span>    <span class="comment">/* We don&#39;t use a lock here. Calling mg_stop with the same ctx from</span></div>
<div class="line"><span class="lineno">20354</span><span class="comment">     * two threads is not allowed. */</span></div>
<div class="line"><span class="lineno">20355</span>    mt = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8bf30f14718695665927de4fa4e05104">masterthreadid</a>;</div>
<div class="line"><span class="lineno">20356</span>    <span class="keywordflow">if</span> (mt == 0) {</div>
<div class="line"><span class="lineno">20357</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">20358</span>    }</div>
<div class="line"><span class="lineno">20359</span> </div>
<div class="line"><span class="lineno">20360</span>    ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8bf30f14718695665927de4fa4e05104">masterthreadid</a> = 0;</div>
<div class="line"><span class="lineno">20361</span> </div>
<div class="line"><span class="lineno">20362</span>    <span class="comment">/* Set stop flag, so all threads know they have to exit. */</span></div>
<div class="line"><span class="lineno">20363</span>    <a class="code hl_define" href="#a5cd88c4a6b9186f77507c50a6ae6625f">STOP_FLAG_ASSIGN</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>, 1);</div>
<div class="line"><span class="lineno">20364</span> </div>
<div class="line"><span class="lineno">20365</span>    <span class="comment">/* Join timer thread */</span></div>
<div class="line"><span class="lineno">20366</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno">20367</span>    timers_exit(ctx);</div>
<div class="line"><span class="lineno">20368</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20369</span> </div>
<div class="line"><span class="lineno">20370</span>    <span class="comment">/* Wait until everything has stopped. */</span></div>
<div class="line"><span class="lineno">20371</span>    <span class="keywordflow">while</span> (!<a class="code hl_define" href="#a888e9186b73dca8fe7e2fe2e4a37b392">STOP_FLAG_IS_TWO</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno">20372</span>        (void)<a class="code hl_define" href="#af1af7c8ef16047616b5bee88aeee10d6">mg_sleep</a>(10);</div>
<div class="line"><span class="lineno">20373</span>    }</div>
<div class="line"><span class="lineno">20374</span> </div>
<div class="line"><span class="lineno">20375</span>    <span class="comment">/* Wait to stop master thread */</span></div>
<div class="line"><span class="lineno">20376</span>    <a class="code hl_function" href="#adfdfa9abee970034383cfb3e832d2217">mg_join_thread</a>(mt);</div>
<div class="line"><span class="lineno">20377</span> </div>
<div class="line"><span class="lineno">20378</span>    <span class="comment">/* Close remaining Lua states */</span></div>
<div class="line"><span class="lineno">20379</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno">20380</span>    lua_ctx_exit(ctx);</div>
<div class="line"><span class="lineno">20381</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">20382</span> </div>
<div class="line"><span class="lineno">20383</span>    <span class="comment">/* Free memory */</span></div>
<div class="line"><span class="lineno">20384</span>    <a class="code hl_function" href="#ac591487b5ffc826f4824c8c1d9a4caaa">free_context</a>(ctx);</div>
<div class="line"><span class="lineno">20385</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a888e9186b73dca8fe7e2fe2e4a37b392"><div class="ttname"><a href="#a888e9186b73dca8fe7e2fe2e4a37b392">STOP_FLAG_IS_TWO</a></div><div class="ttdeci">#define STOP_FLAG_IS_TWO(f)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02323">civetweb.c:2323</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l20249">free_context()</a>, <a class="el" href="civetweb_8c_source.html#l02376">mg_context::masterthreadid</a>, <a class="el" href="civetweb_8c_source.html#l05757">mg_join_thread()</a>, <a class="el" href="civetweb_8c_source.html#l00920">mg_sleep</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, <a class="el" href="civetweb_8c_source.html#l02324">STOP_FLAG_ASSIGN</a>, and <a class="el" href="civetweb_8c_source.html#l02323">STOP_FLAG_IS_TWO</a>.</p>

<p class="reference">Referenced by <a class="el" href="server_8c_source.html#l00059">start_http_server()</a>, and <a class="el" href="vendor_2civetweb_2main_8c_source.html#l01409">stop_civetweb()</a>.</p>

</div>
</div>
<a id="a1973d17da3ae4db49964b93ab92c5b06" name="a1973d17da3ae4db49964b93ab92c5b06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1973d17da3ae4db49964b93ab92c5b06">&#9670;&#160;</a></span>mg_store_body()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> long long mg_store_body </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10622">10622</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10623</span>{</div>
<div class="line"><span class="lineno">10624</span>    <span class="keywordtype">char</span> buf[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno">10625</span>    <span class="keywordtype">long</span> <span class="keywordtype">long</span> len = 0;</div>
<div class="line"><span class="lineno">10626</span>    <span class="keywordtype">int</span> ret, n;</div>
<div class="line"><span class="lineno">10627</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> fi;</div>
<div class="line"><span class="lineno">10628</span> </div>
<div class="line"><span class="lineno">10629</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a> != 0) {</div>
<div class="line"><span class="lineno">10630</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;%s: Contents already consumed&quot;</span>, __func__);</div>
<div class="line"><span class="lineno">10631</span>        <span class="keywordflow">return</span> -11;</div>
<div class="line"><span class="lineno">10632</span>    }</div>
<div class="line"><span class="lineno">10633</span> </div>
<div class="line"><span class="lineno">10634</span>    ret = <a class="code hl_function" href="#a21b71badd56313936783f198fdd20c9a">put_dir</a>(conn, path);</div>
<div class="line"><span class="lineno">10635</span>    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><span class="lineno">10636</span>        <span class="comment">/* -1 for path too long,</span></div>
<div class="line"><span class="lineno">10637</span><span class="comment">         * -2 for path can not be created. */</span></div>
<div class="line"><span class="lineno">10638</span>        <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">10639</span>    }</div>
<div class="line"><span class="lineno">10640</span>    <span class="keywordflow">if</span> (ret != 1) {</div>
<div class="line"><span class="lineno">10641</span>        <span class="comment">/* Return 0 means, path itself is a directory. */</span></div>
<div class="line"><span class="lineno">10642</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">10643</span>    }</div>
<div class="line"><span class="lineno">10644</span> </div>
<div class="line"><span class="lineno">10645</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, path, <a class="code hl_define" href="#abb547e0027f87aeb69575479967c1f5f">MG_FOPEN_MODE_WRITE</a>, &amp;fi) == 0) {</div>
<div class="line"><span class="lineno">10646</span>        <span class="keywordflow">return</span> -12;</div>
<div class="line"><span class="lineno">10647</span>    }</div>
<div class="line"><span class="lineno">10648</span> </div>
<div class="line"><span class="lineno">10649</span>    ret = <a class="code hl_function" href="#afeb3b13a0524f5532d16953927743966">mg_read</a>(conn, buf, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">10650</span>    <span class="keywordflow">while</span> (ret &gt; 0) {</div>
<div class="line"><span class="lineno">10651</span>        n = (int)<a class="code hl_function" href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite</a>(buf, 1, (<span class="keywordtype">size_t</span>)ret, fi.access.fp);</div>
<div class="line"><span class="lineno">10652</span>        <span class="keywordflow">if</span> (n != ret) {</div>
<div class="line"><span class="lineno">10653</span>            (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(</div>
<div class="line"><span class="lineno">10654</span>                &amp;fi.access); <span class="comment">/* File is bad and will be removed anyway. */</span></div>
<div class="line"><span class="lineno">10655</span>            <a class="code hl_function" href="#a0e117d579dddd909e2370d437c566cf1">remove_bad_file</a>(conn, path);</div>
<div class="line"><span class="lineno">10656</span>            <span class="keywordflow">return</span> -13;</div>
<div class="line"><span class="lineno">10657</span>        }</div>
<div class="line"><span class="lineno">10658</span>        len += ret;</div>
<div class="line"><span class="lineno">10659</span>        ret = <a class="code hl_function" href="#afeb3b13a0524f5532d16953927743966">mg_read</a>(conn, buf, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">10660</span>    }</div>
<div class="line"><span class="lineno">10661</span> </div>
<div class="line"><span class="lineno">10662</span>    <span class="comment">/* File is open for writing. If fclose fails, there was probably an</span></div>
<div class="line"><span class="lineno">10663</span><span class="comment">     * error flushing the buffer to disk, so the file on disk might be</span></div>
<div class="line"><span class="lineno">10664</span><span class="comment">     * broken. Delete it and return an error to the caller. */</span></div>
<div class="line"><span class="lineno">10665</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;fi.access) != 0) {</div>
<div class="line"><span class="lineno">10666</span>        <a class="code hl_function" href="#a0e117d579dddd909e2370d437c566cf1">remove_bad_file</a>(conn, path);</div>
<div class="line"><span class="lineno">10667</span>        <span class="keywordflow">return</span> -14;</div>
<div class="line"><span class="lineno">10668</span>    }</div>
<div class="line"><span class="lineno">10669</span> </div>
<div class="line"><span class="lineno">10670</span>    <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno">10671</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a0e117d579dddd909e2370d437c566cf1"><div class="ttname"><a href="#a0e117d579dddd909e2370d437c566cf1">remove_bad_file</a></div><div class="ttdeci">static void remove_bad_file(const struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10609">civetweb.c:10609</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a21b71badd56313936783f198fdd20c9a"><div class="ttname"><a href="#a21b71badd56313936783f198fdd20c9a">put_dir</a></div><div class="ttdeci">static int put_dir(struct mg_connection *conn, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10572">civetweb.c:10572</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l02524">mg_connection::consumed_content</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, <a class="el" href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite()</a>, <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02846">MG_FOPEN_MODE_WRITE</a>, <a class="el" href="civetweb_8c_source.html#l06614">mg_read()</a>, <a class="el" href="civetweb_8c_source.html#l10572">put_dir()</a>, and <a class="el" href="civetweb_8c_source.html#l10609">remove_bad_file()</a>.</p>

</div>
</div>
<a id="a56edd9d2b1961442b88fb2e0419cdac8" name="a56edd9d2b1961442b88fb2e0419cdac8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56edd9d2b1961442b88fb2e0419cdac8">&#9670;&#160;</a></span>mg_str_append()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t mg_str_append </td>
          <td>(</td>
          <td class="paramtype">char **</td>          <td class="paramname"><span class="paramname"><em>dst</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>end</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>src</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l21493">21493</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">21494</span>{</div>
<div class="line"><span class="lineno">21495</span>    <span class="keywordtype">size_t</span> len = strlen(src);</div>
<div class="line"><span class="lineno">21496</span>    <span class="keywordflow">if</span> (*dst != end) {</div>
<div class="line"><span class="lineno">21497</span>        <span class="comment">/* Append src if enough space, or close dst. */</span></div>
<div class="line"><span class="lineno">21498</span>        <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)(end - *dst) &gt; len) {</div>
<div class="line"><span class="lineno">21499</span>            strcpy(*dst, src);</div>
<div class="line"><span class="lineno">21500</span>            *dst += len;</div>
<div class="line"><span class="lineno">21501</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">21502</span>            *dst = end;</div>
<div class="line"><span class="lineno">21503</span>        }</div>
<div class="line"><span class="lineno">21504</span>    }</div>
<div class="line"><span class="lineno">21505</span>    <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno">21506</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l21843">mg_get_context_info()</a>, and <a class="el" href="civetweb_8c_source.html#l21512">mg_get_system_info()</a>.</p>

</div>
</div>
<a id="a5d0ea93d3ec8a90e631f7e7f53d28628" name="a5d0ea93d3ec8a90e631f7e7f53d28628"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d0ea93d3ec8a90e631f7e7f53d28628">&#9670;&#160;</a></span>mg_strcasecmp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_strcasecmp </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>s1</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>s2</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03034">3034</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3035</span>{</div>
<div class="line"><span class="lineno"> 3036</span>    <span class="keywordtype">int</span> diff;</div>
<div class="line"><span class="lineno"> 3037</span> </div>
<div class="line"><span class="lineno"> 3038</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 3039</span>        diff = <a class="code hl_function" href="#a9682bb02df6aff4820e030d3c730872e">lowercase</a>(s1++) - <a class="code hl_function" href="#a9682bb02df6aff4820e030d3c730872e">lowercase</a>(s2++);</div>
<div class="line"><span class="lineno"> 3040</span>    } <span class="keywordflow">while</span> (diff == 0 &amp;&amp; s1[-1] != <span class="charliteral">&#39;\0&#39;</span>);</div>
<div class="line"><span class="lineno"> 3041</span> </div>
<div class="line"><span class="lineno"> 3042</span>    <span class="keywordflow">return</span> diff;</div>
<div class="line"><span class="lineno"> 3043</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a9682bb02df6aff4820e030d3c730872e"><div class="ttname"><a href="#a9682bb02df6aff4820e030d3c730872e">lowercase</a></div><div class="ttdeci">static int lowercase(const char *s)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03012">civetweb.c:3012</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03012">lowercase()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08427">check_password_digest()</a>, <a class="el" href="civetweb_8c_source.html#l11184">forward_body_data()</a>, <a class="el" href="civetweb_8c_source.html#l03820">get_header()</a>, <a class="el" href="civetweb_8c_source.html#l18465">get_rel_url_at_current_server()</a>, <a class="el" href="civetweb_8c_source.html#l03836">get_req_headers()</a>, <a class="el" href="civetweb_8c_source.html#l18645">get_request()</a>, <a class="el" href="civetweb_8c_source.html#l18737">get_response()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l12759">handle_propfind()</a>, <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, <a class="el" href="civetweb_8c_source.html#l19329">init_connection()</a>, <a class="el" href="civetweb_8c_source.html#l17239">init_ssl_ctx_impl()</a>, <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>, <a class="el" href="civetweb_8c_source.html#l10468">is_not_modified()</a>, <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>, <a class="el" href="civetweb_8c_source.html#l08332">mg_get_builtin_mime_type()</a>, <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>, <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, <a class="el" href="civetweb_8c_source.html#l16377">refresh_trust()</a>, <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>, <a class="el" href="civetweb_8c_source.html#l04034">should_decode_query_string()</a>, <a class="el" href="civetweb_8c_source.html#l04023">should_decode_url()</a>, <a class="el" href="civetweb_8c_source.html#l03984">should_keep_alive()</a>, <a class="el" href="civetweb_8c_source.html#l17066">ssl_servername_callback()</a>, <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>, and <a class="el" href="vendor_2civetweb_2main_8c_source.html#l01181">start_civetweb()</a>.</p>

</div>
</div>
<a id="a804c91443edc3fa4d74cfe88b1dd3ac8" name="a804c91443edc3fa4d74cfe88b1dd3ac8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a804c91443edc3fa4d74cfe88b1dd3ac8">&#9670;&#160;</a></span>mg_strcasestr()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * mg_strcasestr </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>big_str</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>small_str</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03075">3075</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3076</span>{</div>
<div class="line"><span class="lineno"> 3077</span>    <span class="keywordtype">size_t</span> i, big_len = strlen(big_str), small_len = strlen(small_str);</div>
<div class="line"><span class="lineno"> 3078</span> </div>
<div class="line"><span class="lineno"> 3079</span>    <span class="keywordflow">if</span> (big_len &gt;= small_len) {</div>
<div class="line"><span class="lineno"> 3080</span>        <span class="keywordflow">for</span> (i = 0; i &lt;= (big_len - small_len); i++) {</div>
<div class="line"><span class="lineno"> 3081</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(big_str + i, small_str, small_len) == 0) {</div>
<div class="line"><span class="lineno"> 3082</span>                <span class="keywordflow">return</span> big_str + i;</div>
<div class="line"><span class="lineno"> 3083</span>            }</div>
<div class="line"><span class="lineno"> 3084</span>        }</div>
<div class="line"><span class="lineno"> 3085</span>    }</div>
<div class="line"><span class="lineno"> 3086</span> </div>
<div class="line"><span class="lineno"> 3087</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3088</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03019">mg_strncasecmp()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l07256">mg_get_cookie()</a>, and <a class="el" href="civetweb_8c_source.html#l13912">should_switch_to_protocol()</a>.</p>

</div>
</div>
<a id="a4e6a5dc184d97ba5278dfda5b838f1cc" name="a4e6a5dc184d97ba5278dfda5b838f1cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e6a5dc184d97ba5278dfda5b838f1cc">&#9670;&#160;</a></span>mg_strdup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * mg_strdup </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>str</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03068">3068</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3069</span>{</div>
<div class="line"><span class="lineno"> 3070</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a20965905c9372c3755d872d0c740361b">mg_strndup_ctx</a>(str, strlen(str), <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 3071</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a20965905c9372c3755d872d0c740361b"><div class="ttname"><a href="#a20965905c9372c3755d872d0c740361b">mg_strndup_ctx</a></div><div class="ttdeci">static char * mg_strndup_ctx(const char *ptr, size_t len, struct mg_context *ctx)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03047">civetweb.c:3047</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03047">mg_strndup_ctx()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09911">dir_scan_callback()</a>, <a class="el" href="civetweb_8c_source.html#l20389">get_system_name()</a>, and <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="aa30b97fc6c76000802e15129b3a1f48a" name="aa30b97fc6c76000802e15129b3a1f48a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa30b97fc6c76000802e15129b3a1f48a">&#9670;&#160;</a></span>mg_strdup_ctx()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * mg_strdup_ctx </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>str</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03062">3062</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3063</span>{</div>
<div class="line"><span class="lineno"> 3064</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a20965905c9372c3755d872d0c740361b">mg_strndup_ctx</a>(str, strlen(str), ctx);</div>
<div class="line"><span class="lineno"> 3065</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03047">mg_strndup_ctx()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08861">authorize()</a>, <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, and <a class="el" href="civetweb_8c_source.html#l16620">ssl_get_client_cert_info()</a>.</p>

</div>
</div>
<a id="ad0f8debaa123ea7820fa8345125e4235" name="ad0f8debaa123ea7820fa8345125e4235"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0f8debaa123ea7820fa8345125e4235">&#9670;&#160;</a></span>mg_strlcpy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mg_strlcpy </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>dst</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>src</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>n</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03002">3002</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3003</span>{</div>
<div class="line"><span class="lineno"> 3004</span>    <span class="keywordflow">for</span> (; *src != <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; n &gt; 1; n--) {</div>
<div class="line"><span class="lineno"> 3005</span>        *dst++ = *src++;</div>
<div class="line"><span class="lineno"> 3006</span>    }</div>
<div class="line"><span class="lineno"> 3007</span>    *dst = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 3008</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l03341">gmt_time_string()</a>, <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>, <a class="el" href="civetweb_8c_source.html#l07256">mg_get_cookie()</a>, <a class="el" href="civetweb_8c_source.html#l03047">mg_strndup_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l08555">parse_auth_header()</a>, <a class="el" href="civetweb_8c_source.html#l13966">parse_match_net()</a>, <a class="el" href="civetweb_8c_source.html#l15501">parse_port_string()</a>, <a class="el" href="civetweb_8c_source.html#l09609">print_dir_entry()</a>, <a class="el" href="civetweb_8c_source.html#l03292">sockaddr_to_string()</a>, and <a class="el" href="civetweb_8c_source.html#l07574">substitute_index_file()</a>.</p>

</div>
</div>
<a id="a1e22e846cc0308d6521ed516918f380f" name="a1e22e846cc0308d6521ed516918f380f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e22e846cc0308d6521ed516918f380f">&#9670;&#160;</a></span>mg_strncasecmp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_strncasecmp </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>s1</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>s2</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03019">3019</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3020</span>{</div>
<div class="line"><span class="lineno"> 3021</span>    <span class="keywordtype">int</span> diff = 0;</div>
<div class="line"><span class="lineno"> 3022</span> </div>
<div class="line"><span class="lineno"> 3023</span>    <span class="keywordflow">if</span> (len &gt; 0) {</div>
<div class="line"><span class="lineno"> 3024</span>        <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 3025</span>            diff = <a class="code hl_function" href="#a9682bb02df6aff4820e030d3c730872e">lowercase</a>(s1++) - <a class="code hl_function" href="#a9682bb02df6aff4820e030d3c730872e">lowercase</a>(s2++);</div>
<div class="line"><span class="lineno"> 3026</span>        } <span class="keywordflow">while</span> (diff == 0 &amp;&amp; s1[-1] != <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; --len &gt; 0);</div>
<div class="line"><span class="lineno"> 3027</span>    }</div>
<div class="line"><span class="lineno"> 3028</span> </div>
<div class="line"><span class="lineno"> 3029</span>    <span class="keywordflow">return</span> diff;</div>
<div class="line"><span class="lineno"> 3030</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03012">lowercase()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08354">get_mime_type()</a>, <a class="el" href="civetweb_8c_source.html#l18465">get_rel_url_at_current_server()</a>, <a class="el" href="civetweb_8c_source.html#l18395">get_uri_type()</a>, <a class="el" href="civetweb_8c_source.html#l03956">header_has_option()</a>, <a class="el" href="civetweb_8c_source.html#l07099">mg_get_var2()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l03075">mg_strcasestr()</a>, <a class="el" href="civetweb_8c_source.html#l08555">parse_auth_header()</a>, and <a class="el" href="civetweb_8c_source.html#l14174">switch_domain_context()</a>.</p>

</div>
</div>
<a id="a20965905c9372c3755d872d0c740361b" name="a20965905c9372c3755d872d0c740361b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20965905c9372c3755d872d0c740361b">&#9670;&#160;</a></span>mg_strndup_ctx()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * mg_strndup_ctx </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>ptr</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03047">3047</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3048</span>{</div>
<div class="line"><span class="lineno"> 3049</span>    <span class="keywordtype">char</span> *p;</div>
<div class="line"><span class="lineno"> 3050</span>    (void)ctx; <span class="comment">/* Avoid Visual Studio warning if USE_SERVER_STATS is not</span></div>
<div class="line"><span class="lineno"> 3051</span><span class="comment">                * defined */</span></div>
<div class="line"><span class="lineno"> 3052</span> </div>
<div class="line"><span class="lineno"> 3053</span>    <span class="keywordflow">if</span> ((p = (<span class="keywordtype">char</span> *)<a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(len + 1, ctx)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3054</span>        <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(p, ptr, len + 1);</div>
<div class="line"><span class="lineno"> 3055</span>    }</div>
<div class="line"><span class="lineno"> 3056</span> </div>
<div class="line"><span class="lineno"> 3057</span>    <span class="keywordflow">return</span> p;</div>
<div class="line"><span class="lineno"> 3058</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01497">mg_malloc_ctx</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03068">mg_strdup()</a>, and <a class="el" href="civetweb_8c_source.html#l03062">mg_strdup_ctx()</a>.</p>

</div>
</div>
<a id="a23acf2c99018649c40b525c8bde45960" name="a23acf2c99018649c40b525c8bde45960"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23acf2c99018649c40b525c8bde45960">&#9670;&#160;</a></span>mg_unlock_connection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_unlock_connection </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l13009">13009</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">13010</span>{</div>
<div class="line"><span class="lineno">13011</span>    <span class="keywordflow">if</span> (conn) {</div>
<div class="line"><span class="lineno">13012</span>        (void)pthread_mutex_unlock(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a641ac188409fd64c07e486b265d58a03">mutex</a>);</div>
<div class="line"><span class="lineno">13013</span>    }</div>
<div class="line"><span class="lineno">13014</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02565">mg_connection::mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17864">close_connection()</a>.</p>

</div>
</div>
<a id="a40bc6a84aa4f6dc3af32fcb62e74a848" name="a40bc6a84aa4f6dc3af32fcb62e74a848"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40bc6a84aa4f6dc3af32fcb62e74a848">&#9670;&#160;</a></span>mg_unlock_context()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> void mg_unlock_context </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l13027">13027</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">13028</span>{</div>
<div class="line"><span class="lineno">13029</span>    <span class="keywordflow">if</span> (ctx &amp;&amp; (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a90a2997b56e1c373156481a79c4e5d52">context_type</a> == <a class="code hl_enumvalue" href="#a99fb83031ce9923c84392b4e92f956b5a6392e857a250daf7dd0a85461da6d099">CONTEXT_SERVER</a>)) {</div>
<div class="line"><span class="lineno">13030</span>        (void)pthread_mutex_unlock(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afc4b8c1d52b30239820683d842e975fe">nonce_mutex</a>);</div>
<div class="line"><span class="lineno">13031</span>    }</div>
<div class="line"><span class="lineno">13032</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02263">CONTEXT_SERVER</a>, <a class="el" href="civetweb_8c_source.html#l02354">mg_context::context_type</a>, and <a class="el" href="civetweb_8c_source.html#l02427">mg_context::nonce_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l12931">dav_unlock_file()</a>, <a class="el" href="civetweb_8c_source.html#l14560">get_request_handler()</a>, <a class="el" href="civetweb_8c_source.html#l14280">mg_set_handler_type()</a>, <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, <a class="el" href="civetweb_8c_source.html#l16377">refresh_trust()</a>, <a class="el" href="civetweb_8c_source.html#l14687">release_handler_ref()</a>, <a class="el" href="civetweb_8c_source.html#l08974">send_authorization_request()</a>, <a class="el" href="civetweb_8c_source.html#l17066">ssl_servername_callback()</a>, <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>, and <a class="el" href="civetweb_8c_source.html#l14174">switch_domain_context()</a>.</p>

</div>
</div>
<a id="a3bdfbeb661f200bdbe2e19e6258bb937" name="a3bdfbeb661f200bdbe2e19e6258bb937"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bdfbeb661f200bdbe2e19e6258bb937">&#9670;&#160;</a></span>mg_url_decode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_url_decode </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>src</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>src_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>dst</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>dst_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>is_form_url_encoded</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07048">7048</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7053</span>{</div>
<div class="line"><span class="lineno"> 7054</span>    <span class="keywordtype">int</span> i, j, <a class="code hl_class" href="classa.html">a</a>, b;</div>
<div class="line"><span class="lineno"> 7055</span><span class="preprocessor">#define HEXTOI(x) (isdigit(x) ? (x - &#39;0&#39;) : (x - &#39;W&#39;))</span></div>
<div class="line"><span class="lineno"> 7056</span> </div>
<div class="line"><span class="lineno"> 7057</span>    <span class="keywordflow">for</span> (i = j = 0; (i &lt; src_len) &amp;&amp; (j &lt; (dst_len - 1)); i++, j++) {</div>
<div class="line"><span class="lineno"> 7058</span>        <span class="keywordflow">if</span> ((i &lt; src_len - 2) &amp;&amp; (src[i] == <span class="charliteral">&#39;%&#39;</span>)</div>
<div class="line"><span class="lineno"> 7059</span>            &amp;&amp; isxdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)src[i + 1])</div>
<div class="line"><span class="lineno"> 7060</span>            &amp;&amp; isxdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)src[i + 2])) {</div>
<div class="line"><span class="lineno"> 7061</span>            <a class="code hl_class" href="classa.html">a</a> = tolower((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)src[i + 1]);</div>
<div class="line"><span class="lineno"> 7062</span>            b = tolower((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)src[i + 2]);</div>
<div class="line"><span class="lineno"> 7063</span>            dst[j] = (char)((<a class="code hl_define" href="#a09ca1005ef34aa3b14445f325c532873">HEXTOI</a>(<a class="code hl_class" href="classa.html">a</a>) &lt;&lt; 4) | <a class="code hl_define" href="#a09ca1005ef34aa3b14445f325c532873">HEXTOI</a>(b));</div>
<div class="line"><span class="lineno"> 7064</span>            i += 2;</div>
<div class="line"><span class="lineno"> 7065</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_form_url_encoded &amp;&amp; (src[i] == <span class="charliteral">&#39;+&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 7066</span>            dst[j] = <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><span class="lineno"> 7067</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 7068</span>            dst[j] = src[i];</div>
<div class="line"><span class="lineno"> 7069</span>        }</div>
<div class="line"><span class="lineno"> 7070</span>    }</div>
<div class="line"><span class="lineno"> 7071</span> </div>
<div class="line"><span class="lineno"> 7072</span>    dst[j] = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">/* Null-terminate the destination */</span></div>
<div class="line"><span class="lineno"> 7073</span> </div>
<div class="line"><span class="lineno"> 7074</span>    <span class="keywordflow">return</span> (i &gt;= src_len) ? j : -1;</div>
<div class="line"><span class="lineno"> 7075</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a09ca1005ef34aa3b14445f325c532873"><div class="ttname"><a href="#a09ca1005ef34aa3b14445f325c532873">HEXTOI</a></div><div class="ttdeci">#define HEXTOI(x)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#a09ca1005ef34aa3b14445f325c532873">HEXTOI</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, <a class="el" href="civetweb_8c_source.html#l07099">mg_get_var2()</a>, and <a class="el" href="civetweb_8c_source.html#l07080">url_decode_in_place()</a>.</p>

</div>
</div>
<a id="afec55bb47160c2d4fe76c5df4ce54f56" name="afec55bb47160c2d4fe76c5df4ce54f56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afec55bb47160c2d4fe76c5df4ce54f56">&#9670;&#160;</a></span>mg_url_encode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_url_encode </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>src</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>dst</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>dst_len</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09581">9581</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9582</span>{</div>
<div class="line"><span class="lineno"> 9583</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *dont_escape = <span class="stringliteral">&quot;._-$,;~()&quot;</span>;</div>
<div class="line"><span class="lineno"> 9584</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *hex = <span class="stringliteral">&quot;0123456789abcdef&quot;</span>;</div>
<div class="line"><span class="lineno"> 9585</span>    <span class="keywordtype">char</span> *pos = dst;</div>
<div class="line"><span class="lineno"> 9586</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *end = dst + dst_len - 1;</div>
<div class="line"><span class="lineno"> 9587</span> </div>
<div class="line"><span class="lineno"> 9588</span>    <span class="keywordflow">for</span> (; ((*src != <span class="charliteral">&#39;\0&#39;</span>) &amp;&amp; (pos &lt; end)); src++, pos++) {</div>
<div class="line"><span class="lineno"> 9589</span>        <span class="keywordflow">if</span> (isalnum((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*src)</div>
<div class="line"><span class="lineno"> 9590</span>            || (strchr(dont_escape, *src) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 9591</span>            *pos = *src;</div>
<div class="line"><span class="lineno"> 9592</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pos + 2 &lt; end) {</div>
<div class="line"><span class="lineno"> 9593</span>            pos[0] = <span class="charliteral">&#39;%&#39;</span>;</div>
<div class="line"><span class="lineno"> 9594</span>            pos[1] = hex[(<span class="keywordtype">unsigned</span> char)*src &gt;&gt; 4];</div>
<div class="line"><span class="lineno"> 9595</span>            pos[2] = hex[(<span class="keywordtype">unsigned</span> char)*src &amp; 0xf];</div>
<div class="line"><span class="lineno"> 9596</span>            pos += 2;</div>
<div class="line"><span class="lineno"> 9597</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 9598</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 9599</span>        }</div>
<div class="line"><span class="lineno"> 9600</span>    }</div>
<div class="line"><span class="lineno"> 9601</span> </div>
<div class="line"><span class="lineno"> 9602</span>    *pos = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 9603</span>    <span class="keywordflow">return</span> (*src == <span class="charliteral">&#39;\0&#39;</span>) ? (int)(pos - dst) : -1;</div>
<div class="line"><span class="lineno"> 9604</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>, and <a class="el" href="civetweb_8c_source.html#l09609">print_dir_entry()</a>.</p>

</div>
</div>
<a id="a057ebd236dc84e6e8f6c9765da609329" name="a057ebd236dc84e6e8f6c9765da609329"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a057ebd236dc84e6e8f6c9765da609329">&#9670;&#160;</a></span>mg_version()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> const char * mg_version </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03514">3514</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3515</span>{</div>
<div class="line"><span class="lineno"> 3516</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="civetweb_8h.html#a2a38653ae23013ece7ae6a38db041f94">CIVETWEB_VERSION</a>;</div>
<div class="line"><span class="lineno"> 3517</span>}</div>
<div class="ttc" id="acivetweb_8h_html_a2a38653ae23013ece7ae6a38db041f94"><div class="ttname"><a href="civetweb_8h.html#a2a38653ae23013ece7ae6a38db041f94">CIVETWEB_VERSION</a></div><div class="ttdeci">#define CIVETWEB_VERSION</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00026">civetweb.h:26</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00026">CIVETWEB_VERSION</a>.</p>

<p class="reference">Referenced by <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00838">init_server_name()</a>, <a class="el" href="civetweb_8c_source.html#l21512">mg_get_system_info()</a>, <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>, and <a class="el" href="vendor_2civetweb_2main_8c_source.html#l00303">show_server_name()</a>.</p>

</div>
</div>
<a id="ab1c003c5b952dd24c95b887def277814" name="ab1c003c5b952dd24c95b887def277814"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1c003c5b952dd24c95b887def277814">&#9670;&#160;</a></span>mg_vprintf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mg_vprintf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list</td>          <td class="paramname"><span class="paramname"><em>ap</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07016">7016</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7017</span>{</div>
<div class="line"><span class="lineno"> 7018</span>    <span class="keywordtype">char</span> mem[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno"> 7019</span>    <span class="keywordtype">char</span> *buf = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 7020</span>    <span class="keywordtype">int</span> len;</div>
<div class="line"><span class="lineno"> 7021</span> </div>
<div class="line"><span class="lineno"> 7022</span>    <span class="keywordflow">if</span> ((len = <a class="code hl_function" href="#a8cfa7a42c911923d382305f16bd57314">alloc_vprintf</a>(&amp;buf, mem, <span class="keyword">sizeof</span>(mem), fmt, ap)) &gt; 0) {</div>
<div class="line"><span class="lineno"> 7023</span>        len = <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, buf, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="lineno"> 7024</span>    }</div>
<div class="line"><span class="lineno"> 7025</span>    <span class="keywordflow">if</span> (buf != mem) {</div>
<div class="line"><span class="lineno"> 7026</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(buf);</div>
<div class="line"><span class="lineno"> 7027</span>    }</div>
<div class="line"><span class="lineno"> 7028</span> </div>
<div class="line"><span class="lineno"> 7029</span>    <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno"> 7030</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l06939">alloc_vprintf()</a>, <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l06779">mg_write()</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18874">mg_download()</a>, and <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>.</p>

</div>
</div>
<a id="aca9e6d65ed7802c47e4e3ef6413d8c39" name="aca9e6d65ed7802c47e4e3ef6413d8c39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca9e6d65ed7802c47e4e3ef6413d8c39">&#9670;&#160;</a></span>mg_vsnprintf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mg_vsnprintf </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>truncated</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>buflen</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fmt</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list</td>          <td class="paramname"><span class="paramname"><em>ap</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03094">3094</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3100</span>{</div>
<div class="line"><span class="lineno"> 3101</span>    <span class="keywordtype">int</span> n, ok;</div>
<div class="line"><span class="lineno"> 3102</span> </div>
<div class="line"><span class="lineno"> 3103</span>    <span class="keywordflow">if</span> (buflen == 0) {</div>
<div class="line"><span class="lineno"> 3104</span>        <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno"> 3105</span>            *truncated = 1;</div>
<div class="line"><span class="lineno"> 3106</span>        }</div>
<div class="line"><span class="lineno"> 3107</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 3108</span>    }</div>
<div class="line"><span class="lineno"> 3109</span> </div>
<div class="line"><span class="lineno"> 3110</span><span class="preprocessor">#if defined(__clang__)</span></div>
<div class="line"><span class="lineno"> 3111</span><span class="preprocessor">#pragma clang diagnostic push</span></div>
<div class="line"><span class="lineno"> 3112</span><span class="preprocessor">#pragma clang diagnostic ignored &quot;-Wformat-nonliteral&quot;</span></div>
<div class="line"><span class="lineno"> 3113</span>    <span class="comment">/* Using fmt as a non-literal is intended here, since it is mostly called</span></div>
<div class="line"><span class="lineno"> 3114</span><span class="comment">     * indirectly by mg_snprintf */</span></div>
<div class="line"><span class="lineno"> 3115</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3116</span> </div>
<div class="line"><span class="lineno"> 3117</span>    n = (int)<a class="code hl_define" href="#a095b3b42df21f6e5d4377e299da56a79">vsnprintf_impl</a>(buf, buflen, fmt, ap);</div>
<div class="line"><span class="lineno"> 3118</span>    ok = (n &gt;= 0) &amp;&amp; ((<span class="keywordtype">size_t</span>)n &lt; buflen);</div>
<div class="line"><span class="lineno"> 3119</span> </div>
<div class="line"><span class="lineno"> 3120</span><span class="preprocessor">#if defined(__clang__)</span></div>
<div class="line"><span class="lineno"> 3121</span><span class="preprocessor">#pragma clang diagnostic pop</span></div>
<div class="line"><span class="lineno"> 3122</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3123</span> </div>
<div class="line"><span class="lineno"> 3124</span>    <span class="keywordflow">if</span> (ok) {</div>
<div class="line"><span class="lineno"> 3125</span>        <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno"> 3126</span>            *truncated = 0;</div>
<div class="line"><span class="lineno"> 3127</span>        }</div>
<div class="line"><span class="lineno"> 3128</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3129</span>        <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno"> 3130</span>            *truncated = 1;</div>
<div class="line"><span class="lineno"> 3131</span>        }</div>
<div class="line"><span class="lineno"> 3132</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno"> 3133</span>                        <span class="stringliteral">&quot;truncating vsnprintf buffer: [%.*s]&quot;</span>,</div>
<div class="line"><span class="lineno"> 3134</span>                        (<span class="keywordtype">int</span>)((buflen &gt; 200) ? 200 : (buflen - 1)),</div>
<div class="line"><span class="lineno"> 3135</span>                        buf);</div>
<div class="line"><span class="lineno"> 3136</span>        n = (int)buflen - 1;</div>
<div class="line"><span class="lineno"> 3137</span>    }</div>
<div class="line"><span class="lineno"> 3138</span>    buf[n] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 3139</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, and <a class="el" href="civetweb_8c_source.html#l00897">vsnprintf_impl</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11284">addenv()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, and <a class="el" href="civetweb_8c_source.html#l03143">mg_snprintf()</a>.</p>

</div>
</div>
<a id="a6e7dd65d54025f881bb4d95986fc2581" name="a6e7dd65d54025f881bb4d95986fc2581"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e7dd65d54025f881bb4d95986fc2581">&#9670;&#160;</a></span>mg_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="civetweb_8h.html#a5dbf083d19889dba3fef7503ce764ef6">CIVETWEB_API</a> int mg_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06779">6779</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6780</span>{</div>
<div class="line"><span class="lineno"> 6781</span>    time_t now;</div>
<div class="line"><span class="lineno"> 6782</span>    <span class="keywordtype">int</span> n, total, allowed;</div>
<div class="line"><span class="lineno"> 6783</span> </div>
<div class="line"><span class="lineno"> 6784</span>    <span class="keywordflow">if</span> (conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6785</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 6786</span>    }</div>
<div class="line"><span class="lineno"> 6787</span>    <span class="keywordflow">if</span> (len &gt; INT_MAX) {</div>
<div class="line"><span class="lineno"> 6788</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6789</span>    }</div>
<div class="line"><span class="lineno"> 6790</span> </div>
<div class="line"><span class="lineno"> 6791</span>    <span class="comment">/* Mark connection as &quot;data sent&quot; */</span></div>
<div class="line"><span class="lineno"> 6792</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a161c1c775b5f3933f8428d4eb1381f52">request_state</a> = 10;</div>
<div class="line"><span class="lineno"> 6793</span><span class="preprocessor">#if defined(USE_HTTP2)</span></div>
<div class="line"><span class="lineno"> 6794</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca3c3663fdf461dc9873cadc4a36b3a139">PROTOCOL_TYPE_HTTP2</a>) {</div>
<div class="line"><span class="lineno"> 6795</span>        http2_data_frame_head(conn, len, 0);</div>
<div class="line"><span class="lineno"> 6796</span>    }</div>
<div class="line"><span class="lineno"> 6797</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 6798</span> </div>
<div class="line"><span class="lineno"> 6799</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a1253d8e7156cefe37debd0c1aa2b3769">throttle</a> &gt; 0) {</div>
<div class="line"><span class="lineno"> 6800</span>        <span class="keywordflow">if</span> ((now = time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) != conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a0514c4ba89ab66306fa4c44186593437">last_throttle_time</a>) {</div>
<div class="line"><span class="lineno"> 6801</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a0514c4ba89ab66306fa4c44186593437">last_throttle_time</a> = now;</div>
<div class="line"><span class="lineno"> 6802</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aea8bb02b7736ff40766a98dc98ee9414">last_throttle_bytes</a> = 0;</div>
<div class="line"><span class="lineno"> 6803</span>        }</div>
<div class="line"><span class="lineno"> 6804</span>        allowed = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a1253d8e7156cefe37debd0c1aa2b3769">throttle</a> - conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aea8bb02b7736ff40766a98dc98ee9414">last_throttle_bytes</a>;</div>
<div class="line"><span class="lineno"> 6805</span>        <span class="keywordflow">if</span> (allowed &gt; (<span class="keywordtype">int</span>)len) {</div>
<div class="line"><span class="lineno"> 6806</span>            allowed = (int)len;</div>
<div class="line"><span class="lineno"> 6807</span>        }</div>
<div class="line"><span class="lineno"> 6808</span> </div>
<div class="line"><span class="lineno"> 6809</span>        total = <a class="code hl_function" href="#ab855e2c5d4e7913fb2138a9909c8caca">push_all</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>,</div>
<div class="line"><span class="lineno"> 6810</span>                         <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 6811</span>                         conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>,</div>
<div class="line"><span class="lineno"> 6812</span>                         conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>,</div>
<div class="line"><span class="lineno"> 6813</span>                         (<span class="keyword">const</span> <span class="keywordtype">char</span> *)buf,</div>
<div class="line"><span class="lineno"> 6814</span>                         allowed);</div>
<div class="line"><span class="lineno"> 6815</span> </div>
<div class="line"><span class="lineno"> 6816</span>        <span class="keywordflow">if</span> (total == allowed) {</div>
<div class="line"><span class="lineno"> 6817</span> </div>
<div class="line"><span class="lineno"> 6818</span>            buf = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)buf + total;</div>
<div class="line"><span class="lineno"> 6819</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aea8bb02b7736ff40766a98dc98ee9414">last_throttle_bytes</a> += total;</div>
<div class="line"><span class="lineno"> 6820</span>            <span class="keywordflow">while</span> ((total &lt; (<span class="keywordtype">int</span>)len)</div>
<div class="line"><span class="lineno"> 6821</span>                   &amp;&amp; <a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno"> 6822</span>                allowed = (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a1253d8e7156cefe37debd0c1aa2b3769">throttle</a> &gt; ((int)len - total))</div>
<div class="line"><span class="lineno"> 6823</span>                              ? (<span class="keywordtype">int</span>)len - total</div>
<div class="line"><span class="lineno"> 6824</span>                              : conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a1253d8e7156cefe37debd0c1aa2b3769">throttle</a>;</div>
<div class="line"><span class="lineno"> 6825</span> </div>
<div class="line"><span class="lineno"> 6826</span>                n = <a class="code hl_function" href="#ab855e2c5d4e7913fb2138a9909c8caca">push_all</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>,</div>
<div class="line"><span class="lineno"> 6827</span>                             <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 6828</span>                             conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>,</div>
<div class="line"><span class="lineno"> 6829</span>                             conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>,</div>
<div class="line"><span class="lineno"> 6830</span>                             (<span class="keyword">const</span> <span class="keywordtype">char</span> *)buf,</div>
<div class="line"><span class="lineno"> 6831</span>                             allowed);</div>
<div class="line"><span class="lineno"> 6832</span> </div>
<div class="line"><span class="lineno"> 6833</span>                <span class="keywordflow">if</span> (n != allowed) {</div>
<div class="line"><span class="lineno"> 6834</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 6835</span>                }</div>
<div class="line"><span class="lineno"> 6836</span>                sleep(1);</div>
<div class="line"><span class="lineno"> 6837</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aea8bb02b7736ff40766a98dc98ee9414">last_throttle_bytes</a> = allowed;</div>
<div class="line"><span class="lineno"> 6838</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a0514c4ba89ab66306fa4c44186593437">last_throttle_time</a> = time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 6839</span>                buf = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)buf + n;</div>
<div class="line"><span class="lineno"> 6840</span>                total += n;</div>
<div class="line"><span class="lineno"> 6841</span>            }</div>
<div class="line"><span class="lineno"> 6842</span>        }</div>
<div class="line"><span class="lineno"> 6843</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6844</span>        total = <a class="code hl_function" href="#ab855e2c5d4e7913fb2138a9909c8caca">push_all</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>,</div>
<div class="line"><span class="lineno"> 6845</span>                         <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 6846</span>                         conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>,</div>
<div class="line"><span class="lineno"> 6847</span>                         conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>,</div>
<div class="line"><span class="lineno"> 6848</span>                         (<span class="keyword">const</span> <span class="keywordtype">char</span> *)buf,</div>
<div class="line"><span class="lineno"> 6849</span>                         (<span class="keywordtype">int</span>)len);</div>
<div class="line"><span class="lineno"> 6850</span>    }</div>
<div class="line"><span class="lineno"> 6851</span>    <span class="keywordflow">if</span> (total &gt; 0) {</div>
<div class="line"><span class="lineno"> 6852</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a482f3e0e76b5e4b885c971ab232f7653">num_bytes_sent</a> += total;</div>
<div class="line"><span class="lineno"> 6853</span>    }</div>
<div class="line"><span class="lineno"> 6854</span>    <span class="keywordflow">return</span> total;</div>
<div class="line"><span class="lineno"> 6855</span>}</div>
<div class="ttc" id="astructmg__connection_html_a0514c4ba89ab66306fa4c44186593437"><div class="ttname"><a href="structmg__connection.html#a0514c4ba89ab66306fa4c44186593437">mg_connection::last_throttle_time</a></div><div class="ttdeci">time_t last_throttle_time</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02563">civetweb.c:2563</a></div></div>
<div class="ttc" id="astructmg__connection_html_aea8bb02b7736ff40766a98dc98ee9414"><div class="ttname"><a href="structmg__connection.html#aea8bb02b7736ff40766a98dc98ee9414">mg_connection::last_throttle_bytes</a></div><div class="ttdeci">int last_throttle_bytes</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02564">civetweb.c:2564</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l02564">mg_connection::last_throttle_bytes</a>, <a class="el" href="civetweb_8c_source.html#l02563">mg_connection::last_throttle_time</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02517">mg_connection::num_bytes_sent</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, <a class="el" href="civetweb_8c_source.html#l02468">PROTOCOL_TYPE_HTTP2</a>, <a class="el" href="civetweb_8c_source.html#l06162">push_all()</a>, <a class="el" href="civetweb_8c_source.html#l02488">mg_connection::request_state</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, <a class="el" href="civetweb_8c_source.html#l02506">mg_connection::ssl</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>, and <a class="el" href="civetweb_8c_source.html#l02560">mg_connection::throttle</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l06860">mg_send_chunk()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l04618">mg_send_http_redirect()</a>, <a class="el" href="civetweb_8c_source.html#l07016">mg_vprintf()</a>, <a class="el" href="civetweb_8c_source.html#l10055">send_file_data()</a>, and <a class="el" href="civetweb_8c_source.html#l12482">send_ssi_file()</a>.</p>

</div>
</div>
<a id="a38c5f9290df5fe9727338a93493108f5" name="a38c5f9290df5fe9727338a93493108f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38c5f9290df5fe9727338a93493108f5">&#9670;&#160;</a></span>must_hide_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int must_hide_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09763">9763</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9764</span>{</div>
<div class="line"><span class="lineno"> 9765</span>    <span class="keywordflow">if</span> (conn &amp;&amp; conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno"> 9766</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *pw_pattern = <span class="stringliteral">&quot;**&quot;</span> <a class="code hl_define" href="#af3e3c69dd6791a2c441b5352743750a6">PASSWORDS_FILE_NAME</a> <span class="stringliteral">&quot;$&quot;</span>;</div>
<div class="line"><span class="lineno"> 9767</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *pattern = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba661e684fd980c2be1848413e1ec8fe35">HIDE_FILES</a>];</div>
<div class="line"><span class="lineno"> 9768</span>        <span class="keywordflow">return</span> (match_prefix_strlen(pw_pattern, path) &gt; 0)</div>
<div class="line"><span class="lineno"> 9769</span>               || (match_prefix_strlen(pattern, path) &gt; 0);</div>
<div class="line"><span class="lineno"> 9770</span>    }</div>
<div class="line"><span class="lineno"> 9771</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9772</span>}</div>
<div class="ttc" id="acivetweb_8c_html_af3e3c69dd6791a2c441b5352743750a6"><div class="ttname"><a href="#af3e3c69dd6791a2c441b5352743750a6">PASSWORDS_FILE_NAME</a></div><div class="ttdeci">#define PASSWORDS_FILE_NAME</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00482">civetweb.c:482</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02011">HIDE_FILES</a>, and <a class="el" href="civetweb_8c_source.html#l00482">PASSWORDS_FILE_NAME</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l09777">scan_directory()</a>.</p>

</div>
</div>
<a id="a8a9f9af183eb62789209809d41dabbf4" name="a8a9f9af183eb62789209809d41dabbf4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a9f9af183eb62789209809d41dabbf4">&#9670;&#160;</a></span>next_option()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * next_option </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>list</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structvec.html">vec</a> *</td>          <td class="paramname"><span class="paramname"><em>val</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structvec.html">vec</a> *</td>          <td class="paramname"><span class="paramname"><em>eq_val</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03899">3899</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3900</span>{</div>
<div class="line"><span class="lineno"> 3901</span>    <span class="keywordtype">int</span> end;</div>
<div class="line"><span class="lineno"> 3902</span> </div>
<div class="line"><span class="lineno"> 3903</span>reparse:</div>
<div class="line"><span class="lineno"> 3904</span>    <span class="keywordflow">if</span> (val == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || list == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || *list == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno"> 3905</span>        <span class="comment">/* End of the list */</span></div>
<div class="line"><span class="lineno"> 3906</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 3907</span>    }</div>
<div class="line"><span class="lineno"> 3908</span> </div>
<div class="line"><span class="lineno"> 3909</span>    <span class="comment">/* Skip over leading LWS */</span></div>
<div class="line"><span class="lineno"> 3910</span>    <span class="keywordflow">while</span> (*list == <span class="charliteral">&#39; &#39;</span> || *list == <span class="charliteral">&#39;\t&#39;</span>)</div>
<div class="line"><span class="lineno"> 3911</span>        list++;</div>
<div class="line"><span class="lineno"> 3912</span> </div>
<div class="line"><span class="lineno"> 3913</span>    val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> = list;</div>
<div class="line"><span class="lineno"> 3914</span>    <span class="keywordflow">if</span> ((list = strchr(val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <span class="charliteral">&#39;,&#39;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3915</span>        <span class="comment">/* Comma found. Store length and shift the list ptr */</span></div>
<div class="line"><span class="lineno"> 3916</span>        val-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = ((size_t)(list - val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>));</div>
<div class="line"><span class="lineno"> 3917</span>        list++;</div>
<div class="line"><span class="lineno"> 3918</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3919</span>        <span class="comment">/* This value is the last one */</span></div>
<div class="line"><span class="lineno"> 3920</span>        list = val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> + strlen(val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>);</div>
<div class="line"><span class="lineno"> 3921</span>        val-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = ((size_t)(list - val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>));</div>
<div class="line"><span class="lineno"> 3922</span>    }</div>
<div class="line"><span class="lineno"> 3923</span> </div>
<div class="line"><span class="lineno"> 3924</span>    <span class="comment">/* Adjust length for trailing LWS */</span></div>
<div class="line"><span class="lineno"> 3925</span>    end = (int)val-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> - 1;</div>
<div class="line"><span class="lineno"> 3926</span>    <span class="keywordflow">while</span> (end &gt;= 0 &amp;&amp; ((val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>[end] == <span class="charliteral">&#39; &#39;</span>) || (val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>[end] == <span class="charliteral">&#39;\t&#39;</span>)))</div>
<div class="line"><span class="lineno"> 3927</span>        end--;</div>
<div class="line"><span class="lineno"> 3928</span>    val-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = (size_t)(end) + (size_t)(1);</div>
<div class="line"><span class="lineno"> 3929</span> </div>
<div class="line"><span class="lineno"> 3930</span>    <span class="keywordflow">if</span> (val-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> == 0) {</div>
<div class="line"><span class="lineno"> 3931</span>        <span class="comment">/* Ignore any empty entries. */</span></div>
<div class="line"><span class="lineno"> 3932</span>        <span class="keywordflow">goto</span> reparse;</div>
<div class="line"><span class="lineno"> 3933</span>    }</div>
<div class="line"><span class="lineno"> 3934</span> </div>
<div class="line"><span class="lineno"> 3935</span>    <span class="keywordflow">if</span> (eq_val != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3936</span>        <span class="comment">/* Value has form &quot;x=y&quot;, adjust pointers and lengths</span></div>
<div class="line"><span class="lineno"> 3937</span><span class="comment">         * so that val points to &quot;x&quot;, and eq_val points to &quot;y&quot;. */</span></div>
<div class="line"><span class="lineno"> 3938</span>        eq_val-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = 0;</div>
<div class="line"><span class="lineno"> 3939</span>        eq_val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)memchr(val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <span class="charliteral">&#39;=&#39;</span>, val-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>);</div>
<div class="line"><span class="lineno"> 3940</span>        <span class="keywordflow">if</span> (eq_val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 3941</span>            eq_val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>++; <span class="comment">/* Skip over &#39;=&#39; character */</span></div>
<div class="line"><span class="lineno"> 3942</span>            eq_val-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = ((size_t)(val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> - eq_val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>)) + val-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>;</div>
<div class="line"><span class="lineno"> 3943</span>            val-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> = ((size_t)(eq_val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> - val-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>)) - 1;</div>
<div class="line"><span class="lineno"> 3944</span>        }</div>
<div class="line"><span class="lineno"> 3945</span>    }</div>
<div class="line"><span class="lineno"> 3946</span> </div>
<div class="line"><span class="lineno"> 3947</span>    <span class="keywordflow">return</span> list;</div>
<div class="line"><span class="lineno"> 3948</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16229">check_acl()</a>, <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>, <a class="el" href="civetweb_8c_source.html#l08354">get_mime_type()</a>, <a class="el" href="civetweb_8c_source.html#l03956">header_has_option()</a>, <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>, <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>, <a class="el" href="civetweb_8c_source.html#l14075">set_throttle()</a>, and <a class="el" href="civetweb_8c_source.html#l07574">substitute_index_file()</a>.</p>

</div>
</div>
<a id="a054c8cdcbf4ebf1a0ef52792a1868351" name="a054c8cdcbf4ebf1a0ef52792a1868351"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a054c8cdcbf4ebf1a0ef52792a1868351">&#9670;&#160;</a></span>open_auth_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void open_auth_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08472">8472</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8475</span>{</div>
<div class="line"><span class="lineno"> 8476</span>    <span class="keywordflow">if</span> ((conn != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno"> 8477</span>        <span class="keywordtype">char</span> <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>];</div>
<div class="line"><span class="lineno"> 8478</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *e,</div>
<div class="line"><span class="lineno"> 8479</span>            *gpass = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba0d86924aee1330b50c85079ae6ff8032">GLOBAL_PASSWORDS_FILE</a>];</div>
<div class="line"><span class="lineno"> 8480</span>        <span class="keywordtype">int</span> truncated;</div>
<div class="line"><span class="lineno"> 8481</span> </div>
<div class="line"><span class="lineno"> 8482</span>        <span class="keywordflow">if</span> (gpass != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8483</span>            <span class="comment">/* Use global passwords file */</span></div>
<div class="line"><span class="lineno"> 8484</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, gpass, <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>, filep)) {</div>
<div class="line"><span class="lineno"> 8485</span><span class="preprocessor">#if defined(DEBUG)</span></div>
<div class="line"><span class="lineno"> 8486</span>                <span class="comment">/* Use mg_cry_internal here, since gpass has been</span></div>
<div class="line"><span class="lineno"> 8487</span><span class="comment">                 * configured. */</span></div>
<div class="line"><span class="lineno"> 8488</span>                <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;fopen(%s): %s&quot;</span>, gpass, strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 8489</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 8490</span>            }</div>
<div class="line"><span class="lineno"> 8491</span>            <span class="comment">/* Important: using local struct mg_file to test path for</span></div>
<div class="line"><span class="lineno"> 8492</span><span class="comment">             * is_directory flag. If filep is used, mg_stat() makes it</span></div>
<div class="line"><span class="lineno"> 8493</span><span class="comment">             * appear as if auth file was opened.</span></div>
<div class="line"><span class="lineno"> 8494</span><span class="comment">             * TODO(mid): Check if this is still required after rewriting</span></div>
<div class="line"><span class="lineno"> 8495</span><span class="comment">             * mg_stat */</span></div>
<div class="line"><span class="lineno"> 8496</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path, &amp;filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>)</div>
<div class="line"><span class="lineno"> 8497</span>                   &amp;&amp; filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a>) {</div>
<div class="line"><span class="lineno"> 8498</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 8499</span>                        &amp;truncated,</div>
<div class="line"><span class="lineno"> 8500</span>                        <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,</div>
<div class="line"><span class="lineno"> 8501</span>                        <span class="keyword">sizeof</span>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>),</div>
<div class="line"><span class="lineno"> 8502</span>                        <span class="stringliteral">&quot;%s/%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 8503</span>                        path,</div>
<div class="line"><span class="lineno"> 8504</span>                        <a class="code hl_define" href="#af3e3c69dd6791a2c441b5352743750a6">PASSWORDS_FILE_NAME</a>);</div>
<div class="line"><span class="lineno"> 8505</span> </div>
<div class="line"><span class="lineno"> 8506</span>            <span class="keywordflow">if</span> (truncated || !<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>, filep)) {</div>
<div class="line"><span class="lineno"> 8507</span><span class="preprocessor">#if defined(DEBUG)</span></div>
<div class="line"><span class="lineno"> 8508</span>                <span class="comment">/* Don&#39;t use mg_cry_internal here, but only a trace, since</span></div>
<div class="line"><span class="lineno"> 8509</span><span class="comment">                 * this is a typical case. It will occur for every directory</span></div>
<div class="line"><span class="lineno"> 8510</span><span class="comment">                 * without a password file. */</span></div>
<div class="line"><span class="lineno"> 8511</span>                <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;fopen(%s): %s&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 8512</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 8513</span>            }</div>
<div class="line"><span class="lineno"> 8514</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 8515</span>            <span class="comment">/* Try to find .htpasswd in requested directory. */</span></div>
<div class="line"><span class="lineno"> 8516</span>            <span class="keywordflow">for</span> (p = path, e = p + strlen(p) - 1; e &gt; p; e--) {</div>
<div class="line"><span class="lineno"> 8517</span>                <span class="keywordflow">if</span> (e[0] == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno"> 8518</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 8519</span>                }</div>
<div class="line"><span class="lineno"> 8520</span>            }</div>
<div class="line"><span class="lineno"> 8521</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 8522</span>                        &amp;truncated,</div>
<div class="line"><span class="lineno"> 8523</span>                        <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,</div>
<div class="line"><span class="lineno"> 8524</span>                        <span class="keyword">sizeof</span>(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>),</div>
<div class="line"><span class="lineno"> 8525</span>                        <span class="stringliteral">&quot;%.*s/%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 8526</span>                        (<span class="keywordtype">int</span>)(e - p),</div>
<div class="line"><span class="lineno"> 8527</span>                        p,</div>
<div class="line"><span class="lineno"> 8528</span>                        <a class="code hl_define" href="#af3e3c69dd6791a2c441b5352743750a6">PASSWORDS_FILE_NAME</a>);</div>
<div class="line"><span class="lineno"> 8529</span> </div>
<div class="line"><span class="lineno"> 8530</span>            <span class="keywordflow">if</span> (truncated || !<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>, filep)) {</div>
<div class="line"><span class="lineno"> 8531</span><span class="preprocessor">#if defined(DEBUG)</span></div>
<div class="line"><span class="lineno"> 8532</span>                <span class="comment">/* Don&#39;t use mg_cry_internal here, but only a trace, since</span></div>
<div class="line"><span class="lineno"> 8533</span><span class="comment">                 * this is a typical case. It will occur for every directory</span></div>
<div class="line"><span class="lineno"> 8534</span><span class="comment">                 * without a password file. */</span></div>
<div class="line"><span class="lineno"> 8535</span>                <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;fopen(%s): %s&quot;</span>, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 8536</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 8537</span>            }</div>
<div class="line"><span class="lineno"> 8538</span>        }</div>
<div class="line"><span class="lineno"> 8539</span>    }</div>
<div class="line"><span class="lineno"> 8540</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l02004">GLOBAL_PASSWORDS_FILE</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02843">MG_FOPEN_MODE_READ</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l00482">PASSWORDS_FILE_NAME</a>, <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>, and <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08918">check_authorization()</a>.</p>

</div>
</div>
<a id="aa5a596736f518b04c383c91e7c9cc747" name="aa5a596736f518b04c383c91e7c9cc747"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5a596736f518b04c383c91e7c9cc747">&#9670;&#160;</a></span>parse_auth_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_auth_header </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>buf_size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structah.html">ah</a> *</td>          <td class="paramname"><span class="paramname"><em>ah</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08555">8555</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8559</span>{</div>
<div class="line"><span class="lineno"> 8560</span>    <span class="keywordtype">char</span> *<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, *<a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, *<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>;</div>
<div class="line"><span class="lineno"> 8561</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *auth_header;</div>
<div class="line"><span class="lineno"> 8562</span>    uint64_t nonce;</div>
<div class="line"><span class="lineno"> 8563</span> </div>
<div class="line"><span class="lineno"> 8564</span>    <span class="keywordflow">if</span> (!<a class="code hl_struct" href="structah.html">ah</a> || !conn) {</div>
<div class="line"><span class="lineno"> 8565</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8566</span>    }</div>
<div class="line"><span class="lineno"> 8567</span> </div>
<div class="line"><span class="lineno"> 8568</span>    (void)memset(<a class="code hl_struct" href="structah.html">ah</a>, 0, <span class="keyword">sizeof</span>(*<a class="code hl_struct" href="structah.html">ah</a>));</div>
<div class="line"><span class="lineno"> 8569</span>    auth_header = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Authorization&quot;</span>);</div>
<div class="line"><span class="lineno"> 8570</span> </div>
<div class="line"><span class="lineno"> 8571</span>    <span class="keywordflow">if</span> (auth_header == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8572</span>        <span class="comment">/* No Authorization header at all */</span></div>
<div class="line"><span class="lineno"> 8573</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8574</span>    }</div>
<div class="line"><span class="lineno"> 8575</span>    <span class="keywordflow">if</span> (0 == <a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(auth_header, <span class="stringliteral">&quot;Basic &quot;</span>, 6)) {</div>
<div class="line"><span class="lineno"> 8576</span>        <span class="comment">/* Basic Auth (we never asked for this, but some client may send it) */</span></div>
<div class="line"><span class="lineno"> 8577</span>        <span class="keywordtype">char</span> *split;</div>
<div class="line"><span class="lineno"> 8578</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *userpw_b64 = auth_header + 6;</div>
<div class="line"><span class="lineno"> 8579</span>        <span class="keywordtype">size_t</span> userpw_b64_len = strlen(userpw_b64);</div>
<div class="line"><span class="lineno"> 8580</span>        <span class="keywordtype">size_t</span> buf_len_r = buf_size;</div>
<div class="line"><span class="lineno"> 8581</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a40d10ad1edce124016cf9efee6cb79c7">mg_base64_decode</a>(</div>
<div class="line"><span class="lineno"> 8582</span>                userpw_b64, userpw_b64_len, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)buf, &amp;buf_len_r)</div>
<div class="line"><span class="lineno"> 8583</span>            != -1) {</div>
<div class="line"><span class="lineno"> 8584</span>            <span class="keywordflow">return</span> 0; <span class="comment">/* decode error */</span></div>
<div class="line"><span class="lineno"> 8585</span>        }</div>
<div class="line"><span class="lineno"> 8586</span>        split = strchr(buf, <span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line"><span class="lineno"> 8587</span>        <span class="keywordflow">if</span> (!split) {</div>
<div class="line"><span class="lineno"> 8588</span>            <span class="keywordflow">return</span> 0; <span class="comment">/* Format error */</span></div>
<div class="line"><span class="lineno"> 8589</span>        }</div>
<div class="line"><span class="lineno"> 8590</span> </div>
<div class="line"><span class="lineno"> 8591</span>        <span class="comment">/* Separate string at &#39;:&#39; */</span></div>
<div class="line"><span class="lineno"> 8592</span>        *split = 0;</div>
<div class="line"><span class="lineno"> 8593</span> </div>
<div class="line"><span class="lineno"> 8594</span>        <span class="comment">/* User name is before &#39;:&#39;, Password is after &#39;:&#39;  */</span></div>
<div class="line"><span class="lineno"> 8595</span>        <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#a6a47edd6e080153254efde58725a372f">user</a> = buf;</div>
<div class="line"><span class="lineno"> 8596</span>        <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#af83adf530d42fad011c5f8a0a1df3002">type</a> = 1;</div>
<div class="line"><span class="lineno"> 8597</span>        <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#a72bdb0a165ff25a22981eb4ff2db98fc">plain_password</a> = split + 1;</div>
<div class="line"><span class="lineno"> 8598</span> </div>
<div class="line"><span class="lineno"> 8599</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 8600</span> </div>
<div class="line"><span class="lineno"> 8601</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == <a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(auth_header, <span class="stringliteral">&quot;Digest &quot;</span>, 7)) {</div>
<div class="line"><span class="lineno"> 8602</span>        <span class="comment">/* Digest Auth ... implemented below */</span></div>
<div class="line"><span class="lineno"> 8603</span>        <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#af83adf530d42fad011c5f8a0a1df3002">type</a> = 2;</div>
<div class="line"><span class="lineno"> 8604</span> </div>
<div class="line"><span class="lineno"> 8605</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 8606</span>        <span class="comment">/* Unknown or invalid Auth method */</span></div>
<div class="line"><span class="lineno"> 8607</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8608</span>    }</div>
<div class="line"><span class="lineno"> 8609</span> </div>
<div class="line"><span class="lineno"> 8610</span>    <span class="comment">/* Make modifiable copy of the auth header */</span></div>
<div class="line"><span class="lineno"> 8611</span>    (void)<a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(buf, auth_header + 7, buf_size);</div>
<div class="line"><span class="lineno"> 8612</span>    <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = buf;</div>
<div class="line"><span class="lineno"> 8613</span> </div>
<div class="line"><span class="lineno"> 8614</span>    <span class="comment">/* Parse authorization header */</span></div>
<div class="line"><span class="lineno"> 8615</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno"> 8616</span>        <span class="comment">/* Gobble initial spaces */</span></div>
<div class="line"><span class="lineno"> 8617</span>        <span class="keywordflow">while</span> (isspace((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>)) {</div>
<div class="line"><span class="lineno"> 8618</span>            <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>++;</div>
<div class="line"><span class="lineno"> 8619</span>        }</div>
<div class="line"><span class="lineno"> 8620</span>        <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="code hl_function" href="#a63cf9c2202b6b0433d5e13800dff00f7">skip_quoted</a>(&amp;<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;=&quot;</span>, <span class="stringliteral">&quot; &quot;</span>, 0);</div>
<div class="line"><span class="lineno"> 8621</span>        <span class="comment">/* Value is either quote-delimited, or ends at first comma or space.</span></div>
<div class="line"><span class="lineno"> 8622</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 8623</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>[0] == <span class="charliteral">&#39;\&quot;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 8624</span>            <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>++;</div>
<div class="line"><span class="lineno"> 8625</span>            <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> = <a class="code hl_function" href="#a63cf9c2202b6b0433d5e13800dff00f7">skip_quoted</a>(&amp;<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;\&quot;&quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="charliteral">&#39;\\&#39;</span>);</div>
<div class="line"><span class="lineno"> 8626</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>[0] == <span class="charliteral">&#39;,&#39;</span>) {</div>
<div class="line"><span class="lineno"> 8627</span>                <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>++;</div>
<div class="line"><span class="lineno"> 8628</span>            }</div>
<div class="line"><span class="lineno"> 8629</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 8630</span>            <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> = <a class="code hl_function" href="#a63cf9c2202b6b0433d5e13800dff00f7">skip_quoted</a>(&amp;<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="stringliteral">&quot;, &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, 0); <span class="comment">/* IE uses commas, FF</span></div>
<div class="line"><span class="lineno"> 8631</span><span class="comment">                                                    * uses spaces */</span></div>
<div class="line"><span class="lineno"> 8632</span>        }</div>
<div class="line"><span class="lineno"> 8633</span>        <span class="keywordflow">if</span> (*<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno"> 8634</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 8635</span>        }</div>
<div class="line"><span class="lineno"> 8636</span> </div>
<div class="line"><span class="lineno"> 8637</span>        <span class="keywordflow">if</span> (!strcmp(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;username&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 8638</span>            <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#a6a47edd6e080153254efde58725a372f">user</a> = <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div>
<div class="line"><span class="lineno"> 8639</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cnonce&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 8640</span>            <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#a4440fb3ea2df6ae670ceaffb35343fea">cnonce</a> = <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div>
<div class="line"><span class="lineno"> 8641</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;response&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 8642</span>            <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#ad7ad138100657d792ece1eb9f2a5046c">response</a> = <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div>
<div class="line"><span class="lineno"> 8643</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;uri&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 8644</span>            <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#a59c7740a15ab7012717e3d181a0915ac">uri</a> = <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div>
<div class="line"><span class="lineno"> 8645</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;qop&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 8646</span>            <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#ad75d946f91b89809f25620a78124c017">qop</a> = <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div>
<div class="line"><span class="lineno"> 8647</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;nc&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 8648</span>            <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#a215c0ed8072571b8c43a66ddbc2fc478">nc</a> = <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div>
<div class="line"><span class="lineno"> 8649</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;nonce&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 8650</span>            <a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#a231eacaa1fb35d4b80dca8b15bc5be67">nonce</a> = <a class="code hl_variable" href="lsqlite3_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div>
<div class="line"><span class="lineno"> 8651</span>        }</div>
<div class="line"><span class="lineno"> 8652</span>    }</div>
<div class="line"><span class="lineno"> 8653</span> </div>
<div class="line"><span class="lineno"> 8654</span><span class="preprocessor">#if !defined(NO_NONCE_CHECK)</span></div>
<div class="line"><span class="lineno"> 8655</span>    <span class="comment">/* Read the nonce from the response. */</span></div>
<div class="line"><span class="lineno"> 8656</span>    <span class="keywordflow">if</span> (<a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#a231eacaa1fb35d4b80dca8b15bc5be67">nonce</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8657</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8658</span>    }</div>
<div class="line"><span class="lineno"> 8659</span>    <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 8660</span>    nonce = strtoull(<a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#a231eacaa1fb35d4b80dca8b15bc5be67">nonce</a>, &amp;<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, 10);</div>
<div class="line"><span class="lineno"> 8661</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (*<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> != 0)) {</div>
<div class="line"><span class="lineno"> 8662</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8663</span>    }</div>
<div class="line"><span class="lineno"> 8664</span> </div>
<div class="line"><span class="lineno"> 8665</span>    <span class="comment">/* Convert the nonce from the client to a number. */</span></div>
<div class="line"><span class="lineno"> 8666</span>    nonce ^= conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a935ad1d56f46fde93d51014a96ded25d">auth_nonce_mask</a>;</div>
<div class="line"><span class="lineno"> 8667</span> </div>
<div class="line"><span class="lineno"> 8668</span>    <span class="comment">/* The converted number corresponds to the time the nounce has been</span></div>
<div class="line"><span class="lineno"> 8669</span><span class="comment">     * created. This should not be earlier than the server start. */</span></div>
<div class="line"><span class="lineno"> 8670</span>    <span class="comment">/* Server side nonce check is valuable in all situations but one:</span></div>
<div class="line"><span class="lineno"> 8671</span><span class="comment">     * if the server restarts frequently, but the client should not see</span></div>
<div class="line"><span class="lineno"> 8672</span><span class="comment">     * that, so the server should accept nonces from previous starts. */</span></div>
<div class="line"><span class="lineno"> 8673</span>    <span class="comment">/* However, the reasonable default is to not accept a nonce from a</span></div>
<div class="line"><span class="lineno"> 8674</span><span class="comment">     * previous start, so if anyone changed the access rights between</span></div>
<div class="line"><span class="lineno"> 8675</span><span class="comment">     * two restarts, a new login is required. */</span></div>
<div class="line"><span class="lineno"> 8676</span>    <span class="keywordflow">if</span> (nonce &lt; (uint64_t)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a0084702a827547767b25513d4400ce46">start_time</a>) {</div>
<div class="line"><span class="lineno"> 8677</span>        <span class="comment">/* nonce is from a previous start of the server and no longer valid</span></div>
<div class="line"><span class="lineno"> 8678</span><span class="comment">         * (replay attack?) */</span></div>
<div class="line"><span class="lineno"> 8679</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8680</span>    }</div>
<div class="line"><span class="lineno"> 8681</span>    <span class="comment">/* Check if the nonce is too high, so it has not (yet) been used by the</span></div>
<div class="line"><span class="lineno"> 8682</span><span class="comment">     * server. */</span></div>
<div class="line"><span class="lineno"> 8683</span>    <span class="keywordflow">if</span> (nonce &gt;= ((uint64_t)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a0084702a827547767b25513d4400ce46">start_time</a></div>
<div class="line"><span class="lineno"> 8684</span>                  + conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a25db94e78d0710af1bb4d7f3b8bd6556">nonce_count</a>)) {</div>
<div class="line"><span class="lineno"> 8685</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8686</span>    }</div>
<div class="line"><span class="lineno"> 8687</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 8688</span>    (void)nonce;</div>
<div class="line"><span class="lineno"> 8689</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 8690</span> </div>
<div class="line"><span class="lineno"> 8691</span>    <span class="keywordflow">return</span> (<a class="code hl_struct" href="structah.html">ah</a>-&gt;<a class="code hl_variable" href="structah.html#a6a47edd6e080153254efde58725a372f">user</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 8692</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a40d10ad1edce124016cf9efee6cb79c7"><div class="ttname"><a href="#a40d10ad1edce124016cf9efee6cb79c7">mg_base64_decode</a></div><div class="ttdeci">CIVETWEB_API int mg_base64_decode(const char *src, size_t src_len, unsigned char *dst, size_t *dst_len)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07383">civetweb.c:7383</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a63cf9c2202b6b0433d5e13800dff00f7"><div class="ttname"><a href="#a63cf9c2202b6b0433d5e13800dff00f7">skip_quoted</a></div><div class="ttdeci">static char * skip_quoted(char **buf, const char *delimiters, const char *whitespace, char quotechar)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03757">civetweb.c:3757</a></div></div>
<div class="ttc" id="astructah_html"><div class="ttname"><a href="structah.html">ah</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08545">civetweb.c:8545</a></div></div>
<div class="ttc" id="astructah_html_a215c0ed8072571b8c43a66ddbc2fc478"><div class="ttname"><a href="structah.html#a215c0ed8072571b8c43a66ddbc2fc478">ah::nc</a></div><div class="ttdeci">char * nc</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08549">civetweb.c:8549</a></div></div>
<div class="ttc" id="astructah_html_a231eacaa1fb35d4b80dca8b15bc5be67"><div class="ttname"><a href="structah.html#a231eacaa1fb35d4b80dca8b15bc5be67">ah::nonce</a></div><div class="ttdeci">char * nonce</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08549">civetweb.c:8549</a></div></div>
<div class="ttc" id="astructah_html_a4440fb3ea2df6ae670ceaffb35343fea"><div class="ttname"><a href="structah.html#a4440fb3ea2df6ae670ceaffb35343fea">ah::cnonce</a></div><div class="ttdeci">char * cnonce</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08549">civetweb.c:8549</a></div></div>
<div class="ttc" id="astructah_html_a59c7740a15ab7012717e3d181a0915ac"><div class="ttname"><a href="structah.html#a59c7740a15ab7012717e3d181a0915ac">ah::uri</a></div><div class="ttdeci">char * uri</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08549">civetweb.c:8549</a></div></div>
<div class="ttc" id="astructah_html_a6a47edd6e080153254efde58725a372f"><div class="ttname"><a href="structah.html#a6a47edd6e080153254efde58725a372f">ah::user</a></div><div class="ttdeci">char * user</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08546">civetweb.c:8546</a></div></div>
<div class="ttc" id="astructah_html_a72bdb0a165ff25a22981eb4ff2db98fc"><div class="ttname"><a href="structah.html#a72bdb0a165ff25a22981eb4ff2db98fc">ah::plain_password</a></div><div class="ttdeci">char * plain_password</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08548">civetweb.c:8548</a></div></div>
<div class="ttc" id="astructah_html_ad75d946f91b89809f25620a78124c017"><div class="ttname"><a href="structah.html#ad75d946f91b89809f25620a78124c017">ah::qop</a></div><div class="ttdeci">char * qop</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08549">civetweb.c:8549</a></div></div>
<div class="ttc" id="astructah_html_ad7ad138100657d792ece1eb9f2a5046c"><div class="ttname"><a href="structah.html#ad7ad138100657d792ece1eb9f2a5046c">ah::response</a></div><div class="ttdeci">char * response</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08549">civetweb.c:8549</a></div></div>
<div class="ttc" id="astructah_html_af83adf530d42fad011c5f8a0a1df3002"><div class="ttname"><a href="structah.html#af83adf530d42fad011c5f8a0a1df3002">ah::type</a></div><div class="ttdeci">int type</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08547">civetweb.c:8547</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02276">mg_domain_context::auth_nonce_mask</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::cnonce</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l07383">mg_base64_decode()</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, <a class="el" href="civetweb_8c_source.html#l03019">mg_strncasecmp()</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::nc</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::nonce</a>, <a class="el" href="civetweb_8c_source.html#l02277">mg_domain_context::nonce_count</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l08548">ah::plain_password</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::qop</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::response</a>, <a class="el" href="multi_8h_source.html#l00318">s</a>, <a class="el" href="civetweb_8c_source.html#l03757">skip_quoted()</a>, <a class="el" href="civetweb_8c_source.html#l02412">mg_context::start_time</a>, <a class="el" href="civetweb_8c_source.html#l08547">ah::type</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::uri</a>, <a class="el" href="civetweb_8c_source.html#l08546">ah::user</a>, and <a class="el" href="lsqlite3_8c_source.html#l02155">value</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08861">authorize()</a>.</p>

</div>
</div>
<a id="a8d431c80187736408d57f4c83bcfa5a2" name="a8d431c80187736408d57f4c83bcfa5a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d431c80187736408d57f4c83bcfa5a2">&#9670;&#160;</a></span>parse_date_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static time_t parse_date_string </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>datetime</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08005">8005</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8006</span>{</div>
<div class="line"><span class="lineno"> 8007</span>    <span class="keywordtype">char</span> month_str[32] = {0};</div>
<div class="line"><span class="lineno"> 8008</span>    <span class="keywordtype">int</span> second, minute, hour, day, month, year;</div>
<div class="line"><span class="lineno"> 8009</span>    time_t result = (time_t)0;</div>
<div class="line"><span class="lineno"> 8010</span>    <span class="keyword">struct </span>tm tm;</div>
<div class="line"><span class="lineno"> 8011</span> </div>
<div class="line"><span class="lineno"> 8012</span>    <span class="keywordflow">if</span> ((sscanf(datetime,</div>
<div class="line"><span class="lineno"> 8013</span>                <span class="stringliteral">&quot;%d/%3s/%d %d:%d:%d&quot;</span>,</div>
<div class="line"><span class="lineno"> 8014</span>                &amp;day,</div>
<div class="line"><span class="lineno"> 8015</span>                month_str,</div>
<div class="line"><span class="lineno"> 8016</span>                &amp;year,</div>
<div class="line"><span class="lineno"> 8017</span>                &amp;hour,</div>
<div class="line"><span class="lineno"> 8018</span>                &amp;minute,</div>
<div class="line"><span class="lineno"> 8019</span>                &amp;second)</div>
<div class="line"><span class="lineno"> 8020</span>         == 6)</div>
<div class="line"><span class="lineno"> 8021</span>        || (sscanf(datetime,</div>
<div class="line"><span class="lineno"> 8022</span>                   <span class="stringliteral">&quot;%d %3s %d %d:%d:%d&quot;</span>,</div>
<div class="line"><span class="lineno"> 8023</span>                   &amp;day,</div>
<div class="line"><span class="lineno"> 8024</span>                   month_str,</div>
<div class="line"><span class="lineno"> 8025</span>                   &amp;year,</div>
<div class="line"><span class="lineno"> 8026</span>                   &amp;hour,</div>
<div class="line"><span class="lineno"> 8027</span>                   &amp;minute,</div>
<div class="line"><span class="lineno"> 8028</span>                   &amp;second)</div>
<div class="line"><span class="lineno"> 8029</span>            == 6)</div>
<div class="line"><span class="lineno"> 8030</span>        || (sscanf(datetime,</div>
<div class="line"><span class="lineno"> 8031</span>                   <span class="stringliteral">&quot;%*3s, %d %3s %d %d:%d:%d&quot;</span>,</div>
<div class="line"><span class="lineno"> 8032</span>                   &amp;day,</div>
<div class="line"><span class="lineno"> 8033</span>                   month_str,</div>
<div class="line"><span class="lineno"> 8034</span>                   &amp;year,</div>
<div class="line"><span class="lineno"> 8035</span>                   &amp;hour,</div>
<div class="line"><span class="lineno"> 8036</span>                   &amp;minute,</div>
<div class="line"><span class="lineno"> 8037</span>                   &amp;second)</div>
<div class="line"><span class="lineno"> 8038</span>            == 6)</div>
<div class="line"><span class="lineno"> 8039</span>        || (sscanf(datetime,</div>
<div class="line"><span class="lineno"> 8040</span>                   <span class="stringliteral">&quot;%d-%3s-%d %d:%d:%d&quot;</span>,</div>
<div class="line"><span class="lineno"> 8041</span>                   &amp;day,</div>
<div class="line"><span class="lineno"> 8042</span>                   month_str,</div>
<div class="line"><span class="lineno"> 8043</span>                   &amp;year,</div>
<div class="line"><span class="lineno"> 8044</span>                   &amp;hour,</div>
<div class="line"><span class="lineno"> 8045</span>                   &amp;minute,</div>
<div class="line"><span class="lineno"> 8046</span>                   &amp;second)</div>
<div class="line"><span class="lineno"> 8047</span>            == 6)) {</div>
<div class="line"><span class="lineno"> 8048</span>        month = <a class="code hl_function" href="#aec4315e0c74af7127b8e43e7f3cc82cf">get_month_index</a>(month_str);</div>
<div class="line"><span class="lineno"> 8049</span>        <span class="keywordflow">if</span> ((month &gt;= 0) &amp;&amp; (year &gt;= 1970)) {</div>
<div class="line"><span class="lineno"> 8050</span>            memset(&amp;tm, 0, <span class="keyword">sizeof</span>(tm));</div>
<div class="line"><span class="lineno"> 8051</span>            tm.tm_year = year - 1900;</div>
<div class="line"><span class="lineno"> 8052</span>            tm.tm_mon = month;</div>
<div class="line"><span class="lineno"> 8053</span>            tm.tm_mday = day;</div>
<div class="line"><span class="lineno"> 8054</span>            tm.tm_hour = hour;</div>
<div class="line"><span class="lineno"> 8055</span>            tm.tm_min = minute;</div>
<div class="line"><span class="lineno"> 8056</span>            tm.tm_sec = second;</div>
<div class="line"><span class="lineno"> 8057</span>            result = timegm(&amp;tm);</div>
<div class="line"><span class="lineno"> 8058</span>        }</div>
<div class="line"><span class="lineno"> 8059</span>    }</div>
<div class="line"><span class="lineno"> 8060</span> </div>
<div class="line"><span class="lineno"> 8061</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno"> 8062</span>}</div>
<div class="ttc" id="acivetweb_8c_html_aec4315e0c74af7127b8e43e7f3cc82cf"><div class="ttname"><a href="#aec4315e0c74af7127b8e43e7f3cc82cf">get_month_index</a></div><div class="ttdeci">static int get_month_index(const char *s)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07989">civetweb.c:7989</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l07989">get_month_index()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10468">is_not_modified()</a>.</p>

</div>
</div>
<a id="a461ef0a8b46dd9223774d62a6f290186" name="a461ef0a8b46dd9223774d62a6f290186"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a461ef0a8b46dd9223774d62a6f290186">&#9670;&#160;</a></span>parse_http_headers()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_http_headers </td>
          <td>(</td>
          <td class="paramtype">char **</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__header.html">mg_header</a></td>          <td class="paramname"><span class="paramname"><em>hdr</em>[MG_MAX_HEADERS]</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10725">10725</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10726</span>{</div>
<div class="line"><span class="lineno">10727</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">10728</span>    <span class="keywordtype">int</span> num_headers = 0;</div>
<div class="line"><span class="lineno">10729</span> </div>
<div class="line"><span class="lineno">10730</span>    <span class="keywordflow">for</span> (i = 0; i &lt; (int)<a class="code hl_define" href="civetweb_8h.html#a0a13e84141de39780fed2bba427631fd">MG_MAX_HEADERS</a>; i++) {</div>
<div class="line"><span class="lineno">10731</span>        <span class="keywordtype">char</span> *dp = *buf;</div>
<div class="line"><span class="lineno">10732</span> </div>
<div class="line"><span class="lineno">10733</span>        <span class="comment">/* Skip all ASCII characters (&gt;SPACE, &lt;127), to find a &#39;:&#39; */</span></div>
<div class="line"><span class="lineno">10734</span>        <span class="keywordflow">while</span> ((*dp != <span class="charliteral">&#39;:&#39;</span>) &amp;&amp; (*dp &gt;= 33) &amp;&amp; (*dp &lt;= 126)) {</div>
<div class="line"><span class="lineno">10735</span>            dp++;</div>
<div class="line"><span class="lineno">10736</span>        }</div>
<div class="line"><span class="lineno">10737</span>        <span class="keywordflow">if</span> (dp == *buf) {</div>
<div class="line"><span class="lineno">10738</span>            <span class="comment">/* End of headers reached. */</span></div>
<div class="line"><span class="lineno">10739</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">10740</span>        }</div>
<div class="line"><span class="lineno">10741</span> </div>
<div class="line"><span class="lineno">10742</span>        <span class="comment">/* Drop all spaces after header name before : */</span></div>
<div class="line"><span class="lineno">10743</span>        <span class="keywordflow">while</span> (*dp == <span class="charliteral">&#39; &#39;</span>) {</div>
<div class="line"><span class="lineno">10744</span>            *dp = 0;</div>
<div class="line"><span class="lineno">10745</span>            dp++;</div>
<div class="line"><span class="lineno">10746</span>        }</div>
<div class="line"><span class="lineno">10747</span>        <span class="keywordflow">if</span> (*dp != <span class="charliteral">&#39;:&#39;</span>) {</div>
<div class="line"><span class="lineno">10748</span>            <span class="comment">/* This is not a valid field. */</span></div>
<div class="line"><span class="lineno">10749</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10750</span>        }</div>
<div class="line"><span class="lineno">10751</span> </div>
<div class="line"><span class="lineno">10752</span>        <span class="comment">/* End of header key (*dp == &#39;:&#39;) */</span></div>
<div class="line"><span class="lineno">10753</span>        <span class="comment">/* Truncate here and set the key name */</span></div>
<div class="line"><span class="lineno">10754</span>        *dp = 0;</div>
<div class="line"><span class="lineno">10755</span>        hdr[i].<a class="code hl_variable" href="structmg__header.html#ab91ffbf88fe154a963031e915adf8397">name</a> = *buf;</div>
<div class="line"><span class="lineno">10756</span> </div>
<div class="line"><span class="lineno">10757</span>        <span class="comment">/* Skip all spaces */</span></div>
<div class="line"><span class="lineno">10758</span>        <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">10759</span>            dp++;</div>
<div class="line"><span class="lineno">10760</span>        } <span class="keywordflow">while</span> ((*dp == <span class="charliteral">&#39; &#39;</span>) || (*dp == <span class="charliteral">&#39;\t&#39;</span>));</div>
<div class="line"><span class="lineno">10761</span> </div>
<div class="line"><span class="lineno">10762</span>        <span class="comment">/* The rest of the line is the value */</span></div>
<div class="line"><span class="lineno">10763</span>        hdr[i].<a class="code hl_variable" href="structmg__header.html#a9cdd7ef80ee309a6de14684059081d0d">value</a> = dp;</div>
<div class="line"><span class="lineno">10764</span> </div>
<div class="line"><span class="lineno">10765</span>        <span class="comment">/* Find end of line */</span></div>
<div class="line"><span class="lineno">10766</span>        <span class="keywordflow">while</span> ((*dp != 0) &amp;&amp; (*dp != <span class="charliteral">&#39;\r&#39;</span>) &amp;&amp; (*dp != <span class="charliteral">&#39;\n&#39;</span>)) {</div>
<div class="line"><span class="lineno">10767</span>            dp++;</div>
<div class="line"><span class="lineno">10768</span>        };</div>
<div class="line"><span class="lineno">10769</span> </div>
<div class="line"><span class="lineno">10770</span>        <span class="comment">/* eliminate \r */</span></div>
<div class="line"><span class="lineno">10771</span>        <span class="keywordflow">if</span> (*dp == <span class="charliteral">&#39;\r&#39;</span>) {</div>
<div class="line"><span class="lineno">10772</span>            *dp = 0;</div>
<div class="line"><span class="lineno">10773</span>            dp++;</div>
<div class="line"><span class="lineno">10774</span>            <span class="keywordflow">if</span> (*dp != <span class="charliteral">&#39;\n&#39;</span>) {</div>
<div class="line"><span class="lineno">10775</span>                <span class="comment">/* This is not a valid line. */</span></div>
<div class="line"><span class="lineno">10776</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10777</span>            }</div>
<div class="line"><span class="lineno">10778</span>        }</div>
<div class="line"><span class="lineno">10779</span> </div>
<div class="line"><span class="lineno">10780</span>        <span class="comment">/* here *dp is either 0 or &#39;\n&#39; */</span></div>
<div class="line"><span class="lineno">10781</span>        <span class="comment">/* in any case, we have a new header */</span></div>
<div class="line"><span class="lineno">10782</span>        num_headers = i + 1;</div>
<div class="line"><span class="lineno">10783</span> </div>
<div class="line"><span class="lineno">10784</span>        <span class="keywordflow">if</span> (*dp) {</div>
<div class="line"><span class="lineno">10785</span>            *dp = 0;</div>
<div class="line"><span class="lineno">10786</span>            dp++;</div>
<div class="line"><span class="lineno">10787</span>            *buf = dp;</div>
<div class="line"><span class="lineno">10788</span> </div>
<div class="line"><span class="lineno">10789</span>            <span class="keywordflow">if</span> ((dp[0] == <span class="charliteral">&#39;\r&#39;</span>) || (dp[0] == <span class="charliteral">&#39;\n&#39;</span>)) {</div>
<div class="line"><span class="lineno">10790</span>                <span class="comment">/* This is the end of the header */</span></div>
<div class="line"><span class="lineno">10791</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">10792</span>            }</div>
<div class="line"><span class="lineno">10793</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">10794</span>            *buf = dp;</div>
<div class="line"><span class="lineno">10795</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">10796</span>        }</div>
<div class="line"><span class="lineno">10797</span>    }</div>
<div class="line"><span class="lineno">10798</span>    <span class="keywordflow">return</span> num_headers;</div>
<div class="line"><span class="lineno">10799</span>}</div>
<div class="ttc" id="acivetweb_8h_html_a0a13e84141de39780fed2bba427631fd"><div class="ttname"><a href="civetweb_8h.html#a0a13e84141de39780fed2bba427631fd">MG_MAX_HEADERS</a></div><div class="ttdeci">#define MG_MAX_HEADERS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00141">civetweb.h:141</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00141">MG_MAX_HEADERS</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l10915">parse_http_request()</a>, and <a class="el" href="civetweb_8c_source.html#l11001">parse_http_response()</a>.</p>

</div>
</div>
<a id="a02c595eceb37a14be0c7eb08ab464616" name="a02c595eceb37a14be0c7eb08ab464616"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02c595eceb37a14be0c7eb08ab464616">&#9670;&#160;</a></span>parse_http_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_http_request </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__request__info.html">mg_request_info</a> *</td>          <td class="paramname"><span class="paramname"><em>ri</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10915">10915</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10916</span>{</div>
<div class="line"><span class="lineno">10917</span>    <span class="keywordtype">int</span> request_length;</div>
<div class="line"><span class="lineno">10918</span>    <span class="keywordtype">int</span> init_skip = 0;</div>
<div class="line"><span class="lineno">10919</span> </div>
<div class="line"><span class="lineno">10920</span>    <span class="comment">/* Reset attributes. DO NOT TOUCH is_ssl, remote_addr,</span></div>
<div class="line"><span class="lineno">10921</span><span class="comment">     * remote_port */</span></div>
<div class="line"><span class="lineno">10922</span>    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a> = ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a> = ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a> = ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a> =</div>
<div class="line"><span class="lineno">10923</span>        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">10924</span>    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a> = 0;</div>
<div class="line"><span class="lineno">10925</span> </div>
<div class="line"><span class="lineno">10926</span>    <span class="comment">/* RFC says that all initial whitespaces should be ignored */</span></div>
<div class="line"><span class="lineno">10927</span>    <span class="comment">/* This included all leading \r and \n (isspace) */</span></div>
<div class="line"><span class="lineno">10928</span>    <span class="comment">/* See table: http://www.cplusplus.com/reference/cctype/ */</span></div>
<div class="line"><span class="lineno">10929</span>    <span class="keywordflow">while</span> ((len &gt; 0) &amp;&amp; isspace((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*buf)) {</div>
<div class="line"><span class="lineno">10930</span>        buf++;</div>
<div class="line"><span class="lineno">10931</span>        len--;</div>
<div class="line"><span class="lineno">10932</span>        init_skip++;</div>
<div class="line"><span class="lineno">10933</span>    }</div>
<div class="line"><span class="lineno">10934</span> </div>
<div class="line"><span class="lineno">10935</span>    <span class="keywordflow">if</span> (len == 0) {</div>
<div class="line"><span class="lineno">10936</span>        <span class="comment">/* Incomplete request */</span></div>
<div class="line"><span class="lineno">10937</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">10938</span>    }</div>
<div class="line"><span class="lineno">10939</span> </div>
<div class="line"><span class="lineno">10940</span>    <span class="comment">/* Control characters are not allowed, including zero */</span></div>
<div class="line"><span class="lineno">10941</span>    <span class="keywordflow">if</span> (iscntrl((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*buf)) {</div>
<div class="line"><span class="lineno">10942</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10943</span>    }</div>
<div class="line"><span class="lineno">10944</span> </div>
<div class="line"><span class="lineno">10945</span>    <span class="comment">/* Find end of HTTP header */</span></div>
<div class="line"><span class="lineno">10946</span>    request_length = <a class="code hl_function" href="#aac32d22dcddea6592a3772d746edf5bb">get_http_header_len</a>(buf, len);</div>
<div class="line"><span class="lineno">10947</span>    <span class="keywordflow">if</span> (request_length &lt;= 0) {</div>
<div class="line"><span class="lineno">10948</span>        <span class="keywordflow">return</span> request_length;</div>
<div class="line"><span class="lineno">10949</span>    }</div>
<div class="line"><span class="lineno">10950</span>    buf[request_length - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">10951</span> </div>
<div class="line"><span class="lineno">10952</span>    <span class="keywordflow">if</span> ((*buf == 0) || (*buf == <span class="charliteral">&#39;\r&#39;</span>) || (*buf == <span class="charliteral">&#39;\n&#39;</span>)) {</div>
<div class="line"><span class="lineno">10953</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10954</span>    }</div>
<div class="line"><span class="lineno">10955</span> </div>
<div class="line"><span class="lineno">10956</span>    <span class="comment">/* The first word has to be the HTTP method */</span></div>
<div class="line"><span class="lineno">10957</span>    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a> = buf;</div>
<div class="line"><span class="lineno">10958</span> </div>
<div class="line"><span class="lineno">10959</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6caa9c39e63744c4ee69d2dea110ea66">skip_to_end_of_word_and_terminate</a>(&amp;buf, 0) &lt;= 0) {</div>
<div class="line"><span class="lineno">10960</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10961</span>    }</div>
<div class="line"><span class="lineno">10962</span> </div>
<div class="line"><span class="lineno">10963</span>    <span class="comment">/* The second word is the URI */</span></div>
<div class="line"><span class="lineno">10964</span>    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a> = buf;</div>
<div class="line"><span class="lineno">10965</span> </div>
<div class="line"><span class="lineno">10966</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6caa9c39e63744c4ee69d2dea110ea66">skip_to_end_of_word_and_terminate</a>(&amp;buf, 0) &lt;= 0) {</div>
<div class="line"><span class="lineno">10967</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10968</span>    }</div>
<div class="line"><span class="lineno">10969</span> </div>
<div class="line"><span class="lineno">10970</span>    <span class="comment">/* Next would be the HTTP version */</span></div>
<div class="line"><span class="lineno">10971</span>    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a> = buf;</div>
<div class="line"><span class="lineno">10972</span> </div>
<div class="line"><span class="lineno">10973</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6caa9c39e63744c4ee69d2dea110ea66">skip_to_end_of_word_and_terminate</a>(&amp;buf, 1) &lt;= 0) {</div>
<div class="line"><span class="lineno">10974</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10975</span>    }</div>
<div class="line"><span class="lineno">10976</span> </div>
<div class="line"><span class="lineno">10977</span>    <span class="comment">/* Check for a valid HTTP version key */</span></div>
<div class="line"><span class="lineno">10978</span>    <span class="keywordflow">if</span> (strncmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a>, <span class="stringliteral">&quot;HTTP/&quot;</span>, 5) != 0) {</div>
<div class="line"><span class="lineno">10979</span>        <span class="comment">/* Invalid request */</span></div>
<div class="line"><span class="lineno">10980</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10981</span>    }</div>
<div class="line"><span class="lineno">10982</span>    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a> += 5;</div>
<div class="line"><span class="lineno">10983</span> </div>
<div class="line"><span class="lineno">10984</span>    <span class="comment">/* Check for a valid http method */</span></div>
<div class="line"><span class="lineno">10985</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#affc32c6a90f6b193dda6fbe4c600769c">is_valid_http_method</a>(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>)) {</div>
<div class="line"><span class="lineno">10986</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10987</span>    }</div>
<div class="line"><span class="lineno">10988</span> </div>
<div class="line"><span class="lineno">10989</span>    <span class="comment">/* Parse all HTTP headers */</span></div>
<div class="line"><span class="lineno">10990</span>    ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a> = <a class="code hl_function" href="#a461ef0a8b46dd9223774d62a6f290186">parse_http_headers</a>(&amp;buf, ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>);</div>
<div class="line"><span class="lineno">10991</span>    <span class="keywordflow">if</span> (ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a> &lt; 0) {</div>
<div class="line"><span class="lineno">10992</span>        <span class="comment">/* Error while parsing headers */</span></div>
<div class="line"><span class="lineno">10993</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10994</span>    }</div>
<div class="line"><span class="lineno">10995</span> </div>
<div class="line"><span class="lineno">10996</span>    <span class="keywordflow">return</span> request_length + init_skip;</div>
<div class="line"><span class="lineno">10997</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a6caa9c39e63744c4ee69d2dea110ea66"><div class="ttname"><a href="#a6caa9c39e63744c4ee69d2dea110ea66">skip_to_end_of_word_and_terminate</a></div><div class="ttdeci">static int skip_to_end_of_word_and_terminate(char **ppw, int eol)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10680">civetweb.c:10680</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aac32d22dcddea6592a3772d746edf5bb"><div class="ttname"><a href="#aac32d22dcddea6592a3772d746edf5bb">get_http_header_len</a></div><div class="ttdeci">static int get_http_header_len(const char *buf, int buflen)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l07952">civetweb.c:7952</a></div></div>
<div class="ttc" id="acivetweb_8c_html_affc32c6a90f6b193dda6fbe4c600769c"><div class="ttname"><a href="#affc32c6a90f6b193dda6fbe4c600769c">is_valid_http_method</a></div><div class="ttdeci">static int is_valid_http_method(const char *method)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l10899">civetweb.c:10899</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l07952">get_http_header_len()</a>, <a class="el" href="civetweb_8h_source.html#l00179">mg_request_info::http_headers</a>, <a class="el" href="civetweb_8h_source.html#l00161">mg_request_info::http_version</a>, <a class="el" href="civetweb_8c_source.html#l10899">is_valid_http_method()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00178">mg_request_info::num_headers</a>, <a class="el" href="civetweb_8c_source.html#l10725">parse_http_headers()</a>, <a class="el" href="civetweb_8h_source.html#l00164">mg_request_info::remote_user</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>, and <a class="el" href="civetweb_8c_source.html#l10680">skip_to_end_of_word_and_terminate()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18645">get_request()</a>.</p>

</div>
</div>
<a id="ad6bd0851fba7b27c7180498b80f535ca" name="ad6bd0851fba7b27c7180498b80f535ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6bd0851fba7b27c7180498b80f535ca">&#9670;&#160;</a></span>parse_http_response()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_http_response </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__response__info.html">mg_response_info</a> *</td>          <td class="paramname"><span class="paramname"><em>ri</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l11001">11001</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">11002</span>{</div>
<div class="line"><span class="lineno">11003</span>    <span class="keywordtype">int</span> response_length;</div>
<div class="line"><span class="lineno">11004</span>    <span class="keywordtype">int</span> init_skip = 0;</div>
<div class="line"><span class="lineno">11005</span>    <span class="keywordtype">char</span> *tmp, *tmp2;</div>
<div class="line"><span class="lineno">11006</span>    <span class="keywordtype">long</span> l;</div>
<div class="line"><span class="lineno">11007</span> </div>
<div class="line"><span class="lineno">11008</span>    <span class="comment">/* Initialize elements. */</span></div>
<div class="line"><span class="lineno">11009</span>    ri-&gt;<a class="code hl_variable" href="structmg__response__info.html#a28b0b6daf9b7245b7cefc22b65f377d4">http_version</a> = ri-&gt;<a class="code hl_variable" href="structmg__response__info.html#ac1cdea9c63d8fac3ac4b8682441b1a5b">status_text</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">11010</span>    ri-&gt;<a class="code hl_variable" href="structmg__response__info.html#a3becae78e0589983f147dbfd19ae33dc">num_headers</a> = ri-&gt;<a class="code hl_variable" href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">status_code</a> = 0;</div>
<div class="line"><span class="lineno">11011</span> </div>
<div class="line"><span class="lineno">11012</span>    <span class="comment">/* RFC says that all initial whitespaces should be ignored */</span></div>
<div class="line"><span class="lineno">11013</span>    <span class="comment">/* This included all leading \r and \n (isspace) */</span></div>
<div class="line"><span class="lineno">11014</span>    <span class="comment">/* See table: http://www.cplusplus.com/reference/cctype/ */</span></div>
<div class="line"><span class="lineno">11015</span>    <span class="keywordflow">while</span> ((len &gt; 0) &amp;&amp; isspace((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*buf)) {</div>
<div class="line"><span class="lineno">11016</span>        buf++;</div>
<div class="line"><span class="lineno">11017</span>        len--;</div>
<div class="line"><span class="lineno">11018</span>        init_skip++;</div>
<div class="line"><span class="lineno">11019</span>    }</div>
<div class="line"><span class="lineno">11020</span> </div>
<div class="line"><span class="lineno">11021</span>    <span class="keywordflow">if</span> (len == 0) {</div>
<div class="line"><span class="lineno">11022</span>        <span class="comment">/* Incomplete request */</span></div>
<div class="line"><span class="lineno">11023</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">11024</span>    }</div>
<div class="line"><span class="lineno">11025</span> </div>
<div class="line"><span class="lineno">11026</span>    <span class="comment">/* Control characters are not allowed, including zero */</span></div>
<div class="line"><span class="lineno">11027</span>    <span class="keywordflow">if</span> (iscntrl((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*buf)) {</div>
<div class="line"><span class="lineno">11028</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11029</span>    }</div>
<div class="line"><span class="lineno">11030</span> </div>
<div class="line"><span class="lineno">11031</span>    <span class="comment">/* Find end of HTTP header */</span></div>
<div class="line"><span class="lineno">11032</span>    response_length = <a class="code hl_function" href="#aac32d22dcddea6592a3772d746edf5bb">get_http_header_len</a>(buf, len);</div>
<div class="line"><span class="lineno">11033</span>    <span class="keywordflow">if</span> (response_length &lt;= 0) {</div>
<div class="line"><span class="lineno">11034</span>        <span class="keywordflow">return</span> response_length;</div>
<div class="line"><span class="lineno">11035</span>    }</div>
<div class="line"><span class="lineno">11036</span>    buf[response_length - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">11037</span> </div>
<div class="line"><span class="lineno">11038</span>    <span class="keywordflow">if</span> ((*buf == 0) || (*buf == <span class="charliteral">&#39;\r&#39;</span>) || (*buf == <span class="charliteral">&#39;\n&#39;</span>)) {</div>
<div class="line"><span class="lineno">11039</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11040</span>    }</div>
<div class="line"><span class="lineno">11041</span> </div>
<div class="line"><span class="lineno">11042</span>    <span class="comment">/* The first word is the HTTP version */</span></div>
<div class="line"><span class="lineno">11043</span>    <span class="comment">/* Check for a valid HTTP version key */</span></div>
<div class="line"><span class="lineno">11044</span>    <span class="keywordflow">if</span> (strncmp(buf, <span class="stringliteral">&quot;HTTP/&quot;</span>, 5) != 0) {</div>
<div class="line"><span class="lineno">11045</span>        <span class="comment">/* Invalid request */</span></div>
<div class="line"><span class="lineno">11046</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11047</span>    }</div>
<div class="line"><span class="lineno">11048</span>    buf += 5;</div>
<div class="line"><span class="lineno">11049</span>    <span class="keywordflow">if</span> (!isgraph((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)buf[0])) {</div>
<div class="line"><span class="lineno">11050</span>        <span class="comment">/* Invalid request */</span></div>
<div class="line"><span class="lineno">11051</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11052</span>    }</div>
<div class="line"><span class="lineno">11053</span>    ri-&gt;<a class="code hl_variable" href="structmg__response__info.html#a28b0b6daf9b7245b7cefc22b65f377d4">http_version</a> = buf;</div>
<div class="line"><span class="lineno">11054</span> </div>
<div class="line"><span class="lineno">11055</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6caa9c39e63744c4ee69d2dea110ea66">skip_to_end_of_word_and_terminate</a>(&amp;buf, 0) &lt;= 0) {</div>
<div class="line"><span class="lineno">11056</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11057</span>    }</div>
<div class="line"><span class="lineno">11058</span> </div>
<div class="line"><span class="lineno">11059</span>    <span class="comment">/* The second word is the status as a number */</span></div>
<div class="line"><span class="lineno">11060</span>    tmp = buf;</div>
<div class="line"><span class="lineno">11061</span> </div>
<div class="line"><span class="lineno">11062</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6caa9c39e63744c4ee69d2dea110ea66">skip_to_end_of_word_and_terminate</a>(&amp;buf, 0) &lt;= 0) {</div>
<div class="line"><span class="lineno">11063</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11064</span>    }</div>
<div class="line"><span class="lineno">11065</span> </div>
<div class="line"><span class="lineno">11066</span>    l = strtol(tmp, &amp;tmp2, 10);</div>
<div class="line"><span class="lineno">11067</span>    <span class="keywordflow">if</span> ((l &lt; 100) || (l &gt;= 1000) || ((tmp2 - tmp) != 3) || (*tmp2 != 0)) {</div>
<div class="line"><span class="lineno">11068</span>        <span class="comment">/* Everything else but a 3 digit code is invalid */</span></div>
<div class="line"><span class="lineno">11069</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11070</span>    }</div>
<div class="line"><span class="lineno">11071</span>    ri-&gt;<a class="code hl_variable" href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">status_code</a> = (int)l;</div>
<div class="line"><span class="lineno">11072</span> </div>
<div class="line"><span class="lineno">11073</span>    <span class="comment">/* The rest of the line is the status text */</span></div>
<div class="line"><span class="lineno">11074</span>    ri-&gt;<a class="code hl_variable" href="structmg__response__info.html#ac1cdea9c63d8fac3ac4b8682441b1a5b">status_text</a> = buf;</div>
<div class="line"><span class="lineno">11075</span> </div>
<div class="line"><span class="lineno">11076</span>    <span class="comment">/* Find end of status text */</span></div>
<div class="line"><span class="lineno">11077</span>    <span class="comment">/* isgraph or isspace = isprint */</span></div>
<div class="line"><span class="lineno">11078</span>    <span class="keywordflow">while</span> (isprint((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*buf)) {</div>
<div class="line"><span class="lineno">11079</span>        buf++;</div>
<div class="line"><span class="lineno">11080</span>    }</div>
<div class="line"><span class="lineno">11081</span>    <span class="keywordflow">if</span> ((*buf != <span class="charliteral">&#39;\r&#39;</span>) &amp;&amp; (*buf != <span class="charliteral">&#39;\n&#39;</span>)) {</div>
<div class="line"><span class="lineno">11082</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11083</span>    }</div>
<div class="line"><span class="lineno">11084</span>    <span class="comment">/* Terminate string and forward buf to next line */</span></div>
<div class="line"><span class="lineno">11085</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">11086</span>        *buf = 0;</div>
<div class="line"><span class="lineno">11087</span>        buf++;</div>
<div class="line"><span class="lineno">11088</span>    } <span class="keywordflow">while</span> (isspace((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*buf));</div>
<div class="line"><span class="lineno">11089</span> </div>
<div class="line"><span class="lineno">11090</span>    <span class="comment">/* Parse all HTTP headers */</span></div>
<div class="line"><span class="lineno">11091</span>    ri-&gt;<a class="code hl_variable" href="structmg__response__info.html#a3becae78e0589983f147dbfd19ae33dc">num_headers</a> = <a class="code hl_function" href="#a461ef0a8b46dd9223774d62a6f290186">parse_http_headers</a>(&amp;buf, ri-&gt;<a class="code hl_variable" href="structmg__response__info.html#af6cc6e0a5264c89cfd54e84461a462c8">http_headers</a>);</div>
<div class="line"><span class="lineno">11092</span>    <span class="keywordflow">if</span> (ri-&gt;<a class="code hl_variable" href="structmg__response__info.html#a3becae78e0589983f147dbfd19ae33dc">num_headers</a> &lt; 0) {</div>
<div class="line"><span class="lineno">11093</span>        <span class="comment">/* Error while parsing headers */</span></div>
<div class="line"><span class="lineno">11094</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11095</span>    }</div>
<div class="line"><span class="lineno">11096</span> </div>
<div class="line"><span class="lineno">11097</span>    <span class="keywordflow">return</span> response_length + init_skip;</div>
<div class="line"><span class="lineno">11098</span>}</div>
<div class="ttc" id="astructmg__response__info_html_ac1cdea9c63d8fac3ac4b8682441b1a5b"><div class="ttname"><a href="structmg__response__info.html#ac1cdea9c63d8fac3ac4b8682441b1a5b">mg_response_info::status_text</a></div><div class="ttdeci">const char * status_text</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00193">civetweb.h:193</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l07952">get_http_header_len()</a>, <a class="el" href="civetweb_8h_source.html#l00200">mg_response_info::http_headers</a>, <a class="el" href="civetweb_8h_source.html#l00194">mg_response_info::http_version</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00199">mg_response_info::num_headers</a>, <a class="el" href="civetweb_8c_source.html#l10725">parse_http_headers()</a>, <a class="el" href="civetweb_8c_source.html#l10680">skip_to_end_of_word_and_terminate()</a>, <a class="el" href="civetweb_8h_source.html#l00192">mg_response_info::status_code</a>, and <a class="el" href="civetweb_8h_source.html#l00193">mg_response_info::status_text</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18737">get_response()</a>.</p>

</div>
</div>
<a id="a917f041b64f1819b9bb4fd8a57e0d945" name="a917f041b64f1819b9bb4fd8a57e0d945"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a917f041b64f1819b9bb4fd8a57e0d945">&#9670;&#160;</a></span>parse_match_net()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_match_net </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structvec.html">vec</a> *</td>          <td class="paramname"><span class="paramname"><em>vec</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const union <a class="el" href="unionusa.html">usa</a> *</td>          <td class="paramname"><span class="paramname"><em>sa</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>no_strict</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l13966">13966</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">13967</span>{</div>
<div class="line"><span class="lineno">13968</span>    <span class="keywordtype">int</span> n;</div>
<div class="line"><span class="lineno">13969</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code hl_class" href="classa.html">a</a>, b, c, d, slash;</div>
<div class="line"><span class="lineno">13970</span> </div>
<div class="line"><span class="lineno">13971</span>    <span class="keywordflow">if</span> (sscanf(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <span class="stringliteral">&quot;%u.%u.%u.%u/%u%n&quot;</span>, &amp;<a class="code hl_class" href="classa.html">a</a>, &amp;b, &amp;c, &amp;d, &amp;slash, &amp;n)</div>
<div class="line"><span class="lineno">13972</span>        != 5) { <span class="comment">// NOLINT(cert-err34-c) &#39;sscanf&#39; used to convert a string to an</span></div>
<div class="line"><span class="lineno">13973</span>                <span class="comment">// integer value, but function will not report conversion</span></div>
<div class="line"><span class="lineno">13974</span>                <span class="comment">// errors; consider using &#39;strtol&#39; instead</span></div>
<div class="line"><span class="lineno">13975</span>        slash = 32;</div>
<div class="line"><span class="lineno">13976</span>        <span class="keywordflow">if</span> (sscanf(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <span class="stringliteral">&quot;%u.%u.%u.%u%n&quot;</span>, &amp;<a class="code hl_class" href="classa.html">a</a>, &amp;b, &amp;c, &amp;d, &amp;n)</div>
<div class="line"><span class="lineno">13977</span>            != 4) { <span class="comment">// NOLINT(cert-err34-c) &#39;sscanf&#39; used to convert a string to</span></div>
<div class="line"><span class="lineno">13978</span>                    <span class="comment">// an integer value, but function will not report conversion</span></div>
<div class="line"><span class="lineno">13979</span>                    <span class="comment">// errors; consider using &#39;strtol&#39; instead</span></div>
<div class="line"><span class="lineno">13980</span>            n = 0;</div>
<div class="line"><span class="lineno">13981</span>        }</div>
<div class="line"><span class="lineno">13982</span>    }</div>
<div class="line"><span class="lineno">13983</span> </div>
<div class="line"><span class="lineno">13984</span>    <span class="keywordflow">if</span> ((n &gt; 0) &amp;&amp; ((<span class="keywordtype">size_t</span>)n == <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>)) {</div>
<div class="line"><span class="lineno">13985</span>        <span class="keywordflow">if</span> ((<a class="code hl_class" href="classa.html">a</a> &lt; 256) &amp;&amp; (b &lt; 256) &amp;&amp; (c &lt; 256) &amp;&amp; (d &lt; 256) &amp;&amp; (slash &lt; 33)) {</div>
<div class="line"><span class="lineno">13986</span>            <span class="comment">/* IPv4 format */</span></div>
<div class="line"><span class="lineno">13987</span>            <span class="keywordflow">if</span> (sa-&gt;<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family == AF_INET) {</div>
<div class="line"><span class="lineno">13988</span>                uint32_t ip = ntohl(sa-&gt;<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_addr.s_addr);</div>
<div class="line"><span class="lineno">13989</span>                uint32_t net = ((uint32_t)<a class="code hl_class" href="classa.html">a</a> &lt;&lt; 24) | ((uint32_t)b &lt;&lt; 16)</div>
<div class="line"><span class="lineno">13990</span>                               | ((uint32_t)c &lt;&lt; 8) | (uint32_t)d;</div>
<div class="line"><span class="lineno">13991</span>                uint32_t <a class="code hl_define" href="lua-5_82_84_2src_2lbitlib_8c.html#abf7fe2b204d1bc5e49c9d36ad9447be7">mask</a> = slash ? (0xFFFFFFFFu &lt;&lt; (32 - slash)) : 0;</div>
<div class="line"><span class="lineno">13992</span>                <span class="keywordflow">return</span> (ip &amp; <a class="code hl_define" href="lua-5_82_84_2src_2lbitlib_8c.html#abf7fe2b204d1bc5e49c9d36ad9447be7">mask</a>) == net;</div>
<div class="line"><span class="lineno">13993</span>            }</div>
<div class="line"><span class="lineno">13994</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">13995</span>        }</div>
<div class="line"><span class="lineno">13996</span>    }</div>
<div class="line"><span class="lineno">13997</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">13998</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">13999</span>        <span class="keywordtype">char</span> ad[50];</div>
<div class="line"><span class="lineno">14000</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *p;</div>
<div class="line"><span class="lineno">14001</span> </div>
<div class="line"><span class="lineno">14002</span>        <span class="keywordflow">if</span> (sscanf(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <span class="stringliteral">&quot;[%49[^]]]/%u%n&quot;</span>, ad, &amp;slash, &amp;n) != 2) {</div>
<div class="line"><span class="lineno">14003</span>            slash = 128;</div>
<div class="line"><span class="lineno">14004</span>            <span class="keywordflow">if</span> (sscanf(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <span class="stringliteral">&quot;[%49[^]]]%n&quot;</span>, ad, &amp;n) != 1) {</div>
<div class="line"><span class="lineno">14005</span>                n = 0;</div>
<div class="line"><span class="lineno">14006</span>            }</div>
<div class="line"><span class="lineno">14007</span>        }</div>
<div class="line"><span class="lineno">14008</span> </div>
<div class="line"><span class="lineno">14009</span>        <span class="keywordflow">if</span> ((n &lt;= 0) &amp;&amp; no_strict) {</div>
<div class="line"><span class="lineno">14010</span>            <span class="comment">/* no square brackets? */</span></div>
<div class="line"><span class="lineno">14011</span>            p = strchr(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">14012</span>            <span class="keywordflow">if</span> (p &amp;&amp; (p &lt; (<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> + <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>))) {</div>
<div class="line"><span class="lineno">14013</span>                <span class="keywordflow">if</span> (((<span class="keywordtype">size_t</span>)(p - <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>) &lt; <span class="keyword">sizeof</span>(ad))</div>
<div class="line"><span class="lineno">14014</span>                    &amp;&amp; (sscanf(p, <span class="stringliteral">&quot;/%u%n&quot;</span>, &amp;slash, &amp;n) == 1)) {</div>
<div class="line"><span class="lineno">14015</span>                    n += (int)(p - <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>);</div>
<div class="line"><span class="lineno">14016</span>                    <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(ad, <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, (<span class="keywordtype">size_t</span>)(p - <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>) + 1);</div>
<div class="line"><span class="lineno">14017</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14018</span>                    n = 0;</div>
<div class="line"><span class="lineno">14019</span>                }</div>
<div class="line"><span class="lineno">14020</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> &lt; <span class="keyword">sizeof</span>(ad)) {</div>
<div class="line"><span class="lineno">14021</span>                n = (int)<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>;</div>
<div class="line"><span class="lineno">14022</span>                slash = 128;</div>
<div class="line"><span class="lineno">14023</span>                <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(ad, <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> + 1);</div>
<div class="line"><span class="lineno">14024</span>            }</div>
<div class="line"><span class="lineno">14025</span>        }</div>
<div class="line"><span class="lineno">14026</span> </div>
<div class="line"><span class="lineno">14027</span>        <span class="keywordflow">if</span> ((n &gt; 0) &amp;&amp; ((<span class="keywordtype">size_t</span>)n == <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>) &amp;&amp; (slash &lt; 129)) {</div>
<div class="line"><span class="lineno">14028</span>            p = ad;</div>
<div class="line"><span class="lineno">14029</span>            c = 0;</div>
<div class="line"><span class="lineno">14030</span>            <span class="comment">/* zone indexes are unsupported, at least two colons are needed */</span></div>
<div class="line"><span class="lineno">14031</span>            <span class="keywordflow">while</span> (isxdigit((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*p) || (*p == <span class="charliteral">&#39;.&#39;</span>) || (*p == <span class="charliteral">&#39;:&#39;</span>)) {</div>
<div class="line"><span class="lineno">14032</span>                <span class="keywordflow">if</span> (*(p++) == <span class="charliteral">&#39;:&#39;</span>) {</div>
<div class="line"><span class="lineno">14033</span>                    c++;</div>
<div class="line"><span class="lineno">14034</span>                }</div>
<div class="line"><span class="lineno">14035</span>            }</div>
<div class="line"><span class="lineno">14036</span>            <span class="keywordflow">if</span> ((*p == <span class="charliteral">&#39;\0&#39;</span>) &amp;&amp; (c &gt;= 2)) {</div>
<div class="line"><span class="lineno">14037</span>                <span class="keyword">struct </span>sockaddr_in6 sin6;</div>
<div class="line"><span class="lineno">14038</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">14039</span> </div>
<div class="line"><span class="lineno">14040</span>                <span class="comment">/* for strict validation, an actual IPv6 argument is needed */</span></div>
<div class="line"><span class="lineno">14041</span>                <span class="keywordflow">if</span> (sa-&gt;<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family != AF_INET6) {</div>
<div class="line"><span class="lineno">14042</span>                    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">14043</span>                }</div>
<div class="line"><span class="lineno">14044</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="#a68fa0720ca91d2de27f7770afa229002">mg_inet_pton</a>(AF_INET6, ad, &amp;sin6, <span class="keyword">sizeof</span>(sin6), 0)) {</div>
<div class="line"><span class="lineno">14045</span>                    <span class="comment">/* IPv6 format */</span></div>
<div class="line"><span class="lineno">14046</span>                    <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) {</div>
<div class="line"><span class="lineno">14047</span>                        uint8_t ip = sa-&gt;sin6.sin6_addr.s6_addr[i];</div>
<div class="line"><span class="lineno">14048</span>                        uint8_t net = sin6.sin6_addr.s6_addr[i];</div>
<div class="line"><span class="lineno">14049</span>                        uint8_t <a class="code hl_define" href="lua-5_82_84_2src_2lbitlib_8c.html#abf7fe2b204d1bc5e49c9d36ad9447be7">mask</a> = 0;</div>
<div class="line"><span class="lineno">14050</span> </div>
<div class="line"><span class="lineno">14051</span>                        <span class="keywordflow">if</span> (8 * i + 8 &lt; slash) {</div>
<div class="line"><span class="lineno">14052</span>                            <a class="code hl_define" href="lua-5_82_84_2src_2lbitlib_8c.html#abf7fe2b204d1bc5e49c9d36ad9447be7">mask</a> = 0xFFu;</div>
<div class="line"><span class="lineno">14053</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (8 * i &lt; slash) {</div>
<div class="line"><span class="lineno">14054</span>                            <a class="code hl_define" href="lua-5_82_84_2src_2lbitlib_8c.html#abf7fe2b204d1bc5e49c9d36ad9447be7">mask</a> = (uint8_t)(0xFFu &lt;&lt; (8 * i + 8 - slash));</div>
<div class="line"><span class="lineno">14055</span>                        }</div>
<div class="line"><span class="lineno">14056</span>                        <span class="keywordflow">if</span> ((ip &amp; <a class="code hl_define" href="lua-5_82_84_2src_2lbitlib_8c.html#abf7fe2b204d1bc5e49c9d36ad9447be7">mask</a>) != net) {</div>
<div class="line"><span class="lineno">14057</span>                            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">14058</span>                        }</div>
<div class="line"><span class="lineno">14059</span>                    }</div>
<div class="line"><span class="lineno">14060</span>                    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">14061</span>                }</div>
<div class="line"><span class="lineno">14062</span>            }</div>
<div class="line"><span class="lineno">14063</span>        }</div>
<div class="line"><span class="lineno">14064</span>    }</div>
<div class="line"><span class="lineno">14065</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">14066</span>    (void)no_strict;</div>
<div class="line"><span class="lineno">14067</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">14068</span> </div>
<div class="line"><span class="lineno">14069</span>    <span class="comment">/* malformed */</span></div>
<div class="line"><span class="lineno">14070</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">14071</span>}</div>
<div class="ttc" id="alua-5_82_84_2src_2lbitlib_8c_html_abf7fe2b204d1bc5e49c9d36ad9447be7"><div class="ttname"><a href="lua-5_82_84_2src_2lbitlib_8c.html#abf7fe2b204d1bc5e49c9d36ad9447be7">mask</a></div><div class="ttdeci">#define mask(n)</div><div class="ttdef"><b>Definition</b> <a href="lua-5_82_84_2src_2lbitlib_8c_source.html#l00029">lua-5.2.4/src/lbitlib.c:29</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="lua-5_82_84_2src_2lbitlib_8c_source.html#l00029">mask</a>, <a class="el" href="civetweb_8c_source.html#l09246">mg_inet_pton()</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>, <a class="el" href="civetweb_8c_source.html#l01833">usa::sa</a>, and <a class="el" href="civetweb_8c_source.html#l01834">usa::sin</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16229">check_acl()</a>, and <a class="el" href="civetweb_8c_source.html#l14075">set_throttle()</a>.</p>

</div>
</div>
<a id="a7326cd5fb1c2444cbce208b8c7005581" name="a7326cd5fb1c2444cbce208b8c7005581"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7326cd5fb1c2444cbce208b8c7005581">&#9670;&#160;</a></span>parse_port_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_port_string </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structvec.html">vec</a> *</td>          <td class="paramname"><span class="paramname"><em>vec</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsocket.html">socket</a> *</td>          <td class="paramname"><span class="paramname"><em>so</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>ip_version</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l15501">15501</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">15502</span>{</div>
<div class="line"><span class="lineno">15503</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code hl_class" href="classa.html">a</a>, b, c, d;</div>
<div class="line"><span class="lineno">15504</span>    <span class="keywordtype">unsigned</span> port;</div>
<div class="line"><span class="lineno">15505</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> portUL;</div>
<div class="line"><span class="lineno">15506</span>    <span class="keywordtype">int</span> ch, len;</div>
<div class="line"><span class="lineno">15507</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *cb;</div>
<div class="line"><span class="lineno">15508</span>    <span class="keywordtype">char</span> *endptr;</div>
<div class="line"><span class="lineno">15509</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">15510</span>    <span class="keywordtype">char</span> buf[100] = {0};</div>
<div class="line"><span class="lineno">15511</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15512</span> </div>
<div class="line"><span class="lineno">15513</span>    <span class="comment">/* MacOS needs that. If we do not zero it, subsequent bind() will fail.</span></div>
<div class="line"><span class="lineno">15514</span><span class="comment">     * Also, all-zeroes in the socket address means binding to all addresses</span></div>
<div class="line"><span class="lineno">15515</span><span class="comment">     * for both IPv4 and IPv6 (INADDR_ANY and IN6ADDR_ANY_INIT). */</span></div>
<div class="line"><span class="lineno">15516</span>    memset(so, 0, <span class="keyword">sizeof</span>(*so));</div>
<div class="line"><span class="lineno">15517</span>    so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_family = AF_INET;</div>
<div class="line"><span class="lineno">15518</span>    *ip_version = 0;</div>
<div class="line"><span class="lineno">15519</span> </div>
<div class="line"><span class="lineno">15520</span>    <span class="comment">/* Initialize len as invalid. */</span></div>
<div class="line"><span class="lineno">15521</span>    port = 0;</div>
<div class="line"><span class="lineno">15522</span>    len = 0;</div>
<div class="line"><span class="lineno">15523</span> </div>
<div class="line"><span class="lineno">15524</span>    <span class="comment">/* Test for different ways to format this string */</span></div>
<div class="line"><span class="lineno">15525</span>    <span class="keywordflow">if</span> (sscanf(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>,</div>
<div class="line"><span class="lineno">15526</span>               <span class="stringliteral">&quot;%u.%u.%u.%u:%u%n&quot;</span>,</div>
<div class="line"><span class="lineno">15527</span>               &amp;<a class="code hl_class" href="classa.html">a</a>,</div>
<div class="line"><span class="lineno">15528</span>               &amp;b,</div>
<div class="line"><span class="lineno">15529</span>               &amp;c,</div>
<div class="line"><span class="lineno">15530</span>               &amp;d,</div>
<div class="line"><span class="lineno">15531</span>               &amp;port,</div>
<div class="line"><span class="lineno">15532</span>               &amp;len) <span class="comment">// NOLINT(cert-err34-c) &#39;sscanf&#39; used to convert a string</span></div>
<div class="line"><span class="lineno">15533</span>                     <span class="comment">// to an integer value, but function will not report</span></div>
<div class="line"><span class="lineno">15534</span>                     <span class="comment">// conversion errors; consider using &#39;strtol&#39; instead</span></div>
<div class="line"><span class="lineno">15535</span>        == 5) {</div>
<div class="line"><span class="lineno">15536</span>        <span class="comment">/* Bind to a specific IPv4 address, e.g. 192.168.1.5:8080 */</span></div>
<div class="line"><span class="lineno">15537</span>        so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_addr.s_addr =</div>
<div class="line"><span class="lineno">15538</span>            htonl((<a class="code hl_class" href="classa.html">a</a> &lt;&lt; 24) | (b &lt;&lt; 16) | (c &lt;&lt; 8) | d);</div>
<div class="line"><span class="lineno">15539</span>        so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_port = htons((uint16_t)port);</div>
<div class="line"><span class="lineno">15540</span>        *ip_version = 4;</div>
<div class="line"><span class="lineno">15541</span> </div>
<div class="line"><span class="lineno">15542</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">15543</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sscanf(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <span class="stringliteral">&quot;[%49[^]]]:%u%n&quot;</span>, buf, &amp;port, &amp;len) == 2</div>
<div class="line"><span class="lineno">15544</span>               &amp;&amp; ((<span class="keywordtype">size_t</span>)len &lt;= vec-&gt;len)</div>
<div class="line"><span class="lineno">15545</span>               &amp;&amp; <a class="code hl_function" href="#a68fa0720ca91d2de27f7770afa229002">mg_inet_pton</a>(</div>
<div class="line"><span class="lineno">15546</span>                      AF_INET6, buf, &amp;so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sin6, <span class="keyword">sizeof</span>(so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sin6), 0)) {</div>
<div class="line"><span class="lineno">15547</span>        <span class="comment">/* IPv6 address, examples: see above */</span></div>
<div class="line"><span class="lineno">15548</span>        <span class="comment">/* so-&gt;lsa.sin6.sin6_family = AF_INET6; already set by mg_inet_pton</span></div>
<div class="line"><span class="lineno">15549</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">15550</span>        so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sin6.sin6_port = htons((uint16_t)port);</div>
<div class="line"><span class="lineno">15551</span>        *ip_version = 6;</div>
<div class="line"><span class="lineno">15552</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15553</span> </div>
<div class="line"><span class="lineno">15554</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>[0] == <span class="charliteral">&#39;+&#39;</span>)</div>
<div class="line"><span class="lineno">15555</span>               &amp;&amp; (sscanf(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> + 1, <span class="stringliteral">&quot;%u%n&quot;</span>, &amp;port, &amp;len)</div>
<div class="line"><span class="lineno">15556</span>                   == 1)) { <span class="comment">// NOLINT(cert-err34-c) &#39;sscanf&#39; used to convert a</span></div>
<div class="line"><span class="lineno">15557</span>                            <span class="comment">// string to an integer value, but function will not</span></div>
<div class="line"><span class="lineno">15558</span>                            <span class="comment">// report conversion errors; consider using &#39;strtol&#39;</span></div>
<div class="line"><span class="lineno">15559</span>                            <span class="comment">// instead</span></div>
<div class="line"><span class="lineno">15560</span> </div>
<div class="line"><span class="lineno">15561</span>        <span class="comment">/* Port is specified with a +, bind to IPv6 and IPv4, INADDR_ANY */</span></div>
<div class="line"><span class="lineno">15562</span>        <span class="comment">/* Add 1 to len for the + character we skipped before */</span></div>
<div class="line"><span class="lineno">15563</span>        len++;</div>
<div class="line"><span class="lineno">15564</span> </div>
<div class="line"><span class="lineno">15565</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">15566</span>        <span class="comment">/* Set socket family to IPv6, do not use IPV6_V6ONLY */</span></div>
<div class="line"><span class="lineno">15567</span>        so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sin6.sin6_family = AF_INET6;</div>
<div class="line"><span class="lineno">15568</span>        so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sin6.sin6_port = htons((uint16_t)port);</div>
<div class="line"><span class="lineno">15569</span>        *ip_version = 4 + 6;</div>
<div class="line"><span class="lineno">15570</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">15571</span>        <span class="comment">/* Bind to IPv4 only, since IPv6 is not built in. */</span></div>
<div class="line"><span class="lineno">15572</span>        so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_port = htons((uint16_t)port);</div>
<div class="line"><span class="lineno">15573</span>        *ip_version = 4;</div>
<div class="line"><span class="lineno">15574</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15575</span> </div>
<div class="line"><span class="lineno">15576</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="#ab0cba7d970883b21a4db625c33cba9ac">is_valid_port</a>(portUL = strtoul(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, &amp;endptr, 0))</div>
<div class="line"><span class="lineno">15577</span>               &amp;&amp; (<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> != endptr)) {</div>
<div class="line"><span class="lineno">15578</span>        len = (int)(endptr - <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>);</div>
<div class="line"><span class="lineno">15579</span>        port = (uint16_t)portUL;</div>
<div class="line"><span class="lineno">15580</span>        <span class="comment">/* If only port is specified, bind to IPv4, INADDR_ANY */</span></div>
<div class="line"><span class="lineno">15581</span>        so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_port = htons((uint16_t)port);</div>
<div class="line"><span class="lineno">15582</span>        *ip_version = 4;</div>
<div class="line"><span class="lineno">15583</span> </div>
<div class="line"><span class="lineno">15584</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((cb = strchr(<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <span class="charliteral">&#39;:&#39;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">15585</span>        <span class="comment">/* String could be a hostname. This check algorithm</span></div>
<div class="line"><span class="lineno">15586</span><span class="comment">         * will only work for RFC 952 compliant hostnames,</span></div>
<div class="line"><span class="lineno">15587</span><span class="comment">         * starting with a letter, containing only letters,</span></div>
<div class="line"><span class="lineno">15588</span><span class="comment">         * digits and hyphen (&#39;-&#39;). Newer specs may allow</span></div>
<div class="line"><span class="lineno">15589</span><span class="comment">         * more, but this is not guaranteed here, since it</span></div>
<div class="line"><span class="lineno">15590</span><span class="comment">         * may interfere with rules for port option lists. */</span></div>
<div class="line"><span class="lineno">15591</span> </div>
<div class="line"><span class="lineno">15592</span>        <span class="comment">/* According to RFC 1035, hostnames are restricted to 255 characters</span></div>
<div class="line"><span class="lineno">15593</span><span class="comment">         * in total (63 between two dots). */</span></div>
<div class="line"><span class="lineno">15594</span>        <span class="keywordtype">char</span> hostname[256];</div>
<div class="line"><span class="lineno">15595</span>        <span class="keywordtype">size_t</span> hostnlen = (size_t)(cb - <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>);</div>
<div class="line"><span class="lineno">15596</span> </div>
<div class="line"><span class="lineno">15597</span>        <span class="keywordflow">if</span> ((hostnlen &gt;= <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>) || (hostnlen &gt;= <span class="keyword">sizeof</span>(hostname))) {</div>
<div class="line"><span class="lineno">15598</span>            <span class="comment">/* This would be invalid in any case */</span></div>
<div class="line"><span class="lineno">15599</span>            *ip_version = 0;</div>
<div class="line"><span class="lineno">15600</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">15601</span>        }</div>
<div class="line"><span class="lineno">15602</span> </div>
<div class="line"><span class="lineno">15603</span>        <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(hostname, <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, hostnlen + 1);</div>
<div class="line"><span class="lineno">15604</span> </div>
<div class="line"><span class="lineno">15605</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a68fa0720ca91d2de27f7770afa229002">mg_inet_pton</a>(</div>
<div class="line"><span class="lineno">15606</span>                AF_INET, hostname, &amp;so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>, <span class="keyword">sizeof</span>(so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>), 1)) {</div>
<div class="line"><span class="lineno">15607</span>            <span class="keywordflow">if</span> (sscanf(cb + 1, <span class="stringliteral">&quot;%u%n&quot;</span>, &amp;port, &amp;len)</div>
<div class="line"><span class="lineno">15608</span>                == 1) { <span class="comment">// NOLINT(cert-err34-c) &#39;sscanf&#39; used to convert a</span></div>
<div class="line"><span class="lineno">15609</span>                        <span class="comment">// string to an integer value, but function will not</span></div>
<div class="line"><span class="lineno">15610</span>                        <span class="comment">// report conversion errors; consider using &#39;strtol&#39;</span></div>
<div class="line"><span class="lineno">15611</span>                        <span class="comment">// instead</span></div>
<div class="line"><span class="lineno">15612</span>                *ip_version = 4;</div>
<div class="line"><span class="lineno">15613</span>                so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_port = htons((uint16_t)port);</div>
<div class="line"><span class="lineno">15614</span>                len += (int)(hostnlen + 1);</div>
<div class="line"><span class="lineno">15615</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15616</span>                len = 0;</div>
<div class="line"><span class="lineno">15617</span>            }</div>
<div class="line"><span class="lineno">15618</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">15619</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="#a68fa0720ca91d2de27f7770afa229002">mg_inet_pton</a>(AF_INET6,</div>
<div class="line"><span class="lineno">15620</span>                                hostname,</div>
<div class="line"><span class="lineno">15621</span>                                &amp;so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sin6,</div>
<div class="line"><span class="lineno">15622</span>                                <span class="keyword">sizeof</span>(so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sin6),</div>
<div class="line"><span class="lineno">15623</span>                                1)) {</div>
<div class="line"><span class="lineno">15624</span>            <span class="keywordflow">if</span> (sscanf(cb + 1, <span class="stringliteral">&quot;%u%n&quot;</span>, &amp;port, &amp;len) == 1) {</div>
<div class="line"><span class="lineno">15625</span>                *ip_version = 6;</div>
<div class="line"><span class="lineno">15626</span>                so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sin6.sin6_port = htons((uint16_t)port);</div>
<div class="line"><span class="lineno">15627</span>                len += (int)(hostnlen + 1);</div>
<div class="line"><span class="lineno">15628</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15629</span>                len = 0;</div>
<div class="line"><span class="lineno">15630</span>            }</div>
<div class="line"><span class="lineno">15631</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15632</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15633</span>            len = 0;</div>
<div class="line"><span class="lineno">15634</span>        }</div>
<div class="line"><span class="lineno">15635</span> </div>
<div class="line"><span class="lineno">15636</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno">15637</span> </div>
<div class="line"><span class="lineno">15638</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>[0] == <span class="charliteral">&#39;x&#39;</span>) {</div>
<div class="line"><span class="lineno">15639</span>        <span class="comment">/* unix (linux) domain socket */</span></div>
<div class="line"><span class="lineno">15640</span>        <span class="keywordflow">if</span> (<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> &lt; <span class="keyword">sizeof</span>(so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sun.sun_path)) {</div>
<div class="line"><span class="lineno">15641</span>            len = <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>;</div>
<div class="line"><span class="lineno">15642</span>            so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sun.sun_family = AF_UNIX;</div>
<div class="line"><span class="lineno">15643</span>            memset(so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sun.sun_path, 0, <span class="keyword">sizeof</span>(so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sun.sun_path));</div>
<div class="line"><span class="lineno">15644</span>            memcpy(so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.sun.sun_path, (<span class="keywordtype">char</span> *)<a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a> + 1, <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> - 1);</div>
<div class="line"><span class="lineno">15645</span>            port = 0;</div>
<div class="line"><span class="lineno">15646</span>            *ip_version = 99;</div>
<div class="line"><span class="lineno">15647</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15648</span>            <span class="comment">/* String too long */</span></div>
<div class="line"><span class="lineno">15649</span>            len = 0;</div>
<div class="line"><span class="lineno">15650</span>        }</div>
<div class="line"><span class="lineno">15651</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15652</span> </div>
<div class="line"><span class="lineno">15653</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15654</span>        <span class="comment">/* Parsing failure. */</span></div>
<div class="line"><span class="lineno">15655</span>        len = 0;</div>
<div class="line"><span class="lineno">15656</span>    }</div>
<div class="line"><span class="lineno">15657</span> </div>
<div class="line"><span class="lineno">15658</span>    <span class="comment">/* sscanf and the option splitting code ensure the following condition</span></div>
<div class="line"><span class="lineno">15659</span><span class="comment">     * Make sure the port is valid and vector ends with the port, &#39;s&#39; or &#39;r&#39; */</span></div>
<div class="line"><span class="lineno">15660</span>    <span class="keywordflow">if</span> ((len &gt; 0) &amp;&amp; <a class="code hl_function" href="#ab0cba7d970883b21a4db625c33cba9ac">is_valid_port</a>(port)</div>
<div class="line"><span class="lineno">15661</span>        &amp;&amp; (((<span class="keywordtype">size_t</span>)len == <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>) || (((<span class="keywordtype">size_t</span>)len + 1) == <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>))) {</div>
<div class="line"><span class="lineno">15662</span>        <span class="comment">/* Next character after the port number */</span></div>
<div class="line"><span class="lineno">15663</span>        ch = ((size_t)len &lt; vec-&gt;len) ? <a class="code hl_struct" href="structvec.html">vec</a>-&gt;<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>[len] : <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">15664</span>        so-&gt;<a class="code hl_variable" href="structsocket.html#a2d1d5b8ef7da25d5e7e666e023a9b733">is_ssl</a> = (ch == <span class="charliteral">&#39;s&#39;</span>);</div>
<div class="line"><span class="lineno">15665</span>        so-&gt;<a class="code hl_variable" href="structsocket.html#ab6adc40d94d436862c00b586f1455f5c">ssl_redir</a> = (ch == <span class="charliteral">&#39;r&#39;</span>);</div>
<div class="line"><span class="lineno">15666</span>        <span class="keywordflow">if</span> ((ch == <span class="charliteral">&#39;\0&#39;</span>) || (ch == <span class="charliteral">&#39;s&#39;</span>) || (ch == <span class="charliteral">&#39;r&#39;</span>)) {</div>
<div class="line"><span class="lineno">15667</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">15668</span>        }</div>
<div class="line"><span class="lineno">15669</span>    }</div>
<div class="line"><span class="lineno">15670</span> </div>
<div class="line"><span class="lineno">15671</span>    <span class="comment">/* Reset ip_version to 0 if there is an error */</span></div>
<div class="line"><span class="lineno">15672</span>    *ip_version = 0;</div>
<div class="line"><span class="lineno">15673</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">15674</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01906">socket::is_ssl</a>, <a class="el" href="civetweb_8c_source.html#l09239">is_valid_port()</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l09246">mg_inet_pton()</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>, <a class="el" href="civetweb_8c_source.html#l01834">usa::sin</a>, and <a class="el" href="civetweb_8c_source.html#l01907">socket::ssl_redir</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>.</p>

</div>
</div>
<a id="a96d4fe5a4a9ff4b964325c9d31c4b6c9" name="a96d4fe5a4a9ff4b964325c9d31c4b6c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96d4fe5a4a9ff4b964325c9d31c4b6c9">&#9670;&#160;</a></span>parse_range_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_range_header </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>header</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t *</td>          <td class="paramname"><span class="paramname"><em>a</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t *</td>          <td class="paramname"><span class="paramname"><em>b</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10169">10169</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10170</span>{</div>
<div class="line"><span class="lineno">10171</span>    <span class="keywordflow">return</span> sscanf(header,</div>
<div class="line"><span class="lineno">10172</span>                  <span class="stringliteral">&quot;bytes=%&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a> <span class="stringliteral">&quot;-%&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a>,</div>
<div class="line"><span class="lineno">10173</span>                  <a class="code hl_class" href="classa.html">a</a>,</div>
<div class="line"><span class="lineno">10174</span>                  b); <span class="comment">// NOLINT(cert-err34-c) &#39;sscanf&#39; used to convert a string</span></div>
<div class="line"><span class="lineno">10175</span>                      <span class="comment">// to an integer value, but function will not report</span></div>
<div class="line"><span class="lineno">10176</span>                      <span class="comment">// conversion errors; consider using &#39;strtol&#39; instead</span></div>
<div class="line"><span class="lineno">10177</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00926">INT64_FMT</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, and <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>.</p>

</div>
</div>
<a id="aa983f82b2ad0172f78ed1e9f6ba572f7" name="aa983f82b2ad0172f78ed1e9f6ba572f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa983f82b2ad0172f78ed1e9f6ba572f7">&#9670;&#160;</a></span>prepare_cgi_environment()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int prepare_cgi_environment </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>prog</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcgi__environment.html">cgi_environment</a> *</td>          <td class="paramname"><span class="paramname"><em>env</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>cgi_config_idx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l11354">11354</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">11358</span>{</div>
<div class="line"><span class="lineno">11359</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>;</div>
<div class="line"><span class="lineno">11360</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> var_vec;</div>
<div class="line"><span class="lineno">11361</span>    <span class="keywordtype">char</span> *p, src_addr[<a class="code hl_define" href="#a0563a85b179703339cbf223e7e1c0454">IP_ADDR_STR_LEN</a>], http_var_name[128];</div>
<div class="line"><span class="lineno">11362</span>    <span class="keywordtype">int</span> i, truncated, uri_len;</div>
<div class="line"><span class="lineno">11363</span> </div>
<div class="line"><span class="lineno">11364</span>    <span class="keywordflow">if</span> ((conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (prog == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (env == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">11365</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11366</span>    }</div>
<div class="line"><span class="lineno">11367</span> </div>
<div class="line"><span class="lineno">11368</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#ab989e492646d577c5a56590a6e3c9649">conn</a> = conn;</div>
<div class="line"><span class="lineno">11369</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#abf1a007fd15b6e6d7092202839292f9d">buflen</a> = <a class="code hl_define" href="#a53644ae929eff6501de3e13fb3bd2946">CGI_ENVIRONMENT_SIZE</a>;</div>
<div class="line"><span class="lineno">11370</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a54049366dbc26ddd8db927f66b0d9118">bufused</a> = 0;</div>
<div class="line"><span class="lineno">11371</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a19c455bdfd00e18939fa3ce987a54eb8">buf</a> = (<span class="keywordtype">char</span> *)<a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(env-&gt;<a class="code hl_variable" href="structcgi__environment.html#abf1a007fd15b6e6d7092202839292f9d">buflen</a>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">11372</span>    <span class="keywordflow">if</span> (env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a19c455bdfd00e18939fa3ce987a54eb8">buf</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11373</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">11374</span>                        <span class="stringliteral">&quot;%s: Not enough memory for environmental buffer&quot;</span>,</div>
<div class="line"><span class="lineno">11375</span>                        __func__);</div>
<div class="line"><span class="lineno">11376</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11377</span>    }</div>
<div class="line"><span class="lineno">11378</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#ad3724e579f49ba25d08ee2fdfba31053">varlen</a> = <a class="code hl_define" href="#aa127b5e878621ba653b669c8be6318b1">MAX_CGI_ENVIR_VARS</a>;</div>
<div class="line"><span class="lineno">11379</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a968130be6483eed2654a5d8822d0c898">varused</a> = 0;</div>
<div class="line"><span class="lineno">11380</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a4db192a38f1b3687d0e891005c01f41d">var</a> =</div>
<div class="line"><span class="lineno">11381</span>        (<span class="keywordtype">char</span> **)<a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(env-&gt;<a class="code hl_variable" href="structcgi__environment.html#ad3724e579f49ba25d08ee2fdfba31053">varlen</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *), conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">11382</span>    <span class="keywordflow">if</span> (env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a4db192a38f1b3687d0e891005c01f41d">var</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11383</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">11384</span>                        <span class="stringliteral">&quot;%s: Not enough memory for environmental variables&quot;</span>,</div>
<div class="line"><span class="lineno">11385</span>                        __func__);</div>
<div class="line"><span class="lineno">11386</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a19c455bdfd00e18939fa3ce987a54eb8">buf</a>);</div>
<div class="line"><span class="lineno">11387</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11388</span>    }</div>
<div class="line"><span class="lineno">11389</span> </div>
<div class="line"><span class="lineno">11390</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;SERVER_NAME=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>]);</div>
<div class="line"><span class="lineno">11391</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;SERVER_ROOT=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>]);</div>
<div class="line"><span class="lineno">11392</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;DOCUMENT_ROOT=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>]);</div>
<div class="line"><span class="lineno">11393</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;SERVER_SOFTWARE=CivetWeb/%s&quot;</span>, <a class="code hl_function" href="#a057ebd236dc84e6e8f6c9765da609329">mg_version</a>());</div>
<div class="line"><span class="lineno">11394</span> </div>
<div class="line"><span class="lineno">11395</span>    <span class="comment">/* Prepare the environment block */</span></div>
<div class="line"><span class="lineno">11396</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;GATEWAY_INTERFACE=CGI/1.1&quot;</span>);</div>
<div class="line"><span class="lineno">11397</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;SERVER_PROTOCOL=HTTP/1.1&quot;</span>);</div>
<div class="line"><span class="lineno">11398</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;REDIRECT_STATUS=200&quot;</span>); <span class="comment">/* For PHP */</span></div>
<div class="line"><span class="lineno">11399</span> </div>
<div class="line"><span class="lineno">11400</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;SERVER_PORT=%d&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a0edacbaca9b971ced5f00a7dfae06165">server_port</a>);</div>
<div class="line"><span class="lineno">11401</span> </div>
<div class="line"><span class="lineno">11402</span>    <a class="code hl_function" href="#a043f416da5d5ec0b9a0f39e7a34250c2">sockaddr_to_string</a>(src_addr, <span class="keyword">sizeof</span>(src_addr), &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#afe3a45fe832ca19cc85299b9a96d8feb">rsa</a>);</div>
<div class="line"><span class="lineno">11403</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;REMOTE_ADDR=%s&quot;</span>, src_addr);</div>
<div class="line"><span class="lineno">11404</span> </div>
<div class="line"><span class="lineno">11405</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;REQUEST_METHOD=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>);</div>
<div class="line"><span class="lineno">11406</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;REMOTE_PORT=%d&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#af2a549c0b1db3ab0a0efe7861cc62e6a">remote_port</a>);</div>
<div class="line"><span class="lineno">11407</span> </div>
<div class="line"><span class="lineno">11408</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;REQUEST_URI=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a>);</div>
<div class="line"><span class="lineno">11409</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;LOCAL_URI=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno">11410</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;LOCAL_URI_RAW=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a>);</div>
<div class="line"><span class="lineno">11411</span> </div>
<div class="line"><span class="lineno">11412</span>    <span class="comment">/* SCRIPT_NAME */</span></div>
<div class="line"><span class="lineno">11413</span>    uri_len = (int)strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno">11414</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11415</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>[uri_len - 1] != <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno">11416</span>            <span class="comment">/* URI: /path_to_script/script.cgi */</span></div>
<div class="line"><span class="lineno">11417</span>            <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;SCRIPT_NAME=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno">11418</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11419</span>            <span class="comment">/* URI: /path_to_script/ ... using index.cgi */</span></div>
<div class="line"><span class="lineno">11420</span>            <span class="keyword">const</span> <span class="keywordtype">char</span> *index_file = strrchr(prog, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">11421</span>            <span class="keywordflow">if</span> (index_file) {</div>
<div class="line"><span class="lineno">11422</span>                <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env,</div>
<div class="line"><span class="lineno">11423</span>                       <span class="stringliteral">&quot;SCRIPT_NAME=%s%s&quot;</span>,</div>
<div class="line"><span class="lineno">11424</span>                       conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>,</div>
<div class="line"><span class="lineno">11425</span>                       index_file + 1);</div>
<div class="line"><span class="lineno">11426</span>            }</div>
<div class="line"><span class="lineno">11427</span>        }</div>
<div class="line"><span class="lineno">11428</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11429</span>        <span class="comment">/* URI: /path_to_script/script.cgi/path_info */</span></div>
<div class="line"><span class="lineno">11430</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env,</div>
<div class="line"><span class="lineno">11431</span>               <span class="stringliteral">&quot;SCRIPT_NAME=%.*s&quot;</span>,</div>
<div class="line"><span class="lineno">11432</span>               uri_len - (<span class="keywordtype">int</span>)strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a>),</div>
<div class="line"><span class="lineno">11433</span>               conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno">11434</span>    }</div>
<div class="line"><span class="lineno">11435</span> </div>
<div class="line"><span class="lineno">11436</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;SCRIPT_FILENAME=%s&quot;</span>, prog);</div>
<div class="line"><span class="lineno">11437</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11438</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;PATH_TRANSLATED=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>]);</div>
<div class="line"><span class="lineno">11439</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11440</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env,</div>
<div class="line"><span class="lineno">11441</span>               <span class="stringliteral">&quot;PATH_TRANSLATED=%s%s&quot;</span>,</div>
<div class="line"><span class="lineno">11442</span>               conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baaa2e945e2c233360f8a955eecb16cbed">DOCUMENT_ROOT</a>],</div>
<div class="line"><span class="lineno">11443</span>               conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a>);</div>
<div class="line"><span class="lineno">11444</span>    }</div>
<div class="line"><span class="lineno">11445</span> </div>
<div class="line"><span class="lineno">11446</span>    <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;HTTPS=%s&quot;</span>, (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? <span class="stringliteral">&quot;off&quot;</span> : <span class="stringliteral">&quot;on&quot;</span>);</div>
<div class="line"><span class="lineno">11447</span> </div>
<div class="line"><span class="lineno">11448</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Content-Type&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11449</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;CONTENT_TYPE=%s&quot;</span>, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno">11450</span>    }</div>
<div class="line"><span class="lineno">11451</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11452</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;QUERY_STRING=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>);</div>
<div class="line"><span class="lineno">11453</span>    }</div>
<div class="line"><span class="lineno">11454</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11455</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;CONTENT_LENGTH=%s&quot;</span>, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno">11456</span>    }</div>
<div class="line"><span class="lineno">11457</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = getenv(<span class="stringliteral">&quot;PATH&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11458</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;PATH=%s&quot;</span>, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno">11459</span>    }</div>
<div class="line"><span class="lineno">11460</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11461</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;PATH_INFO=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a>);</div>
<div class="line"><span class="lineno">11462</span>    }</div>
<div class="line"><span class="lineno">11463</span> </div>
<div class="line"><span class="lineno">11464</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> &gt; 0) {</div>
<div class="line"><span class="lineno">11465</span>        <span class="comment">/* CGI error handler should show the status code */</span></div>
<div class="line"><span class="lineno">11466</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;STATUS=%d&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a>);</div>
<div class="line"><span class="lineno">11467</span>    }</div>
<div class="line"><span class="lineno">11468</span> </div>
<div class="line"><span class="lineno">11469</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">11470</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = getenv(<span class="stringliteral">&quot;COMSPEC&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11471</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;COMSPEC=%s&quot;</span>, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno">11472</span>    }</div>
<div class="line"><span class="lineno">11473</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = getenv(<span class="stringliteral">&quot;SYSTEMROOT&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11474</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;SYSTEMROOT=%s&quot;</span>, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno">11475</span>    }</div>
<div class="line"><span class="lineno">11476</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = getenv(<span class="stringliteral">&quot;SystemDrive&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11477</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;SystemDrive=%s&quot;</span>, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno">11478</span>    }</div>
<div class="line"><span class="lineno">11479</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = getenv(<span class="stringliteral">&quot;ProgramFiles&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11480</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;ProgramFiles=%s&quot;</span>, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno">11481</span>    }</div>
<div class="line"><span class="lineno">11482</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = getenv(<span class="stringliteral">&quot;ProgramFiles(x86)&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11483</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;ProgramFiles(x86)=%s&quot;</span>, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno">11484</span>    }</div>
<div class="line"><span class="lineno">11485</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">11486</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = getenv(<span class="stringliteral">&quot;LD_LIBRARY_PATH&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11487</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;LD_LIBRARY_PATH=%s&quot;</span>, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno">11488</span>    }</div>
<div class="line"><span class="lineno">11489</span><span class="preprocessor">#endif </span><span class="comment">/* _WIN32 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">11490</span> </div>
<div class="line"><span class="lineno">11491</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = getenv(<span class="stringliteral">&quot;PERLLIB&quot;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11492</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;PERLLIB=%s&quot;</span>, <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>);</div>
<div class="line"><span class="lineno">11493</span>    }</div>
<div class="line"><span class="lineno">11494</span> </div>
<div class="line"><span class="lineno">11495</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11496</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;REMOTE_USER=%s&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a>);</div>
<div class="line"><span class="lineno">11497</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;AUTH_TYPE=Digest&quot;</span>);</div>
<div class="line"><span class="lineno">11498</span>    }</div>
<div class="line"><span class="lineno">11499</span> </div>
<div class="line"><span class="lineno">11500</span>    <span class="comment">/* Add all headers as HTTP_* variables */</span></div>
<div class="line"><span class="lineno">11501</span>    <span class="keywordflow">for</span> (i = 0; i &lt; conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a>; i++) {</div>
<div class="line"><span class="lineno">11502</span> </div>
<div class="line"><span class="lineno">11503</span>        (void)<a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">11504</span>                          &amp;truncated,</div>
<div class="line"><span class="lineno">11505</span>                          http_var_name,</div>
<div class="line"><span class="lineno">11506</span>                          <span class="keyword">sizeof</span>(http_var_name),</div>
<div class="line"><span class="lineno">11507</span>                          <span class="stringliteral">&quot;HTTP_%s&quot;</span>,</div>
<div class="line"><span class="lineno">11508</span>                          conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>[i].<a class="code hl_variable" href="structmg__header.html#ab91ffbf88fe154a963031e915adf8397">name</a>);</div>
<div class="line"><span class="lineno">11509</span> </div>
<div class="line"><span class="lineno">11510</span>        <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno">11511</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">11512</span>                            <span class="stringliteral">&quot;%s: HTTP header variable too long [%s]&quot;</span>,</div>
<div class="line"><span class="lineno">11513</span>                            __func__,</div>
<div class="line"><span class="lineno">11514</span>                            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>[i].<a class="code hl_variable" href="structmg__header.html#ab91ffbf88fe154a963031e915adf8397">name</a>);</div>
<div class="line"><span class="lineno">11515</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">11516</span>        }</div>
<div class="line"><span class="lineno">11517</span> </div>
<div class="line"><span class="lineno">11518</span>        <span class="comment">/* Convert variable name into uppercase, and change - to _ */</span></div>
<div class="line"><span class="lineno">11519</span>        <span class="keywordflow">for</span> (p = http_var_name; *p != <span class="charliteral">&#39;\0&#39;</span>; p++) {</div>
<div class="line"><span class="lineno">11520</span>            <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><span class="lineno">11521</span>                *p = <span class="charliteral">&#39;_&#39;</span>;</div>
<div class="line"><span class="lineno">11522</span>            }</div>
<div class="line"><span class="lineno">11523</span>            *p = (char)toupper((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*p);</div>
<div class="line"><span class="lineno">11524</span>        }</div>
<div class="line"><span class="lineno">11525</span> </div>
<div class="line"><span class="lineno">11526</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env,</div>
<div class="line"><span class="lineno">11527</span>               <span class="stringliteral">&quot;%s=%s&quot;</span>,</div>
<div class="line"><span class="lineno">11528</span>               http_var_name,</div>
<div class="line"><span class="lineno">11529</span>               conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a2337d14061022518280f4e647c72a20b">http_headers</a>[i].<a class="code hl_variable" href="structmg__header.html#a9cdd7ef80ee309a6de14684059081d0d">value</a>);</div>
<div class="line"><span class="lineno">11530</span>    }</div>
<div class="line"><span class="lineno">11531</span> </div>
<div class="line"><span class="lineno">11532</span>    <span class="comment">/* Add user-specified variables */</span></div>
<div class="line"><span class="lineno">11533</span>    <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba850b5c3820657d2b3a4d5a07c7c02616">CGI_ENVIRONMENT</a> + cgi_config_idx];</div>
<div class="line"><span class="lineno">11534</span>    <span class="keywordflow">while</span> ((<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = <a class="code hl_function" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a>(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, &amp;var_vec, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">11535</span>        <a class="code hl_function" href="#a4e93852e401067c198aca347441cb1a2">addenv</a>(env, <span class="stringliteral">&quot;%.*s&quot;</span>, (<span class="keywordtype">int</span>)var_vec.len, var_vec.ptr);</div>
<div class="line"><span class="lineno">11536</span>    }</div>
<div class="line"><span class="lineno">11537</span> </div>
<div class="line"><span class="lineno">11538</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a4db192a38f1b3687d0e891005c01f41d">var</a>[env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a968130be6483eed2654a5d8822d0c898">varused</a>] = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">11539</span>    env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a19c455bdfd00e18939fa3ce987a54eb8">buf</a>[env-&gt;<a class="code hl_variable" href="structcgi__environment.html#a54049366dbc26ddd8db927f66b0d9118">bufused</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">11540</span> </div>
<div class="line"><span class="lineno">11541</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">11542</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a4e93852e401067c198aca347441cb1a2"><div class="ttname"><a href="#a4e93852e401067c198aca347441cb1a2">addenv</a></div><div class="ttdeci">static void addenv(struct cgi_environment *env, PRINTF_FORMAT_STRING(const char *fmt),...) PRINTF_ARGS(2</div></div>
<div class="ttc" id="acivetweb_8c_html_aa127b5e878621ba653b669c8be6318b1"><div class="ttname"><a href="#aa127b5e878621ba653b669c8be6318b1">MAX_CGI_ENVIR_VARS</a></div><div class="ttdeci">#define MAX_CGI_ENVIR_VARS</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00493">civetweb.c:493</a></div></div>
<div class="ttc" id="astructmg__request__info_html_af2a549c0b1db3ab0a0efe7861cc62e6a"><div class="ttname"><a href="structmg__request__info.html#af2a549c0b1db3ab0a0efe7861cc62e6a">mg_request_info::remote_port</a></div><div class="ttdeci">int remote_port</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00170">civetweb.h:170</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#a4e93852e401067c198aca347441cb1a2">addenv()</a>, <a class="el" href="civetweb_8c_source.html#l01999">AUTHENTICATION_DOMAIN</a>, <a class="el" href="civetweb_8c_source.html#l11267">cgi_environment::buf</a>, <a class="el" href="civetweb_8c_source.html#l11268">cgi_environment::buflen</a>, <a class="el" href="civetweb_8c_source.html#l11269">cgi_environment::bufused</a>, <a class="el" href="civetweb_8c_source.html#l01960">CGI_ENVIRONMENT</a>, <a class="el" href="civetweb_8c_source.html#l00488">CGI_ENVIRONMENT_SIZE</a>, <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l11265">cgi_environment::conn</a>, <a class="el" href="civetweb_8c_source.html#l01954">DOCUMENT_ROOT</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8h_source.html#l00179">mg_request_info::http_headers</a>, <a class="el" href="civetweb_8c_source.html#l01732">IP_ADDR_STR_LEN</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8h_source.html#l00154">mg_request_info::local_uri_raw</a>, <a class="el" href="civetweb_8c_source.html#l00493">MAX_CGI_ENVIR_VARS</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8c_source.html#l01497">mg_malloc_ctx</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l03514">mg_version()</a>, <a class="el" href="civetweb_8h_source.html#l00144">mg_header::name</a>, <a class="el" href="civetweb_8c_source.html#l03899">next_option()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00178">mg_request_info::num_headers</a>, <a class="el" href="civetweb_8c_source.html#l02533">mg_connection::path_info</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>, <a class="el" href="civetweb_8h_source.html#l00162">mg_request_info::query_string</a>, <a class="el" href="civetweb_8h_source.html#l00170">mg_request_info::remote_port</a>, <a class="el" href="civetweb_8h_source.html#l00164">mg_request_info::remote_user</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>, <a class="el" href="civetweb_8c_source.html#l01905">socket::rsa</a>, <a class="el" href="multi_8h_source.html#l00318">s</a>, <a class="el" href="civetweb_8h_source.html#l00171">mg_request_info::server_port</a>, <a class="el" href="civetweb_8c_source.html#l03292">sockaddr_to_string()</a>, <a class="el" href="civetweb_8c_source.html#l02506">mg_connection::ssl</a>, <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>, <a class="el" href="civetweb_8h_source.html#l00145">mg_header::value</a>, <a class="el" href="civetweb_8c_source.html#l11271">cgi_environment::var</a>, <a class="el" href="civetweb_8c_source.html#l11272">cgi_environment::varlen</a>, and <a class="el" href="civetweb_8c_source.html#l11273">cgi_environment::varused</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>.</p>

</div>
</div>
<a id="a28aaebcd6e88f488e282f4f594119f8e" name="a28aaebcd6e88f488e282f4f594119f8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28aaebcd6e88f488e282f4f594119f8e">&#9670;&#160;</a></span>print_dav_dir_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int print_dav_dir_entry </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structde.html">de</a> *</td>          <td class="paramname"><span class="paramname"><em>de</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>data</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12745">12745</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12746</span>{</div>
<div class="line"><span class="lineno">12747</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *conn = (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)data;</div>
<div class="line"><span class="lineno">12748</span>    <span class="keywordflow">if</span> (!<a class="code hl_struct" href="structde.html">de</a> || !conn</div>
<div class="line"><span class="lineno">12749</span>        || !<a class="code hl_function" href="#ae5738d5648ed8e16019ec1c4f9976cc3">print_props</a>(</div>
<div class="line"><span class="lineno">12750</span>               conn, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>, <a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a>, &amp;<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>)) {</div>
<div class="line"><span class="lineno">12751</span>        <span class="comment">/* stop scan */</span></div>
<div class="line"><span class="lineno">12752</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">12753</span>    }</div>
<div class="line"><span class="lineno">12754</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">12755</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02579">de::file</a>, <a class="el" href="civetweb_8c_source.html#l02578">de::file_name</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8c_source.html#l12660">print_props()</a>, and <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12759">handle_propfind()</a>.</p>

</div>
</div>
<a id="a1178bc077d6f8483d04c6bc95c2a8324" name="a1178bc077d6f8483d04c6bc95c2a8324"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1178bc077d6f8483d04c6bc95c2a8324">&#9670;&#160;</a></span>print_dir_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int print_dir_entry </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structde.html">de</a> *</td>          <td class="paramname"><span class="paramname"><em>de</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09609">9609</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9610</span>{</div>
<div class="line"><span class="lineno"> 9611</span>    <span class="keywordtype">size_t</span> namesize, escsize, i;</div>
<div class="line"><span class="lineno"> 9612</span>    <span class="keywordtype">char</span> *href, *esc, *p;</div>
<div class="line"><span class="lineno"> 9613</span>    <span class="keywordtype">char</span> size[64], mod[64];</div>
<div class="line"><span class="lineno"> 9614</span><span class="preprocessor">#if defined(REENTRANT_TIME)</span></div>
<div class="line"><span class="lineno"> 9615</span>    <span class="keyword">struct </span>tm _tm;</div>
<div class="line"><span class="lineno"> 9616</span>    <span class="keyword">struct </span>tm *tm = &amp;_tm;</div>
<div class="line"><span class="lineno"> 9617</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 9618</span>    <span class="keyword">struct </span>tm *tm;</div>
<div class="line"><span class="lineno"> 9619</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9620</span> </div>
<div class="line"><span class="lineno"> 9621</span>    <span class="comment">/* Estimate worst case size for encoding and escaping */</span></div>
<div class="line"><span class="lineno"> 9622</span>    namesize = strlen(<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a>) + 1;</div>
<div class="line"><span class="lineno"> 9623</span>    escsize = <a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a>[strcspn(<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a>, <span class="stringliteral">&quot;&amp;&lt;&gt;&quot;</span>)] ? namesize * 5 : 0;</div>
<div class="line"><span class="lineno"> 9624</span>    href = (<span class="keywordtype">char</span> *)<a class="code hl_function" href="#a31c4ed6838b7bb49804a5ffa030762e5">mg_malloc</a>(namesize * 3 + escsize);</div>
<div class="line"><span class="lineno"> 9625</span>    <span class="keywordflow">if</span> (href == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9626</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 9627</span>    }</div>
<div class="line"><span class="lineno"> 9628</span>    <a class="code hl_function" href="#afec55bb47160c2d4fe76c5df4ce54f56">mg_url_encode</a>(<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a>, href, namesize * 3);</div>
<div class="line"><span class="lineno"> 9629</span>    esc = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno"> 9630</span>    <span class="keywordflow">if</span> (escsize &gt; 0) {</div>
<div class="line"><span class="lineno"> 9631</span>        <span class="comment">/* HTML escaping needed */</span></div>
<div class="line"><span class="lineno"> 9632</span>        esc = href + namesize * 3;</div>
<div class="line"><span class="lineno"> 9633</span>        <span class="keywordflow">for</span> (i = 0, p = esc; <a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a>[i]; i++, p += strlen(p)) {</div>
<div class="line"><span class="lineno"> 9634</span>            <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(p, <a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a> + i, 2);</div>
<div class="line"><span class="lineno"> 9635</span>            <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;&amp;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 9636</span>                strcpy(p, <span class="stringliteral">&quot;&amp;amp;&quot;</span>);</div>
<div class="line"><span class="lineno"> 9637</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;&lt;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 9638</span>                strcpy(p, <span class="stringliteral">&quot;&amp;lt;&quot;</span>);</div>
<div class="line"><span class="lineno"> 9639</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;&gt;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 9640</span>                strcpy(p, <span class="stringliteral">&quot;&amp;gt;&quot;</span>);</div>
<div class="line"><span class="lineno"> 9641</span>            }</div>
<div class="line"><span class="lineno"> 9642</span>        }</div>
<div class="line"><span class="lineno"> 9643</span>    }</div>
<div class="line"><span class="lineno"> 9644</span> </div>
<div class="line"><span class="lineno"> 9645</span>    <span class="keywordflow">if</span> (<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a>) {</div>
<div class="line"><span class="lineno"> 9646</span>        <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 9647</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* Buffer is big enough */</span></div>
<div class="line"><span class="lineno"> 9648</span>                    size,</div>
<div class="line"><span class="lineno"> 9649</span>                    <span class="keyword">sizeof</span>(size),</div>
<div class="line"><span class="lineno"> 9650</span>                    <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9651</span>                    <span class="stringliteral">&quot;[DIRECTORY]&quot;</span>);</div>
<div class="line"><span class="lineno"> 9652</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 9653</span>        <span class="comment">/* We use (signed) cast below because MSVC 6 compiler cannot</span></div>
<div class="line"><span class="lineno"> 9654</span><span class="comment">         * convert unsigned __int64 to double. Sigh. */</span></div>
<div class="line"><span class="lineno"> 9655</span>        <span class="keywordflow">if</span> (<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> &lt; 1024) {</div>
<div class="line"><span class="lineno"> 9656</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 9657</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* Buffer is big enough */</span></div>
<div class="line"><span class="lineno"> 9658</span>                        size,</div>
<div class="line"><span class="lineno"> 9659</span>                        <span class="keyword">sizeof</span>(size),</div>
<div class="line"><span class="lineno"> 9660</span>                        <span class="stringliteral">&quot;%d&quot;</span>,</div>
<div class="line"><span class="lineno"> 9661</span>                        (<span class="keywordtype">int</span>)<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a>);</div>
<div class="line"><span class="lineno"> 9662</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> &lt; 0x100000) {</div>
<div class="line"><span class="lineno"> 9663</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 9664</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* Buffer is big enough */</span></div>
<div class="line"><span class="lineno"> 9665</span>                        size,</div>
<div class="line"><span class="lineno"> 9666</span>                        <span class="keyword">sizeof</span>(size),</div>
<div class="line"><span class="lineno"> 9667</span>                        <span class="stringliteral">&quot;%.1fk&quot;</span>,</div>
<div class="line"><span class="lineno"> 9668</span>                        (<span class="keywordtype">double</span>)<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> / 1024.0);</div>
<div class="line"><span class="lineno"> 9669</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> &lt; 0x40000000) {</div>
<div class="line"><span class="lineno"> 9670</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 9671</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* Buffer is big enough */</span></div>
<div class="line"><span class="lineno"> 9672</span>                        size,</div>
<div class="line"><span class="lineno"> 9673</span>                        <span class="keyword">sizeof</span>(size),</div>
<div class="line"><span class="lineno"> 9674</span>                        <span class="stringliteral">&quot;%.1fM&quot;</span>,</div>
<div class="line"><span class="lineno"> 9675</span>                        (<span class="keywordtype">double</span>)<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> / 1048576);</div>
<div class="line"><span class="lineno"> 9676</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 9677</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 9678</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* Buffer is big enough */</span></div>
<div class="line"><span class="lineno"> 9679</span>                        size,</div>
<div class="line"><span class="lineno"> 9680</span>                        <span class="keyword">sizeof</span>(size),</div>
<div class="line"><span class="lineno"> 9681</span>                        <span class="stringliteral">&quot;%.1fG&quot;</span>,</div>
<div class="line"><span class="lineno"> 9682</span>                        (<span class="keywordtype">double</span>)<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> / 1073741824);</div>
<div class="line"><span class="lineno"> 9683</span>        }</div>
<div class="line"><span class="lineno"> 9684</span>    }</div>
<div class="line"><span class="lineno"> 9685</span> </div>
<div class="line"><span class="lineno"> 9686</span>    <span class="comment">/* Note: mg_snprintf will not cause a buffer overflow above.</span></div>
<div class="line"><span class="lineno"> 9687</span><span class="comment">     * So, string truncation checks are not required here. */</span></div>
<div class="line"><span class="lineno"> 9688</span> </div>
<div class="line"><span class="lineno"> 9689</span><span class="preprocessor">#if defined(REENTRANT_TIME)</span></div>
<div class="line"><span class="lineno"> 9690</span>    localtime_r(&amp;<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#aa767e15073ca34ce0bd9fdcfe05e6ddc">last_modified</a>, tm);</div>
<div class="line"><span class="lineno"> 9691</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 9692</span>    tm = localtime(&amp;<a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#aa767e15073ca34ce0bd9fdcfe05e6ddc">last_modified</a>);</div>
<div class="line"><span class="lineno"> 9693</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 9694</span>    <span class="keywordflow">if</span> (tm != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9695</span>        strftime(mod, <span class="keyword">sizeof</span>(mod), <span class="stringliteral">&quot;%d-%b-%Y %H:%M&quot;</span>, tm);</div>
<div class="line"><span class="lineno"> 9696</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 9697</span>        <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(mod, <span class="stringliteral">&quot;01-Jan-1970 00:00&quot;</span>, <span class="keyword">sizeof</span>(mod));</div>
<div class="line"><span class="lineno"> 9698</span>    }</div>
<div class="line"><span class="lineno"> 9699</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno"> 9700</span>              <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=\&quot;%s%s\&quot;&gt;%s%s&lt;/a&gt;&lt;/td&gt;&quot;</span></div>
<div class="line"><span class="lineno"> 9701</span>              <span class="stringliteral">&quot;&lt;td&gt;&amp;nbsp;%s&lt;/td&gt;&lt;td&gt;&amp;nbsp;&amp;nbsp;%s&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 9702</span>              href,</div>
<div class="line"><span class="lineno"> 9703</span>              <a class="code hl_struct" href="structde.html">de</a>-&gt;<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a> ? <span class="stringliteral">&quot;/&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno"> 9704</span>              esc ? esc : <a class="code hl_struct" href="structde.html">de</a>-&gt;file_name,</div>
<div class="line"><span class="lineno"> 9705</span>              <a class="code hl_struct" href="structde.html">de</a>-&gt;file.is_directory ? <span class="stringliteral">&quot;/&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno"> 9706</span>              mod,</div>
<div class="line"><span class="lineno"> 9707</span>              size);</div>
<div class="line"><span class="lineno"> 9708</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(href);</div>
<div class="line"><span class="lineno"> 9709</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9710</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02579">de::file</a>, <a class="el" href="civetweb_8c_source.html#l02578">de::file_name</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l01872">mg_file_stat::last_modified</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01474">mg_malloc()</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, <a class="el" href="civetweb_8c_source.html#l09581">mg_url_encode()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l01871">mg_file_stat::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>.</p>

</div>
</div>
<a id="ae5738d5648ed8e16019ec1c4f9976cc3" name="ae5738d5648ed8e16019ec1c4f9976cc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5738d5648ed8e16019ec1c4f9976cc3">&#9670;&#160;</a></span>print_props()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int print_props </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uri</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12660">12660</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12664</span>{</div>
<div class="line"><span class="lineno">12665</span>    <span class="keywordtype">size_t</span> i;</div>
<div class="line"><span class="lineno">12666</span>    <span class="keywordtype">char</span> mtime[64];</div>
<div class="line"><span class="lineno">12667</span>    <span class="keywordtype">char</span> link_buf[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a> * 2]; <span class="comment">/* Path + server root */</span></div>
<div class="line"><span class="lineno">12668</span>    <span class="keywordtype">char</span> *link_concat;</div>
<div class="line"><span class="lineno">12669</span>    <span class="keywordtype">size_t</span> link_concat_len;</div>
<div class="line"><span class="lineno">12670</span> </div>
<div class="line"><span class="lineno">12671</span>    <span class="keywordflow">if</span> ((conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (uri == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (filep == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">12672</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">12673</span>    }</div>
<div class="line"><span class="lineno">12674</span> </div>
<div class="line"><span class="lineno">12675</span>    link_concat_len = strlen(uri) + strlen(<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) + 1;</div>
<div class="line"><span class="lineno">12676</span>    link_concat = <a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(link_concat_len, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">12677</span>    <span class="keywordflow">if</span> (!link_concat) {</div>
<div class="line"><span class="lineno">12678</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">12679</span>    }</div>
<div class="line"><span class="lineno">12680</span>    strcpy(link_concat, uri);</div>
<div class="line"><span class="lineno">12681</span>    strcat(link_concat, <a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="lineno">12682</span> </div>
<div class="line"><span class="lineno">12683</span>    <span class="comment">/* Get full link used in request */</span></div>
<div class="line"><span class="lineno">12684</span>    <a class="code hl_function" href="#acb99501ab73e2f08414accf1a7d108c1">mg_construct_local_link</a>(</div>
<div class="line"><span class="lineno">12685</span>        conn, link_buf, <span class="keyword">sizeof</span>(link_buf), <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, link_concat);</div>
<div class="line"><span class="lineno">12686</span> </div>
<div class="line"><span class="lineno">12687</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">12688</span><span class="comment">    OutputDebugStringA(&quot;print_props:\n  uri: &quot;);</span></div>
<div class="line"><span class="lineno">12689</span><span class="comment">    OutputDebugStringA(uri);</span></div>
<div class="line"><span class="lineno">12690</span><span class="comment">    OutputDebugStringA(&quot;\n  name: &quot;);</span></div>
<div class="line"><span class="lineno">12691</span><span class="comment">    OutputDebugStringA(name);</span></div>
<div class="line"><span class="lineno">12692</span><span class="comment">    OutputDebugStringA(&quot;\n  link: &quot;);</span></div>
<div class="line"><span class="lineno">12693</span><span class="comment">    OutputDebugStringA(link_buf);</span></div>
<div class="line"><span class="lineno">12694</span><span class="comment">    OutputDebugStringA(&quot;\n&quot;);</span></div>
<div class="line"><span class="lineno">12695</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">12696</span> </div>
<div class="line"><span class="lineno">12697</span>    <a class="code hl_function" href="#a7ef6ebce89c81f7218a0968e3aa9107f">gmt_time_string</a>(mtime, <span class="keyword">sizeof</span>(mtime), &amp;filep-&gt;<a class="code hl_variable" href="structmg__file__stat.html#aa767e15073ca34ce0bd9fdcfe05e6ddc">last_modified</a>);</div>
<div class="line"><span class="lineno">12698</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">12699</span>              <span class="stringliteral">&quot;&lt;d:response&gt;&quot;</span></div>
<div class="line"><span class="lineno">12700</span>              <span class="stringliteral">&quot;&lt;d:href&gt;%s&lt;/d:href&gt;&quot;</span></div>
<div class="line"><span class="lineno">12701</span>              <span class="stringliteral">&quot;&lt;d:propstat&gt;&quot;</span></div>
<div class="line"><span class="lineno">12702</span>              <span class="stringliteral">&quot;&lt;d:prop&gt;&quot;</span></div>
<div class="line"><span class="lineno">12703</span>              <span class="stringliteral">&quot;&lt;d:resourcetype&gt;%s&lt;/d:resourcetype&gt;&quot;</span></div>
<div class="line"><span class="lineno">12704</span>              <span class="stringliteral">&quot;&lt;d:getcontentlength&gt;%&quot;</span> <a class="code hl_define" href="#a57e353d6ce48ab7d414d094961d5e474">INT64_FMT</a> <span class="stringliteral">&quot;&lt;/d:getcontentlength&gt;&quot;</span></div>
<div class="line"><span class="lineno">12705</span>              <span class="stringliteral">&quot;&lt;d:getlastmodified&gt;%s&lt;/d:getlastmodified&gt;&quot;</span></div>
<div class="line"><span class="lineno">12706</span>              <span class="stringliteral">&quot;&lt;d:lockdiscovery&gt;&quot;</span>,</div>
<div class="line"><span class="lineno">12707</span>              link_buf,</div>
<div class="line"><span class="lineno">12708</span>              filep-&gt;<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a> ? <span class="stringliteral">&quot;&lt;d:collection/&gt;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">12709</span>              filep-&gt;size,</div>
<div class="line"><span class="lineno">12710</span>              mtime);</div>
<div class="line"><span class="lineno">12711</span> </div>
<div class="line"><span class="lineno">12712</span>    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_define" href="#aec63256a14a3c1f92d2b8e01a466f718">NUM_WEBDAV_LOCKS</a>; i++) {</div>
<div class="line"><span class="lineno">12713</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structtwebdav__lock.html">twebdav_lock</a> *dav_lock = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#ad9abab27bb8fc8156d160de93bb08c30">webdav_lock</a>;</div>
<div class="line"><span class="lineno">12714</span>        <span class="keywordflow">if</span> (!strcmp(dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#a57e8e6294f2bf3d13b1497b474f7c5f8">path</a>, link_buf)) {</div>
<div class="line"><span class="lineno">12715</span>            <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">12716</span>                      <span class="stringliteral">&quot;&lt;d:activelock&gt;&quot;</span></div>
<div class="line"><span class="lineno">12717</span>                      <span class="stringliteral">&quot;&lt;d:locktype&gt;&lt;d:write/&gt;&lt;/d:locktype&gt;&quot;</span></div>
<div class="line"><span class="lineno">12718</span>                      <span class="stringliteral">&quot;&lt;d:lockscope&gt;&lt;d:exclusive/&gt;&lt;/d:lockscope&gt;&quot;</span></div>
<div class="line"><span class="lineno">12719</span>                      <span class="stringliteral">&quot;&lt;d:depth&gt;0&lt;/d:depth&gt;&quot;</span></div>
<div class="line"><span class="lineno">12720</span>                      <span class="stringliteral">&quot;&lt;d:owner&gt;%s&lt;/d:owner&gt;&quot;</span></div>
<div class="line"><span class="lineno">12721</span>                      <span class="stringliteral">&quot;&lt;d:timeout&gt;Second-%u&lt;/d:timeout&gt;&quot;</span></div>
<div class="line"><span class="lineno">12722</span>                      <span class="stringliteral">&quot;&lt;d:locktoken&gt;&quot;</span></div>
<div class="line"><span class="lineno">12723</span>                      <span class="stringliteral">&quot;&lt;d:href&gt;%s&lt;/d:href&gt;&quot;</span></div>
<div class="line"><span class="lineno">12724</span>                      <span class="stringliteral">&quot;&lt;/d:locktoken&gt;&quot;</span></div>
<div class="line"><span class="lineno">12725</span>                      <span class="stringliteral">&quot;&lt;/d:activelock&gt;\n&quot;</span>,</div>
<div class="line"><span class="lineno">12726</span>                      dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#a10c1b2873c201b3f14167a5c367d3366">user</a>,</div>
<div class="line"><span class="lineno">12727</span>                      (<span class="keywordtype">unsigned</span>)<a class="code hl_define" href="#a1531c1b87bf00f94782d1d45f2942803">LOCK_DURATION_S</a>,</div>
<div class="line"><span class="lineno">12728</span>                      dav_lock[i].<a class="code hl_variable" href="structtwebdav__lock.html#a40f964c56a8ec4f2397ab7f76f20850a">token</a>);</div>
<div class="line"><span class="lineno">12729</span>        }</div>
<div class="line"><span class="lineno">12730</span>    }</div>
<div class="line"><span class="lineno">12731</span> </div>
<div class="line"><span class="lineno">12732</span>    <a class="code hl_function" href="#accee9ed1fe40036abe9b36eac86b4121">mg_printf</a>(conn,</div>
<div class="line"><span class="lineno">12733</span>              <span class="stringliteral">&quot;&lt;/d:lockdiscovery&gt;&quot;</span></div>
<div class="line"><span class="lineno">12734</span>              <span class="stringliteral">&quot;&lt;/d:prop&gt;&quot;</span></div>
<div class="line"><span class="lineno">12735</span>              <span class="stringliteral">&quot;&lt;d:status&gt;HTTP/1.1 200 OK&lt;/d:status&gt;&quot;</span></div>
<div class="line"><span class="lineno">12736</span>              <span class="stringliteral">&quot;&lt;/d:propstat&gt;&quot;</span></div>
<div class="line"><span class="lineno">12737</span>              <span class="stringliteral">&quot;&lt;/d:response&gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">12738</span> </div>
<div class="line"><span class="lineno">12739</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(link_concat);</div>
<div class="line"><span class="lineno">12740</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">12741</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03341">gmt_time_string()</a>, <a class="el" href="civetweb_8c_source.html#l00926">INT64_FMT</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l01872">mg_file_stat::last_modified</a>, <a class="el" href="civetweb_8c_source.html#l02333">LOCK_DURATION_S</a>, <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01497">mg_malloc_ctx</a>, <a class="el" href="civetweb_8c_source.html#l07034">mg_printf()</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02330">NUM_WEBDAV_LOCKS</a>, <a class="el" href="civetweb_8c_source.html#l02340">twebdav_lock::path</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01871">mg_file_stat::size</a>, <a class="el" href="civetweb_8c_source.html#l02339">twebdav_lock::token</a>, <a class="el" href="civetweb_8c_source.html#l02341">twebdav_lock::user</a>, <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>, and <a class="el" href="civetweb_8c_source.html#l02408">mg_context::webdav_lock</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12759">handle_propfind()</a>, and <a class="el" href="civetweb_8c_source.html#l12745">print_dav_dir_entry()</a>.</p>

</div>
</div>
<a id="a00335d9fbef2e339b4ede6983b97b906" name="a00335d9fbef2e339b4ede6983b97b906"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00335d9fbef2e339b4ede6983b97b906">&#9670;&#160;</a></span>process_new_connection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void process_new_connection </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19368">19368</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19369</span>{</div>
<div class="line"><span class="lineno">19370</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__request__info.html">mg_request_info</a> *ri = &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>;</div>
<div class="line"><span class="lineno">19371</span>    <span class="keywordtype">int</span> keep_alive, discard_len;</div>
<div class="line"><span class="lineno">19372</span>    <span class="keywordtype">char</span> ebuf[100];</div>
<div class="line"><span class="lineno">19373</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *hostend;</div>
<div class="line"><span class="lineno">19374</span>    <span class="keywordtype">int</span> reqerr, uri_type;</div>
<div class="line"><span class="lineno">19375</span> </div>
<div class="line"><span class="lineno">19376</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">19377</span>    ptrdiff_t mcon = <a class="code hl_function" href="#ac84429c87794be46b88e30fbd3b0bcfa">mg_atomic_inc</a>(&amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;active_connections));</div>
<div class="line"><span class="lineno">19378</span>    mg_atomic_add(&amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;total_connections), 1);</div>
<div class="line"><span class="lineno">19379</span>    mg_atomic_max(&amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;max_active_connections), mcon);</div>
<div class="line"><span class="lineno">19380</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19381</span> </div>
<div class="line"><span class="lineno">19382</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Start processing connection from %s&quot;</span>,</div>
<div class="line"><span class="lineno">19383</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#ab758e3630f43e1bd62c66311e3bf7a50">remote_addr</a>);</div>
<div class="line"><span class="lineno">19384</span> </div>
<div class="line"><span class="lineno">19385</span>    <span class="comment">/* Loop over multiple requests sent using the same connection</span></div>
<div class="line"><span class="lineno">19386</span><span class="comment">     * (while &quot;keep alive&quot;). */</span></div>
<div class="line"><span class="lineno">19387</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">19388</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;calling get_request (%i times for this connection)&quot;</span>,</div>
<div class="line"><span class="lineno">19389</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ad423caedb8c37f057f26a96153fd5e72">handled_requests</a> + 1);</div>
<div class="line"><span class="lineno">19390</span> </div>
<div class="line"><span class="lineno">19391</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">19392</span>        conn-&gt;conn_state = 3; <span class="comment">/* ready */</span></div>
<div class="line"><span class="lineno">19393</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19394</span> </div>
<div class="line"><span class="lineno">19395</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a6fa7879a104cf3bdc5ae2c901b354520">get_request</a>(conn, ebuf, <span class="keyword">sizeof</span>(ebuf), &amp;reqerr)) {</div>
<div class="line"><span class="lineno">19396</span>            <span class="comment">/* The request sent by the client could not be understood by</span></div>
<div class="line"><span class="lineno">19397</span><span class="comment">             * the server, or it was incomplete or a timeout. Send an</span></div>
<div class="line"><span class="lineno">19398</span><span class="comment">             * error message and close the connection. */</span></div>
<div class="line"><span class="lineno">19399</span>            <span class="keywordflow">if</span> (reqerr &gt; 0) {</div>
<div class="line"><span class="lineno">19400</span>                <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(ebuf[0] != <span class="charliteral">&#39;\0&#39;</span>);</div>
<div class="line"><span class="lineno">19401</span>                <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, reqerr, <span class="stringliteral">&quot;%s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">19402</span>            }</div>
<div class="line"><span class="lineno">19403</span> </div>
<div class="line"><span class="lineno">19404</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a>, <span class="stringliteral">&quot;1.0&quot;</span>)</div>
<div class="line"><span class="lineno">19405</span>                   &amp;&amp; strcmp(ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a>, <span class="stringliteral">&quot;1.1&quot;</span>)) {</div>
<div class="line"><span class="lineno">19406</span>            <span class="comment">/* HTTP/2 is not allowed here */</span></div>
<div class="line"><span class="lineno">19407</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">19408</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">19409</span>                        ebuf,</div>
<div class="line"><span class="lineno">19410</span>                        <span class="keyword">sizeof</span>(ebuf),</div>
<div class="line"><span class="lineno">19411</span>                        <span class="stringliteral">&quot;Bad HTTP version: [%s]&quot;</span>,</div>
<div class="line"><span class="lineno">19412</span>                        ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a>);</div>
<div class="line"><span class="lineno">19413</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 505, <span class="stringliteral">&quot;%s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">19414</span>        }</div>
<div class="line"><span class="lineno">19415</span> </div>
<div class="line"><span class="lineno">19416</span>        <span class="keywordflow">if</span> (ebuf[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno">19417</span>            uri_type = <a class="code hl_function" href="#a97c47a9a92a85f9cfbc1ae8a28738e2a">get_uri_type</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a>);</div>
<div class="line"><span class="lineno">19418</span>            <span class="keywordflow">switch</span> (uri_type) {</div>
<div class="line"><span class="lineno">19419</span>            <span class="keywordflow">case</span> 1:</div>
<div class="line"><span class="lineno">19420</span>                <span class="comment">/* Asterisk */</span></div>
<div class="line"><span class="lineno">19421</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a> = 0;</div>
<div class="line"><span class="lineno">19422</span>                <span class="comment">/* TODO: Deal with &#39;*&#39;. */</span></div>
<div class="line"><span class="lineno">19423</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">19424</span>            <span class="keywordflow">case</span> 2:</div>
<div class="line"><span class="lineno">19425</span>                <span class="comment">/* relative uri */</span></div>
<div class="line"><span class="lineno">19426</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a> =</div>
<div class="line"><span class="lineno">19427</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a>;</div>
<div class="line"><span class="lineno">19428</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">19429</span>            <span class="keywordflow">case</span> 3:</div>
<div class="line"><span class="lineno">19430</span>            <span class="keywordflow">case</span> 4:</div>
<div class="line"><span class="lineno">19431</span>                <span class="comment">/* absolute uri (with/without port) */</span></div>
<div class="line"><span class="lineno">19432</span>                hostend = <a class="code hl_function" href="#a1504707625c62644c0951b656110b102">get_rel_url_at_current_server</a>(</div>
<div class="line"><span class="lineno">19433</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a>, conn);</div>
<div class="line"><span class="lineno">19434</span>                <span class="keywordflow">if</span> (hostend) {</div>
<div class="line"><span class="lineno">19435</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a> = hostend;</div>
<div class="line"><span class="lineno">19436</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19437</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19438</span>                }</div>
<div class="line"><span class="lineno">19439</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">19440</span>            <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">19441</span>                <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno">19442</span>                            <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* No truncation check for ebuf */</span></div>
<div class="line"><span class="lineno">19443</span>                            ebuf,</div>
<div class="line"><span class="lineno">19444</span>                            <span class="keyword">sizeof</span>(ebuf),</div>
<div class="line"><span class="lineno">19445</span>                            <span class="stringliteral">&quot;Invalid URI&quot;</span>);</div>
<div class="line"><span class="lineno">19446</span>                <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 400, <span class="stringliteral">&quot;%s&quot;</span>, ebuf);</div>
<div class="line"><span class="lineno">19447</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19448</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">19449</span>            }</div>
<div class="line"><span class="lineno">19450</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a> =</div>
<div class="line"><span class="lineno">19451</span>                (<span class="keywordtype">char</span> *)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a>;</div>
<div class="line"><span class="lineno">19452</span>        }</div>
<div class="line"><span class="lineno">19453</span> </div>
<div class="line"><span class="lineno">19454</span>        <span class="keywordflow">if</span> (ebuf[0] != <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno">19455</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> = -1;</div>
<div class="line"><span class="lineno">19456</span> </div>
<div class="line"><span class="lineno">19457</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19458</span>            <span class="comment">/* HTTP/1 allows protocol upgrade */</span></div>
<div class="line"><span class="lineno">19459</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> = <a class="code hl_function" href="#a0b698a923a0e6fd848e0585cf2983d12">should_switch_to_protocol</a>(conn);</div>
<div class="line"><span class="lineno">19460</span> </div>
<div class="line"><span class="lineno">19461</span>            <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca3c3663fdf461dc9873cadc4a36b3a139">PROTOCOL_TYPE_HTTP2</a>) {</div>
<div class="line"><span class="lineno">19462</span>                <span class="comment">/* This will occur, if a HTTP/1.1 request should be upgraded</span></div>
<div class="line"><span class="lineno">19463</span><span class="comment">                 * to HTTP/2 - but not if HTTP/2 is negotiated using ALPN.</span></div>
<div class="line"><span class="lineno">19464</span><span class="comment">                 * Since most (all?) major browsers only support HTTP/2 using</span></div>
<div class="line"><span class="lineno">19465</span><span class="comment">                 * ALPN, this is hard to test and very low priority.</span></div>
<div class="line"><span class="lineno">19466</span><span class="comment">                 * Deactivate it (at least for now).</span></div>
<div class="line"><span class="lineno">19467</span><span class="comment">                 */</span></div>
<div class="line"><span class="lineno">19468</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> = <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a>;</div>
<div class="line"><span class="lineno">19469</span>            }</div>
<div class="line"><span class="lineno">19470</span>        }</div>
<div class="line"><span class="lineno">19471</span> </div>
<div class="line"><span class="lineno">19472</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;http: %s, error: %s&quot;</span>,</div>
<div class="line"><span class="lineno">19473</span>                    (ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a> ? ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a> : <span class="stringliteral">&quot;none&quot;</span>),</div>
<div class="line"><span class="lineno">19474</span>                    (ebuf[0] ? ebuf : <span class="stringliteral">&quot;none&quot;</span>));</div>
<div class="line"><span class="lineno">19475</span> </div>
<div class="line"><span class="lineno">19476</span>        <span class="keywordflow">if</span> (ebuf[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno">19477</span>            <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>) {</div>
<div class="line"><span class="lineno">19478</span> </div>
<div class="line"><span class="lineno">19479</span>                <span class="comment">/* handle request to local server */</span></div>
<div class="line"><span class="lineno">19480</span>                <a class="code hl_function" href="#ade0a4f4deaa6ce8cf91dcf0921cfde1d">handle_request_stat_log</a>(conn);</div>
<div class="line"><span class="lineno">19481</span> </div>
<div class="line"><span class="lineno">19482</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19483</span>                <span class="comment">/* TODO: handle non-local request (PROXY) */</span></div>
<div class="line"><span class="lineno">19484</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">19485</span>            }</div>
<div class="line"><span class="lineno">19486</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19487</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">19488</span>        }</div>
<div class="line"><span class="lineno">19489</span> </div>
<div class="line"><span class="lineno">19490</span>        <span class="comment">/* Response complete. Free header buffer */</span></div>
<div class="line"><span class="lineno">19491</span>        free_buffered_response_header_list(conn);</div>
<div class="line"><span class="lineno">19492</span> </div>
<div class="line"><span class="lineno">19493</span>        <span class="keywordflow">if</span> (ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">19494</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>((<span class="keywordtype">void</span> *)ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a>);</div>
<div class="line"><span class="lineno">19495</span>            <span class="comment">/* Important! When having connections with and without auth</span></div>
<div class="line"><span class="lineno">19496</span><span class="comment">             * would cause double free and then crash */</span></div>
<div class="line"><span class="lineno">19497</span>            ri-&gt;<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19498</span>        }</div>
<div class="line"><span class="lineno">19499</span> </div>
<div class="line"><span class="lineno">19500</span>        <span class="comment">/* NOTE(lsm): order is important here. should_keep_alive() call</span></div>
<div class="line"><span class="lineno">19501</span><span class="comment">         * is using parsed request, which will be invalid after</span></div>
<div class="line"><span class="lineno">19502</span><span class="comment">         * memmove&#39;s below.</span></div>
<div class="line"><span class="lineno">19503</span><span class="comment">         * Therefore, memorize should_keep_alive() result now for later</span></div>
<div class="line"><span class="lineno">19504</span><span class="comment">         * use in loop exit condition. */</span></div>
<div class="line"><span class="lineno">19505</span>        <span class="comment">/* Enable it only if this request is completely discardable. */</span></div>
<div class="line"><span class="lineno">19506</span>        keep_alive = <a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)</div>
<div class="line"><span class="lineno">19507</span>                     &amp;&amp; <a class="code hl_function" href="#a2f83db0ca198c57993fb3e3cd5e97500">should_keep_alive</a>(conn) &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> &gt;= 0)</div>
<div class="line"><span class="lineno">19508</span>                     &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> &gt; 0)</div>
<div class="line"><span class="lineno">19509</span>                     &amp;&amp; ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> == 4)</div>
<div class="line"><span class="lineno">19510</span>                         || (!conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a></div>
<div class="line"><span class="lineno">19511</span>                             &amp;&amp; ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a> == conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>)</div>
<div class="line"><span class="lineno">19512</span>                                 || ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> + conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>)</div>
<div class="line"><span class="lineno">19513</span>                                     &lt;= conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a>))))</div>
<div class="line"><span class="lineno">19514</span>                     &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a>);</div>
<div class="line"><span class="lineno">19515</span> </div>
<div class="line"><span class="lineno">19516</span>        <span class="keywordflow">if</span> (keep_alive) {</div>
<div class="line"><span class="lineno">19517</span>            <span class="comment">/* Discard all buffered data for this request */</span></div>
<div class="line"><span class="lineno">19518</span>            discard_len =</div>
<div class="line"><span class="lineno">19519</span>                ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> + conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>) &lt; conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a>)</div>
<div class="line"><span class="lineno">19520</span>                    ? (int)(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> + conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a>)</div>
<div class="line"><span class="lineno">19521</span>                    : conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a>;</div>
<div class="line"><span class="lineno">19522</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> -= discard_len;</div>
<div class="line"><span class="lineno">19523</span> </div>
<div class="line"><span class="lineno">19524</span>            <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> &gt; 0) {</div>
<div class="line"><span class="lineno">19525</span>                <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;discard_len = %d&quot;</span>, discard_len);</div>
<div class="line"><span class="lineno">19526</span>                memmove(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a>,</div>
<div class="line"><span class="lineno">19527</span>                        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a> + discard_len,</div>
<div class="line"><span class="lineno">19528</span>                        (<span class="keywordtype">size_t</span>)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a>);</div>
<div class="line"><span class="lineno">19529</span>            }</div>
<div class="line"><span class="lineno">19530</span>        }</div>
<div class="line"><span class="lineno">19531</span> </div>
<div class="line"><span class="lineno">19532</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> &gt;= 0);</div>
<div class="line"><span class="lineno">19533</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> &lt;= conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6033a47c6e89ad571ca65000ab53f07e">buf_size</a>);</div>
<div class="line"><span class="lineno">19534</span> </div>
<div class="line"><span class="lineno">19535</span>        <span class="keywordflow">if</span> ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> &lt; 0) || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a> &gt; conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6033a47c6e89ad571ca65000ab53f07e">buf_size</a>)) {</div>
<div class="line"><span class="lineno">19536</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;internal error: data_len = %li, buf_size = %li&quot;</span>,</div>
<div class="line"><span class="lineno">19537</span>                        (<span class="keywordtype">long</span> <span class="keywordtype">int</span>)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa88754208d93c23d110469696d935bdc">data_len</a>,</div>
<div class="line"><span class="lineno">19538</span>                        (<span class="keywordtype">long</span> <span class="keywordtype">int</span>)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6033a47c6e89ad571ca65000ab53f07e">buf_size</a>);</div>
<div class="line"><span class="lineno">19539</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">19540</span>        }</div>
<div class="line"><span class="lineno">19541</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ad423caedb8c37f057f26a96153fd5e72">handled_requests</a>++;</div>
<div class="line"><span class="lineno">19542</span>    } <span class="keywordflow">while</span> (keep_alive);</div>
<div class="line"><span class="lineno">19543</span> </div>
<div class="line"><span class="lineno">19544</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Done processing connection from %s (%f sec)&quot;</span>,</div>
<div class="line"><span class="lineno">19545</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#ab758e3630f43e1bd62c66311e3bf7a50">remote_addr</a>,</div>
<div class="line"><span class="lineno">19546</span>                difftime(time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), conn-&gt;<a class="code hl_variable" href="structmg__connection.html#acc800b7c744ad9f71401fae6048f6995">conn_birth_time</a>));</div>
<div class="line"><span class="lineno">19547</span> </div>
<div class="line"><span class="lineno">19548</span>    <a class="code hl_function" href="#af4b9971ca12d36d97d92dd7980059fb0">close_connection</a>(conn);</div>
<div class="line"><span class="lineno">19549</span> </div>
<div class="line"><span class="lineno">19550</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">19551</span>    mg_atomic_add(&amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;total_requests), conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ad423caedb8c37f057f26a96153fd5e72">handled_requests</a>);</div>
<div class="line"><span class="lineno">19552</span>    <a class="code hl_function" href="#a68810f97aa216df1fa96103dec93fca3">mg_atomic_dec</a>(&amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;active_connections));</div>
<div class="line"><span class="lineno">19553</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19554</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a0b698a923a0e6fd848e0585cf2983d12"><div class="ttname"><a href="#a0b698a923a0e6fd848e0585cf2983d12">should_switch_to_protocol</a></div><div class="ttdeci">static int should_switch_to_protocol(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l13912">civetweb.c:13912</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a6fa7879a104cf3bdc5ae2c901b354520"><div class="ttname"><a href="#a6fa7879a104cf3bdc5ae2c901b354520">get_request</a></div><div class="ttdeci">static int get_request(struct mg_connection *conn, char *ebuf, size_t ebuf_len, int *err)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l18645">civetweb.c:18645</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ade0a4f4deaa6ce8cf91dcf0921cfde1d"><div class="ttname"><a href="#ade0a4f4deaa6ce8cf91dcf0921cfde1d">handle_request_stat_log</a></div><div class="ttdeci">static void handle_request_stat_log(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06562">civetweb.c:6562</a></div></div>
<div class="ttc" id="astructmg__request__info_html_ab758e3630f43e1bd62c66311e3bf7a50"><div class="ttname"><a href="structmg__request__info.html#ab758e3630f43e1bd62c66311e3bf7a50">mg_request_info::remote_addr</a></div><div class="ttdeci">char remote_addr[48]</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00166">civetweb.h:166</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02532">mg_connection::buf</a>, <a class="el" href="civetweb_8c_source.html#l02556">mg_connection::buf_size</a>, <a class="el" href="civetweb_8c_source.html#l17864">close_connection()</a>, <a class="el" href="civetweb_8c_source.html#l02508">mg_connection::conn_birth_time</a>, <a class="el" href="civetweb_8c_source.html#l02524">mg_connection::consumed_content</a>, <a class="el" href="civetweb_8c_source.html#l02518">mg_connection::content_len</a>, <a class="el" href="civetweb_8c_source.html#l02558">mg_connection::data_len</a>, <a class="el" href="civetweb_8c_source.html#l00260">DEBUG_ASSERT</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l18465">get_rel_url_at_current_server()</a>, <a class="el" href="civetweb_8c_source.html#l18645">get_request()</a>, <a class="el" href="civetweb_8c_source.html#l18395">get_uri_type()</a>, <a class="el" href="civetweb_8c_source.html#l06562">handle_request_stat_log()</a>, <a class="el" href="civetweb_8c_source.html#l02554">mg_connection::handled_requests</a>, <a class="el" href="civetweb_8h_source.html#l00161">mg_request_info::http_version</a>, <a class="el" href="civetweb_8c_source.html#l02525">mg_connection::is_chunked</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8h_source.html#l00154">mg_request_info::local_uri_raw</a>, <a class="el" href="civetweb_8c_source.html#l01144">mg_atomic_dec()</a>, <a class="el" href="civetweb_8c_source.html#l01121">mg_atomic_inc()</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, <a class="el" href="civetweb_8c_source.html#l02466">PROTOCOL_TYPE_HTTP1</a>, <a class="el" href="civetweb_8c_source.html#l02468">PROTOCOL_TYPE_HTTP2</a>, <a class="el" href="civetweb_8h_source.html#l00166">mg_request_info::remote_addr</a>, <a class="el" href="civetweb_8h_source.html#l00164">mg_request_info::remote_user</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l02557">mg_connection::request_len</a>, <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>, <a class="el" href="civetweb_8c_source.html#l03984">should_keep_alive()</a>, <a class="el" href="civetweb_8c_source.html#l13912">should_switch_to_protocol()</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, and <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="abe51474dc2a44ce44de63053a1581ae8" name="abe51474dc2a44ce44de63053a1581ae8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe51474dc2a44ce44de63053a1581ae8">&#9670;&#160;</a></span>produce_socket()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void produce_socket </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structsocket.html">socket</a> *</td>          <td class="paramname"><span class="paramname"><em>sp</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19661">19661</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19662</span>{</div>
<div class="line"><span class="lineno">19663</span>    <span class="keywordtype">int</span> queue_filled;</div>
<div class="line"><span class="lineno">19664</span> </div>
<div class="line"><span class="lineno">19665</span>    (void)pthread_mutex_lock(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">thread_mutex</a>);</div>
<div class="line"><span class="lineno">19666</span> </div>
<div class="line"><span class="lineno">19667</span>    queue_filled = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a6df1d217787a1f213ddb9873f545d23f">sq_head</a> - ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">sq_tail</a>;</div>
<div class="line"><span class="lineno">19668</span> </div>
<div class="line"><span class="lineno">19669</span>    <span class="comment">/* If the queue is full, wait */</span></div>
<div class="line"><span class="lineno">19670</span>    <span class="keywordflow">while</span> (<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)</div>
<div class="line"><span class="lineno">19671</span>           &amp;&amp; (queue_filled &gt;= ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ae906ea24151aba96333859c9b759ccc1">sq_size</a>)) {</div>
<div class="line"><span class="lineno">19672</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#affbc1f904d30b616b26c9e9261ca4959">sq_blocked</a> = 1; <span class="comment">/* Status information: All threads busy */</span></div>
<div class="line"><span class="lineno">19673</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">19674</span>        <span class="keywordflow">if</span> (queue_filled &gt; ctx-&gt;sq_max_fill) {</div>
<div class="line"><span class="lineno">19675</span>            ctx-&gt;sq_max_fill = queue_filled;</div>
<div class="line"><span class="lineno">19676</span>        }</div>
<div class="line"><span class="lineno">19677</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19678</span>        (void)pthread_cond_wait(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a3260d5fc8e16e35026d7d2bbcb10abf5">sq_empty</a>, &amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">thread_mutex</a>);</div>
<div class="line"><span class="lineno">19679</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#affbc1f904d30b616b26c9e9261ca4959">sq_blocked</a> = 0; <span class="comment">/* Not blocked now */</span></div>
<div class="line"><span class="lineno">19680</span>        queue_filled = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a6df1d217787a1f213ddb9873f545d23f">sq_head</a> - ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">sq_tail</a>;</div>
<div class="line"><span class="lineno">19681</span>    }</div>
<div class="line"><span class="lineno">19682</span> </div>
<div class="line"><span class="lineno">19683</span>    <span class="keywordflow">if</span> (queue_filled &lt; ctx-&gt;sq_size) {</div>
<div class="line"><span class="lineno">19684</span>        <span class="comment">/* Copy socket to the queue and increment head */</span></div>
<div class="line"><span class="lineno">19685</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a49b598c1205bc368042ca530011e3316">squeue</a>[ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a6df1d217787a1f213ddb9873f545d23f">sq_head</a> % ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ae906ea24151aba96333859c9b759ccc1">sq_size</a>] = *sp;</div>
<div class="line"><span class="lineno">19686</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a6df1d217787a1f213ddb9873f545d23f">sq_head</a>++;</div>
<div class="line"><span class="lineno">19687</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;queued socket %d&quot;</span>, sp ? sp-&gt;<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a> : -1);</div>
<div class="line"><span class="lineno">19688</span>    }</div>
<div class="line"><span class="lineno">19689</span> </div>
<div class="line"><span class="lineno">19690</span>    queue_filled = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a6df1d217787a1f213ddb9873f545d23f">sq_head</a> - ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ad0b2da59bdd93d8eb819ef552025b654">sq_tail</a>;</div>
<div class="line"><span class="lineno">19691</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">19692</span>    <span class="keywordflow">if</span> (queue_filled &gt; ctx-&gt;sq_max_fill) {</div>
<div class="line"><span class="lineno">19693</span>        ctx-&gt;sq_max_fill = queue_filled;</div>
<div class="line"><span class="lineno">19694</span>    }</div>
<div class="line"><span class="lineno">19695</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19696</span> </div>
<div class="line"><span class="lineno">19697</span>    (void)pthread_cond_signal(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aad49398eacc039c312d58c55530c65fa">sq_full</a>);</div>
<div class="line"><span class="lineno">19698</span>    (void)pthread_mutex_unlock(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a95d32beab46e554567d9ebaab7a6b2f2">thread_mutex</a>);</div>
<div class="line"><span class="lineno">19699</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, <a class="el" href="civetweb_8c_source.html#l02393">mg_context::sq_blocked</a>, <a class="el" href="civetweb_8c_source.html#l02392">mg_context::sq_empty</a>, <a class="el" href="civetweb_8c_source.html#l02391">mg_context::sq_full</a>, <a class="el" href="civetweb_8c_source.html#l02389">mg_context::sq_head</a>, <a class="el" href="civetweb_8c_source.html#l02394">mg_context::sq_size</a>, <a class="el" href="civetweb_8c_source.html#l02390">mg_context::sq_tail</a>, <a class="el" href="civetweb_8c_source.html#l02387">mg_context::squeue</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>, and <a class="el" href="civetweb_8c_source.html#l02374">mg_context::thread_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>.</p>

</div>
</div>
<a id="a807c2737d59afedd4cc79747f416ea42" name="a807c2737d59afedd4cc79747f416ea42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a807c2737d59afedd4cc79747f416ea42">&#9670;&#160;</a></span>pull_all()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int pull_all </td>
          <td>(</td>
          <td class="paramtype">FILE *</td>          <td class="paramname"><span class="paramname"><em>fp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>len</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06439">6439</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6440</span>{</div>
<div class="line"><span class="lineno"> 6441</span>    <span class="keywordtype">int</span> n, nread = 0;</div>
<div class="line"><span class="lineno"> 6442</span>    <span class="keywordtype">double</span> timeout = -1.0;</div>
<div class="line"><span class="lineno"> 6443</span>    uint64_t start_time = 0, now = 0, timeout_ns = 0;</div>
<div class="line"><span class="lineno"> 6444</span> </div>
<div class="line"><span class="lineno"> 6445</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>]) {</div>
<div class="line"><span class="lineno"> 6446</span>        timeout = atoi(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>]) / 1000.0;</div>
<div class="line"><span class="lineno"> 6447</span>    }</div>
<div class="line"><span class="lineno"> 6448</span>    <span class="keywordflow">if</span> (timeout &lt;= 0.0) {</div>
<div class="line"><span class="lineno"> 6449</span>        timeout = strtod(<a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>].default_value, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno"> 6450</span>                  / 1000.0;</div>
<div class="line"><span class="lineno"> 6451</span>    }</div>
<div class="line"><span class="lineno"> 6452</span>    start_time = <a class="code hl_function" href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a>();</div>
<div class="line"><span class="lineno"> 6453</span>    timeout_ns = (uint64_t)(timeout * 1.0E9);</div>
<div class="line"><span class="lineno"> 6454</span> </div>
<div class="line"><span class="lineno"> 6455</span>    <span class="keywordflow">while</span> ((len &gt; 0) &amp;&amp; <a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno"> 6456</span>        n = <a class="code hl_function" href="#a57991f1957263ffb56e7411155766204">pull_inner</a>(fp, conn, buf + nread, len, timeout);</div>
<div class="line"><span class="lineno"> 6457</span>        <span class="keywordflow">if</span> (n == -2) {</div>
<div class="line"><span class="lineno"> 6458</span>            <span class="keywordflow">if</span> (nread == 0) {</div>
<div class="line"><span class="lineno"> 6459</span>                nread = -1; <span class="comment">/* Propagate the error */</span></div>
<div class="line"><span class="lineno"> 6460</span>            }</div>
<div class="line"><span class="lineno"> 6461</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 6462</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n == -1) {</div>
<div class="line"><span class="lineno"> 6463</span>            <span class="comment">/* timeout */</span></div>
<div class="line"><span class="lineno"> 6464</span>            <span class="keywordflow">if</span> (timeout &gt;= 0.0) {</div>
<div class="line"><span class="lineno"> 6465</span>                now = <a class="code hl_function" href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a>();</div>
<div class="line"><span class="lineno"> 6466</span>                <span class="keywordflow">if</span> ((now - start_time) &lt;= timeout_ns) {</div>
<div class="line"><span class="lineno"> 6467</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 6468</span>                }</div>
<div class="line"><span class="lineno"> 6469</span>            }</div>
<div class="line"><span class="lineno"> 6470</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 6471</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n == 0) {</div>
<div class="line"><span class="lineno"> 6472</span>            <span class="keywordflow">break</span>; <span class="comment">/* No more data to read */</span></div>
<div class="line"><span class="lineno"> 6473</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6474</span>            nread += n;</div>
<div class="line"><span class="lineno"> 6475</span>            len -= n;</div>
<div class="line"><span class="lineno"> 6476</span>        }</div>
<div class="line"><span class="lineno"> 6477</span>    }</div>
<div class="line"><span class="lineno"> 6478</span> </div>
<div class="line"><span class="lineno"> 6479</span>    <span class="keywordflow">return</span> nread;</div>
<div class="line"><span class="lineno"> 6480</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01676">mg_get_current_time_ns()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l06210">pull_inner()</a>, <a class="el" href="civetweb_8c_source.html#l01937">REQUEST_TIMEOUT</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, and <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, and <a class="el" href="civetweb_8c_source.html#l06494">mg_read_inner()</a>.</p>

</div>
</div>
<a id="a57991f1957263ffb56e7411155766204" name="a57991f1957263ffb56e7411155766204"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57991f1957263ffb56e7411155766204">&#9670;&#160;</a></span>pull_inner()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int pull_inner </td>
          <td>(</td>
          <td class="paramtype">FILE *</td>          <td class="paramname"><span class="paramname"><em>fp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>timeout</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06210">6210</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6215</span>{</div>
<div class="line"><span class="lineno"> 6216</span>    <span class="keywordtype">int</span> nread, err = 0;</div>
<div class="line"><span class="lineno"> 6217</span> </div>
<div class="line"><span class="lineno"> 6218</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 6219</span>    <span class="keyword">typedef</span> <span class="keywordtype">int</span> len_t;</div>
<div class="line"><span class="lineno"> 6220</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 6221</span>    <span class="keyword">typedef</span> <span class="keywordtype">size_t</span> len_t;</div>
<div class="line"><span class="lineno"> 6222</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 6223</span> </div>
<div class="line"><span class="lineno"> 6224</span>    <span class="comment">/* We need an additional wait loop around this, because in some cases</span></div>
<div class="line"><span class="lineno"> 6225</span><span class="comment">     * with TLSwe may get data from the socket but not from SSL_read.</span></div>
<div class="line"><span class="lineno"> 6226</span><span class="comment">     * In this case we need to repeat at least once.</span></div>
<div class="line"><span class="lineno"> 6227</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 6228</span> </div>
<div class="line"><span class="lineno"> 6229</span>    <span class="keywordflow">if</span> (fp != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6230</span>        <span class="comment">/* Use read() instead of fread(), because if we&#39;re reading from the</span></div>
<div class="line"><span class="lineno"> 6231</span><span class="comment">         * CGI pipe, fread() may block until IO buffer is filled up. We</span></div>
<div class="line"><span class="lineno"> 6232</span><span class="comment">         * cannot afford to block and must pass all read bytes immediately</span></div>
<div class="line"><span class="lineno"> 6233</span><span class="comment">         * to the client. */</span></div>
<div class="line"><span class="lineno"> 6234</span>        nread = (int)read(fileno(fp), buf, (size_t)len);</div>
<div class="line"><span class="lineno"> 6235</span> </div>
<div class="line"><span class="lineno"> 6236</span>        err = (nread &lt; 0) ? <a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a> : 0;</div>
<div class="line"><span class="lineno"> 6237</span>        <span class="keywordflow">if</span> ((nread == 0) &amp;&amp; (len &gt; 0)) {</div>
<div class="line"><span class="lineno"> 6238</span>            <span class="comment">/* Should get data, but got EOL */</span></div>
<div class="line"><span class="lineno"> 6239</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6240</span>        }</div>
<div class="line"><span class="lineno"> 6241</span> </div>
<div class="line"><span class="lineno"> 6242</span><span class="preprocessor">#if defined(USE_MBEDTLS)</span></div>
<div class="line"><span class="lineno"> 6243</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6244</span>        <span class="keyword">struct </span><a class="code hl_define" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> pfd[1];</div>
<div class="line"><span class="lineno"> 6245</span>        <span class="keywordtype">int</span> to_read;</div>
<div class="line"><span class="lineno"> 6246</span>        <span class="keywordtype">int</span> pollres;</div>
<div class="line"><span class="lineno"> 6247</span> </div>
<div class="line"><span class="lineno"> 6248</span>        to_read = mbedtls_ssl_get_bytes_avail(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>);</div>
<div class="line"><span class="lineno"> 6249</span> </div>
<div class="line"><span class="lineno"> 6250</span>        <span class="keywordflow">if</span> (to_read &gt; 0) {</div>
<div class="line"><span class="lineno"> 6251</span>            <span class="comment">/* We already know there is no more data buffered in conn-&gt;buf</span></div>
<div class="line"><span class="lineno"> 6252</span><span class="comment">             * but there is more available in the SSL layer. So don&#39;t poll</span></div>
<div class="line"><span class="lineno"> 6253</span><span class="comment">             * conn-&gt;client.sock yet. */</span></div>
<div class="line"><span class="lineno"> 6254</span> </div>
<div class="line"><span class="lineno"> 6255</span>            pollres = 1;</div>
<div class="line"><span class="lineno"> 6256</span>            <span class="keywordflow">if</span> (to_read &gt; len)</div>
<div class="line"><span class="lineno"> 6257</span>                to_read = len;</div>
<div class="line"><span class="lineno"> 6258</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6259</span>            pfd[0].fd = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>;</div>
<div class="line"><span class="lineno"> 6260</span>            pfd[0].events = POLLIN;</div>
<div class="line"><span class="lineno"> 6261</span> </div>
<div class="line"><span class="lineno"> 6262</span>            to_read = len;</div>
<div class="line"><span class="lineno"> 6263</span> </div>
<div class="line"><span class="lineno"> 6264</span>            pollres = <a class="code hl_function" href="#a3b9904a2b6ed6d472f5ee35c7c588863">mg_poll</a>(pfd,</div>
<div class="line"><span class="lineno"> 6265</span>                              1,</div>
<div class="line"><span class="lineno"> 6266</span>                              (<span class="keywordtype">int</span>)(timeout * 1000.0),</div>
<div class="line"><span class="lineno"> 6267</span>                              &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>));</div>
<div class="line"><span class="lineno"> 6268</span> </div>
<div class="line"><span class="lineno"> 6269</span>            <span class="keywordflow">if</span> (!<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno"> 6270</span>                <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6271</span>            }</div>
<div class="line"><span class="lineno"> 6272</span>        }</div>
<div class="line"><span class="lineno"> 6273</span> </div>
<div class="line"><span class="lineno"> 6274</span>        <span class="keywordflow">if</span> (pollres &gt; 0) {</div>
<div class="line"><span class="lineno"> 6275</span>            nread = mbed_ssl_read(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)buf, to_read);</div>
<div class="line"><span class="lineno"> 6276</span>            <span class="keywordflow">if</span> (nread &lt;= 0) {</div>
<div class="line"><span class="lineno"> 6277</span>                <span class="keywordflow">if</span> ((nread == MBEDTLS_ERR_SSL_WANT_READ)</div>
<div class="line"><span class="lineno"> 6278</span>                    || (nread == MBEDTLS_ERR_SSL_WANT_WRITE)</div>
<div class="line"><span class="lineno"> 6279</span>                    || nread == MBEDTLS_ERR_SSL_ASYNC_IN_PROGRESS) {</div>
<div class="line"><span class="lineno"> 6280</span>                    nread = 0;</div>
<div class="line"><span class="lineno"> 6281</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6282</span>                    fprintf(stderr, <span class="stringliteral">&quot;SSL read failed, error %d\n&quot;</span>, nread);</div>
<div class="line"><span class="lineno"> 6283</span>                    <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6284</span>                }</div>
<div class="line"><span class="lineno"> 6285</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6286</span>                err = 0;</div>
<div class="line"><span class="lineno"> 6287</span>            }</div>
<div class="line"><span class="lineno"> 6288</span> </div>
<div class="line"><span class="lineno"> 6289</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pollres &lt; 0) {</div>
<div class="line"><span class="lineno"> 6290</span>            <span class="comment">/* Error */</span></div>
<div class="line"><span class="lineno"> 6291</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6292</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6293</span>            <span class="comment">/* pollres = 0 means timeout */</span></div>
<div class="line"><span class="lineno"> 6294</span>            nread = 0;</div>
<div class="line"><span class="lineno"> 6295</span>        }</div>
<div class="line"><span class="lineno"> 6296</span> </div>
<div class="line"><span class="lineno"> 6297</span><span class="preprocessor">#elif !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno"> 6298</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6299</span>        <span class="keywordtype">int</span> ssl_pending;</div>
<div class="line"><span class="lineno"> 6300</span>        <span class="keyword">struct </span><a class="code hl_define" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> pfd[1];</div>
<div class="line"><span class="lineno"> 6301</span>        <span class="keywordtype">int</span> pollres;</div>
<div class="line"><span class="lineno"> 6302</span> </div>
<div class="line"><span class="lineno"> 6303</span>        <span class="keywordflow">if</span> ((ssl_pending = SSL_pending(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>)) &gt; 0) {</div>
<div class="line"><span class="lineno"> 6304</span>            <span class="comment">/* We already know there is no more data buffered in conn-&gt;buf</span></div>
<div class="line"><span class="lineno"> 6305</span><span class="comment">             * but there is more available in the SSL layer. So don&#39;t poll</span></div>
<div class="line"><span class="lineno"> 6306</span><span class="comment">             * conn-&gt;client.sock yet. */</span></div>
<div class="line"><span class="lineno"> 6307</span>            <span class="keywordflow">if</span> (ssl_pending &gt; len) {</div>
<div class="line"><span class="lineno"> 6308</span>                ssl_pending = len;</div>
<div class="line"><span class="lineno"> 6309</span>            }</div>
<div class="line"><span class="lineno"> 6310</span>            pollres = 1;</div>
<div class="line"><span class="lineno"> 6311</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6312</span>            pfd[0].fd = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>;</div>
<div class="line"><span class="lineno"> 6313</span>            pfd[0].events = POLLIN;</div>
<div class="line"><span class="lineno"> 6314</span>            pollres = <a class="code hl_function" href="#a3b9904a2b6ed6d472f5ee35c7c588863">mg_poll</a>(pfd,</div>
<div class="line"><span class="lineno"> 6315</span>                              1,</div>
<div class="line"><span class="lineno"> 6316</span>                              (<span class="keywordtype">int</span>)(timeout * 1000.0),</div>
<div class="line"><span class="lineno"> 6317</span>                              &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>));</div>
<div class="line"><span class="lineno"> 6318</span>            <span class="keywordflow">if</span> (!<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno"> 6319</span>                <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6320</span>            }</div>
<div class="line"><span class="lineno"> 6321</span>        }</div>
<div class="line"><span class="lineno"> 6322</span>        <span class="keywordflow">if</span> (pollres &gt; 0) {</div>
<div class="line"><span class="lineno"> 6323</span>            ERR_clear_error();</div>
<div class="line"><span class="lineno"> 6324</span>            nread =</div>
<div class="line"><span class="lineno"> 6325</span>                SSL_read(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>, buf, (ssl_pending &gt; 0) ? ssl_pending : len);</div>
<div class="line"><span class="lineno"> 6326</span>            <span class="keywordflow">if</span> (nread &lt;= 0) {</div>
<div class="line"><span class="lineno"> 6327</span>                err = SSL_get_error(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>, nread);</div>
<div class="line"><span class="lineno"> 6328</span>                <span class="keywordflow">if</span> ((err == SSL_ERROR_SYSCALL) &amp;&amp; (nread == -1)) {</div>
<div class="line"><span class="lineno"> 6329</span>                    err = <a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno"> 6330</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((err == SSL_ERROR_WANT_READ)</div>
<div class="line"><span class="lineno"> 6331</span>                           || (err == SSL_ERROR_WANT_WRITE)) {</div>
<div class="line"><span class="lineno"> 6332</span>                    nread = 0;</div>
<div class="line"><span class="lineno"> 6333</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6334</span>                    <span class="comment">/* All errors should return -2 */</span></div>
<div class="line"><span class="lineno"> 6335</span>                    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;SSL_read() failed, error %d&quot;</span>, err);</div>
<div class="line"><span class="lineno"> 6336</span>                    ERR_clear_error();</div>
<div class="line"><span class="lineno"> 6337</span>                    <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6338</span>                }</div>
<div class="line"><span class="lineno"> 6339</span>                ERR_clear_error();</div>
<div class="line"><span class="lineno"> 6340</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6341</span>                err = 0;</div>
<div class="line"><span class="lineno"> 6342</span>            }</div>
<div class="line"><span class="lineno"> 6343</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pollres &lt; 0) {</div>
<div class="line"><span class="lineno"> 6344</span>            <span class="comment">/* Error */</span></div>
<div class="line"><span class="lineno"> 6345</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6346</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6347</span>            <span class="comment">/* pollres = 0 means timeout */</span></div>
<div class="line"><span class="lineno"> 6348</span>            nread = 0;</div>
<div class="line"><span class="lineno"> 6349</span>        }</div>
<div class="line"><span class="lineno"> 6350</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 6351</span> </div>
<div class="line"><span class="lineno"> 6352</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6353</span>        <span class="keyword">struct </span><a class="code hl_define" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> pfd[1];</div>
<div class="line"><span class="lineno"> 6354</span>        <span class="keywordtype">int</span> pollres;</div>
<div class="line"><span class="lineno"> 6355</span> </div>
<div class="line"><span class="lineno"> 6356</span>        pfd[0].fd = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>;</div>
<div class="line"><span class="lineno"> 6357</span>        pfd[0].events = POLLIN;</div>
<div class="line"><span class="lineno"> 6358</span>        pollres = <a class="code hl_function" href="#a3b9904a2b6ed6d472f5ee35c7c588863">mg_poll</a>(pfd,</div>
<div class="line"><span class="lineno"> 6359</span>                          1,</div>
<div class="line"><span class="lineno"> 6360</span>                          (<span class="keywordtype">int</span>)(timeout * 1000.0),</div>
<div class="line"><span class="lineno"> 6361</span>                          &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>));</div>
<div class="line"><span class="lineno"> 6362</span>        <span class="keywordflow">if</span> (!<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno"> 6363</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6364</span>        }</div>
<div class="line"><span class="lineno"> 6365</span>        <span class="keywordflow">if</span> (pollres &gt; 0) {</div>
<div class="line"><span class="lineno"> 6366</span>            nread = (int)recv(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>, buf, (len_t)len, 0);</div>
<div class="line"><span class="lineno"> 6367</span>            err = (nread &lt; 0) ? <a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a> : 0;</div>
<div class="line"><span class="lineno"> 6368</span>            <span class="keywordflow">if</span> (nread &lt;= 0) {</div>
<div class="line"><span class="lineno"> 6369</span>                <span class="comment">/* shutdown of the socket at client side */</span></div>
<div class="line"><span class="lineno"> 6370</span>                <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6371</span>            }</div>
<div class="line"><span class="lineno"> 6372</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pollres &lt; 0) {</div>
<div class="line"><span class="lineno"> 6373</span>            <span class="comment">/* error calling poll */</span></div>
<div class="line"><span class="lineno"> 6374</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6375</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6376</span>            <span class="comment">/* pollres = 0 means timeout */</span></div>
<div class="line"><span class="lineno"> 6377</span>            nread = 0;</div>
<div class="line"><span class="lineno"> 6378</span>        }</div>
<div class="line"><span class="lineno"> 6379</span>    }</div>
<div class="line"><span class="lineno"> 6380</span> </div>
<div class="line"><span class="lineno"> 6381</span>    <span class="keywordflow">if</span> (!<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno"> 6382</span>        <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6383</span>    }</div>
<div class="line"><span class="lineno"> 6384</span> </div>
<div class="line"><span class="lineno"> 6385</span>    <span class="keywordflow">if</span> ((nread &gt; 0) || ((nread == 0) &amp;&amp; (len == 0))) {</div>
<div class="line"><span class="lineno"> 6386</span>        <span class="comment">/* some data has been read, or no data was requested */</span></div>
<div class="line"><span class="lineno"> 6387</span>        <span class="keywordflow">return</span> nread;</div>
<div class="line"><span class="lineno"> 6388</span>    }</div>
<div class="line"><span class="lineno"> 6389</span> </div>
<div class="line"><span class="lineno"> 6390</span>    <span class="keywordflow">if</span> (nread &lt; 0) {</div>
<div class="line"><span class="lineno"> 6391</span>        <span class="comment">/* socket error - check errno */</span></div>
<div class="line"><span class="lineno"> 6392</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 6393</span>        <span class="keywordflow">if</span> (err == WSAEWOULDBLOCK) {</div>
<div class="line"><span class="lineno"> 6394</span>            <span class="comment">/* TODO (low): check if this is still required */</span></div>
<div class="line"><span class="lineno"> 6395</span>            <span class="comment">/* standard case if called from close_socket_gracefully */</span></div>
<div class="line"><span class="lineno"> 6396</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6397</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (err == WSAETIMEDOUT) {</div>
<div class="line"><span class="lineno"> 6398</span>            <span class="comment">/* TODO (low): check if this is still required */</span></div>
<div class="line"><span class="lineno"> 6399</span>            <span class="comment">/* timeout is handled by the while loop  */</span></div>
<div class="line"><span class="lineno"> 6400</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 6401</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (err == WSAECONNABORTED) {</div>
<div class="line"><span class="lineno"> 6402</span>            <span class="comment">/* See https://www.chilkatsoft.com/p/p_299.asp */</span></div>
<div class="line"><span class="lineno"> 6403</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6404</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6405</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;recv() failed, error %d&quot;</span>, err);</div>
<div class="line"><span class="lineno"> 6406</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6407</span>        }</div>
<div class="line"><span class="lineno"> 6408</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 6409</span>        <span class="comment">/* TODO: POSIX returns either EAGAIN or EWOULDBLOCK in both cases,</span></div>
<div class="line"><span class="lineno"> 6410</span><span class="comment">         * if the timeout is reached and if the socket was set to non-</span></div>
<div class="line"><span class="lineno"> 6411</span><span class="comment">         * blocking in close_socket_gracefully, so we can not distinguish</span></div>
<div class="line"><span class="lineno"> 6412</span><span class="comment">         * here. We have to wait for the timeout in both cases for now.</span></div>
<div class="line"><span class="lineno"> 6413</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 6414</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="#accab0bdb9395175c8b0f2565d2f862b5">ERROR_TRY_AGAIN</a>(err)) {</div>
<div class="line"><span class="lineno"> 6415</span>            <span class="comment">/* TODO (low): check if this is still required */</span></div>
<div class="line"><span class="lineno"> 6416</span>            <span class="comment">/* EAGAIN/EWOULDBLOCK:</span></div>
<div class="line"><span class="lineno"> 6417</span><span class="comment">             * standard case if called from close_socket_gracefully</span></div>
<div class="line"><span class="lineno"> 6418</span><span class="comment">             * =&gt; should return -1 */</span></div>
<div class="line"><span class="lineno"> 6419</span>            <span class="comment">/* or timeout occurred</span></div>
<div class="line"><span class="lineno"> 6420</span><span class="comment">             * =&gt; the code must stay in the while loop */</span></div>
<div class="line"><span class="lineno"> 6421</span> </div>
<div class="line"><span class="lineno"> 6422</span>            <span class="comment">/* EINTR can be generated on a socket with a timeout set even</span></div>
<div class="line"><span class="lineno"> 6423</span><span class="comment">             * when SA_RESTART is effective for all relevant signals</span></div>
<div class="line"><span class="lineno"> 6424</span><span class="comment">             * (see signal(7)).</span></div>
<div class="line"><span class="lineno"> 6425</span><span class="comment">             * =&gt; stay in the while loop */</span></div>
<div class="line"><span class="lineno"> 6426</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6427</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;recv() failed, error %d&quot;</span>, err);</div>
<div class="line"><span class="lineno"> 6428</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6429</span>        }</div>
<div class="line"><span class="lineno"> 6430</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 6431</span>    }</div>
<div class="line"><span class="lineno"> 6432</span> </div>
<div class="line"><span class="lineno"> 6433</span>    <span class="comment">/* Timeout occurred, but no data available. */</span></div>
<div class="line"><span class="lineno"> 6434</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6435</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l00447">ERROR_TRY_AGAIN</a>, <a class="el" href="civetweb_8c_source.html#l05938">mg_poll()</a>, <a class="el" href="civetweb_8c_source.html#l00948">mg_pollfd</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, <a class="el" href="civetweb_8c_source.html#l02506">mg_connection::ssl</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, and <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17740">close_socket_gracefully()</a>, <a class="el" href="civetweb_8c_source.html#l06439">pull_all()</a>, and <a class="el" href="civetweb_8c_source.html#l11107">read_message()</a>.</p>

</div>
</div>
<a id="ab855e2c5d4e7913fb2138a9909c8caca" name="ab855e2c5d4e7913fb2138a9909c8caca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab855e2c5d4e7913fb2138a9909c8caca">&#9670;&#160;</a></span>push_all()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int push_all </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *</td>          <td class="paramname"><span class="paramname"><em>fp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a></td>          <td class="paramname"><span class="paramname"><em>sock</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL *</td>          <td class="paramname"><span class="paramname"><em>ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>len</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06162">6162</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6168</span>{</div>
<div class="line"><span class="lineno"> 6169</span>    <span class="keywordtype">double</span> timeout = -1.0;</div>
<div class="line"><span class="lineno"> 6170</span>    <span class="keywordtype">int</span> n, nwritten = 0;</div>
<div class="line"><span class="lineno"> 6171</span> </div>
<div class="line"><span class="lineno"> 6172</span>    <span class="keywordflow">if</span> (ctx == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6173</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6174</span>    }</div>
<div class="line"><span class="lineno"> 6175</span> </div>
<div class="line"><span class="lineno"> 6176</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>]) {</div>
<div class="line"><span class="lineno"> 6177</span>        timeout = atoi(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>]) / 1000.0;</div>
<div class="line"><span class="lineno"> 6178</span>    }</div>
<div class="line"><span class="lineno"> 6179</span>    <span class="keywordflow">if</span> (timeout &lt;= 0.0) {</div>
<div class="line"><span class="lineno"> 6180</span>        timeout = strtod(<a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>].default_value, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno"> 6181</span>                  / 1000.0;</div>
<div class="line"><span class="lineno"> 6182</span>    }</div>
<div class="line"><span class="lineno"> 6183</span> </div>
<div class="line"><span class="lineno"> 6184</span>    <span class="keywordflow">while</span> ((len &gt; 0) &amp;&amp; <a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno"> 6185</span>        n = <a class="code hl_function" href="#afae99dbeb2f975b63527cbffbfe2e395">push_inner</a>(ctx, fp, sock, ssl, buf + nwritten, len, timeout);</div>
<div class="line"><span class="lineno"> 6186</span>        <span class="keywordflow">if</span> (n &lt; 0) {</div>
<div class="line"><span class="lineno"> 6187</span>            <span class="keywordflow">if</span> (nwritten == 0) {</div>
<div class="line"><span class="lineno"> 6188</span>                nwritten = -1; <span class="comment">/* Propagate the error */</span></div>
<div class="line"><span class="lineno"> 6189</span>            }</div>
<div class="line"><span class="lineno"> 6190</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 6191</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n == 0) {</div>
<div class="line"><span class="lineno"> 6192</span>            <span class="keywordflow">break</span>; <span class="comment">/* No more data to write */</span></div>
<div class="line"><span class="lineno"> 6193</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6194</span>            nwritten += n;</div>
<div class="line"><span class="lineno"> 6195</span>            len -= n;</div>
<div class="line"><span class="lineno"> 6196</span>        }</div>
<div class="line"><span class="lineno"> 6197</span>    }</div>
<div class="line"><span class="lineno"> 6198</span> </div>
<div class="line"><span class="lineno"> 6199</span>    <span class="keywordflow">return</span> nwritten;</div>
<div class="line"><span class="lineno"> 6200</span>}</div>
<div class="ttc" id="acivetweb_8c_html_afae99dbeb2f975b63527cbffbfe2e395"><div class="ttname"><a href="#afae99dbeb2f975b63527cbffbfe2e395">push_inner</a></div><div class="ttdeci">static int push_inner(struct mg_context *ctx, FILE *fp, SOCKET sock, SSL *ssl, const char *buf, int len, double timeout)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l06003">civetweb.c:6003</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l06003">push_inner()</a>, <a class="el" href="civetweb_8c_source.html#l01937">REQUEST_TIMEOUT</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, and <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11184">forward_body_data()</a>, and <a class="el" href="civetweb_8c_source.html#l06779">mg_write()</a>.</p>

</div>
</div>
<a id="afae99dbeb2f975b63527cbffbfe2e395" name="afae99dbeb2f975b63527cbffbfe2e395"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afae99dbeb2f975b63527cbffbfe2e395">&#9670;&#160;</a></span>push_inner()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int push_inner </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *</td>          <td class="paramname"><span class="paramname"><em>fp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a></td>          <td class="paramname"><span class="paramname"><em>sock</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL *</td>          <td class="paramname"><span class="paramname"><em>ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>timeout</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l06003">6003</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 6010</span>{</div>
<div class="line"><span class="lineno"> 6011</span>    uint64_t start = 0, now = 0, timeout_ns = 0;</div>
<div class="line"><span class="lineno"> 6012</span>    <span class="keywordtype">int</span> n, err;</div>
<div class="line"><span class="lineno"> 6013</span>    <span class="keywordtype">unsigned</span> ms_wait = <a class="code hl_define" href="#abd345577a07dba9941d4cea32b4cf4fd">SOCKET_TIMEOUT_QUANTUM</a>; <span class="comment">/* Sleep quantum in ms */</span></div>
<div class="line"><span class="lineno"> 6014</span> </div>
<div class="line"><span class="lineno"> 6015</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 6016</span>    <span class="keyword">typedef</span> <span class="keywordtype">int</span> len_t;</div>
<div class="line"><span class="lineno"> 6017</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 6018</span>    <span class="keyword">typedef</span> <span class="keywordtype">size_t</span> len_t;</div>
<div class="line"><span class="lineno"> 6019</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 6020</span> </div>
<div class="line"><span class="lineno"> 6021</span>    <span class="keywordflow">if</span> (timeout &gt; 0) {</div>
<div class="line"><span class="lineno"> 6022</span>        now = <a class="code hl_function" href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a>();</div>
<div class="line"><span class="lineno"> 6023</span>        start = now;</div>
<div class="line"><span class="lineno"> 6024</span>        timeout_ns = (uint64_t)(timeout * 1.0E9);</div>
<div class="line"><span class="lineno"> 6025</span>    }</div>
<div class="line"><span class="lineno"> 6026</span> </div>
<div class="line"><span class="lineno"> 6027</span>    <span class="keywordflow">if</span> (ctx == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6028</span>        <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6029</span>    }</div>
<div class="line"><span class="lineno"> 6030</span> </div>
<div class="line"><span class="lineno"> 6031</span><span class="preprocessor">#if defined(NO_SSL) &amp;&amp; !defined(USE_MBEDTLS)</span></div>
<div class="line"><span class="lineno"> 6032</span>    <span class="keywordflow">if</span> (ssl) {</div>
<div class="line"><span class="lineno"> 6033</span>        <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6034</span>    }</div>
<div class="line"><span class="lineno"> 6035</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 6036</span> </div>
<div class="line"><span class="lineno"> 6037</span>    <span class="comment">/* Try to read until it succeeds, fails, times out, or the server</span></div>
<div class="line"><span class="lineno"> 6038</span><span class="comment">     * shuts down. */</span></div>
<div class="line"><span class="lineno"> 6039</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno"> 6040</span> </div>
<div class="line"><span class="lineno"> 6041</span><span class="preprocessor">#if defined(USE_MBEDTLS)</span></div>
<div class="line"><span class="lineno"> 6042</span>        <span class="keywordflow">if</span> (ssl != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6043</span>            n = mbed_ssl_write(ssl, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)buf, len);</div>
<div class="line"><span class="lineno"> 6044</span>            <span class="keywordflow">if</span> (n &lt;= 0) {</div>
<div class="line"><span class="lineno"> 6045</span>                <span class="keywordflow">if</span> ((n == MBEDTLS_ERR_SSL_WANT_READ)</div>
<div class="line"><span class="lineno"> 6046</span>                    || (n == MBEDTLS_ERR_SSL_WANT_WRITE)</div>
<div class="line"><span class="lineno"> 6047</span>                    || n == MBEDTLS_ERR_SSL_ASYNC_IN_PROGRESS) {</div>
<div class="line"><span class="lineno"> 6048</span>                    n = 0;</div>
<div class="line"><span class="lineno"> 6049</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6050</span>                    fprintf(stderr, <span class="stringliteral">&quot;SSL write failed, error %d\n&quot;</span>, n);</div>
<div class="line"><span class="lineno"> 6051</span>                    <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6052</span>                }</div>
<div class="line"><span class="lineno"> 6053</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6054</span>                err = 0;</div>
<div class="line"><span class="lineno"> 6055</span>            }</div>
<div class="line"><span class="lineno"> 6056</span>        } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 6057</span><span class="preprocessor">#elif !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno"> 6058</span>        <span class="keywordflow">if</span> (ssl != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6059</span>            ERR_clear_error();</div>
<div class="line"><span class="lineno"> 6060</span>            n = SSL_write(ssl, buf, len);</div>
<div class="line"><span class="lineno"> 6061</span>            <span class="keywordflow">if</span> (n &lt;= 0) {</div>
<div class="line"><span class="lineno"> 6062</span>                err = SSL_get_error(ssl, n);</div>
<div class="line"><span class="lineno"> 6063</span>                <span class="keywordflow">if</span> ((err == SSL_ERROR_SYSCALL) &amp;&amp; (n == -1)) {</div>
<div class="line"><span class="lineno"> 6064</span>                    err = <a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno"> 6065</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((err == SSL_ERROR_WANT_READ)</div>
<div class="line"><span class="lineno"> 6066</span>                           || (err == SSL_ERROR_WANT_WRITE)) {</div>
<div class="line"><span class="lineno"> 6067</span>                    n = 0;</div>
<div class="line"><span class="lineno"> 6068</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6069</span>                    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;SSL_write() failed, error %d&quot;</span>, err);</div>
<div class="line"><span class="lineno"> 6070</span>                    ERR_clear_error();</div>
<div class="line"><span class="lineno"> 6071</span>                    <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6072</span>                }</div>
<div class="line"><span class="lineno"> 6073</span>                ERR_clear_error();</div>
<div class="line"><span class="lineno"> 6074</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6075</span>                err = 0;</div>
<div class="line"><span class="lineno"> 6076</span>            }</div>
<div class="line"><span class="lineno"> 6077</span>        } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 6078</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 6079</span> </div>
<div class="line"><span class="lineno"> 6080</span>            <span class="keywordflow">if</span> (fp != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6081</span>            n = (int)<a class="code hl_function" href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite</a>(buf, 1, (<span class="keywordtype">size_t</span>)len, fp);</div>
<div class="line"><span class="lineno"> 6082</span>            <span class="keywordflow">if</span> (ferror(fp)) {</div>
<div class="line"><span class="lineno"> 6083</span>                n = -1;</div>
<div class="line"><span class="lineno"> 6084</span>                err = <a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno"> 6085</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6086</span>                err = 0;</div>
<div class="line"><span class="lineno"> 6087</span>            }</div>
<div class="line"><span class="lineno"> 6088</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6089</span>            n = (int)send(sock, buf, (len_t)len, <a class="code hl_define" href="#a9f55d0e90dc8cc6b2287312435cdde48">MSG_NOSIGNAL</a>);</div>
<div class="line"><span class="lineno"> 6090</span>            err = (n &lt; 0) ? <a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a> : 0;</div>
<div class="line"><span class="lineno"> 6091</span>            <span class="keywordflow">if</span> (<a class="code hl_define" href="#accab0bdb9395175c8b0f2565d2f862b5">ERROR_TRY_AGAIN</a>(err)) {</div>
<div class="line"><span class="lineno"> 6092</span>                err = 0;</div>
<div class="line"><span class="lineno"> 6093</span>                n = 0;</div>
<div class="line"><span class="lineno"> 6094</span>            }</div>
<div class="line"><span class="lineno"> 6095</span>            <span class="keywordflow">if</span> (n &lt; 0) {</div>
<div class="line"><span class="lineno"> 6096</span>                <span class="comment">/* shutdown of the socket at client side */</span></div>
<div class="line"><span class="lineno"> 6097</span>                <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6098</span>            }</div>
<div class="line"><span class="lineno"> 6099</span>        }</div>
<div class="line"><span class="lineno"> 6100</span> </div>
<div class="line"><span class="lineno"> 6101</span>        <span class="keywordflow">if</span> (!<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno"> 6102</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6103</span>        }</div>
<div class="line"><span class="lineno"> 6104</span> </div>
<div class="line"><span class="lineno"> 6105</span>        <span class="keywordflow">if</span> ((n &gt; 0) || ((n == 0) &amp;&amp; (len == 0))) {</div>
<div class="line"><span class="lineno"> 6106</span>            <span class="comment">/* some data has been read, or no data was requested */</span></div>
<div class="line"><span class="lineno"> 6107</span>            <span class="keywordflow">return</span> n;</div>
<div class="line"><span class="lineno"> 6108</span>        }</div>
<div class="line"><span class="lineno"> 6109</span>        <span class="keywordflow">if</span> (n &lt; 0) {</div>
<div class="line"><span class="lineno"> 6110</span>            <span class="comment">/* socket error - check errno */</span></div>
<div class="line"><span class="lineno"> 6111</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;send() failed, error %d&quot;</span>, err);</div>
<div class="line"><span class="lineno"> 6112</span> </div>
<div class="line"><span class="lineno"> 6113</span>            <span class="comment">/* TODO (mid): error handling depending on the error code.</span></div>
<div class="line"><span class="lineno"> 6114</span><span class="comment">             * These codes are different between Windows and Linux.</span></div>
<div class="line"><span class="lineno"> 6115</span><span class="comment">             * Currently there is no problem with failing send calls,</span></div>
<div class="line"><span class="lineno"> 6116</span><span class="comment">             * if there is a reproducible situation, it should be</span></div>
<div class="line"><span class="lineno"> 6117</span><span class="comment">             * investigated in detail.</span></div>
<div class="line"><span class="lineno"> 6118</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno"> 6119</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6120</span>        }</div>
<div class="line"><span class="lineno"> 6121</span> </div>
<div class="line"><span class="lineno"> 6122</span>        <span class="comment">/* Only in case n=0 (timeout), repeat calling the write function */</span></div>
<div class="line"><span class="lineno"> 6123</span> </div>
<div class="line"><span class="lineno"> 6124</span>        <span class="comment">/* If send failed, wait before retry */</span></div>
<div class="line"><span class="lineno"> 6125</span>        <span class="keywordflow">if</span> (fp != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 6126</span>            <span class="comment">/* For files, just wait a fixed time.</span></div>
<div class="line"><span class="lineno"> 6127</span><span class="comment">             * Maybe it helps, maybe not. */</span></div>
<div class="line"><span class="lineno"> 6128</span>            <a class="code hl_define" href="#af1af7c8ef16047616b5bee88aeee10d6">mg_sleep</a>(5);</div>
<div class="line"><span class="lineno"> 6129</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 6130</span>            <span class="comment">/* For sockets, wait for the socket using poll */</span></div>
<div class="line"><span class="lineno"> 6131</span>            <span class="keyword">struct </span><a class="code hl_define" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> pfd[1];</div>
<div class="line"><span class="lineno"> 6132</span>            <span class="keywordtype">int</span> pollres;</div>
<div class="line"><span class="lineno"> 6133</span> </div>
<div class="line"><span class="lineno"> 6134</span>            pfd[0].fd = sock;</div>
<div class="line"><span class="lineno"> 6135</span>            pfd[0].events = POLLOUT;</div>
<div class="line"><span class="lineno"> 6136</span>            pollres = <a class="code hl_function" href="#a3b9904a2b6ed6d472f5ee35c7c588863">mg_poll</a>(pfd, 1, (<span class="keywordtype">int</span>)(ms_wait), &amp;(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>));</div>
<div class="line"><span class="lineno"> 6137</span>            <span class="keywordflow">if</span> (!<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno"> 6138</span>                <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno"> 6139</span>            }</div>
<div class="line"><span class="lineno"> 6140</span>            <span class="keywordflow">if</span> (pollres &gt; 0) {</div>
<div class="line"><span class="lineno"> 6141</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 6142</span>            }</div>
<div class="line"><span class="lineno"> 6143</span>        }</div>
<div class="line"><span class="lineno"> 6144</span> </div>
<div class="line"><span class="lineno"> 6145</span>        <span class="keywordflow">if</span> (timeout &gt; 0) {</div>
<div class="line"><span class="lineno"> 6146</span>            now = <a class="code hl_function" href="#a2040e14dfbc73e3fad6b7971613243ea">mg_get_current_time_ns</a>();</div>
<div class="line"><span class="lineno"> 6147</span>            <span class="keywordflow">if</span> ((now - start) &gt; timeout_ns) {</div>
<div class="line"><span class="lineno"> 6148</span>                <span class="comment">/* Timeout */</span></div>
<div class="line"><span class="lineno"> 6149</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 6150</span>            }</div>
<div class="line"><span class="lineno"> 6151</span>        }</div>
<div class="line"><span class="lineno"> 6152</span>    }</div>
<div class="line"><span class="lineno"> 6153</span> </div>
<div class="line"><span class="lineno"> 6154</span>    (void)err; <span class="comment">/* Avoid unused warning if NO_SSL is set and DEBUG_TRACE is not</span></div>
<div class="line"><span class="lineno"> 6155</span><span class="comment">               used */</span></div>
<div class="line"><span class="lineno"> 6156</span> </div>
<div class="line"><span class="lineno"> 6157</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 6158</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a9f55d0e90dc8cc6b2287312435cdde48"><div class="ttname"><a href="#a9f55d0e90dc8cc6b2287312435cdde48">MSG_NOSIGNAL</a></div><div class="ttdeci">#define MSG_NOSIGNAL</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l01735">civetweb.c:1735</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l00447">ERROR_TRY_AGAIN</a>, <a class="el" href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite()</a>, <a class="el" href="civetweb_8c_source.html#l01676">mg_get_current_time_ns()</a>, <a class="el" href="civetweb_8c_source.html#l05938">mg_poll()</a>, <a class="el" href="civetweb_8c_source.html#l00948">mg_pollfd</a>, <a class="el" href="civetweb_8c_source.html#l00920">mg_sleep</a>, <a class="el" href="civetweb_8c_source.html#l01735">MSG_NOSIGNAL</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l00473">SOCKET_TIMEOUT_QUANTUM</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, and <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l06162">push_all()</a>.</p>

</div>
</div>
<a id="a21b71badd56313936783f198fdd20c9a" name="a21b71badd56313936783f198fdd20c9a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21b71badd56313936783f198fdd20c9a">&#9670;&#160;</a></span>put_dir()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int put_dir </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10572">10572</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10573</span>{</div>
<div class="line"><span class="lineno">10574</span>    <span class="keywordtype">char</span> buf[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>];</div>
<div class="line"><span class="lineno">10575</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, *p;</div>
<div class="line"><span class="lineno">10576</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">10577</span>    <span class="keywordtype">size_t</span> len;</div>
<div class="line"><span class="lineno">10578</span>    <span class="keywordtype">int</span> res = 1;</div>
<div class="line"><span class="lineno">10579</span> </div>
<div class="line"><span class="lineno">10580</span>    <span class="keywordflow">for</span> (<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = p = path + 2; (p = strchr(<a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a>, <span class="charliteral">&#39;/&#39;</span>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <a class="code hl_variable" href="multi_8h.html#a3c9cc97360bd1a6ca03b4b31f16d1342">s</a> = ++p) {</div>
<div class="line"><span class="lineno">10581</span>        len = (size_t)(p - path);</div>
<div class="line"><span class="lineno">10582</span>        <span class="keywordflow">if</span> (len &gt;= <span class="keyword">sizeof</span>(buf)) {</div>
<div class="line"><span class="lineno">10583</span>            <span class="comment">/* path too long */</span></div>
<div class="line"><span class="lineno">10584</span>            res = -1;</div>
<div class="line"><span class="lineno">10585</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">10586</span>        }</div>
<div class="line"><span class="lineno">10587</span>        memcpy(buf, path, len);</div>
<div class="line"><span class="lineno">10588</span>        buf[len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">10589</span> </div>
<div class="line"><span class="lineno">10590</span>        <span class="comment">/* Try to create intermediate directory */</span></div>
<div class="line"><span class="lineno">10591</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;mkdir(%s)&quot;</span>, buf);</div>
<div class="line"><span class="lineno">10592</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, buf, &amp;file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>) &amp;&amp; <a class="code hl_define" href="#a756d12537962d25f9c69aaa1a319b10a">mg_mkdir</a>(conn, buf, 0755) != 0) {</div>
<div class="line"><span class="lineno">10593</span>            <span class="comment">/* path does not exist and can not be created */</span></div>
<div class="line"><span class="lineno">10594</span>            res = -2;</div>
<div class="line"><span class="lineno">10595</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">10596</span>        }</div>
<div class="line"><span class="lineno">10597</span> </div>
<div class="line"><span class="lineno">10598</span>        <span class="comment">/* Is path itself a directory? */</span></div>
<div class="line"><span class="lineno">10599</span>        <span class="keywordflow">if</span> (p[1] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno">10600</span>            res = 0;</div>
<div class="line"><span class="lineno">10601</span>        }</div>
<div class="line"><span class="lineno">10602</span>    }</div>
<div class="line"><span class="lineno">10603</span> </div>
<div class="line"><span class="lineno">10604</span>    <span class="keywordflow">return</span> res;</div>
<div class="line"><span class="lineno">10605</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l00918">mg_mkdir</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="multi_8h_source.html#l00318">s</a>, <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>, <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>, and <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10622">mg_store_body()</a>, and <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>.</p>

</div>
</div>
<a id="a188d397634e66f50df4a25eb2b46b6eb" name="a188d397634e66f50df4a25eb2b46b6eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a188d397634e66f50df4a25eb2b46b6eb">&#9670;&#160;</a></span>put_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void put_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12158">12158</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12159</span>{</div>
<div class="line"><span class="lineno">12160</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">12161</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *range;</div>
<div class="line"><span class="lineno">12162</span>    int64_t r1, r2;</div>
<div class="line"><span class="lineno">12163</span>    <span class="keywordtype">int</span> rc;</div>
<div class="line"><span class="lineno">12164</span> </div>
<div class="line"><span class="lineno">12165</span>    <span class="keywordflow">if</span> (conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">12166</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12167</span>    }</div>
<div class="line"><span class="lineno">12168</span> </div>
<div class="line"><span class="lineno">12169</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;store %s&quot;</span>, path);</div>
<div class="line"><span class="lineno">12170</span> </div>
<div class="line"><span class="lineno">12171</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path, &amp;file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>)) {</div>
<div class="line"><span class="lineno">12172</span>        <span class="comment">/* File already exists */</span></div>
<div class="line"><span class="lineno">12173</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 200;</div>
<div class="line"><span class="lineno">12174</span> </div>
<div class="line"><span class="lineno">12175</span>        <span class="keywordflow">if</span> (file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a>) {</div>
<div class="line"><span class="lineno">12176</span>            <span class="comment">/* This is an already existing directory,</span></div>
<div class="line"><span class="lineno">12177</span><span class="comment">             * so there is nothing to do for the server. */</span></div>
<div class="line"><span class="lineno">12178</span>            rc = 0;</div>
<div class="line"><span class="lineno">12179</span> </div>
<div class="line"><span class="lineno">12180</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12181</span>            <span class="comment">/* File exists and is not a directory. */</span></div>
<div class="line"><span class="lineno">12182</span>            <span class="comment">/* Can it be replaced? */</span></div>
<div class="line"><span class="lineno">12183</span> </div>
<div class="line"><span class="lineno">12184</span>            <span class="comment">/* Check if the server may write this file */</span></div>
<div class="line"><span class="lineno">12185</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>(path, W_OK) == 0) {</div>
<div class="line"><span class="lineno">12186</span>                <span class="comment">/* Access granted */</span></div>
<div class="line"><span class="lineno">12187</span>                rc = 1;</div>
<div class="line"><span class="lineno">12188</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12189</span>                <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(</div>
<div class="line"><span class="lineno">12190</span>                    conn,</div>
<div class="line"><span class="lineno">12191</span>                    403,</div>
<div class="line"><span class="lineno">12192</span>                    <span class="stringliteral">&quot;Error: Put not possible\nReplacing %s is not allowed&quot;</span>,</div>
<div class="line"><span class="lineno">12193</span>                    path);</div>
<div class="line"><span class="lineno">12194</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12195</span>            }</div>
<div class="line"><span class="lineno">12196</span>        }</div>
<div class="line"><span class="lineno">12197</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12198</span>        <span class="comment">/* File should be created */</span></div>
<div class="line"><span class="lineno">12199</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 201;</div>
<div class="line"><span class="lineno">12200</span>        rc = <a class="code hl_function" href="#a21b71badd56313936783f198fdd20c9a">put_dir</a>(conn, path);</div>
<div class="line"><span class="lineno">12201</span>    }</div>
<div class="line"><span class="lineno">12202</span> </div>
<div class="line"><span class="lineno">12203</span>    <span class="keywordflow">if</span> (rc == 0) {</div>
<div class="line"><span class="lineno">12204</span>        <span class="comment">/* put_dir returns 0 if path is a directory */</span></div>
<div class="line"><span class="lineno">12205</span> </div>
<div class="line"><span class="lineno">12206</span>        <span class="comment">/* Create response */</span></div>
<div class="line"><span class="lineno">12207</span>        <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a>);</div>
<div class="line"><span class="lineno">12208</span>        <a class="code hl_function" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a>(conn);</div>
<div class="line"><span class="lineno">12209</span>        <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">12210</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, -1);</div>
<div class="line"><span class="lineno">12211</span> </div>
<div class="line"><span class="lineno">12212</span>        <span class="comment">/* Send all headers - there is no body */</span></div>
<div class="line"><span class="lineno">12213</span>        <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">12214</span> </div>
<div class="line"><span class="lineno">12215</span>        <span class="comment">/* Request to create a directory has been fulfilled successfully.</span></div>
<div class="line"><span class="lineno">12216</span><span class="comment">         * No need to put a file. */</span></div>
<div class="line"><span class="lineno">12217</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12218</span>    }</div>
<div class="line"><span class="lineno">12219</span> </div>
<div class="line"><span class="lineno">12220</span>    <span class="keywordflow">if</span> (rc == -1) {</div>
<div class="line"><span class="lineno">12221</span>        <span class="comment">/* put_dir returns -1 if the path is too long */</span></div>
<div class="line"><span class="lineno">12222</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">12223</span>                           414,</div>
<div class="line"><span class="lineno">12224</span>                           <span class="stringliteral">&quot;Error: Path too long\nput_dir(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno">12225</span>                           path,</div>
<div class="line"><span class="lineno">12226</span>                           strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">12227</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12228</span>    }</div>
<div class="line"><span class="lineno">12229</span> </div>
<div class="line"><span class="lineno">12230</span>    <span class="keywordflow">if</span> (rc == -2) {</div>
<div class="line"><span class="lineno">12231</span>        <span class="comment">/* put_dir returns -2 if the directory can not be created */</span></div>
<div class="line"><span class="lineno">12232</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">12233</span>                           500,</div>
<div class="line"><span class="lineno">12234</span>                           <span class="stringliteral">&quot;Error: Can not create directory\nput_dir(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno">12235</span>                           path,</div>
<div class="line"><span class="lineno">12236</span>                           strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">12237</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12238</span>    }</div>
<div class="line"><span class="lineno">12239</span> </div>
<div class="line"><span class="lineno">12240</span>    <span class="comment">/* A file should be created or overwritten. */</span></div>
<div class="line"><span class="lineno">12241</span>    <span class="comment">/* Currently CivetWeb does not need read+write access. */</span></div>
<div class="line"><span class="lineno">12242</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(conn, path, <a class="code hl_define" href="#abb547e0027f87aeb69575479967c1f5f">MG_FOPEN_MODE_WRITE</a>, &amp;file)</div>
<div class="line"><span class="lineno">12243</span>        || file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">12244</span>        (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>);</div>
<div class="line"><span class="lineno">12245</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">12246</span>                           500,</div>
<div class="line"><span class="lineno">12247</span>                           <span class="stringliteral">&quot;Error: Can not create file\nfopen(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno">12248</span>                           path,</div>
<div class="line"><span class="lineno">12249</span>                           strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">12250</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12251</span>    }</div>
<div class="line"><span class="lineno">12252</span> </div>
<div class="line"><span class="lineno">12253</span>    <a class="code hl_function" href="#a66af55875eb933f2969b8bed72ab9ef4">fclose_on_exec</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>, conn);</div>
<div class="line"><span class="lineno">12254</span>    range = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Content-Range&quot;</span>);</div>
<div class="line"><span class="lineno">12255</span>    r1 = r2 = 0;</div>
<div class="line"><span class="lineno">12256</span>    <span class="keywordflow">if</span> ((range != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; <a class="code hl_function" href="#a96d4fe5a4a9ff4b964325c9d31c4b6c9">parse_range_header</a>(range, &amp;r1, &amp;r2) &gt; 0) {</div>
<div class="line"><span class="lineno">12257</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 206; <span class="comment">/* Partial content */</span></div>
<div class="line"><span class="lineno">12258</span>        <span class="keywordflow">if</span> (0 != fseeko(file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a>, r1, SEEK_SET)) {</div>
<div class="line"><span class="lineno">12259</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn,</div>
<div class="line"><span class="lineno">12260</span>                               500,</div>
<div class="line"><span class="lineno">12261</span>                               <span class="stringliteral">&quot;Error: Internal error processing file %s&quot;</span>,</div>
<div class="line"><span class="lineno">12262</span>                               path);</div>
<div class="line"><span class="lineno">12263</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12264</span>        }</div>
<div class="line"><span class="lineno">12265</span>    }</div>
<div class="line"><span class="lineno">12266</span> </div>
<div class="line"><span class="lineno">12267</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a6b0ac164cc67271e3819e1d6c967ef95">forward_body_data</a>(conn, file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a>, <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">12268</span>        <span class="comment">/* forward_body_data failed.</span></div>
<div class="line"><span class="lineno">12269</span><span class="comment">         * The error code has already been sent to the client,</span></div>
<div class="line"><span class="lineno">12270</span><span class="comment">         * and conn-&gt;status_code is already set. */</span></div>
<div class="line"><span class="lineno">12271</span>        (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>);</div>
<div class="line"><span class="lineno">12272</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12273</span>    }</div>
<div class="line"><span class="lineno">12274</span> </div>
<div class="line"><span class="lineno">12275</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(&amp;file.<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>) != 0) {</div>
<div class="line"><span class="lineno">12276</span>        <span class="comment">/* fclose failed. This might have different reasons, but a likely</span></div>
<div class="line"><span class="lineno">12277</span><span class="comment">         * one is &quot;no space on disk&quot;, http 507. */</span></div>
<div class="line"><span class="lineno">12278</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = 507;</div>
<div class="line"><span class="lineno">12279</span>    }</div>
<div class="line"><span class="lineno">12280</span> </div>
<div class="line"><span class="lineno">12281</span>    <span class="comment">/* Create response (status_code has been set before) */</span></div>
<div class="line"><span class="lineno">12282</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a>);</div>
<div class="line"><span class="lineno">12283</span>    <a class="code hl_function" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a>(conn);</div>
<div class="line"><span class="lineno">12284</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">12285</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, -1);</div>
<div class="line"><span class="lineno">12286</span> </div>
<div class="line"><span class="lineno">12287</span>    <span class="comment">/* Send all headers - there is no body */</span></div>
<div class="line"><span class="lineno">12288</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">12289</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l10196">fclose_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l11184">forward_body_data()</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, <a class="el" href="civetweb_8c_source.html#l00925">INVALID_SOCKET</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02846">MG_FOPEN_MODE_WRITE</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l10169">parse_range_header()</a>, <a class="el" href="civetweb_8c_source.html#l10572">put_dir()</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04056">send_no_cache_header()</a>, <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>, <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>, and <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a7cd712ed2b8d7a2107836b8ed6ddc1a6" name="a7cd712ed2b8d7a2107836b8ed6ddc1a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cd712ed2b8d7a2107836b8ed6ddc1a6">&#9670;&#160;</a></span>read_auth_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int read_auth_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structread__auth__file__struct.html">read_auth_file_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>workdata</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>depth</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08733">8733</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8736</span>{</div>
<div class="line"><span class="lineno"> 8737</span>    <span class="keywordtype">int</span> is_authorized = 0;</div>
<div class="line"><span class="lineno"> 8738</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> fp;</div>
<div class="line"><span class="lineno"> 8739</span>    <span class="keywordtype">size_t</span> l;</div>
<div class="line"><span class="lineno"> 8740</span> </div>
<div class="line"><span class="lineno"> 8741</span>    <span class="keywordflow">if</span> (!filep || !workdata || (0 == <a class="code hl_variable" href="deprecated_2gthread_8h.html#a2b31ea2bc2a86a6f81186b13309f0f45">depth</a>)) {</div>
<div class="line"><span class="lineno"> 8742</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8743</span>    }</div>
<div class="line"><span class="lineno"> 8744</span> </div>
<div class="line"><span class="lineno"> 8745</span>    <span class="comment">/* Loop over passwords file */</span></div>
<div class="line"><span class="lineno"> 8746</span>    <span class="keywordflow">while</span> (<a class="code hl_function" href="#ad749ad33438ec816162818fd6974a433">mg_fgets</a>(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>, <span class="keyword">sizeof</span>(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>), filep) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8747</span>        l = strlen(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>);</div>
<div class="line"><span class="lineno"> 8748</span>        <span class="keywordflow">while</span> (l &gt; 0) {</div>
<div class="line"><span class="lineno"> 8749</span>            <span class="keywordflow">if</span> (isspace((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>[l - 1])</div>
<div class="line"><span class="lineno"> 8750</span>                || iscntrl((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>[l - 1])) {</div>
<div class="line"><span class="lineno"> 8751</span>                l--;</div>
<div class="line"><span class="lineno"> 8752</span>                workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>[l] = 0;</div>
<div class="line"><span class="lineno"> 8753</span>            } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 8754</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 8755</span>        }</div>
<div class="line"><span class="lineno"> 8756</span>        <span class="keywordflow">if</span> (l &lt; 1) {</div>
<div class="line"><span class="lineno"> 8757</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 8758</span>        }</div>
<div class="line"><span class="lineno"> 8759</span> </div>
<div class="line"><span class="lineno"> 8760</span>        workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a592656059a3218c376f18ebcf6d3e6a3">f_user</a> = workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>;</div>
<div class="line"><span class="lineno"> 8761</span> </div>
<div class="line"><span class="lineno"> 8762</span>        <span class="keywordflow">if</span> (workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a592656059a3218c376f18ebcf6d3e6a3">f_user</a>[0] == <span class="charliteral">&#39;:&#39;</span>) {</div>
<div class="line"><span class="lineno"> 8763</span>            <span class="comment">/* user names may not contain a &#39;:&#39; and may not be empty,</span></div>
<div class="line"><span class="lineno"> 8764</span><span class="comment">             * so lines starting with &#39;:&#39; may be used for a special purpose</span></div>
<div class="line"><span class="lineno"> 8765</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno"> 8766</span>            <span class="keywordflow">if</span> (workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a592656059a3218c376f18ebcf6d3e6a3">f_user</a>[1] == <span class="charliteral">&#39;#&#39;</span>) {</div>
<div class="line"><span class="lineno"> 8767</span>                <span class="comment">/* :# is a comment */</span></div>
<div class="line"><span class="lineno"> 8768</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 8769</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a592656059a3218c376f18ebcf6d3e6a3">f_user</a> + 1, <span class="stringliteral">&quot;include=&quot;</span>, 8)) {</div>
<div class="line"><span class="lineno"> 8770</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="#a3341033fb439f4b1566fa8bc71f28e2b">mg_fopen</a>(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>,</div>
<div class="line"><span class="lineno"> 8771</span>                             workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a592656059a3218c376f18ebcf6d3e6a3">f_user</a> + 9,</div>
<div class="line"><span class="lineno"> 8772</span>                             <a class="code hl_define" href="#a5bd58793b81cca07589b297470992a9e">MG_FOPEN_MODE_READ</a>,</div>
<div class="line"><span class="lineno"> 8773</span>                             &amp;fp)) {</div>
<div class="line"><span class="lineno"> 8774</span>                    is_authorized = <a class="code hl_function" href="#a7cd712ed2b8d7a2107836b8ed6ddc1a6">read_auth_file</a>(&amp;fp, workdata, <a class="code hl_variable" href="deprecated_2gthread_8h.html#a2b31ea2bc2a86a6f81186b13309f0f45">depth</a> - 1);</div>
<div class="line"><span class="lineno"> 8775</span>                    (void)<a class="code hl_function" href="#ada8ae98eea53a76bee149585c48beca3">mg_fclose</a>(</div>
<div class="line"><span class="lineno"> 8776</span>                        &amp;fp.access); <span class="comment">/* ignore error on read only file */</span></div>
<div class="line"><span class="lineno"> 8777</span> </div>
<div class="line"><span class="lineno"> 8778</span>                    <span class="comment">/* No need to continue processing files once we have a</span></div>
<div class="line"><span class="lineno"> 8779</span><span class="comment">                     * match, since nothing will reset it back</span></div>
<div class="line"><span class="lineno"> 8780</span><span class="comment">                     * to 0.</span></div>
<div class="line"><span class="lineno"> 8781</span><span class="comment">                     */</span></div>
<div class="line"><span class="lineno"> 8782</span>                    <span class="keywordflow">if</span> (is_authorized) {</div>
<div class="line"><span class="lineno"> 8783</span>                        <span class="keywordflow">return</span> is_authorized;</div>
<div class="line"><span class="lineno"> 8784</span>                    }</div>
<div class="line"><span class="lineno"> 8785</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 8786</span>                    <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>,</div>
<div class="line"><span class="lineno"> 8787</span>                                    <span class="stringliteral">&quot;%s: cannot open authorization file: %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 8788</span>                                    __func__,</div>
<div class="line"><span class="lineno"> 8789</span>                                    workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>);</div>
<div class="line"><span class="lineno"> 8790</span>                }</div>
<div class="line"><span class="lineno"> 8791</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 8792</span>            }</div>
<div class="line"><span class="lineno"> 8793</span>            <span class="comment">/* everything is invalid for the moment (might change in the</span></div>
<div class="line"><span class="lineno"> 8794</span><span class="comment">             * future) */</span></div>
<div class="line"><span class="lineno"> 8795</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>,</div>
<div class="line"><span class="lineno"> 8796</span>                            <span class="stringliteral">&quot;%s: syntax error in authorization file: %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 8797</span>                            __func__,</div>
<div class="line"><span class="lineno"> 8798</span>                            workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>);</div>
<div class="line"><span class="lineno"> 8799</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 8800</span>        }</div>
<div class="line"><span class="lineno"> 8801</span> </div>
<div class="line"><span class="lineno"> 8802</span>        workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a58d5b82f976a952b69400f93a277fb3e">f_domain</a> = strchr(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a592656059a3218c376f18ebcf6d3e6a3">f_user</a>, <span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line"><span class="lineno"> 8803</span>        <span class="keywordflow">if</span> (workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a58d5b82f976a952b69400f93a277fb3e">f_domain</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8804</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>,</div>
<div class="line"><span class="lineno"> 8805</span>                            <span class="stringliteral">&quot;%s: syntax error in authorization file: %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 8806</span>                            __func__,</div>
<div class="line"><span class="lineno"> 8807</span>                            workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>);</div>
<div class="line"><span class="lineno"> 8808</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 8809</span>        }</div>
<div class="line"><span class="lineno"> 8810</span>        *(<span class="keywordtype">char</span> *)(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a58d5b82f976a952b69400f93a277fb3e">f_domain</a>) = 0;</div>
<div class="line"><span class="lineno"> 8811</span>        (workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a58d5b82f976a952b69400f93a277fb3e">f_domain</a>)++;</div>
<div class="line"><span class="lineno"> 8812</span> </div>
<div class="line"><span class="lineno"> 8813</span>        workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a0b4e775a7d98cc43da1e41857ed991ab">f_ha1</a> = strchr(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a58d5b82f976a952b69400f93a277fb3e">f_domain</a>, <span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line"><span class="lineno"> 8814</span>        <span class="keywordflow">if</span> (workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a0b4e775a7d98cc43da1e41857ed991ab">f_ha1</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 8815</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>,</div>
<div class="line"><span class="lineno"> 8816</span>                            <span class="stringliteral">&quot;%s: syntax error in authorization file: %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 8817</span>                            __func__,</div>
<div class="line"><span class="lineno"> 8818</span>                            workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a98f65df7a72e6845bb9aed2bf77db775">buf</a>);</div>
<div class="line"><span class="lineno"> 8819</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 8820</span>        }</div>
<div class="line"><span class="lineno"> 8821</span>        *(<span class="keywordtype">char</span> *)(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a0b4e775a7d98cc43da1e41857ed991ab">f_ha1</a>) = 0;</div>
<div class="line"><span class="lineno"> 8822</span>        (workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a0b4e775a7d98cc43da1e41857ed991ab">f_ha1</a>)++;</div>
<div class="line"><span class="lineno"> 8823</span> </div>
<div class="line"><span class="lineno"> 8824</span>        <span class="keywordflow">if</span> (!strcmp(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a9dfdd624bbfe958b7f86a3648ce05327">ah</a>.<a class="code hl_variable" href="structah.html#a6a47edd6e080153254efde58725a372f">user</a>, workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a592656059a3218c376f18ebcf6d3e6a3">f_user</a>)</div>
<div class="line"><span class="lineno"> 8825</span>            &amp;&amp; !strcmp(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a59600288698c720706fad2054a1d7d4b">domain</a>, workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a58d5b82f976a952b69400f93a277fb3e">f_domain</a>)) {</div>
<div class="line"><span class="lineno"> 8826</span>            <span class="keywordflow">switch</span> (workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a9dfdd624bbfe958b7f86a3648ce05327">ah</a>.<a class="code hl_variable" href="structah.html#af83adf530d42fad011c5f8a0a1df3002">type</a>) {</div>
<div class="line"><span class="lineno"> 8827</span>            <span class="keywordflow">case</span> 1: <span class="comment">/* Basic */</span></div>
<div class="line"><span class="lineno"> 8828</span>            {</div>
<div class="line"><span class="lineno"> 8829</span>                <span class="keywordtype">char</span> md5[33];</div>
<div class="line"><span class="lineno"> 8830</span>                <a class="code hl_function" href="#a9a1f27cd059fa56ead5cecaf7885582f">mg_md5</a>(md5,</div>
<div class="line"><span class="lineno"> 8831</span>                       workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a592656059a3218c376f18ebcf6d3e6a3">f_user</a>,</div>
<div class="line"><span class="lineno"> 8832</span>                       <span class="stringliteral">&quot;:&quot;</span>,</div>
<div class="line"><span class="lineno"> 8833</span>                       workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a59600288698c720706fad2054a1d7d4b">domain</a>,</div>
<div class="line"><span class="lineno"> 8834</span>                       <span class="stringliteral">&quot;:&quot;</span>,</div>
<div class="line"><span class="lineno"> 8835</span>                       workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a9dfdd624bbfe958b7f86a3648ce05327">ah</a>.<a class="code hl_variable" href="structah.html#a72bdb0a165ff25a22981eb4ff2db98fc">plain_password</a>,</div>
<div class="line"><span class="lineno"> 8836</span>                       <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 8837</span>                <span class="keywordflow">return</span> 0 == memcmp(workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a0b4e775a7d98cc43da1e41857ed991ab">f_ha1</a>, md5, 33);</div>
<div class="line"><span class="lineno"> 8838</span>            }</div>
<div class="line"><span class="lineno"> 8839</span>            <span class="keywordflow">case</span> 2: <span class="comment">/* Digest */</span></div>
<div class="line"><span class="lineno"> 8840</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="#ad5152c8a0667f633bdb0d7b97bca75c3">check_password_digest</a>(</div>
<div class="line"><span class="lineno"> 8841</span>                    workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#af7a708a9761e6d8a53980eaaf9fed88a">conn</a>-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a>,</div>
<div class="line"><span class="lineno"> 8842</span>                    workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a0b4e775a7d98cc43da1e41857ed991ab">f_ha1</a>,</div>
<div class="line"><span class="lineno"> 8843</span>                    workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a9dfdd624bbfe958b7f86a3648ce05327">ah</a>.<a class="code hl_variable" href="structah.html#a59c7740a15ab7012717e3d181a0915ac">uri</a>,</div>
<div class="line"><span class="lineno"> 8844</span>                    workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a9dfdd624bbfe958b7f86a3648ce05327">ah</a>.<a class="code hl_variable" href="structah.html#a231eacaa1fb35d4b80dca8b15bc5be67">nonce</a>,</div>
<div class="line"><span class="lineno"> 8845</span>                    workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a9dfdd624bbfe958b7f86a3648ce05327">ah</a>.<a class="code hl_variable" href="structah.html#a215c0ed8072571b8c43a66ddbc2fc478">nc</a>,</div>
<div class="line"><span class="lineno"> 8846</span>                    workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a9dfdd624bbfe958b7f86a3648ce05327">ah</a>.<a class="code hl_variable" href="structah.html#a4440fb3ea2df6ae670ceaffb35343fea">cnonce</a>,</div>
<div class="line"><span class="lineno"> 8847</span>                    workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a9dfdd624bbfe958b7f86a3648ce05327">ah</a>.<a class="code hl_variable" href="structah.html#ad75d946f91b89809f25620a78124c017">qop</a>,</div>
<div class="line"><span class="lineno"> 8848</span>                    workdata-&gt;<a class="code hl_variable" href="structread__auth__file__struct.html#a9dfdd624bbfe958b7f86a3648ce05327">ah</a>.<a class="code hl_variable" href="structah.html#ad7ad138100657d792ece1eb9f2a5046c">response</a>);</div>
<div class="line"><span class="lineno"> 8849</span>            <span class="keywordflow">default</span>: <span class="comment">/* None/Other/Unknown */</span></div>
<div class="line"><span class="lineno"> 8850</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 8851</span>            }</div>
<div class="line"><span class="lineno"> 8852</span>        }</div>
<div class="line"><span class="lineno"> 8853</span>    }</div>
<div class="line"><span class="lineno"> 8854</span> </div>
<div class="line"><span class="lineno"> 8855</span>    <span class="keywordflow">return</span> is_authorized;</div>
<div class="line"><span class="lineno"> 8856</span>}</div>
<div class="ttc" id="acivetweb_8c_html_ad5152c8a0667f633bdb0d7b97bca75c3"><div class="ttname"><a href="#ad5152c8a0667f633bdb0d7b97bca75c3">check_password_digest</a></div><div class="ttdeci">static int check_password_digest(const char *method, const char *ha1, const char *uri, const char *nonce, const char *nc, const char *cnonce, const char *qop, const char *response)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08427">civetweb.c:8427</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad749ad33438ec816162818fd6974a433"><div class="ttname"><a href="#ad749ad33438ec816162818fd6974a433">mg_fgets</a></div><div class="ttdeci">static const char * mg_fgets(char *buf, size_t size, struct mg_file *filep)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08696">civetweb.c:8696</a></div></div>
<div class="ttc" id="astructread__auth__file__struct_html_a0b4e775a7d98cc43da1e41857ed991ab"><div class="ttname"><a href="structread__auth__file__struct.html#a0b4e775a7d98cc43da1e41857ed991ab">read_auth_file_struct::f_ha1</a></div><div class="ttdeci">const char * f_ha1</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08728">civetweb.c:8728</a></div></div>
<div class="ttc" id="astructread__auth__file__struct_html_a58d5b82f976a952b69400f93a277fb3e"><div class="ttname"><a href="structread__auth__file__struct.html#a58d5b82f976a952b69400f93a277fb3e">read_auth_file_struct::f_domain</a></div><div class="ttdeci">const char * f_domain</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08727">civetweb.c:8727</a></div></div>
<div class="ttc" id="astructread__auth__file__struct_html_a592656059a3218c376f18ebcf6d3e6a3"><div class="ttname"><a href="structread__auth__file__struct.html#a592656059a3218c376f18ebcf6d3e6a3">read_auth_file_struct::f_user</a></div><div class="ttdeci">const char * f_user</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08726">civetweb.c:8726</a></div></div>
<div class="ttc" id="astructread__auth__file__struct_html_a59600288698c720706fad2054a1d7d4b"><div class="ttname"><a href="structread__auth__file__struct.html#a59600288698c720706fad2054a1d7d4b">read_auth_file_struct::domain</a></div><div class="ttdeci">const char * domain</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08724">civetweb.c:8724</a></div></div>
<div class="ttc" id="astructread__auth__file__struct_html_a9dfdd624bbfe958b7f86a3648ce05327"><div class="ttname"><a href="structread__auth__file__struct.html#a9dfdd624bbfe958b7f86a3648ce05327">read_auth_file_struct::ah</a></div><div class="ttdeci">struct ah ah</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l08723">civetweb.c:8723</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l08723">read_auth_file_struct::ah</a>, <a class="el" href="civetweb_8c_source.html#l08725">read_auth_file_struct::buf</a>, <a class="el" href="civetweb_8c_source.html#l08427">check_password_digest()</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::cnonce</a>, <a class="el" href="civetweb_8c_source.html#l08722">read_auth_file_struct::conn</a>, <a class="el" href="deprecated_2gthread_8h_source.html#l00002">depth</a>, <a class="el" href="civetweb_8c_source.html#l08724">read_auth_file_struct::domain</a>, <a class="el" href="civetweb_8c_source.html#l08727">read_auth_file_struct::f_domain</a>, <a class="el" href="civetweb_8c_source.html#l08728">read_auth_file_struct::f_ha1</a>, <a class="el" href="civetweb_8c_source.html#l08726">read_auth_file_struct::f_user</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l02986">mg_fclose()</a>, <a class="el" href="civetweb_8c_source.html#l08696">mg_fgets()</a>, <a class="el" href="civetweb_8c_source.html#l02915">mg_fopen()</a>, <a class="el" href="civetweb_8c_source.html#l02843">MG_FOPEN_MODE_READ</a>, <a class="el" href="civetweb_8c_source.html#l08404">mg_md5()</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::nc</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::nonce</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l08548">ah::plain_password</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::qop</a>, <a class="el" href="civetweb_8c_source.html#l08733">read_auth_file()</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::response</a>, <a class="el" href="civetweb_8c_source.html#l08547">ah::type</a>, <a class="el" href="civetweb_8c_source.html#l08549">ah::uri</a>, and <a class="el" href="civetweb_8c_source.html#l08546">ah::user</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08861">authorize()</a>, and <a class="el" href="civetweb_8c_source.html#l08733">read_auth_file()</a>.</p>

</div>
</div>
<a id="ab8b35962b277d0cc31f7e16541b326ea" name="ab8b35962b277d0cc31f7e16541b326ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8b35962b277d0cc31f7e16541b326ea">&#9670;&#160;</a></span>read_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int read_message </td>
          <td>(</td>
          <td class="paramtype">FILE *</td>          <td class="paramname"><span class="paramname"><em>fp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>bufsiz</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>nread</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l11107">11107</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">11112</span>{</div>
<div class="line"><span class="lineno">11113</span>    <span class="keywordtype">int</span> request_len, n = 0;</div>
<div class="line"><span class="lineno">11114</span>    <span class="keyword">struct </span>timespec last_action_time;</div>
<div class="line"><span class="lineno">11115</span>    <span class="keywordtype">double</span> request_timeout;</div>
<div class="line"><span class="lineno">11116</span> </div>
<div class="line"><span class="lineno">11117</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno">11118</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">11119</span>    }</div>
<div class="line"><span class="lineno">11120</span> </div>
<div class="line"><span class="lineno">11121</span>    memset(&amp;last_action_time, 0, <span class="keyword">sizeof</span>(last_action_time));</div>
<div class="line"><span class="lineno">11122</span> </div>
<div class="line"><span class="lineno">11123</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>]) {</div>
<div class="line"><span class="lineno">11124</span>        <span class="comment">/* value of request_timeout is in seconds, config in milliseconds */</span></div>
<div class="line"><span class="lineno">11125</span>        request_timeout =</div>
<div class="line"><span class="lineno">11126</span>            strtod(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>], <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) / 1000.0;</div>
<div class="line"><span class="lineno">11127</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">11128</span>        request_timeout =</div>
<div class="line"><span class="lineno">11129</span>            strtod(<a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>].default_value, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">11130</span>            / 1000.0;</div>
<div class="line"><span class="lineno">11131</span>    }</div>
<div class="line"><span class="lineno">11132</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ad423caedb8c37f057f26a96153fd5e72">handled_requests</a> &gt; 0) {</div>
<div class="line"><span class="lineno">11133</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba79dc6ec73a693de1fbe2397ce42af360">KEEP_ALIVE_TIMEOUT</a>]) {</div>
<div class="line"><span class="lineno">11134</span>            request_timeout =</div>
<div class="line"><span class="lineno">11135</span>                strtod(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba79dc6ec73a693de1fbe2397ce42af360">KEEP_ALIVE_TIMEOUT</a>], <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">11136</span>                / 1000.0;</div>
<div class="line"><span class="lineno">11137</span>        }</div>
<div class="line"><span class="lineno">11138</span>    }</div>
<div class="line"><span class="lineno">11139</span> </div>
<div class="line"><span class="lineno">11140</span>    request_len = <a class="code hl_function" href="#aac32d22dcddea6592a3772d746edf5bb">get_http_header_len</a>(buf, *nread);</div>
<div class="line"><span class="lineno">11141</span> </div>
<div class="line"><span class="lineno">11142</span>    <span class="keywordflow">while</span> (request_len == 0) {</div>
<div class="line"><span class="lineno">11143</span>        <span class="comment">/* Full request not yet received */</span></div>
<div class="line"><span class="lineno">11144</span>        <span class="keywordflow">if</span> (!<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno">11145</span>            <span class="comment">/* Server is to be stopped. */</span></div>
<div class="line"><span class="lineno">11146</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11147</span>        }</div>
<div class="line"><span class="lineno">11148</span> </div>
<div class="line"><span class="lineno">11149</span>        <span class="keywordflow">if</span> (*nread &gt;= bufsiz) {</div>
<div class="line"><span class="lineno">11150</span>            <span class="comment">/* Request too long */</span></div>
<div class="line"><span class="lineno">11151</span>            <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno">11152</span>        }</div>
<div class="line"><span class="lineno">11153</span> </div>
<div class="line"><span class="lineno">11154</span>        n = <a class="code hl_function" href="#a57991f1957263ffb56e7411155766204">pull_inner</a>(</div>
<div class="line"><span class="lineno">11155</span>            fp, conn, buf + *nread, bufsiz - *nread, request_timeout);</div>
<div class="line"><span class="lineno">11156</span>        <span class="keywordflow">if</span> (n == -2) {</div>
<div class="line"><span class="lineno">11157</span>            <span class="comment">/* Receive error */</span></div>
<div class="line"><span class="lineno">11158</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11159</span>        }</div>
<div class="line"><span class="lineno">11160</span> </div>
<div class="line"><span class="lineno">11161</span>        <span class="comment">/* update clock after every read request */</span></div>
<div class="line"><span class="lineno">11162</span>        clock_gettime(CLOCK_MONOTONIC, &amp;last_action_time);</div>
<div class="line"><span class="lineno">11163</span> </div>
<div class="line"><span class="lineno">11164</span>        <span class="keywordflow">if</span> (n &gt; 0) {</div>
<div class="line"><span class="lineno">11165</span>            *nread += n;</div>
<div class="line"><span class="lineno">11166</span>            request_len = <a class="code hl_function" href="#aac32d22dcddea6592a3772d746edf5bb">get_http_header_len</a>(buf, *nread);</div>
<div class="line"><span class="lineno">11167</span>        }</div>
<div class="line"><span class="lineno">11168</span> </div>
<div class="line"><span class="lineno">11169</span>        <span class="keywordflow">if</span> ((request_len == 0) &amp;&amp; (request_timeout &gt;= 0)) {</div>
<div class="line"><span class="lineno">11170</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac54e1770467596ef9b50e658a2672a6c">mg_difftimespec</a>(&amp;last_action_time, &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a1b122ac1a6e7d536f2b0c8e8b94cdf26">req_time</a>))</div>
<div class="line"><span class="lineno">11171</span>                &gt; request_timeout) {</div>
<div class="line"><span class="lineno">11172</span>                <span class="comment">/* Timeout */</span></div>
<div class="line"><span class="lineno">11173</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">11174</span>            }</div>
<div class="line"><span class="lineno">11175</span>        }</div>
<div class="line"><span class="lineno">11176</span>    }</div>
<div class="line"><span class="lineno">11177</span> </div>
<div class="line"><span class="lineno">11178</span>    <span class="keywordflow">return</span> request_len;</div>
<div class="line"><span class="lineno">11179</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l07952">get_http_header_len()</a>, <a class="el" href="civetweb_8c_source.html#l02554">mg_connection::handled_requests</a>, <a class="el" href="civetweb_8c_source.html#l01938">KEEP_ALIVE_TIMEOUT</a>, <a class="el" href="civetweb_8c_source.html#l03364">mg_difftimespec()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l06210">pull_inner()</a>, <a class="el" href="civetweb_8c_source.html#l02515">mg_connection::req_time</a>, <a class="el" href="civetweb_8c_source.html#l01937">REQUEST_TIMEOUT</a>, <a class="el" href="civetweb_8c_source.html#l02373">mg_context::stop_flag</a>, and <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18569">get_message()</a>, and <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>.</p>

</div>
</div>
<a id="a0a99e300d992194966483f9d6e77f214" name="a0a99e300d992194966483f9d6e77f214"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a99e300d992194966483f9d6e77f214">&#9670;&#160;</a></span>redirect_to_https_port()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void redirect_to_https_port </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>port</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14235">14235</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14236</span>{</div>
<div class="line"><span class="lineno">14237</span>    <span class="keywordtype">char</span> target_url[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno">14238</span>    <span class="keywordtype">int</span> truncated = 0;</div>
<div class="line"><span class="lineno">14239</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *expect_proto =</div>
<div class="line"><span class="lineno">14240</span>        (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436">PROTOCOL_TYPE_WEBSOCKET</a>) ? <span class="stringliteral">&quot;wss&quot;</span> : <span class="stringliteral">&quot;https&quot;</span>;</div>
<div class="line"><span class="lineno">14241</span> </div>
<div class="line"><span class="lineno">14242</span>    <span class="comment">/* Use &quot;308 Permanent Redirect&quot; */</span></div>
<div class="line"><span class="lineno">14243</span>    <span class="keywordtype">int</span> redirect_code = 308;</div>
<div class="line"><span class="lineno">14244</span> </div>
<div class="line"><span class="lineno">14245</span>    <span class="comment">/* In any case, close the current connection */</span></div>
<div class="line"><span class="lineno">14246</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno">14247</span> </div>
<div class="line"><span class="lineno">14248</span>    <span class="comment">/* Send host, port, uri and (if it exists) ?query_string */</span></div>
<div class="line"><span class="lineno">14249</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#acb99501ab73e2f08414accf1a7d108c1">mg_construct_local_link</a>(</div>
<div class="line"><span class="lineno">14250</span>            conn, target_url, <span class="keyword">sizeof</span>(target_url), expect_proto, port, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">14251</span>        &lt; 0) {</div>
<div class="line"><span class="lineno">14252</span>        truncated = 1;</div>
<div class="line"><span class="lineno">14253</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14254</span>        <span class="keywordtype">size_t</span> slen1 = strlen(target_url);</div>
<div class="line"><span class="lineno">14255</span>        <span class="keywordtype">size_t</span> slen2 = strlen(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>);</div>
<div class="line"><span class="lineno">14256</span>        <span class="keywordflow">if</span> ((slen1 + slen2 + 2) &lt; <span class="keyword">sizeof</span>(target_url)) {</div>
<div class="line"><span class="lineno">14257</span>            target_url[slen1] = <span class="charliteral">&#39;?&#39;</span>;</div>
<div class="line"><span class="lineno">14258</span>            memcpy(target_url + slen1 + 1,</div>
<div class="line"><span class="lineno">14259</span>                   conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a918f473c007e03c3f4ac3a35af8c22f5">query_string</a>,</div>
<div class="line"><span class="lineno">14260</span>                   slen2);</div>
<div class="line"><span class="lineno">14261</span>            target_url[slen1 + slen2 + 1] = 0;</div>
<div class="line"><span class="lineno">14262</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14263</span>            truncated = 1;</div>
<div class="line"><span class="lineno">14264</span>        }</div>
<div class="line"><span class="lineno">14265</span>    }</div>
<div class="line"><span class="lineno">14266</span> </div>
<div class="line"><span class="lineno">14267</span>    <span class="comment">/* Check overflow in location buffer (will not occur if MG_BUF_LEN</span></div>
<div class="line"><span class="lineno">14268</span><span class="comment">     * is used as buffer size) */</span></div>
<div class="line"><span class="lineno">14269</span>    <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno">14270</span>        <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(conn, 500, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Redirect URL too long&quot;</span>);</div>
<div class="line"><span class="lineno">14271</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">14272</span>    }</div>
<div class="line"><span class="lineno">14273</span> </div>
<div class="line"><span class="lineno">14274</span>    <span class="comment">/* Use redirect helper function */</span></div>
<div class="line"><span class="lineno">14275</span>    <a class="code hl_function" href="#acbacd157c3e4a32ef99a0088a36e06af">mg_send_http_redirect</a>(conn, target_url, redirect_code);</div>
<div class="line"><span class="lineno">14276</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l04618">mg_send_http_redirect()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, <a class="el" href="civetweb_8c_source.html#l02467">PROTOCOL_TYPE_WEBSOCKET</a>, <a class="el" href="civetweb_8h_source.html#l00162">mg_request_info::query_string</a>, and <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="ac8716e2019c3e5ecd4abc75a272d7aa7" name="ac8716e2019c3e5ecd4abc75a272d7aa7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8716e2019c3e5ecd4abc75a272d7aa7">&#9670;&#160;</a></span>refresh_trust()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int refresh_trust </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16377">16377</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16378</span>{</div>
<div class="line"><span class="lineno">16379</span>    <span class="keyword">struct </span>stat cert_buf;</div>
<div class="line"><span class="lineno">16380</span>    int64_t t = 0;</div>
<div class="line"><span class="lineno">16381</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *pem;</div>
<div class="line"><span class="lineno">16382</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *chain;</div>
<div class="line"><span class="lineno">16383</span>    <span class="keywordtype">int</span> should_verify_peer;</div>
<div class="line"><span class="lineno">16384</span> </div>
<div class="line"><span class="lineno">16385</span>    <span class="keywordflow">if</span> ((pem = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1bb8ebf1124ab1bb589866f06e54e71f">SSL_CERTIFICATE</a>]) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16386</span>        <span class="comment">/* If pem is NULL and conn-&gt;phys_ctx-&gt;callbacks.init_ssl is not,</span></div>
<div class="line"><span class="lineno">16387</span><span class="comment">         * refresh_trust still can not work. */</span></div>
<div class="line"><span class="lineno">16388</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16389</span>    }</div>
<div class="line"><span class="lineno">16390</span>    chain = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baacb7b39407a541fbda68aafd33193470">SSL_CERTIFICATE_CHAIN</a>];</div>
<div class="line"><span class="lineno">16391</span>    <span class="keywordflow">if</span> (chain == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16392</span>        <span class="comment">/* pem is not NULL here */</span></div>
<div class="line"><span class="lineno">16393</span>        chain = pem;</div>
<div class="line"><span class="lineno">16394</span>    }</div>
<div class="line"><span class="lineno">16395</span>    <span class="keywordflow">if</span> (*chain == 0) {</div>
<div class="line"><span class="lineno">16396</span>        chain = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16397</span>    }</div>
<div class="line"><span class="lineno">16398</span> </div>
<div class="line"><span class="lineno">16399</span>    <span class="keywordflow">if</span> (stat(pem, &amp;cert_buf) != -1) {</div>
<div class="line"><span class="lineno">16400</span>        t = (int64_t)cert_buf.st_mtime;</div>
<div class="line"><span class="lineno">16401</span>    }</div>
<div class="line"><span class="lineno">16402</span> </div>
<div class="line"><span class="lineno">16403</span>    <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">16404</span>    <span class="keywordflow">if</span> ((t != 0) &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a2a86de044bdca60690b7fca15143bdb3">ssl_cert_last_mtime</a> != t)) {</div>
<div class="line"><span class="lineno">16405</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a2a86de044bdca60690b7fca15143bdb3">ssl_cert_last_mtime</a> = t;</div>
<div class="line"><span class="lineno">16406</span> </div>
<div class="line"><span class="lineno">16407</span>        should_verify_peer = 0;</div>
<div class="line"><span class="lineno">16408</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac">SSL_DO_VERIFY_PEER</a>] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16409</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac">SSL_DO_VERIFY_PEER</a>], <span class="stringliteral">&quot;yes&quot;</span>)</div>
<div class="line"><span class="lineno">16410</span>                == 0) {</div>
<div class="line"><span class="lineno">16411</span>                should_verify_peer = 1;</div>
<div class="line"><span class="lineno">16412</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba1a1d5c8e8fbb82c5fbe8d0e9f42dfaac">SSL_DO_VERIFY_PEER</a>],</div>
<div class="line"><span class="lineno">16413</span>                                     <span class="stringliteral">&quot;optional&quot;</span>)</div>
<div class="line"><span class="lineno">16414</span>                       == 0) {</div>
<div class="line"><span class="lineno">16415</span>                should_verify_peer = 1;</div>
<div class="line"><span class="lineno">16416</span>            }</div>
<div class="line"><span class="lineno">16417</span>        }</div>
<div class="line"><span class="lineno">16418</span> </div>
<div class="line"><span class="lineno">16419</span>        <span class="keywordflow">if</span> (should_verify_peer) {</div>
<div class="line"><span class="lineno">16420</span>            <span class="keywordtype">char</span> *ca_path = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba3e3b29034498dd70486ada574bcd4d6d">SSL_CA_PATH</a>];</div>
<div class="line"><span class="lineno">16421</span>            <span class="keywordtype">char</span> *ca_file = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baeae84e3e129de97ee8fdad5fd628683f">SSL_CA_FILE</a>];</div>
<div class="line"><span class="lineno">16422</span>            <span class="keywordflow">if</span> (SSL_CTX_load_verify_locations(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>,</div>
<div class="line"><span class="lineno">16423</span>                                              ca_file,</div>
<div class="line"><span class="lineno">16424</span>                                              ca_path)</div>
<div class="line"><span class="lineno">16425</span>                != 1) {</div>
<div class="line"><span class="lineno">16426</span>                <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">16427</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(</div>
<div class="line"><span class="lineno">16428</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>,</div>
<div class="line"><span class="lineno">16429</span>                    <span class="stringliteral">&quot;SSL_CTX_load_verify_locations error: %s &quot;</span></div>
<div class="line"><span class="lineno">16430</span>                    <span class="stringliteral">&quot;ssl_verify_peer requires setting &quot;</span></div>
<div class="line"><span class="lineno">16431</span>                    <span class="stringliteral">&quot;either ssl_ca_path or ssl_ca_file. Is any of them &quot;</span></div>
<div class="line"><span class="lineno">16432</span>                    <span class="stringliteral">&quot;present in &quot;</span></div>
<div class="line"><span class="lineno">16433</span>                    <span class="stringliteral">&quot;the .conf file?&quot;</span>,</div>
<div class="line"><span class="lineno">16434</span>                    <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">16435</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16436</span>            }</div>
<div class="line"><span class="lineno">16437</span>        }</div>
<div class="line"><span class="lineno">16438</span> </div>
<div class="line"><span class="lineno">16439</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a36ba2de78f1cacfe1b95106a834b970d">ssl_use_pem_file</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>, pem, chain) == 0) {</div>
<div class="line"><span class="lineno">16440</span>            <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">16441</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16442</span>        }</div>
<div class="line"><span class="lineno">16443</span>    }</div>
<div class="line"><span class="lineno">16444</span>    <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">16445</span> </div>
<div class="line"><span class="lineno">16446</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">16447</span>}</div>
<div class="ttc" id="astructmg__domain__context_html_a2a86de044bdca60690b7fca15143bdb3"><div class="ttname"><a href="structmg__domain__context.html#a2a86de044bdca60690b7fca15143bdb3">mg_domain_context::ssl_cert_last_mtime</a></div><div class="ttdeci">int64_t ssl_cert_last_mtime</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l02273">civetweb.c:2273</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02015">SSL_CA_FILE</a>, <a class="el" href="civetweb_8c_source.html#l02014">SSL_CA_PATH</a>, <a class="el" href="civetweb_8c_source.html#l02273">mg_domain_context::ssl_cert_last_mtime</a>, <a class="el" href="civetweb_8c_source.html#l02008">SSL_CERTIFICATE</a>, <a class="el" href="civetweb_8c_source.html#l02009">SSL_CERTIFICATE_CHAIN</a>, <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02012">SSL_DO_VERIFY_PEER</a>, <a class="el" href="civetweb_8c_source.html#l16585">ssl_error()</a>, and <a class="el" href="civetweb_8c_source.html#l16940">ssl_use_pem_file()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>.</p>

</div>
</div>
<a id="a96d08ddca4fe56dbb1647c8e250db9b3" name="a96d08ddca4fe56dbb1647c8e250db9b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96d08ddca4fe56dbb1647c8e250db9b3">&#9670;&#160;</a></span>release_handler_ref()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void release_handler_ref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__handler__info.html">mg_handler_info</a> *</td>          <td class="paramname"><span class="paramname"><em>handler_info</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14687">14687</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14689</span>{</div>
<div class="line"><span class="lineno">14690</span>    <span class="keywordflow">if</span> (handler_info != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14691</span>        <span class="comment">/* Use context lock for ref counter */</span></div>
<div class="line"><span class="lineno">14692</span>        <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">14693</span>        handler_info-&gt;<a class="code hl_variable" href="structmg__handler__info.html#a79608a153a2518c199d63e4129b2ec11">refcount</a>--;</div>
<div class="line"><span class="lineno">14694</span>        <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">14695</span>    }</div>
<div class="line"><span class="lineno">14696</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, and <a class="el" href="civetweb_8c_source.html#l02238">mg_handler_info::refcount</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a0e117d579dddd909e2370d437c566cf1" name="a0e117d579dddd909e2370d437c566cf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e117d579dddd909e2370d437c566cf1">&#9670;&#160;</a></span>remove_bad_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void remove_bad_file </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10609">10609</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10610</span>{</div>
<div class="line"><span class="lineno">10611</span>    <span class="keywordtype">int</span> r = <a class="code hl_define" href="#a3b7e572b06c0a0d1c920572523fbe01d">mg_remove</a>(conn, path);</div>
<div class="line"><span class="lineno">10612</span>    <span class="keywordflow">if</span> (r != 0) {</div>
<div class="line"><span class="lineno">10613</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">10614</span>                        <span class="stringliteral">&quot;%s: Cannot remove invalid file %s&quot;</span>,</div>
<div class="line"><span class="lineno">10615</span>                        __func__,</div>
<div class="line"><span class="lineno">10616</span>                        path);</div>
<div class="line"><span class="lineno">10617</span>    }</div>
<div class="line"><span class="lineno">10618</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, and <a class="el" href="civetweb_8c_source.html#l00919">mg_remove</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10622">mg_store_body()</a>.</p>

</div>
</div>
<a id="ad26006f44f84ee1b4e9d5e039f779b51" name="ad26006f44f84ee1b4e9d5e039f779b51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad26006f44f84ee1b4e9d5e039f779b51">&#9670;&#160;</a></span>remove_directory()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int remove_directory </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>dir</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09836">9836</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9837</span>{</div>
<div class="line"><span class="lineno"> 9838</span>    <span class="keywordtype">char</span> path[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>];</div>
<div class="line"><span class="lineno"> 9839</span>    <span class="keyword">struct </span>dirent *dp;</div>
<div class="line"><span class="lineno"> 9840</span>    DIR *dirp;</div>
<div class="line"><span class="lineno"> 9841</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structde.html">de</a> <a class="code hl_struct" href="structde.html">de</a>;</div>
<div class="line"><span class="lineno"> 9842</span>    <span class="keywordtype">int</span> truncated;</div>
<div class="line"><span class="lineno"> 9843</span>    <span class="keywordtype">int</span> ok = 1;</div>
<div class="line"><span class="lineno"> 9844</span> </div>
<div class="line"><span class="lineno"> 9845</span>    <span class="keywordflow">if</span> ((dirp = <a class="code hl_define" href="#a1ff1ea4e3e6c59f0e144bd91366fe2d9">mg_opendir</a>(conn, dir)) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9846</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9847</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 9848</span> </div>
<div class="line"><span class="lineno"> 9849</span>        <span class="keywordflow">while</span> ((dp = <a class="code hl_define" href="#a0387536c403dfeff474b0bb940156908">mg_readdir</a>(dirp)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9850</span>            <span class="comment">/* Do not show current dir (but show hidden files as they will</span></div>
<div class="line"><span class="lineno"> 9851</span><span class="comment">             * also be removed) */</span></div>
<div class="line"><span class="lineno"> 9852</span>            <span class="keywordflow">if</span> (!strcmp(dp-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>) || !strcmp(dp-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 9853</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 9854</span>            }</div>
<div class="line"><span class="lineno"> 9855</span> </div>
<div class="line"><span class="lineno"> 9856</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(</div>
<div class="line"><span class="lineno"> 9857</span>                conn, &amp;truncated, path, <span class="keyword">sizeof</span>(path), <span class="stringliteral">&quot;%s/%s&quot;</span>, dir, dp-&gt;d_name);</div>
<div class="line"><span class="lineno"> 9858</span> </div>
<div class="line"><span class="lineno"> 9859</span>            <span class="comment">/* If we don&#39;t memset stat structure to zero, mtime will have</span></div>
<div class="line"><span class="lineno"> 9860</span><span class="comment">             * garbage and strftime() will segfault later on in</span></div>
<div class="line"><span class="lineno"> 9861</span><span class="comment">             * print_dir_entry(). memset is required only if mg_stat()</span></div>
<div class="line"><span class="lineno"> 9862</span><span class="comment">             * fails. For more details, see</span></div>
<div class="line"><span class="lineno"> 9863</span><span class="comment">             * http://code.google.com/p/mongoose/issues/detail?id=79 */</span></div>
<div class="line"><span class="lineno"> 9864</span>            memset(&amp;<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>));</div>
<div class="line"><span class="lineno"> 9865</span> </div>
<div class="line"><span class="lineno"> 9866</span>            <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno"> 9867</span>                <span class="comment">/* Do not delete anything shorter */</span></div>
<div class="line"><span class="lineno"> 9868</span>                ok = 0;</div>
<div class="line"><span class="lineno"> 9869</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 9870</span>            }</div>
<div class="line"><span class="lineno"> 9871</span> </div>
<div class="line"><span class="lineno"> 9872</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path, &amp;<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>)) {</div>
<div class="line"><span class="lineno"> 9873</span>                <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno"> 9874</span>                                <span class="stringliteral">&quot;%s: mg_stat(%s) failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9875</span>                                __func__,</div>
<div class="line"><span class="lineno"> 9876</span>                                path,</div>
<div class="line"><span class="lineno"> 9877</span>                                strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 9878</span>                ok = 0;</div>
<div class="line"><span class="lineno"> 9879</span>            }</div>
<div class="line"><span class="lineno"> 9880</span> </div>
<div class="line"><span class="lineno"> 9881</span>            <span class="keywordflow">if</span> (<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>.<a class="code hl_variable" href="structmg__file__stat.html#a87c1476af755c86fc992b2fff8b210f6">is_directory</a>) {</div>
<div class="line"><span class="lineno"> 9882</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="#ad26006f44f84ee1b4e9d5e039f779b51">remove_directory</a>(conn, path) == 0) {</div>
<div class="line"><span class="lineno"> 9883</span>                    ok = 0;</div>
<div class="line"><span class="lineno"> 9884</span>                }</div>
<div class="line"><span class="lineno"> 9885</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 9886</span>                <span class="comment">/* This will fail file is the file is in memory */</span></div>
<div class="line"><span class="lineno"> 9887</span>                <span class="keywordflow">if</span> (<a class="code hl_define" href="#a3b7e572b06c0a0d1c920572523fbe01d">mg_remove</a>(conn, path) == 0) {</div>
<div class="line"><span class="lineno"> 9888</span>                    ok = 0;</div>
<div class="line"><span class="lineno"> 9889</span>                }</div>
<div class="line"><span class="lineno"> 9890</span>            }</div>
<div class="line"><span class="lineno"> 9891</span>        }</div>
<div class="line"><span class="lineno"> 9892</span>        (void)<a class="code hl_define" href="#a2b5e30d60439015dee1c473ebc4f4ce9">mg_closedir</a>(dirp);</div>
<div class="line"><span class="lineno"> 9893</span> </div>
<div class="line"><span class="lineno"> 9894</span>        <a class="code hl_define" href="#ad78a7b8419e5ec9f2cc7d310fcf142d7">IGNORE_UNUSED_RESULT</a>(rmdir(dir));</div>
<div class="line"><span class="lineno"> 9895</span>    }</div>
<div class="line"><span class="lineno"> 9896</span> </div>
<div class="line"><span class="lineno"> 9897</span>    <span class="keywordflow">return</span> ok;</div>
<div class="line"><span class="lineno"> 9898</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a0387536c403dfeff474b0bb940156908"><div class="ttname"><a href="#a0387536c403dfeff474b0bb940156908">mg_readdir</a></div><div class="ttdeci">#define mg_readdir(x)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00923">civetweb.c:923</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a1ff1ea4e3e6c59f0e144bd91366fe2d9"><div class="ttname"><a href="#a1ff1ea4e3e6c59f0e144bd91366fe2d9">mg_opendir</a></div><div class="ttdeci">#define mg_opendir(conn, x)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00921">civetweb.c:921</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a2b5e30d60439015dee1c473ebc4f4ce9"><div class="ttname"><a href="#a2b5e30d60439015dee1c473ebc4f4ce9">mg_closedir</a></div><div class="ttdeci">#define mg_closedir(x)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l00922">civetweb.c:922</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l02579">de::file</a>, <a class="el" href="civetweb_8c_source.html#l00291">IGNORE_UNUSED_RESULT</a>, <a class="el" href="civetweb_8c_source.html#l01873">mg_file_stat::is_directory</a>, <a class="el" href="civetweb_8c_source.html#l00922">mg_closedir</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l00921">mg_opendir</a>, <a class="el" href="civetweb_8c_source.html#l00923">mg_readdir</a>, <a class="el" href="civetweb_8c_source.html#l00919">mg_remove</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>, and <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12293">delete_file()</a>, and <a class="el" href="civetweb_8c_source.html#l09836">remove_directory()</a>.</p>

</div>
</div>
<a id="abf6e864c64e3f7b5df96cf2c2598f776" name="abf6e864c64e3f7b5df96cf2c2598f776"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf6e864c64e3f7b5df96cf2c2598f776">&#9670;&#160;</a></span>remove_dot_segments()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void remove_dot_segments </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>inout</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08069">8069</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8070</span>{</div>
<div class="line"><span class="lineno"> 8071</span>    <span class="comment">/* Windows backend protection</span></div>
<div class="line"><span class="lineno"> 8072</span><span class="comment">     * (https://tools.ietf.org/html/rfc3986#section-7.3): Replace backslash</span></div>
<div class="line"><span class="lineno"> 8073</span><span class="comment">     * in URI by slash */</span></div>
<div class="line"><span class="lineno"> 8074</span>    <span class="keywordtype">char</span> *out_end = inout;</div>
<div class="line"><span class="lineno"> 8075</span>    <span class="keywordtype">char</span> *in = inout;</div>
<div class="line"><span class="lineno"> 8076</span> </div>
<div class="line"><span class="lineno"> 8077</span>    <span class="keywordflow">if</span> (!in) {</div>
<div class="line"><span class="lineno"> 8078</span>        <span class="comment">/* Param error. */</span></div>
<div class="line"><span class="lineno"> 8079</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 8080</span>    }</div>
<div class="line"><span class="lineno"> 8081</span> </div>
<div class="line"><span class="lineno"> 8082</span>    <span class="keywordflow">while</span> (*in) {</div>
<div class="line"><span class="lineno"> 8083</span>        <span class="keywordflow">if</span> (*in == <span class="charliteral">&#39;\\&#39;</span>) {</div>
<div class="line"><span class="lineno"> 8084</span>            *in = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno"> 8085</span>        }</div>
<div class="line"><span class="lineno"> 8086</span>        in++;</div>
<div class="line"><span class="lineno"> 8087</span>    }</div>
<div class="line"><span class="lineno"> 8088</span> </div>
<div class="line"><span class="lineno"> 8089</span>    <span class="comment">/* Algorithm &quot;remove_dot_segments&quot; from</span></div>
<div class="line"><span class="lineno"> 8090</span><span class="comment">     * https://tools.ietf.org/html/rfc3986#section-5.2.4 */</span></div>
<div class="line"><span class="lineno"> 8091</span>    <span class="comment">/* Step 1:</span></div>
<div class="line"><span class="lineno"> 8092</span><span class="comment">     * The input buffer is initialized.</span></div>
<div class="line"><span class="lineno"> 8093</span><span class="comment">     * The output buffer is initialized to the empty string.</span></div>
<div class="line"><span class="lineno"> 8094</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 8095</span>    in = inout;</div>
<div class="line"><span class="lineno"> 8096</span> </div>
<div class="line"><span class="lineno"> 8097</span>    <span class="comment">/* Step 2:</span></div>
<div class="line"><span class="lineno"> 8098</span><span class="comment">     * While the input buffer is not empty, loop as follows:</span></div>
<div class="line"><span class="lineno"> 8099</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 8100</span>    <span class="comment">/* Less than out_end of the inout buffer is used as output, so keep</span></div>
<div class="line"><span class="lineno"> 8101</span><span class="comment">     * condition: out_end &lt;= in */</span></div>
<div class="line"><span class="lineno"> 8102</span>    <span class="keywordflow">while</span> (*in) {</div>
<div class="line"><span class="lineno"> 8103</span>        <span class="comment">/* Step 2a:</span></div>
<div class="line"><span class="lineno"> 8104</span><span class="comment">         * If the input buffer begins with a prefix of &quot;../&quot; or &quot;./&quot;,</span></div>
<div class="line"><span class="lineno"> 8105</span><span class="comment">         * then remove that prefix from the input buffer;</span></div>
<div class="line"><span class="lineno"> 8106</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 8107</span>        <span class="keywordflow">if</span> (!strncmp(in, <span class="stringliteral">&quot;../&quot;</span>, 3)) {</div>
<div class="line"><span class="lineno"> 8108</span>            in += 3;</div>
<div class="line"><span class="lineno"> 8109</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(in, <span class="stringliteral">&quot;./&quot;</span>, 2)) {</div>
<div class="line"><span class="lineno"> 8110</span>            in += 2;</div>
<div class="line"><span class="lineno"> 8111</span>        }</div>
<div class="line"><span class="lineno"> 8112</span>        <span class="comment">/* otherwise */</span></div>
<div class="line"><span class="lineno"> 8113</span>        <span class="comment">/* Step 2b:</span></div>
<div class="line"><span class="lineno"> 8114</span><span class="comment">         * if the input buffer begins with a prefix of &quot;/./&quot; or &quot;/.&quot;,</span></div>
<div class="line"><span class="lineno"> 8115</span><span class="comment">         * where &quot;.&quot; is a complete path segment, then replace that</span></div>
<div class="line"><span class="lineno"> 8116</span><span class="comment">         * prefix with &quot;/&quot; in the input buffer;</span></div>
<div class="line"><span class="lineno"> 8117</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 8118</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(in, <span class="stringliteral">&quot;/./&quot;</span>, 3)) {</div>
<div class="line"><span class="lineno"> 8119</span>            in += 2;</div>
<div class="line"><span class="lineno"> 8120</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(in, <span class="stringliteral">&quot;/.&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 8121</span>            in[1] = 0;</div>
<div class="line"><span class="lineno"> 8122</span>        }</div>
<div class="line"><span class="lineno"> 8123</span>        <span class="comment">/* otherwise */</span></div>
<div class="line"><span class="lineno"> 8124</span>        <span class="comment">/* Step 2c:</span></div>
<div class="line"><span class="lineno"> 8125</span><span class="comment">         * if the input buffer begins with a prefix of &quot;/../&quot; or &quot;/..&quot;,</span></div>
<div class="line"><span class="lineno"> 8126</span><span class="comment">         * where &quot;..&quot; is a complete path segment, then replace that</span></div>
<div class="line"><span class="lineno"> 8127</span><span class="comment">         * prefix with &quot;/&quot; in the input buffer and remove the last</span></div>
<div class="line"><span class="lineno"> 8128</span><span class="comment">         * segment and its preceding &quot;/&quot; (if any) from the output</span></div>
<div class="line"><span class="lineno"> 8129</span><span class="comment">         * buffer;</span></div>
<div class="line"><span class="lineno"> 8130</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 8131</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(in, <span class="stringliteral">&quot;/../&quot;</span>, 4)) {</div>
<div class="line"><span class="lineno"> 8132</span>            in += 3;</div>
<div class="line"><span class="lineno"> 8133</span>            <span class="keywordflow">if</span> (inout != out_end) {</div>
<div class="line"><span class="lineno"> 8134</span>                <span class="comment">/* remove last segment */</span></div>
<div class="line"><span class="lineno"> 8135</span>                <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 8136</span>                    out_end--;</div>
<div class="line"><span class="lineno"> 8137</span>                } <span class="keywordflow">while</span> ((inout != out_end) &amp;&amp; (*out_end != <span class="charliteral">&#39;/&#39;</span>));</div>
<div class="line"><span class="lineno"> 8138</span>            }</div>
<div class="line"><span class="lineno"> 8139</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(in, <span class="stringliteral">&quot;/..&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 8140</span>            in[1] = 0;</div>
<div class="line"><span class="lineno"> 8141</span>            <span class="keywordflow">if</span> (inout != out_end) {</div>
<div class="line"><span class="lineno"> 8142</span>                <span class="comment">/* remove last segment */</span></div>
<div class="line"><span class="lineno"> 8143</span>                <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 8144</span>                    out_end--;</div>
<div class="line"><span class="lineno"> 8145</span>                } <span class="keywordflow">while</span> ((inout != out_end) &amp;&amp; (*out_end != <span class="charliteral">&#39;/&#39;</span>));</div>
<div class="line"><span class="lineno"> 8146</span>            }</div>
<div class="line"><span class="lineno"> 8147</span>        }</div>
<div class="line"><span class="lineno"> 8148</span>        <span class="comment">/* otherwise */</span></div>
<div class="line"><span class="lineno"> 8149</span>        <span class="comment">/* Step 2d:</span></div>
<div class="line"><span class="lineno"> 8150</span><span class="comment">         * if the input buffer consists only of &quot;.&quot; or &quot;..&quot;, then remove</span></div>
<div class="line"><span class="lineno"> 8151</span><span class="comment">         * that from the input buffer;</span></div>
<div class="line"><span class="lineno"> 8152</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 8153</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(in, <span class="stringliteral">&quot;.&quot;</span>) || !strcmp(in, <span class="stringliteral">&quot;..&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 8154</span>            *in = 0;</div>
<div class="line"><span class="lineno"> 8155</span>        }</div>
<div class="line"><span class="lineno"> 8156</span>        <span class="comment">/* otherwise */</span></div>
<div class="line"><span class="lineno"> 8157</span>        <span class="comment">/* Step 2e:</span></div>
<div class="line"><span class="lineno"> 8158</span><span class="comment">         * move the first path segment in the input buffer to the end of</span></div>
<div class="line"><span class="lineno"> 8159</span><span class="comment">         * the output buffer, including the initial &quot;/&quot; character (if</span></div>
<div class="line"><span class="lineno"> 8160</span><span class="comment">         * any) and any subsequent characters up to, but not including,</span></div>
<div class="line"><span class="lineno"> 8161</span><span class="comment">         * the next &quot;/&quot; character or the end of the input buffer.</span></div>
<div class="line"><span class="lineno"> 8162</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 8163</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 8164</span>            <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 8165</span>                *out_end = *in;</div>
<div class="line"><span class="lineno"> 8166</span>                out_end++;</div>
<div class="line"><span class="lineno"> 8167</span>                in++;</div>
<div class="line"><span class="lineno"> 8168</span>            } <span class="keywordflow">while</span> ((*in != 0) &amp;&amp; (*in != <span class="charliteral">&#39;/&#39;</span>));</div>
<div class="line"><span class="lineno"> 8169</span>        }</div>
<div class="line"><span class="lineno"> 8170</span>    }</div>
<div class="line"><span class="lineno"> 8171</span> </div>
<div class="line"><span class="lineno"> 8172</span>    <span class="comment">/* Step 3:</span></div>
<div class="line"><span class="lineno"> 8173</span><span class="comment">     * Finally, the output buffer is returned as the result of</span></div>
<div class="line"><span class="lineno"> 8174</span><span class="comment">     * remove_dot_segments.</span></div>
<div class="line"><span class="lineno"> 8175</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 8176</span>    <span class="comment">/* Terminate output */</span></div>
<div class="line"><span class="lineno"> 8177</span>    *out_end = 0;</div>
<div class="line"><span class="lineno"> 8178</span> </div>
<div class="line"><span class="lineno"> 8179</span>    <span class="comment">/* For Windows, the files/folders &quot;x&quot; and &quot;x.&quot; (with a dot but without</span></div>
<div class="line"><span class="lineno"> 8180</span><span class="comment">     * extension) are identical. Replace all &quot;./&quot; by &quot;/&quot; and remove a &quot;.&quot; at</span></div>
<div class="line"><span class="lineno"> 8181</span><span class="comment">     * the end. Also replace all &quot;//&quot; by &quot;/&quot;. Repeat until there is no &quot;./&quot;</span></div>
<div class="line"><span class="lineno"> 8182</span><span class="comment">     * or &quot;//&quot; anymore.</span></div>
<div class="line"><span class="lineno"> 8183</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 8184</span>    out_end = in = inout;</div>
<div class="line"><span class="lineno"> 8185</span>    <span class="keywordflow">while</span> (*in) {</div>
<div class="line"><span class="lineno"> 8186</span>        <span class="keywordflow">if</span> (*in == <span class="charliteral">&#39;.&#39;</span>) {</div>
<div class="line"><span class="lineno"> 8187</span>            <span class="comment">/* remove . at the end or preceding of / */</span></div>
<div class="line"><span class="lineno"> 8188</span>            <span class="keywordtype">char</span> *in_ahead = in;</div>
<div class="line"><span class="lineno"> 8189</span>            <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 8190</span>                in_ahead++;</div>
<div class="line"><span class="lineno"> 8191</span>            } <span class="keywordflow">while</span> (*in_ahead == <span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line"><span class="lineno"> 8192</span>            <span class="keywordflow">if</span> (*in_ahead == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno"> 8193</span>                in = in_ahead;</div>
<div class="line"><span class="lineno"> 8194</span>                <span class="keywordflow">if</span> ((out_end != inout) &amp;&amp; (out_end[-1] == <span class="charliteral">&#39;/&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 8195</span>                    <span class="comment">/* remove generated // */</span></div>
<div class="line"><span class="lineno"> 8196</span>                    out_end--;</div>
<div class="line"><span class="lineno"> 8197</span>                }</div>
<div class="line"><span class="lineno"> 8198</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*in_ahead == 0) {</div>
<div class="line"><span class="lineno"> 8199</span>                in = in_ahead;</div>
<div class="line"><span class="lineno"> 8200</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 8201</span>                <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 8202</span>                    *out_end++ = <span class="charliteral">&#39;.&#39;</span>;</div>
<div class="line"><span class="lineno"> 8203</span>                    in++;</div>
<div class="line"><span class="lineno"> 8204</span>                } <span class="keywordflow">while</span> (in != in_ahead);</div>
<div class="line"><span class="lineno"> 8205</span>            }</div>
<div class="line"><span class="lineno"> 8206</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*in == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno"> 8207</span>            <span class="comment">/* replace // by / */</span></div>
<div class="line"><span class="lineno"> 8208</span>            *out_end++ = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno"> 8209</span>            <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 8210</span>                in++;</div>
<div class="line"><span class="lineno"> 8211</span>            } <span class="keywordflow">while</span> (*in == <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno"> 8212</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 8213</span>            *out_end++ = *in;</div>
<div class="line"><span class="lineno"> 8214</span>            in++;</div>
<div class="line"><span class="lineno"> 8215</span>        }</div>
<div class="line"><span class="lineno"> 8216</span>    }</div>
<div class="line"><span class="lineno"> 8217</span>    *out_end = 0;</div>
<div class="line"><span class="lineno"> 8218</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11994">dav_move_file()</a>, and <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a4724fafa5fdbf347cf779ffe4bc28c23" name="a4724fafa5fdbf347cf779ffe4bc28c23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4724fafa5fdbf347cf779ffe4bc28c23">&#9670;&#160;</a></span>reset_per_request_attributes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void reset_per_request_attributes </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17676">17676</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17677</span>{</div>
<div class="line"><span class="lineno">17678</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno">17679</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">17680</span>    }</div>
<div class="line"><span class="lineno">17681</span> </div>
<div class="line"><span class="lineno">17682</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a482f3e0e76b5e4b885c971ab232f7653">num_bytes_sent</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a271e16e618bd9265577aef7ef5ed637d">consumed_content</a> = 0;</div>
<div class="line"><span class="lineno">17683</span> </div>
<div class="line"><span class="lineno">17684</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a450fa6c33039516685824a5f7fbdcec5">path_info</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17685</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ae0163f2496aed16dc972e2139b66bb93">status_code</a> = -1;</div>
<div class="line"><span class="lineno">17686</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> = -1;</div>
<div class="line"><span class="lineno">17687</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 0;</div>
<div class="line"><span class="lineno">17688</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 0;</div>
<div class="line"><span class="lineno">17689</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a31dff43ab95d3d5e6dde9eb95460fd97">request_len</a> = 0;</div>
<div class="line"><span class="lineno">17690</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a161c1c775b5f3933f8428d4eb1381f52">request_state</a> = 0;</div>
<div class="line"><span class="lineno">17691</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a1253d8e7156cefe37debd0c1aa2b3769">throttle</a> = 0;</div>
<div class="line"><span class="lineno">17692</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aa0fc1462c76f9504a16825147b8db3d1">accept_gzip</a> = 0;</div>
<div class="line"><span class="lineno">17693</span> </div>
<div class="line"><span class="lineno">17694</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a26f05559505cae87828be45aec41a1ed">content_length</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aa1603acb1f2be0de643ebb1e352fdc01">content_length</a> = -1;</div>
<div class="line"><span class="lineno">17695</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a28b0b6daf9b7245b7cefc22b65f377d4">http_version</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#ac9743ffd7a96d700813777ff3d3bc25d">http_version</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17696</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a3becae78e0589983f147dbfd19ae33dc">num_headers</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#afcdf69ee822fd9786f3e30c6d10b192a">num_headers</a> = 0;</div>
<div class="line"><span class="lineno">17697</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#ac1cdea9c63d8fac3ac4b8682441b1a5b">status_text</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17698</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a913c7880b2d750f0c98ab2ace5e59627">response_info</a>.<a class="code hl_variable" href="structmg__response__info.html#a542acffb7657ef2be3ad6f6ef0e3d712">status_code</a> = 0;</div>
<div class="line"><span class="lineno">17699</span> </div>
<div class="line"><span class="lineno">17700</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aea0e44be08a00a1ce0f2a08d034d9c8a">remote_user</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17701</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a70b531b329bd93e4850c2544893fa9a8">request_method</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17702</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#aca4128780e19e761cbcfe286021eefc9">request_uri</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17703</span> </div>
<div class="line"><span class="lineno">17704</span>    <span class="comment">/* Free cleaned local URI (if any) */</span></div>
<div class="line"><span class="lineno">17705</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a> != conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a>) {</div>
<div class="line"><span class="lineno">17706</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>((<span class="keywordtype">void</span> *)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno">17707</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17708</span>    }</div>
<div class="line"><span class="lineno">17709</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17710</span> </div>
<div class="line"><span class="lineno">17711</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">17712</span>    conn-&gt;processing_time = 0;</div>
<div class="line"><span class="lineno">17713</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17714</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02536">mg_connection::accept_gzip</a>, <a class="el" href="civetweb_8c_source.html#l02524">mg_connection::consumed_content</a>, <a class="el" href="civetweb_8c_source.html#l02518">mg_connection::content_len</a>, <a class="el" href="civetweb_8h_source.html#l00168">mg_request_info::content_length</a>, <a class="el" href="civetweb_8h_source.html#l00196">mg_response_info::content_length</a>, <a class="el" href="civetweb_8h_source.html#l00161">mg_request_info::http_version</a>, <a class="el" href="civetweb_8h_source.html#l00194">mg_response_info::http_version</a>, <a class="el" href="civetweb_8c_source.html#l02525">mg_connection::is_chunked</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8h_source.html#l00154">mg_request_info::local_uri_raw</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02517">mg_connection::num_bytes_sent</a>, <a class="el" href="civetweb_8h_source.html#l00178">mg_request_info::num_headers</a>, <a class="el" href="civetweb_8h_source.html#l00199">mg_response_info::num_headers</a>, <a class="el" href="civetweb_8c_source.html#l02533">mg_connection::path_info</a>, <a class="el" href="civetweb_8h_source.html#l00164">mg_request_info::remote_user</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l02557">mg_connection::request_len</a>, <a class="el" href="civetweb_8h_source.html#l00151">mg_request_info::request_method</a>, <a class="el" href="civetweb_8c_source.html#l02488">mg_connection::request_state</a>, <a class="el" href="civetweb_8h_source.html#l00152">mg_request_info::request_uri</a>, <a class="el" href="civetweb_8c_source.html#l02495">mg_connection::response_info</a>, <a class="el" href="civetweb_8c_source.html#l02559">mg_connection::status_code</a>, <a class="el" href="civetweb_8h_source.html#l00192">mg_response_info::status_code</a>, <a class="el" href="civetweb_8h_source.html#l00193">mg_response_info::status_text</a>, and <a class="el" href="civetweb_8c_source.html#l02560">mg_connection::throttle</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18569">get_message()</a>.</p>

</div>
</div>
<a id="afa346108a8a9cc93af26ca8beee784cd" name="afa346108a8a9cc93af26ca8beee784cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa346108a8a9cc93af26ca8beee784cd">&#9670;&#160;</a></span>scan_directory()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int scan_directory </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>dir</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>data</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(struct <a class="el" href="structde.html">de</a> *, void *)</td>          <td class="paramname"><span class="paramname"><em>cb</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l09777">9777</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 9781</span>{</div>
<div class="line"><span class="lineno"> 9782</span>    <span class="keywordtype">char</span> path[<a class="code hl_define" href="#a7a78f968a579c967c2bb097b9e64749f">UTF8_PATH_MAX</a>];</div>
<div class="line"><span class="lineno"> 9783</span>    <span class="keyword">struct </span>dirent *dp;</div>
<div class="line"><span class="lineno"> 9784</span>    DIR *dirp;</div>
<div class="line"><span class="lineno"> 9785</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structde.html">de</a> <a class="code hl_struct" href="structde.html">de</a>;</div>
<div class="line"><span class="lineno"> 9786</span>    <span class="keywordtype">int</span> truncated;</div>
<div class="line"><span class="lineno"> 9787</span> </div>
<div class="line"><span class="lineno"> 9788</span>    <span class="keywordflow">if</span> ((dirp = <a class="code hl_define" href="#a1ff1ea4e3e6c59f0e144bd91366fe2d9">mg_opendir</a>(conn, dir)) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9789</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 9790</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 9791</span> </div>
<div class="line"><span class="lineno"> 9792</span>        <span class="keywordflow">while</span> ((dp = <a class="code hl_define" href="#a0387536c403dfeff474b0bb940156908">mg_readdir</a>(dirp)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 9793</span>            <span class="comment">/* Do not show current dir and hidden files */</span></div>
<div class="line"><span class="lineno"> 9794</span>            <span class="keywordflow">if</span> (!strcmp(dp-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>) || !strcmp(dp-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>)</div>
<div class="line"><span class="lineno"> 9795</span>                || <a class="code hl_function" href="#a38c5f9290df5fe9727338a93493108f5">must_hide_file</a>(conn, dp-&gt;d_name)) {</div>
<div class="line"><span class="lineno"> 9796</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 9797</span>            }</div>
<div class="line"><span class="lineno"> 9798</span> </div>
<div class="line"><span class="lineno"> 9799</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(</div>
<div class="line"><span class="lineno"> 9800</span>                conn, &amp;truncated, path, <span class="keyword">sizeof</span>(path), <span class="stringliteral">&quot;%s/%s&quot;</span>, dir, dp-&gt;d_name);</div>
<div class="line"><span class="lineno"> 9801</span> </div>
<div class="line"><span class="lineno"> 9802</span>            <span class="comment">/* If we don&#39;t memset stat structure to zero, mtime will have</span></div>
<div class="line"><span class="lineno"> 9803</span><span class="comment">             * garbage and strftime() will segfault later on in</span></div>
<div class="line"><span class="lineno"> 9804</span><span class="comment">             * print_dir_entry(). memset is required only if mg_stat()</span></div>
<div class="line"><span class="lineno"> 9805</span><span class="comment">             * fails. For more details, see</span></div>
<div class="line"><span class="lineno"> 9806</span><span class="comment">             * http://code.google.com/p/mongoose/issues/detail?id=79 */</span></div>
<div class="line"><span class="lineno"> 9807</span>            memset(&amp;<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>));</div>
<div class="line"><span class="lineno"> 9808</span> </div>
<div class="line"><span class="lineno"> 9809</span>            <span class="keywordflow">if</span> (truncated) {</div>
<div class="line"><span class="lineno"> 9810</span>                <span class="comment">/* If the path is not complete, skip processing. */</span></div>
<div class="line"><span class="lineno"> 9811</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 9812</span>            }</div>
<div class="line"><span class="lineno"> 9813</span> </div>
<div class="line"><span class="lineno"> 9814</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path, &amp;<a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#ac819ba780b7179da19a396bd296bd258">file</a>)) {</div>
<div class="line"><span class="lineno"> 9815</span>                <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno"> 9816</span>                                <span class="stringliteral">&quot;%s: mg_stat(%s) failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 9817</span>                                __func__,</div>
<div class="line"><span class="lineno"> 9818</span>                                path,</div>
<div class="line"><span class="lineno"> 9819</span>                                strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 9820</span>            }</div>
<div class="line"><span class="lineno"> 9821</span>            <a class="code hl_struct" href="structde.html">de</a>.<a class="code hl_variable" href="structde.html#a08f58ddfc5471054734d921fc199b7ed">file_name</a> = dp-&gt;d_name;</div>
<div class="line"><span class="lineno"> 9822</span>            <span class="keywordflow">if</span> (cb(&amp;<a class="code hl_struct" href="structde.html">de</a>, data)) {</div>
<div class="line"><span class="lineno"> 9823</span>                <span class="comment">/* stopped */</span></div>
<div class="line"><span class="lineno"> 9824</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 9825</span>            }</div>
<div class="line"><span class="lineno"> 9826</span>        }</div>
<div class="line"><span class="lineno"> 9827</span>        (void)<a class="code hl_define" href="#a2b5e30d60439015dee1c473ebc4f4ce9">mg_closedir</a>(dirp);</div>
<div class="line"><span class="lineno"> 9828</span>    }</div>
<div class="line"><span class="lineno"> 9829</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 9830</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l02579">de::file</a>, <a class="el" href="civetweb_8c_source.html#l02578">de::file_name</a>, <a class="el" href="civetweb_8c_source.html#l00922">mg_closedir</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l00921">mg_opendir</a>, <a class="el" href="civetweb_8c_source.html#l00923">mg_readdir</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="civetweb_8c_source.html#l09763">must_hide_file()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l00861">UTF8_PATH_MAX</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, and <a class="el" href="civetweb_8c_source.html#l12759">handle_propfind()</a>.</p>

</div>
</div>
<a id="ab79547a6cf8bca74eba39a0ff85cd091" name="ab79547a6cf8bca74eba39a0ff85cd091"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab79547a6cf8bca74eba39a0ff85cd091">&#9670;&#160;</a></span>send_additional_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void send_additional_header </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04122">4122</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4123</span>{</div>
<div class="line"><span class="lineno"> 4124</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *header = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba154fd2c7788b97dd4ea040e669a4cd1d">ADDITIONAL_HEADER</a>];</div>
<div class="line"><span class="lineno"> 4125</span> </div>
<div class="line"><span class="lineno"> 4126</span><span class="preprocessor">#if !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno"> 4127</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba64a313cf2fe6e0540cf30467a3ab7789">STRICT_HTTPS_MAX_AGE</a>]) {</div>
<div class="line"><span class="lineno"> 4128</span>        <span class="keywordtype">long</span> max_age = atol(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba64a313cf2fe6e0540cf30467a3ab7789">STRICT_HTTPS_MAX_AGE</a>]);</div>
<div class="line"><span class="lineno"> 4129</span>        <span class="keywordflow">if</span> (max_age &gt;= 0) {</div>
<div class="line"><span class="lineno"> 4130</span>            <span class="keywordtype">char</span> val[64];</div>
<div class="line"><span class="lineno"> 4131</span>            <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 4132</span>                        <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 4133</span>                        val,</div>
<div class="line"><span class="lineno"> 4134</span>                        <span class="keyword">sizeof</span>(val),</div>
<div class="line"><span class="lineno"> 4135</span>                        <span class="stringliteral">&quot;max-age=%lu&quot;</span>,</div>
<div class="line"><span class="lineno"> 4136</span>                        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)max_age);</div>
<div class="line"><span class="lineno"> 4137</span>            <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Strict-Transport-Security&quot;</span>, val, -1);</div>
<div class="line"><span class="lineno"> 4138</span>        }</div>
<div class="line"><span class="lineno"> 4139</span>    }</div>
<div class="line"><span class="lineno"> 4140</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 4141</span> </div>
<div class="line"><span class="lineno"> 4142</span>    <span class="keywordflow">if</span> (header &amp;&amp; header[0]) {</div>
<div class="line"><span class="lineno"> 4143</span>        <a class="code hl_function" href="civetweb_8h.html#af2fea4b4a82311588a9914b6d8491661">mg_response_header_add_lines</a>(conn, header);</div>
<div class="line"><span class="lineno"> 4144</span>    }</div>
<div class="line"><span class="lineno"> 4145</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02052">ADDITIONAL_HEADER</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#af2fea4b4a82311588a9914b6d8491661">mg_response_header_add_lines()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l02050">STRICT_HTTPS_MAX_AGE</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l11915">dav_mkcol()</a>, <a class="el" href="civetweb_8c_source.html#l12964">dav_proppatch()</a>, <a class="el" href="civetweb_8c_source.html#l12293">delete_file()</a>, <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l10483">handle_not_modified_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l12759">handle_propfind()</a>, <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l04576">mg_send_http_ok()</a>, <a class="el" href="civetweb_8c_source.html#l04618">mg_send_http_redirect()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, <a class="el" href="civetweb_8c_source.html#l08974">send_authorization_request()</a>, and <a class="el" href="civetweb_8c_source.html#l12632">send_options()</a>.</p>

</div>
</div>
<a id="a3e30365a0294614e545550653e71c809" name="a3e30365a0294614e545550653e71c809"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e30365a0294614e545550653e71c809">&#9670;&#160;</a></span>send_authorization_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void send_authorization_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>realm</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08974">8974</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 8975</span>{</div>
<div class="line"><span class="lineno"> 8976</span>    uint64_t nonce = (uint64_t)(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a0084702a827547767b25513d4400ce46">start_time</a>);</div>
<div class="line"><span class="lineno"> 8977</span>    <span class="keywordtype">int</span> trunc = 0;</div>
<div class="line"><span class="lineno"> 8978</span>    <span class="keywordtype">char</span> buf[128];</div>
<div class="line"><span class="lineno"> 8979</span> </div>
<div class="line"><span class="lineno"> 8980</span>    <span class="keywordflow">if</span> (!realm) {</div>
<div class="line"><span class="lineno"> 8981</span>        realm = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>];</div>
<div class="line"><span class="lineno"> 8982</span>    }</div>
<div class="line"><span class="lineno"> 8983</span> </div>
<div class="line"><span class="lineno"> 8984</span>    <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno"> 8985</span>    nonce += conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a25db94e78d0710af1bb4d7f3b8bd6556">nonce_count</a>;</div>
<div class="line"><span class="lineno"> 8986</span>    ++conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a25db94e78d0710af1bb4d7f3b8bd6556">nonce_count</a>;</div>
<div class="line"><span class="lineno"> 8987</span>    <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno"> 8988</span> </div>
<div class="line"><span class="lineno"> 8989</span>    nonce ^= conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a935ad1d56f46fde93d51014a96ded25d">auth_nonce_mask</a>;</div>
<div class="line"><span class="lineno"> 8990</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a> = 1;</div>
<div class="line"><span class="lineno"> 8991</span> </div>
<div class="line"><span class="lineno"> 8992</span>    <span class="comment">/* Create 401 response */</span></div>
<div class="line"><span class="lineno"> 8993</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 401);</div>
<div class="line"><span class="lineno"> 8994</span>    <a class="code hl_function" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a>(conn);</div>
<div class="line"><span class="lineno"> 8995</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno"> 8996</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Length&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, -1);</div>
<div class="line"><span class="lineno"> 8997</span> </div>
<div class="line"><span class="lineno"> 8998</span>    <span class="comment">/* Content for &quot;WWW-Authenticate&quot; header */</span></div>
<div class="line"><span class="lineno"> 8999</span>    <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(conn,</div>
<div class="line"><span class="lineno"> 9000</span>                &amp;trunc,</div>
<div class="line"><span class="lineno"> 9001</span>                buf,</div>
<div class="line"><span class="lineno"> 9002</span>                <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><span class="lineno"> 9003</span>                <span class="stringliteral">&quot;Digest qop=\&quot;auth\&quot;, realm=\&quot;%s\&quot;, &quot;</span></div>
<div class="line"><span class="lineno"> 9004</span>                <span class="stringliteral">&quot;nonce=\&quot;%&quot;</span> <a class="code hl_define" href="#a21ef7c3a4e9f99f62cf64329f965d2ed">UINT64_FMT</a> <span class="stringliteral">&quot;\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno"> 9005</span>                realm,</div>
<div class="line"><span class="lineno"> 9006</span>                nonce);</div>
<div class="line"><span class="lineno"> 9007</span> </div>
<div class="line"><span class="lineno"> 9008</span>    <span class="keywordflow">if</span> (!trunc) {</div>
<div class="line"><span class="lineno"> 9009</span>        <span class="comment">/* !trunc should always be true */</span></div>
<div class="line"><span class="lineno"> 9010</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;WWW-Authenticate&quot;</span>, buf, -1);</div>
<div class="line"><span class="lineno"> 9011</span>    }</div>
<div class="line"><span class="lineno"> 9012</span> </div>
<div class="line"><span class="lineno"> 9013</span>    <span class="comment">/* Send all headers */</span></div>
<div class="line"><span class="lineno"> 9014</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno"> 9015</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02276">mg_domain_context::auth_nonce_mask</a>, <a class="el" href="civetweb_8c_source.html#l01999">AUTHENTICATION_DOMAIN</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, <a class="el" href="civetweb_8c_source.html#l02277">mg_domain_context::nonce_count</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>, <a class="el" href="civetweb_8c_source.html#l04056">send_no_cache_header()</a>, <a class="el" href="civetweb_8c_source.html#l02412">mg_context::start_time</a>, and <a class="el" href="civetweb_8c_source.html#l00927">UINT64_FMT</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l09022">mg_send_digest_access_authentication_request()</a>.</p>

</div>
</div>
<a id="acce3a614f601b06f0120faad9421e25f" name="acce3a614f601b06f0120faad9421e25f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acce3a614f601b06f0120faad9421e25f">&#9670;&#160;</a></span>send_cors_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void send_cors_header </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04149">4149</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4150</span>{</div>
<div class="line"><span class="lineno"> 4151</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *origin_hdr = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Origin&quot;</span>);</div>
<div class="line"><span class="lineno"> 4152</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *cors_orig_cfg =</div>
<div class="line"><span class="lineno"> 4153</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba18505d55559e2f7fee94e1ec4f1361d0">ACCESS_CONTROL_ALLOW_ORIGIN</a>];</div>
<div class="line"><span class="lineno"> 4154</span> </div>
<div class="line"><span class="lineno"> 4155</span>    <span class="keywordflow">if</span> (cors_orig_cfg &amp;&amp; *cors_orig_cfg &amp;&amp; origin_hdr &amp;&amp; *origin_hdr) {</div>
<div class="line"><span class="lineno"> 4156</span>        <span class="comment">/* Cross-origin resource sharing (CORS), see</span></div>
<div class="line"><span class="lineno"> 4157</span><span class="comment">         * http://www.html5rocks.com/en/tutorials/cors/,</span></div>
<div class="line"><span class="lineno"> 4158</span><span class="comment">         * http://www.html5rocks.com/static/images/cors_server_flowchart.png</span></div>
<div class="line"><span class="lineno"> 4159</span><span class="comment">         * CORS preflight is not supported for files. */</span></div>
<div class="line"><span class="lineno"> 4160</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn,</div>
<div class="line"><span class="lineno"> 4161</span>                               <span class="stringliteral">&quot;Access-Control-Allow-Origin&quot;</span>,</div>
<div class="line"><span class="lineno"> 4162</span>                               cors_orig_cfg,</div>
<div class="line"><span class="lineno"> 4163</span>                               -1);</div>
<div class="line"><span class="lineno"> 4164</span>    }</div>
<div class="line"><span class="lineno"> 4165</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02041">ACCESS_CONTROL_ALLOW_ORIGIN</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, and <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l04576">mg_send_http_ok()</a>, and <a class="el" href="civetweb_8c_source.html#l04618">mg_send_http_redirect()</a>.</p>

</div>
</div>
<a id="a528545b68103ca8848caaea2c5316ec2" name="a528545b68103ca8848caaea2c5316ec2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a528545b68103ca8848caaea2c5316ec2">&#9670;&#160;</a></span>send_file_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void send_file_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t</td>          <td class="paramname"><span class="paramname"><em>offset</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t</td>          <td class="paramname"><span class="paramname"><em>len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>no_buffering</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10055">10055</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10060</span>{</div>
<div class="line"><span class="lineno">10061</span>    <span class="keywordtype">char</span> buf[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno">10062</span>    <span class="keywordtype">int</span> to_read, num_read, num_written;</div>
<div class="line"><span class="lineno">10063</span>    int64_t size;</div>
<div class="line"><span class="lineno">10064</span> </div>
<div class="line"><span class="lineno">10065</span>    <span class="keywordflow">if</span> (!filep || !conn) {</div>
<div class="line"><span class="lineno">10066</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">10067</span>    }</div>
<div class="line"><span class="lineno">10068</span> </div>
<div class="line"><span class="lineno">10069</span>    <span class="comment">/* Sanity check the offset */</span></div>
<div class="line"><span class="lineno">10070</span>    size = (filep-&gt;<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>.<a class="code hl_variable" href="structmg__file__stat.html#a2a9092bc55b16d45e33fb42f6f924e16">size</a> &gt; <a class="code hl_define" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a>) ? <a class="code hl_define" href="#ad0d744f05898e32d01f73f8af3cd2071">INT64_MAX</a></div>
<div class="line"><span class="lineno">10071</span>                                          : (int64_t)(filep-&gt;stat.size);</div>
<div class="line"><span class="lineno">10072</span>    offset = (offset &lt; 0) ? 0 : ((offset &gt; size) ? size : offset);</div>
<div class="line"><span class="lineno">10073</span> </div>
<div class="line"><span class="lineno">10074</span>    <span class="keywordflow">if</span> (len &gt; 0 &amp;&amp; filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a> != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">10075</span>        <span class="comment">/* file stored on disk */</span></div>
<div class="line"><span class="lineno">10076</span><span class="preprocessor">#if defined(__linux__)</span></div>
<div class="line"><span class="lineno">10077</span>        <span class="comment">/* sendfile is only available for Linux */</span></div>
<div class="line"><span class="lineno">10078</span>        <span class="keywordflow">if</span> ((conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> == 0) &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a1253d8e7156cefe37debd0c1aa2b3769">throttle</a> == 0)</div>
<div class="line"><span class="lineno">10079</span>            &amp;&amp; (!<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[ALLOW_SENDFILE_CALL],</div>
<div class="line"><span class="lineno">10080</span>                               <span class="stringliteral">&quot;yes&quot;</span>))) {</div>
<div class="line"><span class="lineno">10081</span>            off_t sf_offs = (off_t)offset;</div>
<div class="line"><span class="lineno">10082</span>            ssize_t sf_sent;</div>
<div class="line"><span class="lineno">10083</span>            <span class="keywordtype">int</span> sf_file = fileno(filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a>);</div>
<div class="line"><span class="lineno">10084</span>            <span class="keywordtype">int</span> loop_cnt = 0;</div>
<div class="line"><span class="lineno">10085</span> </div>
<div class="line"><span class="lineno">10086</span>            <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">10087</span>                <span class="comment">/* 2147479552 (0x7FFFF000) is a limit found by experiment on</span></div>
<div class="line"><span class="lineno">10088</span><span class="comment">                 * 64 bit Linux (2^31 minus one memory page of 4k?). */</span></div>
<div class="line"><span class="lineno">10089</span>                <span class="keywordtype">size_t</span> sf_tosend =</div>
<div class="line"><span class="lineno">10090</span>                    (size_t)((len &lt; 0x7FFFF000) ? len : 0x7FFFF000);</div>
<div class="line"><span class="lineno">10091</span>                sf_sent =</div>
<div class="line"><span class="lineno">10092</span>                    sendfile(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>, sf_file, &amp;sf_offs, sf_tosend);</div>
<div class="line"><span class="lineno">10093</span>                <span class="keywordflow">if</span> (sf_sent &gt; 0) {</div>
<div class="line"><span class="lineno">10094</span>                    len -= sf_sent;</div>
<div class="line"><span class="lineno">10095</span>                    offset += sf_sent;</div>
<div class="line"><span class="lineno">10096</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loop_cnt == 0) {</div>
<div class="line"><span class="lineno">10097</span>                    <span class="comment">/* This file can not be sent using sendfile.</span></div>
<div class="line"><span class="lineno">10098</span><span class="comment">                     * This might be the case for pseudo-files in the</span></div>
<div class="line"><span class="lineno">10099</span><span class="comment">                     * /sys/ and /proc/ file system.</span></div>
<div class="line"><span class="lineno">10100</span><span class="comment">                     * Use the regular user mode copy code instead. */</span></div>
<div class="line"><span class="lineno">10101</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">10102</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sf_sent == 0) {</div>
<div class="line"><span class="lineno">10103</span>                    <span class="comment">/* No error, but 0 bytes sent. May be EOF? */</span></div>
<div class="line"><span class="lineno">10104</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">10105</span>                }</div>
<div class="line"><span class="lineno">10106</span>                loop_cnt++;</div>
<div class="line"><span class="lineno">10107</span> </div>
<div class="line"><span class="lineno">10108</span>            } <span class="keywordflow">while</span> ((len &gt; 0) &amp;&amp; (sf_sent &gt;= 0));</div>
<div class="line"><span class="lineno">10109</span> </div>
<div class="line"><span class="lineno">10110</span>            <span class="keywordflow">if</span> (sf_sent &gt; 0) {</div>
<div class="line"><span class="lineno">10111</span>                <span class="keywordflow">return</span>; <span class="comment">/* OK */</span></div>
<div class="line"><span class="lineno">10112</span>            }</div>
<div class="line"><span class="lineno">10113</span> </div>
<div class="line"><span class="lineno">10114</span>            <span class="comment">/* sf_sent&lt;0 means error, thus fall back to the classic way */</span></div>
<div class="line"><span class="lineno">10115</span>            <span class="comment">/* This is always the case, if sf_file is not a &quot;normal&quot; file,</span></div>
<div class="line"><span class="lineno">10116</span><span class="comment">             * e.g., for sending data from the output of a CGI process. */</span></div>
<div class="line"><span class="lineno">10117</span>            offset = (int64_t)sf_offs;</div>
<div class="line"><span class="lineno">10118</span>        }</div>
<div class="line"><span class="lineno">10119</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">10120</span>        <span class="keywordflow">if</span> ((offset &gt; 0) &amp;&amp; (fseeko(filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a>, offset, SEEK_SET) != 0)) {</div>
<div class="line"><span class="lineno">10121</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">10122</span>                            <span class="stringliteral">&quot;%s: fseeko() failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno">10123</span>                            __func__,</div>
<div class="line"><span class="lineno">10124</span>                            strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">10125</span>            <a class="code hl_function" href="#aca46fdde7db996eb011a1ac6a28bea98">mg_send_http_error</a>(</div>
<div class="line"><span class="lineno">10126</span>                conn,</div>
<div class="line"><span class="lineno">10127</span>                500,</div>
<div class="line"><span class="lineno">10128</span>                <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">10129</span>                <span class="stringliteral">&quot;Error: Unable to access file at requested position.&quot;</span>);</div>
<div class="line"><span class="lineno">10130</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">10131</span>            <span class="keywordflow">while</span> (len &gt; 0) {</div>
<div class="line"><span class="lineno">10132</span>                <span class="comment">/* Calculate how much to read from the file into the buffer. */</span></div>
<div class="line"><span class="lineno">10133</span>                <span class="comment">/* If no_buffering is set, we should not wait until the</span></div>
<div class="line"><span class="lineno">10134</span><span class="comment">                 * CGI-&gt;Server buffer is filled, but send everything</span></div>
<div class="line"><span class="lineno">10135</span><span class="comment">                 * immediately. In theory buffering could be turned off using</span></div>
<div class="line"><span class="lineno">10136</span><span class="comment">                 * setbuf(filep-&gt;access.fp, NULL);</span></div>
<div class="line"><span class="lineno">10137</span><span class="comment">                 * setvbuf(filep-&gt;access.fp, NULL, _IONBF, 0);</span></div>
<div class="line"><span class="lineno">10138</span><span class="comment">                 * but in practice this does not work. A &quot;Linux only&quot; solution</span></div>
<div class="line"><span class="lineno">10139</span><span class="comment">                 * may be to use select(). The only portable way is to read byte</span></div>
<div class="line"><span class="lineno">10140</span><span class="comment">                 * by byte, but this is quite inefficient from a performance</span></div>
<div class="line"><span class="lineno">10141</span><span class="comment">                 * point of view. */</span></div>
<div class="line"><span class="lineno">10142</span>                to_read = no_buffering ? 1 : <span class="keyword">sizeof</span>(buf);</div>
<div class="line"><span class="lineno">10143</span>                <span class="keywordflow">if</span> ((int64_t)to_read &gt; len) {</div>
<div class="line"><span class="lineno">10144</span>                    to_read = (int)len;</div>
<div class="line"><span class="lineno">10145</span>                }</div>
<div class="line"><span class="lineno">10146</span> </div>
<div class="line"><span class="lineno">10147</span>                <span class="comment">/* Read from file, exit the loop on error */</span></div>
<div class="line"><span class="lineno">10148</span>                <span class="keywordflow">if</span> ((num_read =</div>
<div class="line"><span class="lineno">10149</span>                         (<span class="keywordtype">int</span>)<a class="code hl_function" href="stdcheaders_8h.html#aae22dd41ebe1e64904429c5a31e7e642">fread</a>(buf, 1, (<span class="keywordtype">size_t</span>)to_read, filep-&gt;<a class="code hl_variable" href="structmg__file.html#a90b5d07df0a357ba1f1311b92fdd3dc2">access</a>.<a class="code hl_variable" href="structmg__file__access.html#a63d40853ff1053f8e2ba34f19319bb3c">fp</a>))</div>
<div class="line"><span class="lineno">10150</span>                    &lt;= 0) {</div>
<div class="line"><span class="lineno">10151</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">10152</span>                }</div>
<div class="line"><span class="lineno">10153</span> </div>
<div class="line"><span class="lineno">10154</span>                <span class="comment">/* Send read bytes to the client, exit the loop on error */</span></div>
<div class="line"><span class="lineno">10155</span>                <span class="keywordflow">if</span> ((num_written = <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, buf, (<span class="keywordtype">size_t</span>)num_read))</div>
<div class="line"><span class="lineno">10156</span>                    != num_read) {</div>
<div class="line"><span class="lineno">10157</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">10158</span>                }</div>
<div class="line"><span class="lineno">10159</span> </div>
<div class="line"><span class="lineno">10160</span>                <span class="comment">/* Both read and were successful, adjust counters */</span></div>
<div class="line"><span class="lineno">10161</span>                len -= num_written;</div>
<div class="line"><span class="lineno">10162</span>            }</div>
<div class="line"><span class="lineno">10163</span>        }</div>
<div class="line"><span class="lineno">10164</span>    }</div>
<div class="line"><span class="lineno">10165</span>}</div>
<div class="ttc" id="astdcheaders_8h_html_aae22dd41ebe1e64904429c5a31e7e642"><div class="ttname"><a href="stdcheaders_8h.html#aae22dd41ebe1e64904429c5a31e7e642">fread</a></div><div class="ttdeci">size_t fread(void *, size_t, size_t, FILE *)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01887">mg_file::access</a>, <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l01882">mg_file_access::fp</a>, <a class="el" href="stdcheaders_8h.html#aae22dd41ebe1e64904429c5a31e7e642">fread()</a>, <a class="el" href="civetweb_8c_source.html#l00513">INT64_MAX</a>, <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l04562">mg_send_http_error()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l06779">mg_write()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01871">mg_file_stat::size</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, <a class="el" href="civetweb_8c_source.html#l02506">mg_connection::ssl</a>, <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>, and <a class="el" href="civetweb_8c_source.html#l02560">mg_connection::throttle</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12443">do_ssi_exec()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, and <a class="el" href="civetweb_8c_source.html#l10451">mg_send_file_body()</a>.</p>

</div>
</div>
<a id="a4e9abca78e3f98b886081d15550f7fca" name="a4e9abca78e3f98b886081d15550f7fca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e9abca78e3f98b886081d15550f7fca">&#9670;&#160;</a></span>send_no_cache_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void send_no_cache_header </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04056">4056</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4057</span>{</div>
<div class="line"><span class="lineno"> 4058</span>    <span class="comment">/* Send all current and obsolete cache opt-out directives. */</span></div>
<div class="line"><span class="lineno"> 4059</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn,</div>
<div class="line"><span class="lineno"> 4060</span>                           <span class="stringliteral">&quot;Cache-Control&quot;</span>,</div>
<div class="line"><span class="lineno"> 4061</span>                           <span class="stringliteral">&quot;no-cache, no-store, &quot;</span></div>
<div class="line"><span class="lineno"> 4062</span>                           <span class="stringliteral">&quot;must-revalidate, private, max-age=0&quot;</span>,</div>
<div class="line"><span class="lineno"> 4063</span>                           -1);</div>
<div class="line"><span class="lineno"> 4064</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Expires&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, -1);</div>
<div class="line"><span class="lineno"> 4065</span> </div>
<div class="line"><span class="lineno"> 4066</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a>) {</div>
<div class="line"><span class="lineno"> 4067</span>        <span class="comment">/* Obsolete, but still send it for HTTP/1.0 */</span></div>
<div class="line"><span class="lineno"> 4068</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Pragma&quot;</span>, <span class="stringliteral">&quot;no-cache&quot;</span>, -1);</div>
<div class="line"><span class="lineno"> 4069</span>    }</div>
<div class="line"><span class="lineno"> 4070</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, and <a class="el" href="civetweb_8c_source.html#l02466">PROTOCOL_TYPE_HTTP1</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12293">delete_file()</a>, <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l04375">mg_send_http_error_impl()</a>, <a class="el" href="civetweb_8c_source.html#l04576">mg_send_http_ok()</a>, <a class="el" href="civetweb_8c_source.html#l04618">mg_send_http_redirect()</a>, <a class="el" href="civetweb_8c_source.html#l12158">put_file()</a>, <a class="el" href="civetweb_8c_source.html#l08974">send_authorization_request()</a>, and <a class="el" href="civetweb_8c_source.html#l04074">send_static_cache_header()</a>.</p>

</div>
</div>
<a id="a9646ac874ed82c23be670eba105c0d8f" name="a9646ac874ed82c23be670eba105c0d8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9646ac874ed82c23be670eba105c0d8f">&#9670;&#160;</a></span>send_options()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void send_options </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12632">12632</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12633</span>{</div>
<div class="line"><span class="lineno">12634</span>    <span class="keywordflow">if</span> (!conn || !<a class="code hl_variable" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a>) {</div>
<div class="line"><span class="lineno">12635</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12636</span>    }</div>
<div class="line"><span class="lineno">12637</span> </div>
<div class="line"><span class="lineno">12638</span>    <span class="comment">/* We do not set a &quot;Cache-Control&quot; header here, but leave the default.</span></div>
<div class="line"><span class="lineno">12639</span><span class="comment">     * Since browsers do not send an OPTIONS request, we can not test the</span></div>
<div class="line"><span class="lineno">12640</span><span class="comment">     * effect anyway. */</span></div>
<div class="line"><span class="lineno">12641</span> </div>
<div class="line"><span class="lineno">12642</span>    <a class="code hl_function" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start</a>(conn, 200);</div>
<div class="line"><span class="lineno">12643</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Content-Type&quot;</span>, <span class="stringliteral">&quot;text/html&quot;</span>, -1);</div>
<div class="line"><span class="lineno">12644</span> </div>
<div class="line"><span class="lineno">12645</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> == <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a>) {</div>
<div class="line"><span class="lineno">12646</span>        <span class="comment">/* Use the same as before */</span></div>
<div class="line"><span class="lineno">12647</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Allow&quot;</span>, <a class="code hl_variable" href="#a8c57fa7eeaaed403927368aa20e4efd5">all_methods</a>, -1);</div>
<div class="line"><span class="lineno">12648</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;DAV&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, -1);</div>
<div class="line"><span class="lineno">12649</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12650</span>        <span class="comment">/* TODO: Check this later for HTTP/2 */</span></div>
<div class="line"><span class="lineno">12651</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Allow&quot;</span>, <span class="stringliteral">&quot;GET, POST&quot;</span>, -1);</div>
<div class="line"><span class="lineno">12652</span>    }</div>
<div class="line"><span class="lineno">12653</span>    <a class="code hl_function" href="#ab79547a6cf8bca74eba39a0ff85cd091">send_additional_header</a>(conn);</div>
<div class="line"><span class="lineno">12654</span>    <a class="code hl_function" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send</a>(conn);</div>
<div class="line"><span class="lineno">12655</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l10876">all_methods</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="civetweb_8h.html#a2ca8aca1da1713557d4eee7526887e12">mg_response_header_send()</a>, <a class="el" href="civetweb_8h.html#acf61373a94705446c56f0331639dd619">mg_response_header_start()</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, <a class="el" href="civetweb_8c_source.html#l02466">PROTOCOL_TYPE_HTTP1</a>, and <a class="el" href="civetweb_8c_source.html#l04122">send_additional_header()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="abbfd2afe32d71961fea011337ee6e2b1" name="abbfd2afe32d71961fea011337ee6e2b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abbfd2afe32d71961fea011337ee6e2b1">&#9670;&#160;</a></span>send_ssi_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void send_ssi_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file.html">mg_file</a> *</td>          <td class="paramname"><span class="paramname"><em>filep</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>include_level</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l12482">12482</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">12486</span>{</div>
<div class="line"><span class="lineno">12487</span>    <span class="keywordtype">char</span> buf[<a class="code hl_define" href="#ac22a8a822b8728d8cd7e2718749f3ca4">MG_BUF_LEN</a>];</div>
<div class="line"><span class="lineno">12488</span>    <span class="keywordtype">int</span> ch, len, in_tag, in_ssi_tag;</div>
<div class="line"><span class="lineno">12489</span> </div>
<div class="line"><span class="lineno">12490</span>    <span class="keywordflow">if</span> (include_level &gt; 10) {</div>
<div class="line"><span class="lineno">12491</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;SSI #include level is too deep (%s)&quot;</span>, path);</div>
<div class="line"><span class="lineno">12492</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12493</span>    }</div>
<div class="line"><span class="lineno">12494</span> </div>
<div class="line"><span class="lineno">12495</span>    in_tag = in_ssi_tag = len = 0;</div>
<div class="line"><span class="lineno">12496</span> </div>
<div class="line"><span class="lineno">12497</span>    <span class="comment">/* Read file, byte by byte, and look for SSI include tags */</span></div>
<div class="line"><span class="lineno">12498</span>    <span class="keywordflow">while</span> ((ch = <a class="code hl_function" href="#aed4461cf7bdfb82230d646e48611be11">mg_fgetc</a>(filep)) != EOF) {</div>
<div class="line"><span class="lineno">12499</span> </div>
<div class="line"><span class="lineno">12500</span>        <span class="keywordflow">if</span> (in_tag) {</div>
<div class="line"><span class="lineno">12501</span>            <span class="comment">/* We are in a tag, either SSI tag or html tag */</span></div>
<div class="line"><span class="lineno">12502</span> </div>
<div class="line"><span class="lineno">12503</span>            <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;&gt;&#39;</span>) {</div>
<div class="line"><span class="lineno">12504</span>                <span class="comment">/* Tag is closing */</span></div>
<div class="line"><span class="lineno">12505</span>                buf[len++] = <span class="charliteral">&#39;&gt;&#39;</span>;</div>
<div class="line"><span class="lineno">12506</span> </div>
<div class="line"><span class="lineno">12507</span>                <span class="keywordflow">if</span> (in_ssi_tag) {</div>
<div class="line"><span class="lineno">12508</span>                    <span class="comment">/* Handle SSI tag */</span></div>
<div class="line"><span class="lineno">12509</span>                    buf[len] = 0;</div>
<div class="line"><span class="lineno">12510</span> </div>
<div class="line"><span class="lineno">12511</span>                    <span class="keywordflow">if</span> ((len &gt; 12) &amp;&amp; !memcmp(buf + 5, <span class="stringliteral">&quot;include&quot;</span>, 7)) {</div>
<div class="line"><span class="lineno">12512</span>                        <a class="code hl_function" href="#a8ddc04f7aafa49c779fde3d73c2532a2">do_ssi_include</a>(conn, path, buf + 12, include_level + 1);</div>
<div class="line"><span class="lineno">12513</span><span class="preprocessor">#if !defined(NO_POPEN)</span></div>
<div class="line"><span class="lineno">12514</span>                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((len &gt; 9) &amp;&amp; !memcmp(buf + 5, <span class="stringliteral">&quot;exec&quot;</span>, 4)) {</div>
<div class="line"><span class="lineno">12515</span>                        <a class="code hl_function" href="#a1b2849ed5bfad2fe98c98852e26b065a">do_ssi_exec</a>(conn, buf + 9);</div>
<div class="line"><span class="lineno">12516</span><span class="preprocessor">#endif </span><span class="comment">/* !NO_POPEN */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">12517</span>                    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12518</span>                        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno">12519</span>                                        <span class="stringliteral">&quot;%s: unknown SSI &quot;</span></div>
<div class="line"><span class="lineno">12520</span>                                        <span class="stringliteral">&quot;command: \&quot;%s\&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">12521</span>                                        path,</div>
<div class="line"><span class="lineno">12522</span>                                        buf);</div>
<div class="line"><span class="lineno">12523</span>                    }</div>
<div class="line"><span class="lineno">12524</span>                    len = 0;</div>
<div class="line"><span class="lineno">12525</span>                    in_ssi_tag = in_tag = 0;</div>
<div class="line"><span class="lineno">12526</span> </div>
<div class="line"><span class="lineno">12527</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12528</span>                    <span class="comment">/* Not an SSI tag */</span></div>
<div class="line"><span class="lineno">12529</span>                    <span class="comment">/* Flush buffer */</span></div>
<div class="line"><span class="lineno">12530</span>                    (void)<a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, buf, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="lineno">12531</span>                    len = 0;</div>
<div class="line"><span class="lineno">12532</span>                    in_tag = 0;</div>
<div class="line"><span class="lineno">12533</span>                }</div>
<div class="line"><span class="lineno">12534</span> </div>
<div class="line"><span class="lineno">12535</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12536</span>                <span class="comment">/* Tag is still open */</span></div>
<div class="line"><span class="lineno">12537</span>                buf[len++] = (char)(ch &amp; 0xff);</div>
<div class="line"><span class="lineno">12538</span> </div>
<div class="line"><span class="lineno">12539</span>                <span class="keywordflow">if</span> ((len == 5) &amp;&amp; !memcmp(buf, <span class="stringliteral">&quot;&lt;!--#&quot;</span>, 5)) {</div>
<div class="line"><span class="lineno">12540</span>                    <span class="comment">/* All SSI tags start with &lt;!--# */</span></div>
<div class="line"><span class="lineno">12541</span>                    in_ssi_tag = 1;</div>
<div class="line"><span class="lineno">12542</span>                }</div>
<div class="line"><span class="lineno">12543</span> </div>
<div class="line"><span class="lineno">12544</span>                <span class="keywordflow">if</span> ((len + 2) &gt; (int)<span class="keyword">sizeof</span>(buf)) {</div>
<div class="line"><span class="lineno">12545</span>                    <span class="comment">/* Tag to long for buffer */</span></div>
<div class="line"><span class="lineno">12546</span>                    <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;%s: tag is too large&quot;</span>, path);</div>
<div class="line"><span class="lineno">12547</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">12548</span>                }</div>
<div class="line"><span class="lineno">12549</span>            }</div>
<div class="line"><span class="lineno">12550</span> </div>
<div class="line"><span class="lineno">12551</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12552</span> </div>
<div class="line"><span class="lineno">12553</span>            <span class="comment">/* We are not in a tag yet. */</span></div>
<div class="line"><span class="lineno">12554</span>            <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;&lt;&#39;</span>) {</div>
<div class="line"><span class="lineno">12555</span>                <span class="comment">/* Tag is opening */</span></div>
<div class="line"><span class="lineno">12556</span>                in_tag = 1;</div>
<div class="line"><span class="lineno">12557</span> </div>
<div class="line"><span class="lineno">12558</span>                <span class="keywordflow">if</span> (len &gt; 0) {</div>
<div class="line"><span class="lineno">12559</span>                    <span class="comment">/* Flush current buffer.</span></div>
<div class="line"><span class="lineno">12560</span><span class="comment">                     * Buffer is filled with &quot;len&quot; bytes. */</span></div>
<div class="line"><span class="lineno">12561</span>                    (void)<a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, buf, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="lineno">12562</span>                }</div>
<div class="line"><span class="lineno">12563</span>                <span class="comment">/* Store the &lt; */</span></div>
<div class="line"><span class="lineno">12564</span>                len = 1;</div>
<div class="line"><span class="lineno">12565</span>                buf[0] = <span class="charliteral">&#39;&lt;&#39;</span>;</div>
<div class="line"><span class="lineno">12566</span> </div>
<div class="line"><span class="lineno">12567</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">12568</span>                <span class="comment">/* No Tag */</span></div>
<div class="line"><span class="lineno">12569</span>                <span class="comment">/* Add data to buffer */</span></div>
<div class="line"><span class="lineno">12570</span>                buf[len++] = (char)(ch &amp; 0xff);</div>
<div class="line"><span class="lineno">12571</span>                <span class="comment">/* Flush if buffer is full */</span></div>
<div class="line"><span class="lineno">12572</span>                <span class="keywordflow">if</span> (len == (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(buf)) {</div>
<div class="line"><span class="lineno">12573</span>                    <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, buf, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="lineno">12574</span>                    len = 0;</div>
<div class="line"><span class="lineno">12575</span>                }</div>
<div class="line"><span class="lineno">12576</span>            }</div>
<div class="line"><span class="lineno">12577</span>        }</div>
<div class="line"><span class="lineno">12578</span>    }</div>
<div class="line"><span class="lineno">12579</span> </div>
<div class="line"><span class="lineno">12580</span>    <span class="comment">/* Send the rest of buffered data */</span></div>
<div class="line"><span class="lineno">12581</span>    <span class="keywordflow">if</span> (len &gt; 0) {</div>
<div class="line"><span class="lineno">12582</span>        <a class="code hl_function" href="#a6e7dd65d54025f881bb4d95986fc2581">mg_write</a>(conn, buf, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="lineno">12583</span>    }</div>
<div class="line"><span class="lineno">12584</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a1b2849ed5bfad2fe98c98852e26b065a"><div class="ttname"><a href="#a1b2849ed5bfad2fe98c98852e26b065a">do_ssi_exec</a></div><div class="ttdeci">static void do_ssi_exec(struct mg_connection *conn, char *tag)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12443">civetweb.c:12443</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a8ddc04f7aafa49c779fde3d73c2532a2"><div class="ttname"><a href="#a8ddc04f7aafa49c779fde3d73c2532a2">do_ssi_include</a></div><div class="ttdeci">static void do_ssi_include(struct mg_connection *conn, const char *ssi, char *tag, int include_level)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12358">civetweb.c:12358</a></div></div>
<div class="ttc" id="acivetweb_8c_html_aed4461cf7bdfb82230d646e48611be11"><div class="ttname"><a href="#aed4461cf7bdfb82230d646e48611be11">mg_fgetc</a></div><div class="ttdeci">static int mg_fgetc(struct mg_file *filep)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l12467">civetweb.c:12467</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l12443">do_ssi_exec()</a>, <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, <a class="el" href="civetweb_8c_source.html#l00498">MG_BUF_LEN</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l12467">mg_fgetc()</a>, and <a class="el" href="civetweb_8c_source.html#l06779">mg_write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12358">do_ssi_include()</a>, and <a class="el" href="civetweb_8c_source.html#l12588">handle_ssi_file_request()</a>.</p>

</div>
</div>
<a id="a229f03c60c42b8f390449a8e1324f22f" name="a229f03c60c42b8f390449a8e1324f22f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a229f03c60c42b8f390449a8e1324f22f">&#9670;&#160;</a></span>send_static_cache_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void send_static_cache_header </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04074">4074</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4075</span>{</div>
<div class="line"><span class="lineno"> 4076</span><span class="preprocessor">#if !defined(NO_CACHING)</span></div>
<div class="line"><span class="lineno"> 4077</span>    <span class="keywordtype">int</span> max_age;</div>
<div class="line"><span class="lineno"> 4078</span>    <span class="keywordtype">char</span> val[64];</div>
<div class="line"><span class="lineno"> 4079</span> </div>
<div class="line"><span class="lineno"> 4080</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *cache_control =</div>
<div class="line"><span class="lineno"> 4081</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba806e32a13c862b980a792a2183c5cb2d">STATIC_FILE_CACHE_CONTROL</a>];</div>
<div class="line"><span class="lineno"> 4082</span> </div>
<div class="line"><span class="lineno"> 4083</span>    <span class="comment">/* If there is a full cache-control option configured,0 use it */</span></div>
<div class="line"><span class="lineno"> 4084</span>    <span class="keywordflow">if</span> (cache_control != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 4085</span>        <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Cache-Control&quot;</span>, cache_control, -1);</div>
<div class="line"><span class="lineno"> 4086</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 4087</span>    }</div>
<div class="line"><span class="lineno"> 4088</span> </div>
<div class="line"><span class="lineno"> 4089</span>    <span class="comment">/* Read the server config to check how long a file may be cached.</span></div>
<div class="line"><span class="lineno"> 4090</span><span class="comment">     * The configuration is in seconds. */</span></div>
<div class="line"><span class="lineno"> 4091</span>    max_age = atoi(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba6b580243dfe971149cd10cfa449369ac">STATIC_FILE_MAX_AGE</a>]);</div>
<div class="line"><span class="lineno"> 4092</span>    <span class="keywordflow">if</span> (max_age &lt;= 0) {</div>
<div class="line"><span class="lineno"> 4093</span>        <span class="comment">/* 0 means &quot;do not cache&quot;. All values &lt;0 are reserved</span></div>
<div class="line"><span class="lineno"> 4094</span><span class="comment">         * and may be used differently in the future. */</span></div>
<div class="line"><span class="lineno"> 4095</span>        <span class="comment">/* If a file should not be cached, do not only send</span></div>
<div class="line"><span class="lineno"> 4096</span><span class="comment">         * max-age=0, but also pragmas and Expires headers. */</span></div>
<div class="line"><span class="lineno"> 4097</span>        <a class="code hl_function" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4098</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 4099</span>    }</div>
<div class="line"><span class="lineno"> 4100</span> </div>
<div class="line"><span class="lineno"> 4101</span>    <span class="comment">/* Use &quot;Cache-Control: max-age&quot; instead of &quot;Expires&quot; header.</span></div>
<div class="line"><span class="lineno"> 4102</span><span class="comment">     * Reason: see https://www.mnot.net/blog/2007/05/15/expires_max-age */</span></div>
<div class="line"><span class="lineno"> 4103</span>    <span class="comment">/* See also https://www.mnot.net/cache_docs/ */</span></div>
<div class="line"><span class="lineno"> 4104</span>    <span class="comment">/* According to RFC 2616, Section 14.21, caching times should not exceed</span></div>
<div class="line"><span class="lineno"> 4105</span><span class="comment">     * one year. A year with 365 days corresponds to 31536000 seconds, a</span></div>
<div class="line"><span class="lineno"> 4106</span><span class="comment">     * leap</span></div>
<div class="line"><span class="lineno"> 4107</span><span class="comment">     * year to 31622400 seconds. For the moment, we just send whatever has</span></div>
<div class="line"><span class="lineno"> 4108</span><span class="comment">     * been configured, still the behavior for &gt;1 year should be considered</span></div>
<div class="line"><span class="lineno"> 4109</span><span class="comment">     * as undefined. */</span></div>
<div class="line"><span class="lineno"> 4110</span>    <a class="code hl_function" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf</a>(</div>
<div class="line"><span class="lineno"> 4111</span>        conn, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, val, <span class="keyword">sizeof</span>(val), <span class="stringliteral">&quot;max-age=%lu&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)max_age);</div>
<div class="line"><span class="lineno"> 4112</span>    <a class="code hl_function" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add</a>(conn, <span class="stringliteral">&quot;Cache-Control&quot;</span>, val, -1);</div>
<div class="line"><span class="lineno"> 4113</span> </div>
<div class="line"><span class="lineno"> 4114</span><span class="preprocessor">#else  </span><span class="comment">/* NO_CACHING */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 4115</span> </div>
<div class="line"><span class="lineno"> 4116</span>    <a class="code hl_function" href="#a4e9abca78e3f98b886081d15550f7fca">send_no_cache_header</a>(conn);</div>
<div class="line"><span class="lineno"> 4117</span><span class="preprocessor">#endif </span><span class="comment">/* !NO_CACHING */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 4118</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8h.html#a487cdeb41049480452d49e52a9f24465">mg_response_header_add()</a>, <a class="el" href="#a847434a4a5f5ea7a1a1bca87625ccb81">mg_snprintf()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l04056">send_no_cache_header()</a>, <a class="el" href="civetweb_8c_source.html#l02047">STATIC_FILE_CACHE_CONTROL</a>, and <a class="el" href="civetweb_8c_source.html#l02046">STATIC_FILE_MAX_AGE</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l12802">dav_lock_file()</a>, <a class="el" href="civetweb_8c_source.html#l11915">dav_mkcol()</a>, <a class="el" href="civetweb_8c_source.html#l12964">dav_proppatch()</a>, <a class="el" href="civetweb_8c_source.html#l09942">handle_directory_request()</a>, <a class="el" href="civetweb_8c_source.html#l10483">handle_not_modified_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l12759">handle_propfind()</a>, <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, and <a class="el" href="civetweb_8c_source.html#l04618">mg_send_http_redirect()</a>.</p>

</div>
</div>
<a id="a9dc4b721d5bb3b8e494257027050c47f" name="a9dc4b721d5bb3b8e494257027050c47f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9dc4b721d5bb3b8e494257027050c47f">&#9670;&#160;</a></span>set_acl_option()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int set_acl_option </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>phys_ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17662">17662</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17663</span>{</div>
<div class="line"><span class="lineno">17664</span>    <span class="keyword">union </span><a class="code hl_union" href="unionusa.html">usa</a> <a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>;</div>
<div class="line"><span class="lineno">17665</span>    memset(&amp;<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>));</div>
<div class="line"><span class="lineno">17666</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">17667</span>    <a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sin6.sin6_family = AF_INET6;</div>
<div class="line"><span class="lineno">17668</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">17669</span>    <a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sin.sin_family = AF_INET;</div>
<div class="line"><span class="lineno">17670</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17671</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a413ce152f72e5e12647a950de90d589f">check_acl</a>(phys_ctx, &amp;<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>) != -1;</div>
<div class="line"><span class="lineno">17672</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l16229">check_acl()</a>, and <a class="el" href="civetweb_8c_source.html#l01833">usa::sa</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="a9edc91d3d1362d1b5be5371d44ce3d03" name="a9edc91d3d1362d1b5be5371d44ce3d03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9edc91d3d1362d1b5be5371d44ce3d03">&#9670;&#160;</a></span>set_blocking_mode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int set_blocking_mode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a></td>          <td class="paramname"><span class="paramname"><em>sock</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l05890">5890</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 5891</span>{</div>
<div class="line"><span class="lineno"> 5892</span>    <span class="keywordtype">int</span> flags = fcntl(sock, F_GETFL, 0);</div>
<div class="line"><span class="lineno"> 5893</span>    <span class="keywordflow">if</span> (flags &lt; 0) {</div>
<div class="line"><span class="lineno"> 5894</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 5895</span>    }</div>
<div class="line"><span class="lineno"> 5896</span> </div>
<div class="line"><span class="lineno"> 5897</span>    <span class="keywordflow">if</span> (fcntl(sock, F_SETFL, flags &amp; (~(<span class="keywordtype">int</span>)(O_NONBLOCK))) &lt; 0) {</div>
<div class="line"><span class="lineno"> 5898</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 5899</span>    }</div>
<div class="line"><span class="lineno"> 5900</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 5901</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17740">close_socket_gracefully()</a>.</p>

</div>
</div>
<a id="aea8c64184a00214c2f457d5e30f89478" name="aea8c64184a00214c2f457d5e30f89478"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea8c64184a00214c2f457d5e30f89478">&#9670;&#160;</a></span>set_close_on_exec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void set_close_on_exec </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fd</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l05677">5677</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 5680</span>{</div>
<div class="line"><span class="lineno"> 5681</span><span class="preprocessor">#if defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno"> 5682</span>    (void)fd;</div>
<div class="line"><span class="lineno"> 5683</span>    (void)conn;</div>
<div class="line"><span class="lineno"> 5684</span>    (void)ctx;</div>
<div class="line"><span class="lineno"> 5685</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 5686</span>    <span class="keywordflow">if</span> (fcntl(fd, F_SETFD, FD_CLOEXEC) != 0) {</div>
<div class="line"><span class="lineno"> 5687</span>        <span class="keywordflow">if</span> (conn || ctx) {</div>
<div class="line"><span class="lineno"> 5688</span>            <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> fc;</div>
<div class="line"><span class="lineno"> 5689</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>((conn ? conn : <a class="code hl_function" href="#a46e65877beedb5fed507ad30dbf76d86">fake_connection</a>(&amp;fc, ctx)),</div>
<div class="line"><span class="lineno"> 5690</span>                            <span class="stringliteral">&quot;%s: fcntl(F_SETFD FD_CLOEXEC) failed: %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 5691</span>                            __func__,</div>
<div class="line"><span class="lineno"> 5692</span>                            strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 5693</span>        }</div>
<div class="line"><span class="lineno"> 5694</span>    }</div>
<div class="line"><span class="lineno"> 5695</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 5696</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l03470">fake_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>, <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>, and <a class="el" href="civetweb_8c_source.html#l05768">spawn_process()</a>.</p>

</div>
</div>
<a id="a6c0f85beb9e4157e5da9ad2550fc2258" name="a6c0f85beb9e4157e5da9ad2550fc2258"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c0f85beb9e4157e5da9ad2550fc2258">&#9670;&#160;</a></span>set_gpass_option()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int set_gpass_option </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>phys_ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__domain__context.html">mg_domain_context</a> *</td>          <td class="paramname"><span class="paramname"><em>dom_ctx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17636">17636</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17637</span>{</div>
<div class="line"><span class="lineno">17638</span>    <span class="keywordflow">if</span> (phys_ctx) {</div>
<div class="line"><span class="lineno">17639</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__file.html">mg_file</a> file = <a class="code hl_define" href="#af7932a261d02cf4b8431793664a4585b">STRUCT_FILE_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">17640</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *path;</div>
<div class="line"><span class="lineno">17641</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> fc;</div>
<div class="line"><span class="lineno">17642</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno">17643</span>            <a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> = &amp;(<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>);</div>
<div class="line"><span class="lineno">17644</span>        }</div>
<div class="line"><span class="lineno">17645</span>        path = <a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba0d86924aee1330b50c85079ae6ff8032">GLOBAL_PASSWORDS_FILE</a>];</div>
<div class="line"><span class="lineno">17646</span>        <span class="keywordflow">if</span> ((path != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">17647</span>            &amp;&amp; !<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(<a class="code hl_function" href="#a46e65877beedb5fed507ad30dbf76d86">fake_connection</a>(&amp;fc, <a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>), path, &amp;file.<a class="code hl_variable" href="structmg__file.html#a3879afe201c7dfb12c2d3fe73c7c66c7">stat</a>)) {</div>
<div class="line"><span class="lineno">17648</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>,</div>
<div class="line"><span class="lineno">17649</span>                                <span class="stringliteral">&quot;Cannot open %s: %s&quot;</span>,</div>
<div class="line"><span class="lineno">17650</span>                                path,</div>
<div class="line"><span class="lineno">17651</span>                                strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno">17652</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17653</span>        }</div>
<div class="line"><span class="lineno">17654</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">17655</span>    }</div>
<div class="line"><span class="lineno">17656</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17657</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l03470">fake_connection()</a>, <a class="el" href="civetweb_8c_source.html#l02004">GLOBAL_PASSWORDS_FILE</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01886">mg_file::stat</a>, and <a class="el" href="civetweb_8c_source.html#l01891">STRUCT_FILE_INITIALIZER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="a145cf727fe064c50f8101a6650495a61" name="a145cf727fe064c50f8101a6650495a61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a145cf727fe064c50f8101a6650495a61">&#9670;&#160;</a></span>set_non_blocking_mode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int set_non_blocking_mode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="#a8dc8083897335125630f1af5dafd5831">SOCKET</a></td>          <td class="paramname"><span class="paramname"><em>sock</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l05876">5876</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 5877</span>{</div>
<div class="line"><span class="lineno"> 5878</span>    <span class="keywordtype">int</span> flags = fcntl(sock, F_GETFL, 0);</div>
<div class="line"><span class="lineno"> 5879</span>    <span class="keywordflow">if</span> (flags &lt; 0) {</div>
<div class="line"><span class="lineno"> 5880</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 5881</span>    }</div>
<div class="line"><span class="lineno"> 5882</span> </div>
<div class="line"><span class="lineno"> 5883</span>    <span class="keywordflow">if</span> (fcntl(sock, F_SETFL, (flags | O_NONBLOCK)) &lt; 0) {</div>
<div class="line"><span class="lineno"> 5884</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 5885</span>    }</div>
<div class="line"><span class="lineno"> 5886</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 5887</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l09287">connect_socket()</a>.</p>

</div>
</div>
<a id="a7c6eca1c5a3388266a2d289ce34fda58" name="a7c6eca1c5a3388266a2d289ce34fda58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c6eca1c5a3388266a2d289ce34fda58">&#9670;&#160;</a></span>set_ports_option()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int set_ports_option </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>phys_ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l15736">15736</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">15737</span>{</div>
<div class="line"><span class="lineno">15738</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *list;</div>
<div class="line"><span class="lineno">15739</span>    <span class="keywordtype">int</span> on = 1;</div>
<div class="line"><span class="lineno">15740</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">15741</span>    <span class="keywordtype">int</span> off = 0;</div>
<div class="line"><span class="lineno">15742</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15743</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> <a class="code hl_struct" href="structvec.html">vec</a>;</div>
<div class="line"><span class="lineno">15744</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structsocket.html">socket</a> so, *ptr;</div>
<div class="line"><span class="lineno">15745</span> </div>
<div class="line"><span class="lineno">15746</span>    <span class="keyword">struct </span><a class="code hl_define" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> *pfd;</div>
<div class="line"><span class="lineno">15747</span>    <span class="keyword">union </span><a class="code hl_union" href="unionusa.html">usa</a> <a class="code hl_union" href="unionusa.html">usa</a>;</div>
<div class="line"><span class="lineno">15748</span>    socklen_t len;</div>
<div class="line"><span class="lineno">15749</span>    <span class="keywordtype">int</span> ip_version;</div>
<div class="line"><span class="lineno">15750</span> </div>
<div class="line"><span class="lineno">15751</span>    <span class="keywordtype">int</span> portsTotal = 0;</div>
<div class="line"><span class="lineno">15752</span>    <span class="keywordtype">int</span> portsOk = 0;</div>
<div class="line"><span class="lineno">15753</span> </div>
<div class="line"><span class="lineno">15754</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *opt_txt;</div>
<div class="line"><span class="lineno">15755</span>    <span class="keywordtype">long</span> opt_listen_backlog;</div>
<div class="line"><span class="lineno">15756</span> </div>
<div class="line"><span class="lineno">15757</span>    <span class="keywordflow">if</span> (!phys_ctx) {</div>
<div class="line"><span class="lineno">15758</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">15759</span>    }</div>
<div class="line"><span class="lineno">15760</span> </div>
<div class="line"><span class="lineno">15761</span>    memset(&amp;so, 0, <span class="keyword">sizeof</span>(so));</div>
<div class="line"><span class="lineno">15762</span>    memset(&amp;<a class="code hl_union" href="unionusa.html">usa</a>, 0, <span class="keyword">sizeof</span>(<a class="code hl_union" href="unionusa.html">usa</a>));</div>
<div class="line"><span class="lineno">15763</span>    len = <span class="keyword">sizeof</span>(<a class="code hl_union" href="unionusa.html">usa</a>);</div>
<div class="line"><span class="lineno">15764</span>    list = phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf601bd4b356c4750051683794f27028e">LISTENING_PORTS</a>];</div>
<div class="line"><span class="lineno">15765</span> </div>
<div class="line"><span class="lineno">15766</span>    <span class="keywordflow">while</span> ((list = <a class="code hl_function" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a>(list, &amp;<a class="code hl_struct" href="structvec.html">vec</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">15767</span> </div>
<div class="line"><span class="lineno">15768</span>        portsTotal++;</div>
<div class="line"><span class="lineno">15769</span> </div>
<div class="line"><span class="lineno">15770</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a7326cd5fb1c2444cbce208b8c7005581">parse_port_string</a>(&amp;<a class="code hl_struct" href="structvec.html">vec</a>, &amp;so, &amp;ip_version)) {</div>
<div class="line"><span class="lineno">15771</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(</div>
<div class="line"><span class="lineno">15772</span>                phys_ctx,</div>
<div class="line"><span class="lineno">15773</span>                <span class="stringliteral">&quot;%.*s: invalid port spec (entry %i). Expecting list of: %s&quot;</span>,</div>
<div class="line"><span class="lineno">15774</span>                (<span class="keywordtype">int</span>)<a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>,</div>
<div class="line"><span class="lineno">15775</span>                <a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>,</div>
<div class="line"><span class="lineno">15776</span>                portsTotal,</div>
<div class="line"><span class="lineno">15777</span>                <span class="stringliteral">&quot;[IP_ADDRESS:]PORT[s|r]&quot;</span>);</div>
<div class="line"><span class="lineno">15778</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15779</span>        }</div>
<div class="line"><span class="lineno">15780</span> </div>
<div class="line"><span class="lineno">15781</span><span class="preprocessor">#if !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno">15782</span>        <span class="keywordflow">if</span> (so.is_ssl &amp;&amp; phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">15783</span> </div>
<div class="line"><span class="lineno">15784</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">15785</span>                                <span class="stringliteral">&quot;Cannot add SSL socket (entry %i)&quot;</span>,</div>
<div class="line"><span class="lineno">15786</span>                                portsTotal);</div>
<div class="line"><span class="lineno">15787</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15788</span>        }</div>
<div class="line"><span class="lineno">15789</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15790</span>        <span class="comment">/* Create socket. */</span></div>
<div class="line"><span class="lineno">15791</span>        <span class="comment">/* For a list of protocol numbers (e.g., TCP==6) see:</span></div>
<div class="line"><span class="lineno">15792</span><span class="comment">         * https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml</span></div>
<div class="line"><span class="lineno">15793</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">15794</span>        <span class="keywordflow">if</span> ((so.sock =</div>
<div class="line"><span class="lineno">15795</span>                 <a class="code hl_struct" href="structsocket.html">socket</a>(so.lsa.sa.sa_family,</div>
<div class="line"><span class="lineno">15796</span>                        SOCK_STREAM,</div>
<div class="line"><span class="lineno">15797</span>                        (ip_version == 99) ? (<span class="comment">/* LOCAL */</span> 0) : (<span class="comment">/* TCP */</span> 6)))</div>
<div class="line"><span class="lineno">15798</span>            == <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>) {</div>
<div class="line"><span class="lineno">15799</span> </div>
<div class="line"><span class="lineno">15800</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">15801</span>                                <span class="stringliteral">&quot;cannot create socket (entry %i)&quot;</span>,</div>
<div class="line"><span class="lineno">15802</span>                                portsTotal);</div>
<div class="line"><span class="lineno">15803</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15804</span>        }</div>
<div class="line"><span class="lineno">15805</span> </div>
<div class="line"><span class="lineno">15806</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">15807</span>        <span class="comment">/* Windows SO_REUSEADDR lets many procs binds to a</span></div>
<div class="line"><span class="lineno">15808</span><span class="comment">         * socket, SO_EXCLUSIVEADDRUSE makes the bind fail</span></div>
<div class="line"><span class="lineno">15809</span><span class="comment">         * if someone already has the socket -- DTL */</span></div>
<div class="line"><span class="lineno">15810</span>        <span class="comment">/* NOTE: If SO_EXCLUSIVEADDRUSE is used,</span></div>
<div class="line"><span class="lineno">15811</span><span class="comment">         * Windows might need a few seconds before</span></div>
<div class="line"><span class="lineno">15812</span><span class="comment">         * the same port can be used again in the</span></div>
<div class="line"><span class="lineno">15813</span><span class="comment">         * same process, so a short Sleep may be</span></div>
<div class="line"><span class="lineno">15814</span><span class="comment">         * required between mg_stop and mg_start.</span></div>
<div class="line"><span class="lineno">15815</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">15816</span>        <span class="keywordflow">if</span> (setsockopt(so.sock,</div>
<div class="line"><span class="lineno">15817</span>                       SOL_SOCKET,</div>
<div class="line"><span class="lineno">15818</span>                       SO_EXCLUSIVEADDRUSE,</div>
<div class="line"><span class="lineno">15819</span>                       (<a class="code hl_typedef" href="#a1bbb7024f8dda275a22cdc1df0527224">SOCK_OPT_TYPE</a>)&amp;on,</div>
<div class="line"><span class="lineno">15820</span>                       <span class="keyword">sizeof</span>(on))</div>
<div class="line"><span class="lineno">15821</span>            != 0) {</div>
<div class="line"><span class="lineno">15822</span> </div>
<div class="line"><span class="lineno">15823</span>            <span class="comment">/* Set reuse option, but don&#39;t abort on errors. */</span></div>
<div class="line"><span class="lineno">15824</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(</div>
<div class="line"><span class="lineno">15825</span>                phys_ctx,</div>
<div class="line"><span class="lineno">15826</span>                <span class="stringliteral">&quot;cannot set socket option SO_EXCLUSIVEADDRUSE (entry %i)&quot;</span>,</div>
<div class="line"><span class="lineno">15827</span>                portsTotal);</div>
<div class="line"><span class="lineno">15828</span>        }</div>
<div class="line"><span class="lineno">15829</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">15830</span>        <span class="keywordflow">if</span> (setsockopt(so.sock,</div>
<div class="line"><span class="lineno">15831</span>                       SOL_SOCKET,</div>
<div class="line"><span class="lineno">15832</span>                       SO_REUSEADDR,</div>
<div class="line"><span class="lineno">15833</span>                       (<a class="code hl_typedef" href="#a1bbb7024f8dda275a22cdc1df0527224">SOCK_OPT_TYPE</a>)&amp;on,</div>
<div class="line"><span class="lineno">15834</span>                       <span class="keyword">sizeof</span>(on))</div>
<div class="line"><span class="lineno">15835</span>            != 0) {</div>
<div class="line"><span class="lineno">15836</span> </div>
<div class="line"><span class="lineno">15837</span>            <span class="comment">/* Set reuse option, but don&#39;t abort on errors. */</span></div>
<div class="line"><span class="lineno">15838</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(</div>
<div class="line"><span class="lineno">15839</span>                phys_ctx,</div>
<div class="line"><span class="lineno">15840</span>                <span class="stringliteral">&quot;cannot set socket option SO_REUSEADDR (entry %i)&quot;</span>,</div>
<div class="line"><span class="lineno">15841</span>                portsTotal);</div>
<div class="line"><span class="lineno">15842</span>        }</div>
<div class="line"><span class="lineno">15843</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15844</span> </div>
<div class="line"><span class="lineno">15845</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno">15846</span>        <span class="keywordflow">if</span> (ip_version == 99) {</div>
<div class="line"><span class="lineno">15847</span>            <span class="comment">/* Unix domain socket */</span></div>
<div class="line"><span class="lineno">15848</span>        } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">15849</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15850</span> </div>
<div class="line"><span class="lineno">15851</span>            <span class="keywordflow">if</span> (ip_version &gt; 4) {</div>
<div class="line"><span class="lineno">15852</span>            <span class="comment">/* Could be 6 for IPv6 onlyor 10 (4+6) for IPv4+IPv6 */</span></div>
<div class="line"><span class="lineno">15853</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">15854</span>            <span class="keywordflow">if</span> (ip_version &gt; 6) {</div>
<div class="line"><span class="lineno">15855</span>                <span class="keywordflow">if</span> (so.lsa.sa.sa_family == AF_INET6</div>
<div class="line"><span class="lineno">15856</span>                    &amp;&amp; setsockopt(so.sock,</div>
<div class="line"><span class="lineno">15857</span>                                  IPPROTO_IPV6,</div>
<div class="line"><span class="lineno">15858</span>                                  IPV6_V6ONLY,</div>
<div class="line"><span class="lineno">15859</span>                                  (<span class="keywordtype">void</span> *)&amp;off,</div>
<div class="line"><span class="lineno">15860</span>                                  <span class="keyword">sizeof</span>(off))</div>
<div class="line"><span class="lineno">15861</span>                           != 0) {</div>
<div class="line"><span class="lineno">15862</span> </div>
<div class="line"><span class="lineno">15863</span>                    <span class="comment">/* Set IPv6 only option, but don&#39;t abort on errors. */</span></div>
<div class="line"><span class="lineno">15864</span>                    <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">15865</span>                                        <span class="stringliteral">&quot;cannot set socket option &quot;</span></div>
<div class="line"><span class="lineno">15866</span>                                        <span class="stringliteral">&quot;IPV6_V6ONLY=off (entry %i)&quot;</span>,</div>
<div class="line"><span class="lineno">15867</span>                                        portsTotal);</div>
<div class="line"><span class="lineno">15868</span>                }</div>
<div class="line"><span class="lineno">15869</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15870</span>                <span class="keywordflow">if</span> (so.lsa.sa.sa_family == AF_INET6</div>
<div class="line"><span class="lineno">15871</span>                    &amp;&amp; setsockopt(so.sock,</div>
<div class="line"><span class="lineno">15872</span>                                  IPPROTO_IPV6,</div>
<div class="line"><span class="lineno">15873</span>                                  IPV6_V6ONLY,</div>
<div class="line"><span class="lineno">15874</span>                                  (<span class="keywordtype">void</span> *)&amp;on,</div>
<div class="line"><span class="lineno">15875</span>                                  <span class="keyword">sizeof</span>(on))</div>
<div class="line"><span class="lineno">15876</span>                           != 0) {</div>
<div class="line"><span class="lineno">15877</span> </div>
<div class="line"><span class="lineno">15878</span>                    <span class="comment">/* Set IPv6 only option, but don&#39;t abort on errors. */</span></div>
<div class="line"><span class="lineno">15879</span>                    <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">15880</span>                                        <span class="stringliteral">&quot;cannot set socket option &quot;</span></div>
<div class="line"><span class="lineno">15881</span>                                        <span class="stringliteral">&quot;IPV6_V6ONLY=on (entry %i)&quot;</span>,</div>
<div class="line"><span class="lineno">15882</span>                                        portsTotal);</div>
<div class="line"><span class="lineno">15883</span>                }</div>
<div class="line"><span class="lineno">15884</span>            }</div>
<div class="line"><span class="lineno">15885</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">15886</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;IPv6 not available&quot;</span>);</div>
<div class="line"><span class="lineno">15887</span>            <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">15888</span>            so.sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">15889</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15890</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15891</span>        }</div>
<div class="line"><span class="lineno">15892</span> </div>
<div class="line"><span class="lineno">15893</span>        <span class="keywordflow">if</span> (so.lsa.sa.sa_family == AF_INET) {</div>
<div class="line"><span class="lineno">15894</span> </div>
<div class="line"><span class="lineno">15895</span>            len = <span class="keyword">sizeof</span>(so.lsa.sin);</div>
<div class="line"><span class="lineno">15896</span>            <span class="keywordflow">if</span> (bind(so.sock, &amp;so.lsa.sa, len) != 0) {</div>
<div class="line"><span class="lineno">15897</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">15898</span>                                    <span class="stringliteral">&quot;cannot bind to %.*s: %d (%s)&quot;</span>,</div>
<div class="line"><span class="lineno">15899</span>                                    (<span class="keywordtype">int</span>)<a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>,</div>
<div class="line"><span class="lineno">15900</span>                                    <a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>,</div>
<div class="line"><span class="lineno">15901</span>                                    (<span class="keywordtype">int</span>)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>,</div>
<div class="line"><span class="lineno">15902</span>                                    strerror(errno));</div>
<div class="line"><span class="lineno">15903</span>                <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">15904</span>                so.sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">15905</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15906</span>            }</div>
<div class="line"><span class="lineno">15907</span>        }</div>
<div class="line"><span class="lineno">15908</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">15909</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (so.lsa.sa.sa_family == AF_INET6) {</div>
<div class="line"><span class="lineno">15910</span> </div>
<div class="line"><span class="lineno">15911</span>            len = <span class="keyword">sizeof</span>(so.lsa.sin6);</div>
<div class="line"><span class="lineno">15912</span>            <span class="keywordflow">if</span> (bind(so.sock, &amp;so.lsa.sa, len) != 0) {</div>
<div class="line"><span class="lineno">15913</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">15914</span>                                    <span class="stringliteral">&quot;cannot bind to IPv6 %.*s: %d (%s)&quot;</span>,</div>
<div class="line"><span class="lineno">15915</span>                                    (<span class="keywordtype">int</span>)<a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>,</div>
<div class="line"><span class="lineno">15916</span>                                    <a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>,</div>
<div class="line"><span class="lineno">15917</span>                                    (<span class="keywordtype">int</span>)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>,</div>
<div class="line"><span class="lineno">15918</span>                                    strerror(errno));</div>
<div class="line"><span class="lineno">15919</span>                <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">15920</span>                so.sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">15921</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15922</span>            }</div>
<div class="line"><span class="lineno">15923</span>        }</div>
<div class="line"><span class="lineno">15924</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15925</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno">15926</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (so.lsa.sa.sa_family == AF_UNIX) {</div>
<div class="line"><span class="lineno">15927</span> </div>
<div class="line"><span class="lineno">15928</span>            len = <span class="keyword">sizeof</span>(so.lsa.sun);</div>
<div class="line"><span class="lineno">15929</span>            <span class="keywordflow">if</span> (bind(so.sock, &amp;so.lsa.sa, len) != 0) {</div>
<div class="line"><span class="lineno">15930</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">15931</span>                                    <span class="stringliteral">&quot;cannot bind to unix socket %s: %d (%s)&quot;</span>,</div>
<div class="line"><span class="lineno">15932</span>                                    so.lsa.sun.sun_path,</div>
<div class="line"><span class="lineno">15933</span>                                    (<span class="keywordtype">int</span>)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>,</div>
<div class="line"><span class="lineno">15934</span>                                    strerror(errno));</div>
<div class="line"><span class="lineno">15935</span>                <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">15936</span>                so.sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">15937</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15938</span>            }</div>
<div class="line"><span class="lineno">15939</span>        }</div>
<div class="line"><span class="lineno">15940</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15941</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">15942</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(</div>
<div class="line"><span class="lineno">15943</span>                phys_ctx,</div>
<div class="line"><span class="lineno">15944</span>                <span class="stringliteral">&quot;cannot bind: address family not supported (entry %i)&quot;</span>,</div>
<div class="line"><span class="lineno">15945</span>                portsTotal);</div>
<div class="line"><span class="lineno">15946</span>            <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">15947</span>            so.sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">15948</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15949</span>        }</div>
<div class="line"><span class="lineno">15950</span> </div>
<div class="line"><span class="lineno">15951</span>        opt_txt = phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf13327a7aed89d59cc7e4200d088f205">LISTEN_BACKLOG_SIZE</a>];</div>
<div class="line"><span class="lineno">15952</span>        opt_listen_backlog = strtol(opt_txt, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 10);</div>
<div class="line"><span class="lineno">15953</span>        <span class="keywordflow">if</span> ((opt_listen_backlog &gt; INT_MAX) || (opt_listen_backlog &lt; 1)) {</div>
<div class="line"><span class="lineno">15954</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">15955</span>                                <span class="stringliteral">&quot;%s value \&quot;%s\&quot; is invalid&quot;</span>,</div>
<div class="line"><span class="lineno">15956</span>                                <a class="code hl_variable" href="#a414393f1a7ad731456acc279c62290d0">config_options</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf13327a7aed89d59cc7e4200d088f205">LISTEN_BACKLOG_SIZE</a>].<a class="code hl_variable" href="lsqlite3_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,</div>
<div class="line"><span class="lineno">15957</span>                                opt_txt);</div>
<div class="line"><span class="lineno">15958</span>            <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">15959</span>            so.sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">15960</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15961</span>        }</div>
<div class="line"><span class="lineno">15962</span> </div>
<div class="line"><span class="lineno">15963</span>        <span class="keywordflow">if</span> (listen(so.sock, (<span class="keywordtype">int</span>)opt_listen_backlog) != 0) {</div>
<div class="line"><span class="lineno">15964</span> </div>
<div class="line"><span class="lineno">15965</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">15966</span>                                <span class="stringliteral">&quot;cannot listen to %.*s: %d (%s)&quot;</span>,</div>
<div class="line"><span class="lineno">15967</span>                                (<span class="keywordtype">int</span>)<a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>,</div>
<div class="line"><span class="lineno">15968</span>                                <a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>,</div>
<div class="line"><span class="lineno">15969</span>                                (<span class="keywordtype">int</span>)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>,</div>
<div class="line"><span class="lineno">15970</span>                                strerror(errno));</div>
<div class="line"><span class="lineno">15971</span>            <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">15972</span>            so.sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">15973</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15974</span>        }</div>
<div class="line"><span class="lineno">15975</span> </div>
<div class="line"><span class="lineno">15976</span>        <span class="keywordflow">if</span> ((getsockname(so.sock, &amp;(<a class="code hl_union" href="unionusa.html">usa</a>.<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>), &amp;len) != 0)</div>
<div class="line"><span class="lineno">15977</span>            || (<a class="code hl_union" href="unionusa.html">usa</a>.<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family != so.lsa.sa.sa_family)) {</div>
<div class="line"><span class="lineno">15978</span> </div>
<div class="line"><span class="lineno">15979</span>            <span class="keywordtype">int</span> err = (int)<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>;</div>
<div class="line"><span class="lineno">15980</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">15981</span>                                <span class="stringliteral">&quot;call to getsockname failed %.*s: %d (%s)&quot;</span>,</div>
<div class="line"><span class="lineno">15982</span>                                (<span class="keywordtype">int</span>)<a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>,</div>
<div class="line"><span class="lineno">15983</span>                                <a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>,</div>
<div class="line"><span class="lineno">15984</span>                                err,</div>
<div class="line"><span class="lineno">15985</span>                                strerror(errno));</div>
<div class="line"><span class="lineno">15986</span>            <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">15987</span>            so.sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">15988</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">15989</span>        }</div>
<div class="line"><span class="lineno">15990</span> </div>
<div class="line"><span class="lineno">15991</span>        <span class="comment">/* Update lsa port in case of random free ports */</span></div>
<div class="line"><span class="lineno">15992</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno">15993</span>        <span class="keywordflow">if</span> (so.lsa.sa.sa_family == AF_INET6) {</div>
<div class="line"><span class="lineno">15994</span>            so.lsa.sin6.sin6_port = <a class="code hl_union" href="unionusa.html">usa</a>.sin6.sin6_port;</div>
<div class="line"><span class="lineno">15995</span>        } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">15996</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">15997</span>        {</div>
<div class="line"><span class="lineno">15998</span>            so.lsa.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_port = <a class="code hl_union" href="unionusa.html">usa</a>.<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>.sin_port;</div>
<div class="line"><span class="lineno">15999</span>        }</div>
<div class="line"><span class="lineno">16000</span> </div>
<div class="line"><span class="lineno">16001</span>        <span class="keywordflow">if</span> ((ptr = (<span class="keyword">struct</span> <a class="code hl_struct" href="structsocket.html">socket</a> *)</div>
<div class="line"><span class="lineno">16002</span>                 <a class="code hl_define" href="#ab36230fc0a06484369ac2dc5331260f4">mg_realloc_ctx</a>(phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>,</div>
<div class="line"><span class="lineno">16003</span>                                (phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ade1ccb738022fd01597c1816cb88d1e4">num_listening_sockets</a> + 1)</div>
<div class="line"><span class="lineno">16004</span>                                    * <span class="keyword">sizeof</span>(phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[0]),</div>
<div class="line"><span class="lineno">16005</span>                                phys_ctx))</div>
<div class="line"><span class="lineno">16006</span>            == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16007</span> </div>
<div class="line"><span class="lineno">16008</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Out of memory&quot;</span>);</div>
<div class="line"><span class="lineno">16009</span>            <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">16010</span>            so.sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">16011</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">16012</span>        }</div>
<div class="line"><span class="lineno">16013</span> </div>
<div class="line"><span class="lineno">16014</span>        <span class="keywordflow">if</span> ((pfd = (<span class="keyword">struct</span> <a class="code hl_define" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> *)</div>
<div class="line"><span class="lineno">16015</span>                 <a class="code hl_define" href="#ab36230fc0a06484369ac2dc5331260f4">mg_realloc_ctx</a>(phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a9ed2145955cdb391d6ffba32a1df8d16">listening_socket_fds</a>,</div>
<div class="line"><span class="lineno">16016</span>                                (phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ade1ccb738022fd01597c1816cb88d1e4">num_listening_sockets</a> + 1)</div>
<div class="line"><span class="lineno">16017</span>                                    * <span class="keyword">sizeof</span>(phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a9ed2145955cdb391d6ffba32a1df8d16">listening_socket_fds</a>[0]),</div>
<div class="line"><span class="lineno">16018</span>                                phys_ctx))</div>
<div class="line"><span class="lineno">16019</span>            == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16020</span> </div>
<div class="line"><span class="lineno">16021</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Out of memory&quot;</span>);</div>
<div class="line"><span class="lineno">16022</span>            <a class="code hl_define" href="#a3d96b607aca31a2236372e56ffb72112">closesocket</a>(so.sock);</div>
<div class="line"><span class="lineno">16023</span>            so.sock = <a class="code hl_define" href="#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div>
<div class="line"><span class="lineno">16024</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(ptr);</div>
<div class="line"><span class="lineno">16025</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">16026</span>        }</div>
<div class="line"><span class="lineno">16027</span> </div>
<div class="line"><span class="lineno">16028</span>        <a class="code hl_function" href="#aea8c64184a00214c2f457d5e30f89478">set_close_on_exec</a>(so.sock, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, phys_ctx);</div>
<div class="line"><span class="lineno">16029</span>        phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a> = ptr;</div>
<div class="line"><span class="lineno">16030</span>        phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a8639456185dda0c46dc6131f814a9d3f">listening_sockets</a>[phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ade1ccb738022fd01597c1816cb88d1e4">num_listening_sockets</a>] = so;</div>
<div class="line"><span class="lineno">16031</span>        phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a9ed2145955cdb391d6ffba32a1df8d16">listening_socket_fds</a> = pfd;</div>
<div class="line"><span class="lineno">16032</span>        phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#ade1ccb738022fd01597c1816cb88d1e4">num_listening_sockets</a>++;</div>
<div class="line"><span class="lineno">16033</span>        portsOk++;</div>
<div class="line"><span class="lineno">16034</span>    }</div>
<div class="line"><span class="lineno">16035</span> </div>
<div class="line"><span class="lineno">16036</span>    <span class="keywordflow">if</span> (portsOk != portsTotal) {</div>
<div class="line"><span class="lineno">16037</span>        <a class="code hl_function" href="#a3c23cebc85fcd88f7a1cf2227a7e1889">close_all_listening_sockets</a>(phys_ctx);</div>
<div class="line"><span class="lineno">16038</span>        portsOk = 0;</div>
<div class="line"><span class="lineno">16039</span>    }</div>
<div class="line"><span class="lineno">16040</span> </div>
<div class="line"><span class="lineno">16041</span>    <span class="keywordflow">return</span> portsOk;</div>
<div class="line"><span class="lineno">16042</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a7326cd5fb1c2444cbce208b8c7005581"><div class="ttname"><a href="#a7326cd5fb1c2444cbce208b8c7005581">parse_port_string</a></div><div class="ttdeci">static int parse_port_string(const struct vec *vec, struct socket *so, int *ip_version)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l15501">civetweb.c:15501</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l15456">close_all_listening_sockets()</a>, <a class="el" href="civetweb_8c_source.html#l00917">closesocket</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02062">config_options</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l00925">INVALID_SOCKET</a>, <a class="el" href="civetweb_8c_source.html#l01906">socket::is_ssl</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8c_source.html#l01928">LISTEN_BACKLOG_SIZE</a>, <a class="el" href="civetweb_8c_source.html#l01920">LISTENING_PORTS</a>, <a class="el" href="civetweb_8c_source.html#l02357">mg_context::listening_socket_fds</a>, <a class="el" href="civetweb_8c_source.html#l02356">mg_context::listening_sockets</a>, <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l00948">mg_pollfd</a>, <a class="el" href="civetweb_8c_source.html#l01499">mg_realloc_ctx</a>, <a class="el" href="lsqlite3_8c_source.html#l02154">name</a>, <a class="el" href="civetweb_8c_source.html#l03899">next_option()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02358">mg_context::num_listening_sockets</a>, <a class="el" href="civetweb_8c_source.html#l15501">parse_port_string()</a>, <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>, <a class="el" href="civetweb_8c_source.html#l01833">usa::sa</a>, <a class="el" href="civetweb_8c_source.html#l05677">set_close_on_exec()</a>, <a class="el" href="civetweb_8c_source.html#l01834">usa::sin</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, and <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="a7003e9382b3b817de6ae349d754e2077" name="a7003e9382b3b817de6ae349d754e2077"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7003e9382b3b817de6ae349d754e2077">&#9670;&#160;</a></span>set_tcp_nodelay()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int set_tcp_nodelay </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structsocket.html">socket</a> *</td>          <td class="paramname"><span class="paramname"><em>so</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nodelay_on</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17718">17718</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17719</span>{</div>
<div class="line"><span class="lineno">17720</span>    <span class="keywordflow">if</span> ((so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family == AF_INET)</div>
<div class="line"><span class="lineno">17721</span>        || (so-&gt;<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>.<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family == AF_INET6)) {</div>
<div class="line"><span class="lineno">17722</span>        <span class="comment">/* Only for TCP sockets */</span></div>
<div class="line"><span class="lineno">17723</span>        <span class="keywordflow">if</span> (setsockopt(so-&gt;<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>,</div>
<div class="line"><span class="lineno">17724</span>                       IPPROTO_TCP,</div>
<div class="line"><span class="lineno">17725</span>                       TCP_NODELAY,</div>
<div class="line"><span class="lineno">17726</span>                       (<a class="code hl_typedef" href="#a1bbb7024f8dda275a22cdc1df0527224">SOCK_OPT_TYPE</a>)&amp;nodelay_on,</div>
<div class="line"><span class="lineno">17727</span>                       <span class="keyword">sizeof</span>(nodelay_on))</div>
<div class="line"><span class="lineno">17728</span>            != 0) {</div>
<div class="line"><span class="lineno">17729</span>            <span class="comment">/* Error */</span></div>
<div class="line"><span class="lineno">17730</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">17731</span>        }</div>
<div class="line"><span class="lineno">17732</span>    }</div>
<div class="line"><span class="lineno">17733</span>    <span class="comment">/* OK */</span></div>
<div class="line"><span class="lineno">17734</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">17735</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l01833">usa::sa</a>, and <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>.</p>

</div>
</div>
<a id="a84156e09ed2338602b0bda2a3734e1a4" name="a84156e09ed2338602b0bda2a3734e1a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84156e09ed2338602b0bda2a3734e1a4">&#9670;&#160;</a></span>set_throttle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int set_throttle </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>spec</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const union <a class="el" href="unionusa.html">usa</a> *</td>          <td class="paramname"><span class="paramname"><em>rsa</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uri</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14075">14075</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14076</span>{</div>
<div class="line"><span class="lineno">14077</span>    <span class="keywordtype">int</span> throttle = 0;</div>
<div class="line"><span class="lineno">14078</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> <a class="code hl_struct" href="structvec.html">vec</a>, val;</div>
<div class="line"><span class="lineno">14079</span>    <span class="keywordtype">char</span> mult;</div>
<div class="line"><span class="lineno">14080</span>    <span class="keywordtype">double</span> v;</div>
<div class="line"><span class="lineno">14081</span> </div>
<div class="line"><span class="lineno">14082</span>    <span class="keywordflow">while</span> ((spec = <a class="code hl_function" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a>(spec, &amp;<a class="code hl_struct" href="structvec.html">vec</a>, &amp;val)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">14083</span>        mult = <span class="charliteral">&#39;,&#39;</span>;</div>
<div class="line"><span class="lineno">14084</span>        <span class="keywordflow">if</span> ((val.ptr == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">14085</span>            || (sscanf(val.ptr, <span class="stringliteral">&quot;%lf%c&quot;</span>, &amp;v, &amp;mult)</div>
<div class="line"><span class="lineno">14086</span>                &lt; 1) <span class="comment">// NOLINT(cert-err34-c) &#39;sscanf&#39; used to convert a string</span></div>
<div class="line"><span class="lineno">14087</span>                     <span class="comment">// to an integer value, but function will not report</span></div>
<div class="line"><span class="lineno">14088</span>                     <span class="comment">// conversion errors; consider using &#39;strtol&#39; instead</span></div>
<div class="line"><span class="lineno">14089</span>            || (v &lt; 0)</div>
<div class="line"><span class="lineno">14090</span>            || ((<a class="code hl_function" href="#a9682bb02df6aff4820e030d3c730872e">lowercase</a>(&amp;mult) != <span class="charliteral">&#39;k&#39;</span>) &amp;&amp; (<a class="code hl_function" href="#a9682bb02df6aff4820e030d3c730872e">lowercase</a>(&amp;mult) != <span class="charliteral">&#39;m&#39;</span>)</div>
<div class="line"><span class="lineno">14091</span>                &amp;&amp; (mult != <span class="charliteral">&#39;,&#39;</span>))) {</div>
<div class="line"><span class="lineno">14092</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">14093</span>        }</div>
<div class="line"><span class="lineno">14094</span>        v *= (<a class="code hl_function" href="#a9682bb02df6aff4820e030d3c730872e">lowercase</a>(&amp;mult) == <span class="charliteral">&#39;k&#39;</span>)</div>
<div class="line"><span class="lineno">14095</span>                 ? 1024</div>
<div class="line"><span class="lineno">14096</span>                 : ((<a class="code hl_function" href="#a9682bb02df6aff4820e030d3c730872e">lowercase</a>(&amp;mult) == <span class="stringliteral">&#39;m&#39;</span>) ? 1048576 : 1);</div>
<div class="line"><span class="lineno">14097</span>        <span class="keywordflow">if</span> (<a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a> == 1 &amp;&amp; <a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>[0] == <span class="charliteral">&#39;*&#39;</span>) {</div>
<div class="line"><span class="lineno">14098</span>            throttle = (int)v;</div>
<div class="line"><span class="lineno">14099</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14100</span>            <span class="keywordtype">int</span> matched = <a class="code hl_function" href="#a917f041b64f1819b9bb4fd8a57e0d945">parse_match_net</a>(&amp;<a class="code hl_struct" href="structvec.html">vec</a>, rsa, 0);</div>
<div class="line"><span class="lineno">14101</span>            <span class="keywordflow">if</span> (matched &gt;= 0) {</div>
<div class="line"><span class="lineno">14102</span>                <span class="comment">/* a valid IP subnet */</span></div>
<div class="line"><span class="lineno">14103</span>                <span class="keywordflow">if</span> (matched) {</div>
<div class="line"><span class="lineno">14104</span>                    throttle = (int)v;</div>
<div class="line"><span class="lineno">14105</span>                }</div>
<div class="line"><span class="lineno">14106</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match_prefix(<a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#ae8b8fdc00d1598d046d14d0ae73a441a">ptr</a>, <a class="code hl_struct" href="structvec.html">vec</a>.<a class="code hl_variable" href="structvec.html#a171ca107ac87f39c832a05621c99a17b">len</a>, uri) &gt; 0) {</div>
<div class="line"><span class="lineno">14107</span>                throttle = (int)v;</div>
<div class="line"><span class="lineno">14108</span>            }</div>
<div class="line"><span class="lineno">14109</span>        }</div>
<div class="line"><span class="lineno">14110</span>    }</div>
<div class="line"><span class="lineno">14111</span> </div>
<div class="line"><span class="lineno">14112</span>    <span class="keywordflow">return</span> throttle;</div>
<div class="line"><span class="lineno">14113</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8c_source.html#l03012">lowercase()</a>, <a class="el" href="civetweb_8c_source.html#l03899">next_option()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l13966">parse_match_net()</a>, and <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a462b35ed3af5d8e9f56280956ee1839e" name="a462b35ed3af5d8e9f56280956ee1839e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a462b35ed3af5d8e9f56280956ee1839e">&#9670;&#160;</a></span>set_uid_option()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int set_uid_option </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>phys_ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16267">16267</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16268</span>{</div>
<div class="line"><span class="lineno">16269</span>    <span class="keywordtype">int</span> success = 0;</div>
<div class="line"><span class="lineno">16270</span> </div>
<div class="line"><span class="lineno">16271</span>    <span class="keywordflow">if</span> (phys_ctx) {</div>
<div class="line"><span class="lineno">16272</span>        <span class="comment">/* We are currently running as curr_uid. */</span></div>
<div class="line"><span class="lineno">16273</span>        <span class="keyword">const</span> uid_t curr_uid = getuid();</div>
<div class="line"><span class="lineno">16274</span>        <span class="comment">/* If set, we want to run as run_as_user. */</span></div>
<div class="line"><span class="lineno">16275</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *run_as_user = phys_ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba2273c8f628cf101bc49496219571b0c4">RUN_AS_USER</a>];</div>
<div class="line"><span class="lineno">16276</span>        <span class="keyword">const</span> <span class="keyword">struct </span>passwd *to_pw = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16277</span> </div>
<div class="line"><span class="lineno">16278</span>        <span class="keywordflow">if</span> ((run_as_user != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (to_pw = getpwnam(run_as_user)) == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16279</span>            <span class="comment">/* run_as_user does not exist on the system. We can&#39;t proceed</span></div>
<div class="line"><span class="lineno">16280</span><span class="comment">             * further. */</span></div>
<div class="line"><span class="lineno">16281</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">16282</span>                                <span class="stringliteral">&quot;%s: unknown user [%s]&quot;</span>,</div>
<div class="line"><span class="lineno">16283</span>                                __func__,</div>
<div class="line"><span class="lineno">16284</span>                                run_as_user);</div>
<div class="line"><span class="lineno">16285</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((run_as_user == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (curr_uid == to_pw-&gt;pw_uid)) {</div>
<div class="line"><span class="lineno">16286</span>            <span class="comment">/* There was either no request to change user, or we&#39;re already</span></div>
<div class="line"><span class="lineno">16287</span><span class="comment">             * running as run_as_user. Nothing else to do.</span></div>
<div class="line"><span class="lineno">16288</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno">16289</span>            success = 1;</div>
<div class="line"><span class="lineno">16290</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16291</span>            <span class="comment">/* Valid change request.  */</span></div>
<div class="line"><span class="lineno">16292</span>            <span class="keywordflow">if</span> (setgid(to_pw-&gt;pw_gid) == -1) {</div>
<div class="line"><span class="lineno">16293</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">16294</span>                                    <span class="stringliteral">&quot;%s: setgid(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno">16295</span>                                    __func__,</div>
<div class="line"><span class="lineno">16296</span>                                    run_as_user,</div>
<div class="line"><span class="lineno">16297</span>                                    strerror(errno));</div>
<div class="line"><span class="lineno">16298</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (setgroups(0, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) == -1) {</div>
<div class="line"><span class="lineno">16299</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">16300</span>                                    <span class="stringliteral">&quot;%s: setgroups(): %s&quot;</span>,</div>
<div class="line"><span class="lineno">16301</span>                                    __func__,</div>
<div class="line"><span class="lineno">16302</span>                                    strerror(errno));</div>
<div class="line"><span class="lineno">16303</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (setuid(to_pw-&gt;pw_uid) == -1) {</div>
<div class="line"><span class="lineno">16304</span>                <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">16305</span>                                    <span class="stringliteral">&quot;%s: setuid(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno">16306</span>                                    __func__,</div>
<div class="line"><span class="lineno">16307</span>                                    run_as_user,</div>
<div class="line"><span class="lineno">16308</span>                                    strerror(errno));</div>
<div class="line"><span class="lineno">16309</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16310</span>                success = 1;</div>
<div class="line"><span class="lineno">16311</span>            }</div>
<div class="line"><span class="lineno">16312</span>        }</div>
<div class="line"><span class="lineno">16313</span>    }</div>
<div class="line"><span class="lineno">16314</span> </div>
<div class="line"><span class="lineno">16315</span>    <span class="keywordflow">return</span> success;</div>
<div class="line"><span class="lineno">16316</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l01922">RUN_AS_USER</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="ac5091c315948383d6f29f90450b9e706" name="ac5091c315948383d6f29f90450b9e706"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5091c315948383d6f29f90450b9e706">&#9670;&#160;</a></span>should_decode_query_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int should_decode_query_string </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04034">4034</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4035</span>{</div>
<div class="line"><span class="lineno"> 4036</span>    <span class="keywordflow">if</span> (!conn || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno"> 4037</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 4038</span>    }</div>
<div class="line"><span class="lineno"> 4039</span> </div>
<div class="line"><span class="lineno"> 4040</span>    <span class="keywordflow">return</span> (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baf20363ab43e572880dc69d8fe634c114">DECODE_QUERY_STRING</a>], <span class="stringliteral">&quot;yes&quot;</span>)</div>
<div class="line"><span class="lineno"> 4041</span>            == 0);</div>
<div class="line"><span class="lineno"> 4042</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l01944">DECODE_QUERY_STRING</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, and <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="acb05505a49b6d5ba3733d63c7aabe8d4" name="acb05505a49b6d5ba3733d63c7aabe8d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb05505a49b6d5ba3733d63c7aabe8d4">&#9670;&#160;</a></span>should_decode_url()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int should_decode_url </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04023">4023</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4024</span>{</div>
<div class="line"><span class="lineno"> 4025</span>    <span class="keywordflow">if</span> (!conn || !conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno"> 4026</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 4027</span>    }</div>
<div class="line"><span class="lineno"> 4028</span> </div>
<div class="line"><span class="lineno"> 4029</span>    <span class="keywordflow">return</span> (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baa7da030a4d709729f351258b77fad121">DECODE_URL</a>], <span class="stringliteral">&quot;yes&quot;</span>) == 0);</div>
<div class="line"><span class="lineno"> 4030</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l01943">DECODE_URL</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, and <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a2f83db0ca198c57993fb3e3cd5e97500" name="a2f83db0ca198c57993fb3e3cd5e97500"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f83db0ca198c57993fb3e3cd5e97500">&#9670;&#160;</a></span>should_keep_alive()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int should_keep_alive </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03984">3984</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3985</span>{</div>
<div class="line"><span class="lineno"> 3986</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *http_version;</div>
<div class="line"><span class="lineno"> 3987</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *header;</div>
<div class="line"><span class="lineno"> 3988</span> </div>
<div class="line"><span class="lineno"> 3989</span>    <span class="comment">/* First satisfy needs of the server */</span></div>
<div class="line"><span class="lineno"> 3990</span>    <span class="keywordflow">if</span> ((conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7e246b550026933deb3bbcda123df48f">must_close</a>) {</div>
<div class="line"><span class="lineno"> 3991</span>        <span class="comment">/* Close, if civetweb framework needs to close */</span></div>
<div class="line"><span class="lineno"> 3992</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 3993</span>    }</div>
<div class="line"><span class="lineno"> 3994</span> </div>
<div class="line"><span class="lineno"> 3995</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba39a8b8c4df6154e815a5a49da528ce5c">ENABLE_KEEP_ALIVE</a>], <span class="stringliteral">&quot;yes&quot;</span>) != 0) {</div>
<div class="line"><span class="lineno"> 3996</span>        <span class="comment">/* Close, if keep alive is not enabled */</span></div>
<div class="line"><span class="lineno"> 3997</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 3998</span>    }</div>
<div class="line"><span class="lineno"> 3999</span> </div>
<div class="line"><span class="lineno"> 4000</span>    <span class="comment">/* Check explicit wish of the client */</span></div>
<div class="line"><span class="lineno"> 4001</span>    header = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Connection&quot;</span>);</div>
<div class="line"><span class="lineno"> 4002</span>    <span class="keywordflow">if</span> (header) {</div>
<div class="line"><span class="lineno"> 4003</span>        <span class="comment">/* If there is a connection header from the client, obey */</span></div>
<div class="line"><span class="lineno"> 4004</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a1bc2585ae2ab78f91db4346a574d58ac">header_has_option</a>(header, <span class="stringliteral">&quot;keep-alive&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 4005</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 4006</span>        }</div>
<div class="line"><span class="lineno"> 4007</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 4008</span>    }</div>
<div class="line"><span class="lineno"> 4009</span> </div>
<div class="line"><span class="lineno"> 4010</span>    <span class="comment">/* Use default of the standard */</span></div>
<div class="line"><span class="lineno"> 4011</span>    http_version = <a class="code hl_function" href="#ad28d6d09815fda1ee2b5621d1a49c513">get_http_version</a>(conn);</div>
<div class="line"><span class="lineno"> 4012</span>    <span class="keywordflow">if</span> (http_version &amp;&amp; (0 == strcmp(http_version, <span class="stringliteral">&quot;1.1&quot;</span>))) {</div>
<div class="line"><span class="lineno"> 4013</span>        <span class="comment">/* HTTP 1.1 default is keep alive */</span></div>
<div class="line"><span class="lineno"> 4014</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 4015</span>    }</div>
<div class="line"><span class="lineno"> 4016</span> </div>
<div class="line"><span class="lineno"> 4017</span>    <span class="comment">/* HTTP 1.0 (and earlier) default is to close the connection */</span></div>
<div class="line"><span class="lineno"> 4018</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 4019</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a1bc2585ae2ab78f91db4346a574d58ac"><div class="ttname"><a href="#a1bc2585ae2ab78f91db4346a574d58ac">header_has_option</a></div><div class="ttdeci">static int header_has_option(const char *header, const char *option)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03956">civetweb.c:3956</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ad28d6d09815fda1ee2b5621d1a49c513"><div class="ttname"><a href="#ad28d6d09815fda1ee2b5621d1a49c513">get_http_version</a></div><div class="ttdeci">static const char * get_http_version(const struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03876">civetweb.c:3876</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01936">ENABLE_KEEP_ALIVE</a>, <a class="el" href="civetweb_8c_source.html#l03876">get_http_version()</a>, <a class="el" href="civetweb_8c_source.html#l03956">header_has_option()</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l02535">mg_connection::must_close</a>, and <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, and <a class="el" href="civetweb_8c_source.html#l04046">suggest_connection_header()</a>.</p>

</div>
</div>
<a id="a0b698a923a0e6fd848e0585cf2983d12" name="a0b698a923a0e6fd848e0585cf2983d12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b698a923a0e6fd848e0585cf2983d12">&#9670;&#160;</a></span>should_switch_to_protocol()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int should_switch_to_protocol </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l13912">13912</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">13913</span>{</div>
<div class="line"><span class="lineno">13914</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *connection_headers[8];</div>
<div class="line"><span class="lineno">13915</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *upgrade_to;</div>
<div class="line"><span class="lineno">13916</span>    <span class="keywordtype">int</span> connection_header_count, i, should_upgrade;</div>
<div class="line"><span class="lineno">13917</span> </div>
<div class="line"><span class="lineno">13918</span>    <span class="comment">/* A websocket protocol has the following HTTP headers:</span></div>
<div class="line"><span class="lineno">13919</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno">13920</span><span class="comment">     * Connection: Upgrade</span></div>
<div class="line"><span class="lineno">13921</span><span class="comment">     * Upgrade: Websocket</span></div>
<div class="line"><span class="lineno">13922</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno">13923</span><span class="comment">     * It seems some clients use multiple headers:</span></div>
<div class="line"><span class="lineno">13924</span><span class="comment">     * see https://github.com/civetweb/civetweb/issues/1083</span></div>
<div class="line"><span class="lineno">13925</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">13926</span>    connection_header_count = <a class="code hl_function" href="#a40a6af4c96865e0df1aa11c588731a27">get_req_headers</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>,</div>
<div class="line"><span class="lineno">13927</span>                                              <span class="stringliteral">&quot;Connection&quot;</span>,</div>
<div class="line"><span class="lineno">13928</span>                                              connection_headers,</div>
<div class="line"><span class="lineno">13929</span>                                              8);</div>
<div class="line"><span class="lineno">13930</span>    should_upgrade = 0;</div>
<div class="line"><span class="lineno">13931</span>    <span class="keywordflow">for</span> (i = 0; i &lt; connection_header_count; i++) {</div>
<div class="line"><span class="lineno">13932</span>        <span class="keywordflow">if</span> (0 != <a class="code hl_function" href="#a804c91443edc3fa4d74cfe88b1dd3ac8">mg_strcasestr</a>(connection_headers[i], <span class="stringliteral">&quot;upgrade&quot;</span>)) {</div>
<div class="line"><span class="lineno">13933</span>            should_upgrade = 1;</div>
<div class="line"><span class="lineno">13934</span>        }</div>
<div class="line"><span class="lineno">13935</span>    }</div>
<div class="line"><span class="lineno">13936</span>    <span class="keywordflow">if</span> (!should_upgrade) {</div>
<div class="line"><span class="lineno">13937</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a>;</div>
<div class="line"><span class="lineno">13938</span>    }</div>
<div class="line"><span class="lineno">13939</span> </div>
<div class="line"><span class="lineno">13940</span>    upgrade_to = <a class="code hl_function" href="#a2565ee5d9358284c1312e957271fccfb">mg_get_header</a>(conn, <span class="stringliteral">&quot;Upgrade&quot;</span>);</div>
<div class="line"><span class="lineno">13941</span>    <span class="keywordflow">if</span> (upgrade_to == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">13942</span>        <span class="comment">/* &quot;Connection: Upgrade&quot; without &quot;Upgrade&quot; Header --&gt; Error */</span></div>
<div class="line"><span class="lineno">13943</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">13944</span>    }</div>
<div class="line"><span class="lineno">13945</span> </div>
<div class="line"><span class="lineno">13946</span>    <span class="comment">/* Upgrade to ... */</span></div>
<div class="line"><span class="lineno">13947</span>    <span class="keywordflow">if</span> (0 != <a class="code hl_function" href="#a804c91443edc3fa4d74cfe88b1dd3ac8">mg_strcasestr</a>(upgrade_to, <span class="stringliteral">&quot;websocket&quot;</span>)) {</div>
<div class="line"><span class="lineno">13948</span>        <span class="comment">/* The headers &quot;Host&quot;, &quot;Sec-WebSocket-Key&quot;, &quot;Sec-WebSocket-Protocol&quot; and</span></div>
<div class="line"><span class="lineno">13949</span><span class="comment">         * &quot;Sec-WebSocket-Version&quot; are also required.</span></div>
<div class="line"><span class="lineno">13950</span><span class="comment">         * Don&#39;t check them here, since even an unsupported websocket protocol</span></div>
<div class="line"><span class="lineno">13951</span><span class="comment">         * request still IS a websocket request (in contrast to a standard HTTP</span></div>
<div class="line"><span class="lineno">13952</span><span class="comment">         * request). It will fail later in handle_websocket_request.</span></div>
<div class="line"><span class="lineno">13953</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">13954</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06cad967a684f3a85c93219d0956538c4436">PROTOCOL_TYPE_WEBSOCKET</a>; <span class="comment">/* Websocket */</span></div>
<div class="line"><span class="lineno">13955</span>    }</div>
<div class="line"><span class="lineno">13956</span>    <span class="keywordflow">if</span> (0 != <a class="code hl_function" href="#a804c91443edc3fa4d74cfe88b1dd3ac8">mg_strcasestr</a>(upgrade_to, <span class="stringliteral">&quot;h2&quot;</span>)) {</div>
<div class="line"><span class="lineno">13957</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca3c3663fdf461dc9873cadc4a36b3a139">PROTOCOL_TYPE_HTTP2</a>; <span class="comment">/* Websocket */</span></div>
<div class="line"><span class="lineno">13958</span>    }</div>
<div class="line"><span class="lineno">13959</span> </div>
<div class="line"><span class="lineno">13960</span>    <span class="comment">/* Upgrade to another protocol */</span></div>
<div class="line"><span class="lineno">13961</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">13962</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a40a6af4c96865e0df1aa11c588731a27"><div class="ttname"><a href="#a40a6af4c96865e0df1aa11c588731a27">get_req_headers</a></div><div class="ttdeci">static int get_req_headers(const struct mg_request_info *ri, const char *name, const char **output, int output_max_size)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l03836">civetweb.c:3836</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03836">get_req_headers()</a>, <a class="el" href="civetweb_8c_source.html#l03855">mg_get_header()</a>, <a class="el" href="civetweb_8c_source.html#l03075">mg_strcasestr()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02466">PROTOCOL_TYPE_HTTP1</a>, <a class="el" href="civetweb_8c_source.html#l02468">PROTOCOL_TYPE_HTTP2</a>, <a class="el" href="civetweb_8c_source.html#l02467">PROTOCOL_TYPE_WEBSOCKET</a>, and <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>.</p>

</div>
</div>
<a id="a63cf9c2202b6b0433d5e13800dff00f7" name="a63cf9c2202b6b0433d5e13800dff00f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63cf9c2202b6b0433d5e13800dff00f7">&#9670;&#160;</a></span>skip_quoted()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * skip_quoted </td>
          <td>(</td>
          <td class="paramtype">char **</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>delimiters</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>whitespace</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char</td>          <td class="paramname"><span class="paramname"><em>quotechar</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03757">3757</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3761</span>{</div>
<div class="line"><span class="lineno"> 3762</span>    <span class="keywordtype">char</span> *p, *begin_word, *end_word, *end_whitespace;</div>
<div class="line"><span class="lineno"> 3763</span> </div>
<div class="line"><span class="lineno"> 3764</span>    begin_word = *buf;</div>
<div class="line"><span class="lineno"> 3765</span>    end_word = begin_word + strcspn(begin_word, delimiters);</div>
<div class="line"><span class="lineno"> 3766</span> </div>
<div class="line"><span class="lineno"> 3767</span>    <span class="comment">/* Check for quotechar */</span></div>
<div class="line"><span class="lineno"> 3768</span>    <span class="keywordflow">if</span> (end_word &gt; begin_word) {</div>
<div class="line"><span class="lineno"> 3769</span>        p = end_word - 1;</div>
<div class="line"><span class="lineno"> 3770</span>        <span class="keywordflow">while</span> (*p == quotechar) {</div>
<div class="line"><span class="lineno"> 3771</span>            <span class="comment">/* While the delimiter is quoted, look for the next delimiter. */</span></div>
<div class="line"><span class="lineno"> 3772</span>            <span class="comment">/* This happens, e.g., in calls from parse_auth_header,</span></div>
<div class="line"><span class="lineno"> 3773</span><span class="comment">             * if the user name contains a &quot; character. */</span></div>
<div class="line"><span class="lineno"> 3774</span> </div>
<div class="line"><span class="lineno"> 3775</span>            <span class="comment">/* If there is anything beyond end_word, copy it. */</span></div>
<div class="line"><span class="lineno"> 3776</span>            <span class="keywordflow">if</span> (*end_word != <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno"> 3777</span>                <span class="keywordtype">size_t</span> end_off = strcspn(end_word + 1, delimiters);</div>
<div class="line"><span class="lineno"> 3778</span>                memmove(p, end_word, end_off + 1);</div>
<div class="line"><span class="lineno"> 3779</span>                p += end_off; <span class="comment">/* p must correspond to end_word - 1 */</span></div>
<div class="line"><span class="lineno"> 3780</span>                end_word += end_off + 1;</div>
<div class="line"><span class="lineno"> 3781</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3782</span>                *p = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 3783</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 3784</span>            }</div>
<div class="line"><span class="lineno"> 3785</span>        }</div>
<div class="line"><span class="lineno"> 3786</span>        <span class="keywordflow">for</span> (p++; p &lt; end_word; p++) {</div>
<div class="line"><span class="lineno"> 3787</span>            *p = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 3788</span>        }</div>
<div class="line"><span class="lineno"> 3789</span>    }</div>
<div class="line"><span class="lineno"> 3790</span> </div>
<div class="line"><span class="lineno"> 3791</span>    <span class="keywordflow">if</span> (*end_word == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno"> 3792</span>        *buf = end_word;</div>
<div class="line"><span class="lineno"> 3793</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3794</span> </div>
<div class="line"><span class="lineno"> 3795</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno"> 3796</span>        <span class="comment">/* Disable spurious conversion warning for GCC */</span></div>
<div class="line"><span class="lineno"> 3797</span><span class="preprocessor">#pragma GCC diagnostic push</span></div>
<div class="line"><span class="lineno"> 3798</span><span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wsign-conversion&quot;</span></div>
<div class="line"><span class="lineno"> 3799</span><span class="preprocessor">#endif </span><span class="comment">/* defined(GCC_DIAGNOSTIC) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 3800</span> </div>
<div class="line"><span class="lineno"> 3801</span>        end_whitespace = end_word + strspn(&amp;end_word[1], whitespace) + 1;</div>
<div class="line"><span class="lineno"> 3802</span> </div>
<div class="line"><span class="lineno"> 3803</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno"> 3804</span><span class="preprocessor">#pragma GCC diagnostic pop</span></div>
<div class="line"><span class="lineno"> 3805</span><span class="preprocessor">#endif </span><span class="comment">/* defined(GCC_DIAGNOSTIC) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno"> 3806</span> </div>
<div class="line"><span class="lineno"> 3807</span>        <span class="keywordflow">for</span> (p = end_word; p &lt; end_whitespace; p++) {</div>
<div class="line"><span class="lineno"> 3808</span>            *p = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 3809</span>        }</div>
<div class="line"><span class="lineno"> 3810</span> </div>
<div class="line"><span class="lineno"> 3811</span>        *buf = end_whitespace;</div>
<div class="line"><span class="lineno"> 3812</span>    }</div>
<div class="line"><span class="lineno"> 3813</span> </div>
<div class="line"><span class="lineno"> 3814</span>    <span class="keywordflow">return</span> begin_word;</div>
<div class="line"><span class="lineno"> 3815</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08555">parse_auth_header()</a>.</p>

</div>
</div>
<a id="a6caa9c39e63744c4ee69d2dea110ea66" name="a6caa9c39e63744c4ee69d2dea110ea66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6caa9c39e63744c4ee69d2dea110ea66">&#9670;&#160;</a></span>skip_to_end_of_word_and_terminate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int skip_to_end_of_word_and_terminate </td>
          <td>(</td>
          <td class="paramtype">char **</td>          <td class="paramname"><span class="paramname"><em>ppw</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>eol</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10680">10680</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10681</span>{</div>
<div class="line"><span class="lineno">10682</span>    <span class="comment">/* Forward until a space is found - use isgraph here */</span></div>
<div class="line"><span class="lineno">10683</span>    <span class="comment">/* See http://www.cplusplus.com/reference/cctype/ */</span></div>
<div class="line"><span class="lineno">10684</span>    <span class="keywordflow">while</span> (isgraph((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)**ppw)) {</div>
<div class="line"><span class="lineno">10685</span>        (*ppw)++;</div>
<div class="line"><span class="lineno">10686</span>    }</div>
<div class="line"><span class="lineno">10687</span> </div>
<div class="line"><span class="lineno">10688</span>    <span class="comment">/* Check end of word */</span></div>
<div class="line"><span class="lineno">10689</span>    <span class="keywordflow">if</span> (eol) {</div>
<div class="line"><span class="lineno">10690</span>        <span class="comment">/* must be a end of line */</span></div>
<div class="line"><span class="lineno">10691</span>        <span class="keywordflow">if</span> ((**ppw != <span class="charliteral">&#39;\r&#39;</span>) &amp;&amp; (**ppw != <span class="charliteral">&#39;\n&#39;</span>)) {</div>
<div class="line"><span class="lineno">10692</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10693</span>        }</div>
<div class="line"><span class="lineno">10694</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">10695</span>        <span class="comment">/* must be a end of a word, but not a line */</span></div>
<div class="line"><span class="lineno">10696</span>        <span class="keywordflow">if</span> (**ppw != <span class="charliteral">&#39; &#39;</span>) {</div>
<div class="line"><span class="lineno">10697</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10698</span>        }</div>
<div class="line"><span class="lineno">10699</span>    }</div>
<div class="line"><span class="lineno">10700</span> </div>
<div class="line"><span class="lineno">10701</span>    <span class="comment">/* Terminate and forward to the next word */</span></div>
<div class="line"><span class="lineno">10702</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">10703</span>        **ppw = 0;</div>
<div class="line"><span class="lineno">10704</span>        (*ppw)++;</div>
<div class="line"><span class="lineno">10705</span>    } <span class="keywordflow">while</span> (isspace((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)**ppw));</div>
<div class="line"><span class="lineno">10706</span> </div>
<div class="line"><span class="lineno">10707</span>    <span class="comment">/* Check after term */</span></div>
<div class="line"><span class="lineno">10708</span>    <span class="keywordflow">if</span> (!eol) {</div>
<div class="line"><span class="lineno">10709</span>        <span class="comment">/* if it&#39;s not the end of line, there must be a next word */</span></div>
<div class="line"><span class="lineno">10710</span>        <span class="keywordflow">if</span> (!isgraph((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)**ppw)) {</div>
<div class="line"><span class="lineno">10711</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">10712</span>        }</div>
<div class="line"><span class="lineno">10713</span>    }</div>
<div class="line"><span class="lineno">10714</span> </div>
<div class="line"><span class="lineno">10715</span>    <span class="comment">/* ok */</span></div>
<div class="line"><span class="lineno">10716</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">10717</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10915">parse_http_request()</a>, and <a class="el" href="civetweb_8c_source.html#l11001">parse_http_response()</a>.</p>

</div>
</div>
<a id="a043f416da5d5ec0b9a0f39e7a34250c2" name="a043f416da5d5ec0b9a0f39e7a34250c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a043f416da5d5ec0b9a0f39e7a34250c2">&#9670;&#160;</a></span>sockaddr_to_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void sockaddr_to_string </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const union <a class="el" href="unionusa.html">usa</a> *</td>          <td class="paramname"><span class="paramname"><em>usa</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l03292">3292</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3293</span>{</div>
<div class="line"><span class="lineno"> 3294</span>    buf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 3295</span> </div>
<div class="line"><span class="lineno"> 3296</span>    <span class="keywordflow">if</span> (!<a class="code hl_union" href="unionusa.html">usa</a>) {</div>
<div class="line"><span class="lineno"> 3297</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 3298</span>    }</div>
<div class="line"><span class="lineno"> 3299</span> </div>
<div class="line"><span class="lineno"> 3300</span>    <span class="keywordflow">if</span> (<a class="code hl_union" href="unionusa.html">usa</a>-&gt;<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family == AF_INET) {</div>
<div class="line"><span class="lineno"> 3301</span>        getnameinfo(&amp;<a class="code hl_union" href="unionusa.html">usa</a>-&gt;<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>,</div>
<div class="line"><span class="lineno"> 3302</span>                    <span class="keyword">sizeof</span>(<a class="code hl_union" href="unionusa.html">usa</a>-&gt;<a class="code hl_variable" href="unionusa.html#a680bc429e90923ecbbf9c7d38ba4bf26">sin</a>),</div>
<div class="line"><span class="lineno"> 3303</span>                    buf,</div>
<div class="line"><span class="lineno"> 3304</span>                    (<span class="keywordtype">unsigned</span>)len,</div>
<div class="line"><span class="lineno"> 3305</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 3306</span>                    0,</div>
<div class="line"><span class="lineno"> 3307</span>                    NI_NUMERICHOST);</div>
<div class="line"><span class="lineno"> 3308</span>    }</div>
<div class="line"><span class="lineno"> 3309</span><span class="preprocessor">#if defined(USE_IPV6)</span></div>
<div class="line"><span class="lineno"> 3310</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_union" href="unionusa.html">usa</a>-&gt;<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family == AF_INET6) {</div>
<div class="line"><span class="lineno"> 3311</span>        getnameinfo(&amp;<a class="code hl_union" href="unionusa.html">usa</a>-&gt;<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>,</div>
<div class="line"><span class="lineno"> 3312</span>                    <span class="keyword">sizeof</span>(<a class="code hl_union" href="unionusa.html">usa</a>-&gt;sin6),</div>
<div class="line"><span class="lineno"> 3313</span>                    buf,</div>
<div class="line"><span class="lineno"> 3314</span>                    (<span class="keywordtype">unsigned</span>)len,</div>
<div class="line"><span class="lineno"> 3315</span>                    <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><span class="lineno"> 3316</span>                    0,</div>
<div class="line"><span class="lineno"> 3317</span>                    NI_NUMERICHOST);</div>
<div class="line"><span class="lineno"> 3318</span>    }</div>
<div class="line"><span class="lineno"> 3319</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3320</span><span class="preprocessor">#if defined(USE_X_DOM_SOCKET)</span></div>
<div class="line"><span class="lineno"> 3321</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_union" href="unionusa.html">usa</a>-&gt;<a class="code hl_variable" href="unionusa.html#a3bc7f8512f2fb0e7ef3e8c69dd794df1">sa</a>.sa_family == AF_UNIX) {</div>
<div class="line"><span class="lineno"> 3322</span>        <span class="comment">/* TODO: Define a remote address for unix domain sockets.</span></div>
<div class="line"><span class="lineno"> 3323</span><span class="comment">        * This code will always return &quot;localhost&quot;, identical to http+tcp:</span></div>
<div class="line"><span class="lineno"> 3324</span><span class="comment">        getnameinfo(&amp;usa-&gt;sa,</span></div>
<div class="line"><span class="lineno"> 3325</span><span class="comment">        sizeof(usa-&gt;sun),</span></div>
<div class="line"><span class="lineno"> 3326</span><span class="comment">        buf,</span></div>
<div class="line"><span class="lineno"> 3327</span><span class="comment">        (unsigned)len,</span></div>
<div class="line"><span class="lineno"> 3328</span><span class="comment">        NULL,</span></div>
<div class="line"><span class="lineno"> 3329</span><span class="comment">        0,</span></div>
<div class="line"><span class="lineno"> 3330</span><span class="comment">        NI_NUMERICHOST);</span></div>
<div class="line"><span class="lineno"> 3331</span><span class="comment">        */</span></div>
<div class="line"><span class="lineno"> 3332</span>        <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(buf, UNIX_DOMAIN_SOCKET_SERVER_NAME, len);</div>
<div class="line"><span class="lineno"> 3333</span>    }</div>
<div class="line"><span class="lineno"> 3334</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 3335</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02532">mg_connection::buf</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l01833">usa::sa</a>, and <a class="el" href="civetweb_8c_source.html#l01834">usa::sin</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19957">accept_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l16063">log_access()</a>, <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>, <a class="el" href="civetweb_8c_source.html#l03382">mg_cry_internal_impl()</a>, <a class="el" href="civetweb_8c_source.html#l11354">prepare_cgi_environment()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a10cbc96e5456363bea1672bfc3f526dd" name="a10cbc96e5456363bea1672bfc3f526dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10cbc96e5456363bea1672bfc3f526dd">&#9670;&#160;</a></span>spawn_process()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static pid_t spawn_process </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>prog</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>envblk</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>envp</em>[], </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fdin</em>[2], </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fdout</em>[2], </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fderr</em>[2], </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>dir</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>cgi_config_idx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l05768">5768</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 5777</span>{</div>
<div class="line"><span class="lineno"> 5778</span>    pid_t pid;</div>
<div class="line"><span class="lineno"> 5779</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *interp;</div>
<div class="line"><span class="lineno"> 5780</span> </div>
<div class="line"><span class="lineno"> 5781</span>    (void)envblk;</div>
<div class="line"><span class="lineno"> 5782</span> </div>
<div class="line"><span class="lineno"> 5783</span>    <span class="keywordflow">if</span> ((pid = fork()) == -1) {</div>
<div class="line"><span class="lineno"> 5784</span>        <span class="comment">/* Parent */</span></div>
<div class="line"><span class="lineno"> 5785</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;%s: fork(): %s&quot;</span>, __func__, strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 5786</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pid != 0) {</div>
<div class="line"><span class="lineno"> 5787</span>        <span class="comment">/* Make sure children close parent-side descriptors.</span></div>
<div class="line"><span class="lineno"> 5788</span><span class="comment">         * The caller will close the child-side immediately. */</span></div>
<div class="line"><span class="lineno"> 5789</span>        <a class="code hl_function" href="#aea8c64184a00214c2f457d5e30f89478">set_close_on_exec</a>(fdin[1], conn, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);  <span class="comment">/* stdin write */</span></div>
<div class="line"><span class="lineno"> 5790</span>        <a class="code hl_function" href="#aea8c64184a00214c2f457d5e30f89478">set_close_on_exec</a>(fdout[0], conn, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">/* stdout read */</span></div>
<div class="line"><span class="lineno"> 5791</span>        <a class="code hl_function" href="#aea8c64184a00214c2f457d5e30f89478">set_close_on_exec</a>(fderr[0], conn, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">/* stderr read */</span></div>
<div class="line"><span class="lineno"> 5792</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 5793</span>        <span class="comment">/* Child */</span></div>
<div class="line"><span class="lineno"> 5794</span>        <span class="keywordflow">if</span> (chdir(dir) != 0) {</div>
<div class="line"><span class="lineno"> 5795</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(</div>
<div class="line"><span class="lineno"> 5796</span>                conn, <span class="stringliteral">&quot;%s: chdir(%s): %s&quot;</span>, __func__, dir, strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 5797</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dup2(fdin[0], 0) == -1) {</div>
<div class="line"><span class="lineno"> 5798</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno"> 5799</span>                            <span class="stringliteral">&quot;%s: dup2(%d, 0): %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 5800</span>                            __func__,</div>
<div class="line"><span class="lineno"> 5801</span>                            fdin[0],</div>
<div class="line"><span class="lineno"> 5802</span>                            strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 5803</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dup2(fdout[1], 1) == -1) {</div>
<div class="line"><span class="lineno"> 5804</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno"> 5805</span>                            <span class="stringliteral">&quot;%s: dup2(%d, 1): %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 5806</span>                            __func__,</div>
<div class="line"><span class="lineno"> 5807</span>                            fdout[1],</div>
<div class="line"><span class="lineno"> 5808</span>                            strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 5809</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dup2(fderr[1], 2) == -1) {</div>
<div class="line"><span class="lineno"> 5810</span>            <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno"> 5811</span>                            <span class="stringliteral">&quot;%s: dup2(%d, 2): %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 5812</span>                            __func__,</div>
<div class="line"><span class="lineno"> 5813</span>                            fderr[1],</div>
<div class="line"><span class="lineno"> 5814</span>                            strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 5815</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 5816</span>            <span class="keyword">struct </span>sigaction sa;</div>
<div class="line"><span class="lineno"> 5817</span> </div>
<div class="line"><span class="lineno"> 5818</span>            <span class="comment">/* Keep stderr and stdout in two different pipes.</span></div>
<div class="line"><span class="lineno"> 5819</span><span class="comment">             * Stdout will be sent back to the client,</span></div>
<div class="line"><span class="lineno"> 5820</span><span class="comment">             * stderr should go into a server error log. */</span></div>
<div class="line"><span class="lineno"> 5821</span>            (void)close(fdin[0]);</div>
<div class="line"><span class="lineno"> 5822</span>            (void)close(fdout[1]);</div>
<div class="line"><span class="lineno"> 5823</span>            (void)close(fderr[1]);</div>
<div class="line"><span class="lineno"> 5824</span> </div>
<div class="line"><span class="lineno"> 5825</span>            <span class="comment">/* Close write end fdin and read end fdout and fderr */</span></div>
<div class="line"><span class="lineno"> 5826</span>            (void)close(fdin[1]);</div>
<div class="line"><span class="lineno"> 5827</span>            (void)close(fdout[0]);</div>
<div class="line"><span class="lineno"> 5828</span>            (void)close(fderr[0]);</div>
<div class="line"><span class="lineno"> 5829</span> </div>
<div class="line"><span class="lineno"> 5830</span>            <span class="comment">/* After exec, all signal handlers are restored to their default</span></div>
<div class="line"><span class="lineno"> 5831</span><span class="comment">             * values, with one exception of SIGCHLD. According to</span></div>
<div class="line"><span class="lineno"> 5832</span><span class="comment">             * POSIX.1-2001 and Linux&#39;s implementation, SIGCHLD&#39;s handler</span></div>
<div class="line"><span class="lineno"> 5833</span><span class="comment">             * will leave unchanged after exec if it was set to be ignored.</span></div>
<div class="line"><span class="lineno"> 5834</span><span class="comment">             * Restore it to default action. */</span></div>
<div class="line"><span class="lineno"> 5835</span>            memset(&amp;sa, 0, <span class="keyword">sizeof</span>(sa));</div>
<div class="line"><span class="lineno"> 5836</span>            sa.sa_handler = SIG_DFL;</div>
<div class="line"><span class="lineno"> 5837</span>            sigaction(SIGCHLD, &amp;sa, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno"> 5838</span> </div>
<div class="line"><span class="lineno"> 5839</span>            interp = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55baed83717b03766bd7c931b4e2fbae3384">CGI_INTERPRETER</a> + cgi_config_idx];</div>
<div class="line"><span class="lineno"> 5840</span>            <span class="keywordflow">if</span> (interp == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 5841</span>                <span class="comment">/* no interpreter configured, call the program directly */</span></div>
<div class="line"><span class="lineno"> 5842</span>                (void)execle(prog, prog, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, envp);</div>
<div class="line"><span class="lineno"> 5843</span>                <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno"> 5844</span>                                <span class="stringliteral">&quot;%s: execle(%s): %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 5845</span>                                __func__,</div>
<div class="line"><span class="lineno"> 5846</span>                                prog,</div>
<div class="line"><span class="lineno"> 5847</span>                                strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 5848</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 5849</span>                <span class="comment">/* call the configured interpreter */</span></div>
<div class="line"><span class="lineno"> 5850</span>                <span class="keyword">const</span> <span class="keywordtype">char</span> *interp_args =</div>
<div class="line"><span class="lineno"> 5851</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a></div>
<div class="line"><span class="lineno"> 5852</span>                        -&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba3bdbf4db41e054e3f6c087b4299c66c0">CGI_INTERPRETER_ARGS</a> + cgi_config_idx];</div>
<div class="line"><span class="lineno"> 5853</span> </div>
<div class="line"><span class="lineno"> 5854</span>                <span class="keywordflow">if</span> ((interp_args != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (interp_args[0] != 0)) {</div>
<div class="line"><span class="lineno"> 5855</span>                    (void)execle(interp, interp, interp_args, prog, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, envp);</div>
<div class="line"><span class="lineno"> 5856</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 5857</span>                    (void)execle(interp, interp, prog, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, envp);</div>
<div class="line"><span class="lineno"> 5858</span>                }</div>
<div class="line"><span class="lineno"> 5859</span>                <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn,</div>
<div class="line"><span class="lineno"> 5860</span>                                <span class="stringliteral">&quot;%s: execle(%s %s): %s&quot;</span>,</div>
<div class="line"><span class="lineno"> 5861</span>                                __func__,</div>
<div class="line"><span class="lineno"> 5862</span>                                interp,</div>
<div class="line"><span class="lineno"> 5863</span>                                prog,</div>
<div class="line"><span class="lineno"> 5864</span>                                strerror(<a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>));</div>
<div class="line"><span class="lineno"> 5865</span>            }</div>
<div class="line"><span class="lineno"> 5866</span>        }</div>
<div class="line"><span class="lineno"> 5867</span>        exit(EXIT_FAILURE);</div>
<div class="line"><span class="lineno"> 5868</span>    }</div>
<div class="line"><span class="lineno"> 5869</span> </div>
<div class="line"><span class="lineno"> 5870</span>    <span class="keywordflow">return</span> pid;</div>
<div class="line"><span class="lineno"> 5871</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01961">CGI_INTERPRETER</a>, <a class="el" href="civetweb_8c_source.html#l01962">CGI_INTERPRETER_ARGS</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l05677">set_close_on_exec()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>.</p>

</div>
</div>
<a id="a3754dec11e945be1db7482091a4cd5ae" name="a3754dec11e945be1db7482091a4cd5ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3754dec11e945be1db7482091a4cd5ae">&#9670;&#160;</a></span>ssl_error()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * ssl_error </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16585">16585</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16586</span>{</div>
<div class="line"><span class="lineno">16587</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> err;</div>
<div class="line"><span class="lineno">16588</span>    err = ERR_get_error();</div>
<div class="line"><span class="lineno">16589</span>    <span class="keywordflow">return</span> ((err == 0) ? <span class="stringliteral">&quot;&quot;</span> : ERR_error_string(err, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div>
<div class="line"><span class="lineno">16590</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17239">init_ssl_ctx_impl()</a>, <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l16377">refresh_trust()</a>, <a class="el" href="civetweb_8c_source.html#l16940">ssl_use_pem_file()</a>, and <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>.</p>

</div>
</div>
<a id="a1cf68e4c3856f86612a53eac755c36fe" name="a1cf68e4c3856f86612a53eac755c36fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cf68e4c3856f86612a53eac755c36fe">&#9670;&#160;</a></span>ssl_get_client_cert_info()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_get_client_cert_info </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__client__cert.html">mg_client_cert</a> *</td>          <td class="paramname"><span class="paramname"><em>client_cert</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16620">16620</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16622</span>{</div>
<div class="line"><span class="lineno">16623</span>    X509 *cert = SSL_get_peer_certificate(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>);</div>
<div class="line"><span class="lineno">16624</span>    <span class="keywordflow">if</span> (cert) {</div>
<div class="line"><span class="lineno">16625</span>        <span class="keywordtype">char</span> str_buf[1024];</div>
<div class="line"><span class="lineno">16626</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[256];</div>
<div class="line"><span class="lineno">16627</span>        <span class="keywordtype">char</span> *str_serial = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16628</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ulen;</div>
<div class="line"><span class="lineno">16629</span>        <span class="keywordtype">int</span> ilen;</div>
<div class="line"><span class="lineno">16630</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tmp_buf;</div>
<div class="line"><span class="lineno">16631</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tmp_p;</div>
<div class="line"><span class="lineno">16632</span> </div>
<div class="line"><span class="lineno">16633</span>        <span class="comment">/* Handle to algorithm used for fingerprint */</span></div>
<div class="line"><span class="lineno">16634</span>        <span class="keyword">const</span> EVP_MD *digest = EVP_get_digestbyname(<span class="stringliteral">&quot;sha1&quot;</span>);</div>
<div class="line"><span class="lineno">16635</span> </div>
<div class="line"><span class="lineno">16636</span>        <span class="comment">/* Get Subject and issuer */</span></div>
<div class="line"><span class="lineno">16637</span>        X509_NAME *subj = X509_get_subject_name(cert);</div>
<div class="line"><span class="lineno">16638</span>        X509_NAME *iss = X509_get_issuer_name(cert);</div>
<div class="line"><span class="lineno">16639</span> </div>
<div class="line"><span class="lineno">16640</span>        <span class="comment">/* Get serial number */</span></div>
<div class="line"><span class="lineno">16641</span>        ASN1_INTEGER *serial = X509_get_serialNumber(cert);</div>
<div class="line"><span class="lineno">16642</span> </div>
<div class="line"><span class="lineno">16643</span>        <span class="comment">/* Translate serial number to a hex string */</span></div>
<div class="line"><span class="lineno">16644</span>        BIGNUM *serial_bn = ASN1_INTEGER_to_BN(serial, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">16645</span>        <span class="keywordflow">if</span> (serial_bn) {</div>
<div class="line"><span class="lineno">16646</span>            str_serial = BN_bn2hex(serial_bn);</div>
<div class="line"><span class="lineno">16647</span>            BN_free(serial_bn);</div>
<div class="line"><span class="lineno">16648</span>        }</div>
<div class="line"><span class="lineno">16649</span>        client_cert-&gt;<a class="code hl_variable" href="structmg__client__cert.html#acabeb71119a4874f9d1fc6a26673a22c">serial</a> =</div>
<div class="line"><span class="lineno">16650</span>            str_serial ? <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(str_serial, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>) : <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16651</span> </div>
<div class="line"><span class="lineno">16652</span>        <span class="comment">/* Translate subject and issuer to a string */</span></div>
<div class="line"><span class="lineno">16653</span>        (void)X509_NAME_oneline(subj, str_buf, (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(str_buf));</div>
<div class="line"><span class="lineno">16654</span>        client_cert-&gt;<a class="code hl_variable" href="structmg__client__cert.html#abc030d72bbaeb9bf9091d674dd71ac9b">subject</a> = <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(str_buf, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">16655</span>        (void)X509_NAME_oneline(iss, str_buf, (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(str_buf));</div>
<div class="line"><span class="lineno">16656</span>        client_cert-&gt;<a class="code hl_variable" href="structmg__client__cert.html#a7f1312eb1eeb454b2c0c05a0ac9d781e">issuer</a> = <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(str_buf, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">16657</span> </div>
<div class="line"><span class="lineno">16658</span>        <span class="comment">/* Calculate SHA1 fingerprint and store as a hex string */</span></div>
<div class="line"><span class="lineno">16659</span>        ulen = 0;</div>
<div class="line"><span class="lineno">16660</span> </div>
<div class="line"><span class="lineno">16661</span>        <span class="comment">/* ASN1_digest is deprecated. Do the calculation manually,</span></div>
<div class="line"><span class="lineno">16662</span><span class="comment">         * using EVP_Digest. */</span></div>
<div class="line"><span class="lineno">16663</span>        ilen = i2d_X509(cert, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">16664</span>        tmp_buf = (ilen &gt; 0)</div>
<div class="line"><span class="lineno">16665</span>                      ? (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>((<span class="keywordtype">unsigned</span>)ilen + 1,</div>
<div class="line"><span class="lineno">16666</span>                                                       conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>)</div>
<div class="line"><span class="lineno">16667</span>                      : <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16668</span>        <span class="keywordflow">if</span> (tmp_buf) {</div>
<div class="line"><span class="lineno">16669</span>            tmp_p = tmp_buf;</div>
<div class="line"><span class="lineno">16670</span>            (void)i2d_X509(cert, &amp;tmp_p);</div>
<div class="line"><span class="lineno">16671</span>            <span class="keywordflow">if</span> (!EVP_Digest(</div>
<div class="line"><span class="lineno">16672</span>                    tmp_buf, (<span class="keywordtype">unsigned</span>)ilen, buf, &amp;ulen, digest, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">16673</span>                ulen = 0;</div>
<div class="line"><span class="lineno">16674</span>            }</div>
<div class="line"><span class="lineno">16675</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(tmp_buf);</div>
<div class="line"><span class="lineno">16676</span>        }</div>
<div class="line"><span class="lineno">16677</span> </div>
<div class="line"><span class="lineno">16678</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a79a94c1836be39ee8d6bcbee626493c5">hexdump2string</a>(buf, (<span class="keywordtype">int</span>)ulen, str_buf, (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(str_buf))) {</div>
<div class="line"><span class="lineno">16679</span>            *str_buf = 0;</div>
<div class="line"><span class="lineno">16680</span>        }</div>
<div class="line"><span class="lineno">16681</span>        client_cert-&gt;<a class="code hl_variable" href="structmg__client__cert.html#a8987a45a7b73927af1899beee708a5fa">finger</a> = <a class="code hl_function" href="#aa30b97fc6c76000802e15129b3a1f48a">mg_strdup_ctx</a>(str_buf, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">16682</span> </div>
<div class="line"><span class="lineno">16683</span>        client_cert-&gt;<a class="code hl_variable" href="structmg__client__cert.html#aaae16e70d34544939ec2ae64b86d8427">peer_cert</a> = (<span class="keywordtype">void</span> *)cert;</div>
<div class="line"><span class="lineno">16684</span> </div>
<div class="line"><span class="lineno">16685</span>        <span class="comment">/* Strings returned from bn_bn2hex must be freed using OPENSSL_free,</span></div>
<div class="line"><span class="lineno">16686</span><span class="comment">         * see https://linux.die.net/man/3/bn_bn2hex */</span></div>
<div class="line"><span class="lineno">16687</span>        OPENSSL_free(str_serial);</div>
<div class="line"><span class="lineno">16688</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">16689</span>    }</div>
<div class="line"><span class="lineno">16690</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16691</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a79a94c1836be39ee8d6bcbee626493c5"><div class="ttname"><a href="#a79a94c1836be39ee8d6bcbee626493c5">hexdump2string</a></div><div class="ttdeci">static int hexdump2string(void *mem, int memlen, char *buf, int buflen)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16594">civetweb.c:16594</a></div></div>
<div class="ttc" id="astructmg__client__cert_html_a7f1312eb1eeb454b2c0c05a0ac9d781e"><div class="ttname"><a href="structmg__client__cert.html#a7f1312eb1eeb454b2c0c05a0ac9d781e">mg_client_cert::issuer</a></div><div class="ttdeci">const char * issuer</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00209">civetweb.h:209</a></div></div>
<div class="ttc" id="astructmg__client__cert_html_a8987a45a7b73927af1899beee708a5fa"><div class="ttname"><a href="structmg__client__cert.html#a8987a45a7b73927af1899beee708a5fa">mg_client_cert::finger</a></div><div class="ttdeci">const char * finger</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00211">civetweb.h:211</a></div></div>
<div class="ttc" id="astructmg__client__cert_html_aaae16e70d34544939ec2ae64b86d8427"><div class="ttname"><a href="structmg__client__cert.html#aaae16e70d34544939ec2ae64b86d8427">mg_client_cert::peer_cert</a></div><div class="ttdeci">void * peer_cert</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00207">civetweb.h:207</a></div></div>
<div class="ttc" id="astructmg__client__cert_html_abc030d72bbaeb9bf9091d674dd71ac9b"><div class="ttname"><a href="structmg__client__cert.html#abc030d72bbaeb9bf9091d674dd71ac9b">mg_client_cert::subject</a></div><div class="ttdeci">const char * subject</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00208">civetweb.h:208</a></div></div>
<div class="ttc" id="astructmg__client__cert_html_acabeb71119a4874f9d1fc6a26673a22c"><div class="ttname"><a href="structmg__client__cert.html#acabeb71119a4874f9d1fc6a26673a22c">mg_client_cert::serial</a></div><div class="ttdeci">const char * serial</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00210">civetweb.h:210</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8h_source.html#l00211">mg_client_cert::finger</a>, <a class="el" href="civetweb_8c_source.html#l16594">hexdump2string()</a>, <a class="el" href="civetweb_8h_source.html#l00209">mg_client_cert::issuer</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01497">mg_malloc_ctx</a>, <a class="el" href="civetweb_8c_source.html#l03062">mg_strdup_ctx()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00207">mg_client_cert::peer_cert</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8h_source.html#l00210">mg_client_cert::serial</a>, <a class="el" href="civetweb_8c_source.html#l02506">mg_connection::ssl</a>, and <a class="el" href="civetweb_8h_source.html#l00208">mg_client_cert::subject</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a542ed428fa93885ec11ff0e8aabf1768" name="a542ed428fa93885ec11ff0e8aabf1768"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a542ed428fa93885ec11ff0e8aabf1768">&#9670;&#160;</a></span>ssl_get_protocol()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static long ssl_get_protocol </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>version_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17017">17017</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17018</span>{</div>
<div class="line"><span class="lineno">17019</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ret = (<span class="keywordtype">unsigned</span> long)SSL_OP_ALL;</div>
<div class="line"><span class="lineno">17020</span>    <span class="keywordflow">if</span> (version_id &gt; 0)</div>
<div class="line"><span class="lineno">17021</span>        ret |= SSL_OP_NO_SSLv2;</div>
<div class="line"><span class="lineno">17022</span>    <span class="keywordflow">if</span> (version_id &gt; 1)</div>
<div class="line"><span class="lineno">17023</span>        ret |= SSL_OP_NO_SSLv3;</div>
<div class="line"><span class="lineno">17024</span>    <span class="keywordflow">if</span> (version_id &gt; 2)</div>
<div class="line"><span class="lineno">17025</span>        ret |= SSL_OP_NO_TLSv1;</div>
<div class="line"><span class="lineno">17026</span>    <span class="keywordflow">if</span> (version_id &gt; 3)</div>
<div class="line"><span class="lineno">17027</span>        ret |= SSL_OP_NO_TLSv1_1;</div>
<div class="line"><span class="lineno">17028</span>    <span class="keywordflow">if</span> (version_id &gt; 4)</div>
<div class="line"><span class="lineno">17029</span>        ret |= SSL_OP_NO_TLSv1_2;</div>
<div class="line"><span class="lineno">17030</span><span class="preprocessor">#if defined(SSL_OP_NO_TLSv1_3)</span></div>
<div class="line"><span class="lineno">17031</span>    <span class="keywordflow">if</span> (version_id &gt; 5)</div>
<div class="line"><span class="lineno">17032</span>        ret |= SSL_OP_NO_TLSv1_3;</div>
<div class="line"><span class="lineno">17033</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">17034</span>    <span class="keywordflow">return</span> (<span class="keywordtype">long</span>)ret;</div>
<div class="line"><span class="lineno">17035</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17239">init_ssl_ctx_impl()</a>.</p>

</div>
</div>
<a id="a84798111da4d1707bb9ab1ba73b1e072" name="a84798111da4d1707bb9ab1ba73b1e072"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84798111da4d1707bb9ab1ba73b1e072">&#9670;&#160;</a></span>ssl_info_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ssl_info_callback </td>
          <td>(</td>
          <td class="paramtype">const SSL *</td>          <td class="paramname"><span class="paramname"><em>ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>what</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>ret</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17050">17050</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17051</span>{</div>
<div class="line"><span class="lineno">17052</span>    (void)ret;</div>
<div class="line"><span class="lineno">17053</span> </div>
<div class="line"><span class="lineno">17054</span>    <span class="keywordflow">if</span> (what &amp; SSL_CB_HANDSHAKE_START) {</div>
<div class="line"><span class="lineno">17055</span>        SSL_get_app_data(ssl);</div>
<div class="line"><span class="lineno">17056</span>    }</div>
<div class="line"><span class="lineno">17057</span>    <span class="keywordflow">if</span> (what &amp; SSL_CB_HANDSHAKE_DONE) {</div>
<div class="line"><span class="lineno">17058</span>        <span class="comment">/* TODO: check for openSSL 1.1 */</span></div>
<div class="line"><span class="lineno">17059</span>        <span class="comment">//#define SSL3_FLAGS_NO_RENEGOTIATE_CIPHERS 0x0001</span></div>
<div class="line"><span class="lineno">17060</span>        <span class="comment">// ssl-&gt;s3-&gt;flags |= SSL3_FLAGS_NO_RENEGOTIATE_CIPHERS;</span></div>
<div class="line"><span class="lineno">17061</span>    }</div>
<div class="line"><span class="lineno">17062</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17239">init_ssl_ctx_impl()</a>.</p>

</div>
</div>
<a id="a1483ed6424f4762bba17221c2be5e7b1" name="a1483ed6424f4762bba17221c2be5e7b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1483ed6424f4762bba17221c2be5e7b1">&#9670;&#160;</a></span>ssl_locking_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ssl_locking_callback </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>mode</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>mutex_num</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>file</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>line</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16697">16697</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16698</span>{</div>
<div class="line"><span class="lineno">16699</span>    (void)line;</div>
<div class="line"><span class="lineno">16700</span>    (void)file;</div>
<div class="line"><span class="lineno">16701</span> </div>
<div class="line"><span class="lineno">16702</span>    <span class="keywordflow">if</span> (mode &amp; 1) {</div>
<div class="line"><span class="lineno">16703</span>        <span class="comment">/* 1 is CRYPTO_LOCK */</span></div>
<div class="line"><span class="lineno">16704</span>        (void)pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a>[mutex_num]);</div>
<div class="line"><span class="lineno">16705</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16706</span>        (void)pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a>[mutex_num]);</div>
<div class="line"><span class="lineno">16707</span>    }</div>
<div class="line"><span class="lineno">16708</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l16451">ssl_mutexes</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>.</p>

</div>
</div>
<a id="a634412d7196b236a4abb02caa0ea2d5a" name="a634412d7196b236a4abb02caa0ea2d5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a634412d7196b236a4abb02caa0ea2d5a">&#9670;&#160;</a></span>ssl_servername_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_servername_callback </td>
          <td>(</td>
          <td class="paramtype">SSL *</td>          <td class="paramname"><span class="paramname"><em>ssl</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>ad</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>arg</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17066">17066</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17067</span>{</div>
<div class="line"><span class="lineno">17068</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno">17069</span><span class="preprocessor">#pragma GCC diagnostic push</span></div>
<div class="line"><span class="lineno">17070</span><span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wcast-align&quot;</span></div>
<div class="line"><span class="lineno">17071</span><span class="preprocessor">#endif </span><span class="comment">/* defined(GCC_DIAGNOSTIC) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">17072</span> </div>
<div class="line"><span class="lineno">17073</span>    <span class="comment">/* We used an aligned pointer in SSL_set_app_data */</span></div>
<div class="line"><span class="lineno">17074</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *conn = (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)SSL_get_app_data(<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>);</div>
<div class="line"><span class="lineno">17075</span> </div>
<div class="line"><span class="lineno">17076</span><span class="preprocessor">#if defined(GCC_DIAGNOSTIC)</span></div>
<div class="line"><span class="lineno">17077</span><span class="preprocessor">#pragma GCC diagnostic pop</span></div>
<div class="line"><span class="lineno">17078</span><span class="preprocessor">#endif </span><span class="comment">/* defined(GCC_DIAGNOSTIC) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">17079</span> </div>
<div class="line"><span class="lineno">17080</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *servername = SSL_get_servername(<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>, TLSEXT_NAMETYPE_host_name);</div>
<div class="line"><span class="lineno">17081</span> </div>
<div class="line"><span class="lineno">17082</span>    (void)ad;</div>
<div class="line"><span class="lineno">17083</span>    (void)<a class="code hl_variable" href="curl_8h.html#a7d68018e95e3d4e6b703538ac1c8c411">arg</a>;</div>
<div class="line"><span class="lineno">17084</span> </div>
<div class="line"><span class="lineno">17085</span>    <span class="keywordflow">if</span> ((conn == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">17086</span>        <a class="code hl_define" href="#a5687826f07a383abedc6329b6a07f40b">DEBUG_ASSERT</a>(0);</div>
<div class="line"><span class="lineno">17087</span>        <span class="keywordflow">return</span> SSL_TLSEXT_ERR_NOACK;</div>
<div class="line"><span class="lineno">17088</span>    }</div>
<div class="line"><span class="lineno">17089</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> = &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>);</div>
<div class="line"><span class="lineno">17090</span> </div>
<div class="line"><span class="lineno">17091</span>    <span class="comment">/* Old clients (Win XP) will not support SNI. Then, there</span></div>
<div class="line"><span class="lineno">17092</span><span class="comment">     * is no server name available in the request - we can</span></div>
<div class="line"><span class="lineno">17093</span><span class="comment">     * only work with the default certificate.</span></div>
<div class="line"><span class="lineno">17094</span><span class="comment">     * Multiple HTTPS hosts on one IP+port are only possible</span></div>
<div class="line"><span class="lineno">17095</span><span class="comment">     * with a certificate containing all alternative names.</span></div>
<div class="line"><span class="lineno">17096</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">17097</span>    <span class="keywordflow">if</span> ((servername == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (*servername == 0)) {</div>
<div class="line"><span class="lineno">17098</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;SSL connection not supporting SNI&quot;</span>);</div>
<div class="line"><span class="lineno">17099</span>        <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">17100</span>        SSL_set_SSL_CTX(<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>);</div>
<div class="line"><span class="lineno">17101</span>        <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">17102</span>        <span class="keywordflow">return</span> SSL_TLSEXT_ERR_NOACK;</div>
<div class="line"><span class="lineno">17103</span>    }</div>
<div class="line"><span class="lineno">17104</span> </div>
<div class="line"><span class="lineno">17105</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;TLS connection to host %s&quot;</span>, servername);</div>
<div class="line"><span class="lineno">17106</span> </div>
<div class="line"><span class="lineno">17107</span>    <span class="keywordflow">while</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>) {</div>
<div class="line"><span class="lineno">17108</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(servername,</div>
<div class="line"><span class="lineno">17109</span>                           conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>])) {</div>
<div class="line"><span class="lineno">17110</span>            <span class="comment">/* Found matching domain */</span></div>
<div class="line"><span class="lineno">17111</span>            <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;TLS domain %s found&quot;</span>,</div>
<div class="line"><span class="lineno">17112</span>                        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>]);</div>
<div class="line"><span class="lineno">17113</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">17114</span>        }</div>
<div class="line"><span class="lineno">17115</span>        <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">17116</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ab15afe08729b3371cf26138782732845">next</a>;</div>
<div class="line"><span class="lineno">17117</span>        <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">17118</span>    }</div>
<div class="line"><span class="lineno">17119</span> </div>
<div class="line"><span class="lineno">17120</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">17121</span>        <span class="comment">/* Default domain */</span></div>
<div class="line"><span class="lineno">17122</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;TLS default domain %s used&quot;</span>,</div>
<div class="line"><span class="lineno">17123</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>.<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>]);</div>
<div class="line"><span class="lineno">17124</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> = &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>);</div>
<div class="line"><span class="lineno">17125</span>    }</div>
<div class="line"><span class="lineno">17126</span>    <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">17127</span>    SSL_set_SSL_CTX(<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>);</div>
<div class="line"><span class="lineno">17128</span>    <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">17129</span>    <span class="keywordflow">return</span> SSL_TLSEXT_ERR_OK;</div>
<div class="line"><span class="lineno">17130</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="curl_8h_source.html#l02622">arg</a>, <a class="el" href="civetweb_8c_source.html#l01999">AUTHENTICATION_DOMAIN</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l00260">DEBUG_ASSERT</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="civetweb_8c_source.html#l02285">mg_domain_context::next</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02506">mg_connection::ssl</a>, and <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17239">init_ssl_ctx_impl()</a>.</p>

</div>
</div>
<a id="a36ba2de78f1cacfe1b95106a834b970d" name="a36ba2de78f1cacfe1b95106a834b970d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36ba2de78f1cacfe1b95106a834b970d">&#9670;&#160;</a></span>ssl_use_pem_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_use_pem_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__context.html">mg_context</a> *</td>          <td class="paramname"><span class="paramname"><em>phys_ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__domain__context.html">mg_domain_context</a> *</td>          <td class="paramname"><span class="paramname"><em>dom_ctx</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>pem</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>chain</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16940">16940</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16944</span>{</div>
<div class="line"><span class="lineno">16945</span>    <span class="keywordflow">if</span> (SSL_CTX_use_certificate_file(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>, pem, 1) == 0) {</div>
<div class="line"><span class="lineno">16946</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">16947</span>                            <span class="stringliteral">&quot;%s: cannot open certificate file %s: %s&quot;</span>,</div>
<div class="line"><span class="lineno">16948</span>                            __func__,</div>
<div class="line"><span class="lineno">16949</span>                            pem,</div>
<div class="line"><span class="lineno">16950</span>                            <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">16951</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16952</span>    }</div>
<div class="line"><span class="lineno">16953</span> </div>
<div class="line"><span class="lineno">16954</span>    <span class="comment">/* could use SSL_CTX_set_default_passwd_cb_userdata */</span></div>
<div class="line"><span class="lineno">16955</span>    <span class="keywordflow">if</span> (SSL_CTX_use_PrivateKey_file(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>, pem, 1) == 0) {</div>
<div class="line"><span class="lineno">16956</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">16957</span>                            <span class="stringliteral">&quot;%s: cannot open private key file %s: %s&quot;</span>,</div>
<div class="line"><span class="lineno">16958</span>                            __func__,</div>
<div class="line"><span class="lineno">16959</span>                            pem,</div>
<div class="line"><span class="lineno">16960</span>                            <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">16961</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16962</span>    }</div>
<div class="line"><span class="lineno">16963</span> </div>
<div class="line"><span class="lineno">16964</span>    <span class="keywordflow">if</span> (SSL_CTX_check_private_key(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>) == 0) {</div>
<div class="line"><span class="lineno">16965</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">16966</span>                            <span class="stringliteral">&quot;%s: certificate and private key do not match: %s&quot;</span>,</div>
<div class="line"><span class="lineno">16967</span>                            __func__,</div>
<div class="line"><span class="lineno">16968</span>                            pem);</div>
<div class="line"><span class="lineno">16969</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16970</span>    }</div>
<div class="line"><span class="lineno">16971</span> </div>
<div class="line"><span class="lineno">16972</span>    <span class="comment">/* In contrast to OpenSSL, wolfSSL does not support certificate</span></div>
<div class="line"><span class="lineno">16973</span><span class="comment">     * chain files that contain private keys and certificates in</span></div>
<div class="line"><span class="lineno">16974</span><span class="comment">     * SSL_CTX_use_certificate_chain_file.</span></div>
<div class="line"><span class="lineno">16975</span><span class="comment">     * The CivetWeb-Server used pem-Files that contained both information.</span></div>
<div class="line"><span class="lineno">16976</span><span class="comment">     * In order to make wolfSSL work, it is split in two files.</span></div>
<div class="line"><span class="lineno">16977</span><span class="comment">     * One file that contains key and certificate used by the server and</span></div>
<div class="line"><span class="lineno">16978</span><span class="comment">     * an optional chain file for the ssl stack.</span></div>
<div class="line"><span class="lineno">16979</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">16980</span>    <span class="keywordflow">if</span> (chain) {</div>
<div class="line"><span class="lineno">16981</span>        <span class="keywordflow">if</span> (SSL_CTX_use_certificate_chain_file(dom_ctx-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>, chain) == 0) {</div>
<div class="line"><span class="lineno">16982</span>            <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(phys_ctx,</div>
<div class="line"><span class="lineno">16983</span>                                <span class="stringliteral">&quot;%s: cannot use certificate chain file %s: %s&quot;</span>,</div>
<div class="line"><span class="lineno">16984</span>                                __func__,</div>
<div class="line"><span class="lineno">16985</span>                                chain,</div>
<div class="line"><span class="lineno">16986</span>                                <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">16987</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16988</span>        }</div>
<div class="line"><span class="lineno">16989</span>    }</div>
<div class="line"><span class="lineno">16990</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">16991</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>, and <a class="el" href="civetweb_8c_source.html#l16585">ssl_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l17239">init_ssl_ctx_impl()</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, and <a class="el" href="civetweb_8c_source.html#l16377">refresh_trust()</a>.</p>

</div>
</div>
<a id="ac5ddf37dfcbb5287702f50354be5ab54" name="ac5ddf37dfcbb5287702f50354be5ab54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5ddf37dfcbb5287702f50354be5ab54">&#9670;&#160;</a></span>sslize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int sslize </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(SSL *)</td>          <td class="paramname"><span class="paramname"><em>func</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmg__client__options.html">mg_client_options</a> *</td>          <td class="paramname"><span class="paramname"><em>client_options</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16455">16455</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16458</span>{</div>
<div class="line"><span class="lineno">16459</span>    <span class="keywordtype">int</span> ret, err;</div>
<div class="line"><span class="lineno">16460</span>    <span class="keywordtype">int</span> short_trust;</div>
<div class="line"><span class="lineno">16461</span>    <span class="keywordtype">unsigned</span> timeout = 1024;</div>
<div class="line"><span class="lineno">16462</span>    <span class="keywordtype">unsigned</span> i;</div>
<div class="line"><span class="lineno">16463</span> </div>
<div class="line"><span class="lineno">16464</span>    <span class="keywordflow">if</span> (!conn) {</div>
<div class="line"><span class="lineno">16465</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16466</span>    }</div>
<div class="line"><span class="lineno">16467</span> </div>
<div class="line"><span class="lineno">16468</span>    short_trust =</div>
<div class="line"><span class="lineno">16469</span>        (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba03662ada095078ef2ebd1d7c624e0b5f">SSL_SHORT_TRUST</a>] != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">16470</span>        &amp;&amp; (<a class="code hl_function" href="#a5d0ea93d3ec8a90e631f7e7f53d28628">mg_strcasecmp</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba03662ada095078ef2ebd1d7c624e0b5f">SSL_SHORT_TRUST</a>], <span class="stringliteral">&quot;yes&quot;</span>) == 0);</div>
<div class="line"><span class="lineno">16471</span> </div>
<div class="line"><span class="lineno">16472</span>    <span class="keywordflow">if</span> (short_trust) {</div>
<div class="line"><span class="lineno">16473</span>        <span class="keywordtype">int</span> trust_ret = <a class="code hl_function" href="#ac8716e2019c3e5ecd4abc75a272d7aa7">refresh_trust</a>(conn);</div>
<div class="line"><span class="lineno">16474</span>        <span class="keywordflow">if</span> (!trust_ret) {</div>
<div class="line"><span class="lineno">16475</span>            <span class="keywordflow">return</span> trust_ret;</div>
<div class="line"><span class="lineno">16476</span>        }</div>
<div class="line"><span class="lineno">16477</span>    }</div>
<div class="line"><span class="lineno">16478</span> </div>
<div class="line"><span class="lineno">16479</span>    <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">16480</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> = SSL_new(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>);</div>
<div class="line"><span class="lineno">16481</span>    <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">16482</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">16483</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;sslize error: %s&quot;</span>, <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">16484</span>        OPENSSL_REMOVE_THREAD_STATE();</div>
<div class="line"><span class="lineno">16485</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16486</span>    }</div>
<div class="line"><span class="lineno">16487</span>    SSL_set_app_data(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>, (<span class="keywordtype">char</span> *)conn);</div>
<div class="line"><span class="lineno">16488</span> </div>
<div class="line"><span class="lineno">16489</span>    ret = SSL_set_fd(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>);</div>
<div class="line"><span class="lineno">16490</span>    <span class="keywordflow">if</span> (ret != 1) {</div>
<div class="line"><span class="lineno">16491</span>        <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;sslize error: %s&quot;</span>, <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">16492</span>        SSL_free(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>);</div>
<div class="line"><span class="lineno">16493</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16494</span>        OPENSSL_REMOVE_THREAD_STATE();</div>
<div class="line"><span class="lineno">16495</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16496</span>    }</div>
<div class="line"><span class="lineno">16497</span> </div>
<div class="line"><span class="lineno">16498</span>    <span class="keywordflow">if</span> (client_options) {</div>
<div class="line"><span class="lineno">16499</span>        <span class="keywordflow">if</span> (client_options-&gt;<a class="code hl_variable" href="structmg__client__options.html#a60814eb7b7f46cb2a619d59d719a01b1">host_name</a>) {</div>
<div class="line"><span class="lineno">16500</span>            SSL_set_tlsext_host_name(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>, client_options-&gt;<a class="code hl_variable" href="structmg__client__options.html#a60814eb7b7f46cb2a619d59d719a01b1">host_name</a>);</div>
<div class="line"><span class="lineno">16501</span>        }</div>
<div class="line"><span class="lineno">16502</span>    }</div>
<div class="line"><span class="lineno">16503</span> </div>
<div class="line"><span class="lineno">16504</span>    <span class="comment">/* Reuse the request timeout for the SSL_Accept/SSL_connect timeout  */</span></div>
<div class="line"><span class="lineno">16505</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>]) {</div>
<div class="line"><span class="lineno">16506</span>        <span class="comment">/* NOTE: The loop below acts as a back-off, so we can end</span></div>
<div class="line"><span class="lineno">16507</span><span class="comment">         * up sleeping for more (or less) than the REQUEST_TIMEOUT. */</span></div>
<div class="line"><span class="lineno">16508</span>        <span class="keywordtype">int</span> to = atoi(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bad32fad260d93bc91f1e0bae8c17874bd">REQUEST_TIMEOUT</a>]);</div>
<div class="line"><span class="lineno">16509</span>        <span class="keywordflow">if</span> (to &gt;= 0) {</div>
<div class="line"><span class="lineno">16510</span>            timeout = (unsigned)to;</div>
<div class="line"><span class="lineno">16511</span>        }</div>
<div class="line"><span class="lineno">16512</span>    }</div>
<div class="line"><span class="lineno">16513</span> </div>
<div class="line"><span class="lineno">16514</span>    <span class="comment">/* SSL functions may fail and require to be called again:</span></div>
<div class="line"><span class="lineno">16515</span><span class="comment">     * see https://www.openssl.org/docs/manmaster/ssl/SSL_get_error.html</span></div>
<div class="line"><span class="lineno">16516</span><span class="comment">     * Here &quot;func&quot; could be SSL_connect or SSL_accept. */</span></div>
<div class="line"><span class="lineno">16517</span>    <span class="keywordflow">for</span> (i = 0; i &lt;= timeout; i += 50) {</div>
<div class="line"><span class="lineno">16518</span>        ERR_clear_error();</div>
<div class="line"><span class="lineno">16519</span>        <span class="comment">/* conn-&gt;dom_ctx may be changed here (see ssl_servername_callback) */</span></div>
<div class="line"><span class="lineno">16520</span>        ret = func(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>);</div>
<div class="line"><span class="lineno">16521</span>        <span class="keywordflow">if</span> (ret != 1) {</div>
<div class="line"><span class="lineno">16522</span>            err = SSL_get_error(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>, ret);</div>
<div class="line"><span class="lineno">16523</span>            <span class="keywordflow">if</span> ((err == SSL_ERROR_WANT_CONNECT)</div>
<div class="line"><span class="lineno">16524</span>                || (err == SSL_ERROR_WANT_ACCEPT)</div>
<div class="line"><span class="lineno">16525</span>                || (err == SSL_ERROR_WANT_READ) || (err == SSL_ERROR_WANT_WRITE)</div>
<div class="line"><span class="lineno">16526</span>                || (err == SSL_ERROR_WANT_X509_LOOKUP)) {</div>
<div class="line"><span class="lineno">16527</span>                <span class="keywordflow">if</span> (!<a class="code hl_define" href="#a42c400d6feb7aa0de4280b0cf1c63fcc">STOP_FLAG_IS_ZERO</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>)) {</div>
<div class="line"><span class="lineno">16528</span>                    <span class="comment">/* Don&#39;t wait if the server is going to be stopped. */</span></div>
<div class="line"><span class="lineno">16529</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">16530</span>                }</div>
<div class="line"><span class="lineno">16531</span>                <span class="keywordflow">if</span> (err == SSL_ERROR_WANT_X509_LOOKUP) {</div>
<div class="line"><span class="lineno">16532</span>                    <span class="comment">/* Simply retry the function call. */</span></div>
<div class="line"><span class="lineno">16533</span>                    <a class="code hl_define" href="#af1af7c8ef16047616b5bee88aeee10d6">mg_sleep</a>(50);</div>
<div class="line"><span class="lineno">16534</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16535</span>                    <span class="comment">/* Need to retry the function call &quot;later&quot;.</span></div>
<div class="line"><span class="lineno">16536</span><span class="comment">                     * See https://linux.die.net/man/3/ssl_get_error</span></div>
<div class="line"><span class="lineno">16537</span><span class="comment">                     * This is typical for non-blocking sockets. */</span></div>
<div class="line"><span class="lineno">16538</span>                    <span class="keyword">struct </span><a class="code hl_define" href="#ac220e3a97f765b599bc532d6c3f4a755">mg_pollfd</a> pfd;</div>
<div class="line"><span class="lineno">16539</span>                    <span class="keywordtype">int</span> pollres;</div>
<div class="line"><span class="lineno">16540</span>                    pfd.fd = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>;</div>
<div class="line"><span class="lineno">16541</span>                    pfd.events = ((err == SSL_ERROR_WANT_CONNECT)</div>
<div class="line"><span class="lineno">16542</span>                                  || (err == SSL_ERROR_WANT_WRITE))</div>
<div class="line"><span class="lineno">16543</span>                                     ? POLLOUT</div>
<div class="line"><span class="lineno">16544</span>                                     : POLLIN;</div>
<div class="line"><span class="lineno">16545</span>                    pollres =</div>
<div class="line"><span class="lineno">16546</span>                        <a class="code hl_function" href="#a3b9904a2b6ed6d472f5ee35c7c588863">mg_poll</a>(&amp;pfd, 1, 50, &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#a733a0204e86fcf92d016bd08c9db2691">stop_flag</a>));</div>
<div class="line"><span class="lineno">16547</span>                    <span class="keywordflow">if</span> (pollres &lt; 0) {</div>
<div class="line"><span class="lineno">16548</span>                        <span class="comment">/* Break if error occurred (-1)</span></div>
<div class="line"><span class="lineno">16549</span><span class="comment">                         * or server shutdown (-2) */</span></div>
<div class="line"><span class="lineno">16550</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">16551</span>                    }</div>
<div class="line"><span class="lineno">16552</span>                }</div>
<div class="line"><span class="lineno">16553</span> </div>
<div class="line"><span class="lineno">16554</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (err == SSL_ERROR_SYSCALL) {</div>
<div class="line"><span class="lineno">16555</span>                <span class="comment">/* This is an IO error. Look at errno. */</span></div>
<div class="line"><span class="lineno">16556</span>                <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;SSL syscall error %i&quot;</span>, <a class="code hl_define" href="#a3a830e27de72e8bab8bc80eafebd657e">ERRNO</a>);</div>
<div class="line"><span class="lineno">16557</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">16558</span> </div>
<div class="line"><span class="lineno">16559</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16560</span>                <span class="comment">/* This is an SSL specific error, e.g. SSL_ERROR_SSL */</span></div>
<div class="line"><span class="lineno">16561</span>                <a class="code hl_define" href="#a9c82560e32fee25bd5f05767a625fa77">mg_cry_internal</a>(conn, <span class="stringliteral">&quot;sslize error: %s&quot;</span>, <a class="code hl_function" href="#a3754dec11e945be1db7482091a4cd5ae">ssl_error</a>());</div>
<div class="line"><span class="lineno">16562</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">16563</span>            }</div>
<div class="line"><span class="lineno">16564</span> </div>
<div class="line"><span class="lineno">16565</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">16566</span>            <span class="comment">/* success */</span></div>
<div class="line"><span class="lineno">16567</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">16568</span>        }</div>
<div class="line"><span class="lineno">16569</span>    }</div>
<div class="line"><span class="lineno">16570</span>    ERR_clear_error();</div>
<div class="line"><span class="lineno">16571</span> </div>
<div class="line"><span class="lineno">16572</span>    <span class="keywordflow">if</span> (ret != 1) {</div>
<div class="line"><span class="lineno">16573</span>        SSL_free(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>);</div>
<div class="line"><span class="lineno">16574</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">16575</span>        OPENSSL_REMOVE_THREAD_STATE();</div>
<div class="line"><span class="lineno">16576</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">16577</span>    }</div>
<div class="line"><span class="lineno">16578</span> </div>
<div class="line"><span class="lineno">16579</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">16580</span>}</div>
<div class="ttc" id="acivetweb_8c_html_ac8716e2019c3e5ecd4abc75a272d7aa7"><div class="ttname"><a href="#ac8716e2019c3e5ecd4abc75a272d7aa7">refresh_trust</a></div><div class="ttdeci">static int refresh_trust(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16377">civetweb.c:16377</a></div></div>
<div class="ttc" id="astructmg__client__options_html_a60814eb7b7f46cb2a619d59d719a01b1"><div class="ttname"><a href="structmg__client__options.html#a60814eb7b7f46cb2a619d59d719a01b1">mg_client_options::host_name</a></div><div class="ttdeci">const char * host_name</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l01488">civetweb.h:1488</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l00924">ERRNO</a>, <a class="el" href="civetweb_8h_source.html#l01488">mg_client_options::host_name</a>, <a class="el" href="civetweb_8c_source.html#l02583">mg_cry_internal</a>, <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="civetweb_8c_source.html#l05938">mg_poll()</a>, <a class="el" href="civetweb_8c_source.html#l00948">mg_pollfd</a>, <a class="el" href="civetweb_8c_source.html#l00920">mg_sleep</a>, <a class="el" href="civetweb_8c_source.html#l03034">mg_strcasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l16377">refresh_trust()</a>, <a class="el" href="civetweb_8c_source.html#l01937">REQUEST_TIMEOUT</a>, <a class="el" href="civetweb_8c_source.html#l02506">mg_connection::ssl</a>, <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>, <a class="el" href="civetweb_8c_source.html#l16585">ssl_error()</a>, <a class="el" href="civetweb_8c_source.html#l02020">SSL_SHORT_TRUST</a>, and <a class="el" href="civetweb_8c_source.html#l02322">STOP_FLAG_IS_ZERO</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="af6b0cd03c015fee859606ab8b09db8e0" name="af6b0cd03c015fee859606ab8b09db8e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6b0cd03c015fee859606ab8b09db8e0">&#9670;&#160;</a></span>substitute_index_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int substitute_index_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>path_len</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmg__file__stat.html">mg_file_stat</a> *</td>          <td class="paramname"><span class="paramname"><em>filestat</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07574">7574</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7578</span>{</div>
<div class="line"><span class="lineno"> 7579</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *list = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55bafa9f4efa175d81e138ff3aa53aa00930">INDEX_FILES</a>];</div>
<div class="line"><span class="lineno"> 7580</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> filename_vec;</div>
<div class="line"><span class="lineno"> 7581</span>    <span class="keywordtype">size_t</span> n = strlen(path);</div>
<div class="line"><span class="lineno"> 7582</span>    <span class="keywordtype">int</span> found = 0;</div>
<div class="line"><span class="lineno"> 7583</span> </div>
<div class="line"><span class="lineno"> 7584</span>    <span class="comment">/* The &#39;path&#39; given to us points to the directory. Remove all trailing</span></div>
<div class="line"><span class="lineno"> 7585</span><span class="comment">     * directory separator characters from the end of the path, and</span></div>
<div class="line"><span class="lineno"> 7586</span><span class="comment">     * then append single directory separator character. */</span></div>
<div class="line"><span class="lineno"> 7587</span>    <span class="keywordflow">while</span> ((n &gt; 0) &amp;&amp; (path[n - 1] == <span class="charliteral">&#39;/&#39;</span>)) {</div>
<div class="line"><span class="lineno"> 7588</span>        n--;</div>
<div class="line"><span class="lineno"> 7589</span>    }</div>
<div class="line"><span class="lineno"> 7590</span>    path[n] = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno"> 7591</span> </div>
<div class="line"><span class="lineno"> 7592</span>    <span class="comment">/* Traverse index files list. For each entry, append it to the given</span></div>
<div class="line"><span class="lineno"> 7593</span><span class="comment">     * path and see if the file exists. If it exists, break the loop */</span></div>
<div class="line"><span class="lineno"> 7594</span>    <span class="keywordflow">while</span> ((list = <a class="code hl_function" href="#a8a9f9af183eb62789209809d41dabbf4">next_option</a>(list, &amp;filename_vec, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno"> 7595</span>        <span class="comment">/* Ignore too long entries that may overflow path buffer */</span></div>
<div class="line"><span class="lineno"> 7596</span>        <span class="keywordflow">if</span> ((filename_vec.len + 1) &gt; (path_len - (n + 1))) {</div>
<div class="line"><span class="lineno"> 7597</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 7598</span>        }</div>
<div class="line"><span class="lineno"> 7599</span> </div>
<div class="line"><span class="lineno"> 7600</span>        <span class="comment">/* Prepare full path to the index file */</span></div>
<div class="line"><span class="lineno"> 7601</span>        <a class="code hl_function" href="#ad0f8debaa123ea7820fa8345125e4235">mg_strlcpy</a>(path + n + 1, filename_vec.ptr, filename_vec.len + 1);</div>
<div class="line"><span class="lineno"> 7602</span> </div>
<div class="line"><span class="lineno"> 7603</span>        <span class="comment">/* Does it exist? */</span></div>
<div class="line"><span class="lineno"> 7604</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a97625a7b1941b770798e090232bdfb6f">mg_stat</a>(conn, path, filestat)) {</div>
<div class="line"><span class="lineno"> 7605</span>            <span class="comment">/* Yes it does, break the loop */</span></div>
<div class="line"><span class="lineno"> 7606</span>            found = 1;</div>
<div class="line"><span class="lineno"> 7607</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 7608</span>        }</div>
<div class="line"><span class="lineno"> 7609</span>    }</div>
<div class="line"><span class="lineno"> 7610</span> </div>
<div class="line"><span class="lineno"> 7611</span>    <span class="comment">/* If no index file exists, restore directory path */</span></div>
<div class="line"><span class="lineno"> 7612</span>    <span class="keywordflow">if</span> (!found) {</div>
<div class="line"><span class="lineno"> 7613</span>        path[n] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 7614</span>    }</div>
<div class="line"><span class="lineno"> 7615</span> </div>
<div class="line"><span class="lineno"> 7616</span>    <span class="keywordflow">return</span> found;</div>
<div class="line"><span class="lineno"> 7617</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02005">INDEX_FILES</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8c_source.html#l05650">mg_stat()</a>, <a class="el" href="civetweb_8c_source.html#l03002">mg_strlcpy()</a>, <a class="el" href="civetweb_8c_source.html#l03899">next_option()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l07622">interpret_uri()</a>.</p>

</div>
</div>
<a id="a8b35d4674db9acdc8b837dde56bcd94e" name="a8b35d4674db9acdc8b837dde56bcd94e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b35d4674db9acdc8b837dde56bcd94e">&#9670;&#160;</a></span>suggest_connection_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * suggest_connection_header </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l04046">4046</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4047</span>{</div>
<div class="line"><span class="lineno"> 4048</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a2f83db0ca198c57993fb3e3cd5e97500">should_keep_alive</a>(conn) ? <span class="stringliteral">&quot;keep-alive&quot;</span> : <span class="stringliteral">&quot;close&quot;</span>;</div>
<div class="line"><span class="lineno"> 4049</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l03984">should_keep_alive()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>.</p>

</div>
</div>
<a id="a462e0cd852acad3eadee2621f126a1a0" name="a462e0cd852acad3eadee2621f126a1a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a462e0cd852acad3eadee2621f126a1a0">&#9670;&#160;</a></span>switch_domain_context()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int switch_domain_context </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l14174">14174</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">14175</span>{</div>
<div class="line"><span class="lineno">14176</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structvec.html">vec</a> host;</div>
<div class="line"><span class="lineno">14177</span> </div>
<div class="line"><span class="lineno">14178</span>    <a class="code hl_function" href="#a5e23406129bfd98c4cbc037682b22343">get_host_from_request_info</a>(&amp;host, &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>);</div>
<div class="line"><span class="lineno">14179</span> </div>
<div class="line"><span class="lineno">14180</span>    <span class="keywordflow">if</span> (host.ptr) {</div>
<div class="line"><span class="lineno">14181</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>) {</div>
<div class="line"><span class="lineno">14182</span>            <span class="comment">/* This is a HTTPS connection, maybe we have a hostname</span></div>
<div class="line"><span class="lineno">14183</span><span class="comment">             * from SNI (set in ssl_servername_callback). */</span></div>
<div class="line"><span class="lineno">14184</span>            <span class="keyword">const</span> <span class="keywordtype">char</span> *sslhost = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>];</div>
<div class="line"><span class="lineno">14185</span>            <span class="keywordflow">if</span> (sslhost &amp;&amp; (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> != &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>))) {</div>
<div class="line"><span class="lineno">14186</span>                <span class="comment">/* We are not using the default domain */</span></div>
<div class="line"><span class="lineno">14187</span>                <span class="keywordflow">if</span> ((strlen(sslhost) != host.len)</div>
<div class="line"><span class="lineno">14188</span>                    || <a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(host.ptr, sslhost, host.len)) {</div>
<div class="line"><span class="lineno">14189</span>                    <span class="comment">/* Mismatch between SNI domain and HTTP domain */</span></div>
<div class="line"><span class="lineno">14190</span>                    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Host mismatch: SNI: %s, HTTPS: %.*s&quot;</span>,</div>
<div class="line"><span class="lineno">14191</span>                                sslhost,</div>
<div class="line"><span class="lineno">14192</span>                                (<span class="keywordtype">int</span>)host.len,</div>
<div class="line"><span class="lineno">14193</span>                                host.ptr);</div>
<div class="line"><span class="lineno">14194</span>                    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">14195</span>                }</div>
<div class="line"><span class="lineno">14196</span>            }</div>
<div class="line"><span class="lineno">14197</span> </div>
<div class="line"><span class="lineno">14198</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14199</span>            <span class="keyword">struct </span><a class="code hl_struct" href="structmg__domain__context.html">mg_domain_context</a> *dom = &amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>);</div>
<div class="line"><span class="lineno">14200</span>            <span class="keywordflow">while</span> (dom) {</div>
<div class="line"><span class="lineno">14201</span>                <span class="keyword">const</span> <span class="keywordtype">char</span> *domName = dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>];</div>
<div class="line"><span class="lineno">14202</span>                <span class="keywordtype">size_t</span> domNameLen = strlen(domName);</div>
<div class="line"><span class="lineno">14203</span>                <span class="keywordflow">if</span> ((domNameLen == host.len)</div>
<div class="line"><span class="lineno">14204</span>                    &amp;&amp; !<a class="code hl_function" href="#a1e22e846cc0308d6521ed516918f380f">mg_strncasecmp</a>(host.ptr, domName, host.len)) {</div>
<div class="line"><span class="lineno">14205</span> </div>
<div class="line"><span class="lineno">14206</span>                    <span class="comment">/* Found matching domain */</span></div>
<div class="line"><span class="lineno">14207</span>                    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;HTTP domain %s found&quot;</span>,</div>
<div class="line"><span class="lineno">14208</span>                                dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#a194a908b0cdd99ddce54c993363c85e5">config</a>[<a class="code hl_enumvalue" href="#a06fc87d81c62e9abb8790b6e5713c55ba43a1f307bb484b11e37518539af13ed2">AUTHENTICATION_DOMAIN</a>]);</div>
<div class="line"><span class="lineno">14209</span> </div>
<div class="line"><span class="lineno">14210</span>                    <span class="comment">/* TODO: Check if this is a HTTP or HTTPS domain */</span></div>
<div class="line"><span class="lineno">14211</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> = dom;</div>
<div class="line"><span class="lineno">14212</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">14213</span>                }</div>
<div class="line"><span class="lineno">14214</span>                <a class="code hl_function" href="#a0110b7fe742fb4ee2ab467151e4df7c2">mg_lock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">14215</span>                dom = dom-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ab15afe08729b3371cf26138782732845">next</a>;</div>
<div class="line"><span class="lineno">14216</span>                <a class="code hl_function" href="#a40bc6a84aa4f6dc3af32fcb62e74a848">mg_unlock_context</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">14217</span>            }</div>
<div class="line"><span class="lineno">14218</span>        }</div>
<div class="line"><span class="lineno">14219</span> </div>
<div class="line"><span class="lineno">14220</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;HTTP%s Host: %.*s&quot;</span>,</div>
<div class="line"><span class="lineno">14221</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> ? <span class="stringliteral">&quot;S&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">14222</span>                    (int)host.len,</div>
<div class="line"><span class="lineno">14223</span>                    host.ptr);</div>
<div class="line"><span class="lineno">14224</span> </div>
<div class="line"><span class="lineno">14225</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">14226</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;HTTP%s Host is not set&quot;</span>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a> ? <span class="stringliteral">&quot;S&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">14227</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">14228</span>    }</div>
<div class="line"><span class="lineno">14229</span> </div>
<div class="line"><span class="lineno">14230</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">14231</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a5e23406129bfd98c4cbc037682b22343"><div class="ttname"><a href="#a5e23406129bfd98c4cbc037682b22343">get_host_from_request_info</a></div><div class="ttdeci">static void get_host_from_request_info(struct vec *host, const struct mg_request_info *ri)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l14136">civetweb.c:14136</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01999">AUTHENTICATION_DOMAIN</a>, <a class="el" href="civetweb_8c_source.html#l02271">mg_domain_context::config</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8c_source.html#l14136">get_host_from_request_info()</a>, <a class="el" href="civetweb_8c_source.html#l01866">vec::len</a>, <a class="el" href="civetweb_8c_source.html#l13018">mg_lock_context()</a>, <a class="el" href="civetweb_8c_source.html#l03019">mg_strncasecmp()</a>, <a class="el" href="civetweb_8c_source.html#l13027">mg_unlock_context()</a>, <a class="el" href="civetweb_8c_source.html#l02285">mg_domain_context::next</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l01865">vec::ptr</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, and <a class="el" href="civetweb_8c_source.html#l02506">mg_connection::ssl</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18645">get_request()</a>.</p>

</div>
</div>
<a id="a1b3061c039f873bc927e2947b4e46bae" name="a1b3061c039f873bc927e2947b4e46bae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b3061c039f873bc927e2947b4e46bae">&#9670;&#160;</a></span>tls_dtor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tls_dtor </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>key</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16321">16321</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">16322</span>{</div>
<div class="line"><span class="lineno">16323</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> *tls = (<span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> *)key;</div>
<div class="line"><span class="lineno">16324</span>    <span class="comment">/* key == pthread_getspecific(sTlsKey); */</span></div>
<div class="line"><span class="lineno">16325</span> </div>
<div class="line"><span class="lineno">16326</span>    <span class="keywordflow">if</span> (tls) {</div>
<div class="line"><span class="lineno">16327</span>        <span class="keywordflow">if</span> (tls-&gt;<a class="code hl_variable" href="structmg__workerTLS.html#afb66eb6c9a175525b219dfcda7b40c7e">is_master</a> == 2) {</div>
<div class="line"><span class="lineno">16328</span>            tls-&gt;<a class="code hl_variable" href="structmg__workerTLS.html#afb66eb6c9a175525b219dfcda7b40c7e">is_master</a> = -3; <span class="comment">/* Mark memory as dead */</span></div>
<div class="line"><span class="lineno">16329</span>            <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(tls);</div>
<div class="line"><span class="lineno">16330</span>        }</div>
<div class="line"><span class="lineno">16331</span>    }</div>
<div class="line"><span class="lineno">16332</span>    pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">16333</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01588">mg_workerTLS::is_master</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l01580">sTlsKey</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>.</p>

</div>
</div>
<a id="a8e8a676fa79a0e0095c1ebfeab44b224" name="a8e8a676fa79a0e0095c1ebfeab44b224"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e8a676fa79a0e0095c1ebfeab44b224">&#9670;&#160;</a></span>uninitialize_openssl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void uninitialize_openssl </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l17594">17594</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">17595</span>{</div>
<div class="line"><span class="lineno">17596</span><span class="preprocessor">#if defined(OPENSSL_API_1_1) || defined(OPENSSL_API_3_0)</span></div>
<div class="line"><span class="lineno">17597</span> </div>
<div class="line"><span class="lineno">17598</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a68810f97aa216df1fa96103dec93fca3">mg_atomic_dec</a>(&amp;<a class="code hl_variable" href="#a5254c431a0b51011fbb000d383bf56fd">cryptolib_users</a>) == 0) {</div>
<div class="line"><span class="lineno">17599</span> </div>
<div class="line"><span class="lineno">17600</span>        <span class="comment">/* Shutdown according to</span></div>
<div class="line"><span class="lineno">17601</span><span class="comment">         * https://wiki.openssl.org/index.php/Library_Initialization#Cleanup</span></div>
<div class="line"><span class="lineno">17602</span><span class="comment">         * http://stackoverflow.com/questions/29845527/how-to-properly-uninitialize-openssl</span></div>
<div class="line"><span class="lineno">17603</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">17604</span>        CONF_modules_unload(1);</div>
<div class="line"><span class="lineno">17605</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">17606</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">17607</span> </div>
<div class="line"><span class="lineno">17608</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a68810f97aa216df1fa96103dec93fca3">mg_atomic_dec</a>(&amp;<a class="code hl_variable" href="#a5254c431a0b51011fbb000d383bf56fd">cryptolib_users</a>) == 0) {</div>
<div class="line"><span class="lineno">17609</span> </div>
<div class="line"><span class="lineno">17610</span>        <span class="comment">/* Shutdown according to</span></div>
<div class="line"><span class="lineno">17611</span><span class="comment">         * https://wiki.openssl.org/index.php/Library_Initialization#Cleanup</span></div>
<div class="line"><span class="lineno">17612</span><span class="comment">         * http://stackoverflow.com/questions/29845527/how-to-properly-uninitialize-openssl</span></div>
<div class="line"><span class="lineno">17613</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">17614</span>        CRYPTO_set_locking_callback(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">17615</span>        CRYPTO_set_id_callback(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">17616</span>        ENGINE_cleanup();</div>
<div class="line"><span class="lineno">17617</span>        CONF_modules_unload(1);</div>
<div class="line"><span class="lineno">17618</span>        ERR_free_strings();</div>
<div class="line"><span class="lineno">17619</span>        EVP_cleanup();</div>
<div class="line"><span class="lineno">17620</span>        CRYPTO_cleanup_all_ex_data();</div>
<div class="line"><span class="lineno">17621</span>        OPENSSL_REMOVE_THREAD_STATE();</div>
<div class="line"><span class="lineno">17622</span> </div>
<div class="line"><span class="lineno">17623</span>        <span class="keywordflow">for</span> (i = 0; i &lt; CRYPTO_num_locks(); i++) {</div>
<div class="line"><span class="lineno">17624</span>            pthread_mutex_destroy(&amp;<a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a>[i]);</div>
<div class="line"><span class="lineno">17625</span>        }</div>
<div class="line"><span class="lineno">17626</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(<a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a>);</div>
<div class="line"><span class="lineno">17627</span>        <a class="code hl_variable" href="#a4bb32ca4bd6292bd0d47491d9b7b3996">ssl_mutexes</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">17628</span><span class="preprocessor">#endif </span><span class="comment">/* OPENSSL_API_1_1 || OPENSSL_API_3_0 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="lineno">17629</span>    }</div>
<div class="line"><span class="lineno">17630</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l16815">cryptolib_users</a>, <a class="el" href="civetweb_8c_source.html#l01144">mg_atomic_dec()</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l16451">ssl_mutexes</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l22477">mg_exit_library()</a>.</p>

</div>
</div>
<a id="affee01654ebda8d153ea3b7e7502f248" name="affee01654ebda8d153ea3b7e7502f248"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affee01654ebda8d153ea3b7e7502f248">&#9670;&#160;</a></span>url_decode_in_place()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void url_decode_in_place </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l07080">7080</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 7081</span>{</div>
<div class="line"><span class="lineno"> 7082</span>    <span class="keywordtype">int</span> len = (int)strlen(buf);</div>
<div class="line"><span class="lineno"> 7083</span>    (void)<a class="code hl_function" href="#a3bdfbeb661f200bdbe2e19e6258bb937">mg_url_decode</a>(buf, len, buf, len + 1, 1);</div>
<div class="line"><span class="lineno"> 7084</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l07048">mg_url_decode()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l14704">handle_request()</a>, and <a class="el" href="civetweb_8c_source.html#l07157">mg_split_form_urlencoded()</a>.</p>

</div>
</div>
<a id="adbe073c81a7fabd2785914e1b4a8e3d0" name="adbe073c81a7fabd2785914e1b4a8e3d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbe073c81a7fabd2785914e1b4a8e3d0">&#9670;&#160;</a></span>worker_thread()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void * worker_thread </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>thread_func_param</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19937">19937</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19938</span>{</div>
<div class="line"><span class="lineno">19939</span><span class="preprocessor">#if !defined(__ZEPHYR__)</span></div>
<div class="line"><span class="lineno">19940</span>    <span class="keyword">struct </span>sigaction sa;</div>
<div class="line"><span class="lineno">19941</span> </div>
<div class="line"><span class="lineno">19942</span>    <span class="comment">/* Ignore SIGPIPE */</span></div>
<div class="line"><span class="lineno">19943</span>    memset(&amp;sa, 0, <span class="keyword">sizeof</span>(sa));</div>
<div class="line"><span class="lineno">19944</span>    sa.sa_handler = SIG_IGN;</div>
<div class="line"><span class="lineno">19945</span>    sigaction(SIGPIPE, &amp;sa, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">19946</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19947</span> </div>
<div class="line"><span class="lineno">19948</span>    <a class="code hl_function" href="#aa9686d5ea75649460c042ed8f39a0be9">worker_thread_run</a>((<span class="keyword">struct</span> <a class="code hl_struct" href="structmg__connection.html">mg_connection</a> *)thread_func_param);</div>
<div class="line"><span class="lineno">19949</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19950</span>}</div>
<div class="ttc" id="acivetweb_8c_html_aa9686d5ea75649460c042ed8f39a0be9"><div class="ttname"><a href="#aa9686d5ea75649460c042ed8f39a0be9">worker_thread_run</a></div><div class="ttdeci">static void worker_thread_run(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l19704">civetweb.c:19704</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="aa9686d5ea75649460c042ed8f39a0be9" name="aa9686d5ea75649460c042ed8f39a0be9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9686d5ea75649460c042ed8f39a0be9">&#9670;&#160;</a></span>worker_thread_run()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void worker_thread_run </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmg__connection.html">mg_connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l19704">19704</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">19705</span>{</div>
<div class="line"><span class="lineno">19706</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__context.html">mg_context</a> *ctx = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>;</div>
<div class="line"><span class="lineno">19707</span>    <span class="keywordtype">int</span> thread_index;</div>
<div class="line"><span class="lineno">19708</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structmg__workerTLS.html">mg_workerTLS</a> tls;</div>
<div class="line"><span class="lineno">19709</span> </div>
<div class="line"><span class="lineno">19710</span>    <a class="code hl_function" href="#a4c02435b9feed10fb546e874e85ecf83">mg_set_thread_name</a>(<span class="stringliteral">&quot;worker&quot;</span>);</div>
<div class="line"><span class="lineno">19711</span> </div>
<div class="line"><span class="lineno">19712</span>    tls.is_master = 0;</div>
<div class="line"><span class="lineno">19713</span>    tls.thread_idx = (unsigned)<a class="code hl_function" href="#ac84429c87794be46b88e30fbd3b0bcfa">mg_atomic_inc</a>(&amp;<a class="code hl_variable" href="#af79aed9cc77304a39b3e031b2730e38b">thread_idx_max</a>);</div>
<div class="line"><span class="lineno">19714</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">19715</span>    tls.pthread_cond_helper_mutex = CreateEvent(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_define" href="gmacros_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code hl_define" href="gmacros_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">19716</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19717</span> </div>
<div class="line"><span class="lineno">19718</span>    <span class="comment">/* Initialize thread local storage before calling any callback */</span></div>
<div class="line"><span class="lineno">19719</span>    pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, &amp;tls);</div>
<div class="line"><span class="lineno">19720</span> </div>
<div class="line"><span class="lineno">19721</span>    <span class="comment">/* Check if there is a user callback */</span></div>
<div class="line"><span class="lineno">19722</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a68d88b77432b851cab0918eb2ce9d434">init_thread</a>) {</div>
<div class="line"><span class="lineno">19723</span>        <span class="comment">/* call init_thread for a worker thread (type 1), and store the</span></div>
<div class="line"><span class="lineno">19724</span><span class="comment">         * return value */</span></div>
<div class="line"><span class="lineno">19725</span>        tls.user_ptr = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#a68d88b77432b851cab0918eb2ce9d434">init_thread</a>(ctx, 1);</div>
<div class="line"><span class="lineno">19726</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19727</span>        <span class="comment">/* No callback: set user pointer to NULL */</span></div>
<div class="line"><span class="lineno">19728</span>        tls.user_ptr = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19729</span>    }</div>
<div class="line"><span class="lineno">19730</span> </div>
<div class="line"><span class="lineno">19731</span>    <span class="comment">/* Connection structure has been pre-allocated */</span></div>
<div class="line"><span class="lineno">19732</span>    thread_index = (int)(conn - ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a854d7b5d783f951cb08e2aeed380c481">worker_connections</a>);</div>
<div class="line"><span class="lineno">19733</span>    <span class="keywordflow">if</span> ((thread_index &lt; 0)</div>
<div class="line"><span class="lineno">19734</span>        || ((unsigned)thread_index &gt;= (<span class="keywordtype">unsigned</span>)ctx-&gt;<a class="code hl_variable" href="structmg__context.html#afa57b9192357ddbae3c0fc3b5481425a">cfg_worker_threads</a>)) {</div>
<div class="line"><span class="lineno">19735</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx,</div>
<div class="line"><span class="lineno">19736</span>                            <span class="stringliteral">&quot;Internal error: Invalid worker index %i&quot;</span>,</div>
<div class="line"><span class="lineno">19737</span>                            thread_index);</div>
<div class="line"><span class="lineno">19738</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">19739</span>    }</div>
<div class="line"><span class="lineno">19740</span> </div>
<div class="line"><span class="lineno">19741</span>    <span class="comment">/* Request buffers are not pre-allocated. They are private to the</span></div>
<div class="line"><span class="lineno">19742</span><span class="comment">     * request and do not contain any state information that might be</span></div>
<div class="line"><span class="lineno">19743</span><span class="comment">     * of interest to anyone observing a server status.  */</span></div>
<div class="line"><span class="lineno">19744</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a> = (<span class="keywordtype">char</span> *)<a class="code hl_define" href="#a09f3709fc72c7edf208c75ccbe3d997b">mg_malloc_ctx</a>(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#af17486f182c09fa18f04d21212d6d381">max_request_size</a>, conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>);</div>
<div class="line"><span class="lineno">19745</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a> == <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><span class="lineno">19746</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(</div>
<div class="line"><span class="lineno">19747</span>            ctx,</div>
<div class="line"><span class="lineno">19748</span>            <span class="stringliteral">&quot;Out of memory: Cannot allocate buffer for worker %i&quot;</span>,</div>
<div class="line"><span class="lineno">19749</span>            thread_index);</div>
<div class="line"><span class="lineno">19750</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">19751</span>    }</div>
<div class="line"><span class="lineno">19752</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6033a47c6e89ad571ca65000ab53f07e">buf_size</a> = (int)ctx-&gt;<a class="code hl_variable" href="structmg__context.html#af17486f182c09fa18f04d21212d6d381">max_request_size</a>;</div>
<div class="line"><span class="lineno">19753</span> </div>
<div class="line"><span class="lineno">19754</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a> = &amp;(ctx-&gt;<a class="code hl_variable" href="structmg__context.html#aa9f0218a15ae4f5f01985f2531660e4c">dd</a>); <span class="comment">/* Use default domain and default host */</span></div>
<div class="line"><span class="lineno">19755</span> </div>
<div class="line"><span class="lineno">19756</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aac018bc9711d0644676f33e396027000">tls_user_ptr</a> = tls.user_ptr; <span class="comment">/* store ptr for quick access */</span></div>
<div class="line"><span class="lineno">19757</span> </div>
<div class="line"><span class="lineno">19758</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a383d55fab7d885a52cfa9c8a56f2a7c3">user_data</a> = ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a73a26dd1c9abead88b40b2d226ad9f28">user_data</a>;</div>
<div class="line"><span class="lineno">19759</span>    <span class="comment">/* Allocate a mutex for this connection to allow communication both</span></div>
<div class="line"><span class="lineno">19760</span><span class="comment">     * within the request handler and from elsewhere in the application</span></div>
<div class="line"><span class="lineno">19761</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">19762</span>    <span class="keywordflow">if</span> (0 != pthread_mutex_init(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a641ac188409fd64c07e486b265d58a03">mutex</a>, &amp;<a class="code hl_variable" href="#a5fea1ce44dd3b119b5edd85d330d8143">pthread_mutex_attr</a>)) {</div>
<div class="line"><span class="lineno">19763</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a>);</div>
<div class="line"><span class="lineno">19764</span>        <a class="code hl_define" href="#a1ddc04f3556f50ae9cf6ec670c441c4b">mg_cry_ctx_internal</a>(ctx, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Cannot create mutex&quot;</span>);</div>
<div class="line"><span class="lineno">19765</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">19766</span>    }</div>
<div class="line"><span class="lineno">19767</span> </div>
<div class="line"><span class="lineno">19768</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">19769</span>    conn-&gt;conn_state = 1; <span class="comment">/* not consumed */</span></div>
<div class="line"><span class="lineno">19770</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19771</span> </div>
<div class="line"><span class="lineno">19772</span>    <span class="comment">/* Call consume_socket() even when ctx-&gt;stop_flag &gt; 0, to let it</span></div>
<div class="line"><span class="lineno">19773</span><span class="comment">     * signal sq_empty condvar to wake up the master waiting in</span></div>
<div class="line"><span class="lineno">19774</span><span class="comment">     * produce_socket() */</span></div>
<div class="line"><span class="lineno">19775</span>    <span class="keywordflow">while</span> (<a class="code hl_function" href="#a02b40bbcf0b155e706e5e1eb6b53309e">consume_socket</a>(ctx, &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>, thread_index)) {</div>
<div class="line"><span class="lineno">19776</span> </div>
<div class="line"><span class="lineno">19777</span>        <span class="comment">/* New connections must start with new protocol negotiation */</span></div>
<div class="line"><span class="lineno">19778</span>        tls.alpn_proto = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19779</span> </div>
<div class="line"><span class="lineno">19780</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">19781</span>        conn-&gt;conn_close_time = 0;</div>
<div class="line"><span class="lineno">19782</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19783</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#acc800b7c744ad9f71401fae6048f6995">conn_birth_time</a> = time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">19784</span> </div>
<div class="line"><span class="lineno">19785</span>        <span class="comment">/* Fill in IP, port info early so even if SSL setup below fails,</span></div>
<div class="line"><span class="lineno">19786</span><span class="comment">         * error handler would have the corresponding info.</span></div>
<div class="line"><span class="lineno">19787</span><span class="comment">         * Thanks to Johannes Winkelmann for the patch.</span></div>
<div class="line"><span class="lineno">19788</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">19789</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#af2a549c0b1db3ab0a0efe7861cc62e6a">remote_port</a> =</div>
<div class="line"><span class="lineno">19790</span>            ntohs(<a class="code hl_define" href="#a58f28d0739c8e6a66ffce338daef408c">USA_IN_PORT_UNSAFE</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#afe3a45fe832ca19cc85299b9a96d8feb">rsa</a>));</div>
<div class="line"><span class="lineno">19791</span> </div>
<div class="line"><span class="lineno">19792</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a0edacbaca9b971ced5f00a7dfae06165">server_port</a> =</div>
<div class="line"><span class="lineno">19793</span>            ntohs(<a class="code hl_define" href="#a58f28d0739c8e6a66ffce338daef408c">USA_IN_PORT_UNSAFE</a>(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#a455153d6b0bf7dd4af9ce0183ab35a00">lsa</a>));</div>
<div class="line"><span class="lineno">19794</span> </div>
<div class="line"><span class="lineno">19795</span>        <a class="code hl_function" href="#a043f416da5d5ec0b9a0f39e7a34250c2">sockaddr_to_string</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#ab758e3630f43e1bd62c66311e3bf7a50">remote_addr</a>,</div>
<div class="line"><span class="lineno">19796</span>                           <span class="keyword">sizeof</span>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#ab758e3630f43e1bd62c66311e3bf7a50">remote_addr</a>),</div>
<div class="line"><span class="lineno">19797</span>                           &amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#afe3a45fe832ca19cc85299b9a96d8feb">rsa</a>);</div>
<div class="line"><span class="lineno">19798</span> </div>
<div class="line"><span class="lineno">19799</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;Incoming %sconnection from %s&quot;</span>,</div>
<div class="line"><span class="lineno">19800</span>                    (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#a2d1d5b8ef7da25d5e7e666e023a9b733">is_ssl</a> ? <span class="stringliteral">&quot;SSL &quot;</span> : <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><span class="lineno">19801</span>                    conn-&gt;request_info.remote_addr);</div>
<div class="line"><span class="lineno">19802</span> </div>
<div class="line"><span class="lineno">19803</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#af66a6c4c2364a37b87f646f76b9e7d3d">is_ssl</a> = conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#a2d1d5b8ef7da25d5e7e666e023a9b733">is_ssl</a>;</div>
<div class="line"><span class="lineno">19804</span> </div>
<div class="line"><span class="lineno">19805</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#a2d1d5b8ef7da25d5e7e666e023a9b733">is_ssl</a>) {</div>
<div class="line"><span class="lineno">19806</span> </div>
<div class="line"><span class="lineno">19807</span><span class="preprocessor">#if defined(USE_MBEDTLS)</span></div>
<div class="line"><span class="lineno">19808</span>            <span class="comment">/* HTTPS connection */</span></div>
<div class="line"><span class="lineno">19809</span>            <span class="keywordflow">if</span> (mbed_ssl_accept(&amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ac376c70a4f827896a0152d704233424b">ssl</a>),</div>
<div class="line"><span class="lineno">19810</span>                                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#abb30f6262885e94b0242e7e85960caaf">dom_ctx</a>-&gt;<a class="code hl_variable" href="structmg__domain__context.html#ad3a7a314204d9bb7fc0af8bccf826e58">ssl_ctx</a>,</div>
<div class="line"><span class="lineno">19811</span>                                (<span class="keywordtype">int</span> *)&amp;(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6a9f2b9d1087412cac4187ce5a44d274">client</a>.<a class="code hl_variable" href="structsocket.html#ace41176c1363c25e08837812c18d22dd">sock</a>),</div>
<div class="line"><span class="lineno">19812</span>                                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#aba76ab7aef56551015fe468e8fc306c1">phys_ctx</a>)</div>
<div class="line"><span class="lineno">19813</span>                == 0) {</div>
<div class="line"><span class="lineno">19814</span>                <span class="comment">/* conn-&gt;dom_ctx is set in get_request */</span></div>
<div class="line"><span class="lineno">19815</span>                <span class="comment">/* process HTTPS connection */</span></div>
<div class="line"><span class="lineno">19816</span>                <a class="code hl_function" href="#ae40e268aca47c39d1f151a60655f3f70">init_connection</a>(conn);</div>
<div class="line"><span class="lineno">19817</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a>;</div>
<div class="line"><span class="lineno">19818</span>                conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> = <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a>;</div>
<div class="line"><span class="lineno">19819</span>                <a class="code hl_function" href="#a00335d9fbef2e339b4ede6983b97b906">process_new_connection</a>(conn);</div>
<div class="line"><span class="lineno">19820</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19821</span>                <span class="comment">/* make sure the connection is cleaned up on SSL failure */</span></div>
<div class="line"><span class="lineno">19822</span>                <a class="code hl_function" href="#af4b9971ca12d36d97d92dd7980059fb0">close_connection</a>(conn);</div>
<div class="line"><span class="lineno">19823</span>            }</div>
<div class="line"><span class="lineno">19824</span> </div>
<div class="line"><span class="lineno">19825</span><span class="preprocessor">#elif !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno">19826</span>            <span class="comment">/* HTTPS connection */</span></div>
<div class="line"><span class="lineno">19827</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac5ddf37dfcbb5287702f50354be5ab54">sslize</a>(conn, SSL_accept, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><span class="lineno">19828</span>                <span class="comment">/* conn-&gt;dom_ctx is set in get_request */</span></div>
<div class="line"><span class="lineno">19829</span> </div>
<div class="line"><span class="lineno">19830</span>                <span class="comment">/* Get SSL client certificate information (if set) */</span></div>
<div class="line"><span class="lineno">19831</span>                <span class="keyword">struct </span><a class="code hl_struct" href="structmg__client__cert.html">mg_client_cert</a> client_cert;</div>
<div class="line"><span class="lineno">19832</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="#a1cf68e4c3856f86612a53eac755c36fe">ssl_get_client_cert_info</a>(conn, &amp;client_cert)) {</div>
<div class="line"><span class="lineno">19833</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a> = &amp;client_cert;</div>
<div class="line"><span class="lineno">19834</span>                }</div>
<div class="line"><span class="lineno">19835</span> </div>
<div class="line"><span class="lineno">19836</span>                <span class="comment">/* process HTTPS connection */</span></div>
<div class="line"><span class="lineno">19837</span><span class="preprocessor">#if defined(USE_HTTP2)</span></div>
<div class="line"><span class="lineno">19838</span>                <span class="keywordflow">if</span> ((tls.alpn_proto != <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><span class="lineno">19839</span>                    &amp;&amp; (!memcmp(tls.alpn_proto, <span class="stringliteral">&quot;\x02h2&quot;</span>, 3))) {</div>
<div class="line"><span class="lineno">19840</span>                    <span class="comment">/* process HTTPS/2 connection */</span></div>
<div class="line"><span class="lineno">19841</span>                    <a class="code hl_function" href="#ae40e268aca47c39d1f151a60655f3f70">init_connection</a>(conn);</div>
<div class="line"><span class="lineno">19842</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a>;</div>
<div class="line"><span class="lineno">19843</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> = <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca3c3663fdf461dc9873cadc4a36b3a139">PROTOCOL_TYPE_HTTP2</a>;</div>
<div class="line"><span class="lineno">19844</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a168cfc671a07bf2360ae806193c015bc">content_len</a> =</div>
<div class="line"><span class="lineno">19845</span>                        -1;               <span class="comment">/* content length is not predefined */</span></div>
<div class="line"><span class="lineno">19846</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a45f6e2c7e07289686090f84c97e71ec5">is_chunked</a> = 0; <span class="comment">/* HTTP2 is never chunked */</span></div>
<div class="line"><span class="lineno">19847</span>                    process_new_http2_connection(conn);</div>
<div class="line"><span class="lineno">19848</span>                } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">19849</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19850</span>                {</div>
<div class="line"><span class="lineno">19851</span>                    <span class="comment">/* process HTTPS/1.x or WEBSOCKET-SECURE connection */</span></div>
<div class="line"><span class="lineno">19852</span>                    <a class="code hl_function" href="#ae40e268aca47c39d1f151a60655f3f70">init_connection</a>(conn);</div>
<div class="line"><span class="lineno">19853</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a>;</div>
<div class="line"><span class="lineno">19854</span>                    <span class="comment">/* Start with HTTP, WS will be an &quot;upgrade&quot; request later */</span></div>
<div class="line"><span class="lineno">19855</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> = <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a>;</div>
<div class="line"><span class="lineno">19856</span>                    <a class="code hl_function" href="#a00335d9fbef2e339b4ede6983b97b906">process_new_connection</a>(conn);</div>
<div class="line"><span class="lineno">19857</span>                }</div>
<div class="line"><span class="lineno">19858</span> </div>
<div class="line"><span class="lineno">19859</span>                <span class="comment">/* Free client certificate info */</span></div>
<div class="line"><span class="lineno">19860</span>                <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>) {</div>
<div class="line"><span class="lineno">19861</span>                    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>((<span class="keywordtype">void</span> *)(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>-&gt;<a class="code hl_variable" href="structmg__client__cert.html#abc030d72bbaeb9bf9091d674dd71ac9b">subject</a>));</div>
<div class="line"><span class="lineno">19862</span>                    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>((<span class="keywordtype">void</span> *)(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>-&gt;<a class="code hl_variable" href="structmg__client__cert.html#a7f1312eb1eeb454b2c0c05a0ac9d781e">issuer</a>));</div>
<div class="line"><span class="lineno">19863</span>                    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>((<span class="keywordtype">void</span> *)(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>-&gt;<a class="code hl_variable" href="structmg__client__cert.html#acabeb71119a4874f9d1fc6a26673a22c">serial</a>));</div>
<div class="line"><span class="lineno">19864</span>                    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>((<span class="keywordtype">void</span> *)(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>-&gt;<a class="code hl_variable" href="structmg__client__cert.html#a8987a45a7b73927af1899beee708a5fa">finger</a>));</div>
<div class="line"><span class="lineno">19865</span>                    <span class="comment">/* Free certificate memory */</span></div>
<div class="line"><span class="lineno">19866</span>                    X509_free(</div>
<div class="line"><span class="lineno">19867</span>                        (X509 *)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>-&gt;<a class="code hl_variable" href="structmg__client__cert.html#aaae16e70d34544939ec2ae64b86d8427">peer_cert</a>);</div>
<div class="line"><span class="lineno">19868</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>-&gt;<a class="code hl_variable" href="structmg__client__cert.html#aaae16e70d34544939ec2ae64b86d8427">peer_cert</a> = 0;</div>
<div class="line"><span class="lineno">19869</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>-&gt;<a class="code hl_variable" href="structmg__client__cert.html#abc030d72bbaeb9bf9091d674dd71ac9b">subject</a> = 0;</div>
<div class="line"><span class="lineno">19870</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>-&gt;<a class="code hl_variable" href="structmg__client__cert.html#a7f1312eb1eeb454b2c0c05a0ac9d781e">issuer</a> = 0;</div>
<div class="line"><span class="lineno">19871</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>-&gt;<a class="code hl_variable" href="structmg__client__cert.html#acabeb71119a4874f9d1fc6a26673a22c">serial</a> = 0;</div>
<div class="line"><span class="lineno">19872</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a>-&gt;<a class="code hl_variable" href="structmg__client__cert.html#a8987a45a7b73927af1899beee708a5fa">finger</a> = 0;</div>
<div class="line"><span class="lineno">19873</span>                    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">client_cert</a> = 0;</div>
<div class="line"><span class="lineno">19874</span>                }</div>
<div class="line"><span class="lineno">19875</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19876</span>                <span class="comment">/* make sure the connection is cleaned up on SSL failure */</span></div>
<div class="line"><span class="lineno">19877</span>                <a class="code hl_function" href="#af4b9971ca12d36d97d92dd7980059fb0">close_connection</a>(conn);</div>
<div class="line"><span class="lineno">19878</span>            }</div>
<div class="line"><span class="lineno">19879</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19880</span> </div>
<div class="line"><span class="lineno">19881</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">19882</span>            <span class="comment">/* process HTTP connection */</span></div>
<div class="line"><span class="lineno">19883</span>            <a class="code hl_function" href="#ae40e268aca47c39d1f151a60655f3f70">init_connection</a>(conn);</div>
<div class="line"><span class="lineno">19884</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a5b8a4d583861cfb8a28ff105f5ba84bb">connection_type</a> = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04adc2f8be0e36657e6dae4984b591ac46e">CONNECTION_TYPE_REQUEST</a>;</div>
<div class="line"><span class="lineno">19885</span>            <span class="comment">/* Start with HTTP, WS will be an &quot;upgrade&quot; request later */</span></div>
<div class="line"><span class="lineno">19886</span>            conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a7afb014954a870291a215479a81fc242">protocol_type</a> = <a class="code hl_enumvalue" href="#adc29c2ff13d900c2f185ee95427fb06ca08c5b02481f2ffa664c433f236d59e78">PROTOCOL_TYPE_HTTP1</a>;</div>
<div class="line"><span class="lineno">19887</span>            <a class="code hl_function" href="#a00335d9fbef2e339b4ede6983b97b906">process_new_connection</a>(conn);</div>
<div class="line"><span class="lineno">19888</span>        }</div>
<div class="line"><span class="lineno">19889</span> </div>
<div class="line"><span class="lineno">19890</span>        <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Connection closed&quot;</span>);</div>
<div class="line"><span class="lineno">19891</span> </div>
<div class="line"><span class="lineno">19892</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">19893</span>        conn-&gt;conn_close_time = time(<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">19894</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19895</span>    }</div>
<div class="line"><span class="lineno">19896</span> </div>
<div class="line"><span class="lineno">19897</span>    <span class="comment">/* Call exit thread user callback */</span></div>
<div class="line"><span class="lineno">19898</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aa591ee8f5b639f726a87601261ecfa9b">exit_thread</a>) {</div>
<div class="line"><span class="lineno">19899</span>        ctx-&gt;<a class="code hl_variable" href="structmg__context.html#a96ed28bfd364cf0b9b556e365a3b780d">callbacks</a>.<a class="code hl_variable" href="structmg__callbacks.html#aa591ee8f5b639f726a87601261ecfa9b">exit_thread</a>(ctx, 1, tls.user_ptr);</div>
<div class="line"><span class="lineno">19900</span>    }</div>
<div class="line"><span class="lineno">19901</span> </div>
<div class="line"><span class="lineno">19902</span>    <span class="comment">/* delete thread local storage objects */</span></div>
<div class="line"><span class="lineno">19903</span>    pthread_setspecific(<a class="code hl_variable" href="#a03c9b752bc27bdf5941ddde6f615dd44">sTlsKey</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">19904</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno">19905</span>    CloseHandle(tls.pthread_cond_helper_mutex);</div>
<div class="line"><span class="lineno">19906</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19907</span>    pthread_mutex_destroy(&amp;conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a641ac188409fd64c07e486b265d58a03">mutex</a>);</div>
<div class="line"><span class="lineno">19908</span> </div>
<div class="line"><span class="lineno">19909</span>    <span class="comment">/* Free the request buffer. */</span></div>
<div class="line"><span class="lineno">19910</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a6033a47c6e89ad571ca65000ab53f07e">buf_size</a> = 0;</div>
<div class="line"><span class="lineno">19911</span>    <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>(conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a>);</div>
<div class="line"><span class="lineno">19912</span>    conn-&gt;<a class="code hl_variable" href="structmg__connection.html#a897c2cf854e4ad76856bad74fb8e7f0a">buf</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19913</span> </div>
<div class="line"><span class="lineno">19914</span>    <span class="comment">/* Free cleaned URI (if any) */</span></div>
<div class="line"><span class="lineno">19915</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a> != conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a5ae29523876fdcbb546165024dabc8c0">local_uri_raw</a>) {</div>
<div class="line"><span class="lineno">19916</span>        <a class="code hl_function" href="#adc85e6b6e1bec856e91dc0346f49d9da">mg_free</a>((<span class="keywordtype">void</span> *)conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a>);</div>
<div class="line"><span class="lineno">19917</span>        conn-&gt;<a class="code hl_variable" href="structmg__connection.html#ab2c448b0d885bca25578872ca4362c89">request_info</a>.<a class="code hl_variable" href="structmg__request__info.html#a369e379c8cb6f102ef44499989055279">local_uri</a> = <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">19918</span>    }</div>
<div class="line"><span class="lineno">19919</span> </div>
<div class="line"><span class="lineno">19920</span><span class="preprocessor">#if defined(USE_SERVER_STATS)</span></div>
<div class="line"><span class="lineno">19921</span>    conn-&gt;conn_state = 9; <span class="comment">/* done */</span></div>
<div class="line"><span class="lineno">19922</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">19923</span> </div>
<div class="line"><span class="lineno">19924</span>    <a class="code hl_define" href="#a98f6ecefbf7613a2478356d30af16020">DEBUG_TRACE</a>(<span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;exiting&quot;</span>);</div>
<div class="line"><span class="lineno">19925</span>}</div>
<div class="ttc" id="acivetweb_8c_html_a00335d9fbef2e339b4ede6983b97b906"><div class="ttname"><a href="#a00335d9fbef2e339b4ede6983b97b906">process_new_connection</a></div><div class="ttdeci">static void process_new_connection(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l19368">civetweb.c:19368</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a02b40bbcf0b155e706e5e1eb6b53309e"><div class="ttname"><a href="#a02b40bbcf0b155e706e5e1eb6b53309e">consume_socket</a></div><div class="ttdeci">static int consume_socket(struct mg_context *ctx, struct socket *sp, int thread_index)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l19624">civetweb.c:19624</a></div></div>
<div class="ttc" id="acivetweb_8c_html_a1cf68e4c3856f86612a53eac755c36fe"><div class="ttname"><a href="#a1cf68e4c3856f86612a53eac755c36fe">ssl_get_client_cert_info</a></div><div class="ttdeci">static int ssl_get_client_cert_info(const struct mg_connection *conn, struct mg_client_cert *client_cert)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l16620">civetweb.c:16620</a></div></div>
<div class="ttc" id="acivetweb_8c_html_ae40e268aca47c39d1f151a60655f3f70"><div class="ttname"><a href="#ae40e268aca47c39d1f151a60655f3f70">init_connection</a></div><div class="ttdeci">static void init_connection(struct mg_connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8c_source.html#l19329">civetweb.c:19329</a></div></div>
<div class="ttc" id="astructmg__client__cert_html"><div class="ttname"><a href="structmg__client__cert.html">mg_client_cert</a></div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00206">civetweb.h:206</a></div></div>
<div class="ttc" id="astructmg__request__info_html_a383d55fab7d885a52cfa9c8a56f2a7c3"><div class="ttname"><a href="structmg__request__info.html#a383d55fab7d885a52cfa9c8a56f2a7c3">mg_request_info::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00175">civetweb.h:175</a></div></div>
<div class="ttc" id="astructmg__request__info_html_a73782f8b56d710c02381d000d4ac1c6a"><div class="ttname"><a href="structmg__request__info.html#a73782f8b56d710c02381d000d4ac1c6a">mg_request_info::client_cert</a></div><div class="ttdeci">struct mg_client_cert * client_cert</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00182">civetweb.h:182</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="civetweb_8c_source.html#l01595">mg_workerTLS::alpn_proto</a>, <a class="el" href="civetweb_8c_source.html#l02532">mg_connection::buf</a>, <a class="el" href="civetweb_8c_source.html#l02556">mg_connection::buf_size</a>, <a class="el" href="civetweb_8c_source.html#l02432">mg_context::callbacks</a>, <a class="el" href="civetweb_8c_source.html#l02378">mg_context::cfg_worker_threads</a>, <a class="el" href="civetweb_8c_source.html#l02507">mg_connection::client</a>, <a class="el" href="civetweb_8h_source.html#l00182">mg_request_info::client_cert</a>, <a class="el" href="civetweb_8c_source.html#l17864">close_connection()</a>, <a class="el" href="civetweb_8c_source.html#l02508">mg_connection::conn_birth_time</a>, <a class="el" href="civetweb_8c_source.html#l02486">mg_connection::connection_type</a>, <a class="el" href="civetweb_8c_source.html#l02461">CONNECTION_TYPE_REQUEST</a>, <a class="el" href="civetweb_8c_source.html#l19624">consume_socket()</a>, <a class="el" href="civetweb_8c_source.html#l02518">mg_connection::content_len</a>, <a class="el" href="civetweb_8c_source.html#l02442">mg_context::dd</a>, <a class="el" href="civetweb_8c_source.html#l00242">DEBUG_TRACE</a>, <a class="el" href="civetweb_8c_source.html#l02498">mg_connection::dom_ctx</a>, <a class="el" href="civetweb_8h_source.html#l00400">mg_callbacks::exit_thread</a>, <a class="el" href="gmacros_8h_source.html#l00929">FALSE</a>, <a class="el" href="civetweb_8h_source.html#l00211">mg_client_cert::finger</a>, <a class="el" href="civetweb_8c_source.html#l19329">init_connection()</a>, <a class="el" href="civetweb_8h_source.html#l00393">mg_callbacks::init_thread</a>, <a class="el" href="civetweb_8c_source.html#l02525">mg_connection::is_chunked</a>, <a class="el" href="civetweb_8c_source.html#l01588">mg_workerTLS::is_master</a>, <a class="el" href="civetweb_8c_source.html#l01906">socket::is_ssl</a>, <a class="el" href="civetweb_8h_source.html#l00173">mg_request_info::is_ssl</a>, <a class="el" href="civetweb_8h_source.html#l00209">mg_client_cert::issuer</a>, <a class="el" href="civetweb_8h_source.html#l00157">mg_request_info::local_uri</a>, <a class="el" href="civetweb_8h_source.html#l00154">mg_request_info::local_uri_raw</a>, <a class="el" href="civetweb_8c_source.html#l01904">socket::lsa</a>, <a class="el" href="civetweb_8c_source.html#l02401">mg_context::max_request_size</a>, <a class="el" href="civetweb_8c_source.html#l01121">mg_atomic_inc()</a>, <a class="el" href="civetweb_8c_source.html#l02586">mg_cry_ctx_internal</a>, <a class="el" href="civetweb_8c_source.html#l01492">mg_free()</a>, <a class="el" href="civetweb_8c_source.html#l01497">mg_malloc_ctx</a>, <a class="el" href="civetweb_8c_source.html#l02780">mg_set_thread_name()</a>, <a class="el" href="civetweb_8c_source.html#l02565">mg_connection::mutex</a>, <a class="el" href="gmacros_8h_source.html#l00924">NULL</a>, <a class="el" href="civetweb_8h_source.html#l00207">mg_client_cert::peer_cert</a>, <a class="el" href="civetweb_8c_source.html#l02497">mg_connection::phys_ctx</a>, <a class="el" href="civetweb_8c_source.html#l19368">process_new_connection()</a>, <a class="el" href="civetweb_8c_source.html#l02487">mg_connection::protocol_type</a>, <a class="el" href="civetweb_8c_source.html#l02466">PROTOCOL_TYPE_HTTP1</a>, <a class="el" href="civetweb_8c_source.html#l02468">PROTOCOL_TYPE_HTTP2</a>, <a class="el" href="civetweb_8c_source.html#l01074">pthread_mutex_attr</a>, <a class="el" href="civetweb_8h_source.html#l00166">mg_request_info::remote_addr</a>, <a class="el" href="civetweb_8h_source.html#l00170">mg_request_info::remote_port</a>, <a class="el" href="civetweb_8c_source.html#l02494">mg_connection::request_info</a>, <a class="el" href="civetweb_8c_source.html#l01905">socket::rsa</a>, <a class="el" href="civetweb_8h_source.html#l00210">mg_client_cert::serial</a>, <a class="el" href="civetweb_8h_source.html#l00171">mg_request_info::server_port</a>, <a class="el" href="civetweb_8c_source.html#l01903">socket::sock</a>, <a class="el" href="civetweb_8c_source.html#l03292">sockaddr_to_string()</a>, <a class="el" href="civetweb_8c_source.html#l02506">mg_connection::ssl</a>, <a class="el" href="civetweb_8c_source.html#l02270">mg_domain_context::ssl_ctx</a>, <a class="el" href="civetweb_8c_source.html#l16620">ssl_get_client_cert_info()</a>, <a class="el" href="civetweb_8c_source.html#l16455">sslize()</a>, <a class="el" href="civetweb_8c_source.html#l01580">sTlsKey</a>, <a class="el" href="civetweb_8h_source.html#l00208">mg_client_cert::subject</a>, <a class="el" href="civetweb_8c_source.html#l01589">mg_workerTLS::thread_idx</a>, <a class="el" href="civetweb_8c_source.html#l01581">thread_idx_max</a>, <a class="el" href="civetweb_8c_source.html#l02571">mg_connection::tls_user_ptr</a>, <a class="el" href="civetweb_8c_source.html#l01860">USA_IN_PORT_UNSAFE</a>, <a class="el" href="civetweb_8c_source.html#l02433">mg_context::user_data</a>, <a class="el" href="civetweb_8h_source.html#l00175">mg_request_info::user_data</a>, <a class="el" href="civetweb_8c_source.html#l01590">mg_workerTLS::user_ptr</a>, and <a class="el" href="civetweb_8c_source.html#l02360">mg_context::worker_connections</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l19937">worker_thread()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a75d2d9abb3e5abaaf44e99b9f805f07a" name="a75d2d9abb3e5abaaf44e99b9f805f07a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75d2d9abb3e5abaaf44e99b9f805f07a">&#9670;&#160;</a></span>[struct]</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const struct  { ... }  abs_uri_protocols[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {{<span class="stringliteral">&quot;http://&quot;</span>, 7, 80},</div>
<div class="line">                         {<span class="stringliteral">&quot;https://&quot;</span>, 8, 443},</div>
<div class="line">                         {<span class="stringliteral">&quot;ws://&quot;</span>, 5, 80},</div>
<div class="line">                         {<span class="stringliteral">&quot;wss://&quot;</span>, 6, 443},</div>
<div class="line">                         {<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0}}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18465">get_rel_url_at_current_server()</a>, and <a class="el" href="civetweb_8c_source.html#l18395">get_uri_type()</a>.</p>

</div>
</div>
<a id="a8c57fa7eeaaed403927368aa20e4efd5" name="a8c57fa7eeaaed403927368aa20e4efd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c57fa7eeaaed403927368aa20e4efd5">&#9670;&#160;</a></span>all_methods</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char* all_methods = <a class="el" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10876">10876</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l22477">mg_exit_library()</a>, <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>, and <a class="el" href="civetweb_8c_source.html#l12632">send_options()</a>.</p>

</div>
</div>
<a id="a76f932e4783a1729837a1ea72e730127" name="a76f932e4783a1729837a1ea72e730127"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76f932e4783a1729837a1ea72e730127">&#9670;&#160;</a></span>[struct]</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const struct  { ... }  builtin_mime_types[]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08332">mg_get_builtin_mime_type()</a>.</p>

</div>
</div>
<a id="a414393f1a7ad731456acc279c62290d0" name="a414393f1a7ad731456acc279c62290d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a414393f1a7ad731456acc279c62290d0">&#9670;&#160;</a></span>config_options</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="structmg__option.html">mg_option</a> config_options[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l02062">2062</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2062</span>                                                 {</div>
<div class="line"><span class="lineno"> 2063</span> </div>
<div class="line"><span class="lineno"> 2064</span>    <span class="comment">/* Once for each server */</span></div>
<div class="line"><span class="lineno"> 2065</span>    {<span class="stringliteral">&quot;listening_ports&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <span class="stringliteral">&quot;8080&quot;</span>},</div>
<div class="line"><span class="lineno"> 2066</span>    {<span class="stringliteral">&quot;num_threads&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;50&quot;</span>},</div>
<div class="line"><span class="lineno"> 2067</span>    {<span class="stringliteral">&quot;run_as_user&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2068</span>    {<span class="stringliteral">&quot;tcp_nodelay&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;0&quot;</span>},</div>
<div class="line"><span class="lineno"> 2069</span>    {<span class="stringliteral">&quot;max_request_size&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;16384&quot;</span>},</div>
<div class="line"><span class="lineno"> 2070</span>    {<span class="stringliteral">&quot;linger_timeout_ms&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2071</span>    {<span class="stringliteral">&quot;connection_queue&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;20&quot;</span>},</div>
<div class="line"><span class="lineno"> 2072</span>    {<span class="stringliteral">&quot;listen_backlog&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;200&quot;</span>},</div>
<div class="line"><span class="lineno"> 2073</span><span class="preprocessor">#if defined(__linux__)</span></div>
<div class="line"><span class="lineno"> 2074</span>    {<span class="stringliteral">&quot;allow_sendfile_call&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;yes&quot;</span>},</div>
<div class="line"><span class="lineno"> 2075</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2076</span><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line"><span class="lineno"> 2077</span>    {<span class="stringliteral">&quot;case_sensitive&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;no&quot;</span>},</div>
<div class="line"><span class="lineno"> 2078</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2079</span>    {<span class="stringliteral">&quot;throttle&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2080</span>    {<span class="stringliteral">&quot;enable_keep_alive&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;no&quot;</span>},</div>
<div class="line"><span class="lineno"> 2081</span>    {<span class="stringliteral">&quot;request_timeout_ms&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;30000&quot;</span>},</div>
<div class="line"><span class="lineno"> 2082</span>    {<span class="stringliteral">&quot;keep_alive_timeout_ms&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;500&quot;</span>},</div>
<div class="line"><span class="lineno"> 2083</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno"> 2084</span>    {<span class="stringliteral">&quot;websocket_timeout_ms&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2085</span>    {<span class="stringliteral">&quot;enable_websocket_ping_pong&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;no&quot;</span>},</div>
<div class="line"><span class="lineno"> 2086</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2087</span>    {<span class="stringliteral">&quot;decode_url&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;yes&quot;</span>},</div>
<div class="line"><span class="lineno"> 2088</span>    {<span class="stringliteral">&quot;decode_query_string&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;no&quot;</span>},</div>
<div class="line"><span class="lineno"> 2089</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno"> 2090</span>    {<span class="stringliteral">&quot;lua_background_script&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2091</span>    {<span class="stringliteral">&quot;lua_background_script_params&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2092</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2093</span><span class="preprocessor">#if defined(USE_HTTP2)</span></div>
<div class="line"><span class="lineno"> 2094</span>    {<span class="stringliteral">&quot;enable_http2&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;no&quot;</span>},</div>
<div class="line"><span class="lineno"> 2095</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2096</span> </div>
<div class="line"><span class="lineno"> 2097</span>    <span class="comment">/* Once for each domain */</span></div>
<div class="line"><span class="lineno"> 2098</span>    {<span class="stringliteral">&quot;document_root&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a41339873036c88d2acef38ccd7b4fbb3">MG_CONFIG_TYPE_DIRECTORY</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2099</span> </div>
<div class="line"><span class="lineno"> 2100</span>    {<span class="stringliteral">&quot;access_log_file&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2101</span>    {<span class="stringliteral">&quot;error_log_file&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2102</span> </div>
<div class="line"><span class="lineno"> 2103</span>    {<span class="stringliteral">&quot;cgi_pattern&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a>, <span class="stringliteral">&quot;**.cgi$|**.pl$|**.php$&quot;</span>},</div>
<div class="line"><span class="lineno"> 2104</span>    {<span class="stringliteral">&quot;cgi_environment&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2105</span>    {<span class="stringliteral">&quot;cgi_interpreter&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2106</span>    {<span class="stringliteral">&quot;cgi_interpreter_args&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2107</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno"> 2108</span>    {<span class="stringliteral">&quot;cgi_timeout_ms&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2109</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2110</span>    {<span class="stringliteral">&quot;cgi_buffering&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;yes&quot;</span>},</div>
<div class="line"><span class="lineno"> 2111</span> </div>
<div class="line"><span class="lineno"> 2112</span>    {<span class="stringliteral">&quot;cgi2_pattern&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2113</span>    {<span class="stringliteral">&quot;cgi2_environment&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2114</span>    {<span class="stringliteral">&quot;cgi2_interpreter&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2115</span>    {<span class="stringliteral">&quot;cgi2_interpreter_args&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2116</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno"> 2117</span>    {<span class="stringliteral">&quot;cgi2_timeout_ms&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2118</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2119</span>    {<span class="stringliteral">&quot;cgi2_buffering&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;yes&quot;</span>},</div>
<div class="line"><span class="lineno"> 2120</span> </div>
<div class="line"><span class="lineno"> 2121</span><span class="preprocessor">#if defined(USE_4_CGI)</span></div>
<div class="line"><span class="lineno"> 2122</span>    {<span class="stringliteral">&quot;cgi3_pattern&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2123</span>    {<span class="stringliteral">&quot;cgi3_environment&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2124</span>    {<span class="stringliteral">&quot;cgi3_interpreter&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2125</span>    {<span class="stringliteral">&quot;cgi3_interpreter_args&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2126</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno"> 2127</span>    {<span class="stringliteral">&quot;cgi3_timeout_ms&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2128</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2129</span>    {<span class="stringliteral">&quot;cgi3_buffering&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;yes&quot;</span>},</div>
<div class="line"><span class="lineno"> 2130</span> </div>
<div class="line"><span class="lineno"> 2131</span>    {<span class="stringliteral">&quot;cgi4_pattern&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2132</span>    {<span class="stringliteral">&quot;cgi4_environment&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2133</span>    {<span class="stringliteral">&quot;cgi4_interpreter&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2134</span>    {<span class="stringliteral">&quot;cgi4_interpreter_args&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2135</span><span class="preprocessor">#if defined(USE_TIMERS)</span></div>
<div class="line"><span class="lineno"> 2136</span>    {<span class="stringliteral">&quot;cgi4_timeout_ms&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2137</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2138</span>    {<span class="stringliteral">&quot;cgi4_buffering&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;yes&quot;</span>},</div>
<div class="line"><span class="lineno"> 2139</span> </div>
<div class="line"><span class="lineno"> 2140</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2141</span> </div>
<div class="line"><span class="lineno"> 2142</span>    {<span class="stringliteral">&quot;put_delete_auth_file&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2143</span>    {<span class="stringliteral">&quot;protect_uri&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2144</span>    {<span class="stringliteral">&quot;authentication_domain&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <span class="stringliteral">&quot;mydomain.com&quot;</span>},</div>
<div class="line"><span class="lineno"> 2145</span>    {<span class="stringliteral">&quot;enable_auth_domain_check&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;yes&quot;</span>},</div>
<div class="line"><span class="lineno"> 2146</span>    {<span class="stringliteral">&quot;ssi_pattern&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a>, <span class="stringliteral">&quot;**.shtml$|**.shtm$&quot;</span>},</div>
<div class="line"><span class="lineno"> 2147</span>    {<span class="stringliteral">&quot;enable_directory_listing&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;yes&quot;</span>},</div>
<div class="line"><span class="lineno"> 2148</span>    {<span class="stringliteral">&quot;enable_webdav&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;no&quot;</span>},</div>
<div class="line"><span class="lineno"> 2149</span>    {<span class="stringliteral">&quot;global_auth_file&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2150</span>    {<span class="stringliteral">&quot;index_files&quot;</span>,</div>
<div class="line"><span class="lineno"> 2151</span>     <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>,</div>
<div class="line"><span class="lineno"> 2152</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno"> 2153</span>     <span class="stringliteral">&quot;index.xhtml,index.html,index.htm,&quot;</span></div>
<div class="line"><span class="lineno"> 2154</span>     <span class="stringliteral">&quot;index.lp,index.lsp,index.lua,index.cgi,&quot;</span></div>
<div class="line"><span class="lineno"> 2155</span>     <span class="stringliteral">&quot;index.shtml,index.php&quot;</span>},</div>
<div class="line"><span class="lineno"> 2156</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 2157</span>     <span class="stringliteral">&quot;index.xhtml,index.html,index.htm,index.cgi,index.shtml,index.php&quot;</span>},</div>
<div class="line"><span class="lineno"> 2158</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2159</span>    {<span class="stringliteral">&quot;access_control_list&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2160</span>    {<span class="stringliteral">&quot;extra_mime_types&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2161</span>    {<span class="stringliteral">&quot;ssl_certificate&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2162</span>    {<span class="stringliteral">&quot;ssl_certificate_chain&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2163</span>    {<span class="stringliteral">&quot;url_rewrite_patterns&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2164</span>    {<span class="stringliteral">&quot;hide_files_patterns&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2165</span> </div>
<div class="line"><span class="lineno"> 2166</span>    {<span class="stringliteral">&quot;ssl_verify_peer&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600accb77faf0653d18c1660c73d2b87f7df">MG_CONFIG_TYPE_YES_NO_OPTIONAL</a>, <span class="stringliteral">&quot;no&quot;</span>},</div>
<div class="line"><span class="lineno"> 2167</span>    {<span class="stringliteral">&quot;ssl_cache_timeout&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;-1&quot;</span>},</div>
<div class="line"><span class="lineno"> 2168</span> </div>
<div class="line"><span class="lineno"> 2169</span>    {<span class="stringliteral">&quot;ssl_ca_path&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a41339873036c88d2acef38ccd7b4fbb3">MG_CONFIG_TYPE_DIRECTORY</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2170</span>    {<span class="stringliteral">&quot;ssl_ca_file&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2171</span>    {<span class="stringliteral">&quot;ssl_verify_depth&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;9&quot;</span>},</div>
<div class="line"><span class="lineno"> 2172</span>    {<span class="stringliteral">&quot;ssl_default_verify_paths&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;yes&quot;</span>},</div>
<div class="line"><span class="lineno"> 2173</span>    {<span class="stringliteral">&quot;ssl_cipher_list&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2174</span> </div>
<div class="line"><span class="lineno"> 2175</span>    <span class="comment">/* HTTP2 requires ALPN, and anyway TLS1.2 should be considered</span></div>
<div class="line"><span class="lineno"> 2176</span><span class="comment">     * as a minimum in 2020 */</span></div>
<div class="line"><span class="lineno"> 2177</span>    {<span class="stringliteral">&quot;ssl_protocol_version&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;4&quot;</span>},</div>
<div class="line"><span class="lineno"> 2178</span> </div>
<div class="line"><span class="lineno"> 2179</span>    {<span class="stringliteral">&quot;ssl_short_trust&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;no&quot;</span>},</div>
<div class="line"><span class="lineno"> 2180</span> </div>
<div class="line"><span class="lineno"> 2181</span><span class="preprocessor">#if defined(USE_LUA)</span></div>
<div class="line"><span class="lineno"> 2182</span>    {<span class="stringliteral">&quot;lua_preload_file&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2183</span>    {<span class="stringliteral">&quot;lua_script_pattern&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a>, <span class="stringliteral">&quot;**.lua$&quot;</span>},</div>
<div class="line"><span class="lineno"> 2184</span>    {<span class="stringliteral">&quot;lua_server_page_pattern&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a>, <span class="stringliteral">&quot;**.lp$|**.lsp$&quot;</span>},</div>
<div class="line"><span class="lineno"> 2185</span><span class="preprocessor">#if defined(MG_EXPERIMENTAL_INTERFACES)</span></div>
<div class="line"><span class="lineno"> 2186</span>    {<span class="stringliteral">&quot;lua_debug&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2187</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2188</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2189</span><span class="preprocessor">#if defined(USE_DUKTAPE)</span></div>
<div class="line"><span class="lineno"> 2190</span>    <span class="comment">/* The support for duktape is still in alpha version state.</span></div>
<div class="line"><span class="lineno"> 2191</span><span class="comment">     * The name of this config option might change. */</span></div>
<div class="line"><span class="lineno"> 2192</span>    {<span class="stringliteral">&quot;duktape_script_pattern&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a>, <span class="stringliteral">&quot;**.ssjs$&quot;</span>},</div>
<div class="line"><span class="lineno"> 2193</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2194</span> </div>
<div class="line"><span class="lineno"> 2195</span><span class="preprocessor">#if defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno"> 2196</span>    {<span class="stringliteral">&quot;websocket_root&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a41339873036c88d2acef38ccd7b4fbb3">MG_CONFIG_TYPE_DIRECTORY</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2197</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2198</span><span class="preprocessor">#if defined(USE_LUA) &amp;&amp; defined(USE_WEBSOCKET)</span></div>
<div class="line"><span class="lineno"> 2199</span>    {<span class="stringliteral">&quot;lua_websocket_pattern&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a>, <span class="stringliteral">&quot;**.lua$&quot;</span>},</div>
<div class="line"><span class="lineno"> 2200</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2201</span>    {<span class="stringliteral">&quot;access_control_allow_origin&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <span class="stringliteral">&quot;*&quot;</span>},</div>
<div class="line"><span class="lineno"> 2202</span>    {<span class="stringliteral">&quot;access_control_allow_methods&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <span class="stringliteral">&quot;*&quot;</span>},</div>
<div class="line"><span class="lineno"> 2203</span>    {<span class="stringliteral">&quot;access_control_allow_headers&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <span class="stringliteral">&quot;*&quot;</span>},</div>
<div class="line"><span class="lineno"> 2204</span>    {<span class="stringliteral">&quot;error_pages&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a41339873036c88d2acef38ccd7b4fbb3">MG_CONFIG_TYPE_DIRECTORY</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2205</span><span class="preprocessor">#if !defined(NO_CACHING)</span></div>
<div class="line"><span class="lineno"> 2206</span>    {<span class="stringliteral">&quot;static_file_max_age&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <span class="stringliteral">&quot;3600&quot;</span>},</div>
<div class="line"><span class="lineno"> 2207</span>    {<span class="stringliteral">&quot;static_file_cache_control&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2208</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2209</span><span class="preprocessor">#if !defined(NO_SSL)</span></div>
<div class="line"><span class="lineno"> 2210</span>    {<span class="stringliteral">&quot;strict_transport_security_max_age&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2211</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2212</span>    {<span class="stringliteral">&quot;additional_header&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a69352c89f82b9b6fcf3d22b2e642efdd">MG_CONFIG_TYPE_STRING_MULTILINE</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},</div>
<div class="line"><span class="lineno"> 2213</span>    {<span class="stringliteral">&quot;allow_index_script_resource&quot;</span>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a>, <span class="stringliteral">&quot;no&quot;</span>},</div>
<div class="line"><span class="lineno"> 2214</span> </div>
<div class="line"><span class="lineno"> 2215</span>    {<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code hl_enumvalue" href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a09f469b2a45a8616aab9e493beeb153c">MG_CONFIG_TYPE_UNKNOWN</a>, <a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};</div>
<div class="ttc" id="acivetweb_8h_html_abed82baf7f470b522273a3e37c24c600a09f469b2a45a8616aab9e493beeb153c"><div class="ttname"><a href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a09f469b2a45a8616aab9e493beeb153c">MG_CONFIG_TYPE_UNKNOWN</a></div><div class="ttdeci">@ MG_CONFIG_TYPE_UNKNOWN</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00694">civetweb.h:694</a></div></div>
<div class="ttc" id="acivetweb_8h_html_abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793"><div class="ttname"><a href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a11fa4436ce6263e57055a419729e4793">MG_CONFIG_TYPE_FILE</a></div><div class="ttdeci">@ MG_CONFIG_TYPE_FILE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00697">civetweb.h:697</a></div></div>
<div class="ttc" id="acivetweb_8h_html_abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba"><div class="ttname"><a href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a376b9b6b1e491b1db9e2acbfec0d9cba">MG_CONFIG_TYPE_STRING</a></div><div class="ttdeci">@ MG_CONFIG_TYPE_STRING</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00696">civetweb.h:696</a></div></div>
<div class="ttc" id="acivetweb_8h_html_abed82baf7f470b522273a3e37c24c600a41339873036c88d2acef38ccd7b4fbb3"><div class="ttname"><a href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a41339873036c88d2acef38ccd7b4fbb3">MG_CONFIG_TYPE_DIRECTORY</a></div><div class="ttdeci">@ MG_CONFIG_TYPE_DIRECTORY</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00698">civetweb.h:698</a></div></div>
<div class="ttc" id="acivetweb_8h_html_abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230"><div class="ttname"><a href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a54d16bf53123bb3b1260d1d8fad3a230">MG_CONFIG_TYPE_EXT_PATTERN</a></div><div class="ttdeci">@ MG_CONFIG_TYPE_EXT_PATTERN</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00700">civetweb.h:700</a></div></div>
<div class="ttc" id="acivetweb_8h_html_abed82baf7f470b522273a3e37c24c600a69352c89f82b9b6fcf3d22b2e642efdd"><div class="ttname"><a href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a69352c89f82b9b6fcf3d22b2e642efdd">MG_CONFIG_TYPE_STRING_MULTILINE</a></div><div class="ttdeci">@ MG_CONFIG_TYPE_STRING_MULTILINE</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00702">civetweb.h:702</a></div></div>
<div class="ttc" id="acivetweb_8h_html_abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617"><div class="ttname"><a href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600a870bd7148183409ae6b69f90cab74617">MG_CONFIG_TYPE_STRING_LIST</a></div><div class="ttdeci">@ MG_CONFIG_TYPE_STRING_LIST</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00701">civetweb.h:701</a></div></div>
<div class="ttc" id="acivetweb_8h_html_abed82baf7f470b522273a3e37c24c600accb77faf0653d18c1660c73d2b87f7df"><div class="ttname"><a href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600accb77faf0653d18c1660c73d2b87f7df">MG_CONFIG_TYPE_YES_NO_OPTIONAL</a></div><div class="ttdeci">@ MG_CONFIG_TYPE_YES_NO_OPTIONAL</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00704">civetweb.h:703</a></div></div>
<div class="ttc" id="acivetweb_8h_html_abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a"><div class="ttname"><a href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600ae06caa2e5345f4284fe47b84901faf9a">MG_CONFIG_TYPE_NUMBER</a></div><div class="ttdeci">@ MG_CONFIG_TYPE_NUMBER</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00695">civetweb.h:695</a></div></div>
<div class="ttc" id="acivetweb_8h_html_abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36"><div class="ttname"><a href="civetweb_8h.html#abed82baf7f470b522273a3e37c24c600aeb3df5014f0adcd01524c03d9ca55b36">MG_CONFIG_TYPE_BOOLEAN</a></div><div class="ttdeci">@ MG_CONFIG_TYPE_BOOLEAN</div><div class="ttdef"><b>Definition</b> <a href="civetweb_8h_source.html#l00699">civetweb.h:699</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03159">get_option_index()</a>, <a class="el" href="civetweb_8c_source.html#l11587">handle_cgi_request()</a>, <a class="el" href="civetweb_8c_source.html#l17485">init_ssl_ctx()</a>, <a class="el" href="civetweb_8c_source.html#l20436">legacy_init()</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l02833">mg_get_valid_options()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l21220">mg_start_domain2()</a>, <a class="el" href="civetweb_8c_source.html#l06439">pull_all()</a>, <a class="el" href="civetweb_8c_source.html#l06162">push_all()</a>, <a class="el" href="civetweb_8c_source.html#l11107">read_message()</a>, and <a class="el" href="civetweb_8c_source.html#l15736">set_ports_option()</a>.</p>

</div>
</div>
<a id="ad6ec95caddfbfbbe177b2e95ec9d17b3" name="ad6ec95caddfbfbbe177b2e95ec9d17b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6ec95caddfbfbbe177b2e95ec9d17b3">&#9670;&#160;</a></span>cryptolib_dll_handle</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void* cryptolib_dll_handle</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16806">16806</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>.</p>

</div>
</div>
<a id="a5254c431a0b51011fbb000d383bf56fd" name="a5254c431a0b51011fbb000d383bf56fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5254c431a0b51011fbb000d383bf56fd">&#9670;&#160;</a></span>cryptolib_users</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">volatile ptrdiff_t cryptolib_users</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=</div>
<div class="line">    0</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16815">16815</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, and <a class="el" href="civetweb_8c_source.html#l17594">uninitialize_openssl()</a>.</p>

</div>
</div>
<a id="a44d2ac6d2bf6a4654389c5e778e7414c" name="a44d2ac6d2bf6a4654389c5e778e7414c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44d2ac6d2bf6a4654389c5e778e7414c">&#9670;&#160;</a></span>default_port</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned default_port</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18380">18380</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>.</p>

</div>
</div>
<a id="a267ce87a2a38d9f1e99d345dbde97c28" name="a267ce87a2a38d9f1e99d345dbde97c28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a267ce87a2a38d9f1e99d345dbde97c28">&#9670;&#160;</a></span>ext_len</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t ext_len</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08223">8223</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08332">mg_get_builtin_mime_type()</a>.</p>

</div>
</div>
<a id="a3a21b674a056eab8a11436300ae02d00" name="a3a21b674a056eab8a11436300ae02d00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a21b674a056eab8a11436300ae02d00">&#9670;&#160;</a></span>extension</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* extension</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08222">8222</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l08332">mg_get_builtin_mime_type()</a>.</p>

</div>
</div>
<a id="a52fa011c62bacc213572e7464ca702dd" name="a52fa011c62bacc213572e7464ca702dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52fa011c62bacc213572e7464ca702dd">&#9670;&#160;</a></span>global_lock_mutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t global_lock_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01089">1089</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l22477">mg_exit_library()</a>, <a class="el" href="civetweb_8c_source.html#l01094">mg_global_lock()</a>, <a class="el" href="civetweb_8c_source.html#l01102">mg_global_unlock()</a>, and <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>.</p>

</div>
</div>
<a id="a7b17944603d3fb09046b30ffef0cbfc6" name="a7b17944603d3fb09046b30ffef0cbfc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b17944603d3fb09046b30ffef0cbfc6">&#9670;&#160;</a></span>http_methods</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="structmg__http__method__info.html">mg_http_method_info</a> http_methods[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l10813">10813</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">10813</span>                                                         {</div>
<div class="line"><span class="lineno">10814</span>    <span class="comment">/* HTTP (RFC 2616) */</span></div>
<div class="line"><span class="lineno">10815</span>    {<span class="stringliteral">&quot;GET&quot;</span>, 0, 1, 1, 1, 1},</div>
<div class="line"><span class="lineno">10816</span>    {<span class="stringliteral">&quot;POST&quot;</span>, 1, 1, 0, 0, 0},</div>
<div class="line"><span class="lineno">10817</span>    {<span class="stringliteral">&quot;PUT&quot;</span>, 1, 0, 0, 1, 0},</div>
<div class="line"><span class="lineno">10818</span>    {<span class="stringliteral">&quot;DELETE&quot;</span>, 0, 0, 0, 1, 0},</div>
<div class="line"><span class="lineno">10819</span>    {<span class="stringliteral">&quot;HEAD&quot;</span>, 0, 0, 1, 1, 1},</div>
<div class="line"><span class="lineno">10820</span>    {<span class="stringliteral">&quot;OPTIONS&quot;</span>, 0, 0, 1, 1, 0},</div>
<div class="line"><span class="lineno">10821</span>    {<span class="stringliteral">&quot;CONNECT&quot;</span>, 1, 1, 0, 0, 0},</div>
<div class="line"><span class="lineno">10822</span>    <span class="comment">/* TRACE method (RFC 2616) is not supported for security reasons */</span></div>
<div class="line"><span class="lineno">10823</span> </div>
<div class="line"><span class="lineno">10824</span>    <span class="comment">/* PATCH method (RFC 5789) */</span></div>
<div class="line"><span class="lineno">10825</span>    {<span class="stringliteral">&quot;PATCH&quot;</span>, 1, 0, 0, 0, 0},</div>
<div class="line"><span class="lineno">10826</span>    <span class="comment">/* PATCH method only allowed for CGI/Lua/LSP and callbacks. */</span></div>
<div class="line"><span class="lineno">10827</span> </div>
<div class="line"><span class="lineno">10828</span>    <span class="comment">/* WEBDAV (RFC 2518) */</span></div>
<div class="line"><span class="lineno">10829</span>    {<span class="stringliteral">&quot;PROPFIND&quot;</span>, 0, 1, 1, 1, 0},</div>
<div class="line"><span class="lineno">10830</span>    <span class="comment">/* http://www.webdav.org/specs/rfc4918.html, 9.1:</span></div>
<div class="line"><span class="lineno">10831</span><span class="comment">     * Some PROPFIND results MAY be cached, with care,</span></div>
<div class="line"><span class="lineno">10832</span><span class="comment">     * as there is no cache validation mechanism for</span></div>
<div class="line"><span class="lineno">10833</span><span class="comment">     * most properties. This method is both safe and</span></div>
<div class="line"><span class="lineno">10834</span><span class="comment">     * idempotent (see Section 9.1 of [RFC2616]). */</span></div>
<div class="line"><span class="lineno">10835</span>    {<span class="stringliteral">&quot;MKCOL&quot;</span>, 0, 0, 0, 1, 0},</div>
<div class="line"><span class="lineno">10836</span>    <span class="comment">/* http://www.webdav.org/specs/rfc4918.html, 9.1:</span></div>
<div class="line"><span class="lineno">10837</span><span class="comment">     * When MKCOL is invoked without a request body,</span></div>
<div class="line"><span class="lineno">10838</span><span class="comment">     * the newly created collection SHOULD have no</span></div>
<div class="line"><span class="lineno">10839</span><span class="comment">     * members. A MKCOL request message may contain</span></div>
<div class="line"><span class="lineno">10840</span><span class="comment">     * a message body. The precise behavior of a MKCOL</span></div>
<div class="line"><span class="lineno">10841</span><span class="comment">     * request when the body is present is undefined,</span></div>
<div class="line"><span class="lineno">10842</span><span class="comment">     * ... ==&gt; We do not support MKCOL with body data.</span></div>
<div class="line"><span class="lineno">10843</span><span class="comment">     * This method is idempotent, but not safe (see</span></div>
<div class="line"><span class="lineno">10844</span><span class="comment">     * Section 9.1 of [RFC2616]). Responses to this</span></div>
<div class="line"><span class="lineno">10845</span><span class="comment">     * method MUST NOT be cached. */</span></div>
<div class="line"><span class="lineno">10846</span> </div>
<div class="line"><span class="lineno">10847</span>    <span class="comment">/* Methods for write access to files on WEBDAV (RFC 2518) */</span></div>
<div class="line"><span class="lineno">10848</span>    {<span class="stringliteral">&quot;LOCK&quot;</span>, 1, 1, 0, 0, 0},</div>
<div class="line"><span class="lineno">10849</span>    {<span class="stringliteral">&quot;UNLOCK&quot;</span>, 1, 0, 0, 0, 0},</div>
<div class="line"><span class="lineno">10850</span>    {<span class="stringliteral">&quot;PROPPATCH&quot;</span>, 1, 1, 0, 0, 0},</div>
<div class="line"><span class="lineno">10851</span>    {<span class="stringliteral">&quot;COPY&quot;</span>, 1, 0, 0, 0, 0},</div>
<div class="line"><span class="lineno">10852</span>    {<span class="stringliteral">&quot;MOVE&quot;</span>, 1, 1, 0, 0, 0},</div>
<div class="line"><span class="lineno">10853</span> </div>
<div class="line"><span class="lineno">10854</span>    <span class="comment">/* Unsupported WEBDAV Methods: */</span></div>
<div class="line"><span class="lineno">10855</span>    <span class="comment">/* + 11 methods from RFC 3253 */</span></div>
<div class="line"><span class="lineno">10856</span>    <span class="comment">/* ORDERPATCH (RFC 3648) */</span></div>
<div class="line"><span class="lineno">10857</span>    <span class="comment">/* ACL (RFC 3744) */</span></div>
<div class="line"><span class="lineno">10858</span>    <span class="comment">/* SEARCH (RFC 5323) */</span></div>
<div class="line"><span class="lineno">10859</span>    <span class="comment">/* + MicroSoft extensions</span></div>
<div class="line"><span class="lineno">10860</span><span class="comment">     * https://msdn.microsoft.com/en-us/library/aa142917.aspx */</span></div>
<div class="line"><span class="lineno">10861</span> </div>
<div class="line"><span class="lineno">10862</span>    <span class="comment">/* REPORT method (RFC 3253) */</span></div>
<div class="line"><span class="lineno">10863</span>    {<span class="stringliteral">&quot;REPORT&quot;</span>, 1, 1, 1, 1, 1},</div>
<div class="line"><span class="lineno">10864</span>    <span class="comment">/* REPORT method only allowed for CGI/Lua/LSP and callbacks. */</span></div>
<div class="line"><span class="lineno">10865</span>    <span class="comment">/* It was defined for WEBDAV in RFC 3253, Sec. 3.6</span></div>
<div class="line"><span class="lineno">10866</span><span class="comment">     * (https://tools.ietf.org/html/rfc3253#section-3.6), but seems</span></div>
<div class="line"><span class="lineno">10867</span><span class="comment">     * to be useful for REST in case a &quot;GET request with body&quot; is</span></div>
<div class="line"><span class="lineno">10868</span><span class="comment">     * required. */</span></div>
<div class="line"><span class="lineno">10869</span> </div>
<div class="line"><span class="lineno">10870</span>    {<a class="code hl_define" href="gmacros_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, 0}</div>
<div class="line"><span class="lineno">10871</span>    <span class="comment">/* end of list */</span></div>
<div class="line"><span class="lineno">10872</span>};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10880">get_http_method_info()</a>, and <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>.</p>

</div>
</div>
<a id="a553c3bf49335ca7c4ef0af9293ff30cb" name="a553c3bf49335ca7c4ef0af9293ff30cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a553c3bf49335ca7c4ef0af9293ff30cb">&#9670;&#160;</a></span>mg_init_library_called</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int mg_init_library_called = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01552">1552</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l22477">mg_exit_library()</a>, <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>, and <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>.</p>

</div>
</div>
<a id="a12139285594e136f3f40ec07d2fdc5c5" name="a12139285594e136f3f40ec07d2fdc5c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12139285594e136f3f40ec07d2fdc5c5">&#9670;&#160;</a></span>mime_type</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* mime_type</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l08224">8224</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l10220">handle_static_file_request()</a>, <a class="el" href="civetweb_8c_source.html#l04576">mg_send_http_ok()</a>, <a class="el" href="civetweb_8c_source.html#l10517">mg_send_mime_file()</a>, and <a class="el" href="civetweb_8c_source.html#l10526">mg_send_mime_file2()</a>.</p>

</div>
</div>
<a id="a5012c7bf061f74574b046e588f9e6342" name="a5012c7bf061f74574b046e588f9e6342"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5012c7bf061f74574b046e588f9e6342">&#9670;&#160;</a></span>month_names</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char month_names[][4]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {<span class="stringliteral">&quot;Jan&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Feb&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Mar&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Apr&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;May&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Jun&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Jul&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Aug&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Sep&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Oct&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Nov&quot;</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Dec&quot;</span>}</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01815">1815</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1815</span>                                     {<span class="stringliteral">&quot;Jan&quot;</span>,</div>
<div class="line"><span class="lineno"> 1816</span>                                      <span class="stringliteral">&quot;Feb&quot;</span>,</div>
<div class="line"><span class="lineno"> 1817</span>                                      <span class="stringliteral">&quot;Mar&quot;</span>,</div>
<div class="line"><span class="lineno"> 1818</span>                                      <span class="stringliteral">&quot;Apr&quot;</span>,</div>
<div class="line"><span class="lineno"> 1819</span>                                      <span class="stringliteral">&quot;May&quot;</span>,</div>
<div class="line"><span class="lineno"> 1820</span>                                      <span class="stringliteral">&quot;Jun&quot;</span>,</div>
<div class="line"><span class="lineno"> 1821</span>                                      <span class="stringliteral">&quot;Jul&quot;</span>,</div>
<div class="line"><span class="lineno"> 1822</span>                                      <span class="stringliteral">&quot;Aug&quot;</span>,</div>
<div class="line"><span class="lineno"> 1823</span>                                      <span class="stringliteral">&quot;Sep&quot;</span>,</div>
<div class="line"><span class="lineno"> 1824</span>                                      <span class="stringliteral">&quot;Oct&quot;</span>,</div>
<div class="line"><span class="lineno"> 1825</span>                                      <span class="stringliteral">&quot;Nov&quot;</span>,</div>
<div class="line"><span class="lineno"> 1826</span>                                      <span class="stringliteral">&quot;Dec&quot;</span>};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l07989">get_month_index()</a>.</p>

</div>
</div>
<a id="a1491042fd5b61bf39023b8df4c736128" name="a1491042fd5b61bf39023b8df4c736128"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1491042fd5b61bf39023b8df4c736128">&#9670;&#160;</a></span>proto</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* proto</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18378">18378</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="duktape-1_85_82_2src-separate_2duk__api__bytecode_8c_source.html#l00371">duk__load_func()</a>, <a class="el" href="duktape-1_88_80_2src-separate_2duk__api__bytecode_8c_source.html#l00371">duk__load_func()</a>, <a class="el" href="duktape-1_85_82_2src-separate_2duk__bi__object_8c_source.html#l00158">duk_bi_object_constructor_create()</a>, <a class="el" href="duktape-1_85_82_2src-separate_2duk__bi__object_8c_source.html#l00045">duk_bi_object_getprototype_shared()</a>, <a class="el" href="duktape-1_85_82_2src-separate_2duk__api__object_8c_source.html#l00545">duk_get_prototype()</a>, <a class="el" href="duktape-1_85_82_2src-noline_2duktape_8c_source.html#l70765">duk_js_instanceof()</a>, <a class="el" href="duktape-1_85_82_2src-separate_2duk__js__var_8c_source.html#l00118">duk_js_push_closure()</a>, <a class="el" href="duktape-1_85_82_2src-separate_2duk__api__call_8c_source.html#l00225">duk_new()</a>, <a class="el" href="duktape-1_85_82_2src-separate_2duk__api__stack_8c_source.html#l04019">duk_push_error_object_va_raw()</a>, <a class="el" href="duktape-1_85_82_2src-separate_2duk__api__stack_8c_source.html#l03561">duk_push_object_helper_proto()</a>, <a class="el" href="duktape-1_85_82_2src-separate_2duk__api__object_8c_source.html#l00565">duk_set_prototype()</a>, <a class="el" href="duktape-1_85_82_2src-separate_2duk__api__stack_8c_source.html#l02426">duk_to_object()</a>, <a class="el" href="civetweb_8c_source.html#l03574">get_proto_name()</a>, <a class="el" href="civetweb_8c_source.html#l18465">get_rel_url_at_current_server()</a>, <a class="el" href="civetweb_8c_source.html#l18395">get_uri_type()</a>, and <a class="el" href="civetweb_8c_source.html#l03601">mg_construct_local_link()</a>.</p>

</div>
</div>
<a id="ae76eb848818055987d653483ac38ec19" name="ae76eb848818055987d653483ac38ec19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae76eb848818055987d653483ac38ec19">&#9670;&#160;</a></span>proto_len</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t proto_len</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l18379">18379</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l18465">get_rel_url_at_current_server()</a>, and <a class="el" href="civetweb_8c_source.html#l18395">get_uri_type()</a>.</p>

</div>
</div>
<a id="a5fea1ce44dd3b119b5edd85d330d8143" name="a5fea1ce44dd3b119b5edd85d330d8143"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5fea1ce44dd3b119b5edd85d330d8143">&#9670;&#160;</a></span>pthread_mutex_attr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutexattr_t pthread_mutex_attr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01074">1074</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, <a class="el" href="civetweb_8c_source.html#l18001">mg_connect_client_impl()</a>, <a class="el" href="civetweb_8c_source.html#l22477">mg_exit_library()</a>, <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="a4bb32ca4bd6292bd0d47491d9b7b3996" name="a4bb32ca4bd6292bd0d47491d9b7b3996"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bb32ca4bd6292bd0d47491d9b7b3996">&#9670;&#160;</a></span>ssl_mutexes</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t* ssl_mutexes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16451">16451</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>, <a class="el" href="civetweb_8c_source.html#l16697">ssl_locking_callback()</a>, and <a class="el" href="civetweb_8c_source.html#l17594">uninitialize_openssl()</a>.</p>

</div>
</div>
<a id="aeca28977786ca2960224e23c8c19d8ca" name="aeca28977786ca2960224e23c8c19d8ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeca28977786ca2960224e23c8c19d8ca">&#9670;&#160;</a></span>ssllib_dll_handle</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void* ssllib_dll_handle</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l16805">16805</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l16821">initialize_openssl()</a>.</p>

</div>
</div>
<a id="a0553b9f90d6c0d22c73cf05ffe81b708" name="a0553b9f90d6c0d22c73cf05ffe81b708"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0553b9f90d6c0d22c73cf05ffe81b708">&#9670;&#160;</a></span>static_assert_replacement</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char static_assert_replacement[1]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l00125">125</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

</div>
</div>
<a id="a03c9b752bc27bdf5941ddde6f615dd44" name="a03c9b752bc27bdf5941ddde6f615dd44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03c9b752bc27bdf5941ddde6f615dd44">&#9670;&#160;</a></span>sTlsKey</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_key_t sTlsKey</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01580">1580</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l20044">master_thread_run()</a>, <a class="el" href="civetweb_8c_source.html#l01626">mg_current_thread_id()</a>, <a class="el" href="civetweb_8c_source.html#l22477">mg_exit_library()</a>, <a class="el" href="civetweb_8c_source.html#l03521">mg_get_request_info()</a>, <a class="el" href="civetweb_8c_source.html#l03209">mg_get_thread_pointer()</a>, <a class="el" href="civetweb_8c_source.html#l22347">mg_init_library()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, <a class="el" href="civetweb_8c_source.html#l16321">tls_dtor()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
<a id="af79aed9cc77304a39b3e031b2730e38b" name="af79aed9cc77304a39b3e031b2730e38b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af79aed9cc77304a39b3e031b2730e38b">&#9670;&#160;</a></span>thread_idx_max</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">volatile ptrdiff_t thread_idx_max = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="civetweb_8c_source.html#l01581">1581</a> of file <a class="el" href="civetweb_8c_source.html">civetweb.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="civetweb_8c_source.html#l01626">mg_current_thread_id()</a>, <a class="el" href="civetweb_8c_source.html#l20464">mg_start2()</a>, and <a class="el" href="civetweb_8c_source.html#l19704">worker_thread_run()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_1e03628437b642463b7b6eb98fac43e1.html">vendor</a></li><li class="navelem"><a class="el" href="dir_84591d08937a968859b7757c3b203700.html">civetweb</a></li><li class="navelem"><a class="el" href="civetweb_8c.html">civetweb.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
